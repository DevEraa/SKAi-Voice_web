(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const L of document.querySelectorAll('link[rel="modulepreload"]'))A(L);new MutationObserver(L=>{for(const U of L)if(U.type==="childList")for(const K of U.addedNodes)K.tagName==="LINK"&&K.rel==="modulepreload"&&A(K)}).observe(document,{childList:!0,subtree:!0});function O(L){const U={};return L.integrity&&(U.integrity=L.integrity),L.referrerPolicy&&(U.referrerPolicy=L.referrerPolicy),L.crossOrigin==="use-credentials"?U.credentials="include":L.crossOrigin==="anonymous"?U.credentials="omit":U.credentials="same-origin",U}function A(L){if(L.ep)return;L.ep=!0;const U=O(L);fetch(L.href,U)}})();var PI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function iO(E){return E&&E.__esModule&&Object.prototype.hasOwnProperty.call(E,"default")?E.default:E}var kI={exports:{}},Dy={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xj;function hK(){if(xj)return Dy;xj=1;var E=Symbol.for("react.transitional.element"),b=Symbol.for("react.fragment");function O(A,L,U){var K=null;if(U!==void 0&&(K=""+U),L.key!==void 0&&(K=""+L.key),"key"in L){U={};for(var J in L)J!=="key"&&(U[J]=L[J])}else U=L;return L=U.ref,{$$typeof:E,type:A,key:K,ref:L!==void 0?L:null,props:U}}return Dy.Fragment=b,Dy.jsx=O,Dy.jsxs=O,Dy}var Mj;function pK(){return Mj||(Mj=1,kI.exports=hK()),kI.exports}var R=pK(),xI={exports:{}},hn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uj;function fK(){if(Uj)return hn;Uj=1;var E=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),O=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),U=Symbol.for("react.consumer"),K=Symbol.for("react.context"),J=Symbol.for("react.forward_ref"),G=Symbol.for("react.suspense"),H=Symbol.for("react.memo"),rt=Symbol.for("react.lazy"),lt=Symbol.iterator;function dt(at){return at===null||typeof at!="object"?null:(at=lt&&at[lt]||at["@@iterator"],typeof at=="function"?at:null)}var X={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},st=Object.assign,Ct={};function yt(at,Ft,he){this.props=at,this.context=Ft,this.refs=Ct,this.updater=he||X}yt.prototype.isReactComponent={},yt.prototype.setState=function(at,Ft){if(typeof at!="object"&&typeof at!="function"&&at!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,at,Ft,"setState")},yt.prototype.forceUpdate=function(at){this.updater.enqueueForceUpdate(this,at,"forceUpdate")};function It(){}It.prototype=yt.prototype;function Wt(at,Ft,he){this.props=at,this.context=Ft,this.refs=Ct,this.updater=he||X}var Rt=Wt.prototype=new It;Rt.constructor=Wt,st(Rt,yt.prototype),Rt.isPureReactComponent=!0;var ye=Array.isArray,ne={H:null,A:null,T:null,S:null},_e=Object.prototype.hasOwnProperty;function Ne(at,Ft,he,jt,Zt,Lt){return he=Lt.ref,{$$typeof:E,type:at,key:Ft,ref:he!==void 0?he:null,props:Lt}}function Ie(at,Ft){return Ne(at.type,Ft,void 0,void 0,void 0,at.props)}function Xt(at){return typeof at=="object"&&at!==null&&at.$$typeof===E}function Qt(at){var Ft={"=":"=0",":":"=2"};return"$"+at.replace(/[=:]/g,function(he){return Ft[he]})}var Ae=/\/+/g;function In(at,Ft){return typeof at=="object"&&at!==null&&at.key!=null?Qt(""+at.key):Ft.toString(36)}function re(){}function Gt(at){switch(at.status){case"fulfilled":return at.value;case"rejected":throw at.reason;default:switch(typeof at.status=="string"?at.then(re,re):(at.status="pending",at.then(function(Ft){at.status==="pending"&&(at.status="fulfilled",at.value=Ft)},function(Ft){at.status==="pending"&&(at.status="rejected",at.reason=Ft)})),at.status){case"fulfilled":return at.value;case"rejected":throw at.reason}}throw at}function me(at,Ft,he,jt,Zt){var Lt=typeof at;(Lt==="undefined"||Lt==="boolean")&&(at=null);var Kt=!1;if(at===null)Kt=!0;else switch(Lt){case"bigint":case"string":case"number":Kt=!0;break;case"object":switch(at.$$typeof){case E:case b:Kt=!0;break;case rt:return Kt=at._init,me(Kt(at._payload),Ft,he,jt,Zt)}}if(Kt)return Zt=Zt(at),Kt=jt===""?"."+In(at,0):jt,ye(Zt)?(he="",Kt!=null&&(he=Kt.replace(Ae,"$&/")+"/"),me(Zt,Ft,he,"",function(ce){return ce})):Zt!=null&&(Xt(Zt)&&(Zt=Ie(Zt,he+(Zt.key==null||at&&at.key===Zt.key?"":(""+Zt.key).replace(Ae,"$&/")+"/")+Kt)),Ft.push(Zt)),1;Kt=0;var Re=jt===""?".":jt+":";if(ye(at))for(var te=0;te<at.length;te++)jt=at[te],Lt=Re+In(jt,te),Kt+=me(jt,Ft,he,Lt,Zt);else if(te=dt(at),typeof te=="function")for(at=te.call(at),te=0;!(jt=at.next()).done;)jt=jt.value,Lt=Re+In(jt,te++),Kt+=me(jt,Ft,he,Lt,Zt);else if(Lt==="object"){if(typeof at.then=="function")return me(Gt(at),Ft,he,jt,Zt);throw Ft=String(at),Error("Objects are not valid as a React child (found: "+(Ft==="[object Object]"?"object with keys {"+Object.keys(at).join(", ")+"}":Ft)+"). If you meant to render a collection of children, use an array instead.")}return Kt}function Ut(at,Ft,he){if(at==null)return at;var jt=[],Zt=0;return me(at,jt,"","",function(Lt){return Ft.call(he,Lt,Zt++)}),jt}function Ee(at){if(at._status===-1){var Ft=at._result;Ft=Ft(),Ft.then(function(he){(at._status===0||at._status===-1)&&(at._status=1,at._result=he)},function(he){(at._status===0||at._status===-1)&&(at._status=2,at._result=he)}),at._status===-1&&(at._status=0,at._result=Ft)}if(at._status===1)return at._result.default;throw at._result}var se=typeof reportError=="function"?reportError:function(at){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ft=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof at=="object"&&at!==null&&typeof at.message=="string"?String(at.message):String(at),error:at});if(!window.dispatchEvent(Ft))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",at);return}console.error(at)};function be(){}return hn.Children={map:Ut,forEach:function(at,Ft,he){Ut(at,function(){Ft.apply(this,arguments)},he)},count:function(at){var Ft=0;return Ut(at,function(){Ft++}),Ft},toArray:function(at){return Ut(at,function(Ft){return Ft})||[]},only:function(at){if(!Xt(at))throw Error("React.Children.only expected to receive a single React element child.");return at}},hn.Component=yt,hn.Fragment=O,hn.Profiler=L,hn.PureComponent=Wt,hn.StrictMode=A,hn.Suspense=G,hn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ne,hn.act=function(){throw Error("act(...) is not supported in production builds of React.")},hn.cache=function(at){return function(){return at.apply(null,arguments)}},hn.cloneElement=function(at,Ft,he){if(at==null)throw Error("The argument must be a React element, but you passed "+at+".");var jt=st({},at.props),Zt=at.key,Lt=void 0;if(Ft!=null)for(Kt in Ft.ref!==void 0&&(Lt=void 0),Ft.key!==void 0&&(Zt=""+Ft.key),Ft)!_e.call(Ft,Kt)||Kt==="key"||Kt==="__self"||Kt==="__source"||Kt==="ref"&&Ft.ref===void 0||(jt[Kt]=Ft[Kt]);var Kt=arguments.length-2;if(Kt===1)jt.children=he;else if(1<Kt){for(var Re=Array(Kt),te=0;te<Kt;te++)Re[te]=arguments[te+2];jt.children=Re}return Ne(at.type,Zt,void 0,void 0,Lt,jt)},hn.createContext=function(at){return at={$$typeof:K,_currentValue:at,_currentValue2:at,_threadCount:0,Provider:null,Consumer:null},at.Provider=at,at.Consumer={$$typeof:U,_context:at},at},hn.createElement=function(at,Ft,he){var jt,Zt={},Lt=null;if(Ft!=null)for(jt in Ft.key!==void 0&&(Lt=""+Ft.key),Ft)_e.call(Ft,jt)&&jt!=="key"&&jt!=="__self"&&jt!=="__source"&&(Zt[jt]=Ft[jt]);var Kt=arguments.length-2;if(Kt===1)Zt.children=he;else if(1<Kt){for(var Re=Array(Kt),te=0;te<Kt;te++)Re[te]=arguments[te+2];Zt.children=Re}if(at&&at.defaultProps)for(jt in Kt=at.defaultProps,Kt)Zt[jt]===void 0&&(Zt[jt]=Kt[jt]);return Ne(at,Lt,void 0,void 0,null,Zt)},hn.createRef=function(){return{current:null}},hn.forwardRef=function(at){return{$$typeof:J,render:at}},hn.isValidElement=Xt,hn.lazy=function(at){return{$$typeof:rt,_payload:{_status:-1,_result:at},_init:Ee}},hn.memo=function(at,Ft){return{$$typeof:H,type:at,compare:Ft===void 0?null:Ft}},hn.startTransition=function(at){var Ft=ne.T,he={};ne.T=he;try{var jt=at(),Zt=ne.S;Zt!==null&&Zt(he,jt),typeof jt=="object"&&jt!==null&&typeof jt.then=="function"&&jt.then(be,se)}catch(Lt){se(Lt)}finally{ne.T=Ft}},hn.unstable_useCacheRefresh=function(){return ne.H.useCacheRefresh()},hn.use=function(at){return ne.H.use(at)},hn.useActionState=function(at,Ft,he){return ne.H.useActionState(at,Ft,he)},hn.useCallback=function(at,Ft){return ne.H.useCallback(at,Ft)},hn.useContext=function(at){return ne.H.useContext(at)},hn.useDebugValue=function(){},hn.useDeferredValue=function(at,Ft){return ne.H.useDeferredValue(at,Ft)},hn.useEffect=function(at,Ft){return ne.H.useEffect(at,Ft)},hn.useId=function(){return ne.H.useId()},hn.useImperativeHandle=function(at,Ft,he){return ne.H.useImperativeHandle(at,Ft,he)},hn.useInsertionEffect=function(at,Ft){return ne.H.useInsertionEffect(at,Ft)},hn.useLayoutEffect=function(at,Ft){return ne.H.useLayoutEffect(at,Ft)},hn.useMemo=function(at,Ft){return ne.H.useMemo(at,Ft)},hn.useOptimistic=function(at,Ft){return ne.H.useOptimistic(at,Ft)},hn.useReducer=function(at,Ft,he){return ne.H.useReducer(at,Ft,he)},hn.useRef=function(at){return ne.H.useRef(at)},hn.useState=function(at){return ne.H.useState(at)},hn.useSyncExternalStore=function(at,Ft,he){return ne.H.useSyncExternalStore(at,Ft,he)},hn.useTransition=function(){return ne.H.useTransition()},hn.version="19.0.0",hn}var jj;function rO(){return jj||(jj=1,xI.exports=fK()),xI.exports}var it=rO();const Nl=iO(it);var MI={exports:{}},Ly={},UI={exports:{}},jI={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vj;function mK(){return Vj||(Vj=1,function(E){function b(Ut,Ee){var se=Ut.length;Ut.push(Ee);t:for(;0<se;){var be=se-1>>>1,at=Ut[be];if(0<L(at,Ee))Ut[be]=Ee,Ut[se]=at,se=be;else break t}}function O(Ut){return Ut.length===0?null:Ut[0]}function A(Ut){if(Ut.length===0)return null;var Ee=Ut[0],se=Ut.pop();if(se!==Ee){Ut[0]=se;t:for(var be=0,at=Ut.length,Ft=at>>>1;be<Ft;){var he=2*(be+1)-1,jt=Ut[he],Zt=he+1,Lt=Ut[Zt];if(0>L(jt,se))Zt<at&&0>L(Lt,jt)?(Ut[be]=Lt,Ut[Zt]=se,be=Zt):(Ut[be]=jt,Ut[he]=se,be=he);else if(Zt<at&&0>L(Lt,se))Ut[be]=Lt,Ut[Zt]=se,be=Zt;else break t}}return Ee}function L(Ut,Ee){var se=Ut.sortIndex-Ee.sortIndex;return se!==0?se:Ut.id-Ee.id}if(E.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var U=performance;E.unstable_now=function(){return U.now()}}else{var K=Date,J=K.now();E.unstable_now=function(){return K.now()-J}}var G=[],H=[],rt=1,lt=null,dt=3,X=!1,st=!1,Ct=!1,yt=typeof setTimeout=="function"?setTimeout:null,It=typeof clearTimeout=="function"?clearTimeout:null,Wt=typeof setImmediate<"u"?setImmediate:null;function Rt(Ut){for(var Ee=O(H);Ee!==null;){if(Ee.callback===null)A(H);else if(Ee.startTime<=Ut)A(H),Ee.sortIndex=Ee.expirationTime,b(G,Ee);else break;Ee=O(H)}}function ye(Ut){if(Ct=!1,Rt(Ut),!st)if(O(G)!==null)st=!0,Gt();else{var Ee=O(H);Ee!==null&&me(ye,Ee.startTime-Ut)}}var ne=!1,_e=-1,Ne=5,Ie=-1;function Xt(){return!(E.unstable_now()-Ie<Ne)}function Qt(){if(ne){var Ut=E.unstable_now();Ie=Ut;var Ee=!0;try{t:{st=!1,Ct&&(Ct=!1,It(_e),_e=-1),X=!0;var se=dt;try{e:{for(Rt(Ut),lt=O(G);lt!==null&&!(lt.expirationTime>Ut&&Xt());){var be=lt.callback;if(typeof be=="function"){lt.callback=null,dt=lt.priorityLevel;var at=be(lt.expirationTime<=Ut);if(Ut=E.unstable_now(),typeof at=="function"){lt.callback=at,Rt(Ut),Ee=!0;break e}lt===O(G)&&A(G),Rt(Ut)}else A(G);lt=O(G)}if(lt!==null)Ee=!0;else{var Ft=O(H);Ft!==null&&me(ye,Ft.startTime-Ut),Ee=!1}}break t}finally{lt=null,dt=se,X=!1}Ee=void 0}}finally{Ee?Ae():ne=!1}}}var Ae;if(typeof Wt=="function")Ae=function(){Wt(Qt)};else if(typeof MessageChannel<"u"){var In=new MessageChannel,re=In.port2;In.port1.onmessage=Qt,Ae=function(){re.postMessage(null)}}else Ae=function(){yt(Qt,0)};function Gt(){ne||(ne=!0,Ae())}function me(Ut,Ee){_e=yt(function(){Ut(E.unstable_now())},Ee)}E.unstable_IdlePriority=5,E.unstable_ImmediatePriority=1,E.unstable_LowPriority=4,E.unstable_NormalPriority=3,E.unstable_Profiling=null,E.unstable_UserBlockingPriority=2,E.unstable_cancelCallback=function(Ut){Ut.callback=null},E.unstable_continueExecution=function(){st||X||(st=!0,Gt())},E.unstable_forceFrameRate=function(Ut){0>Ut||125<Ut?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ne=0<Ut?Math.floor(1e3/Ut):5},E.unstable_getCurrentPriorityLevel=function(){return dt},E.unstable_getFirstCallbackNode=function(){return O(G)},E.unstable_next=function(Ut){switch(dt){case 1:case 2:case 3:var Ee=3;break;default:Ee=dt}var se=dt;dt=Ee;try{return Ut()}finally{dt=se}},E.unstable_pauseExecution=function(){},E.unstable_requestPaint=function(){},E.unstable_runWithPriority=function(Ut,Ee){switch(Ut){case 1:case 2:case 3:case 4:case 5:break;default:Ut=3}var se=dt;dt=Ut;try{return Ee()}finally{dt=se}},E.unstable_scheduleCallback=function(Ut,Ee,se){var be=E.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?be+se:be):se=be,Ut){case 1:var at=-1;break;case 2:at=250;break;case 5:at=1073741823;break;case 4:at=1e4;break;default:at=5e3}return at=se+at,Ut={id:rt++,callback:Ee,priorityLevel:Ut,startTime:se,expirationTime:at,sortIndex:-1},se>be?(Ut.sortIndex=se,b(H,Ut),O(G)===null&&Ut===O(H)&&(Ct?(It(_e),_e=-1):Ct=!0,me(ye,se-be))):(Ut.sortIndex=at,b(G,Ut),st||X||(st=!0,Gt())),Ut},E.unstable_shouldYield=Xt,E.unstable_wrapCallback=function(Ut){var Ee=dt;return function(){var se=dt;dt=Ee;try{return Ut.apply(this,arguments)}finally{dt=se}}}}(jI)),jI}var Bj;function EK(){return Bj||(Bj=1,UI.exports=mK()),UI.exports}var VI={exports:{}},As={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fj;function _K(){if(Fj)return As;Fj=1;var E=rO();function b(G){var H="https://react.dev/errors/"+G;if(1<arguments.length){H+="?args[]="+encodeURIComponent(arguments[1]);for(var rt=2;rt<arguments.length;rt++)H+="&args[]="+encodeURIComponent(arguments[rt])}return"Minified React error #"+G+"; visit "+H+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function O(){}var A={d:{f:O,r:function(){throw Error(b(522))},D:O,C:O,L:O,m:O,X:O,S:O,M:O},p:0,findDOMNode:null},L=Symbol.for("react.portal");function U(G,H,rt){var lt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:L,key:lt==null?null:""+lt,children:G,containerInfo:H,implementation:rt}}var K=E.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function J(G,H){if(G==="font")return"";if(typeof H=="string")return H==="use-credentials"?H:""}return As.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,As.createPortal=function(G,H){var rt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!H||H.nodeType!==1&&H.nodeType!==9&&H.nodeType!==11)throw Error(b(299));return U(G,H,null,rt)},As.flushSync=function(G){var H=K.T,rt=A.p;try{if(K.T=null,A.p=2,G)return G()}finally{K.T=H,A.p=rt,A.d.f()}},As.preconnect=function(G,H){typeof G=="string"&&(H?(H=H.crossOrigin,H=typeof H=="string"?H==="use-credentials"?H:"":void 0):H=null,A.d.C(G,H))},As.prefetchDNS=function(G){typeof G=="string"&&A.d.D(G)},As.preinit=function(G,H){if(typeof G=="string"&&H&&typeof H.as=="string"){var rt=H.as,lt=J(rt,H.crossOrigin),dt=typeof H.integrity=="string"?H.integrity:void 0,X=typeof H.fetchPriority=="string"?H.fetchPriority:void 0;rt==="style"?A.d.S(G,typeof H.precedence=="string"?H.precedence:void 0,{crossOrigin:lt,integrity:dt,fetchPriority:X}):rt==="script"&&A.d.X(G,{crossOrigin:lt,integrity:dt,fetchPriority:X,nonce:typeof H.nonce=="string"?H.nonce:void 0})}},As.preinitModule=function(G,H){if(typeof G=="string")if(typeof H=="object"&&H!==null){if(H.as==null||H.as==="script"){var rt=J(H.as,H.crossOrigin);A.d.M(G,{crossOrigin:rt,integrity:typeof H.integrity=="string"?H.integrity:void 0,nonce:typeof H.nonce=="string"?H.nonce:void 0})}}else H==null&&A.d.M(G)},As.preload=function(G,H){if(typeof G=="string"&&typeof H=="object"&&H!==null&&typeof H.as=="string"){var rt=H.as,lt=J(rt,H.crossOrigin);A.d.L(G,rt,{crossOrigin:lt,integrity:typeof H.integrity=="string"?H.integrity:void 0,nonce:typeof H.nonce=="string"?H.nonce:void 0,type:typeof H.type=="string"?H.type:void 0,fetchPriority:typeof H.fetchPriority=="string"?H.fetchPriority:void 0,referrerPolicy:typeof H.referrerPolicy=="string"?H.referrerPolicy:void 0,imageSrcSet:typeof H.imageSrcSet=="string"?H.imageSrcSet:void 0,imageSizes:typeof H.imageSizes=="string"?H.imageSizes:void 0,media:typeof H.media=="string"?H.media:void 0})}},As.preloadModule=function(G,H){if(typeof G=="string")if(H){var rt=J(H.as,H.crossOrigin);A.d.m(G,{as:typeof H.as=="string"&&H.as!=="script"?H.as:void 0,crossOrigin:rt,integrity:typeof H.integrity=="string"?H.integrity:void 0})}else A.d.m(G)},As.requestFormReset=function(G){A.d.r(G)},As.unstable_batchedUpdates=function(G,H){return G(H)},As.useFormState=function(G,H,rt){return K.H.useFormState(G,H,rt)},As.useFormStatus=function(){return K.H.useHostTransitionStatus()},As.version="19.0.0",As}var Gj;function gK(){if(Gj)return VI.exports;Gj=1;function E(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(E)}catch(b){console.error(b)}}return E(),VI.exports=_K(),VI.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hj;function SK(){if(Hj)return Ly;Hj=1;var E=EK(),b=rO(),O=gK();function A(s){var o="https://react.dev/errors/"+s;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+s+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function L(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}var U=Symbol.for("react.element"),K=Symbol.for("react.transitional.element"),J=Symbol.for("react.portal"),G=Symbol.for("react.fragment"),H=Symbol.for("react.strict_mode"),rt=Symbol.for("react.profiler"),lt=Symbol.for("react.provider"),dt=Symbol.for("react.consumer"),X=Symbol.for("react.context"),st=Symbol.for("react.forward_ref"),Ct=Symbol.for("react.suspense"),yt=Symbol.for("react.suspense_list"),It=Symbol.for("react.memo"),Wt=Symbol.for("react.lazy"),Rt=Symbol.for("react.offscreen"),ye=Symbol.for("react.memo_cache_sentinel"),ne=Symbol.iterator;function _e(s){return s===null||typeof s!="object"?null:(s=ne&&s[ne]||s["@@iterator"],typeof s=="function"?s:null)}var Ne=Symbol.for("react.client.reference");function Ie(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===Ne?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case G:return"Fragment";case J:return"Portal";case rt:return"Profiler";case H:return"StrictMode";case Ct:return"Suspense";case yt:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case X:return(s.displayName||"Context")+".Provider";case dt:return(s._context.displayName||"Context")+".Consumer";case st:var o=s.render;return s=s.displayName,s||(s=o.displayName||o.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case It:return o=s.displayName||null,o!==null?o:Ie(s.type)||"Memo";case Wt:o=s._payload,s=s._init;try{return Ie(s(o))}catch{}}return null}var Xt=b.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Qt=Object.assign,Ae,In;function re(s){if(Ae===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);Ae=o&&o[1]||"",In=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ae+s+In}var Gt=!1;function me(s,o){if(!s||Gt)return"";Gt=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var $t=function(){throw Error()};if(Object.defineProperty($t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($t,[])}catch(Pt){var vt=Pt}Reflect.construct(s,[],$t)}else{try{$t.call()}catch(Pt){vt=Pt}s.call($t.prototype)}}else{try{throw Error()}catch(Pt){vt=Pt}($t=s())&&typeof $t.catch=="function"&&$t.catch(function(){})}}catch(Pt){if(Pt&&vt&&typeof Pt.stack=="string")return[Pt.stack,vt.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=f.DetermineComponentFrameRoot(),V=v[0],Y=v[1];if(V&&Y){var tt=V.split(`
`),ht=Y.split(`
`);for(_=f=0;f<tt.length&&!tt[f].includes("DetermineComponentFrameRoot");)f++;for(;_<ht.length&&!ht[_].includes("DetermineComponentFrameRoot");)_++;if(f===tt.length||_===ht.length)for(f=tt.length-1,_=ht.length-1;1<=f&&0<=_&&tt[f]!==ht[_];)_--;for(;1<=f&&0<=_;f--,_--)if(tt[f]!==ht[_]){if(f!==1||_!==1)do if(f--,_--,0>_||tt[f]!==ht[_]){var xt=`
`+tt[f].replace(" at new "," at ");return s.displayName&&xt.includes("<anonymous>")&&(xt=xt.replace("<anonymous>",s.displayName)),xt}while(1<=f&&0<=_);break}}}finally{Gt=!1,Error.prepareStackTrace=d}return(d=s?s.displayName||s.name:"")?re(d):""}function Ut(s){switch(s.tag){case 26:case 27:case 5:return re(s.type);case 16:return re("Lazy");case 13:return re("Suspense");case 19:return re("SuspenseList");case 0:case 15:return s=me(s.type,!1),s;case 11:return s=me(s.type.render,!1),s;case 1:return s=me(s.type,!0),s;default:return""}}function Ee(s){try{var o="";do o+=Ut(s),s=s.return;while(s);return o}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}function se(s){var o=s,d=s;if(s.alternate)for(;o.return;)o=o.return;else{s=o;do o=s,(o.flags&4098)!==0&&(d=o.return),s=o.return;while(s)}return o.tag===3?d:null}function be(s){if(s.tag===13){var o=s.memoizedState;if(o===null&&(s=s.alternate,s!==null&&(o=s.memoizedState)),o!==null)return o.dehydrated}return null}function at(s){if(se(s)!==s)throw Error(A(188))}function Ft(s){var o=s.alternate;if(!o){if(o=se(s),o===null)throw Error(A(188));return o!==s?null:s}for(var d=s,f=o;;){var _=d.return;if(_===null)break;var v=_.alternate;if(v===null){if(f=_.return,f!==null){d=f;continue}break}if(_.child===v.child){for(v=_.child;v;){if(v===d)return at(_),s;if(v===f)return at(_),o;v=v.sibling}throw Error(A(188))}if(d.return!==f.return)d=_,f=v;else{for(var V=!1,Y=_.child;Y;){if(Y===d){V=!0,d=_,f=v;break}if(Y===f){V=!0,f=_,d=v;break}Y=Y.sibling}if(!V){for(Y=v.child;Y;){if(Y===d){V=!0,d=v,f=_;break}if(Y===f){V=!0,f=v,d=_;break}Y=Y.sibling}if(!V)throw Error(A(189))}}if(d.alternate!==f)throw Error(A(190))}if(d.tag!==3)throw Error(A(188));return d.stateNode.current===d?s:o}function he(s){var o=s.tag;if(o===5||o===26||o===27||o===6)return s;for(s=s.child;s!==null;){if(o=he(s),o!==null)return o;s=s.sibling}return null}var jt=Array.isArray,Zt=O.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Lt={pending:!1,data:null,method:null,action:null},Kt=[],Re=-1;function te(s){return{current:s}}function ce(s){0>Re||(s.current=Kt[Re],Kt[Re]=null,Re--)}function ie(s,o){Re++,Kt[Re]=s.current,s.current=o}var vn=te(null),Ue=te(null),pr=te(null),Di=te(null);function hs(s,o){switch(ie(pr,o),ie(Ue,s),ie(vn,null),s=o.nodeType,s){case 9:case 11:o=(o=o.documentElement)&&(o=o.namespaceURI)?uv(o):0;break;default:if(s=s===8?o.parentNode:o,o=s.tagName,s=s.namespaceURI)s=uv(s),o=hv(s,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}ce(vn),ie(vn,o)}function Li(){ce(vn),ce(Ue),ce(pr)}function ps(s){s.memoizedState!==null&&ie(Di,s);var o=vn.current,d=hv(o,s.type);o!==d&&(ie(Ue,s),ie(vn,d))}function rr(s){Ue.current===s&&(ce(vn),ce(Ue)),Di.current===s&&(ce(Di),xp._currentValue=Lt)}var fr=Object.prototype.hasOwnProperty,wc=E.unstable_scheduleCallback,sr=E.unstable_cancelCallback,Ur=E.unstable_shouldYield,pn=E.unstable_requestPaint,mi=E.unstable_now,Ha=E.unstable_getCurrentPriorityLevel,_a=E.unstable_ImmediatePriority,bn=E.unstable_UserBlockingPriority,Qn=E.unstable_NormalPriority,Md=E.unstable_LowPriority,Pl=E.unstable_IdlePriority,Ic=E.log,vr=E.unstable_setDisableYieldValue,Oc=null,br=null;function Wa(s){if(br&&typeof br.onCommitFiberRoot=="function")try{br.onCommitFiberRoot(Oc,s,void 0,(s.current.flags&128)===128)}catch{}}function Os(s){if(typeof Ic=="function"&&vr(s),br&&typeof br.setStrictMode=="function")try{br.setStrictMode(Oc,s)}catch{}}var $r=Math.clz32?Math.clz32:Lf,v_=Math.log,Nc=Math.LN2;function Lf(s){return s>>>=0,s===0?32:31-(v_(s)/Nc|0)|0}var Ys=128,Ud=4194304;function Lo(s){var o=s&42;if(o!==0)return o;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function jd(s,o){var d=s.pendingLanes;if(d===0)return 0;var f=0,_=s.suspendedLanes,v=s.pingedLanes,V=s.warmLanes;s=s.finishedLanes!==0;var Y=d&134217727;return Y!==0?(d=Y&~_,d!==0?f=Lo(d):(v&=Y,v!==0?f=Lo(v):s||(V=Y&~V,V!==0&&(f=Lo(V))))):(Y=d&~_,Y!==0?f=Lo(Y):v!==0?f=Lo(v):s||(V=d&~V,V!==0&&(f=Lo(V)))),f===0?0:o!==0&&o!==f&&(o&_)===0&&(_=f&-f,V=o&-o,_>=V||_===32&&(V&4194176)!==0)?o:f}function ga(s,o){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&o)===0}function b_(s,o){switch(s){case 1:case 2:case 4:case 8:return o+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Sa(){var s=Ys;return Ys<<=1,(Ys&4194176)===0&&(Ys=128),s}function Pf(){var s=Ud;return Ud<<=1,(Ud&62914560)===0&&(Ud=4194304),s}function fh(s){for(var o=[],d=0;31>d;d++)o.push(s);return o}function kl(s,o){s.pendingLanes|=o,o!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function ts(s,o,d,f,_,v){var V=s.pendingLanes;s.pendingLanes=d,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=d,s.entangledLanes&=d,s.errorRecoveryDisabledLanes&=d,s.shellSuspendCounter=0;var Y=s.entanglements,tt=s.expirationTimes,ht=s.hiddenUpdates;for(d=V&~d;0<d;){var xt=31-$r(d),$t=1<<xt;Y[xt]=0,tt[xt]=-1;var vt=ht[xt];if(vt!==null)for(ht[xt]=null,xt=0;xt<vt.length;xt++){var Pt=vt[xt];Pt!==null&&(Pt.lane&=-536870913)}d&=~$t}f!==0&&kf(s,f,0),v!==0&&_===0&&s.tag!==0&&(s.suspendedLanes|=v&~(V&~o))}function kf(s,o,d){s.pendingLanes|=o,s.suspendedLanes&=~o;var f=31-$r(o);s.entangledLanes|=o,s.entanglements[f]=s.entanglements[f]|1073741824|d&4194218}function Vd(s,o){var d=s.entangledLanes|=o;for(s=s.entanglements;d;){var f=31-$r(d),_=1<<f;_&o|s[f]&o&&(s[f]|=o),d&=~_}}function xl(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function mh(){var s=Zt.p;return s!==0?s:(s=window.event,s===void 0?32:Nv(s.type))}function xf(s,o){var d=Zt.p;try{return Zt.p=s,o()}finally{Zt.p=d}}var ya=Math.random().toString(36).slice(2),mr="__reactFiber$"+ya,en="__reactProps$"+ya,Po="__reactContainer$"+ya,Eh="__reactEvents$"+ya,R_="__reactListeners$"+ya,Mf="__reactHandles$"+ya,Bd="__reactResources$"+ya,Dc="__reactMarker$"+ya;function qs(s){delete s[mr],delete s[en],delete s[Eh],delete s[R_],delete s[Mf]}function Ns(s){var o=s[mr];if(o)return o;for(var d=s.parentNode;d;){if(o=d[Po]||d[mr]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(s=mv(s);s!==null;){if(d=s[mr])return d;s=mv(s)}return o}s=d,d=s.parentNode}return null}function ko(s){if(s=s[mr]||s[Po]){var o=s.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return s}return null}function ar(s){var o=s.tag;if(o===5||o===26||o===27||o===6)return s.stateNode;throw Error(A(33))}function Zn(s){var o=s[Bd];return o||(o=s[Bd]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Yi(s){s[Dc]=!0}var yi=new Set,Uf={};function Ka(s,o){xo(s,o),xo(s+"Capture",o)}function xo(s,o){for(Uf[s]=o,s=0;s<o.length;s++)yi.add(o[s])}var Ta=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_h=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),gh={},Sh={};function jf(s){return fr.call(Sh,s)?!0:fr.call(gh,s)?!1:_h.test(s)?Sh[s]=!0:(gh[s]=!0,!1)}function Fd(s,o,d){if(jf(o))if(d===null)s.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":s.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){s.removeAttribute(o);return}}s.setAttribute(o,""+d)}}function Lc(s,o,d){if(d===null)s.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(o);return}s.setAttribute(o,""+d)}}function Rr(s,o,d,f){if(f===null)s.removeAttribute(d);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(d);return}s.setAttributeNS(o,d,""+f)}}function Cr(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function yh(s){var o=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function kn(s){var o=yh(s)?"checked":"value",d=Object.getOwnPropertyDescriptor(s.constructor.prototype,o),f=""+s[o];if(!s.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var _=d.get,v=d.set;return Object.defineProperty(s,o,{configurable:!0,get:function(){return _.call(this)},set:function(V){f=""+V,v.call(this,V)}}),Object.defineProperty(s,o,{enumerable:d.enumerable}),{getValue:function(){return f},setValue:function(V){f=""+V},stopTracking:function(){s._valueTracker=null,delete s[o]}}}}function Gd(s){s._valueTracker||(s._valueTracker=kn(s))}function Th(s){if(!s)return!1;var o=s._valueTracker;if(!o)return!0;var d=o.getValue(),f="";return s&&(f=yh(s)?s.checked?"true":"false":s.value),s=f,s!==d?(o.setValue(s),!0):!1}function za(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Hd=/[\n"\\]/g;function Ar(s){return s.replace(Hd,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Wd(s,o,d,f,_,v,V,Y){s.name="",V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?s.type=V:s.removeAttribute("type"),o!=null?V==="number"?(o===0&&s.value===""||s.value!=o)&&(s.value=""+Cr(o)):s.value!==""+Cr(o)&&(s.value=""+Cr(o)):V!=="submit"&&V!=="reset"||s.removeAttribute("value"),o!=null?vh(s,V,Cr(o)):d!=null?vh(s,V,Cr(d)):f!=null&&s.removeAttribute("value"),_==null&&v!=null&&(s.defaultChecked=!!v),_!=null&&(s.checked=_&&typeof _!="function"&&typeof _!="symbol"),Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"?s.name=""+Cr(Y):s.removeAttribute("name")}function Vf(s,o,d,f,_,v,V,Y){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(s.type=v),o!=null||d!=null){if(!(v!=="submit"&&v!=="reset"||o!=null))return;d=d!=null?""+Cr(d):"",o=o!=null?""+Cr(o):d,Y||o===s.value||(s.value=o),s.defaultValue=o}f=f??_,f=typeof f!="function"&&typeof f!="symbol"&&!!f,s.checked=Y?s.checked:!!f,s.defaultChecked=!!f,V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"&&(s.name=V)}function vh(s,o,d){o==="number"&&za(s.ownerDocument)===s||s.defaultValue===""+d||(s.defaultValue=""+d)}function Pc(s,o,d,f){if(s=s.options,o){o={};for(var _=0;_<d.length;_++)o["$"+d[_]]=!0;for(d=0;d<s.length;d++)_=o.hasOwnProperty("$"+s[d].value),s[d].selected!==_&&(s[d].selected=_),_&&f&&(s[d].defaultSelected=!0)}else{for(d=""+Cr(d),o=null,_=0;_<s.length;_++){if(s[_].value===d){s[_].selected=!0,f&&(s[_].defaultSelected=!0);return}o!==null||s[_].disabled||(o=s[_])}o!==null&&(o.selected=!0)}}function Ml(s,o,d){if(o!=null&&(o=""+Cr(o),o!==s.value&&(s.value=o),d==null)){s.defaultValue!==o&&(s.defaultValue=o);return}s.defaultValue=d!=null?""+Cr(d):""}function bh(s,o,d,f){if(o==null){if(f!=null){if(d!=null)throw Error(A(92));if(jt(f)){if(1<f.length)throw Error(A(93));f=f[0]}d=f}d==null&&(d=""),o=d}d=Cr(o),s.defaultValue=d,f=s.textContent,f===d&&f!==""&&f!==null&&(s.value=f)}function Ya(s,o){if(o){var d=s.firstChild;if(d&&d===s.lastChild&&d.nodeType===3){d.nodeValue=o;return}}s.textContent=o}var Bf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Kd(s,o,d){var f=o.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?f?s.setProperty(o,""):o==="float"?s.cssFloat="":s[o]="":f?s.setProperty(o,d):typeof d!="number"||d===0||Bf.has(o)?o==="float"?s.cssFloat=d:s[o]=(""+d).trim():s[o]=d+"px"}function Rh(s,o,d){if(o!=null&&typeof o!="object")throw Error(A(62));if(s=s.style,d!=null){for(var f in d)!d.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?s.setProperty(f,""):f==="float"?s.cssFloat="":s[f]="");for(var _ in o)f=o[_],o.hasOwnProperty(_)&&d[_]!==f&&Kd(s,_,f)}else for(var v in o)o.hasOwnProperty(v)&&Kd(s,v,o[v])}function zd(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var C_=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),kc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ul(s){return kc.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var Ch=null;function jl(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Mo=null,xc=null;function Ff(s){var o=ko(s);if(o&&(s=o.stateNode)){var d=s[en]||null;t:switch(s=o.stateNode,o.type){case"input":if(Wd(s,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),o=d.name,d.type==="radio"&&o!=null){for(d=s;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Ar(""+o)+'"][type="radio"]'),o=0;o<d.length;o++){var f=d[o];if(f!==s&&f.form===s.form){var _=f[en]||null;if(!_)throw Error(A(90));Wd(f,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(o=0;o<d.length;o++)f=d[o],f.form===s.form&&Th(f)}break t;case"textarea":Ml(s,d.value,d.defaultValue);break t;case"select":o=d.value,o!=null&&Pc(s,!!d.multiple,o,!1)}}}var Yd=!1;function Gf(s,o,d){if(Yd)return s(o,d);Yd=!0;try{var f=s(o);return f}finally{if(Yd=!1,(Mo!==null||xc!==null)&&(Xm(),Mo&&(o=Mo,s=xc,xc=Mo=null,Ff(o),s)))for(o=0;o<s.length;o++)Ff(s[o])}}function Vl(s,o){var d=s.stateNode;if(d===null)return null;var f=d[en]||null;if(f===null)return null;d=f[o];t:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break t;default:s=!1}if(s)return null;if(d&&typeof d!="function")throw Error(A(231,o,typeof d));return d}var Ah=!1;if(Ta)try{var jr={};Object.defineProperty(jr,"passive",{get:function(){Ah=!0}}),window.addEventListener("test",jr,jr),window.removeEventListener("test",jr,jr)}catch{Ah=!1}var qa=null,qd=null,Bl=null;function Hf(){if(Bl)return Bl;var s,o=qd,d=o.length,f,_="value"in qa?qa.value:qa.textContent,v=_.length;for(s=0;s<d&&o[s]===_[s];s++);var V=d-s;for(f=1;f<=V&&o[d-f]===_[v-f];f++);return Bl=_.slice(s,1<f?1-f:void 0)}function Fl(s){var o=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&o===13&&(s=13)):s=o,s===10&&(s=13),32<=s||s===13?s:0}function Xd(){return!0}function Wf(){return!1}function Vr(s){function o(d,f,_,v,V){this._reactName=d,this._targetInst=_,this.type=f,this.nativeEvent=v,this.target=V,this.currentTarget=null;for(var Y in s)s.hasOwnProperty(Y)&&(d=s[Y],this[Y]=d?d(v):v[Y]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Xd:Wf,this.isPropagationStopped=Wf,this}return Qt(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Xd)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Xd)},persist:function(){},isPersistent:Xd}),o}var Br={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wr=Vr(Br),Ds=Qt({},Br,{view:0,detail:0}),A_=Vr(Ds),wh,Jd,Pi,Ls=Qt({},Ds,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lh,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Pi&&(Pi&&s.type==="mousemove"?(wh=s.screenX-Pi.screenX,Jd=s.screenY-Pi.screenY):Jd=wh=0,Pi=s),wh)},movementY:function(s){return"movementY"in s?s.movementY:Jd}}),Kf=Vr(Ls),zf=Qt({},Ls,{dataTransfer:0}),Xa=Vr(zf),Yf=Qt({},Ds,{relatedTarget:0}),Ih=Vr(Yf),Oh=Qt({},Br,{animationName:0,elapsedTime:0,pseudoElement:0}),qf=Vr(Oh),Ja=Qt({},Br,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Nh=Vr(Ja),Dh=Qt({},Br,{data:0}),Xf=Vr(Dh),w_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qa={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Qd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function I_(s){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(s):(s=Qd[s])?!!o[s]:!1}function Lh(){return I_}var O_=Qt({},Ds,{key:function(s){if(s.key){var o=w_[s.key]||s.key;if(o!=="Unidentified")return o}return s.type==="keypress"?(s=Fl(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Qa[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lh,charCode:function(s){return s.type==="keypress"?Fl(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Fl(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),N_=Vr(O_),Zd=Qt({},Ls,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Za=Vr(Zd),D_=Qt({},Ds,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lh}),Mc=Vr(D_),Jf=Qt({},Br,{propertyName:0,elapsedTime:0,pseudoElement:0}),Qf=Vr(Jf),Qe=Qt({},Ls,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Ph=Vr(Qe),Zf=Qt({},Br,{newState:0,oldState:0}),$f=Vr(Zf),kh=[9,13,27,32],$a=Ta&&"CompositionEvent"in window,Gl=null;Ta&&"documentMode"in document&&(Gl=document.documentMode);var tm=Ta&&"TextEvent"in window&&!Gl,xh=Ta&&(!$a||Gl&&8<Gl&&11>=Gl),Hl=" ",Mh=!1;function Uh(s,o){switch(s){case"keyup":return kh.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $d(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Uo=!1;function Xs(s,o){switch(s){case"compositionend":return $d(o);case"keypress":return o.which!==32?null:(Mh=!0,Hl);case"textInput":return s=o.data,s===Hl&&Mh?null:s;default:return null}}function em(s,o){if(Uo)return s==="compositionend"||!$a&&Uh(s,o)?(s=Hf(),Bl=qd=qa=null,Uo=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return xh&&o.locale!=="ko"?null:o.data;default:return null}}var Uc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function nm(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o==="input"?!!Uc[s.type]:o==="textarea"}function jh(s,o,d,f){Mo?xc?xc.push(f):xc=[f]:Mo=f,o=Dp(o,"onChange"),0<o.length&&(d=new wr("onChange","change",null,d,f),s.push({event:d,listeners:o}))}var jo=null,jc=null;function im(s){dv(s,0)}function Er(s){var o=ar(s);if(Th(o))return s}function rm(s,o){if(s==="change")return o}var sm=!1;if(Ta){var Vh;if(Ta){var tu="oninput"in document;if(!tu){var eu=document.createElement("div");eu.setAttribute("oninput","return;"),tu=typeof eu.oninput=="function"}Vh=tu}else Vh=!1;sm=Vh&&(!document.documentMode||9<document.documentMode)}function am(){jo&&(jo.detachEvent("onpropertychange",Bh),jc=jo=null)}function Bh(s){if(s.propertyName==="value"&&Er(jc)){var o=[];jh(o,jc,s,jl(s)),Gf(im,o)}}function om(s,o,d){s==="focusin"?(am(),jo=o,jc=d,jo.attachEvent("onpropertychange",Bh)):s==="focusout"&&am()}function nu(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Er(jc)}function Fh(s,o){if(s==="click")return Er(o)}function L_(s,o){if(s==="input"||s==="change")return Er(o)}function iu(s,o){return s===o&&(s!==0||1/s===1/o)||s!==s&&o!==o}var es=typeof Object.is=="function"?Object.is:iu;function Wl(s,o){if(es(s,o))return!0;if(typeof s!="object"||s===null||typeof o!="object"||o===null)return!1;var d=Object.keys(s),f=Object.keys(o);if(d.length!==f.length)return!1;for(f=0;f<d.length;f++){var _=d[f];if(!fr.call(o,_)||!es(s[_],o[_]))return!1}return!0}function Kl(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Ps(s,o){var d=Kl(s);s=0;for(var f;d;){if(d.nodeType===3){if(f=s+d.textContent.length,s<=o&&f>=o)return{node:d,offset:o-s};s=f}t:{for(;d;){if(d.nextSibling){d=d.nextSibling;break t}d=d.parentNode}d=void 0}d=Kl(d)}}function cm(s,o){return s&&o?s===o?!0:s&&s.nodeType===3?!1:o&&o.nodeType===3?cm(s,o.parentNode):"contains"in s?s.contains(o):s.compareDocumentPosition?!!(s.compareDocumentPosition(o)&16):!1:!1}function lm(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var o=za(s.document);o instanceof s.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)s=o.contentWindow;else break;o=za(s.document)}return o}function Ir(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o&&(o==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||o==="textarea"||s.contentEditable==="true")}function dm(s,o){var d=lm(o);o=s.focusedElem;var f=s.selectionRange;if(d!==o&&o&&o.ownerDocument&&cm(o.ownerDocument.documentElement,o)){if(f!==null&&Ir(o)){if(s=f.start,d=f.end,d===void 0&&(d=s),"selectionStart"in o)o.selectionStart=s,o.selectionEnd=Math.min(d,o.value.length);else if(d=(s=o.ownerDocument||document)&&s.defaultView||window,d.getSelection){d=d.getSelection();var _=o.textContent.length,v=Math.min(f.start,_);f=f.end===void 0?v:Math.min(f.end,_),!d.extend&&v>f&&(_=f,f=v,v=_),_=Ps(o,v);var V=Ps(o,f);_&&V&&(d.rangeCount!==1||d.anchorNode!==_.node||d.anchorOffset!==_.offset||d.focusNode!==V.node||d.focusOffset!==V.offset)&&(s=s.createRange(),s.setStart(_.node,_.offset),d.removeAllRanges(),v>f?(d.addRange(s),d.extend(V.node,V.offset)):(s.setEnd(V.node,V.offset),d.addRange(s)))}}for(s=[],d=o;d=d.parentNode;)d.nodeType===1&&s.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<s.length;o++)d=s[o],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var P_=Ta&&"documentMode"in document&&11>=document.documentMode,Vc=null,Gh=null,Bc=null,ru=!1;function Hh(s,o,d){var f=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;ru||Vc==null||Vc!==za(f)||(f=Vc,"selectionStart"in f&&Ir(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Bc&&Wl(Bc,f)||(Bc=f,f=Dp(Gh,"onSelect"),0<f.length&&(o=new wr("onSelect","select",null,o,d),s.push({event:o,listeners:f}),o.target=Vc)))}function Vo(s,o){var d={};return d[s.toLowerCase()]=o.toLowerCase(),d["Webkit"+s]="webkit"+o,d["Moz"+s]="moz"+o,d}var Bo={animationend:Vo("Animation","AnimationEnd"),animationiteration:Vo("Animation","AnimationIteration"),animationstart:Vo("Animation","AnimationStart"),transitionrun:Vo("Transition","TransitionRun"),transitionstart:Vo("Transition","TransitionStart"),transitioncancel:Vo("Transition","TransitionCancel"),transitionend:Vo("Transition","TransitionEnd")},Wh={},Kh={};Ta&&(Kh=document.createElement("div").style,"AnimationEvent"in window||(delete Bo.animationend.animation,delete Bo.animationiteration.animation,delete Bo.animationstart.animation),"TransitionEvent"in window||delete Bo.transitionend.transition);function ks(s){if(Wh[s])return Wh[s];if(!Bo[s])return s;var o=Bo[s],d;for(d in o)if(o.hasOwnProperty(d)&&d in Kh)return Wh[s]=o[d];return s}var su=ks("animationend"),um=ks("animationiteration"),At=ks("animationstart"),Xy=ks("transitionrun"),Jy=ks("transitionstart"),Qy=ks("transitioncancel"),hm=ks("transitionend"),pm=new Map,zh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function xs(s,o){pm.set(s,o),Ka(o,[s])}var fs=[],va=0,to=0;function au(){for(var s=va,o=to=va=0;o<s;){var d=fs[o];fs[o++]=null;var f=fs[o];fs[o++]=null;var _=fs[o];fs[o++]=null;var v=fs[o];if(fs[o++]=null,f!==null&&_!==null){var V=f.pending;V===null?_.next=_:(_.next=V.next,V.next=_),f.pending=_}v!==0&&cu(d,_,v)}}function ou(s,o,d,f){fs[va++]=s,fs[va++]=o,fs[va++]=d,fs[va++]=f,to|=f,s.lanes|=f,s=s.alternate,s!==null&&(s.lanes|=f)}function Yh(s,o,d,f){return ou(s,o,d,f),Js(s)}function eo(s,o){return ou(s,null,null,o),Js(s)}function cu(s,o,d){s.lanes|=d;var f=s.alternate;f!==null&&(f.lanes|=d);for(var _=!1,v=s.return;v!==null;)v.childLanes|=d,f=v.alternate,f!==null&&(f.childLanes|=d),v.tag===22&&(s=v.stateNode,s===null||s._visibility&1||(_=!0)),s=v,v=v.return;_&&o!==null&&s.tag===3&&(v=s.stateNode,_=31-$r(d),v=v.hiddenUpdates,s=v[_],s===null?v[_]=[o]:s.push(o),o.lane=d|536870912)}function Js(s){if(50<rd)throw rd=0,Au=null,Error(A(185));for(var o=s.return;o!==null;)s=o,o=s.return;return s.tag===3?s.stateNode:null}var no={},ms=new WeakMap;function Or(s,o){if(typeof s=="object"&&s!==null){var d=ms.get(s);return d!==void 0?d:(o={value:s,source:o,stack:Ee(o)},ms.set(s,o),o)}return{value:s,source:o,stack:Ee(o)}}var Qs=[],Fc=0,lu=null,zl=0,ns=[],Es=0,Fo=null,qi=1,Fr="";function zn(s,o){Qs[Fc++]=zl,Qs[Fc++]=lu,lu=s,zl=o}function qh(s,o,d){ns[Es++]=qi,ns[Es++]=Fr,ns[Es++]=Fo,Fo=s;var f=qi;s=Fr;var _=32-$r(f)-1;f&=~(1<<_),d+=1;var v=32-$r(o)+_;if(30<v){var V=_-_%5;v=(f&(1<<V)-1).toString(32),f>>=V,_-=V,qi=1<<32-$r(o)+_|d<<_|f,Fr=v+s}else qi=1<<v|d<<_|f,Fr=s}function du(s){s.return!==null&&(zn(s,1),qh(s,1,0))}function Xh(s){for(;s===lu;)lu=Qs[--Fc],Qs[Fc]=null,zl=Qs[--Fc],Qs[Fc]=null;for(;s===Fo;)Fo=ns[--Es],ns[Es]=null,Fr=ns[--Es],ns[Es]=null,qi=ns[--Es],ns[Es]=null}var _r=null,ki=null,On=!1,Ms=null,Zs=!1,Gc=Error(A(519));function y(s){var o=Error(A(418,""));throw oe(Or(o,s)),Gc}function I(s){var o=s.stateNode,d=s.type,f=s.memoizedProps;switch(o[mr]=s,o[en]=f,d){case"dialog":Cn("cancel",o),Cn("close",o);break;case"iframe":case"object":case"embed":Cn("load",o);break;case"video":case"audio":for(d=0;d<cd.length;d++)Cn(cd[d],o);break;case"source":Cn("error",o);break;case"img":case"image":case"link":Cn("error",o),Cn("load",o);break;case"details":Cn("toggle",o);break;case"input":Cn("invalid",o),Vf(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),Gd(o);break;case"select":Cn("invalid",o);break;case"textarea":Cn("invalid",o),bh(o,f.value,f.defaultValue,f.children),Gd(o)}d=f.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||o.textContent===""+d||f.suppressHydrationWarning===!0||eS(o.textContent,d)?(f.popover!=null&&(Cn("beforetoggle",o),Cn("toggle",o)),f.onScroll!=null&&Cn("scroll",o),f.onScrollEnd!=null&&Cn("scrollend",o),f.onClick!=null&&(o.onclick=sE),o=!0):o=!1,o||y(s)}function j(s){for(_r=s.return;_r;)switch(_r.tag){case 3:case 27:Zs=!0;return;case 5:case 13:Zs=!1;return;default:_r=_r.return}}function Q(s){if(s!==_r)return!1;if(!On)return j(s),On=!0,!1;var o=!1,d;if((d=s.tag!==3&&s.tag!==27)&&((d=s.tag===5)&&(d=s.type,d=!(d!=="form"&&d!=="button")||sS(s.type,s.memoizedProps)),d=!d),d&&(o=!0),o&&ki&&y(s),j(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(A(317));t:{for(s=s.nextSibling,o=0;s;){if(s.nodeType===8)if(d=s.data,d==="/$"){if(o===0){ki=na(s.nextSibling);break t}o--}else d!=="$"&&d!=="$!"&&d!=="$?"||o++;s=s.nextSibling}ki=null}}else ki=_r?na(s.stateNode.nextSibling):null;return!0}function Tt(){ki=_r=null,On=!1}function oe(s){Ms===null?Ms=[s]:Ms.push(s)}var ze=Error(A(460)),Sn=Error(A(474)),ri={then:function(){}};function Go(s){return s=s.status,s==="fulfilled"||s==="rejected"}function Hc(){}function Zy(s,o,d){switch(d=s[d],d===void 0?s.push(o):d!==o&&(o.then(Hc,Hc),o=d),o.status){case"fulfilled":return o.value;case"rejected":throw s=o.reason,s===ze?Error(A(483)):s;default:if(typeof o.status=="string")o.then(Hc,Hc);else{if(s=$n,s!==null&&100<s.shellSuspendCounter)throw Error(A(482));s=o,s.status="pending",s.then(function(f){if(o.status==="pending"){var _=o;_.status="fulfilled",_.value=f}},function(f){if(o.status==="pending"){var _=o;_.status="rejected",_.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw s=o.reason,s===ze?Error(A(483)):s}throw Jh=o,ze}}var Jh=null;function $y(){if(Jh===null)throw Error(A(459));var s=Jh;return Jh=null,s}var Ho=null,Wc=0;function uu(s){var o=Wc;return Wc+=1,Ho===null&&(Ho=[]),Zy(Ho,s,o)}function Qh(s,o){o=o.props.ref,s.ref=o!==void 0?o:null}function fm(s,o){throw o.$$typeof===U?Error(A(525)):(s=Object.prototype.toString.call(o),Error(A(31,s==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":s)))}function tT(s){var o=s._init;return o(s._payload)}function k_(s){function o(mt,ut){if(s){var gt=mt.deletions;gt===null?(mt.deletions=[ut],mt.flags|=16):gt.push(ut)}}function d(mt,ut){if(!s)return null;for(;ut!==null;)o(mt,ut),ut=ut.sibling;return null}function f(mt){for(var ut=new Map;mt!==null;)mt.key!==null?ut.set(mt.key,mt):ut.set(mt.index,mt),mt=mt.sibling;return ut}function _(mt,ut){return mt=ic(mt,ut),mt.index=0,mt.sibling=null,mt}function v(mt,ut,gt){return mt.index=gt,s?(gt=mt.alternate,gt!==null?(gt=gt.index,gt<ut?(mt.flags|=33554434,ut):gt):(mt.flags|=33554434,ut)):(mt.flags|=1048576,ut)}function V(mt){return s&&mt.alternate===null&&(mt.flags|=33554434),mt}function Y(mt,ut,gt,zt){return ut===null||ut.tag!==6?(ut=Mg(gt,mt.mode,zt),ut.return=mt,ut):(ut=_(ut,gt),ut.return=mt,ut)}function tt(mt,ut,gt,zt){var Te=gt.type;return Te===G?xt(mt,ut,gt.props.children,zt,gt.key):ut!==null&&(ut.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===Wt&&tT(Te)===ut.type)?(ut=_(ut,gt.props),Qh(ut,gt),ut.return=mt,ut):(ut=Fm(gt.type,gt.key,gt.props,null,mt.mode,zt),Qh(ut,gt),ut.return=mt,ut)}function ht(mt,ut,gt,zt){return ut===null||ut.tag!==4||ut.stateNode.containerInfo!==gt.containerInfo||ut.stateNode.implementation!==gt.implementation?(ut=Ug(gt,mt.mode,zt),ut.return=mt,ut):(ut=_(ut,gt.children||[]),ut.return=mt,ut)}function xt(mt,ut,gt,zt,Te){return ut===null||ut.tag!==7?(ut=el(gt,mt.mode,zt,Te),ut.return=mt,ut):(ut=_(ut,gt),ut.return=mt,ut)}function $t(mt,ut,gt){if(typeof ut=="string"&&ut!==""||typeof ut=="number"||typeof ut=="bigint")return ut=Mg(""+ut,mt.mode,gt),ut.return=mt,ut;if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case K:return gt=Fm(ut.type,ut.key,ut.props,null,mt.mode,gt),Qh(gt,ut),gt.return=mt,gt;case J:return ut=Ug(ut,mt.mode,gt),ut.return=mt,ut;case Wt:var zt=ut._init;return ut=zt(ut._payload),$t(mt,ut,gt)}if(jt(ut)||_e(ut))return ut=el(ut,mt.mode,gt,null),ut.return=mt,ut;if(typeof ut.then=="function")return $t(mt,uu(ut),gt);if(ut.$$typeof===X)return $t(mt,fp(mt,ut),gt);fm(mt,ut)}return null}function vt(mt,ut,gt,zt){var Te=ut!==null?ut.key:null;if(typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint")return Te!==null?null:Y(mt,ut,""+gt,zt);if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case K:return gt.key===Te?tt(mt,ut,gt,zt):null;case J:return gt.key===Te?ht(mt,ut,gt,zt):null;case Wt:return Te=gt._init,gt=Te(gt._payload),vt(mt,ut,gt,zt)}if(jt(gt)||_e(gt))return Te!==null?null:xt(mt,ut,gt,zt,null);if(typeof gt.then=="function")return vt(mt,ut,uu(gt),zt);if(gt.$$typeof===X)return vt(mt,ut,fp(mt,gt),zt);fm(mt,gt)}return null}function Pt(mt,ut,gt,zt,Te){if(typeof zt=="string"&&zt!==""||typeof zt=="number"||typeof zt=="bigint")return mt=mt.get(gt)||null,Y(ut,mt,""+zt,Te);if(typeof zt=="object"&&zt!==null){switch(zt.$$typeof){case K:return mt=mt.get(zt.key===null?gt:zt.key)||null,tt(ut,mt,zt,Te);case J:return mt=mt.get(zt.key===null?gt:zt.key)||null,ht(ut,mt,zt,Te);case Wt:var Me=zt._init;return zt=Me(zt._payload),Pt(mt,ut,gt,zt,Te)}if(jt(zt)||_e(zt))return mt=mt.get(gt)||null,xt(ut,mt,zt,Te,null);if(typeof zt.then=="function")return Pt(mt,ut,gt,uu(zt),Te);if(zt.$$typeof===X)return Pt(mt,ut,gt,fp(ut,zt),Te);fm(ut,zt)}return null}function Ce(mt,ut,gt,zt){for(var Te=null,Me=null,Oe=ut,je=ut=0,Qi=null;Oe!==null&&je<gt.length;je++){Oe.index>je?(Qi=Oe,Oe=null):Qi=Oe.sibling;var xn=vt(mt,Oe,gt[je],zt);if(xn===null){Oe===null&&(Oe=Qi);break}s&&Oe&&xn.alternate===null&&o(mt,Oe),ut=v(xn,ut,je),Me===null?Te=xn:Me.sibling=xn,Me=xn,Oe=Qi}if(je===gt.length)return d(mt,Oe),On&&zn(mt,je),Te;if(Oe===null){for(;je<gt.length;je++)Oe=$t(mt,gt[je],zt),Oe!==null&&(ut=v(Oe,ut,je),Me===null?Te=Oe:Me.sibling=Oe,Me=Oe);return On&&zn(mt,je),Te}for(Oe=f(Oe);je<gt.length;je++)Qi=Pt(Oe,mt,je,gt[je],zt),Qi!==null&&(s&&Qi.alternate!==null&&Oe.delete(Qi.key===null?je:Qi.key),ut=v(Qi,ut,je),Me===null?Te=Qi:Me.sibling=Qi,Me=Qi);return s&&Oe.forEach(function(Fs){return o(mt,Fs)}),On&&zn(mt,je),Te}function Je(mt,ut,gt,zt){if(gt==null)throw Error(A(151));for(var Te=null,Me=null,Oe=ut,je=ut=0,Qi=null,xn=gt.next();Oe!==null&&!xn.done;je++,xn=gt.next()){Oe.index>je?(Qi=Oe,Oe=null):Qi=Oe.sibling;var Fs=vt(mt,Oe,xn.value,zt);if(Fs===null){Oe===null&&(Oe=Qi);break}s&&Oe&&Fs.alternate===null&&o(mt,Oe),ut=v(Fs,ut,je),Me===null?Te=Fs:Me.sibling=Fs,Me=Fs,Oe=Qi}if(xn.done)return d(mt,Oe),On&&zn(mt,je),Te;if(Oe===null){for(;!xn.done;je++,xn=gt.next())xn=$t(mt,xn.value,zt),xn!==null&&(ut=v(xn,ut,je),Me===null?Te=xn:Me.sibling=xn,Me=xn);return On&&zn(mt,je),Te}for(Oe=f(Oe);!xn.done;je++,xn=gt.next())xn=Pt(Oe,mt,je,xn.value,zt),xn!==null&&(s&&xn.alternate!==null&&Oe.delete(xn.key===null?je:xn.key),ut=v(xn,ut,je),Me===null?Te=xn:Me.sibling=xn,Me=xn);return s&&Oe.forEach(function(iC){return o(mt,iC)}),On&&zn(mt,je),Te}function vi(mt,ut,gt,zt){if(typeof gt=="object"&&gt!==null&&gt.type===G&&gt.key===null&&(gt=gt.props.children),typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case K:t:{for(var Te=gt.key;ut!==null;){if(ut.key===Te){if(Te=gt.type,Te===G){if(ut.tag===7){d(mt,ut.sibling),zt=_(ut,gt.props.children),zt.return=mt,mt=zt;break t}}else if(ut.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===Wt&&tT(Te)===ut.type){d(mt,ut.sibling),zt=_(ut,gt.props),Qh(zt,gt),zt.return=mt,mt=zt;break t}d(mt,ut);break}else o(mt,ut);ut=ut.sibling}gt.type===G?(zt=el(gt.props.children,mt.mode,zt,gt.key),zt.return=mt,mt=zt):(zt=Fm(gt.type,gt.key,gt.props,null,mt.mode,zt),Qh(zt,gt),zt.return=mt,mt=zt)}return V(mt);case J:t:{for(Te=gt.key;ut!==null;){if(ut.key===Te)if(ut.tag===4&&ut.stateNode.containerInfo===gt.containerInfo&&ut.stateNode.implementation===gt.implementation){d(mt,ut.sibling),zt=_(ut,gt.children||[]),zt.return=mt,mt=zt;break t}else{d(mt,ut);break}else o(mt,ut);ut=ut.sibling}zt=Ug(gt,mt.mode,zt),zt.return=mt,mt=zt}return V(mt);case Wt:return Te=gt._init,gt=Te(gt._payload),vi(mt,ut,gt,zt)}if(jt(gt))return Ce(mt,ut,gt,zt);if(_e(gt)){if(Te=_e(gt),typeof Te!="function")throw Error(A(150));return gt=Te.call(gt),Je(mt,ut,gt,zt)}if(typeof gt.then=="function")return vi(mt,ut,uu(gt),zt);if(gt.$$typeof===X)return vi(mt,ut,fp(mt,gt),zt);fm(mt,gt)}return typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint"?(gt=""+gt,ut!==null&&ut.tag===6?(d(mt,ut.sibling),zt=_(ut,gt),zt.return=mt,mt=zt):(d(mt,ut),zt=Mg(gt,mt.mode,zt),zt.return=mt,mt=zt),V(mt)):d(mt,ut)}return function(mt,ut,gt,zt){try{Wc=0;var Te=vi(mt,ut,gt,zt);return Ho=null,Te}catch(Oe){if(Oe===ze)throw Oe;var Me=Vs(29,Oe,null,mt.mode);return Me.lanes=zt,Me.return=mt,Me}finally{}}}var Kc=k_(!0),mm=k_(!1),hu=te(null),Em=te(0);function pu(s,o){s=Ia,ie(Em,s),ie(hu,o),Ia=s|o.baseLanes}function x_(){ie(Em,Ia),ie(hu,hu.current)}function M_(){Ia=Em.current,ce(hu),ce(Em)}var $s=te(null),io=null;function zc(s){var o=s.alternate;ie(or,or.current&1),ie($s,s),io===null&&(o===null||hu.current!==null||o.memoizedState!==null)&&(io=s)}function eT(s){if(s.tag===22){if(ie(or,or.current),ie($s,s),io===null){var o=s.alternate;o!==null&&o.memoizedState!==null&&(io=s)}}else Wo()}function Wo(){ie(or,or.current),ie($s,$s.current)}function Ko(s){ce($s),io===s&&(io=null),ce(or)}var or=te(0);function _m(s){for(var o=s;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var U_=typeof AbortController<"u"?AbortController:function(){var s=[],o=this.signal={aborted:!1,addEventListener:function(d,f){s.push(f)}};this.abort=function(){o.aborted=!0,s.forEach(function(d){return d()})}},g0=E.unstable_scheduleCallback,S0=E.unstable_NormalPriority,xi={$$typeof:X,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function j_(){return{controller:new U_,data:new Map,refCount:0}}function Zh(s){s.refCount--,s.refCount===0&&g0(S0,function(){s.controller.abort()})}var $h=null,V_=0,fu=0,mu=null;function gm(s,o){if($h===null){var d=$h=[];V_=0,fu=Xg(),mu={status:"pending",value:void 0,then:function(f){d.push(f)}}}return V_++,o.then(B_,B_),o}function B_(){if(--V_===0&&$h!==null){mu!==null&&(mu.status="fulfilled");var s=$h;$h=null,fu=0,mu=null;for(var o=0;o<s.length;o++)(0,s[o])()}}function y0(s,o){var d=[],f={status:"pending",value:null,reason:null,then:function(_){d.push(_)}};return s.then(function(){f.status="fulfilled",f.value=o;for(var _=0;_<d.length;_++)(0,d[_])(o)},function(_){for(f.status="rejected",f.reason=_,_=0;_<d.length;_++)(0,d[_])(void 0)}),f}var nT=Xt.S;Xt.S=function(s,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&gm(s,o),nT!==null&&nT(s,o)};var Yc=te(null);function F_(){var s=Yc.current;return s!==null?s:$n.pooledCache}function Sm(s,o){o===null?ie(Yc,Yc.current):ie(Yc,o.pool)}function iT(){var s=F_();return s===null?null:{parent:xi._currentValue,pool:s}}var ro=0,rn=null,Yn=null,Mi=null,tp=!1,Yl=!1,so=!1,qc=0,ep=0,Eu=null,rT=0;function Bi(){throw Error(A(321))}function G_(s,o){if(o===null)return!1;for(var d=0;d<o.length&&d<s.length;d++)if(!es(s[d],o[d]))return!1;return!0}function ym(s,o,d,f,_,v){return ro=v,rn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Xt.H=s===null||s.memoizedState===null?ql:Xc,so=!1,v=d(f,_),so=!1,Yl&&(v=aT(o,d,f,_)),sT(s),v}function sT(s){Xt.H=ba;var o=Yn!==null&&Yn.next!==null;if(ro=0,Mi=Yn=rn=null,tp=!1,ep=0,Eu=null,o)throw Error(A(300));s===null||cr||(s=s.dependencies,s!==null&&Mm(s)&&(cr=!0))}function aT(s,o,d,f){rn=s;var _=0;do{if(Yl&&(Eu=null),ep=0,Yl=!1,25<=_)throw Error(A(301));if(_+=1,Mi=Yn=null,s.updateQueue!=null){var v=s.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}Xt.H=qo,v=o(d,f)}while(Yl);return v}function T0(){var s=Xt.H,o=s.useState()[0];return o=typeof o.then=="function"?np(o):o,s=s.useState()[0],(Yn!==null?Yn.memoizedState:null)!==s&&(rn.flags|=1024),o}function H_(){var s=qc!==0;return qc=0,s}function W_(s,o,d){o.updateQueue=s.updateQueue,o.flags&=-2053,s.lanes&=~d}function K_(s){if(tp){for(s=s.memoizedState;s!==null;){var o=s.queue;o!==null&&(o.pending=null),s=s.next}tp=!1}ro=0,Mi=Yn=rn=null,Yl=!1,ep=qc=0,Eu=null}function is(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mi===null?rn.memoizedState=Mi=s:Mi=Mi.next=s,Mi}function di(){if(Yn===null){var s=rn.alternate;s=s!==null?s.memoizedState:null}else s=Yn.next;var o=Mi===null?rn.memoizedState:Mi.next;if(o!==null)Mi=o,Yn=s;else{if(s===null)throw rn.alternate===null?Error(A(467)):Error(A(310));Yn=s,s={memoizedState:Yn.memoizedState,baseState:Yn.baseState,baseQueue:Yn.baseQueue,queue:Yn.queue,next:null},Mi===null?rn.memoizedState=Mi=s:Mi=Mi.next=s}return Mi}var Tm;Tm=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function np(s){var o=ep;return ep+=1,Eu===null&&(Eu=[]),s=Zy(Eu,s,o),o=rn,(Mi===null?o.memoizedState:Mi.next)===null&&(o=o.alternate,Xt.H=o===null||o.memoizedState===null?ql:Xc),s}function vm(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return np(s);if(s.$$typeof===X)return Nr(s)}throw Error(A(438,String(s)))}function bm(s){var o=null,d=rn.updateQueue;if(d!==null&&(o=d.memoCache),o==null){var f=rn.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(_){return _.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),d===null&&(d=Tm(),rn.updateQueue=d),d.memoCache=o,d=o.data[o.index],d===void 0)for(d=o.data[o.index]=Array(s),f=0;f<s;f++)d[f]=ye;return o.index++,d}function zo(s,o){return typeof o=="function"?o(s):o}function ip(s){var o=di();return z_(o,Yn,s)}function z_(s,o,d){var f=s.queue;if(f===null)throw Error(A(311));f.lastRenderedReducer=d;var _=s.baseQueue,v=f.pending;if(v!==null){if(_!==null){var V=_.next;_.next=v.next,v.next=V}o.baseQueue=_=v,f.pending=null}if(v=s.baseState,_===null)s.memoizedState=v;else{o=_.next;var Y=V=null,tt=null,ht=o,xt=!1;do{var $t=ht.lane&-536870913;if($t!==ht.lane?(Rn&$t)===$t:(ro&$t)===$t){var vt=ht.revertLane;if(vt===0)tt!==null&&(tt=tt.next={lane:0,revertLane:0,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null}),$t===fu&&(xt=!0);else if((ro&vt)===vt){ht=ht.next,vt===fu&&(xt=!0);continue}else $t={lane:0,revertLane:ht.revertLane,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null},tt===null?(Y=tt=$t,V=v):tt=tt.next=$t,rn.lanes|=vt,rc|=vt;$t=ht.action,so&&d(v,$t),v=ht.hasEagerState?ht.eagerState:d(v,$t)}else vt={lane:$t,revertLane:ht.revertLane,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null},tt===null?(Y=tt=vt,V=v):tt=tt.next=vt,rn.lanes|=$t,rc|=$t;ht=ht.next}while(ht!==null&&ht!==o);if(tt===null?V=v:tt.next=Y,!es(v,s.memoizedState)&&(cr=!0,xt&&(d=mu,d!==null)))throw d;s.memoizedState=v,s.baseState=V,s.baseQueue=tt,f.lastRenderedState=v}return _===null&&(f.lanes=0),[s.memoizedState,f.dispatch]}function Y_(s){var o=di(),d=o.queue;if(d===null)throw Error(A(311));d.lastRenderedReducer=s;var f=d.dispatch,_=d.pending,v=o.memoizedState;if(_!==null){d.pending=null;var V=_=_.next;do v=s(v,V.action),V=V.next;while(V!==_);es(v,o.memoizedState)||(cr=!0),o.memoizedState=v,o.baseQueue===null&&(o.baseState=v),d.lastRenderedState=v}return[v,f]}function oT(s,o,d){var f=rn,_=di(),v=On;if(v){if(d===void 0)throw Error(A(407));d=d()}else d=o();var V=!es((Yn||_).memoizedState,d);if(V&&(_.memoizedState=d,cr=!0),_=_.queue,Am(lT.bind(null,f,_,s),[s]),_.getSnapshot!==o||V||Mi!==null&&Mi.memoizedState.tag&1){if(f.flags|=2048,_u(9,cT.bind(null,f,_,d,o),{destroy:void 0},null),$n===null)throw Error(A(349));v||(ro&60)!==0||rp(f,o,d)}return d}function rp(s,o,d){s.flags|=16384,s={getSnapshot:o,value:d},o=rn.updateQueue,o===null?(o=Tm(),rn.updateQueue=o,o.stores=[s]):(d=o.stores,d===null?o.stores=[s]:d.push(s))}function cT(s,o,d,f){o.value=d,o.getSnapshot=f,dT(o)&&uT(s)}function lT(s,o,d){return d(function(){dT(o)&&uT(s)})}function dT(s){var o=s.getSnapshot;s=s.value;try{var d=o();return!es(s,d)}catch{return!0}}function uT(s){var o=eo(s,2);o!==null&&Ji(o,s,2)}function q_(s){var o=is();if(typeof s=="function"){var d=s;if(s=d(),so){Os(!0);try{d()}finally{Os(!1)}}}return o.memoizedState=o.baseState=s,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:zo,lastRenderedState:s},o}function hT(s,o,d,f){return s.baseState=d,z_(s,Yn,typeof f=="function"?f:zo)}function X_(s,o,d,f,_){if(Nm(s))throw Error(A(485));if(s=o.action,s!==null){var v={payload:_,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(V){v.listeners.push(V)}};Xt.T!==null?d(!0):v.isTransition=!1,f(v),d=o.pending,d===null?(v.next=o.pending=v,pT(o,v)):(v.next=d.next,o.pending=d.next=v)}}function pT(s,o){var d=o.action,f=o.payload,_=s.state;if(o.isTransition){var v=Xt.T,V={};Xt.T=V;try{var Y=d(_,f),tt=Xt.S;tt!==null&&tt(V,Y),J_(s,o,Y)}catch(ht){Rm(s,o,ht)}finally{Xt.T=v}}else try{v=d(_,f),J_(s,o,v)}catch(ht){Rm(s,o,ht)}}function J_(s,o,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(f){fT(s,o,f)},function(f){return Rm(s,o,f)}):fT(s,o,d)}function fT(s,o,d){o.status="fulfilled",o.value=d,mT(o),s.state=d,o=s.pending,o!==null&&(d=o.next,d===o?s.pending=null:(d=d.next,o.next=d,pT(s,d)))}function Rm(s,o,d){var f=s.pending;if(s.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=d,mT(o),o=o.next;while(o!==f)}s.action=null}function mT(s){s=s.listeners;for(var o=0;o<s.length;o++)(0,s[o])()}function ET(s,o){return o}function _T(s,o){if(On){var d=$n.formState;if(d!==null){t:{var f=rn;if(On){if(ki){e:{for(var _=ki,v=Zs;_.nodeType!==8;){if(!v){_=null;break e}if(_=na(_.nextSibling),_===null){_=null;break e}}v=_.data,_=v==="F!"||v==="F"?_:null}if(_){ki=na(_.nextSibling),f=_.data==="F!";break t}}y(f)}f=!1}f&&(o=d[0])}}return d=is(),d.memoizedState=d.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ET,lastRenderedState:o},d.queue=f,d=lp.bind(null,rn,f),f.dispatch=d,f=q_(!1),v=yu.bind(null,rn,!1,f.queue),f=is(),_={state:o,dispatch:null,action:s,pending:null},f.queue=_,d=X_.bind(null,rn,_,v,d),_.dispatch=d,f.memoizedState=s,[o,d,!1]}function gT(s){var o=di();return ST(o,Yn,s)}function ST(s,o,d){o=z_(s,o,ET)[0],s=ip(zo)[0],o=typeof o=="object"&&o!==null&&typeof o.then=="function"?np(o):o;var f=di(),_=f.queue,v=_.dispatch;return d!==f.memoizedState&&(rn.flags|=2048,_u(9,v0.bind(null,_,d),{destroy:void 0},null)),[o,v,s]}function v0(s,o){s.action=o}function Q_(s){var o=di(),d=Yn;if(d!==null)return ST(o,d,s);di(),o=o.memoizedState,d=di();var f=d.queue.dispatch;return d.memoizedState=s,[o,f,!1]}function _u(s,o,d,f){return s={tag:s,create:o,inst:d,deps:f,next:null},o=rn.updateQueue,o===null&&(o=Tm(),rn.updateQueue=o),d=o.lastEffect,d===null?o.lastEffect=s.next=s:(f=d.next,d.next=s,s.next=f,o.lastEffect=s),s}function yT(){return di().memoizedState}function sp(s,o,d,f){var _=is();rn.flags|=s,_.memoizedState=_u(1|o,d,{destroy:void 0},f===void 0?null:f)}function Cm(s,o,d,f){var _=di();f=f===void 0?null:f;var v=_.memoizedState.inst;Yn!==null&&f!==null&&G_(f,Yn.memoizedState.deps)?_.memoizedState=_u(o,d,v,f):(rn.flags|=s,_.memoizedState=_u(1|o,d,v,f))}function ap(s,o){sp(8390656,8,s,o)}function Am(s,o){Cm(2048,8,s,o)}function gu(s,o){return Cm(4,2,s,o)}function TT(s,o){return Cm(4,4,s,o)}function vT(s,o){if(typeof o=="function"){s=s();var d=o(s);return function(){typeof d=="function"?d():o(null)}}if(o!=null)return s=s(),o.current=s,function(){o.current=null}}function bT(s,o,d){d=d!=null?d.concat([s]):null,Cm(4,4,vT.bind(null,o,s),d)}function Z_(){}function op(s,o){var d=di();o=o===void 0?null:o;var f=d.memoizedState;return o!==null&&G_(o,f[1])?f[0]:(d.memoizedState=[s,o],s)}function RT(s,o){var d=di();o=o===void 0?null:o;var f=d.memoizedState;if(o!==null&&G_(o,f[1]))return f[0];if(f=s(),so){Os(!0);try{s()}finally{Os(!1)}}return d.memoizedState=[f,o],f}function wm(s,o,d){return d===void 0||(ro&1073741824)!==0?s.memoizedState=o:(s.memoizedState=d,s=Fg(),rn.lanes|=s,rc|=s,d)}function Im(s,o,d,f){return es(d,o)?d:hu.current!==null?(s=wm(s,d,f),es(s,o)||(cr=!0),s):(ro&42)===0?(cr=!0,s.memoizedState=d):(s=Fg(),rn.lanes|=s,rc|=s,o)}function Om(s,o,d,f,_){var v=Zt.p;Zt.p=v!==0&&8>v?v:8;var V=Xt.T,Y={};Xt.T=Y,yu(s,!1,o,d);try{var tt=_(),ht=Xt.S;if(ht!==null&&ht(Y,tt),tt!==null&&typeof tt=="object"&&typeof tt.then=="function"){var xt=y0(tt,f);Yo(s,o,xt,Kr(s))}else Yo(s,o,f,Kr(s))}catch($t){Yo(s,o,{then:function(){},status:"rejected",reason:$t},Kr())}finally{Zt.p=v,Xt.T=V}}function b0(){}function $_(s,o,d,f){if(s.tag!==5)throw Error(A(476));var _=CT(s).queue;Om(s,_,o,Lt,d===null?b0:function(){return AT(s),d(f)})}function CT(s){var o=s.memoizedState;if(o!==null)return o;o={memoizedState:Lt,baseState:Lt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:zo,lastRenderedState:Lt},next:null};var d={};return o.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:zo,lastRenderedState:d},next:null},s.memoizedState=o,s=s.alternate,s!==null&&(s.memoizedState=o),o}function AT(s){var o=CT(s).next.queue;Yo(s,o,{},Kr())}function tg(){return Nr(xp)}function cp(){return di().memoizedState}function wT(){return di().memoizedState}function Su(s){for(var o=s.return;o!==null;){switch(o.tag){case 24:case 3:var d=Kr();s=tc(d);var f=Ca(o,s,d);f!==null&&(Ji(f,o,d),vu(f,o,d)),o={cache:j_()},s.payload=o;return}o=o.return}}function eg(s,o,d){var f=Kr();d={lane:f,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null},Nm(s)?ng(o,d):(d=Yh(s,o,d,f),d!==null&&(Ji(d,s,f),IT(d,o,f)))}function lp(s,o,d){var f=Kr();Yo(s,o,d,f)}function Yo(s,o,d,f){var _={lane:f,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null};if(Nm(s))ng(o,_);else{var v=s.alternate;if(s.lanes===0&&(v===null||v.lanes===0)&&(v=o.lastRenderedReducer,v!==null))try{var V=o.lastRenderedState,Y=v(V,d);if(_.hasEagerState=!0,_.eagerState=Y,es(Y,V))return ou(s,o,_,0),$n===null&&au(),!1}catch{}finally{}if(d=Yh(s,o,_,f),d!==null)return Ji(d,s,f),IT(d,o,f),!0}return!1}function yu(s,o,d,f){if(f={lane:2,revertLane:Xg(),action:f,hasEagerState:!1,eagerState:null,next:null},Nm(s)){if(o)throw Error(A(479))}else o=Yh(s,d,f,2),o!==null&&Ji(o,s,2)}function Nm(s){var o=s.alternate;return s===rn||o!==null&&o===rn}function ng(s,o){Yl=tp=!0;var d=s.pending;d===null?o.next=o:(o.next=d.next,d.next=o),s.pending=o}function IT(s,o,d){if((d&4194176)!==0){var f=o.lanes;f&=s.pendingLanes,d|=f,o.lanes=d,Vd(s,d)}}var ba={readContext:Nr,use:vm,useCallback:Bi,useContext:Bi,useEffect:Bi,useImperativeHandle:Bi,useLayoutEffect:Bi,useInsertionEffect:Bi,useMemo:Bi,useReducer:Bi,useRef:Bi,useState:Bi,useDebugValue:Bi,useDeferredValue:Bi,useTransition:Bi,useSyncExternalStore:Bi,useId:Bi};ba.useCacheRefresh=Bi,ba.useMemoCache=Bi,ba.useHostTransitionStatus=Bi,ba.useFormState=Bi,ba.useActionState=Bi,ba.useOptimistic=Bi;var ql={readContext:Nr,use:vm,useCallback:function(s,o){return is().memoizedState=[s,o===void 0?null:o],s},useContext:Nr,useEffect:ap,useImperativeHandle:function(s,o,d){d=d!=null?d.concat([s]):null,sp(4194308,4,vT.bind(null,o,s),d)},useLayoutEffect:function(s,o){return sp(4194308,4,s,o)},useInsertionEffect:function(s,o){sp(4,2,s,o)},useMemo:function(s,o){var d=is();o=o===void 0?null:o;var f=s();if(so){Os(!0);try{s()}finally{Os(!1)}}return d.memoizedState=[f,o],f},useReducer:function(s,o,d){var f=is();if(d!==void 0){var _=d(o);if(so){Os(!0);try{d(o)}finally{Os(!1)}}}else _=o;return f.memoizedState=f.baseState=_,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:_},f.queue=s,s=s.dispatch=eg.bind(null,rn,s),[f.memoizedState,s]},useRef:function(s){var o=is();return s={current:s},o.memoizedState=s},useState:function(s){s=q_(s);var o=s.queue,d=lp.bind(null,rn,o);return o.dispatch=d,[s.memoizedState,d]},useDebugValue:Z_,useDeferredValue:function(s,o){var d=is();return wm(d,s,o)},useTransition:function(){var s=q_(!1);return s=Om.bind(null,rn,s.queue,!0,!1),is().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,o,d){var f=rn,_=is();if(On){if(d===void 0)throw Error(A(407));d=d()}else{if(d=o(),$n===null)throw Error(A(349));(Rn&60)!==0||rp(f,o,d)}_.memoizedState=d;var v={value:d,getSnapshot:o};return _.queue=v,ap(lT.bind(null,f,v,s),[s]),f.flags|=2048,_u(9,cT.bind(null,f,v,d,o),{destroy:void 0},null),d},useId:function(){var s=is(),o=$n.identifierPrefix;if(On){var d=Fr,f=qi;d=(f&~(1<<32-$r(f)-1)).toString(32)+d,o=":"+o+"R"+d,d=qc++,0<d&&(o+="H"+d.toString(32)),o+=":"}else d=rT++,o=":"+o+"r"+d.toString(32)+":";return s.memoizedState=o},useCacheRefresh:function(){return is().memoizedState=Su.bind(null,rn)}};ql.useMemoCache=bm,ql.useHostTransitionStatus=tg,ql.useFormState=_T,ql.useActionState=_T,ql.useOptimistic=function(s){var o=is();o.memoizedState=o.baseState=s;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=d,o=yu.bind(null,rn,!0,d),d.dispatch=o,[s,o]};var Xc={readContext:Nr,use:vm,useCallback:op,useContext:Nr,useEffect:Am,useImperativeHandle:bT,useInsertionEffect:gu,useLayoutEffect:TT,useMemo:RT,useReducer:ip,useRef:yT,useState:function(){return ip(zo)},useDebugValue:Z_,useDeferredValue:function(s,o){var d=di();return Im(d,Yn.memoizedState,s,o)},useTransition:function(){var s=ip(zo)[0],o=di().memoizedState;return[typeof s=="boolean"?s:np(s),o]},useSyncExternalStore:oT,useId:cp};Xc.useCacheRefresh=wT,Xc.useMemoCache=bm,Xc.useHostTransitionStatus=tg,Xc.useFormState=gT,Xc.useActionState=gT,Xc.useOptimistic=function(s,o){var d=di();return hT(d,Yn,s,o)};var qo={readContext:Nr,use:vm,useCallback:op,useContext:Nr,useEffect:Am,useImperativeHandle:bT,useInsertionEffect:gu,useLayoutEffect:TT,useMemo:RT,useReducer:Y_,useRef:yT,useState:function(){return Y_(zo)},useDebugValue:Z_,useDeferredValue:function(s,o){var d=di();return Yn===null?wm(d,s,o):Im(d,Yn.memoizedState,s,o)},useTransition:function(){var s=Y_(zo)[0],o=di().memoizedState;return[typeof s=="boolean"?s:np(s),o]},useSyncExternalStore:oT,useId:cp};qo.useCacheRefresh=wT,qo.useMemoCache=bm,qo.useHostTransitionStatus=tg,qo.useFormState=Q_,qo.useActionState=Q_,qo.useOptimistic=function(s,o){var d=di();return Yn!==null?hT(d,Yn,s,o):(d.baseState=s,[s,d.queue.dispatch])};function dp(s,o,d,f){o=s.memoizedState,d=d(f,o),d=d==null?o:Qt({},o,d),s.memoizedState=d,s.lanes===0&&(s.updateQueue.baseState=d)}var ig={isMounted:function(s){return(s=s._reactInternals)?se(s)===s:!1},enqueueSetState:function(s,o,d){s=s._reactInternals;var f=Kr(),_=tc(f);_.payload=o,d!=null&&(_.callback=d),o=Ca(s,_,f),o!==null&&(Ji(o,s,f),vu(o,s,f))},enqueueReplaceState:function(s,o,d){s=s._reactInternals;var f=Kr(),_=tc(f);_.tag=1,_.payload=o,d!=null&&(_.callback=d),o=Ca(s,_,f),o!==null&&(Ji(o,s,f),vu(o,s,f))},enqueueForceUpdate:function(s,o){s=s._reactInternals;var d=Kr(),f=tc(d);f.tag=2,o!=null&&(f.callback=o),o=Ca(s,f,d),o!==null&&(Ji(o,s,d),vu(o,s,d))}};function OT(s,o,d,f,_,v,V){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,v,V):o.prototype&&o.prototype.isPureReactComponent?!Wl(d,f)||!Wl(_,v):!0}function rg(s,o,d,f){s=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,f),o.state!==s&&ig.enqueueReplaceState(o,o.state,null)}function Xo(s,o){var d=o;if("ref"in o){d={};for(var f in o)f!=="ref"&&(d[f]=o[f])}if(s=s.defaultProps){d===o&&(d=Qt({},d));for(var _ in s)d[_]===void 0&&(d[_]=s[_])}return d}var Dm=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function Ra(s){Dm(s)}function Xl(s){console.error(s)}function Jc(s){Dm(s)}function up(s,o){try{var d=s.onUncaughtError;d(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function sg(s,o,d){try{var f=s.onCaughtError;f(d.value,{componentStack:d.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function Jo(s,o,d){return d=tc(d),d.tag=3,d.payload={element:null},d.callback=function(){up(s,o)},d}function Lm(s){return s=tc(s),s.tag=3,s}function NT(s,o,d,f){var _=d.type.getDerivedStateFromError;if(typeof _=="function"){var v=f.value;s.payload=function(){return _(v)},s.callback=function(){sg(o,d,f)}}var V=d.stateNode;V!==null&&typeof V.componentDidCatch=="function"&&(s.callback=function(){sg(o,d,f),typeof _!="function"&&(uo===null?uo=new Set([this]):uo.add(this));var Y=f.stack;this.componentDidCatch(f.value,{componentStack:Y!==null?Y:""})})}function DT(s,o,d,f,_){if(d.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=d.alternate,o!==null&&pp(o,d,_,!0),d=$s.current,d!==null){switch(d.tag){case 13:return io===null?Ap():d.alternate===null&&Ci===0&&(Ci=3),d.flags&=-257,d.flags|=65536,d.lanes=_,f===ri?d.flags|=16384:(o=d.updateQueue,o===null?d.updateQueue=new Set([f]):o.add(f),Hg(s,f,_)),!1;case 22:return d.flags|=65536,f===ri?d.flags|=16384:(o=d.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},d.updateQueue=o):(d=o.retryQueue,d===null?o.retryQueue=new Set([f]):d.add(f)),Hg(s,f,_)),!1}throw Error(A(435,d.tag))}return Hg(s,f,_),Ap(),!1}if(On)return o=$s.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=_,f!==Gc&&(s=Error(A(422),{cause:f}),oe(Or(s,d)))):(f!==Gc&&(o=Error(A(423),{cause:f}),oe(Or(o,d))),s=s.current.alternate,s.flags|=65536,_&=-_,s.lanes|=_,f=Or(f,d),_=Jo(s.stateNode,f,_),gg(s,_),Ci!==4&&(Ci=2)),!1;var v=Error(A(520),{cause:f});if(v=Or(v,d),Rp===null?Rp=[v]:Rp.push(v),Ci!==4&&(Ci=2),o===null)return!0;f=Or(f,d),d=o;do{switch(d.tag){case 3:return d.flags|=65536,s=_&-_,d.lanes|=s,s=Jo(d.stateNode,f,s),gg(d,s),!1;case 1:if(o=d.type,v=d.stateNode,(d.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(uo===null||!uo.has(v))))return d.flags|=65536,_&=-_,d.lanes|=_,_=Lm(_),NT(_,s,d,f),gg(d,_),!1}d=d.return}while(d!==null);return!1}var LT=Error(A(461)),cr=!1;function gr(s,o,d,f){o.child=s===null?mm(o,null,d,f):Kc(o,s.child,d,f)}function PT(s,o,d,f,_){d=d.render;var v=o.ref;if("ref"in f){var V={};for(var Y in f)Y!=="ref"&&(V[Y]=f[Y])}else V=f;return Ql(o),f=ym(s,o,d,V,v,_),Y=H_(),s!==null&&!cr?(W_(s,o,_),Gr(s,o,_)):(On&&Y&&du(o),o.flags|=1,gr(s,o,f,_),o.child)}function Qo(s,o,d,f,_){if(s===null){var v=d.type;return typeof v=="function"&&!kg(v)&&v.defaultProps===void 0&&d.compare===null?(o.tag=15,o.type=v,kT(s,o,v,f,_)):(s=Fm(d.type,null,f,o,o.mode,_),s.ref=o.ref,s.return=o,o.child=s)}if(v=s.child,!fg(s,_)){var V=v.memoizedProps;if(d=d.compare,d=d!==null?d:Wl,d(V,f)&&s.ref===o.ref)return Gr(s,o,_)}return o.flags|=1,s=ic(v,f),s.ref=o.ref,s.return=o,o.child=s}function kT(s,o,d,f,_){if(s!==null){var v=s.memoizedProps;if(Wl(v,f)&&s.ref===o.ref)if(cr=!1,o.pendingProps=f=v,fg(s,_))(s.flags&131072)!==0&&(cr=!0);else return o.lanes=s.lanes,Gr(s,o,_)}return Pm(s,o,d,f,_)}function xT(s,o,d){var f=o.pendingProps,_=f.children,v=(o.stateNode._pendingVisibility&2)!==0,V=s!==null?s.memoizedState:null;if(hp(s,o),f.mode==="hidden"||v){if((o.flags&128)!==0){if(f=V!==null?V.baseLanes|d:d,s!==null){for(_=o.child=s.child,v=0;_!==null;)v=v|_.lanes|_.childLanes,_=_.sibling;o.childLanes=v&~f}else o.childLanes=0,o.child=null;return MT(s,o,f,d)}if((d&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},s!==null&&Sm(o,V!==null?V.cachePool:null),V!==null?pu(o,V):x_(),eT(o);else return o.lanes=o.childLanes=536870912,MT(s,o,V!==null?V.baseLanes|d:d,d)}else V!==null?(Sm(o,V.cachePool),pu(o,V),Wo(),o.memoizedState=null):(s!==null&&Sm(o,null),x_(),Wo());return gr(s,o,_,d),o.child}function MT(s,o,d,f){var _=F_();return _=_===null?null:{parent:xi._currentValue,pool:_},o.memoizedState={baseLanes:d,cachePool:_},s!==null&&Sm(o,null),x_(),eT(o),s!==null&&pp(s,o,f,!0),null}function hp(s,o){var d=o.ref;if(d===null)s!==null&&s.ref!==null&&(o.flags|=2097664);else{if(typeof d!="function"&&typeof d!="object")throw Error(A(284));(s===null||s.ref!==d)&&(o.flags|=2097664)}}function Pm(s,o,d,f,_){return Ql(o),d=ym(s,o,d,f,void 0,_),f=H_(),s!==null&&!cr?(W_(s,o,_),Gr(s,o,_)):(On&&f&&du(o),o.flags|=1,gr(s,o,d,_),o.child)}function UT(s,o,d,f,_,v){return Ql(o),o.updateQueue=null,d=aT(o,f,d,_),sT(s),f=H_(),s!==null&&!cr?(W_(s,o,v),Gr(s,o,v)):(On&&f&&du(o),o.flags|=1,gr(s,o,d,v),o.child)}function km(s,o,d,f,_){if(Ql(o),o.stateNode===null){var v=no,V=d.contextType;typeof V=="object"&&V!==null&&(v=Nr(V)),v=new d(f,v),o.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=ig,o.stateNode=v,v._reactInternals=o,v=o.stateNode,v.props=f,v.state=o.memoizedState,v.refs={},Tu(o),V=d.contextType,v.context=typeof V=="object"&&V!==null?Nr(V):no,v.state=o.memoizedState,V=d.getDerivedStateFromProps,typeof V=="function"&&(dp(o,d,V,f),v.state=o.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(V=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),V!==v.state&&ig.enqueueReplaceState(v,v.state,null),Ep(o,f,v,_),Zl(),v.state=o.memoizedState),typeof v.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(s===null){v=o.stateNode;var Y=o.memoizedProps,tt=Xo(d,Y);v.props=tt;var ht=v.context,xt=d.contextType;V=no,typeof xt=="object"&&xt!==null&&(V=Nr(xt));var $t=d.getDerivedStateFromProps;xt=typeof $t=="function"||typeof v.getSnapshotBeforeUpdate=="function",Y=o.pendingProps!==Y,xt||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(Y||ht!==V)&&rg(o,v,f,V),Qc=!1;var vt=o.memoizedState;v.state=vt,Ep(o,f,v,_),Zl(),ht=o.memoizedState,Y||vt!==ht||Qc?(typeof $t=="function"&&(dp(o,d,$t,f),ht=o.memoizedState),(tt=Qc||OT(o,d,tt,f,vt,ht,V))?(xt||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(o.flags|=4194308)):(typeof v.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=ht),v.props=f,v.state=ht,v.context=V,f=tt):(typeof v.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{v=o.stateNode,mp(s,o),V=o.memoizedProps,xt=Xo(d,V),v.props=xt,$t=o.pendingProps,vt=v.context,ht=d.contextType,tt=no,typeof ht=="object"&&ht!==null&&(tt=Nr(ht)),Y=d.getDerivedStateFromProps,(ht=typeof Y=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(V!==$t||vt!==tt)&&rg(o,v,f,tt),Qc=!1,vt=o.memoizedState,v.state=vt,Ep(o,f,v,_),Zl();var Pt=o.memoizedState;V!==$t||vt!==Pt||Qc||s!==null&&s.dependencies!==null&&Mm(s.dependencies)?(typeof Y=="function"&&(dp(o,d,Y,f),Pt=o.memoizedState),(xt=Qc||OT(o,d,xt,f,vt,Pt,tt)||s!==null&&s.dependencies!==null&&Mm(s.dependencies))?(ht||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(f,Pt,tt),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(f,Pt,tt)),typeof v.componentDidUpdate=="function"&&(o.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof v.componentDidUpdate!="function"||V===s.memoizedProps&&vt===s.memoizedState||(o.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||V===s.memoizedProps&&vt===s.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=Pt),v.props=f,v.state=Pt,v.context=tt,f=xt):(typeof v.componentDidUpdate!="function"||V===s.memoizedProps&&vt===s.memoizedState||(o.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||V===s.memoizedProps&&vt===s.memoizedState||(o.flags|=1024),f=!1)}return v=f,hp(s,o),f=(o.flags&128)!==0,v||f?(v=o.stateNode,d=f&&typeof d.getDerivedStateFromError!="function"?null:v.render(),o.flags|=1,s!==null&&f?(o.child=Kc(o,s.child,null,_),o.child=Kc(o,null,d,_)):gr(s,o,d,_),o.memoizedState=v.state,s=o.child):s=Gr(s,o,_),s}function ag(s,o,d,f){return Tt(),o.flags|=256,gr(s,o,d,f),o.child}var og={dehydrated:null,treeContext:null,retryLane:0};function xm(s){return{baseLanes:s,cachePool:iT()}}function cg(s,o,d){return s=s!==null?s.childLanes&~d:0,o&&(s|=yr),s}function jT(s,o,d){var f=o.pendingProps,_=!1,v=(o.flags&128)!==0,V;if((V=v)||(V=s!==null&&s.memoizedState===null?!1:(or.current&2)!==0),V&&(_=!0,o.flags&=-129),V=(o.flags&32)!==0,o.flags&=-33,s===null){if(On){if(_?zc(o):Wo(),On){var Y=ki,tt;if(tt=Y){t:{for(tt=Y,Y=Zs;tt.nodeType!==8;){if(!Y){Y=null;break t}if(tt=na(tt.nextSibling),tt===null){Y=null;break t}}Y=tt}Y!==null?(o.memoizedState={dehydrated:Y,treeContext:Fo!==null?{id:qi,overflow:Fr}:null,retryLane:536870912},tt=Vs(18,null,null,0),tt.stateNode=Y,tt.return=o,o.child=tt,_r=o,ki=null,tt=!0):tt=!1}tt||y(o)}if(Y=o.memoizedState,Y!==null&&(Y=Y.dehydrated,Y!==null))return Y.data==="$!"?o.lanes=16:o.lanes=536870912,null;Ko(o)}return Y=f.children,f=f.fallback,_?(Wo(),_=o.mode,Y=dg({mode:"hidden",children:Y},_),f=el(f,_,d,null),Y.return=o,f.return=o,Y.sibling=f,o.child=Y,_=o.child,_.memoizedState=xm(d),_.childLanes=cg(s,V,d),o.memoizedState=og,f):(zc(o),lg(o,Y))}if(tt=s.memoizedState,tt!==null&&(Y=tt.dehydrated,Y!==null)){if(v)o.flags&256?(zc(o),o.flags&=-257,o=ug(s,o,d)):o.memoizedState!==null?(Wo(),o.child=s.child,o.flags|=128,o=null):(Wo(),_=f.fallback,Y=o.mode,f=dg({mode:"visible",children:f.children},Y),_=el(_,Y,d,null),_.flags|=2,f.return=o,_.return=o,f.sibling=_,o.child=f,Kc(o,s.child,null,d),f=o.child,f.memoizedState=xm(d),f.childLanes=cg(s,V,d),o.memoizedState=og,o=_);else if(zc(o),Y.data==="$!"){if(V=Y.nextSibling&&Y.nextSibling.dataset,V)var ht=V.dgst;V=ht,f=Error(A(419)),f.stack="",f.digest=V,oe({value:f,source:null,stack:null}),o=ug(s,o,d)}else if(cr||pp(s,o,d,!1),V=(d&s.childLanes)!==0,cr||V){if(V=$n,V!==null){if(f=d&-d,(f&42)!==0)f=1;else switch(f){case 2:f=1;break;case 8:f=4;break;case 32:f=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:f=64;break;case 268435456:f=134217728;break;default:f=0}if(f=(f&(V.suspendedLanes|d))!==0?0:f,f!==0&&f!==tt.retryLane)throw tt.retryLane=f,eo(s,f),Ji(V,s,f),LT}Y.data==="$?"||Ap(),o=ug(s,o,d)}else Y.data==="$?"?(o.flags|=128,o.child=s.child,o=L0.bind(null,s),Y._reactRetry=o,o=null):(s=tt.treeContext,ki=na(Y.nextSibling),_r=o,On=!0,Ms=null,Zs=!1,s!==null&&(ns[Es++]=qi,ns[Es++]=Fr,ns[Es++]=Fo,qi=s.id,Fr=s.overflow,Fo=o),o=lg(o,f.children),o.flags|=4096);return o}return _?(Wo(),_=f.fallback,Y=o.mode,tt=s.child,ht=tt.sibling,f=ic(tt,{mode:"hidden",children:f.children}),f.subtreeFlags=tt.subtreeFlags&31457280,ht!==null?_=ic(ht,_):(_=el(_,Y,d,null),_.flags|=2),_.return=o,f.return=o,f.sibling=_,o.child=f,f=_,_=o.child,Y=s.child.memoizedState,Y===null?Y=xm(d):(tt=Y.cachePool,tt!==null?(ht=xi._currentValue,tt=tt.parent!==ht?{parent:ht,pool:ht}:tt):tt=iT(),Y={baseLanes:Y.baseLanes|d,cachePool:tt}),_.memoizedState=Y,_.childLanes=cg(s,V,d),o.memoizedState=og,f):(zc(o),d=s.child,s=d.sibling,d=ic(d,{mode:"visible",children:f.children}),d.return=o,d.sibling=null,s!==null&&(V=o.deletions,V===null?(o.deletions=[s],o.flags|=16):V.push(s)),o.child=d,o.memoizedState=null,d)}function lg(s,o){return o=dg({mode:"visible",children:o},s.mode),o.return=s,s.child=o}function dg(s,o){return XT(s,o,0,null)}function ug(s,o,d){return Kc(o,s.child,null,d),s=lg(o,o.pendingProps.children),s.flags|=2,o.memoizedState=null,s}function VT(s,o,d){s.lanes|=o;var f=s.alternate;f!==null&&(f.lanes|=o),Eg(s.return,o,d)}function hg(s,o,d,f,_){var v=s.memoizedState;v===null?s.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:d,tailMode:_}:(v.isBackwards=o,v.rendering=null,v.renderingStartTime=0,v.last=f,v.tail=d,v.tailMode=_)}function pg(s,o,d){var f=o.pendingProps,_=f.revealOrder,v=f.tail;if(gr(s,o,f.children,d),f=or.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(s!==null&&(s.flags&128)!==0)t:for(s=o.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&VT(s,d,o);else if(s.tag===19)VT(s,d,o);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===o)break t;for(;s.sibling===null;){if(s.return===null||s.return===o)break t;s=s.return}s.sibling.return=s.return,s=s.sibling}f&=1}switch(ie(or,f),_){case"forwards":for(d=o.child,_=null;d!==null;)s=d.alternate,s!==null&&_m(s)===null&&(_=d),d=d.sibling;d=_,d===null?(_=o.child,o.child=null):(_=d.sibling,d.sibling=null),hg(o,!1,_,d,v);break;case"backwards":for(d=null,_=o.child,o.child=null;_!==null;){if(s=_.alternate,s!==null&&_m(s)===null){o.child=_;break}s=_.sibling,_.sibling=d,d=_,_=s}hg(o,!0,d,null,v);break;case"together":hg(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Gr(s,o,d){if(s!==null&&(o.dependencies=s.dependencies),rc|=o.lanes,(d&o.childLanes)===0)if(s!==null){if(pp(s,o,d,!1),(d&o.childLanes)===0)return null}else return null;if(s!==null&&o.child!==s.child)throw Error(A(153));if(o.child!==null){for(s=o.child,d=ic(s,s.pendingProps),o.child=d,d.return=o;s.sibling!==null;)s=s.sibling,d=d.sibling=ic(s,s.pendingProps),d.return=o;d.sibling=null}return o.child}function fg(s,o){return(s.lanes&o)!==0?!0:(s=s.dependencies,!!(s!==null&&Mm(s)))}function R0(s,o,d){switch(o.tag){case 3:hs(o,o.stateNode.containerInfo),ao(o,xi,s.memoizedState.cache),Tt();break;case 27:case 5:ps(o);break;case 4:hs(o,o.stateNode.containerInfo);break;case 10:ao(o,o.type,o.memoizedProps.value);break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(zc(o),o.flags|=128,null):(d&o.child.childLanes)!==0?jT(s,o,d):(zc(o),s=Gr(s,o,d),s!==null?s.sibling:null);zc(o);break;case 19:var _=(s.flags&128)!==0;if(f=(d&o.childLanes)!==0,f||(pp(s,o,d,!1),f=(d&o.childLanes)!==0),_){if(f)return pg(s,o,d);o.flags|=128}if(_=o.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),ie(or,or.current),f)break;return null;case 22:case 23:return o.lanes=0,xT(s,o,d);case 24:ao(o,xi,s.memoizedState.cache)}return Gr(s,o,d)}function BT(s,o,d){if(s!==null)if(s.memoizedProps!==o.pendingProps)cr=!0;else{if(!fg(s,d)&&(o.flags&128)===0)return cr=!1,R0(s,o,d);cr=(s.flags&131072)!==0}else cr=!1,On&&(o.flags&1048576)!==0&&qh(o,zl,o.index);switch(o.lanes=0,o.tag){case 16:t:{s=o.pendingProps;var f=o.elementType,_=f._init;if(f=_(f._payload),o.type=f,typeof f=="function")kg(f)?(s=Xo(f,s),o.tag=1,o=km(null,o,f,s,d)):(o.tag=0,o=Pm(null,o,f,s,d));else{if(f!=null){if(_=f.$$typeof,_===st){o.tag=11,o=PT(null,o,f,s,d);break t}else if(_===It){o.tag=14,o=Qo(null,o,f,s,d);break t}}throw o=Ie(f)||f,Error(A(306,o,""))}}return o;case 0:return Pm(s,o,o.type,o.pendingProps,d);case 1:return f=o.type,_=Xo(f,o.pendingProps),km(s,o,f,_,d);case 3:t:{if(hs(o,o.stateNode.containerInfo),s===null)throw Error(A(387));var v=o.pendingProps;_=o.memoizedState,f=_.element,mp(s,o),Ep(o,v,null,d);var V=o.memoizedState;if(v=V.cache,ao(o,xi,v),v!==_.cache&&_g(o,[xi],d,!0),Zl(),v=V.element,_.isDehydrated)if(_={element:v,isDehydrated:!1,cache:V.cache},o.updateQueue.baseState=_,o.memoizedState=_,o.flags&256){o=ag(s,o,v,d);break t}else if(v!==f){f=Or(Error(A(424)),o),oe(f),o=ag(s,o,v,d);break t}else for(ki=na(o.stateNode.containerInfo.firstChild),_r=o,On=!0,Ms=null,Zs=!0,d=mm(o,null,v,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Tt(),v===f){o=Gr(s,o,d);break t}gr(s,o,v,d)}o=o.child}return o;case 26:return hp(s,o),s===null?(d=lS(o.type,null,o.pendingProps,null))?o.memoizedState=d:On||(d=o.type,s=o.pendingProps,f=oE(pr.current).createElement(d),f[mr]=o,f[en]=s,Dr(f,d,s),Yi(f),o.stateNode=f):o.memoizedState=lS(o.type,s.memoizedProps,o.pendingProps,s.memoizedState),null;case 27:return ps(o),s===null&&On&&(f=o.stateNode=Ev(o.type,o.pendingProps,pr.current),_r=o,Zs=!0,ki=na(f.firstChild)),f=o.pendingProps.children,s!==null||On?gr(s,o,f,d):o.child=Kc(o,null,f,d),hp(s,o),o.child;case 5:return s===null&&On&&((_=f=ki)&&(f=V0(f,o.type,o.pendingProps,Zs),f!==null?(o.stateNode=f,_r=o,ki=na(f.firstChild),Zs=!1,_=!0):_=!1),_||y(o)),ps(o),_=o.type,v=o.pendingProps,V=s!==null?s.memoizedProps:null,f=v.children,sS(_,v)?f=null:V!==null&&sS(_,V)&&(o.flags|=32),o.memoizedState!==null&&(_=ym(s,o,T0,null,null,d),xp._currentValue=_),hp(s,o),gr(s,o,f,d),o.child;case 6:return s===null&&On&&((s=d=ki)&&(d=B0(d,o.pendingProps,Zs),d!==null?(o.stateNode=d,_r=o,ki=null,s=!0):s=!1),s||y(o)),null;case 13:return jT(s,o,d);case 4:return hs(o,o.stateNode.containerInfo),f=o.pendingProps,s===null?o.child=Kc(o,null,f,d):gr(s,o,f,d),o.child;case 11:return PT(s,o,o.type,o.pendingProps,d);case 7:return gr(s,o,o.pendingProps,d),o.child;case 8:return gr(s,o,o.pendingProps.children,d),o.child;case 12:return gr(s,o,o.pendingProps.children,d),o.child;case 10:return f=o.pendingProps,ao(o,o.type,f.value),gr(s,o,f.children,d),o.child;case 9:return _=o.type._context,f=o.pendingProps.children,Ql(o),_=Nr(_),f=f(_),o.flags|=1,gr(s,o,f,d),o.child;case 14:return Qo(s,o,o.type,o.pendingProps,d);case 15:return kT(s,o,o.type,o.pendingProps,d);case 19:return pg(s,o,d);case 22:return xT(s,o,d);case 24:return Ql(o),f=Nr(xi),s===null?(_=F_(),_===null&&(_=$n,v=j_(),_.pooledCache=v,v.refCount++,v!==null&&(_.pooledCacheLanes|=d),_=v),o.memoizedState={parent:f,cache:_},Tu(o),ao(o,xi,_)):((s.lanes&d)!==0&&(mp(s,o),Ep(o,null,null,d),Zl()),_=s.memoizedState,v=o.memoizedState,_.parent!==f?(_={parent:f,cache:f},o.memoizedState=_,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=_),ao(o,xi,f)):(f=v.cache,ao(o,xi,f),f!==_.cache&&_g(o,[xi],d,!0))),gr(s,o,o.pendingProps.children,d),o.child;case 29:throw o.pendingProps}throw Error(A(156,o.tag))}var mg=te(null),Jl=null,Zo=null;function ao(s,o,d){ie(mg,o._currentValue),o._currentValue=d}function $o(s){s._currentValue=mg.current,ce(mg)}function Eg(s,o,d){for(;s!==null;){var f=s.alternate;if((s.childLanes&o)!==o?(s.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),s===d)break;s=s.return}}function _g(s,o,d,f){var _=s.child;for(_!==null&&(_.return=s);_!==null;){var v=_.dependencies;if(v!==null){var V=_.child;v=v.firstContext;t:for(;v!==null;){var Y=v;v=_;for(var tt=0;tt<o.length;tt++)if(Y.context===o[tt]){v.lanes|=d,Y=v.alternate,Y!==null&&(Y.lanes|=d),Eg(v.return,d,s),f||(V=null);break t}v=Y.next}}else if(_.tag===18){if(V=_.return,V===null)throw Error(A(341));V.lanes|=d,v=V.alternate,v!==null&&(v.lanes|=d),Eg(V,d,s),V=null}else V=_.child;if(V!==null)V.return=_;else for(V=_;V!==null;){if(V===s){V=null;break}if(_=V.sibling,_!==null){_.return=V.return,V=_;break}V=V.return}_=V}}function pp(s,o,d,f){s=null;for(var _=o,v=!1;_!==null;){if(!v){if((_.flags&524288)!==0)v=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var V=_.alternate;if(V===null)throw Error(A(387));if(V=V.memoizedProps,V!==null){var Y=_.type;es(_.pendingProps.value,V.value)||(s!==null?s.push(Y):s=[Y])}}else if(_===Di.current){if(V=_.alternate,V===null)throw Error(A(387));V.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(s!==null?s.push(xp):s=[xp])}_=_.return}s!==null&&_g(o,s,d,f),o.flags|=262144}function Mm(s){for(s=s.firstContext;s!==null;){if(!es(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Ql(s){Jl=s,Zo=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Nr(s){return FT(Jl,s)}function fp(s,o){return Jl===null&&Ql(s),FT(s,o)}function FT(s,o){var d=o._currentValue;if(o={context:o,memoizedValue:d,next:null},Zo===null){if(s===null)throw Error(A(308));Zo=o,s.dependencies={lanes:0,firstContext:o},s.flags|=524288}else Zo=Zo.next=o;return d}var Qc=!1;function Tu(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function mp(s,o){s=s.updateQueue,o.updateQueue===s&&(o.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function tc(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Ca(s,o,d){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(Ei&2)!==0){var _=f.pending;return _===null?o.next=o:(o.next=_.next,_.next=o),f.pending=o,o=Js(s),cu(s,null,d),o}return ou(s,f,o,d),Js(s)}function vu(s,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194176)!==0)){var f=o.lanes;f&=s.pendingLanes,d|=f,o.lanes=d,Vd(s,d)}}function gg(s,o){var d=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,d===f)){var _=null,v=null;if(d=d.firstBaseUpdate,d!==null){do{var V={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};v===null?_=v=V:v=v.next=V,d=d.next}while(d!==null);v===null?_=v=o:v=v.next=o}else _=v=o;d={baseState:f.baseState,firstBaseUpdate:_,lastBaseUpdate:v,shared:f.shared,callbacks:f.callbacks},s.updateQueue=d;return}s=d.lastBaseUpdate,s===null?d.firstBaseUpdate=o:s.next=o,d.lastBaseUpdate=o}var Um=!1;function Zl(){if(Um){var s=mu;if(s!==null)throw s}}function Ep(s,o,d,f){Um=!1;var _=s.updateQueue;Qc=!1;var v=_.firstBaseUpdate,V=_.lastBaseUpdate,Y=_.shared.pending;if(Y!==null){_.shared.pending=null;var tt=Y,ht=tt.next;tt.next=null,V===null?v=ht:V.next=ht,V=tt;var xt=s.alternate;xt!==null&&(xt=xt.updateQueue,Y=xt.lastBaseUpdate,Y!==V&&(Y===null?xt.firstBaseUpdate=ht:Y.next=ht,xt.lastBaseUpdate=tt))}if(v!==null){var $t=_.baseState;V=0,xt=ht=tt=null,Y=v;do{var vt=Y.lane&-536870913,Pt=vt!==Y.lane;if(Pt?(Rn&vt)===vt:(f&vt)===vt){vt!==0&&vt===fu&&(Um=!0),xt!==null&&(xt=xt.next={lane:0,tag:Y.tag,payload:Y.payload,callback:null,next:null});t:{var Ce=s,Je=Y;vt=o;var vi=d;switch(Je.tag){case 1:if(Ce=Je.payload,typeof Ce=="function"){$t=Ce.call(vi,$t,vt);break t}$t=Ce;break t;case 3:Ce.flags=Ce.flags&-65537|128;case 0:if(Ce=Je.payload,vt=typeof Ce=="function"?Ce.call(vi,$t,vt):Ce,vt==null)break t;$t=Qt({},$t,vt);break t;case 2:Qc=!0}}vt=Y.callback,vt!==null&&(s.flags|=64,Pt&&(s.flags|=8192),Pt=_.callbacks,Pt===null?_.callbacks=[vt]:Pt.push(vt))}else Pt={lane:vt,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null},xt===null?(ht=xt=Pt,tt=$t):xt=xt.next=Pt,V|=vt;if(Y=Y.next,Y===null){if(Y=_.shared.pending,Y===null)break;Pt=Y,Y=Pt.next,Pt.next=null,_.lastBaseUpdate=Pt,_.shared.pending=null}}while(!0);xt===null&&(tt=$t),_.baseState=tt,_.firstBaseUpdate=ht,_.lastBaseUpdate=xt,v===null&&(_.shared.lanes=0),rc|=V,s.lanes=V,s.memoizedState=$t}}function Sg(s,o){if(typeof s!="function")throw Error(A(191,s));s.call(o)}function yg(s,o){var d=s.callbacks;if(d!==null)for(s.callbacks=null,s=0;s<d.length;s++)Sg(d[s],o)}function _p(s,o){try{var d=o.updateQueue,f=d!==null?d.lastEffect:null;if(f!==null){var _=f.next;d=_;do{if((d.tag&s)===s){f=void 0;var v=d.create,V=d.inst;f=v(),V.destroy=f}d=d.next}while(d!==_)}}catch(Y){jn(o,o.return,Y)}}function ec(s,o,d){try{var f=o.updateQueue,_=f!==null?f.lastEffect:null;if(_!==null){var v=_.next;f=v;do{if((f.tag&s)===s){var V=f.inst,Y=V.destroy;if(Y!==void 0){V.destroy=void 0,_=o;var tt=d;try{Y()}catch(ht){jn(_,tt,ht)}}}f=f.next}while(f!==v)}}catch(ht){jn(o,o.return,ht)}}function Tg(s){var o=s.updateQueue;if(o!==null){var d=s.stateNode;try{yg(o,d)}catch(f){jn(s,s.return,f)}}}function GT(s,o,d){d.props=Xo(s.type,s.memoizedProps),d.state=s.memoizedState;try{d.componentWillUnmount()}catch(f){jn(s,o,f)}}function $l(s,o){try{var d=s.ref;if(d!==null){var f=s.stateNode;switch(s.tag){case 26:case 27:case 5:var _=f;break;default:_=f}typeof d=="function"?s.refCleanup=d(_):d.current=_}}catch(v){jn(s,o,v)}}function Us(s,o){var d=s.ref,f=s.refCleanup;if(d!==null)if(typeof f=="function")try{f()}catch(_){jn(s,o,_)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(_){jn(s,o,_)}else d.current=null}function gp(s){var o=s.type,d=s.memoizedProps,f=s.stateNode;try{t:switch(o){case"button":case"input":case"select":case"textarea":d.autoFocus&&f.focus();break t;case"img":d.src?f.src=d.src:d.srcSet&&(f.srcset=d.srcSet)}}catch(_){jn(s,s.return,_)}}function HT(s,o,d){try{var f=s.stateNode;aE(f,s.type,d,o),f[en]=o}catch(_){jn(s,s.return,_)}}function WT(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27||s.tag===4}function vg(s){t:for(;;){for(;s.sibling===null;){if(s.return===null||WT(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==27&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue t;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function jm(s,o,d){var f=s.tag;if(f===5||f===6)s=s.stateNode,o?d.nodeType===8?d.parentNode.insertBefore(s,o):d.insertBefore(s,o):(d.nodeType===8?(o=d.parentNode,o.insertBefore(s,d)):(o=d,o.appendChild(s)),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=sE));else if(f!==4&&f!==27&&(s=s.child,s!==null))for(jm(s,o,d),s=s.sibling;s!==null;)jm(s,o,d),s=s.sibling}function Vm(s,o,d){var f=s.tag;if(f===5||f===6)s=s.stateNode,o?d.insertBefore(s,o):d.appendChild(s);else if(f!==4&&f!==27&&(s=s.child,s!==null))for(Vm(s,o,d),s=s.sibling;s!==null;)Vm(s,o,d),s=s.sibling}var nc=!1,Ti=!1,bg=!1,Bm=typeof WeakSet=="function"?WeakSet:Set,Sr=null,Rg=!1;function C0(s,o){if(s=s.containerInfo,iS=Mp,s=lm(s),Ir(s)){if("selectionStart"in s)var d={start:s.selectionStart,end:s.selectionEnd};else t:{d=(d=s.ownerDocument)&&d.defaultView||window;var f=d.getSelection&&d.getSelection();if(f&&f.rangeCount!==0){d=f.anchorNode;var _=f.anchorOffset,v=f.focusNode;f=f.focusOffset;try{d.nodeType,v.nodeType}catch{d=null;break t}var V=0,Y=-1,tt=-1,ht=0,xt=0,$t=s,vt=null;e:for(;;){for(var Pt;$t!==d||_!==0&&$t.nodeType!==3||(Y=V+_),$t!==v||f!==0&&$t.nodeType!==3||(tt=V+f),$t.nodeType===3&&(V+=$t.nodeValue.length),(Pt=$t.firstChild)!==null;)vt=$t,$t=Pt;for(;;){if($t===s)break e;if(vt===d&&++ht===_&&(Y=V),vt===v&&++xt===f&&(tt=V),(Pt=$t.nextSibling)!==null)break;$t=vt,vt=$t.parentNode}$t=Pt}d=Y===-1||tt===-1?null:{start:Y,end:tt}}else d=null}d=d||{start:0,end:0}}else d=null;for(rS={focusedElem:s,selectionRange:d},Mp=!1,Sr=o;Sr!==null;)if(o=Sr,s=o.child,(o.subtreeFlags&1028)!==0&&s!==null)s.return=o,Sr=s;else for(;Sr!==null;){switch(o=Sr,v=o.alternate,s=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&v!==null){s=void 0,d=o,_=v.memoizedProps,v=v.memoizedState,f=d.stateNode;try{var Ce=Xo(d.type,_,d.elementType===d.type);s=f.getSnapshotBeforeUpdate(Ce,v),f.__reactInternalSnapshotBeforeUpdate=s}catch(Je){jn(d,d.return,Je)}}break;case 3:if((s&1024)!==0){if(s=o.stateNode.containerInfo,d=s.nodeType,d===9)cS(s);else if(d===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":cS(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(A(163))}if(s=o.sibling,s!==null){s.return=o.return,Sr=s;break}Sr=o.return}return Ce=Rg,Rg=!1,Ce}function KT(s,o,d){var f=d.flags;switch(d.tag){case 0:case 11:case 15:co(s,d),f&4&&_p(5,d);break;case 1:if(co(s,d),f&4)if(s=d.stateNode,o===null)try{s.componentDidMount()}catch(Y){jn(d,d.return,Y)}else{var _=Xo(d.type,o.memoizedProps);o=o.memoizedState;try{s.componentDidUpdate(_,o,s.__reactInternalSnapshotBeforeUpdate)}catch(Y){jn(d,d.return,Y)}}f&64&&Tg(d),f&512&&$l(d,d.return);break;case 3:if(co(s,d),f&64&&(f=d.updateQueue,f!==null)){if(s=null,d.child!==null)switch(d.child.tag){case 27:case 5:s=d.child.stateNode;break;case 1:s=d.child.stateNode}try{yg(f,s)}catch(Y){jn(d,d.return,Y)}}break;case 26:co(s,d),f&512&&$l(d,d.return);break;case 27:case 5:co(s,d),o===null&&f&4&&gp(d),f&512&&$l(d,d.return);break;case 12:co(s,d);break;case 13:co(s,d),f&4&&Ag(s,d);break;case 22:if(_=d.memoizedState!==null||nc,!_){o=o!==null&&o.memoizedState!==null||Ti;var v=nc,V=Ti;nc=_,(Ti=o)&&!V?Aa(s,d,(d.subtreeFlags&8772)!==0):co(s,d),nc=v,Ti=V}f&512&&(d.memoizedProps.mode==="manual"?$l(d,d.return):Us(d,d.return));break;default:co(s,d)}}function Cg(s){var o=s.alternate;o!==null&&(s.alternate=null,Cg(o)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(o=s.stateNode,o!==null&&qs(o)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Xi=null,js=!1;function oo(s,o,d){for(d=d.child;d!==null;)zT(s,o,d),d=d.sibling}function zT(s,o,d){if(br&&typeof br.onCommitFiberUnmount=="function")try{br.onCommitFiberUnmount(Oc,d)}catch{}switch(d.tag){case 26:Ti||Us(d,o),oo(s,o,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:Ti||Us(d,o);var f=Xi,_=js;for(Xi=d.stateNode,oo(s,o,d),d=d.stateNode,o=d.attributes;o.length;)d.removeAttributeNode(o[0]);qs(d),Xi=f,js=_;break;case 5:Ti||Us(d,o);case 6:_=Xi;var v=js;if(Xi=null,oo(s,o,d),Xi=_,js=v,Xi!==null)if(js)try{s=Xi,f=d.stateNode,s.nodeType===8?s.parentNode.removeChild(f):s.removeChild(f)}catch(V){jn(d,o,V)}else try{Xi.removeChild(d.stateNode)}catch(V){jn(d,o,V)}break;case 18:Xi!==null&&(js?(o=Xi,d=d.stateNode,o.nodeType===8?oS(o.parentNode,d):o.nodeType===1&&oS(o,d),Fp(o)):oS(Xi,d.stateNode));break;case 4:f=Xi,_=js,Xi=d.stateNode.containerInfo,js=!0,oo(s,o,d),Xi=f,js=_;break;case 0:case 11:case 14:case 15:Ti||ec(2,d,o),Ti||ec(4,d,o),oo(s,o,d);break;case 1:Ti||(Us(d,o),f=d.stateNode,typeof f.componentWillUnmount=="function"&&GT(d,o,f)),oo(s,o,d);break;case 21:oo(s,o,d);break;case 22:Ti||Us(d,o),Ti=(f=Ti)||d.memoizedState!==null,oo(s,o,d),Ti=f;break;default:oo(s,o,d)}}function Ag(s,o){if(o.memoizedState===null&&(s=o.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Fp(s)}catch(d){jn(o,o.return,d)}}function wg(s){switch(s.tag){case 13:case 19:var o=s.stateNode;return o===null&&(o=s.stateNode=new Bm),o;case 22:return s=s.stateNode,o=s._retryCache,o===null&&(o=s._retryCache=new Bm),o;default:throw Error(A(435,s.tag))}}function Ig(s,o){var d=wg(s);o.forEach(function(f){var _=Wg.bind(null,s,f);d.has(f)||(d.add(f),f.then(_,_))})}function ta(s,o){var d=o.deletions;if(d!==null)for(var f=0;f<d.length;f++){var _=d[f],v=s,V=o,Y=V;t:for(;Y!==null;){switch(Y.tag){case 27:case 5:Xi=Y.stateNode,js=!1;break t;case 3:Xi=Y.stateNode.containerInfo,js=!0;break t;case 4:Xi=Y.stateNode.containerInfo,js=!0;break t}Y=Y.return}if(Xi===null)throw Error(A(160));zT(v,V,_),Xi=null,js=!1,v=_.alternate,v!==null&&(v.return=null),_.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)Og(o,s),o=o.sibling}var rs=null;function Og(s,o){var d=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:ta(o,s),Hr(s),f&4&&(ec(3,s,s.return),_p(3,s),ec(5,s,s.return));break;case 1:ta(o,s),Hr(s),f&512&&(Ti||d===null||Us(d,d.return)),f&64&&nc&&(s=s.updateQueue,s!==null&&(f=s.callbacks,f!==null&&(d=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=d===null?f:d.concat(f))));break;case 26:var _=rs;if(ta(o,s),Hr(s),f&512&&(Ti||d===null||Us(d,d.return)),f&4){var v=d!==null?d.memoizedState:null;if(f=s.memoizedState,d===null)if(f===null)if(s.stateNode===null){t:{f=s.type,d=s.memoizedProps,_=_.ownerDocument||_;e:switch(f){case"title":v=_.getElementsByTagName("title")[0],(!v||v[Dc]||v[mr]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=_.createElement(f),_.head.insertBefore(v,_.querySelector("head > title"))),Dr(v,f,d),v[mr]=s,Yi(v),f=v;break t;case"link":var V=yv("link","href",_).get(f+(d.href||""));if(V){for(var Y=0;Y<V.length;Y++)if(v=V[Y],v.getAttribute("href")===(d.href==null?null:d.href)&&v.getAttribute("rel")===(d.rel==null?null:d.rel)&&v.getAttribute("title")===(d.title==null?null:d.title)&&v.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){V.splice(Y,1);break e}}v=_.createElement(f),Dr(v,f,d),_.head.appendChild(v);break;case"meta":if(V=yv("meta","content",_).get(f+(d.content||""))){for(Y=0;Y<V.length;Y++)if(v=V[Y],v.getAttribute("content")===(d.content==null?null:""+d.content)&&v.getAttribute("name")===(d.name==null?null:d.name)&&v.getAttribute("property")===(d.property==null?null:d.property)&&v.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&v.getAttribute("charset")===(d.charSet==null?null:d.charSet)){V.splice(Y,1);break e}}v=_.createElement(f),Dr(v,f,d),_.head.appendChild(v);break;default:throw Error(A(468,f))}v[mr]=s,Yi(v),f=v}s.stateNode=f}else Tv(_,s.type,s.stateNode);else s.stateNode=dS(_,f,s.memoizedProps);else v!==f?(v===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):v.count--,f===null?Tv(_,s.type,s.stateNode):dS(_,f,s.memoizedProps)):f===null&&s.stateNode!==null&&HT(s,s.memoizedProps,d.memoizedProps)}break;case 27:if(f&4&&s.alternate===null){_=s.stateNode,v=s.memoizedProps;try{for(var tt=_.firstChild;tt;){var ht=tt.nextSibling,xt=tt.nodeName;tt[Dc]||xt==="HEAD"||xt==="BODY"||xt==="SCRIPT"||xt==="STYLE"||xt==="LINK"&&tt.rel.toLowerCase()==="stylesheet"||_.removeChild(tt),tt=ht}for(var $t=s.type,vt=_.attributes;vt.length;)_.removeAttributeNode(vt[0]);Dr(_,$t,v),_[mr]=s,_[en]=v}catch(Ce){jn(s,s.return,Ce)}}case 5:if(ta(o,s),Hr(s),f&512&&(Ti||d===null||Us(d,d.return)),s.flags&32){_=s.stateNode;try{Ya(_,"")}catch(Ce){jn(s,s.return,Ce)}}f&4&&s.stateNode!=null&&(_=s.memoizedProps,HT(s,_,d!==null?d.memoizedProps:_)),f&1024&&(bg=!0);break;case 6:if(ta(o,s),Hr(s),f&4){if(s.stateNode===null)throw Error(A(162));f=s.memoizedProps,d=s.stateNode;try{d.nodeValue=f}catch(Ce){jn(s,s.return,Ce)}}break;case 3:if(dE=null,_=rs,rs=cE(o.containerInfo),ta(o,s),rs=_,Hr(s),f&4&&d!==null&&d.memoizedState.isDehydrated)try{Fp(o.containerInfo)}catch(Ce){jn(s,s.return,Ce)}bg&&(bg=!1,td(s));break;case 4:f=rs,rs=cE(s.stateNode.containerInfo),ta(o,s),Hr(s),rs=f;break;case 12:ta(o,s),Hr(s);break;case 13:ta(o,s),Hr(s),s.child.flags&8192&&s.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(Bg=mi()),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,Ig(s,f)));break;case 22:if(f&512&&(Ti||d===null||Us(d,d.return)),tt=s.memoizedState!==null,ht=d!==null&&d.memoizedState!==null,xt=nc,$t=Ti,nc=xt||tt,Ti=$t||ht,ta(o,s),Ti=$t,nc=xt,Hr(s),o=s.stateNode,o._current=s,o._visibility&=-3,o._visibility|=o._pendingVisibility&2,f&8192&&(o._visibility=tt?o._visibility&-2:o._visibility|1,tt&&(o=nc||Ti,d===null||ht||o||Zc(s)),s.memoizedProps===null||s.memoizedProps.mode!=="manual"))t:for(d=null,o=s;;){if(o.tag===5||o.tag===26||o.tag===27){if(d===null){ht=d=o;try{if(_=ht.stateNode,tt)v=_.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{V=ht.stateNode,Y=ht.memoizedProps.style;var Pt=Y!=null&&Y.hasOwnProperty("display")?Y.display:null;V.style.display=Pt==null||typeof Pt=="boolean"?"":(""+Pt).trim()}}catch(Ce){jn(ht,ht.return,Ce)}}}else if(o.tag===6){if(d===null){ht=o;try{ht.stateNode.nodeValue=tt?"":ht.memoizedProps}catch(Ce){jn(ht,ht.return,Ce)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===s)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break t;for(;o.sibling===null;){if(o.return===null||o.return===s)break t;d===o&&(d=null),o=o.return}d===o&&(d=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=s.updateQueue,f!==null&&(d=f.retryQueue,d!==null&&(f.retryQueue=null,Ig(s,d))));break;case 19:ta(o,s),Hr(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,Ig(s,f)));break;case 21:break;default:ta(o,s),Hr(s)}}function Hr(s){var o=s.flags;if(o&2){try{if(s.tag!==27){t:{for(var d=s.return;d!==null;){if(WT(d)){var f=d;break t}d=d.return}throw Error(A(160))}switch(f.tag){case 27:var _=f.stateNode,v=vg(s);Vm(s,v,_);break;case 5:var V=f.stateNode;f.flags&32&&(Ya(V,""),f.flags&=-33);var Y=vg(s);Vm(s,Y,V);break;case 3:case 4:var tt=f.stateNode.containerInfo,ht=vg(s);jm(s,ht,tt);break;default:throw Error(A(161))}}}catch(xt){jn(s,s.return,xt)}s.flags&=-3}o&4096&&(s.flags&=-4097)}function td(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var o=s;td(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),s=s.sibling}}function co(s,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)KT(s,o.alternate,o),o=o.sibling}function Zc(s){for(s=s.child;s!==null;){var o=s;switch(o.tag){case 0:case 11:case 14:case 15:ec(4,o,o.return),Zc(o);break;case 1:Us(o,o.return);var d=o.stateNode;typeof d.componentWillUnmount=="function"&&GT(o,o.return,d),Zc(o);break;case 26:case 27:case 5:Us(o,o.return),Zc(o);break;case 22:Us(o,o.return),o.memoizedState===null&&Zc(o);break;default:Zc(o)}s=s.sibling}}function Aa(s,o,d){for(d=d&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,_=s,v=o,V=v.flags;switch(v.tag){case 0:case 11:case 15:Aa(_,v,d),_p(4,v);break;case 1:if(Aa(_,v,d),f=v,_=f.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(ht){jn(f,f.return,ht)}if(f=v,_=f.updateQueue,_!==null){var Y=f.stateNode;try{var tt=_.shared.hiddenCallbacks;if(tt!==null)for(_.shared.hiddenCallbacks=null,_=0;_<tt.length;_++)Sg(tt[_],Y)}catch(ht){jn(f,f.return,ht)}}d&&V&64&&Tg(v),$l(v,v.return);break;case 26:case 27:case 5:Aa(_,v,d),d&&f===null&&V&4&&gp(v),$l(v,v.return);break;case 12:Aa(_,v,d);break;case 13:Aa(_,v,d),d&&V&4&&Ag(_,v);break;case 22:v.memoizedState===null&&Aa(_,v,d),$l(v,v.return);break;default:Aa(_,v,d)}o=o.sibling}}function Ng(s,o){var d=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),s=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(s=o.memoizedState.cachePool.pool),s!==d&&(s!=null&&s.refCount++,d!=null&&Zh(d))}function Dg(s,o){s=null,o.alternate!==null&&(s=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==s&&(o.refCount++,s!=null&&Zh(s))}function $c(s,o,d,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)Lg(s,o,d,f),o=o.sibling}function Lg(s,o,d,f){var _=o.flags;switch(o.tag){case 0:case 11:case 15:$c(s,o,d,f),_&2048&&_p(9,o);break;case 3:$c(s,o,d,f),_&2048&&(s=null,o.alternate!==null&&(s=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==s&&(o.refCount++,s!=null&&Zh(s)));break;case 12:if(_&2048){$c(s,o,d,f),s=o.stateNode;try{var v=o.memoizedProps,V=v.id,Y=v.onPostCommit;typeof Y=="function"&&Y(V,o.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(tt){jn(o,o.return,tt)}}else $c(s,o,d,f);break;case 23:break;case 22:v=o.stateNode,o.memoizedState!==null?v._visibility&4?$c(s,o,d,f):Sp(s,o):v._visibility&4?$c(s,o,d,f):(v._visibility|=4,bu(s,o,d,f,(o.subtreeFlags&10256)!==0)),_&2048&&Ng(o.alternate,o);break;case 24:$c(s,o,d,f),_&2048&&Dg(o.alternate,o);break;default:$c(s,o,d,f)}}function bu(s,o,d,f,_){for(_=_&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var v=s,V=o,Y=d,tt=f,ht=V.flags;switch(V.tag){case 0:case 11:case 15:bu(v,V,Y,tt,_),_p(8,V);break;case 23:break;case 22:var xt=V.stateNode;V.memoizedState!==null?xt._visibility&4?bu(v,V,Y,tt,_):Sp(v,V):(xt._visibility|=4,bu(v,V,Y,tt,_)),_&&ht&2048&&Ng(V.alternate,V);break;case 24:bu(v,V,Y,tt,_),_&&ht&2048&&Dg(V.alternate,V);break;default:bu(v,V,Y,tt,_)}o=o.sibling}}function Sp(s,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var d=s,f=o,_=f.flags;switch(f.tag){case 22:Sp(d,f),_&2048&&Ng(f.alternate,f);break;case 24:Sp(d,f),_&2048&&Dg(f.alternate,f);break;default:Sp(d,f)}o=o.sibling}}var yp=8192;function tl(s){if(s.subtreeFlags&yp)for(s=s.child;s!==null;)Tp(s),s=s.sibling}function Tp(s){switch(s.tag){case 26:tl(s),s.flags&yp&&s.memoizedState!==null&&Q0(rs,s.memoizedState,s.memoizedProps);break;case 5:tl(s);break;case 3:case 4:var o=rs;rs=cE(s.stateNode.containerInfo),tl(s),rs=o;break;case 22:s.memoizedState===null&&(o=s.alternate,o!==null&&o.memoizedState!==null?(o=yp,yp=16777216,tl(s),yp=o):tl(s));break;default:tl(s)}}function YT(s){var o=s.alternate;if(o!==null&&(s=o.child,s!==null)){o.child=null;do o=s.sibling,s.sibling=null,s=o;while(s!==null)}}function lo(s){var o=s.deletions;if((s.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var f=o[d];Sr=f,qT(f,s)}YT(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Pg(s),s=s.sibling}function Pg(s){switch(s.tag){case 0:case 11:case 15:lo(s),s.flags&2048&&ec(9,s,s.return);break;case 3:lo(s);break;case 12:lo(s);break;case 22:var o=s.stateNode;s.memoizedState!==null&&o._visibility&4&&(s.return===null||s.return.tag!==13)?(o._visibility&=-5,Wr(s)):lo(s);break;default:lo(s)}}function Wr(s){var o=s.deletions;if((s.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var f=o[d];Sr=f,qT(f,s)}YT(s)}for(s=s.child;s!==null;){switch(o=s,o.tag){case 0:case 11:case 15:ec(8,o,o.return),Wr(o);break;case 22:d=o.stateNode,d._visibility&4&&(d._visibility&=-5,Wr(o));break;default:Wr(o)}s=s.sibling}}function qT(s,o){for(;Sr!==null;){var d=Sr;switch(d.tag){case 0:case 11:case 15:ec(8,d,o);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var f=d.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Zh(d.memoizedState.cache)}if(f=d.child,f!==null)f.return=d,Sr=f;else t:for(d=s;Sr!==null;){f=Sr;var _=f.sibling,v=f.return;if(Cg(f),f===d){Sr=null;break t}if(_!==null){_.return=v,Sr=_;break t}Sr=v}}}function A0(s,o,d,f){this.tag=s,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vs(s,o,d,f){return new A0(s,o,d,f)}function kg(s){return s=s.prototype,!(!s||!s.isReactComponent)}function ic(s,o){var d=s.alternate;return d===null?(d=Vs(s.tag,o,s.key,s.mode),d.elementType=s.elementType,d.type=s.type,d.stateNode=s.stateNode,d.alternate=s,s.alternate=d):(d.pendingProps=o,d.type=s.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=s.flags&31457280,d.childLanes=s.childLanes,d.lanes=s.lanes,d.child=s.child,d.memoizedProps=s.memoizedProps,d.memoizedState=s.memoizedState,d.updateQueue=s.updateQueue,o=s.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=s.sibling,d.index=s.index,d.ref=s.ref,d.refCleanup=s.refCleanup,d}function xg(s,o){s.flags&=31457282;var d=s.alternate;return d===null?(s.childLanes=0,s.lanes=o,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=d.childLanes,s.lanes=d.lanes,s.child=d.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=d.memoizedProps,s.memoizedState=d.memoizedState,s.updateQueue=d.updateQueue,s.type=d.type,o=d.dependencies,s.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),s}function Fm(s,o,d,f,_,v){var V=0;if(f=s,typeof s=="function")kg(s)&&(V=1);else if(typeof s=="string")V=vv(s,d,vn.current)?26:s==="html"||s==="head"||s==="body"?27:5;else t:switch(s){case G:return el(d.children,_,v,o);case H:V=8,_|=24;break;case rt:return s=Vs(12,d,o,_|2),s.elementType=rt,s.lanes=v,s;case Ct:return s=Vs(13,d,o,_),s.elementType=Ct,s.lanes=v,s;case yt:return s=Vs(19,d,o,_),s.elementType=yt,s.lanes=v,s;case Rt:return XT(d,_,v,o);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case lt:case X:V=10;break t;case dt:V=9;break t;case st:V=11;break t;case It:V=14;break t;case Wt:V=16,f=null;break t}V=29,d=Error(A(130,s===null?"null":typeof s,"")),f=null}return o=Vs(V,d,o,_),o.elementType=s,o.type=f,o.lanes=v,o}function el(s,o,d,f){return s=Vs(7,s,f,o),s.lanes=d,s}function XT(s,o,d,f){s=Vs(22,s,f,o),s.elementType=Rt,s.lanes=d;var _={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var v=_._current;if(v===null)throw Error(A(456));if((_._pendingVisibility&2)===0){var V=eo(v,2);V!==null&&(_._pendingVisibility|=2,Ji(V,v,2))}},attach:function(){var v=_._current;if(v===null)throw Error(A(456));if((_._pendingVisibility&2)!==0){var V=eo(v,2);V!==null&&(_._pendingVisibility&=-3,Ji(V,v,2))}}};return s.stateNode=_,s}function Mg(s,o,d){return s=Vs(6,s,null,o),s.lanes=d,s}function Ug(s,o,d){return o=Vs(4,s.children!==null?s.children:[],s.key,o),o.lanes=d,o.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},o}function wa(s){s.flags|=4}function Gm(s,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!bv(o)){if(o=$s.current,o!==null&&((Rn&4194176)===Rn?io!==null:(Rn&62914560)!==Rn&&(Rn&536870912)===0||o!==io))throw Jh=ri,Sn;s.flags|=8192}}function Hm(s,o){o!==null&&(s.flags|=4),s.flags&16384&&(o=s.tag!==22?Pf():536870912,s.lanes|=o,id|=o)}function ed(s,o){if(!On)switch(s.tailMode){case"hidden":o=s.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?s.tail=null:d.sibling=null;break;case"collapsed":d=s.tail;for(var f=null;d!==null;)d.alternate!==null&&(f=d),d=d.sibling;f===null?o||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function Ri(s){var o=s.alternate!==null&&s.alternate.child===s.child,d=0,f=0;if(o)for(var _=s.child;_!==null;)d|=_.lanes|_.childLanes,f|=_.subtreeFlags&31457280,f|=_.flags&31457280,_.return=s,_=_.sibling;else for(_=s.child;_!==null;)d|=_.lanes|_.childLanes,f|=_.subtreeFlags,f|=_.flags,_.return=s,_=_.sibling;return s.subtreeFlags|=f,s.childLanes=d,o}function JT(s,o,d){var f=o.pendingProps;switch(Xh(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ri(o),null;case 1:return Ri(o),null;case 3:return d=o.stateNode,f=null,s!==null&&(f=s.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),$o(xi),Li(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(s===null||s.child===null)&&(Q(o)?wa(o):s===null||s.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Ms!==null&&(qm(Ms),Ms=null))),Ri(o),null;case 26:return d=o.memoizedState,s===null?(wa(o),d!==null?(Ri(o),Gm(o,d)):(Ri(o),o.flags&=-16777217)):d?d!==s.memoizedState?(wa(o),Ri(o),Gm(o,d)):(Ri(o),o.flags&=-16777217):(s.memoizedProps!==f&&wa(o),Ri(o),o.flags&=-16777217),null;case 27:rr(o),d=pr.current;var _=o.type;if(s!==null&&o.stateNode!=null)s.memoizedProps!==f&&wa(o);else{if(!f){if(o.stateNode===null)throw Error(A(166));return Ri(o),null}s=vn.current,Q(o)?I(o):(s=Ev(_,f,d),o.stateNode=s,wa(o))}return Ri(o),null;case 5:if(rr(o),d=o.type,s!==null&&o.stateNode!=null)s.memoizedProps!==f&&wa(o);else{if(!f){if(o.stateNode===null)throw Error(A(166));return Ri(o),null}if(s=vn.current,Q(o))I(o);else{switch(_=oE(pr.current),s){case 1:s=_.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:s=_.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":s=_.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":s=_.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":s=_.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof f.is=="string"?_.createElement("select",{is:f.is}):_.createElement("select"),f.multiple?s.multiple=!0:f.size&&(s.size=f.size);break;default:s=typeof f.is=="string"?_.createElement(d,{is:f.is}):_.createElement(d)}}s[mr]=o,s[en]=f;t:for(_=o.child;_!==null;){if(_.tag===5||_.tag===6)s.appendChild(_.stateNode);else if(_.tag!==4&&_.tag!==27&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===o)break t;for(;_.sibling===null;){if(_.return===null||_.return===o)break t;_=_.return}_.sibling.return=_.return,_=_.sibling}o.stateNode=s;t:switch(Dr(s,d,f),d){case"button":case"input":case"select":case"textarea":s=!!f.autoFocus;break t;case"img":s=!0;break t;default:s=!1}s&&wa(o)}}return Ri(o),o.flags&=-16777217,null;case 6:if(s&&o.stateNode!=null)s.memoizedProps!==f&&wa(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(A(166));if(s=pr.current,Q(o)){if(s=o.stateNode,d=o.memoizedProps,f=null,_=_r,_!==null)switch(_.tag){case 27:case 5:f=_.memoizedProps}s[mr]=o,s=!!(s.nodeValue===d||f!==null&&f.suppressHydrationWarning===!0||eS(s.nodeValue,d)),s||y(o)}else s=oE(s).createTextNode(f),s[mr]=o,o.stateNode=s}return Ri(o),null;case 13:if(f=o.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(_=Q(o),f!==null&&f.dehydrated!==null){if(s===null){if(!_)throw Error(A(318));if(_=o.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(A(317));_[mr]=o}else Tt(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Ri(o),_=!1}else Ms!==null&&(qm(Ms),Ms=null),_=!0;if(!_)return o.flags&256?(Ko(o),o):(Ko(o),null)}if(Ko(o),(o.flags&128)!==0)return o.lanes=d,o;if(d=f!==null,s=s!==null&&s.memoizedState!==null,d){f=o.child,_=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(_=f.alternate.memoizedState.cachePool.pool);var v=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(v=f.memoizedState.cachePool.pool),v!==_&&(f.flags|=2048)}return d!==s&&d&&(o.child.flags|=8192),Hm(o,o.updateQueue),Ri(o),null;case 4:return Li(),s===null&&iE(o.stateNode.containerInfo),Ri(o),null;case 10:return $o(o.type),Ri(o),null;case 19:if(ce(or),_=o.memoizedState,_===null)return Ri(o),null;if(f=(o.flags&128)!==0,v=_.rendering,v===null)if(f)ed(_,!1);else{if(Ci!==0||s!==null&&(s.flags&128)!==0)for(s=o.child;s!==null;){if(v=_m(s),v!==null){for(o.flags|=128,ed(_,!1),s=v.updateQueue,o.updateQueue=s,Hm(o,s),o.subtreeFlags=0,s=d,d=o.child;d!==null;)xg(d,s),d=d.sibling;return ie(or,or.current&1|2),o.child}s=s.sibling}_.tail!==null&&mi()>Km&&(o.flags|=128,f=!0,ed(_,!1),o.lanes=4194304)}else{if(!f)if(s=_m(v),s!==null){if(o.flags|=128,f=!0,s=s.updateQueue,o.updateQueue=s,Hm(o,s),ed(_,!0),_.tail===null&&_.tailMode==="hidden"&&!v.alternate&&!On)return Ri(o),null}else 2*mi()-_.renderingStartTime>Km&&d!==536870912&&(o.flags|=128,f=!0,ed(_,!1),o.lanes=4194304);_.isBackwards?(v.sibling=o.child,o.child=v):(s=_.last,s!==null?s.sibling=v:o.child=v,_.last=v)}return _.tail!==null?(o=_.tail,_.rendering=o,_.tail=o.sibling,_.renderingStartTime=mi(),o.sibling=null,s=or.current,ie(or,f?s&1|2:s&1),o):(Ri(o),null);case 22:case 23:return Ko(o),M_(),f=o.memoizedState!==null,s!==null?s.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(d&536870912)!==0&&(o.flags&128)===0&&(Ri(o),o.subtreeFlags&6&&(o.flags|=8192)):Ri(o),d=o.updateQueue,d!==null&&Hm(o,d.retryQueue),d=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==d&&(o.flags|=2048),s!==null&&ce(Yc),null;case 24:return d=null,s!==null&&(d=s.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),$o(xi),Ri(o),null;case 25:return null}throw Error(A(156,o.tag))}function w0(s,o){switch(Xh(o),o.tag){case 1:return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 3:return $o(xi),Li(),s=o.flags,(s&65536)!==0&&(s&128)===0?(o.flags=s&-65537|128,o):null;case 26:case 27:case 5:return rr(o),null;case 13:if(Ko(o),s=o.memoizedState,s!==null&&s.dehydrated!==null){if(o.alternate===null)throw Error(A(340));Tt()}return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 19:return ce(or),null;case 4:return Li(),null;case 10:return $o(o.type),null;case 22:case 23:return Ko(o),M_(),s!==null&&ce(Yc),s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 24:return $o(xi),null;case 25:return null;default:return null}}function Wm(s,o){switch(Xh(o),o.tag){case 3:$o(xi),Li();break;case 26:case 27:case 5:rr(o);break;case 4:Li();break;case 13:Ko(o);break;case 19:ce(or);break;case 10:$o(o.type);break;case 22:case 23:Ko(o),M_(),s!==null&&ce(Yc);break;case 24:$o(xi)}}var vp={getCacheForType:function(s){var o=Nr(xi),d=o.data.get(s);return d===void 0&&(d=s(),o.data.set(s,d)),d}},QT=typeof WeakMap=="function"?WeakMap:Map,Ei=0,$n=null,fn=null,Rn=0,qn=0,_s=null,gs=!1,nl=!1,bp=!1,Ia=0,Ci=0,rc=0,nd=0,jg=0,yr=0,id=0,Rp=null,ea=null,Vg=!1,Bg=0,Km=1/0,zm=null,uo=null,Cp=!1,il=null,Ru=0,Cu=0,Ym=null,rd=0,Au=null;function Kr(){if((Ei&2)!==0&&Rn!==0)return Rn&-Rn;if(Xt.T!==null){var s=fu;return s!==0?s:Xg()}return mh()}function Fg(){yr===0&&(yr=(Rn&536870912)===0||On?Sa():536870912);var s=$s.current;return s!==null&&(s.flags|=32),yr}function Ji(s,o,d){(s===$n&&qn===2||s.cancelPendingCommit!==null)&&(wu(s,0),Bs(s,Rn,yr,!1)),kl(s,d),((Ei&2)===0||s!==$n)&&(s===$n&&((Ei&2)===0&&(nd|=d),Ci===4&&Bs(s,Rn,yr,!1)),ho(s))}function rl(s,o,d){if((Ei&6)!==0)throw Error(A(327));var f=!d&&(o&60)===0&&(o&s.expiredLanes)===0||ga(s,o),_=f?nv(s,o):Jm(s,o,!0),v=f;do{if(_===0){nl&&!f&&Bs(s,o,0,!1);break}else if(_===6)Bs(s,o,0,!gs);else{if(d=s.current.alternate,v&&!I0(d)){_=Jm(s,o,!1),v=!1;continue}if(_===2){if(v=o,s.errorRecoveryDisabledLanes&v)var V=0;else V=s.pendingLanes&-536870913,V=V!==0?V:V&536870912?536870912:0;if(V!==0){o=V;t:{var Y=s;_=Rp;var tt=Y.current.memoizedState.isDehydrated;if(tt&&(wu(Y,V).flags|=256),V=Jm(Y,V,!1),V!==2){if(bp&&!tt){Y.errorRecoveryDisabledLanes|=v,nd|=v,_=4;break t}v=ea,ea=_,v!==null&&qm(v)}_=V}if(v=!1,_!==2)continue}}if(_===1){wu(s,0),Bs(s,o,0,!0);break}t:{switch(f=s,_){case 0:case 1:throw Error(A(345));case 4:if((o&4194176)===o){Bs(f,o,yr,!gs);break t}break;case 2:ea=null;break;case 3:case 5:break;default:throw Error(A(329))}if(f.finishedWork=d,f.finishedLanes=o,(o&62914560)===o&&(v=Bg+300-mi(),10<v)){if(Bs(f,o,yr,!gs),jd(f,0)!==0)break t;f.timeoutHandle=pv(ZT.bind(null,f,d,ea,zm,Vg,o,yr,nd,id,gs,2,-0,0),v);break t}ZT(f,d,ea,zm,Vg,o,yr,nd,id,gs,0,-0,0)}}break}while(!0);ho(s)}function qm(s){ea===null?ea=s:ea.push.apply(ea,s)}function ZT(s,o,d,f,_,v,V,Y,tt,ht,xt,$t,vt){var Pt=o.subtreeFlags;if((Pt&8192||(Pt&16785408)===16785408)&&(Uu={stylesheets:null,count:0,unsuspend:hS},Tp(o),o=Z0(),o!==null)){s.cancelPendingCommit=o(Zm.bind(null,s,d,f,_,V,Y,tt,1,$t,vt)),Bs(s,v,V,!ht);return}Zm(s,d,f,_,V,Y,tt,xt,$t,vt)}function I0(s){for(var o=s;;){var d=o.tag;if((d===0||d===11||d===15)&&o.flags&16384&&(d=o.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var f=0;f<d.length;f++){var _=d[f],v=_.getSnapshot;_=_.value;try{if(!es(v(),_))return!1}catch{return!1}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Bs(s,o,d,f){o&=~jg,o&=~nd,s.suspendedLanes|=o,s.pingedLanes&=~o,f&&(s.warmLanes|=o),f=s.expirationTimes;for(var _=o;0<_;){var v=31-$r(_),V=1<<v;f[v]=-1,_&=~V}d!==0&&kf(s,d,o)}function Xm(){return(Ei&6)===0?(Du(0),!1):!0}function Gg(){if(fn!==null){if(qn===0)var s=fn.return;else s=fn,Zo=Jl=null,K_(s),Ho=null,Wc=0,s=fn;for(;s!==null;)Wm(s.alternate,s),s=s.return;fn=null}}function wu(s,o){s.finishedWork=null,s.finishedLanes=0;var d=s.timeoutHandle;d!==-1&&(s.timeoutHandle=-1,M0(d)),d=s.cancelPendingCommit,d!==null&&(s.cancelPendingCommit=null,d()),Gg(),$n=s,fn=d=ic(s.current,null),Rn=o,qn=0,_s=null,gs=!1,nl=ga(s,o),bp=!1,id=yr=jg=nd=rc=Ci=0,ea=Rp=null,Vg=!1,(o&8)!==0&&(o|=o&32);var f=s.entangledLanes;if(f!==0)for(s=s.entanglements,f&=o;0<f;){var _=31-$r(f),v=1<<_;o|=s[_],f&=~v}return Ia=o,au(),d}function $T(s,o){rn=null,Xt.H=ba,o===ze?(o=$y(),qn=3):o===Sn?(o=$y(),qn=4):qn=o===LT?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,_s=o,fn===null&&(Ci=1,up(s,Or(o,s.current)))}function tv(){var s=Xt.H;return Xt.H=ba,s===null?ba:s}function ev(){var s=Xt.A;return Xt.A=vp,s}function Ap(){Ci=4,gs||(Rn&4194176)!==Rn&&$s.current!==null||(nl=!0),(rc&134217727)===0&&(nd&134217727)===0||$n===null||Bs($n,Rn,yr,!1)}function Jm(s,o,d){var f=Ei;Ei|=2;var _=tv(),v=ev();($n!==s||Rn!==o)&&(zm=null,wu(s,o)),o=!1;var V=Ci;t:do try{if(qn!==0&&fn!==null){var Y=fn,tt=_s;switch(qn){case 8:Gg(),V=6;break t;case 3:case 2:case 6:$s.current===null&&(o=!0);var ht=qn;if(qn=0,_s=null,sd(s,Y,tt,ht),d&&nl){V=0;break t}break;default:ht=qn,qn=0,_s=null,sd(s,Y,tt,ht)}}O0(),V=Ci;break}catch(xt){$T(s,xt)}while(!0);return o&&s.shellSuspendCounter++,Zo=Jl=null,Ei=f,Xt.H=_,Xt.A=v,fn===null&&($n=null,Rn=0,au()),V}function O0(){for(;fn!==null;)Iu(fn)}function nv(s,o){var d=Ei;Ei|=2;var f=tv(),_=ev();$n!==s||Rn!==o?(zm=null,Km=mi()+500,wu(s,o)):nl=ga(s,o);t:do try{if(qn!==0&&fn!==null){o=fn;var v=_s;e:switch(qn){case 1:qn=0,_s=null,sd(s,o,v,1);break;case 2:if(Go(v)){qn=0,_s=null,Oa(o);break}o=function(){qn===2&&$n===s&&(qn=7),ho(s)},v.then(o,o);break t;case 3:qn=7;break t;case 4:qn=5;break t;case 7:Go(v)?(qn=0,_s=null,Oa(o)):(qn=0,_s=null,sd(s,o,v,7));break;case 5:var V=null;switch(fn.tag){case 26:V=fn.memoizedState;case 5:case 27:var Y=fn;if(!V||bv(V)){qn=0,_s=null;var tt=Y.sibling;if(tt!==null)fn=tt;else{var ht=Y.return;ht!==null?(fn=ht,Qm(ht)):fn=null}break e}}qn=0,_s=null,sd(s,o,v,5);break;case 6:qn=0,_s=null,sd(s,o,v,6);break;case 8:Gg(),Ci=6;break t;default:throw Error(A(462))}}N0();break}catch(xt){$T(s,xt)}while(!0);return Zo=Jl=null,Xt.H=f,Xt.A=_,Ei=d,fn!==null?0:($n=null,Rn=0,au(),Ci)}function N0(){for(;fn!==null&&!Ur();)Iu(fn)}function Iu(s){var o=BT(s.alternate,s,Ia);s.memoizedProps=s.pendingProps,o===null?Qm(s):fn=o}function Oa(s){var o=s,d=o.alternate;switch(o.tag){case 15:case 0:o=UT(d,o,o.pendingProps,o.type,void 0,Rn);break;case 11:o=UT(d,o,o.pendingProps,o.type.render,o.ref,Rn);break;case 5:K_(o);default:Wm(d,o),o=fn=xg(o,Ia),o=BT(d,o,Ia)}s.memoizedProps=s.pendingProps,o===null?Qm(s):fn=o}function sd(s,o,d,f){Zo=Jl=null,K_(o),Ho=null,Wc=0;var _=o.return;try{if(DT(s,_,o,d,Rn)){Ci=1,up(s,Or(d,s.current)),fn=null;return}}catch(v){if(_!==null)throw fn=_,v;Ci=1,up(s,Or(d,s.current)),fn=null;return}o.flags&32768?(On||f===1?s=!0:nl||(Rn&536870912)!==0?s=!1:(gs=s=!0,(f===2||f===3||f===6)&&(f=$s.current,f!==null&&f.tag===13&&(f.flags|=16384))),iv(o,s)):Qm(o)}function Qm(s){var o=s;do{if((o.flags&32768)!==0){iv(o,gs);return}s=o.return;var d=JT(o.alternate,o,Ia);if(d!==null){fn=d;return}if(o=o.sibling,o!==null){fn=o;return}fn=o=s}while(o!==null);Ci===0&&(Ci=5)}function iv(s,o){do{var d=w0(s.alternate,s);if(d!==null){d.flags&=32767,fn=d;return}if(d=s.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!o&&(s=s.sibling,s!==null)){fn=s;return}fn=s=d}while(s!==null);Ci=6,fn=null}function Zm(s,o,d,f,_,v,V,Y,tt,ht){var xt=Xt.T,$t=Zt.p;try{Zt.p=2,Xt.T=null,rv(s,o,d,f,$t,_,v,V,Y,tt,ht)}finally{Xt.T=xt,Zt.p=$t}}function rv(s,o,d,f,_,v,V,Y){do sc();while(il!==null);if((Ei&6)!==0)throw Error(A(327));var tt=s.finishedWork;if(f=s.finishedLanes,tt===null)return null;if(s.finishedWork=null,s.finishedLanes=0,tt===s.current)throw Error(A(177));s.callbackNode=null,s.callbackPriority=0,s.cancelPendingCommit=null;var ht=tt.lanes|tt.childLanes;if(ht|=to,ts(s,f,ht,v,V,Y),s===$n&&(fn=$n=null,Rn=0),(tt.subtreeFlags&10256)===0&&(tt.flags&10256)===0||Cp||(Cp=!0,Cu=ht,Ym=d,P0(Qn,function(){return sc(),null})),d=(tt.flags&15990)!==0,(tt.subtreeFlags&15990)!==0||d?(d=Xt.T,Xt.T=null,v=Zt.p,Zt.p=2,V=Ei,Ei|=4,C0(s,tt),Og(tt,s),dm(rS,s.containerInfo),Mp=!!iS,rS=iS=null,s.current=tt,KT(s,tt.alternate,tt),pn(),Ei=V,Zt.p=v,Xt.T=d):s.current=tt,Cp?(Cp=!1,il=s,Ru=f):sv(s,ht),ht=s.pendingLanes,ht===0&&(uo=null),Wa(tt.stateNode),ho(s),o!==null)for(_=s.onRecoverableError,tt=0;tt<o.length;tt++)ht=o[tt],_(ht.value,{componentStack:ht.stack});return(Ru&3)!==0&&sc(),ht=s.pendingLanes,(f&4194218)!==0&&(ht&42)!==0?s===Au?rd++:(rd=0,Au=s):rd=0,Du(0),null}function sv(s,o){(s.pooledCacheLanes&=o)===0&&(o=s.pooledCache,o!=null&&(s.pooledCache=null,Zh(o)))}function sc(){if(il!==null){var s=il,o=Cu;Cu=0;var d=xl(Ru),f=Xt.T,_=Zt.p;try{if(Zt.p=32>d?32:d,Xt.T=null,il===null)var v=!1;else{d=Ym,Ym=null;var V=il,Y=Ru;if(il=null,Ru=0,(Ei&6)!==0)throw Error(A(331));var tt=Ei;if(Ei|=4,Pg(V.current),Lg(V,V.current,Y,d),Ei=tt,Du(0,!1),br&&typeof br.onPostCommitFiberRoot=="function")try{br.onPostCommitFiberRoot(Oc,V)}catch{}v=!0}return v}finally{Zt.p=_,Xt.T=f,sv(s,o)}}return!1}function ac(s,o,d){o=Or(d,o),o=Jo(s.stateNode,o,2),s=Ca(s,o,2),s!==null&&(kl(s,2),ho(s))}function jn(s,o,d){if(s.tag===3)ac(s,s,d);else for(;o!==null;){if(o.tag===3){ac(o,s,d);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(uo===null||!uo.has(f))){s=Or(d,s),d=Lm(2),f=Ca(o,d,2),f!==null&&(NT(d,f,o,s),kl(f,2),ho(f));break}}o=o.return}}function Hg(s,o,d){var f=s.pingCache;if(f===null){f=s.pingCache=new QT;var _=new Set;f.set(o,_)}else _=f.get(o),_===void 0&&(_=new Set,f.set(o,_));_.has(d)||(bp=!0,_.add(d),s=D0.bind(null,s,o,d),o.then(s,s))}function D0(s,o,d){var f=s.pingCache;f!==null&&f.delete(o),s.pingedLanes|=s.suspendedLanes&d,s.warmLanes&=~d,$n===s&&(Rn&d)===d&&(Ci===4||Ci===3&&(Rn&62914560)===Rn&&300>mi()-Bg?(Ei&2)===0&&wu(s,0):jg|=d,id===Rn&&(id=0)),ho(s)}function av(s,o){o===0&&(o=Pf()),s=eo(s,o),s!==null&&(kl(s,o),ho(s))}function L0(s){var o=s.memoizedState,d=0;o!==null&&(d=o.retryLane),av(s,d)}function Wg(s,o){var d=0;switch(s.tag){case 13:var f=s.stateNode,_=s.memoizedState;_!==null&&(d=_.retryLane);break;case 19:f=s.stateNode;break;case 22:f=s.stateNode._retryCache;break;default:throw Error(A(314))}f!==null&&f.delete(o),av(s,d)}function P0(s,o){return wc(s,o)}var $m=null,Ou=null,tE=!1,Nu=!1,Kg=!1,ad=0;function ho(s){s!==Ou&&s.next===null&&(Ou===null?$m=Ou=s:Ou=Ou.next=s),Nu=!0,tE||(tE=!0,ov(zg))}function Du(s,o){if(!Kg&&Nu){Kg=!0;do for(var d=!1,f=$m;f!==null;){if(s!==0){var _=f.pendingLanes;if(_===0)var v=0;else{var V=f.suspendedLanes,Y=f.pingedLanes;v=(1<<31-$r(42|s)+1)-1,v&=_&~(V&~Y),v=v&201326677?v&201326677|1:v?v|2:0}v!==0&&(d=!0,wp(f,v))}else v=Rn,v=jd(f,f===$n?v:0),(v&3)===0||ga(f,v)||(d=!0,wp(f,v));f=f.next}while(d);Kg=!1}}function zg(){Nu=tE=!1;var s=0;ad!==0&&(x0()&&(s=ad),ad=0);for(var o=mi(),d=null,f=$m;f!==null;){var _=f.next,v=Yg(f,o);v===0?(f.next=null,d===null?$m=_:d.next=_,_===null&&(Ou=d)):(d=f,(s!==0||(v&3)!==0)&&(Nu=!0)),f=_}Du(s)}function Yg(s,o){for(var d=s.suspendedLanes,f=s.pingedLanes,_=s.expirationTimes,v=s.pendingLanes&-62914561;0<v;){var V=31-$r(v),Y=1<<V,tt=_[V];tt===-1?((Y&d)===0||(Y&f)!==0)&&(_[V]=b_(Y,o)):tt<=o&&(s.expiredLanes|=Y),v&=~Y}if(o=$n,d=Rn,d=jd(s,s===o?d:0),f=s.callbackNode,d===0||s===o&&qn===2||s.cancelPendingCommit!==null)return f!==null&&f!==null&&sr(f),s.callbackNode=null,s.callbackPriority=0;if((d&3)===0||ga(s,d)){if(o=d&-d,o===s.callbackPriority)return o;switch(f!==null&&sr(f),xl(d)){case 2:case 8:d=bn;break;case 32:d=Qn;break;case 268435456:d=Pl;break;default:d=Qn}return f=qg.bind(null,s),d=wc(d,f),s.callbackPriority=o,s.callbackNode=d,o}return f!==null&&f!==null&&sr(f),s.callbackPriority=2,s.callbackNode=null,2}function qg(s,o){var d=s.callbackNode;if(sc()&&s.callbackNode!==d)return null;var f=Rn;return f=jd(s,s===$n?f:0),f===0?null:(rl(s,f,o),Yg(s,mi()),s.callbackNode!=null&&s.callbackNode===d?qg.bind(null,s):null)}function wp(s,o){if(sc())return null;rl(s,o,!0)}function ov(s){U0(function(){(Ei&6)!==0?wc(_a,s):s()})}function Xg(){return ad===0&&(ad=Sa()),ad}function eE(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Ul(""+s)}function cv(s,o){var d=o.ownerDocument.createElement("input");return d.name=o.name,d.value=o.value,s.id&&d.setAttribute("form",s.id),o.parentNode.insertBefore(d,o),s=new FormData(s),d.parentNode.removeChild(d),s}function k0(s,o,d,f,_){if(o==="submit"&&d&&d.stateNode===_){var v=eE((_[en]||null).action),V=f.submitter;V&&(o=(o=V[en]||null)?eE(o.formAction):V.getAttribute("formAction"),o!==null&&(v=o,V=null));var Y=new wr("action","action",null,f,_);s.push({event:Y,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(ad!==0){var tt=V?cv(_,V):new FormData(_);$_(d,{pending:!0,data:tt,method:_.method,action:v},null,tt)}}else typeof v=="function"&&(Y.preventDefault(),tt=V?cv(_,V):new FormData(_),$_(d,{pending:!0,data:tt,method:_.method,action:v},v,tt))},currentTarget:_}]})}}for(var od=0;od<zh.length;od++){var Ip=zh[od],lv=Ip.toLowerCase(),Jg=Ip[0].toUpperCase()+Ip.slice(1);xs(lv,"on"+Jg)}xs(su,"onAnimationEnd"),xs(um,"onAnimationIteration"),xs(At,"onAnimationStart"),xs("dblclick","onDoubleClick"),xs("focusin","onFocus"),xs("focusout","onBlur"),xs(Xy,"onTransitionRun"),xs(Jy,"onTransitionStart"),xs(Qy,"onTransitionCancel"),xs(hm,"onTransitionEnd"),xo("onMouseEnter",["mouseout","mouseover"]),xo("onMouseLeave",["mouseout","mouseover"]),xo("onPointerEnter",["pointerout","pointerover"]),xo("onPointerLeave",["pointerout","pointerover"]),Ka("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ka("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ka("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ka("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ka("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ka("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(cd));function dv(s,o){o=(o&4)!==0;for(var d=0;d<s.length;d++){var f=s[d],_=f.event;f=f.listeners;t:{var v=void 0;if(o)for(var V=f.length-1;0<=V;V--){var Y=f[V],tt=Y.instance,ht=Y.currentTarget;if(Y=Y.listener,tt!==v&&_.isPropagationStopped())break t;v=Y,_.currentTarget=ht;try{v(_)}catch(xt){Dm(xt)}_.currentTarget=null,v=tt}else for(V=0;V<f.length;V++){if(Y=f[V],tt=Y.instance,ht=Y.currentTarget,Y=Y.listener,tt!==v&&_.isPropagationStopped())break t;v=Y,_.currentTarget=ht;try{v(_)}catch(xt){Dm(xt)}_.currentTarget=null,v=tt}}}}function Cn(s,o){var d=o[Eh];d===void 0&&(d=o[Eh]=new Set);var f=s+"__bubble";d.has(f)||(Zg(o,s,2,!1),d.add(f))}function nE(s,o,d){var f=0;o&&(f|=4),Zg(d,s,f,o)}var Op="_reactListening"+Math.random().toString(36).slice(2);function iE(s){if(!s[Op]){s[Op]=!0,yi.forEach(function(d){d!=="selectionchange"&&(Qg.has(d)||nE(d,!1,s),nE(d,!0,s))});var o=s.nodeType===9?s:s.ownerDocument;o===null||o[Op]||(o[Op]=!0,nE("selectionchange",!1,o))}}function Zg(s,o,d,f){switch(Nv(o)){case 2:var _=mS;break;case 8:_=Ov;break;default:_=Up}d=_.bind(null,o,d,s),_=void 0,!Ah||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(_=!0),f?_!==void 0?s.addEventListener(o,d,{capture:!0,passive:_}):s.addEventListener(o,d,!0):_!==void 0?s.addEventListener(o,d,{passive:_}):s.addEventListener(o,d,!1)}function rE(s,o,d,f,_){var v=f;if((o&1)===0&&(o&2)===0&&f!==null)t:for(;;){if(f===null)return;var V=f.tag;if(V===3||V===4){var Y=f.stateNode.containerInfo;if(Y===_||Y.nodeType===8&&Y.parentNode===_)break;if(V===4)for(V=f.return;V!==null;){var tt=V.tag;if((tt===3||tt===4)&&(tt=V.stateNode.containerInfo,tt===_||tt.nodeType===8&&tt.parentNode===_))return;V=V.return}for(;Y!==null;){if(V=Ns(Y),V===null)return;if(tt=V.tag,tt===5||tt===6||tt===26||tt===27){f=v=V;continue t}Y=Y.parentNode}}f=f.return}Gf(function(){var ht=v,xt=jl(d),$t=[];t:{var vt=pm.get(s);if(vt!==void 0){var Pt=wr,Ce=s;switch(s){case"keypress":if(Fl(d)===0)break t;case"keydown":case"keyup":Pt=N_;break;case"focusin":Ce="focus",Pt=Ih;break;case"focusout":Ce="blur",Pt=Ih;break;case"beforeblur":case"afterblur":Pt=Ih;break;case"click":if(d.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Pt=Kf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Pt=Xa;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Pt=Mc;break;case su:case um:case At:Pt=qf;break;case hm:Pt=Qf;break;case"scroll":case"scrollend":Pt=A_;break;case"wheel":Pt=Ph;break;case"copy":case"cut":case"paste":Pt=Nh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Pt=Za;break;case"toggle":case"beforetoggle":Pt=$f}var Je=(o&4)!==0,vi=!Je&&(s==="scroll"||s==="scrollend"),mt=Je?vt!==null?vt+"Capture":null:vt;Je=[];for(var ut=ht,gt;ut!==null;){var zt=ut;if(gt=zt.stateNode,zt=zt.tag,zt!==5&&zt!==26&&zt!==27||gt===null||mt===null||(zt=Vl(ut,mt),zt!=null&&Je.push(Np(ut,zt,gt))),vi)break;ut=ut.return}0<Je.length&&(vt=new Pt(vt,Ce,null,d,xt),$t.push({event:vt,listeners:Je}))}}if((o&7)===0){t:{if(vt=s==="mouseover"||s==="pointerover",Pt=s==="mouseout"||s==="pointerout",vt&&d!==Ch&&(Ce=d.relatedTarget||d.fromElement)&&(Ns(Ce)||Ce[Po]))break t;if((Pt||vt)&&(vt=xt.window===xt?xt:(vt=xt.ownerDocument)?vt.defaultView||vt.parentWindow:window,Pt?(Ce=d.relatedTarget||d.toElement,Pt=ht,Ce=Ce?Ns(Ce):null,Ce!==null&&(vi=se(Ce),Je=Ce.tag,Ce!==vi||Je!==5&&Je!==27&&Je!==6)&&(Ce=null)):(Pt=null,Ce=ht),Pt!==Ce)){if(Je=Kf,zt="onMouseLeave",mt="onMouseEnter",ut="mouse",(s==="pointerout"||s==="pointerover")&&(Je=Za,zt="onPointerLeave",mt="onPointerEnter",ut="pointer"),vi=Pt==null?vt:ar(Pt),gt=Ce==null?vt:ar(Ce),vt=new Je(zt,ut+"leave",Pt,d,xt),vt.target=vi,vt.relatedTarget=gt,zt=null,Ns(xt)===ht&&(Je=new Je(mt,ut+"enter",Ce,d,xt),Je.target=gt,Je.relatedTarget=vi,zt=Je),vi=zt,Pt&&Ce)e:{for(Je=Pt,mt=Ce,ut=0,gt=Je;gt;gt=Lu(gt))ut++;for(gt=0,zt=mt;zt;zt=Lu(zt))gt++;for(;0<ut-gt;)Je=Lu(Je),ut--;for(;0<gt-ut;)mt=Lu(mt),gt--;for(;ut--;){if(Je===mt||mt!==null&&Je===mt.alternate)break e;Je=Lu(Je),mt=Lu(mt)}Je=null}else Je=null;Pt!==null&&ld($t,vt,Pt,Je,!1),Ce!==null&&vi!==null&&ld($t,vi,Ce,Je,!0)}}t:{if(vt=ht?ar(ht):window,Pt=vt.nodeName&&vt.nodeName.toLowerCase(),Pt==="select"||Pt==="input"&&vt.type==="file")var Te=rm;else if(nm(vt))if(sm)Te=L_;else{Te=nu;var Me=om}else Pt=vt.nodeName,!Pt||Pt.toLowerCase()!=="input"||vt.type!=="checkbox"&&vt.type!=="radio"?ht&&zd(ht.elementType)&&(Te=rm):Te=Fh;if(Te&&(Te=Te(s,ht))){jh($t,Te,d,xt);break t}Me&&Me(s,vt,ht),s==="focusout"&&ht&&vt.type==="number"&&ht.memoizedProps.value!=null&&vh(vt,"number",vt.value)}switch(Me=ht?ar(ht):window,s){case"focusin":(nm(Me)||Me.contentEditable==="true")&&(Vc=Me,Gh=ht,Bc=null);break;case"focusout":Bc=Gh=Vc=null;break;case"mousedown":ru=!0;break;case"contextmenu":case"mouseup":case"dragend":ru=!1,Hh($t,d,xt);break;case"selectionchange":if(P_)break;case"keydown":case"keyup":Hh($t,d,xt)}var Oe;if($a)t:{switch(s){case"compositionstart":var je="onCompositionStart";break t;case"compositionend":je="onCompositionEnd";break t;case"compositionupdate":je="onCompositionUpdate";break t}je=void 0}else Uo?Uh(s,d)&&(je="onCompositionEnd"):s==="keydown"&&d.keyCode===229&&(je="onCompositionStart");je&&(xh&&d.locale!=="ko"&&(Uo||je!=="onCompositionStart"?je==="onCompositionEnd"&&Uo&&(Oe=Hf()):(qa=xt,qd="value"in qa?qa.value:qa.textContent,Uo=!0)),Me=Dp(ht,je),0<Me.length&&(je=new Xf(je,s,null,d,xt),$t.push({event:je,listeners:Me}),Oe?je.data=Oe:(Oe=$d(d),Oe!==null&&(je.data=Oe)))),(Oe=tm?Xs(s,d):em(s,d))&&(je=Dp(ht,"onBeforeInput"),0<je.length&&(Me=new Xf("onBeforeInput","beforeinput",null,d,xt),$t.push({event:Me,listeners:je}),Me.data=Oe)),k0($t,s,ht,d,xt)}dv($t,o)})}function Np(s,o,d){return{instance:s,listener:o,currentTarget:d}}function Dp(s,o){for(var d=o+"Capture",f=[];s!==null;){var _=s,v=_.stateNode;_=_.tag,_!==5&&_!==26&&_!==27||v===null||(_=Vl(s,d),_!=null&&f.unshift(Np(s,_,v)),_=Vl(s,o),_!=null&&f.push(Np(s,_,v))),s=s.return}return f}function Lu(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function ld(s,o,d,f,_){for(var v=o._reactName,V=[];d!==null&&d!==f;){var Y=d,tt=Y.alternate,ht=Y.stateNode;if(Y=Y.tag,tt!==null&&tt===f)break;Y!==5&&Y!==26&&Y!==27||ht===null||(tt=ht,_?(ht=Vl(d,v),ht!=null&&V.unshift(Np(d,ht,tt))):_||(ht=Vl(d,v),ht!=null&&V.push(Np(d,ht,tt)))),d=d.return}V.length!==0&&s.push({event:o,listeners:V})}var Pu=/\r\n?/g,$g=/\u0000|\uFFFD/g;function tS(s){return(typeof s=="string"?s:""+s).replace(Pu,`
`).replace($g,"")}function eS(s,o){return o=tS(o),tS(s)===o}function sE(){}function Xn(s,o,d,f,_,v){switch(d){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||Ya(s,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&Ya(s,""+f);break;case"className":Lc(s,"class",f);break;case"tabIndex":Lc(s,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Lc(s,d,f);break;case"style":Rh(s,f,v);break;case"data":if(o!=="object"){Lc(s,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||d!=="href")){s.removeAttribute(d);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(d);break}f=Ul(""+f),s.setAttribute(d,f);break;case"action":case"formAction":if(typeof f=="function"){s.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(d==="formAction"?(o!=="input"&&Xn(s,o,"name",_.name,_,null),Xn(s,o,"formEncType",_.formEncType,_,null),Xn(s,o,"formMethod",_.formMethod,_,null),Xn(s,o,"formTarget",_.formTarget,_,null)):(Xn(s,o,"encType",_.encType,_,null),Xn(s,o,"method",_.method,_,null),Xn(s,o,"target",_.target,_,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(d);break}f=Ul(""+f),s.setAttribute(d,f);break;case"onClick":f!=null&&(s.onclick=sE);break;case"onScroll":f!=null&&Cn("scroll",s);break;case"onScrollEnd":f!=null&&Cn("scrollend",s);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(A(61));if(d=f.__html,d!=null){if(_.children!=null)throw Error(A(60));s.innerHTML=d}}break;case"multiple":s.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":s.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){s.removeAttribute("xlink:href");break}d=Ul(""+f),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(d,""+f):s.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(d,""):s.removeAttribute(d);break;case"capture":case"download":f===!0?s.setAttribute(d,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(d,f):s.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?s.setAttribute(d,f):s.removeAttribute(d);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?s.removeAttribute(d):s.setAttribute(d,f);break;case"popover":Cn("beforetoggle",s),Cn("toggle",s),Fd(s,"popover",f);break;case"xlinkActuate":Rr(s,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Rr(s,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Rr(s,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Rr(s,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Rr(s,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Rr(s,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Rr(s,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Rr(s,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Rr(s,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Fd(s,"is",f);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=C_.get(d)||d,Fd(s,d,f))}}function nS(s,o,d,f,_,v){switch(d){case"style":Rh(s,f,v);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(A(61));if(d=f.__html,d!=null){if(_.children!=null)throw Error(A(60));s.innerHTML=d}}break;case"children":typeof f=="string"?Ya(s,f):(typeof f=="number"||typeof f=="bigint")&&Ya(s,""+f);break;case"onScroll":f!=null&&Cn("scroll",s);break;case"onScrollEnd":f!=null&&Cn("scrollend",s);break;case"onClick":f!=null&&(s.onclick=sE);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Uf.hasOwnProperty(d))t:{if(d[0]==="o"&&d[1]==="n"&&(_=d.endsWith("Capture"),o=d.slice(2,_?d.length-7:void 0),v=s[en]||null,v=v!=null?v[d]:null,typeof v=="function"&&s.removeEventListener(o,v,_),typeof f=="function")){typeof v!="function"&&v!==null&&(d in s?s[d]=null:s.hasAttribute(d)&&s.removeAttribute(d)),s.addEventListener(o,f,_);break t}d in s?s[d]=f:f===!0?s.setAttribute(d,""):Fd(s,d,f)}}}function Dr(s,o,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Cn("error",s),Cn("load",s);var f=!1,_=!1,v;for(v in d)if(d.hasOwnProperty(v)){var V=d[v];if(V!=null)switch(v){case"src":f=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(A(137,o));default:Xn(s,o,v,V,d,null)}}_&&Xn(s,o,"srcSet",d.srcSet,d,null),f&&Xn(s,o,"src",d.src,d,null);return;case"input":Cn("invalid",s);var Y=v=V=_=null,tt=null,ht=null;for(f in d)if(d.hasOwnProperty(f)){var xt=d[f];if(xt!=null)switch(f){case"name":_=xt;break;case"type":V=xt;break;case"checked":tt=xt;break;case"defaultChecked":ht=xt;break;case"value":v=xt;break;case"defaultValue":Y=xt;break;case"children":case"dangerouslySetInnerHTML":if(xt!=null)throw Error(A(137,o));break;default:Xn(s,o,f,xt,d,null)}}Vf(s,v,Y,tt,ht,V,_,!1),Gd(s);return;case"select":Cn("invalid",s),f=V=v=null;for(_ in d)if(d.hasOwnProperty(_)&&(Y=d[_],Y!=null))switch(_){case"value":v=Y;break;case"defaultValue":V=Y;break;case"multiple":f=Y;default:Xn(s,o,_,Y,d,null)}o=v,d=V,s.multiple=!!f,o!=null?Pc(s,!!f,o,!1):d!=null&&Pc(s,!!f,d,!0);return;case"textarea":Cn("invalid",s),v=_=f=null;for(V in d)if(d.hasOwnProperty(V)&&(Y=d[V],Y!=null))switch(V){case"value":f=Y;break;case"defaultValue":_=Y;break;case"children":v=Y;break;case"dangerouslySetInnerHTML":if(Y!=null)throw Error(A(91));break;default:Xn(s,o,V,Y,d,null)}bh(s,f,_,v),Gd(s);return;case"option":for(tt in d)if(d.hasOwnProperty(tt)&&(f=d[tt],f!=null))switch(tt){case"selected":s.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:Xn(s,o,tt,f,d,null)}return;case"dialog":Cn("cancel",s),Cn("close",s);break;case"iframe":case"object":Cn("load",s);break;case"video":case"audio":for(f=0;f<cd.length;f++)Cn(cd[f],s);break;case"image":Cn("error",s),Cn("load",s);break;case"details":Cn("toggle",s);break;case"embed":case"source":case"link":Cn("error",s),Cn("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ht in d)if(d.hasOwnProperty(ht)&&(f=d[ht],f!=null))switch(ht){case"children":case"dangerouslySetInnerHTML":throw Error(A(137,o));default:Xn(s,o,ht,f,d,null)}return;default:if(zd(o)){for(xt in d)d.hasOwnProperty(xt)&&(f=d[xt],f!==void 0&&nS(s,o,xt,f,d,void 0));return}}for(Y in d)d.hasOwnProperty(Y)&&(f=d[Y],f!=null&&Xn(s,o,Y,f,d,null))}function aE(s,o,d,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,v=null,V=null,Y=null,tt=null,ht=null,xt=null;for(Pt in d){var $t=d[Pt];if(d.hasOwnProperty(Pt)&&$t!=null)switch(Pt){case"checked":break;case"value":break;case"defaultValue":tt=$t;default:f.hasOwnProperty(Pt)||Xn(s,o,Pt,null,f,$t)}}for(var vt in f){var Pt=f[vt];if($t=d[vt],f.hasOwnProperty(vt)&&(Pt!=null||$t!=null))switch(vt){case"type":v=Pt;break;case"name":_=Pt;break;case"checked":ht=Pt;break;case"defaultChecked":xt=Pt;break;case"value":V=Pt;break;case"defaultValue":Y=Pt;break;case"children":case"dangerouslySetInnerHTML":if(Pt!=null)throw Error(A(137,o));break;default:Pt!==$t&&Xn(s,o,vt,Pt,f,$t)}}Wd(s,V,Y,tt,ht,xt,v,_);return;case"select":Pt=V=Y=vt=null;for(v in d)if(tt=d[v],d.hasOwnProperty(v)&&tt!=null)switch(v){case"value":break;case"multiple":Pt=tt;default:f.hasOwnProperty(v)||Xn(s,o,v,null,f,tt)}for(_ in f)if(v=f[_],tt=d[_],f.hasOwnProperty(_)&&(v!=null||tt!=null))switch(_){case"value":vt=v;break;case"defaultValue":Y=v;break;case"multiple":V=v;default:v!==tt&&Xn(s,o,_,v,f,tt)}o=Y,d=V,f=Pt,vt!=null?Pc(s,!!d,vt,!1):!!f!=!!d&&(o!=null?Pc(s,!!d,o,!0):Pc(s,!!d,d?[]:"",!1));return;case"textarea":Pt=vt=null;for(Y in d)if(_=d[Y],d.hasOwnProperty(Y)&&_!=null&&!f.hasOwnProperty(Y))switch(Y){case"value":break;case"children":break;default:Xn(s,o,Y,null,f,_)}for(V in f)if(_=f[V],v=d[V],f.hasOwnProperty(V)&&(_!=null||v!=null))switch(V){case"value":vt=_;break;case"defaultValue":Pt=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(A(91));break;default:_!==v&&Xn(s,o,V,_,f,v)}Ml(s,vt,Pt);return;case"option":for(var Ce in d)if(vt=d[Ce],d.hasOwnProperty(Ce)&&vt!=null&&!f.hasOwnProperty(Ce))switch(Ce){case"selected":s.selected=!1;break;default:Xn(s,o,Ce,null,f,vt)}for(tt in f)if(vt=f[tt],Pt=d[tt],f.hasOwnProperty(tt)&&vt!==Pt&&(vt!=null||Pt!=null))switch(tt){case"selected":s.selected=vt&&typeof vt!="function"&&typeof vt!="symbol";break;default:Xn(s,o,tt,vt,f,Pt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Je in d)vt=d[Je],d.hasOwnProperty(Je)&&vt!=null&&!f.hasOwnProperty(Je)&&Xn(s,o,Je,null,f,vt);for(ht in f)if(vt=f[ht],Pt=d[ht],f.hasOwnProperty(ht)&&vt!==Pt&&(vt!=null||Pt!=null))switch(ht){case"children":case"dangerouslySetInnerHTML":if(vt!=null)throw Error(A(137,o));break;default:Xn(s,o,ht,vt,f,Pt)}return;default:if(zd(o)){for(var vi in d)vt=d[vi],d.hasOwnProperty(vi)&&vt!==void 0&&!f.hasOwnProperty(vi)&&nS(s,o,vi,void 0,f,vt);for(xt in f)vt=f[xt],Pt=d[xt],!f.hasOwnProperty(xt)||vt===Pt||vt===void 0&&Pt===void 0||nS(s,o,xt,vt,f,Pt);return}}for(var mt in d)vt=d[mt],d.hasOwnProperty(mt)&&vt!=null&&!f.hasOwnProperty(mt)&&Xn(s,o,mt,null,f,vt);for($t in f)vt=f[$t],Pt=d[$t],!f.hasOwnProperty($t)||vt===Pt||vt==null&&Pt==null||Xn(s,o,$t,vt,f,Pt)}var iS=null,rS=null;function oE(s){return s.nodeType===9?s:s.ownerDocument}function uv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function hv(s,o){if(s===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&o==="foreignObject"?0:s}function sS(s,o){return s==="textarea"||s==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var aS=null;function x0(){var s=window.event;return s&&s.type==="popstate"?s===aS?!1:(aS=s,!0):(aS=null,!1)}var pv=typeof setTimeout=="function"?setTimeout:void 0,M0=typeof clearTimeout=="function"?clearTimeout:void 0,fv=typeof Promise=="function"?Promise:void 0,U0=typeof queueMicrotask=="function"?queueMicrotask:typeof fv<"u"?function(s){return fv.resolve(null).then(s).catch(j0)}:pv;function j0(s){setTimeout(function(){throw s})}function oS(s,o){var d=o,f=0;do{var _=d.nextSibling;if(s.removeChild(d),_&&_.nodeType===8)if(d=_.data,d==="/$"){if(f===0){s.removeChild(_),Fp(o);return}f--}else d!=="$"&&d!=="$?"&&d!=="$!"||f++;d=_}while(d);Fp(o)}function cS(s){var o=s.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var d=o;switch(o=o.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":cS(d),qs(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}s.removeChild(d)}}function V0(s,o,d,f){for(;s.nodeType===1;){var _=d;if(s.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(f){if(!s[Dc])switch(o){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(v=s.getAttribute("rel"),v==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(v!==_.rel||s.getAttribute("href")!==(_.href==null?null:_.href)||s.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||s.getAttribute("title")!==(_.title==null?null:_.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(v=s.getAttribute("src"),(v!==(_.src==null?null:_.src)||s.getAttribute("type")!==(_.type==null?null:_.type)||s.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&v&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(o==="input"&&s.type==="hidden"){var v=_.name==null?null:""+_.name;if(_.type==="hidden"&&s.getAttribute("name")===v)return s}else return s;if(s=na(s.nextSibling),s===null)break}return null}function B0(s,o,d){if(o==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!d||(s=na(s.nextSibling),s===null))return null;return s}function na(s){for(;s!=null;s=s.nextSibling){var o=s.nodeType;if(o===1||o===3)break;if(o===8){if(o=s.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return s}function mv(s){s=s.previousSibling;for(var o=0;s;){if(s.nodeType===8){var d=s.data;if(d==="$"||d==="$!"||d==="$?"){if(o===0)return s;o--}else d==="/$"&&o++}s=s.previousSibling}return null}function Ev(s,o,d){switch(o=oE(d),s){case"html":if(s=o.documentElement,!s)throw Error(A(452));return s;case"head":if(s=o.head,!s)throw Error(A(453));return s;case"body":if(s=o.body,!s)throw Error(A(454));return s;default:throw Error(A(451))}}var ia=new Map,_v=new Set;function cE(s){return typeof s.getRootNode=="function"?s.getRootNode():s.ownerDocument}var oc=Zt.d;Zt.d={f:F0,r:G0,D:H0,C:W0,L:K0,m:z0,X:q0,S:Y0,M:X0};function F0(){var s=oc.f(),o=Xm();return s||o}function G0(s){var o=ko(s);o!==null&&o.tag===5&&o.type==="form"?AT(o):oc.r(s)}var ku=typeof document>"u"?null:document;function gv(s,o,d){var f=ku;if(f&&typeof o=="string"&&o){var _=Ar(o);_='link[rel="'+s+'"][href="'+_+'"]',typeof d=="string"&&(_+='[crossorigin="'+d+'"]'),_v.has(_)||(_v.add(_),s={rel:s,crossOrigin:d,href:o},f.querySelector(_)===null&&(o=f.createElement("link"),Dr(o,"link",s),Yi(o),f.head.appendChild(o)))}}function H0(s){oc.D(s),gv("dns-prefetch",s,null)}function W0(s,o){oc.C(s,o),gv("preconnect",s,o)}function K0(s,o,d){oc.L(s,o,d);var f=ku;if(f&&s&&o){var _='link[rel="preload"][as="'+Ar(o)+'"]';o==="image"&&d&&d.imageSrcSet?(_+='[imagesrcset="'+Ar(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(_+='[imagesizes="'+Ar(d.imageSizes)+'"]')):_+='[href="'+Ar(s)+'"]';var v=_;switch(o){case"style":v=xu(s);break;case"script":v=Mu(s)}ia.has(v)||(s=Qt({rel:"preload",href:o==="image"&&d&&d.imageSrcSet?void 0:s,as:o},d),ia.set(v,s),f.querySelector(_)!==null||o==="style"&&f.querySelector(dd(v))||o==="script"&&f.querySelector(Lp(v))||(o=f.createElement("link"),Dr(o,"link",s),Yi(o),f.head.appendChild(o)))}}function z0(s,o){oc.m(s,o);var d=ku;if(d&&s){var f=o&&typeof o.as=="string"?o.as:"script",_='link[rel="modulepreload"][as="'+Ar(f)+'"][href="'+Ar(s)+'"]',v=_;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=Mu(s)}if(!ia.has(v)&&(s=Qt({rel:"modulepreload",href:s},o),ia.set(v,s),d.querySelector(_)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(Lp(v)))return}f=d.createElement("link"),Dr(f,"link",s),Yi(f),d.head.appendChild(f)}}}function Y0(s,o,d){oc.S(s,o,d);var f=ku;if(f&&s){var _=Zn(f).hoistableStyles,v=xu(s);o=o||"default";var V=_.get(v);if(!V){var Y={loading:0,preload:null};if(V=f.querySelector(dd(v)))Y.loading=5;else{s=Qt({rel:"stylesheet",href:s,"data-precedence":o},d),(d=ia.get(v))&&Pp(s,d);var tt=V=f.createElement("link");Yi(tt),Dr(tt,"link",s),tt._p=new Promise(function(ht,xt){tt.onload=ht,tt.onerror=xt}),tt.addEventListener("load",function(){Y.loading|=1}),tt.addEventListener("error",function(){Y.loading|=2}),Y.loading|=4,lE(V,o,f)}V={type:"stylesheet",instance:V,count:1,state:Y},_.set(v,V)}}}function q0(s,o){oc.X(s,o);var d=ku;if(d&&s){var f=Zn(d).hoistableScripts,_=Mu(s),v=f.get(_);v||(v=d.querySelector(Lp(_)),v||(s=Qt({src:s,async:!0},o),(o=ia.get(_))&&uS(s,o),v=d.createElement("script"),Yi(v),Dr(v,"link",s),d.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},f.set(_,v))}}function X0(s,o){oc.M(s,o);var d=ku;if(d&&s){var f=Zn(d).hoistableScripts,_=Mu(s),v=f.get(_);v||(v=d.querySelector(Lp(_)),v||(s=Qt({src:s,async:!0,type:"module"},o),(o=ia.get(_))&&uS(s,o),v=d.createElement("script"),Yi(v),Dr(v,"link",s),d.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},f.set(_,v))}}function lS(s,o,d,f){var _=(_=pr.current)?cE(_):null;if(!_)throw Error(A(446));switch(s){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(o=xu(d.href),d=Zn(_).hoistableStyles,f=d.get(o),f||(f={type:"style",instance:null,count:0,state:null},d.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){s=xu(d.href);var v=Zn(_).hoistableStyles,V=v.get(s);if(V||(_=_.ownerDocument||_,V={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(s,V),(v=_.querySelector(dd(s)))&&!v._p&&(V.instance=v,V.state.loading=5),ia.has(s)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},ia.set(s,d),v||J0(_,s,d,V.state))),o&&f===null)throw Error(A(528,""));return V}if(o&&f!==null)throw Error(A(529,""));return null;case"script":return o=d.async,d=d.src,typeof d=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Mu(d),d=Zn(_).hoistableScripts,f=d.get(o),f||(f={type:"script",instance:null,count:0,state:null},d.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(A(444,s))}}function xu(s){return'href="'+Ar(s)+'"'}function dd(s){return'link[rel="stylesheet"]['+s+"]"}function Sv(s){return Qt({},s,{"data-precedence":s.precedence,precedence:null})}function J0(s,o,d,f){s.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=s.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),Dr(o,"link",d),Yi(o),s.head.appendChild(o))}function Mu(s){return'[src="'+Ar(s)+'"]'}function Lp(s){return"script[async]"+s}function dS(s,o,d){if(o.count++,o.instance===null)switch(o.type){case"style":var f=s.querySelector('style[data-href~="'+Ar(d.href)+'"]');if(f)return o.instance=f,Yi(f),f;var _=Qt({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return f=(s.ownerDocument||s).createElement("style"),Yi(f),Dr(f,"style",_),lE(f,d.precedence,s),o.instance=f;case"stylesheet":_=xu(d.href);var v=s.querySelector(dd(_));if(v)return o.state.loading|=4,o.instance=v,Yi(v),v;f=Sv(d),(_=ia.get(_))&&Pp(f,_),v=(s.ownerDocument||s).createElement("link"),Yi(v);var V=v;return V._p=new Promise(function(Y,tt){V.onload=Y,V.onerror=tt}),Dr(v,"link",f),o.state.loading|=4,lE(v,d.precedence,s),o.instance=v;case"script":return v=Mu(d.src),(_=s.querySelector(Lp(v)))?(o.instance=_,Yi(_),_):(f=d,(_=ia.get(v))&&(f=Qt({},d),uS(f,_)),s=s.ownerDocument||s,_=s.createElement("script"),Yi(_),Dr(_,"link",f),s.head.appendChild(_),o.instance=_);case"void":return null;default:throw Error(A(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,lE(f,d.precedence,s));return o.instance}function lE(s,o,d){for(var f=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=f.length?f[f.length-1]:null,v=_,V=0;V<f.length;V++){var Y=f[V];if(Y.dataset.precedence===o)v=Y;else if(v!==_)break}v?v.parentNode.insertBefore(s,v.nextSibling):(o=d.nodeType===9?d.head:d,o.insertBefore(s,o.firstChild))}function Pp(s,o){s.crossOrigin==null&&(s.crossOrigin=o.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=o.referrerPolicy),s.title==null&&(s.title=o.title)}function uS(s,o){s.crossOrigin==null&&(s.crossOrigin=o.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=o.referrerPolicy),s.integrity==null&&(s.integrity=o.integrity)}var dE=null;function yv(s,o,d){if(dE===null){var f=new Map,_=dE=new Map;_.set(d,f)}else _=dE,f=_.get(d),f||(f=new Map,_.set(d,f));if(f.has(s))return f;for(f.set(s,null),d=d.getElementsByTagName(s),_=0;_<d.length;_++){var v=d[_];if(!(v[Dc]||v[mr]||s==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var V=v.getAttribute(o)||"";V=s+V;var Y=f.get(V);Y?Y.push(v):f.set(V,[v])}}return f}function Tv(s,o,d){s=s.ownerDocument||s,s.head.insertBefore(d,o==="title"?s.querySelector("head > title"):null)}function vv(s,o,d){if(d===1||o.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return s=o.disabled,typeof o.precedence=="string"&&s==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function bv(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var Uu=null;function hS(){}function Q0(s,o,d){if(Uu===null)throw Error(A(475));var f=Uu;if(o.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var _=xu(d.href),v=s.querySelector(dd(_));if(v){s=v._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(f.count++,f=kp.bind(f),s.then(f,f)),o.state.loading|=4,o.instance=v,Yi(v);return}v=s.ownerDocument||s,d=Sv(d),(_=ia.get(_))&&Pp(d,_),v=v.createElement("link"),Yi(v);var V=v;V._p=new Promise(function(Y,tt){V.onload=Y,V.onerror=tt}),Dr(v,"link",d),o.instance=v}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(o,s),(s=o.state.preload)&&(o.state.loading&3)===0&&(f.count++,o=kp.bind(f),s.addEventListener("load",o),s.addEventListener("error",o))}}function Z0(){if(Uu===null)throw Error(A(475));var s=Uu;return s.stylesheets&&s.count===0&&hE(s,s.stylesheets),0<s.count?function(o){var d=setTimeout(function(){if(s.stylesheets&&hE(s,s.stylesheets),s.unsuspend){var f=s.unsuspend;s.unsuspend=null,f()}},6e4);return s.unsuspend=o,function(){s.unsuspend=null,clearTimeout(d)}}:null}function kp(){if(this.count--,this.count===0){if(this.stylesheets)hE(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var uE=null;function hE(s,o){s.stylesheets=null,s.unsuspend!==null&&(s.count++,uE=new Map,o.forEach(Rv,s),uE=null,kp.call(s))}function Rv(s,o){if(!(o.state.loading&4)){var d=uE.get(s);if(d)var f=d.get(null);else{d=new Map,uE.set(s,d);for(var _=s.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<_.length;v++){var V=_[v];(V.nodeName==="LINK"||V.getAttribute("media")!=="not all")&&(d.set(V.dataset.precedence,V),f=V)}f&&d.set(null,f)}_=o.instance,V=_.getAttribute("data-precedence"),v=d.get(V)||f,v===f&&d.set(null,_),d.set(V,_),this.count++,f=kp.bind(this),_.addEventListener("load",f),_.addEventListener("error",f),v?v.parentNode.insertBefore(_,v.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(_,s.firstChild)),o.state.loading|=4}}var xp={$$typeof:X,Provider:null,Consumer:null,_currentValue:Lt,_currentValue2:Lt,_threadCount:0};function $0(s,o,d,f,_,v,V,Y){this.tag=1,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=fh(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fh(0),this.hiddenUpdates=fh(null),this.identifierPrefix=f,this.onUncaughtError=_,this.onCaughtError=v,this.onRecoverableError=V,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Y,this.incompleteTransitions=new Map}function Cv(s,o,d,f,_,v,V,Y,tt,ht,xt,$t){return s=new $0(s,o,d,V,Y,tt,ht,$t),o=1,v===!0&&(o|=24),v=Vs(3,null,null,o),s.current=v,v.stateNode=s,o=j_(),o.refCount++,s.pooledCache=o,o.refCount++,v.memoizedState={element:f,isDehydrated:d,cache:o},Tu(v),s}function Av(s){return s?(s=no,s):no}function wv(s,o,d,f,_,v){_=Av(_),f.context===null?f.context=_:f.pendingContext=_,f=tc(o),f.payload={element:d},v=v===void 0?null:v,v!==null&&(f.callback=v),d=Ca(s,f,o),d!==null&&(Ji(d,s,o),vu(d,s,o))}function Iv(s,o){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var d=s.retryLane;s.retryLane=d!==0&&d<o?d:o}}function pS(s,o){Iv(s,o),(s=s.alternate)&&Iv(s,o)}function fS(s){if(s.tag===13){var o=eo(s,67108864);o!==null&&Ji(o,s,67108864),pS(s,67108864)}}var Mp=!0;function mS(s,o,d,f){var _=Xt.T;Xt.T=null;var v=Zt.p;try{Zt.p=2,Up(s,o,d,f)}finally{Zt.p=v,Xt.T=_}}function Ov(s,o,d,f){var _=Xt.T;Xt.T=null;var v=Zt.p;try{Zt.p=8,Up(s,o,d,f)}finally{Zt.p=v,Xt.T=_}}function Up(s,o,d,f){if(Mp){var _=pE(f);if(_===null)rE(s,o,f,wt,d),Dv(s,f);else if(eC(_,s,o,d,f))f.stopPropagation();else if(Dv(s,f),o&4&&-1<tC.indexOf(s)){for(;_!==null;){var v=ko(_);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var V=Lo(v.pendingLanes);if(V!==0){var Y=v;for(Y.pendingLanes|=2,Y.entangledLanes|=2;V;){var tt=1<<31-$r(V);Y.entanglements[1]|=tt,V&=~tt}ho(v),(Ei&6)===0&&(Km=mi()+500,Du(0))}}break;case 13:Y=eo(v,2),Y!==null&&Ji(Y,v,2),Xm(),pS(v,2)}if(v=pE(f),v===null&&rE(s,o,f,wt,d),v===_)break;_=v}_!==null&&f.stopPropagation()}else rE(s,o,f,null,d)}}function pE(s){return s=jl(s),ES(s)}var wt=null;function ES(s){if(wt=null,s=Ns(s),s!==null){var o=se(s);if(o===null)s=null;else{var d=o.tag;if(d===13){if(s=be(o),s!==null)return s;s=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;s=null}else o!==s&&(s=null)}}return wt=s,null}function Nv(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ha()){case _a:return 2;case bn:return 8;case Qn:case Md:return 32;case Pl:return 268435456;default:return 32}default:return 32}}var _S=!1,sl=null,al=null,po=null,jp=new Map,Vp=new Map,Fi=[],tC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Dv(s,o){switch(s){case"focusin":case"focusout":sl=null;break;case"dragenter":case"dragleave":al=null;break;case"mouseover":case"mouseout":po=null;break;case"pointerover":case"pointerout":jp.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vp.delete(o.pointerId)}}function ud(s,o,d,f,_,v){return s===null||s.nativeEvent!==v?(s={blockedOn:o,domEventName:d,eventSystemFlags:f,nativeEvent:v,targetContainers:[_]},o!==null&&(o=ko(o),o!==null&&fS(o)),s):(s.eventSystemFlags|=f,o=s.targetContainers,_!==null&&o.indexOf(_)===-1&&o.push(_),s)}function eC(s,o,d,f,_){switch(o){case"focusin":return sl=ud(sl,s,o,d,f,_),!0;case"dragenter":return al=ud(al,s,o,d,f,_),!0;case"mouseover":return po=ud(po,s,o,d,f,_),!0;case"pointerover":var v=_.pointerId;return jp.set(v,ud(jp.get(v)||null,s,o,d,f,_)),!0;case"gotpointercapture":return v=_.pointerId,Vp.set(v,ud(Vp.get(v)||null,s,o,d,f,_)),!0}return!1}function Lv(s){var o=Ns(s.target);if(o!==null){var d=se(o);if(d!==null){if(o=d.tag,o===13){if(o=be(d),o!==null){s.blockedOn=o,xf(s.priority,function(){if(d.tag===13){var f=Kr(),_=eo(d,f);_!==null&&Ji(_,d,f),pS(d,f)}});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){s.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}s.blockedOn=null}function fE(s){if(s.blockedOn!==null)return!1;for(var o=s.targetContainers;0<o.length;){var d=pE(s.nativeEvent);if(d===null){d=s.nativeEvent;var f=new d.constructor(d.type,d);Ch=f,d.target.dispatchEvent(f),Ch=null}else return o=ko(d),o!==null&&fS(o),s.blockedOn=d,!1;o.shift()}return!0}function Pv(s,o,d){fE(s)&&d.delete(o)}function mE(){_S=!1,sl!==null&&fE(sl)&&(sl=null),al!==null&&fE(al)&&(al=null),po!==null&&fE(po)&&(po=null),jp.forEach(Pv),Vp.forEach(Pv)}function Bp(s,o){s.blockedOn===o&&(s.blockedOn=null,_S||(_S=!0,E.unstable_scheduleCallback(E.unstable_NormalPriority,mE)))}var EE=null;function kv(s){EE!==s&&(EE=s,E.unstable_scheduleCallback(E.unstable_NormalPriority,function(){EE===s&&(EE=null);for(var o=0;o<s.length;o+=3){var d=s[o],f=s[o+1],_=s[o+2];if(typeof f!="function"){if(ES(f||d)===null)continue;break}var v=ko(d);v!==null&&(s.splice(o,3),o-=3,$_(v,{pending:!0,data:_,method:d.method,action:f},f,_))}}))}function Fp(s){function o(tt){return Bp(tt,s)}sl!==null&&Bp(sl,s),al!==null&&Bp(al,s),po!==null&&Bp(po,s),jp.forEach(o),Vp.forEach(o);for(var d=0;d<Fi.length;d++){var f=Fi[d];f.blockedOn===s&&(f.blockedOn=null)}for(;0<Fi.length&&(d=Fi[0],d.blockedOn===null);)Lv(d),d.blockedOn===null&&Fi.shift();if(d=(s.ownerDocument||s).$$reactFormReplay,d!=null)for(f=0;f<d.length;f+=3){var _=d[f],v=d[f+1],V=_[en]||null;if(typeof v=="function")V||kv(d);else if(V){var Y=null;if(v&&v.hasAttribute("formAction")){if(_=v,V=v[en]||null)Y=V.formAction;else if(ES(_)!==null)continue}else Y=V.action;typeof Y=="function"?d[f+1]=Y:(d.splice(f,3),f-=3),kv(d)}}}function gS(s){this._internalRoot=s}ju.prototype.render=gS.prototype.render=function(s){var o=this._internalRoot;if(o===null)throw Error(A(409));var d=o.current,f=Kr();wv(d,f,s,o,null,null)},ju.prototype.unmount=gS.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var o=s.containerInfo;s.tag===0&&sc(),wv(s.current,2,null,s,null,null),Xm(),o[Po]=null}};function ju(s){this._internalRoot=s}ju.prototype.unstable_scheduleHydration=function(s){if(s){var o=mh();s={blockedOn:null,target:s,priority:o};for(var d=0;d<Fi.length&&o!==0&&o<Fi[d].priority;d++);Fi.splice(d,0,s),d===0&&Lv(s)}};var SS=b.version;if(SS!=="19.0.0")throw Error(A(527,SS,"19.0.0"));Zt.findDOMNode=function(s){var o=s._reactInternals;if(o===void 0)throw typeof s.render=="function"?Error(A(188)):(s=Object.keys(s).join(","),Error(A(268,s)));return s=Ft(o),s=s!==null?he(s):null,s=s===null?null:s.stateNode,s};var nC={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:Xt,findFiberByHostInstance:Ns,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Vu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Vu.isDisabled&&Vu.supportsFiber)try{Oc=Vu.inject(nC),br=Vu}catch{}}return Ly.createRoot=function(s,o){if(!L(s))throw Error(A(299));var d=!1,f="",_=Ra,v=Xl,V=Jc,Y=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(_=o.onUncaughtError),o.onCaughtError!==void 0&&(v=o.onCaughtError),o.onRecoverableError!==void 0&&(V=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(Y=o.unstable_transitionCallbacks)),o=Cv(s,1,!1,null,null,d,f,_,v,V,Y,null),s[Po]=o.current,iE(s.nodeType===8?s.parentNode:s),new gS(o)},Ly.hydrateRoot=function(s,o,d){if(!L(s))throw Error(A(299));var f=!1,_="",v=Ra,V=Xl,Y=Jc,tt=null,ht=null;return d!=null&&(d.unstable_strictMode===!0&&(f=!0),d.identifierPrefix!==void 0&&(_=d.identifierPrefix),d.onUncaughtError!==void 0&&(v=d.onUncaughtError),d.onCaughtError!==void 0&&(V=d.onCaughtError),d.onRecoverableError!==void 0&&(Y=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(tt=d.unstable_transitionCallbacks),d.formState!==void 0&&(ht=d.formState)),o=Cv(s,1,!0,o,d??null,f,_,v,V,Y,tt,ht),o.context=Av(null),d=o.current,f=Kr(),_=tc(f),_.callback=null,Ca(d,_,f),o.current.lanes=f,kl(o,f),ho(o),s[Po]=o.current,iE(s),new ju(o)},Ly.version="19.0.0",Ly}var Wj;function yK(){if(Wj)return MI.exports;Wj=1;function E(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(E)}catch(b){console.error(b)}}return E(),MI.exports=SK(),MI.exports}var TK=yK(),Py={},Kj;function vK(){if(Kj)return Py;Kj=1,Object.defineProperty(Py,"__esModule",{value:!0}),Py.parse=K,Py.serialize=H;const E=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,b=/^[\u0021-\u003A\u003C-\u007E]*$/,O=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,A=/^[\u0020-\u003A\u003D-\u007E]*$/,L=Object.prototype.toString,U=(()=>{const dt=function(){};return dt.prototype=Object.create(null),dt})();function K(dt,X){const st=new U,Ct=dt.length;if(Ct<2)return st;const yt=(X==null?void 0:X.decode)||rt;let It=0;do{const Wt=dt.indexOf("=",It);if(Wt===-1)break;const Rt=dt.indexOf(";",It),ye=Rt===-1?Ct:Rt;if(Wt>ye){It=dt.lastIndexOf(";",Wt-1)+1;continue}const ne=J(dt,It,Wt),_e=G(dt,Wt,ne),Ne=dt.slice(ne,_e);if(st[Ne]===void 0){let Ie=J(dt,Wt+1,ye),Xt=G(dt,ye,Ie);const Qt=yt(dt.slice(Ie,Xt));st[Ne]=Qt}It=ye+1}while(It<Ct);return st}function J(dt,X,st){do{const Ct=dt.charCodeAt(X);if(Ct!==32&&Ct!==9)return X}while(++X<st);return st}function G(dt,X,st){for(;X>st;){const Ct=dt.charCodeAt(--X);if(Ct!==32&&Ct!==9)return X+1}return st}function H(dt,X,st){const Ct=(st==null?void 0:st.encode)||encodeURIComponent;if(!E.test(dt))throw new TypeError(`argument name is invalid: ${dt}`);const yt=Ct(X);if(!b.test(yt))throw new TypeError(`argument val is invalid: ${X}`);let It=dt+"="+yt;if(!st)return It;if(st.maxAge!==void 0){if(!Number.isInteger(st.maxAge))throw new TypeError(`option maxAge is invalid: ${st.maxAge}`);It+="; Max-Age="+st.maxAge}if(st.domain){if(!O.test(st.domain))throw new TypeError(`option domain is invalid: ${st.domain}`);It+="; Domain="+st.domain}if(st.path){if(!A.test(st.path))throw new TypeError(`option path is invalid: ${st.path}`);It+="; Path="+st.path}if(st.expires){if(!lt(st.expires)||!Number.isFinite(st.expires.valueOf()))throw new TypeError(`option expires is invalid: ${st.expires}`);It+="; Expires="+st.expires.toUTCString()}if(st.httpOnly&&(It+="; HttpOnly"),st.secure&&(It+="; Secure"),st.partitioned&&(It+="; Partitioned"),st.priority)switch(typeof st.priority=="string"?st.priority.toLowerCase():void 0){case"low":It+="; Priority=Low";break;case"medium":It+="; Priority=Medium";break;case"high":It+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${st.priority}`)}if(st.sameSite)switch(typeof st.sameSite=="string"?st.sameSite.toLowerCase():st.sameSite){case!0:case"strict":It+="; SameSite=Strict";break;case"lax":It+="; SameSite=Lax";break;case"none":It+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${st.sameSite}`)}return It}function rt(dt){if(dt.indexOf("%")===-1)return dt;try{return decodeURIComponent(dt)}catch{return dt}}function lt(dt){return L.call(dt)==="[object Date]"}return Py}vK();/**
 * react-router v7.4.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var zj="popstate";function bK(E={}){function b(A,L){let{pathname:U,search:K,hash:J}=A.location;return zI("",{pathname:U,search:K,hash:J},L.state&&L.state.usr||null,L.state&&L.state.key||"default")}function O(A,L){return typeof L=="string"?L:jy(L)}return CK(b,O,null,E)}function zi(E,b){if(E===!1||E===null||typeof E>"u")throw new Error(b)}function Dl(E,b){if(!E){typeof console<"u"&&console.warn(b);try{throw new Error(b)}catch{}}}function RK(){return Math.random().toString(36).substring(2,10)}function Yj(E,b){return{usr:E.state,key:E.key,idx:b}}function zI(E,b,O=null,A){return{pathname:typeof E=="string"?E:E.pathname,search:"",hash:"",...typeof b=="string"?__(b):b,state:O,key:b&&b.key||A||RK()}}function jy({pathname:E="/",search:b="",hash:O=""}){return b&&b!=="?"&&(E+=b.charAt(0)==="?"?b:"?"+b),O&&O!=="#"&&(E+=O.charAt(0)==="#"?O:"#"+O),E}function __(E){let b={};if(E){let O=E.indexOf("#");O>=0&&(b.hash=E.substring(O),E=E.substring(0,O));let A=E.indexOf("?");A>=0&&(b.search=E.substring(A),E=E.substring(0,A)),E&&(b.pathname=E)}return b}function CK(E,b,O,A={}){let{window:L=document.defaultView,v5Compat:U=!1}=A,K=L.history,J="POP",G=null,H=rt();H==null&&(H=0,K.replaceState({...K.state,idx:H},""));function rt(){return(K.state||{idx:null}).idx}function lt(){J="POP";let yt=rt(),It=yt==null?null:yt-H;H=yt,G&&G({action:J,location:Ct.location,delta:It})}function dt(yt,It){J="PUSH";let Wt=zI(Ct.location,yt,It);H=rt()+1;let Rt=Yj(Wt,H),ye=Ct.createHref(Wt);try{K.pushState(Rt,"",ye)}catch(ne){if(ne instanceof DOMException&&ne.name==="DataCloneError")throw ne;L.location.assign(ye)}U&&G&&G({action:J,location:Ct.location,delta:1})}function X(yt,It){J="REPLACE";let Wt=zI(Ct.location,yt,It);H=rt();let Rt=Yj(Wt,H),ye=Ct.createHref(Wt);K.replaceState(Rt,"",ye),U&&G&&G({action:J,location:Ct.location,delta:0})}function st(yt){let It=L.location.origin!=="null"?L.location.origin:L.location.href,Wt=typeof yt=="string"?yt:jy(yt);return Wt=Wt.replace(/ $/,"%20"),zi(It,`No window.location.(origin|href) available to create URL for href: ${Wt}`),new URL(Wt,It)}let Ct={get action(){return J},get location(){return E(L,K)},listen(yt){if(G)throw new Error("A history only accepts one active listener");return L.addEventListener(zj,lt),G=yt,()=>{L.removeEventListener(zj,lt),G=null}},createHref(yt){return b(L,yt)},createURL:st,encodeLocation(yt){let It=st(yt);return{pathname:It.pathname,search:It.search,hash:It.hash}},push:dt,replace:X,go(yt){return K.go(yt)}};return Ct}function _V(E,b,O="/"){return AK(E,b,O,!1)}function AK(E,b,O,A){let L=typeof b=="string"?__(b):b,U=Pd(L.pathname||"/",O);if(U==null)return null;let K=gV(E);wK(K);let J=null;for(let G=0;J==null&&G<K.length;++G){let H=jK(U);J=MK(K[G],H,A)}return J}function gV(E,b=[],O=[],A=""){let L=(U,K,J)=>{let G={relativePath:J===void 0?U.path||"":J,caseSensitive:U.caseSensitive===!0,childrenIndex:K,route:U};G.relativePath.startsWith("/")&&(zi(G.relativePath.startsWith(A),`Absolute route path "${G.relativePath}" nested under path "${A}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),G.relativePath=G.relativePath.slice(A.length));let H=Ld([A,G.relativePath]),rt=O.concat(G);U.children&&U.children.length>0&&(zi(U.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${H}".`),gV(U.children,b,rt,H)),!(U.path==null&&!U.index)&&b.push({path:H,score:kK(H,U.index),routesMeta:rt})};return E.forEach((U,K)=>{var J;if(U.path===""||!((J=U.path)!=null&&J.includes("?")))L(U,K);else for(let G of SV(U.path))L(U,K,G)}),b}function SV(E){let b=E.split("/");if(b.length===0)return[];let[O,...A]=b,L=O.endsWith("?"),U=O.replace(/\?$/,"");if(A.length===0)return L?[U,""]:[U];let K=SV(A.join("/")),J=[];return J.push(...K.map(G=>G===""?U:[U,G].join("/"))),L&&J.push(...K),J.map(G=>E.startsWith("/")&&G===""?"/":G)}function wK(E){E.sort((b,O)=>b.score!==O.score?O.score-b.score:xK(b.routesMeta.map(A=>A.childrenIndex),O.routesMeta.map(A=>A.childrenIndex)))}var IK=/^:[\w-]+$/,OK=3,NK=2,DK=1,LK=10,PK=-2,qj=E=>E==="*";function kK(E,b){let O=E.split("/"),A=O.length;return O.some(qj)&&(A+=PK),b&&(A+=NK),O.filter(L=>!qj(L)).reduce((L,U)=>L+(IK.test(U)?OK:U===""?DK:LK),A)}function xK(E,b){return E.length===b.length&&E.slice(0,-1).every((A,L)=>A===b[L])?E[E.length-1]-b[b.length-1]:0}function MK(E,b,O=!1){let{routesMeta:A}=E,L={},U="/",K=[];for(let J=0;J<A.length;++J){let G=A[J],H=J===A.length-1,rt=U==="/"?b:b.slice(U.length)||"/",lt=r0({path:G.relativePath,caseSensitive:G.caseSensitive,end:H},rt),dt=G.route;if(!lt&&H&&O&&!A[A.length-1].route.index&&(lt=r0({path:G.relativePath,caseSensitive:G.caseSensitive,end:!1},rt)),!lt)return null;Object.assign(L,lt.params),K.push({params:L,pathname:Ld([U,lt.pathname]),pathnameBase:GK(Ld([U,lt.pathnameBase])),route:dt}),lt.pathnameBase!=="/"&&(U=Ld([U,lt.pathnameBase]))}return K}function r0(E,b){typeof E=="string"&&(E={path:E,caseSensitive:!1,end:!0});let[O,A]=UK(E.path,E.caseSensitive,E.end),L=b.match(O);if(!L)return null;let U=L[0],K=U.replace(/(.)\/+$/,"$1"),J=L.slice(1);return{params:A.reduce((H,{paramName:rt,isOptional:lt},dt)=>{if(rt==="*"){let st=J[dt]||"";K=U.slice(0,U.length-st.length).replace(/(.)\/+$/,"$1")}const X=J[dt];return lt&&!X?H[rt]=void 0:H[rt]=(X||"").replace(/%2F/g,"/"),H},{}),pathname:U,pathnameBase:K,pattern:E}}function UK(E,b=!1,O=!0){Dl(E==="*"||!E.endsWith("*")||E.endsWith("/*"),`Route path "${E}" will be treated as if it were "${E.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${E.replace(/\*$/,"/*")}".`);let A=[],L="^"+E.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(K,J,G)=>(A.push({paramName:J,isOptional:G!=null}),G?"/?([^\\/]+)?":"/([^\\/]+)"));return E.endsWith("*")?(A.push({paramName:"*"}),L+=E==="*"||E==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):O?L+="\\/*$":E!==""&&E!=="/"&&(L+="(?:(?=\\/|$))"),[new RegExp(L,b?void 0:"i"),A]}function jK(E){try{return E.split("/").map(b=>decodeURIComponent(b).replace(/\//g,"%2F")).join("/")}catch(b){return Dl(!1,`The URL path "${E}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${b}).`),E}}function Pd(E,b){if(b==="/")return E;if(!E.toLowerCase().startsWith(b.toLowerCase()))return null;let O=b.endsWith("/")?b.length-1:b.length,A=E.charAt(O);return A&&A!=="/"?null:E.slice(O)||"/"}function VK(E,b="/"){let{pathname:O,search:A="",hash:L=""}=typeof E=="string"?__(E):E;return{pathname:O?O.startsWith("/")?O:BK(O,b):b,search:HK(A),hash:WK(L)}}function BK(E,b){let O=b.replace(/\/+$/,"").split("/");return E.split("/").forEach(L=>{L===".."?O.length>1&&O.pop():L!=="."&&O.push(L)}),O.length>1?O.join("/"):"/"}function BI(E,b,O,A){return`Cannot include a '${E}' character in a manually specified \`to.${b}\` field [${JSON.stringify(A)}].  Please separate it out to the \`to.${O}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function FK(E){return E.filter((b,O)=>O===0||b.route.path&&b.route.path.length>0)}function yV(E){let b=FK(E);return b.map((O,A)=>A===b.length-1?O.pathname:O.pathnameBase)}function TV(E,b,O,A=!1){let L;typeof E=="string"?L=__(E):(L={...E},zi(!L.pathname||!L.pathname.includes("?"),BI("?","pathname","search",L)),zi(!L.pathname||!L.pathname.includes("#"),BI("#","pathname","hash",L)),zi(!L.search||!L.search.includes("#"),BI("#","search","hash",L)));let U=E===""||L.pathname==="",K=U?"/":L.pathname,J;if(K==null)J=O;else{let lt=b.length-1;if(!A&&K.startsWith("..")){let dt=K.split("/");for(;dt[0]==="..";)dt.shift(),lt-=1;L.pathname=dt.join("/")}J=lt>=0?b[lt]:"/"}let G=VK(L,J),H=K&&K!=="/"&&K.endsWith("/"),rt=(U||K===".")&&O.endsWith("/");return!G.pathname.endsWith("/")&&(H||rt)&&(G.pathname+="/"),G}var Ld=E=>E.join("/").replace(/\/\/+/g,"/"),GK=E=>E.replace(/\/+$/,"").replace(/^\/*/,"/"),HK=E=>!E||E==="?"?"":E.startsWith("?")?E:"?"+E,WK=E=>!E||E==="#"?"":E.startsWith("#")?E:"#"+E;function KK(E){return E!=null&&typeof E.status=="number"&&typeof E.statusText=="string"&&typeof E.internal=="boolean"&&"data"in E}var vV=["POST","PUT","PATCH","DELETE"];new Set(vV);var zK=["GET",...vV];new Set(zK);var g_=it.createContext(null);g_.displayName="DataRouter";var l0=it.createContext(null);l0.displayName="DataRouterState";var bV=it.createContext({isTransitioning:!1});bV.displayName="ViewTransition";var YK=it.createContext(new Map);YK.displayName="Fetchers";var qK=it.createContext(null);qK.displayName="Await";var Ll=it.createContext(null);Ll.displayName="Navigation";var Fy=it.createContext(null);Fy.displayName="Location";var xd=it.createContext({outlet:null,matches:[],isDataRoute:!1});xd.displayName="Route";var sO=it.createContext(null);sO.displayName="RouteError";function XK(E,{relative:b}={}){zi(Gy(),"useHref() may be used only in the context of a <Router> component.");let{basename:O,navigator:A}=it.useContext(Ll),{hash:L,pathname:U,search:K}=Hy(E,{relative:b}),J=U;return O!=="/"&&(J=U==="/"?O:Ld([O,U])),A.createHref({pathname:J,search:K,hash:L})}function Gy(){return it.useContext(Fy)!=null}function Nf(){return zi(Gy(),"useLocation() may be used only in the context of a <Router> component."),it.useContext(Fy).location}var RV="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function CV(E){it.useContext(Ll).static||it.useLayoutEffect(E)}function S_(){let{isDataRoute:E}=it.useContext(xd);return E?cz():JK()}function JK(){zi(Gy(),"useNavigate() may be used only in the context of a <Router> component.");let E=it.useContext(g_),{basename:b,navigator:O}=it.useContext(Ll),{matches:A}=it.useContext(xd),{pathname:L}=Nf(),U=JSON.stringify(yV(A)),K=it.useRef(!1);return CV(()=>{K.current=!0}),it.useCallback((G,H={})=>{if(Dl(K.current,RV),!K.current)return;if(typeof G=="number"){O.go(G);return}let rt=TV(G,JSON.parse(U),L,H.relative==="path");E==null&&b!=="/"&&(rt.pathname=rt.pathname==="/"?b:Ld([b,rt.pathname])),(H.replace?O.replace:O.push)(rt,H.state,H)},[b,O,U,L,E])}it.createContext(null);function Hy(E,{relative:b}={}){let{matches:O}=it.useContext(xd),{pathname:A}=Nf(),L=JSON.stringify(yV(O));return it.useMemo(()=>TV(E,JSON.parse(L),A,b==="path"),[E,L,A,b])}function QK(E,b){return AV(E,b)}function AV(E,b,O,A){var Wt;zi(Gy(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:L,static:U}=it.useContext(Ll),{matches:K}=it.useContext(xd),J=K[K.length-1],G=J?J.params:{},H=J?J.pathname:"/",rt=J?J.pathnameBase:"/",lt=J&&J.route;{let Rt=lt&&lt.path||"";wV(H,!lt||Rt.endsWith("*")||Rt.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${H}" (under <Route path="${Rt}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Rt}"> to <Route path="${Rt==="/"?"*":`${Rt}/*`}">.`)}let dt=Nf(),X;if(b){let Rt=typeof b=="string"?__(b):b;zi(rt==="/"||((Wt=Rt.pathname)==null?void 0:Wt.startsWith(rt)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${rt}" but pathname "${Rt.pathname}" was given in the \`location\` prop.`),X=Rt}else X=dt;let st=X.pathname||"/",Ct=st;if(rt!=="/"){let Rt=rt.replace(/^\//,"").split("/");Ct="/"+st.replace(/^\//,"").split("/").slice(Rt.length).join("/")}let yt=!U&&O&&O.matches&&O.matches.length>0?O.matches:_V(E,{pathname:Ct});Dl(lt||yt!=null,`No routes matched location "${X.pathname}${X.search}${X.hash}" `),Dl(yt==null||yt[yt.length-1].route.element!==void 0||yt[yt.length-1].route.Component!==void 0||yt[yt.length-1].route.lazy!==void 0,`Matched leaf route at location "${X.pathname}${X.search}${X.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let It=nz(yt&&yt.map(Rt=>Object.assign({},Rt,{params:Object.assign({},G,Rt.params),pathname:Ld([rt,L.encodeLocation?L.encodeLocation(Rt.pathname).pathname:Rt.pathname]),pathnameBase:Rt.pathnameBase==="/"?rt:Ld([rt,L.encodeLocation?L.encodeLocation(Rt.pathnameBase).pathname:Rt.pathnameBase])})),K,O,A);return b&&It?it.createElement(Fy.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...X},navigationType:"POP"}},It):It}function ZK(){let E=oz(),b=KK(E)?`${E.status} ${E.statusText}`:E instanceof Error?E.message:JSON.stringify(E),O=E instanceof Error?E.stack:null,A="rgba(200,200,200, 0.5)",L={padding:"0.5rem",backgroundColor:A},U={padding:"2px 4px",backgroundColor:A},K=null;return console.error("Error handled by React Router default ErrorBoundary:",E),K=it.createElement(it.Fragment,null,it.createElement("p",null," Hey developer "),it.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",it.createElement("code",{style:U},"ErrorBoundary")," or"," ",it.createElement("code",{style:U},"errorElement")," prop on your route.")),it.createElement(it.Fragment,null,it.createElement("h2",null,"Unexpected Application Error!"),it.createElement("h3",{style:{fontStyle:"italic"}},b),O?it.createElement("pre",{style:L},O):null,K)}var $K=it.createElement(ZK,null),tz=class extends it.Component{constructor(E){super(E),this.state={location:E.location,revalidation:E.revalidation,error:E.error}}static getDerivedStateFromError(E){return{error:E}}static getDerivedStateFromProps(E,b){return b.location!==E.location||b.revalidation!=="idle"&&E.revalidation==="idle"?{error:E.error,location:E.location,revalidation:E.revalidation}:{error:E.error!==void 0?E.error:b.error,location:b.location,revalidation:E.revalidation||b.revalidation}}componentDidCatch(E,b){console.error("React Router caught the following error during render",E,b)}render(){return this.state.error!==void 0?it.createElement(xd.Provider,{value:this.props.routeContext},it.createElement(sO.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function ez({routeContext:E,match:b,children:O}){let A=it.useContext(g_);return A&&A.static&&A.staticContext&&(b.route.errorElement||b.route.ErrorBoundary)&&(A.staticContext._deepestRenderedBoundaryId=b.route.id),it.createElement(xd.Provider,{value:E},O)}function nz(E,b=[],O=null,A=null){if(E==null){if(!O)return null;if(O.errors)E=O.matches;else if(b.length===0&&!O.initialized&&O.matches.length>0)E=O.matches;else return null}let L=E,U=O==null?void 0:O.errors;if(U!=null){let G=L.findIndex(H=>H.route.id&&(U==null?void 0:U[H.route.id])!==void 0);zi(G>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(U).join(",")}`),L=L.slice(0,Math.min(L.length,G+1))}let K=!1,J=-1;if(O)for(let G=0;G<L.length;G++){let H=L[G];if((H.route.HydrateFallback||H.route.hydrateFallbackElement)&&(J=G),H.route.id){let{loaderData:rt,errors:lt}=O,dt=H.route.loader&&!rt.hasOwnProperty(H.route.id)&&(!lt||lt[H.route.id]===void 0);if(H.route.lazy||dt){K=!0,J>=0?L=L.slice(0,J+1):L=[L[0]];break}}}return L.reduceRight((G,H,rt)=>{let lt,dt=!1,X=null,st=null;O&&(lt=U&&H.route.id?U[H.route.id]:void 0,X=H.route.errorElement||$K,K&&(J<0&&rt===0?(wV("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),dt=!0,st=null):J===rt&&(dt=!0,st=H.route.hydrateFallbackElement||null)));let Ct=b.concat(L.slice(0,rt+1)),yt=()=>{let It;return lt?It=X:dt?It=st:H.route.Component?It=it.createElement(H.route.Component,null):H.route.element?It=H.route.element:It=G,it.createElement(ez,{match:H,routeContext:{outlet:G,matches:Ct,isDataRoute:O!=null},children:It})};return O&&(H.route.ErrorBoundary||H.route.errorElement||rt===0)?it.createElement(tz,{location:O.location,revalidation:O.revalidation,component:X,error:lt,children:yt(),routeContext:{outlet:null,matches:Ct,isDataRoute:!0}}):yt()},null)}function aO(E){return`${E} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function iz(E){let b=it.useContext(g_);return zi(b,aO(E)),b}function rz(E){let b=it.useContext(l0);return zi(b,aO(E)),b}function sz(E){let b=it.useContext(xd);return zi(b,aO(E)),b}function oO(E){let b=sz(E),O=b.matches[b.matches.length-1];return zi(O.route.id,`${E} can only be used on routes that contain a unique "id"`),O.route.id}function az(){return oO("useRouteId")}function oz(){var A;let E=it.useContext(sO),b=rz("useRouteError"),O=oO("useRouteError");return E!==void 0?E:(A=b.errors)==null?void 0:A[O]}function cz(){let{router:E}=iz("useNavigate"),b=oO("useNavigate"),O=it.useRef(!1);return CV(()=>{O.current=!0}),it.useCallback(async(L,U={})=>{Dl(O.current,RV),O.current&&(typeof L=="number"?E.navigate(L):await E.navigate(L,{fromRouteId:b,...U}))},[E,b])}var Xj={};function wV(E,b,O){!b&&!Xj[E]&&(Xj[E]=!0,Dl(!1,O))}it.memo(lz);function lz({routes:E,future:b,state:O}){return AV(E,void 0,O,b)}function Il(E){zi(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function dz({basename:E="/",children:b=null,location:O,navigationType:A="POP",navigator:L,static:U=!1}){zi(!Gy(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let K=E.replace(/^\/*/,"/"),J=it.useMemo(()=>({basename:K,navigator:L,static:U,future:{}}),[K,L,U]);typeof O=="string"&&(O=__(O));let{pathname:G="/",search:H="",hash:rt="",state:lt=null,key:dt="default"}=O,X=it.useMemo(()=>{let st=Pd(G,K);return st==null?null:{location:{pathname:st,search:H,hash:rt,state:lt,key:dt},navigationType:A}},[K,G,H,rt,lt,dt,A]);return Dl(X!=null,`<Router basename="${K}"> is not able to match the URL "${G}${H}${rt}" because it does not start with the basename, so the <Router> won't render anything.`),X==null?null:it.createElement(Ll.Provider,{value:J},it.createElement(Fy.Provider,{children:b,value:X}))}function uz({children:E,location:b}){return QK(YI(E),b)}function YI(E,b=[]){let O=[];return it.Children.forEach(E,(A,L)=>{if(!it.isValidElement(A))return;let U=[...b,L];if(A.type===it.Fragment){O.push.apply(O,YI(A.props.children,U));return}zi(A.type===Il,`[${typeof A.type=="string"?A.type:A.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),zi(!A.props.index||!A.props.children,"An index route cannot have child routes.");let K={id:A.props.id||U.join("-"),caseSensitive:A.props.caseSensitive,element:A.props.element,Component:A.props.Component,index:A.props.index,path:A.props.path,loader:A.props.loader,action:A.props.action,hydrateFallbackElement:A.props.hydrateFallbackElement,HydrateFallback:A.props.HydrateFallback,errorElement:A.props.errorElement,ErrorBoundary:A.props.ErrorBoundary,hasErrorBoundary:A.props.hasErrorBoundary===!0||A.props.ErrorBoundary!=null||A.props.errorElement!=null,shouldRevalidate:A.props.shouldRevalidate,handle:A.props.handle,lazy:A.props.lazy};A.props.children&&(K.children=YI(A.props.children,U)),O.push(K)}),O}var QR="get",ZR="application/x-www-form-urlencoded";function d0(E){return E!=null&&typeof E.tagName=="string"}function hz(E){return d0(E)&&E.tagName.toLowerCase()==="button"}function pz(E){return d0(E)&&E.tagName.toLowerCase()==="form"}function fz(E){return d0(E)&&E.tagName.toLowerCase()==="input"}function mz(E){return!!(E.metaKey||E.altKey||E.ctrlKey||E.shiftKey)}function Ez(E,b){return E.button===0&&(!b||b==="_self")&&!mz(E)}var JR=null;function _z(){if(JR===null)try{new FormData(document.createElement("form"),0),JR=!1}catch{JR=!0}return JR}var gz=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function FI(E){return E!=null&&!gz.has(E)?(Dl(!1,`"${E}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ZR}"`),null):E}function Sz(E,b){let O,A,L,U,K;if(pz(E)){let J=E.getAttribute("action");A=J?Pd(J,b):null,O=E.getAttribute("method")||QR,L=FI(E.getAttribute("enctype"))||ZR,U=new FormData(E)}else if(hz(E)||fz(E)&&(E.type==="submit"||E.type==="image")){let J=E.form;if(J==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let G=E.getAttribute("formaction")||J.getAttribute("action");if(A=G?Pd(G,b):null,O=E.getAttribute("formmethod")||J.getAttribute("method")||QR,L=FI(E.getAttribute("formenctype"))||FI(J.getAttribute("enctype"))||ZR,U=new FormData(J,E),!_z()){let{name:H,type:rt,value:lt}=E;if(rt==="image"){let dt=H?`${H}.`:"";U.append(`${dt}x`,"0"),U.append(`${dt}y`,"0")}else H&&U.append(H,lt)}}else{if(d0(E))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');O=QR,A=null,L=ZR,K=E}return U&&L==="text/plain"&&(K=U,U=void 0),{action:A,method:O.toLowerCase(),encType:L,formData:U,body:K}}function cO(E,b){if(E===!1||E===null||typeof E>"u")throw new Error(b)}async function yz(E,b){if(E.id in b)return b[E.id];try{let O=await import(E.module);return b[E.id]=O,O}catch(O){return console.error(`Error loading route module \`${E.module}\`, reloading page...`),console.error(O),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Tz(E){return E==null?!1:E.href==null?E.rel==="preload"&&typeof E.imageSrcSet=="string"&&typeof E.imageSizes=="string":typeof E.rel=="string"&&typeof E.href=="string"}async function vz(E,b,O){let A=await Promise.all(E.map(async L=>{let U=b.routes[L.route.id];if(U){let K=await yz(U,O);return K.links?K.links():[]}return[]}));return Az(A.flat(1).filter(Tz).filter(L=>L.rel==="stylesheet"||L.rel==="preload").map(L=>L.rel==="stylesheet"?{...L,rel:"prefetch",as:"style"}:{...L,rel:"prefetch"}))}function Jj(E,b,O,A,L,U){let K=(G,H)=>O[H]?G.route.id!==O[H].route.id:!0,J=(G,H)=>{var rt;return O[H].pathname!==G.pathname||((rt=O[H].route.path)==null?void 0:rt.endsWith("*"))&&O[H].params["*"]!==G.params["*"]};return U==="assets"?b.filter((G,H)=>K(G,H)||J(G,H)):U==="data"?b.filter((G,H)=>{var lt;let rt=A.routes[G.route.id];if(!rt||!rt.hasLoader)return!1;if(K(G,H)||J(G,H))return!0;if(G.route.shouldRevalidate){let dt=G.route.shouldRevalidate({currentUrl:new URL(L.pathname+L.search+L.hash,window.origin),currentParams:((lt=O[0])==null?void 0:lt.params)||{},nextUrl:new URL(E,window.origin),nextParams:G.params,defaultShouldRevalidate:!0});if(typeof dt=="boolean")return dt}return!0}):[]}function bz(E,b,{includeHydrateFallback:O}={}){return Rz(E.map(A=>{let L=b.routes[A.route.id];if(!L)return[];let U=[L.module];return L.clientActionModule&&(U=U.concat(L.clientActionModule)),L.clientLoaderModule&&(U=U.concat(L.clientLoaderModule)),O&&L.hydrateFallbackModule&&(U=U.concat(L.hydrateFallbackModule)),L.imports&&(U=U.concat(L.imports)),U}).flat(1))}function Rz(E){return[...new Set(E)]}function Cz(E){let b={},O=Object.keys(E).sort();for(let A of O)b[A]=E[A];return b}function Az(E,b){let O=new Set;return new Set(b),E.reduce((A,L)=>{let U=JSON.stringify(Cz(L));return O.has(U)||(O.add(U),A.push({key:U,link:L})),A},[])}function wz(E,b){let O=typeof E=="string"?new URL(E,typeof window>"u"?"server://singlefetch/":window.location.origin):E;return O.pathname==="/"?O.pathname="_root.data":b&&Pd(O.pathname,b)==="/"?O.pathname=`${b.replace(/\/$/,"")}/_root.data`:O.pathname=`${O.pathname.replace(/\/$/,"")}.data`,O}function IV(){let E=it.useContext(g_);return cO(E,"You must render this element inside a <DataRouterContext.Provider> element"),E}function Iz(){let E=it.useContext(l0);return cO(E,"You must render this element inside a <DataRouterStateContext.Provider> element"),E}var lO=it.createContext(void 0);lO.displayName="FrameworkContext";function OV(){let E=it.useContext(lO);return cO(E,"You must render this element inside a <HydratedRouter> element"),E}function Oz(E,b){let O=it.useContext(lO),[A,L]=it.useState(!1),[U,K]=it.useState(!1),{onFocus:J,onBlur:G,onMouseEnter:H,onMouseLeave:rt,onTouchStart:lt}=b,dt=it.useRef(null);it.useEffect(()=>{if(E==="render"&&K(!0),E==="viewport"){let Ct=It=>{It.forEach(Wt=>{K(Wt.isIntersecting)})},yt=new IntersectionObserver(Ct,{threshold:.5});return dt.current&&yt.observe(dt.current),()=>{yt.disconnect()}}},[E]),it.useEffect(()=>{if(A){let Ct=setTimeout(()=>{K(!0)},100);return()=>{clearTimeout(Ct)}}},[A]);let X=()=>{L(!0)},st=()=>{L(!1),K(!1)};return O?E!=="intent"?[U,dt,{}]:[U,dt,{onFocus:ky(J,X),onBlur:ky(G,st),onMouseEnter:ky(H,X),onMouseLeave:ky(rt,st),onTouchStart:ky(lt,X)}]:[!1,dt,{}]}function ky(E,b){return O=>{E&&E(O),O.defaultPrevented||b(O)}}function Nz({page:E,...b}){let{router:O}=IV(),A=it.useMemo(()=>_V(O.routes,E,O.basename),[O.routes,E,O.basename]);return A?it.createElement(Lz,{page:E,matches:A,...b}):null}function Dz(E){let{manifest:b,routeModules:O}=OV(),[A,L]=it.useState([]);return it.useEffect(()=>{let U=!1;return vz(E,b,O).then(K=>{U||L(K)}),()=>{U=!0}},[E,b,O]),A}function Lz({page:E,matches:b,...O}){let A=Nf(),{manifest:L,routeModules:U}=OV(),{basename:K}=IV(),{loaderData:J,matches:G}=Iz(),H=it.useMemo(()=>Jj(E,b,G,L,A,"data"),[E,b,G,L,A]),rt=it.useMemo(()=>Jj(E,b,G,L,A,"assets"),[E,b,G,L,A]),lt=it.useMemo(()=>{if(E===A.pathname+A.search+A.hash)return[];let st=new Set,Ct=!1;if(b.forEach(It=>{var Rt;let Wt=L.routes[It.route.id];!Wt||!Wt.hasLoader||(!H.some(ye=>ye.route.id===It.route.id)&&It.route.id in J&&((Rt=U[It.route.id])!=null&&Rt.shouldRevalidate)||Wt.hasClientLoader?Ct=!0:st.add(It.route.id))}),st.size===0)return[];let yt=wz(E,K);return Ct&&st.size>0&&yt.searchParams.set("_routes",b.filter(It=>st.has(It.route.id)).map(It=>It.route.id).join(",")),[yt.pathname+yt.search]},[K,J,A,L,H,b,E,U]),dt=it.useMemo(()=>bz(rt,L),[rt,L]),X=Dz(rt);return it.createElement(it.Fragment,null,lt.map(st=>it.createElement("link",{key:st,rel:"prefetch",as:"fetch",href:st,...O})),dt.map(st=>it.createElement("link",{key:st,rel:"modulepreload",href:st,...O})),X.map(({key:st,link:Ct})=>it.createElement("link",{key:st,...Ct})))}function Pz(...E){return b=>{E.forEach(O=>{typeof O=="function"?O(b):O!=null&&(O.current=b)})}}var NV=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{NV&&(window.__reactRouterVersion="7.4.0")}catch{}function kz({basename:E,children:b,window:O}){let A=it.useRef();A.current==null&&(A.current=bK({window:O,v5Compat:!0}));let L=A.current,[U,K]=it.useState({action:L.action,location:L.location}),J=it.useCallback(G=>{it.startTransition(()=>K(G))},[K]);return it.useLayoutEffect(()=>L.listen(J),[L,J]),it.createElement(dz,{basename:E,children:b,location:U.location,navigationType:U.action,navigator:L})}var DV=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,LV=it.forwardRef(function({onClick:b,discover:O="render",prefetch:A="none",relative:L,reloadDocument:U,replace:K,state:J,target:G,to:H,preventScrollReset:rt,viewTransition:lt,...dt},X){let{basename:st}=it.useContext(Ll),Ct=typeof H=="string"&&DV.test(H),yt,It=!1;if(typeof H=="string"&&Ct&&(yt=H,NV))try{let Xt=new URL(window.location.href),Qt=H.startsWith("//")?new URL(Xt.protocol+H):new URL(H),Ae=Pd(Qt.pathname,st);Qt.origin===Xt.origin&&Ae!=null?H=Ae+Qt.search+Qt.hash:It=!0}catch{Dl(!1,`<Link to="${H}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Wt=XK(H,{relative:L}),[Rt,ye,ne]=Oz(A,dt),_e=Uz(H,{replace:K,state:J,target:G,preventScrollReset:rt,relative:L,viewTransition:lt});function Ne(Xt){b&&b(Xt),Xt.defaultPrevented||_e(Xt)}let Ie=it.createElement("a",{...dt,...ne,href:yt||Wt,onClick:It||U?b:Ne,ref:Pz(X,ye),target:G,"data-discover":!Ct&&O==="render"?"true":void 0});return Rt&&!Ct?it.createElement(it.Fragment,null,Ie,it.createElement(Nz,{page:Wt})):Ie});LV.displayName="Link";var Rc=it.forwardRef(function({"aria-current":b="page",caseSensitive:O=!1,className:A="",end:L=!1,style:U,to:K,viewTransition:J,children:G,...H},rt){let lt=Hy(K,{relative:H.relative}),dt=Nf(),X=it.useContext(l0),{navigator:st,basename:Ct}=it.useContext(Ll),yt=X!=null&&Gz(lt)&&J===!0,It=st.encodeLocation?st.encodeLocation(lt).pathname:lt.pathname,Wt=dt.pathname,Rt=X&&X.navigation&&X.navigation.location?X.navigation.location.pathname:null;O||(Wt=Wt.toLowerCase(),Rt=Rt?Rt.toLowerCase():null,It=It.toLowerCase()),Rt&&Ct&&(Rt=Pd(Rt,Ct)||Rt);const ye=It!=="/"&&It.endsWith("/")?It.length-1:It.length;let ne=Wt===It||!L&&Wt.startsWith(It)&&Wt.charAt(ye)==="/",_e=Rt!=null&&(Rt===It||!L&&Rt.startsWith(It)&&Rt.charAt(It.length)==="/"),Ne={isActive:ne,isPending:_e,isTransitioning:yt},Ie=ne?b:void 0,Xt;typeof A=="function"?Xt=A(Ne):Xt=[A,ne?"active":null,_e?"pending":null,yt?"transitioning":null].filter(Boolean).join(" ");let Qt=typeof U=="function"?U(Ne):U;return it.createElement(LV,{...H,"aria-current":Ie,className:Xt,ref:rt,style:Qt,to:K,viewTransition:J},typeof G=="function"?G(Ne):G)});Rc.displayName="NavLink";var xz=it.forwardRef(({discover:E="render",fetcherKey:b,navigate:O,reloadDocument:A,replace:L,state:U,method:K=QR,action:J,onSubmit:G,relative:H,preventScrollReset:rt,viewTransition:lt,...dt},X)=>{let st=Bz(),Ct=Fz(J,{relative:H}),yt=K.toLowerCase()==="get"?"get":"post",It=typeof J=="string"&&DV.test(J),Wt=Rt=>{if(G&&G(Rt),Rt.defaultPrevented)return;Rt.preventDefault();let ye=Rt.nativeEvent.submitter,ne=(ye==null?void 0:ye.getAttribute("formmethod"))||K;st(ye||Rt.currentTarget,{fetcherKey:b,method:ne,navigate:O,replace:L,state:U,relative:H,preventScrollReset:rt,viewTransition:lt})};return it.createElement("form",{ref:X,method:yt,action:Ct,onSubmit:A?G:Wt,...dt,"data-discover":!It&&E==="render"?"true":void 0})});xz.displayName="Form";function Mz(E){return`${E} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function PV(E){let b=it.useContext(g_);return zi(b,Mz(E)),b}function Uz(E,{target:b,replace:O,state:A,preventScrollReset:L,relative:U,viewTransition:K}={}){let J=S_(),G=Nf(),H=Hy(E,{relative:U});return it.useCallback(rt=>{if(Ez(rt,b)){rt.preventDefault();let lt=O!==void 0?O:jy(G)===jy(H);J(E,{replace:lt,state:A,preventScrollReset:L,relative:U,viewTransition:K})}},[G,J,H,O,A,b,E,L,U,K])}var jz=0,Vz=()=>`__${String(++jz)}__`;function Bz(){let{router:E}=PV("useSubmit"),{basename:b}=it.useContext(Ll),O=az();return it.useCallback(async(A,L={})=>{let{action:U,method:K,encType:J,formData:G,body:H}=Sz(A,b);if(L.navigate===!1){let rt=L.fetcherKey||Vz();await E.fetch(rt,O,L.action||U,{preventScrollReset:L.preventScrollReset,formData:G,body:H,formMethod:L.method||K,formEncType:L.encType||J,flushSync:L.flushSync})}else await E.navigate(L.action||U,{preventScrollReset:L.preventScrollReset,formData:G,body:H,formMethod:L.method||K,formEncType:L.encType||J,replace:L.replace,state:L.state,fromRouteId:O,flushSync:L.flushSync,viewTransition:L.viewTransition})},[E,b,O])}function Fz(E,{relative:b}={}){let{basename:O}=it.useContext(Ll),A=it.useContext(xd);zi(A,"useFormAction must be used inside a RouteContext");let[L]=A.matches.slice(-1),U={...Hy(E||".",{relative:b})},K=Nf();if(E==null){U.search=K.search;let J=new URLSearchParams(U.search),G=J.getAll("index");if(G.some(rt=>rt==="")){J.delete("index"),G.filter(lt=>lt).forEach(lt=>J.append("index",lt));let rt=J.toString();U.search=rt?`?${rt}`:""}}return(!E||E===".")&&L.route.index&&(U.search=U.search?U.search.replace(/^\?/,"?index&"):"?index"),O!=="/"&&(U.pathname=U.pathname==="/"?O:Ld([O,U.pathname])),jy(U)}function Gz(E,b={}){let O=it.useContext(bV);zi(O!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:A}=PV("useViewTransitionState"),L=Hy(E,{relative:b.relative});if(!O.isTransitioning)return!1;let U=Pd(O.currentLocation.pathname,A)||O.currentLocation.pathname,K=Pd(O.nextLocation.pathname,A)||O.nextLocation.pathname;return r0(L.pathname,K)!=null||r0(L.pathname,U)!=null}new TextEncoder;const kV="/assets/login-BUa6NnKd.svg",Vy="/assets/logo-CZHZ9zkA.jpg";function xV(E,b){return function(){return E.apply(b,arguments)}}const{toString:Hz}=Object.prototype,{getPrototypeOf:dO}=Object,u0=(E=>b=>{const O=Hz.call(b);return E[O]||(E[O]=O.slice(8,-1).toLowerCase())})(Object.create(null)),Ac=E=>(E=E.toLowerCase(),b=>u0(b)===E),h0=E=>b=>typeof b===E,{isArray:y_}=Array,By=h0("undefined");function Wz(E){return E!==null&&!By(E)&&E.constructor!==null&&!By(E.constructor)&&Ga(E.constructor.isBuffer)&&E.constructor.isBuffer(E)}const MV=Ac("ArrayBuffer");function Kz(E){let b;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?b=ArrayBuffer.isView(E):b=E&&E.buffer&&MV(E.buffer),b}const zz=h0("string"),Ga=h0("function"),UV=h0("number"),p0=E=>E!==null&&typeof E=="object",Yz=E=>E===!0||E===!1,$R=E=>{if(u0(E)!=="object")return!1;const b=dO(E);return(b===null||b===Object.prototype||Object.getPrototypeOf(b)===null)&&!(Symbol.toStringTag in E)&&!(Symbol.iterator in E)},qz=Ac("Date"),Xz=Ac("File"),Jz=Ac("Blob"),Qz=Ac("FileList"),Zz=E=>p0(E)&&Ga(E.pipe),$z=E=>{let b;return E&&(typeof FormData=="function"&&E instanceof FormData||Ga(E.append)&&((b=u0(E))==="formdata"||b==="object"&&Ga(E.toString)&&E.toString()==="[object FormData]"))},tY=Ac("URLSearchParams"),[eY,nY,iY,rY]=["ReadableStream","Request","Response","Headers"].map(Ac),sY=E=>E.trim?E.trim():E.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Wy(E,b,{allOwnKeys:O=!1}={}){if(E===null||typeof E>"u")return;let A,L;if(typeof E!="object"&&(E=[E]),y_(E))for(A=0,L=E.length;A<L;A++)b.call(null,E[A],A,E);else{const U=O?Object.getOwnPropertyNames(E):Object.keys(E),K=U.length;let J;for(A=0;A<K;A++)J=U[A],b.call(null,E[J],J,E)}}function jV(E,b){b=b.toLowerCase();const O=Object.keys(E);let A=O.length,L;for(;A-- >0;)if(L=O[A],b===L.toLowerCase())return L;return null}const wf=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,VV=E=>!By(E)&&E!==wf;function qI(){const{caseless:E}=VV(this)&&this||{},b={},O=(A,L)=>{const U=E&&jV(b,L)||L;$R(b[U])&&$R(A)?b[U]=qI(b[U],A):$R(A)?b[U]=qI({},A):y_(A)?b[U]=A.slice():b[U]=A};for(let A=0,L=arguments.length;A<L;A++)arguments[A]&&Wy(arguments[A],O);return b}const aY=(E,b,O,{allOwnKeys:A}={})=>(Wy(b,(L,U)=>{O&&Ga(L)?E[U]=xV(L,O):E[U]=L},{allOwnKeys:A}),E),oY=E=>(E.charCodeAt(0)===65279&&(E=E.slice(1)),E),cY=(E,b,O,A)=>{E.prototype=Object.create(b.prototype,A),E.prototype.constructor=E,Object.defineProperty(E,"super",{value:b.prototype}),O&&Object.assign(E.prototype,O)},lY=(E,b,O,A)=>{let L,U,K;const J={};if(b=b||{},E==null)return b;do{for(L=Object.getOwnPropertyNames(E),U=L.length;U-- >0;)K=L[U],(!A||A(K,E,b))&&!J[K]&&(b[K]=E[K],J[K]=!0);E=O!==!1&&dO(E)}while(E&&(!O||O(E,b))&&E!==Object.prototype);return b},dY=(E,b,O)=>{E=String(E),(O===void 0||O>E.length)&&(O=E.length),O-=b.length;const A=E.indexOf(b,O);return A!==-1&&A===O},uY=E=>{if(!E)return null;if(y_(E))return E;let b=E.length;if(!UV(b))return null;const O=new Array(b);for(;b-- >0;)O[b]=E[b];return O},hY=(E=>b=>E&&b instanceof E)(typeof Uint8Array<"u"&&dO(Uint8Array)),pY=(E,b)=>{const A=(E&&E[Symbol.iterator]).call(E);let L;for(;(L=A.next())&&!L.done;){const U=L.value;b.call(E,U[0],U[1])}},fY=(E,b)=>{let O;const A=[];for(;(O=E.exec(b))!==null;)A.push(O);return A},mY=Ac("HTMLFormElement"),EY=E=>E.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(O,A,L){return A.toUpperCase()+L}),Qj=(({hasOwnProperty:E})=>(b,O)=>E.call(b,O))(Object.prototype),_Y=Ac("RegExp"),BV=(E,b)=>{const O=Object.getOwnPropertyDescriptors(E),A={};Wy(O,(L,U)=>{let K;(K=b(L,U,E))!==!1&&(A[U]=K||L)}),Object.defineProperties(E,A)},gY=E=>{BV(E,(b,O)=>{if(Ga(E)&&["arguments","caller","callee"].indexOf(O)!==-1)return!1;const A=E[O];if(Ga(A)){if(b.enumerable=!1,"writable"in b){b.writable=!1;return}b.set||(b.set=()=>{throw Error("Can not rewrite read-only method '"+O+"'")})}})},SY=(E,b)=>{const O={},A=L=>{L.forEach(U=>{O[U]=!0})};return y_(E)?A(E):A(String(E).split(b)),O},yY=()=>{},TY=(E,b)=>E!=null&&Number.isFinite(E=+E)?E:b;function vY(E){return!!(E&&Ga(E.append)&&E[Symbol.toStringTag]==="FormData"&&E[Symbol.iterator])}const bY=E=>{const b=new Array(10),O=(A,L)=>{if(p0(A)){if(b.indexOf(A)>=0)return;if(!("toJSON"in A)){b[L]=A;const U=y_(A)?[]:{};return Wy(A,(K,J)=>{const G=O(K,L+1);!By(G)&&(U[J]=G)}),b[L]=void 0,U}}return A};return O(E,0)},RY=Ac("AsyncFunction"),CY=E=>E&&(p0(E)||Ga(E))&&Ga(E.then)&&Ga(E.catch),FV=((E,b)=>E?setImmediate:b?((O,A)=>(wf.addEventListener("message",({source:L,data:U})=>{L===wf&&U===O&&A.length&&A.shift()()},!1),L=>{A.push(L),wf.postMessage(O,"*")}))(`axios@${Math.random()}`,[]):O=>setTimeout(O))(typeof setImmediate=="function",Ga(wf.postMessage)),AY=typeof queueMicrotask<"u"?queueMicrotask.bind(wf):typeof process<"u"&&process.nextTick||FV,Dt={isArray:y_,isArrayBuffer:MV,isBuffer:Wz,isFormData:$z,isArrayBufferView:Kz,isString:zz,isNumber:UV,isBoolean:Yz,isObject:p0,isPlainObject:$R,isReadableStream:eY,isRequest:nY,isResponse:iY,isHeaders:rY,isUndefined:By,isDate:qz,isFile:Xz,isBlob:Jz,isRegExp:_Y,isFunction:Ga,isStream:Zz,isURLSearchParams:tY,isTypedArray:hY,isFileList:Qz,forEach:Wy,merge:qI,extend:aY,trim:sY,stripBOM:oY,inherits:cY,toFlatObject:lY,kindOf:u0,kindOfTest:Ac,endsWith:dY,toArray:uY,forEachEntry:pY,matchAll:fY,isHTMLForm:mY,hasOwnProperty:Qj,hasOwnProp:Qj,reduceDescriptors:BV,freezeMethods:gY,toObjectSet:SY,toCamelCase:EY,noop:yY,toFiniteNumber:TY,findKey:jV,global:wf,isContextDefined:VV,isSpecCompliantForm:vY,toJSONObject:bY,isAsyncFn:RY,isThenable:CY,setImmediate:FV,asap:AY};function dn(E,b,O,A,L){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=E,this.name="AxiosError",b&&(this.code=b),O&&(this.config=O),A&&(this.request=A),L&&(this.response=L,this.status=L.status?L.status:null)}Dt.inherits(dn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Dt.toJSONObject(this.config),code:this.code,status:this.status}}});const GV=dn.prototype,HV={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(E=>{HV[E]={value:E}});Object.defineProperties(dn,HV);Object.defineProperty(GV,"isAxiosError",{value:!0});dn.from=(E,b,O,A,L,U)=>{const K=Object.create(GV);return Dt.toFlatObject(E,K,function(G){return G!==Error.prototype},J=>J!=="isAxiosError"),dn.call(K,E.message,b,O,A,L),K.cause=E,K.name=E.name,U&&Object.assign(K,U),K};const wY=null;function XI(E){return Dt.isPlainObject(E)||Dt.isArray(E)}function WV(E){return Dt.endsWith(E,"[]")?E.slice(0,-2):E}function Zj(E,b,O){return E?E.concat(b).map(function(L,U){return L=WV(L),!O&&U?"["+L+"]":L}).join(O?".":""):b}function IY(E){return Dt.isArray(E)&&!E.some(XI)}const OY=Dt.toFlatObject(Dt,{},null,function(b){return/^is[A-Z]/.test(b)});function f0(E,b,O){if(!Dt.isObject(E))throw new TypeError("target must be an object");b=b||new FormData,O=Dt.toFlatObject(O,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Ct,yt){return!Dt.isUndefined(yt[Ct])});const A=O.metaTokens,L=O.visitor||rt,U=O.dots,K=O.indexes,G=(O.Blob||typeof Blob<"u"&&Blob)&&Dt.isSpecCompliantForm(b);if(!Dt.isFunction(L))throw new TypeError("visitor must be a function");function H(st){if(st===null)return"";if(Dt.isDate(st))return st.toISOString();if(!G&&Dt.isBlob(st))throw new dn("Blob is not supported. Use a Buffer instead.");return Dt.isArrayBuffer(st)||Dt.isTypedArray(st)?G&&typeof Blob=="function"?new Blob([st]):Buffer.from(st):st}function rt(st,Ct,yt){let It=st;if(st&&!yt&&typeof st=="object"){if(Dt.endsWith(Ct,"{}"))Ct=A?Ct:Ct.slice(0,-2),st=JSON.stringify(st);else if(Dt.isArray(st)&&IY(st)||(Dt.isFileList(st)||Dt.endsWith(Ct,"[]"))&&(It=Dt.toArray(st)))return Ct=WV(Ct),It.forEach(function(Rt,ye){!(Dt.isUndefined(Rt)||Rt===null)&&b.append(K===!0?Zj([Ct],ye,U):K===null?Ct:Ct+"[]",H(Rt))}),!1}return XI(st)?!0:(b.append(Zj(yt,Ct,U),H(st)),!1)}const lt=[],dt=Object.assign(OY,{defaultVisitor:rt,convertValue:H,isVisitable:XI});function X(st,Ct){if(!Dt.isUndefined(st)){if(lt.indexOf(st)!==-1)throw Error("Circular reference detected in "+Ct.join("."));lt.push(st),Dt.forEach(st,function(It,Wt){(!(Dt.isUndefined(It)||It===null)&&L.call(b,It,Dt.isString(Wt)?Wt.trim():Wt,Ct,dt))===!0&&X(It,Ct?Ct.concat(Wt):[Wt])}),lt.pop()}}if(!Dt.isObject(E))throw new TypeError("data must be an object");return X(E),b}function $j(E){const b={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(E).replace(/[!'()~]|%20|%00/g,function(A){return b[A]})}function uO(E,b){this._pairs=[],E&&f0(E,this,b)}const KV=uO.prototype;KV.append=function(b,O){this._pairs.push([b,O])};KV.toString=function(b){const O=b?function(A){return b.call(this,A,$j)}:$j;return this._pairs.map(function(L){return O(L[0])+"="+O(L[1])},"").join("&")};function NY(E){return encodeURIComponent(E).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function zV(E,b,O){if(!b)return E;const A=O&&O.encode||NY;Dt.isFunction(O)&&(O={serialize:O});const L=O&&O.serialize;let U;if(L?U=L(b,O):U=Dt.isURLSearchParams(b)?b.toString():new uO(b,O).toString(A),U){const K=E.indexOf("#");K!==-1&&(E=E.slice(0,K)),E+=(E.indexOf("?")===-1?"?":"&")+U}return E}class tV{constructor(){this.handlers=[]}use(b,O,A){return this.handlers.push({fulfilled:b,rejected:O,synchronous:A?A.synchronous:!1,runWhen:A?A.runWhen:null}),this.handlers.length-1}eject(b){this.handlers[b]&&(this.handlers[b]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(b){Dt.forEach(this.handlers,function(A){A!==null&&b(A)})}}const YV={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},DY=typeof URLSearchParams<"u"?URLSearchParams:uO,LY=typeof FormData<"u"?FormData:null,PY=typeof Blob<"u"?Blob:null,kY={isBrowser:!0,classes:{URLSearchParams:DY,FormData:LY,Blob:PY},protocols:["http","https","file","blob","url","data"]},hO=typeof window<"u"&&typeof document<"u",JI=typeof navigator=="object"&&navigator||void 0,xY=hO&&(!JI||["ReactNative","NativeScript","NS"].indexOf(JI.product)<0),MY=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",UY=hO&&window.location.href||"http://localhost",jY=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:hO,hasStandardBrowserEnv:xY,hasStandardBrowserWebWorkerEnv:MY,navigator:JI,origin:UY},Symbol.toStringTag,{value:"Module"})),Is={...jY,...kY};function VY(E,b){return f0(E,new Is.classes.URLSearchParams,Object.assign({visitor:function(O,A,L,U){return Is.isNode&&Dt.isBuffer(O)?(this.append(A,O.toString("base64")),!1):U.defaultVisitor.apply(this,arguments)}},b))}function BY(E){return Dt.matchAll(/\w+|\[(\w*)]/g,E).map(b=>b[0]==="[]"?"":b[1]||b[0])}function FY(E){const b={},O=Object.keys(E);let A;const L=O.length;let U;for(A=0;A<L;A++)U=O[A],b[U]=E[U];return b}function qV(E){function b(O,A,L,U){let K=O[U++];if(K==="__proto__")return!0;const J=Number.isFinite(+K),G=U>=O.length;return K=!K&&Dt.isArray(L)?L.length:K,G?(Dt.hasOwnProp(L,K)?L[K]=[L[K],A]:L[K]=A,!J):((!L[K]||!Dt.isObject(L[K]))&&(L[K]=[]),b(O,A,L[K],U)&&Dt.isArray(L[K])&&(L[K]=FY(L[K])),!J)}if(Dt.isFormData(E)&&Dt.isFunction(E.entries)){const O={};return Dt.forEachEntry(E,(A,L)=>{b(BY(A),L,O,0)}),O}return null}function GY(E,b,O){if(Dt.isString(E))try{return(b||JSON.parse)(E),Dt.trim(E)}catch(A){if(A.name!=="SyntaxError")throw A}return(O||JSON.stringify)(E)}const Ky={transitional:YV,adapter:["xhr","http","fetch"],transformRequest:[function(b,O){const A=O.getContentType()||"",L=A.indexOf("application/json")>-1,U=Dt.isObject(b);if(U&&Dt.isHTMLForm(b)&&(b=new FormData(b)),Dt.isFormData(b))return L?JSON.stringify(qV(b)):b;if(Dt.isArrayBuffer(b)||Dt.isBuffer(b)||Dt.isStream(b)||Dt.isFile(b)||Dt.isBlob(b)||Dt.isReadableStream(b))return b;if(Dt.isArrayBufferView(b))return b.buffer;if(Dt.isURLSearchParams(b))return O.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),b.toString();let J;if(U){if(A.indexOf("application/x-www-form-urlencoded")>-1)return VY(b,this.formSerializer).toString();if((J=Dt.isFileList(b))||A.indexOf("multipart/form-data")>-1){const G=this.env&&this.env.FormData;return f0(J?{"files[]":b}:b,G&&new G,this.formSerializer)}}return U||L?(O.setContentType("application/json",!1),GY(b)):b}],transformResponse:[function(b){const O=this.transitional||Ky.transitional,A=O&&O.forcedJSONParsing,L=this.responseType==="json";if(Dt.isResponse(b)||Dt.isReadableStream(b))return b;if(b&&Dt.isString(b)&&(A&&!this.responseType||L)){const K=!(O&&O.silentJSONParsing)&&L;try{return JSON.parse(b)}catch(J){if(K)throw J.name==="SyntaxError"?dn.from(J,dn.ERR_BAD_RESPONSE,this,null,this.response):J}}return b}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Is.classes.FormData,Blob:Is.classes.Blob},validateStatus:function(b){return b>=200&&b<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Dt.forEach(["delete","get","head","post","put","patch"],E=>{Ky.headers[E]={}});const HY=Dt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),WY=E=>{const b={};let O,A,L;return E&&E.split(`
`).forEach(function(K){L=K.indexOf(":"),O=K.substring(0,L).trim().toLowerCase(),A=K.substring(L+1).trim(),!(!O||b[O]&&HY[O])&&(O==="set-cookie"?b[O]?b[O].push(A):b[O]=[A]:b[O]=b[O]?b[O]+", "+A:A)}),b},eV=Symbol("internals");function xy(E){return E&&String(E).trim().toLowerCase()}function t0(E){return E===!1||E==null?E:Dt.isArray(E)?E.map(t0):String(E)}function KY(E){const b=Object.create(null),O=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let A;for(;A=O.exec(E);)b[A[1]]=A[2];return b}const zY=E=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(E.trim());function GI(E,b,O,A,L){if(Dt.isFunction(A))return A.call(this,b,O);if(L&&(b=O),!!Dt.isString(b)){if(Dt.isString(A))return b.indexOf(A)!==-1;if(Dt.isRegExp(A))return A.test(b)}}function YY(E){return E.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(b,O,A)=>O.toUpperCase()+A)}function qY(E,b){const O=Dt.toCamelCase(" "+b);["get","set","has"].forEach(A=>{Object.defineProperty(E,A+O,{value:function(L,U,K){return this[A].call(this,b,L,U,K)},configurable:!0})})}let Ea=class{constructor(b){b&&this.set(b)}set(b,O,A){const L=this;function U(J,G,H){const rt=xy(G);if(!rt)throw new Error("header name must be a non-empty string");const lt=Dt.findKey(L,rt);(!lt||L[lt]===void 0||H===!0||H===void 0&&L[lt]!==!1)&&(L[lt||G]=t0(J))}const K=(J,G)=>Dt.forEach(J,(H,rt)=>U(H,rt,G));if(Dt.isPlainObject(b)||b instanceof this.constructor)K(b,O);else if(Dt.isString(b)&&(b=b.trim())&&!zY(b))K(WY(b),O);else if(Dt.isHeaders(b))for(const[J,G]of b.entries())U(G,J,A);else b!=null&&U(O,b,A);return this}get(b,O){if(b=xy(b),b){const A=Dt.findKey(this,b);if(A){const L=this[A];if(!O)return L;if(O===!0)return KY(L);if(Dt.isFunction(O))return O.call(this,L,A);if(Dt.isRegExp(O))return O.exec(L);throw new TypeError("parser must be boolean|regexp|function")}}}has(b,O){if(b=xy(b),b){const A=Dt.findKey(this,b);return!!(A&&this[A]!==void 0&&(!O||GI(this,this[A],A,O)))}return!1}delete(b,O){const A=this;let L=!1;function U(K){if(K=xy(K),K){const J=Dt.findKey(A,K);J&&(!O||GI(A,A[J],J,O))&&(delete A[J],L=!0)}}return Dt.isArray(b)?b.forEach(U):U(b),L}clear(b){const O=Object.keys(this);let A=O.length,L=!1;for(;A--;){const U=O[A];(!b||GI(this,this[U],U,b,!0))&&(delete this[U],L=!0)}return L}normalize(b){const O=this,A={};return Dt.forEach(this,(L,U)=>{const K=Dt.findKey(A,U);if(K){O[K]=t0(L),delete O[U];return}const J=b?YY(U):String(U).trim();J!==U&&delete O[U],O[J]=t0(L),A[J]=!0}),this}concat(...b){return this.constructor.concat(this,...b)}toJSON(b){const O=Object.create(null);return Dt.forEach(this,(A,L)=>{A!=null&&A!==!1&&(O[L]=b&&Dt.isArray(A)?A.join(", "):A)}),O}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([b,O])=>b+": "+O).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(b){return b instanceof this?b:new this(b)}static concat(b,...O){const A=new this(b);return O.forEach(L=>A.set(L)),A}static accessor(b){const A=(this[eV]=this[eV]={accessors:{}}).accessors,L=this.prototype;function U(K){const J=xy(K);A[J]||(qY(L,K),A[J]=!0)}return Dt.isArray(b)?b.forEach(U):U(b),this}};Ea.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Dt.reduceDescriptors(Ea.prototype,({value:E},b)=>{let O=b[0].toUpperCase()+b.slice(1);return{get:()=>E,set(A){this[O]=A}}});Dt.freezeMethods(Ea);function HI(E,b){const O=this||Ky,A=b||O,L=Ea.from(A.headers);let U=A.data;return Dt.forEach(E,function(J){U=J.call(O,U,L.normalize(),b?b.status:void 0)}),L.normalize(),U}function XV(E){return!!(E&&E.__CANCEL__)}function T_(E,b,O){dn.call(this,E??"canceled",dn.ERR_CANCELED,b,O),this.name="CanceledError"}Dt.inherits(T_,dn,{__CANCEL__:!0});function JV(E,b,O){const A=O.config.validateStatus;!O.status||!A||A(O.status)?E(O):b(new dn("Request failed with status code "+O.status,[dn.ERR_BAD_REQUEST,dn.ERR_BAD_RESPONSE][Math.floor(O.status/100)-4],O.config,O.request,O))}function XY(E){const b=/^([-+\w]{1,25})(:?\/\/|:)/.exec(E);return b&&b[1]||""}function JY(E,b){E=E||10;const O=new Array(E),A=new Array(E);let L=0,U=0,K;return b=b!==void 0?b:1e3,function(G){const H=Date.now(),rt=A[U];K||(K=H),O[L]=G,A[L]=H;let lt=U,dt=0;for(;lt!==L;)dt+=O[lt++],lt=lt%E;if(L=(L+1)%E,L===U&&(U=(U+1)%E),H-K<b)return;const X=rt&&H-rt;return X?Math.round(dt*1e3/X):void 0}}function QY(E,b){let O=0,A=1e3/b,L,U;const K=(H,rt=Date.now())=>{O=rt,L=null,U&&(clearTimeout(U),U=null),E.apply(null,H)};return[(...H)=>{const rt=Date.now(),lt=rt-O;lt>=A?K(H,rt):(L=H,U||(U=setTimeout(()=>{U=null,K(L)},A-lt)))},()=>L&&K(L)]}const s0=(E,b,O=3)=>{let A=0;const L=JY(50,250);return QY(U=>{const K=U.loaded,J=U.lengthComputable?U.total:void 0,G=K-A,H=L(G),rt=K<=J;A=K;const lt={loaded:K,total:J,progress:J?K/J:void 0,bytes:G,rate:H||void 0,estimated:H&&J&&rt?(J-K)/H:void 0,event:U,lengthComputable:J!=null,[b?"download":"upload"]:!0};E(lt)},O)},nV=(E,b)=>{const O=E!=null;return[A=>b[0]({lengthComputable:O,total:E,loaded:A}),b[1]]},iV=E=>(...b)=>Dt.asap(()=>E(...b)),ZY=Is.hasStandardBrowserEnv?((E,b)=>O=>(O=new URL(O,Is.origin),E.protocol===O.protocol&&E.host===O.host&&(b||E.port===O.port)))(new URL(Is.origin),Is.navigator&&/(msie|trident)/i.test(Is.navigator.userAgent)):()=>!0,$Y=Is.hasStandardBrowserEnv?{write(E,b,O,A,L,U){const K=[E+"="+encodeURIComponent(b)];Dt.isNumber(O)&&K.push("expires="+new Date(O).toGMTString()),Dt.isString(A)&&K.push("path="+A),Dt.isString(L)&&K.push("domain="+L),U===!0&&K.push("secure"),document.cookie=K.join("; ")},read(E){const b=document.cookie.match(new RegExp("(^|;\\s*)("+E+")=([^;]*)"));return b?decodeURIComponent(b[3]):null},remove(E){this.write(E,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function tq(E){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(E)}function eq(E,b){return b?E.replace(/\/?\/$/,"")+"/"+b.replace(/^\/+/,""):E}function QV(E,b,O){let A=!tq(b);return E&&(A||O==!1)?eq(E,b):b}const rV=E=>E instanceof Ea?{...E}:E;function Of(E,b){b=b||{};const O={};function A(H,rt,lt,dt){return Dt.isPlainObject(H)&&Dt.isPlainObject(rt)?Dt.merge.call({caseless:dt},H,rt):Dt.isPlainObject(rt)?Dt.merge({},rt):Dt.isArray(rt)?rt.slice():rt}function L(H,rt,lt,dt){if(Dt.isUndefined(rt)){if(!Dt.isUndefined(H))return A(void 0,H,lt,dt)}else return A(H,rt,lt,dt)}function U(H,rt){if(!Dt.isUndefined(rt))return A(void 0,rt)}function K(H,rt){if(Dt.isUndefined(rt)){if(!Dt.isUndefined(H))return A(void 0,H)}else return A(void 0,rt)}function J(H,rt,lt){if(lt in b)return A(H,rt);if(lt in E)return A(void 0,H)}const G={url:U,method:U,data:U,baseURL:K,transformRequest:K,transformResponse:K,paramsSerializer:K,timeout:K,timeoutMessage:K,withCredentials:K,withXSRFToken:K,adapter:K,responseType:K,xsrfCookieName:K,xsrfHeaderName:K,onUploadProgress:K,onDownloadProgress:K,decompress:K,maxContentLength:K,maxBodyLength:K,beforeRedirect:K,transport:K,httpAgent:K,httpsAgent:K,cancelToken:K,socketPath:K,responseEncoding:K,validateStatus:J,headers:(H,rt,lt)=>L(rV(H),rV(rt),lt,!0)};return Dt.forEach(Object.keys(Object.assign({},E,b)),function(rt){const lt=G[rt]||L,dt=lt(E[rt],b[rt],rt);Dt.isUndefined(dt)&&lt!==J||(O[rt]=dt)}),O}const ZV=E=>{const b=Of({},E);let{data:O,withXSRFToken:A,xsrfHeaderName:L,xsrfCookieName:U,headers:K,auth:J}=b;b.headers=K=Ea.from(K),b.url=zV(QV(b.baseURL,b.url,b.allowAbsoluteUrls),E.params,E.paramsSerializer),J&&K.set("Authorization","Basic "+btoa((J.username||"")+":"+(J.password?unescape(encodeURIComponent(J.password)):"")));let G;if(Dt.isFormData(O)){if(Is.hasStandardBrowserEnv||Is.hasStandardBrowserWebWorkerEnv)K.setContentType(void 0);else if((G=K.getContentType())!==!1){const[H,...rt]=G?G.split(";").map(lt=>lt.trim()).filter(Boolean):[];K.setContentType([H||"multipart/form-data",...rt].join("; "))}}if(Is.hasStandardBrowserEnv&&(A&&Dt.isFunction(A)&&(A=A(b)),A||A!==!1&&ZY(b.url))){const H=L&&U&&$Y.read(U);H&&K.set(L,H)}return b},nq=typeof XMLHttpRequest<"u",iq=nq&&function(E){return new Promise(function(O,A){const L=ZV(E);let U=L.data;const K=Ea.from(L.headers).normalize();let{responseType:J,onUploadProgress:G,onDownloadProgress:H}=L,rt,lt,dt,X,st;function Ct(){X&&X(),st&&st(),L.cancelToken&&L.cancelToken.unsubscribe(rt),L.signal&&L.signal.removeEventListener("abort",rt)}let yt=new XMLHttpRequest;yt.open(L.method.toUpperCase(),L.url,!0),yt.timeout=L.timeout;function It(){if(!yt)return;const Rt=Ea.from("getAllResponseHeaders"in yt&&yt.getAllResponseHeaders()),ne={data:!J||J==="text"||J==="json"?yt.responseText:yt.response,status:yt.status,statusText:yt.statusText,headers:Rt,config:E,request:yt};JV(function(Ne){O(Ne),Ct()},function(Ne){A(Ne),Ct()},ne),yt=null}"onloadend"in yt?yt.onloadend=It:yt.onreadystatechange=function(){!yt||yt.readyState!==4||yt.status===0&&!(yt.responseURL&&yt.responseURL.indexOf("file:")===0)||setTimeout(It)},yt.onabort=function(){yt&&(A(new dn("Request aborted",dn.ECONNABORTED,E,yt)),yt=null)},yt.onerror=function(){A(new dn("Network Error",dn.ERR_NETWORK,E,yt)),yt=null},yt.ontimeout=function(){let ye=L.timeout?"timeout of "+L.timeout+"ms exceeded":"timeout exceeded";const ne=L.transitional||YV;L.timeoutErrorMessage&&(ye=L.timeoutErrorMessage),A(new dn(ye,ne.clarifyTimeoutError?dn.ETIMEDOUT:dn.ECONNABORTED,E,yt)),yt=null},U===void 0&&K.setContentType(null),"setRequestHeader"in yt&&Dt.forEach(K.toJSON(),function(ye,ne){yt.setRequestHeader(ne,ye)}),Dt.isUndefined(L.withCredentials)||(yt.withCredentials=!!L.withCredentials),J&&J!=="json"&&(yt.responseType=L.responseType),H&&([dt,st]=s0(H,!0),yt.addEventListener("progress",dt)),G&&yt.upload&&([lt,X]=s0(G),yt.upload.addEventListener("progress",lt),yt.upload.addEventListener("loadend",X)),(L.cancelToken||L.signal)&&(rt=Rt=>{yt&&(A(!Rt||Rt.type?new T_(null,E,yt):Rt),yt.abort(),yt=null)},L.cancelToken&&L.cancelToken.subscribe(rt),L.signal&&(L.signal.aborted?rt():L.signal.addEventListener("abort",rt)));const Wt=XY(L.url);if(Wt&&Is.protocols.indexOf(Wt)===-1){A(new dn("Unsupported protocol "+Wt+":",dn.ERR_BAD_REQUEST,E));return}yt.send(U||null)})},rq=(E,b)=>{const{length:O}=E=E?E.filter(Boolean):[];if(b||O){let A=new AbortController,L;const U=function(H){if(!L){L=!0,J();const rt=H instanceof Error?H:this.reason;A.abort(rt instanceof dn?rt:new T_(rt instanceof Error?rt.message:rt))}};let K=b&&setTimeout(()=>{K=null,U(new dn(`timeout ${b} of ms exceeded`,dn.ETIMEDOUT))},b);const J=()=>{E&&(K&&clearTimeout(K),K=null,E.forEach(H=>{H.unsubscribe?H.unsubscribe(U):H.removeEventListener("abort",U)}),E=null)};E.forEach(H=>H.addEventListener("abort",U));const{signal:G}=A;return G.unsubscribe=()=>Dt.asap(J),G}},sq=function*(E,b){let O=E.byteLength;if(O<b){yield E;return}let A=0,L;for(;A<O;)L=A+b,yield E.slice(A,L),A=L},aq=async function*(E,b){for await(const O of oq(E))yield*sq(O,b)},oq=async function*(E){if(E[Symbol.asyncIterator]){yield*E;return}const b=E.getReader();try{for(;;){const{done:O,value:A}=await b.read();if(O)break;yield A}}finally{await b.cancel()}},sV=(E,b,O,A)=>{const L=aq(E,b);let U=0,K,J=G=>{K||(K=!0,A&&A(G))};return new ReadableStream({async pull(G){try{const{done:H,value:rt}=await L.next();if(H){J(),G.close();return}let lt=rt.byteLength;if(O){let dt=U+=lt;O(dt)}G.enqueue(new Uint8Array(rt))}catch(H){throw J(H),H}},cancel(G){return J(G),L.return()}},{highWaterMark:2})},m0=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",$V=m0&&typeof ReadableStream=="function",cq=m0&&(typeof TextEncoder=="function"?(E=>b=>E.encode(b))(new TextEncoder):async E=>new Uint8Array(await new Response(E).arrayBuffer())),tB=(E,...b)=>{try{return!!E(...b)}catch{return!1}},lq=$V&&tB(()=>{let E=!1;const b=new Request(Is.origin,{body:new ReadableStream,method:"POST",get duplex(){return E=!0,"half"}}).headers.has("Content-Type");return E&&!b}),aV=64*1024,QI=$V&&tB(()=>Dt.isReadableStream(new Response("").body)),a0={stream:QI&&(E=>E.body)};m0&&(E=>{["text","arrayBuffer","blob","formData","stream"].forEach(b=>{!a0[b]&&(a0[b]=Dt.isFunction(E[b])?O=>O[b]():(O,A)=>{throw new dn(`Response type '${b}' is not supported`,dn.ERR_NOT_SUPPORT,A)})})})(new Response);const dq=async E=>{if(E==null)return 0;if(Dt.isBlob(E))return E.size;if(Dt.isSpecCompliantForm(E))return(await new Request(Is.origin,{method:"POST",body:E}).arrayBuffer()).byteLength;if(Dt.isArrayBufferView(E)||Dt.isArrayBuffer(E))return E.byteLength;if(Dt.isURLSearchParams(E)&&(E=E+""),Dt.isString(E))return(await cq(E)).byteLength},uq=async(E,b)=>{const O=Dt.toFiniteNumber(E.getContentLength());return O??dq(b)},hq=m0&&(async E=>{let{url:b,method:O,data:A,signal:L,cancelToken:U,timeout:K,onDownloadProgress:J,onUploadProgress:G,responseType:H,headers:rt,withCredentials:lt="same-origin",fetchOptions:dt}=ZV(E);H=H?(H+"").toLowerCase():"text";let X=rq([L,U&&U.toAbortSignal()],K),st;const Ct=X&&X.unsubscribe&&(()=>{X.unsubscribe()});let yt;try{if(G&&lq&&O!=="get"&&O!=="head"&&(yt=await uq(rt,A))!==0){let ne=new Request(b,{method:"POST",body:A,duplex:"half"}),_e;if(Dt.isFormData(A)&&(_e=ne.headers.get("content-type"))&&rt.setContentType(_e),ne.body){const[Ne,Ie]=nV(yt,s0(iV(G)));A=sV(ne.body,aV,Ne,Ie)}}Dt.isString(lt)||(lt=lt?"include":"omit");const It="credentials"in Request.prototype;st=new Request(b,{...dt,signal:X,method:O.toUpperCase(),headers:rt.normalize().toJSON(),body:A,duplex:"half",credentials:It?lt:void 0});let Wt=await fetch(st);const Rt=QI&&(H==="stream"||H==="response");if(QI&&(J||Rt&&Ct)){const ne={};["status","statusText","headers"].forEach(Xt=>{ne[Xt]=Wt[Xt]});const _e=Dt.toFiniteNumber(Wt.headers.get("content-length")),[Ne,Ie]=J&&nV(_e,s0(iV(J),!0))||[];Wt=new Response(sV(Wt.body,aV,Ne,()=>{Ie&&Ie(),Ct&&Ct()}),ne)}H=H||"text";let ye=await a0[Dt.findKey(a0,H)||"text"](Wt,E);return!Rt&&Ct&&Ct(),await new Promise((ne,_e)=>{JV(ne,_e,{data:ye,headers:Ea.from(Wt.headers),status:Wt.status,statusText:Wt.statusText,config:E,request:st})})}catch(It){throw Ct&&Ct(),It&&It.name==="TypeError"&&/fetch/i.test(It.message)?Object.assign(new dn("Network Error",dn.ERR_NETWORK,E,st),{cause:It.cause||It}):dn.from(It,It&&It.code,E,st)}}),ZI={http:wY,xhr:iq,fetch:hq};Dt.forEach(ZI,(E,b)=>{if(E){try{Object.defineProperty(E,"name",{value:b})}catch{}Object.defineProperty(E,"adapterName",{value:b})}});const oV=E=>`- ${E}`,pq=E=>Dt.isFunction(E)||E===null||E===!1,eB={getAdapter:E=>{E=Dt.isArray(E)?E:[E];const{length:b}=E;let O,A;const L={};for(let U=0;U<b;U++){O=E[U];let K;if(A=O,!pq(O)&&(A=ZI[(K=String(O)).toLowerCase()],A===void 0))throw new dn(`Unknown adapter '${K}'`);if(A)break;L[K||"#"+U]=A}if(!A){const U=Object.entries(L).map(([J,G])=>`adapter ${J} `+(G===!1?"is not supported by the environment":"is not available in the build"));let K=b?U.length>1?`since :
`+U.map(oV).join(`
`):" "+oV(U[0]):"as no adapter specified";throw new dn("There is no suitable adapter to dispatch the request "+K,"ERR_NOT_SUPPORT")}return A},adapters:ZI};function WI(E){if(E.cancelToken&&E.cancelToken.throwIfRequested(),E.signal&&E.signal.aborted)throw new T_(null,E)}function cV(E){return WI(E),E.headers=Ea.from(E.headers),E.data=HI.call(E,E.transformRequest),["post","put","patch"].indexOf(E.method)!==-1&&E.headers.setContentType("application/x-www-form-urlencoded",!1),eB.getAdapter(E.adapter||Ky.adapter)(E).then(function(A){return WI(E),A.data=HI.call(E,E.transformResponse,A),A.headers=Ea.from(A.headers),A},function(A){return XV(A)||(WI(E),A&&A.response&&(A.response.data=HI.call(E,E.transformResponse,A.response),A.response.headers=Ea.from(A.response.headers))),Promise.reject(A)})}const nB="1.8.4",E0={};["object","boolean","number","function","string","symbol"].forEach((E,b)=>{E0[E]=function(A){return typeof A===E||"a"+(b<1?"n ":" ")+E}});const lV={};E0.transitional=function(b,O,A){function L(U,K){return"[Axios v"+nB+"] Transitional option '"+U+"'"+K+(A?". "+A:"")}return(U,K,J)=>{if(b===!1)throw new dn(L(K," has been removed"+(O?" in "+O:"")),dn.ERR_DEPRECATED);return O&&!lV[K]&&(lV[K]=!0,console.warn(L(K," has been deprecated since v"+O+" and will be removed in the near future"))),b?b(U,K,J):!0}};E0.spelling=function(b){return(O,A)=>(console.warn(`${A} is likely a misspelling of ${b}`),!0)};function fq(E,b,O){if(typeof E!="object")throw new dn("options must be an object",dn.ERR_BAD_OPTION_VALUE);const A=Object.keys(E);let L=A.length;for(;L-- >0;){const U=A[L],K=b[U];if(K){const J=E[U],G=J===void 0||K(J,U,E);if(G!==!0)throw new dn("option "+U+" must be "+G,dn.ERR_BAD_OPTION_VALUE);continue}if(O!==!0)throw new dn("Unknown option "+U,dn.ERR_BAD_OPTION)}}const e0={assertOptions:fq,validators:E0},wl=e0.validators;let If=class{constructor(b){this.defaults=b,this.interceptors={request:new tV,response:new tV}}async request(b,O){try{return await this._request(b,O)}catch(A){if(A instanceof Error){let L={};Error.captureStackTrace?Error.captureStackTrace(L):L=new Error;const U=L.stack?L.stack.replace(/^.+\n/,""):"";try{A.stack?U&&!String(A.stack).endsWith(U.replace(/^.+\n.+\n/,""))&&(A.stack+=`
`+U):A.stack=U}catch{}}throw A}}_request(b,O){typeof b=="string"?(O=O||{},O.url=b):O=b||{},O=Of(this.defaults,O);const{transitional:A,paramsSerializer:L,headers:U}=O;A!==void 0&&e0.assertOptions(A,{silentJSONParsing:wl.transitional(wl.boolean),forcedJSONParsing:wl.transitional(wl.boolean),clarifyTimeoutError:wl.transitional(wl.boolean)},!1),L!=null&&(Dt.isFunction(L)?O.paramsSerializer={serialize:L}:e0.assertOptions(L,{encode:wl.function,serialize:wl.function},!0)),O.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?O.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:O.allowAbsoluteUrls=!0),e0.assertOptions(O,{baseUrl:wl.spelling("baseURL"),withXsrfToken:wl.spelling("withXSRFToken")},!0),O.method=(O.method||this.defaults.method||"get").toLowerCase();let K=U&&Dt.merge(U.common,U[O.method]);U&&Dt.forEach(["delete","get","head","post","put","patch","common"],st=>{delete U[st]}),O.headers=Ea.concat(K,U);const J=[];let G=!0;this.interceptors.request.forEach(function(Ct){typeof Ct.runWhen=="function"&&Ct.runWhen(O)===!1||(G=G&&Ct.synchronous,J.unshift(Ct.fulfilled,Ct.rejected))});const H=[];this.interceptors.response.forEach(function(Ct){H.push(Ct.fulfilled,Ct.rejected)});let rt,lt=0,dt;if(!G){const st=[cV.bind(this),void 0];for(st.unshift.apply(st,J),st.push.apply(st,H),dt=st.length,rt=Promise.resolve(O);lt<dt;)rt=rt.then(st[lt++],st[lt++]);return rt}dt=J.length;let X=O;for(lt=0;lt<dt;){const st=J[lt++],Ct=J[lt++];try{X=st(X)}catch(yt){Ct.call(this,yt);break}}try{rt=cV.call(this,X)}catch(st){return Promise.reject(st)}for(lt=0,dt=H.length;lt<dt;)rt=rt.then(H[lt++],H[lt++]);return rt}getUri(b){b=Of(this.defaults,b);const O=QV(b.baseURL,b.url,b.allowAbsoluteUrls);return zV(O,b.params,b.paramsSerializer)}};Dt.forEach(["delete","get","head","options"],function(b){If.prototype[b]=function(O,A){return this.request(Of(A||{},{method:b,url:O,data:(A||{}).data}))}});Dt.forEach(["post","put","patch"],function(b){function O(A){return function(U,K,J){return this.request(Of(J||{},{method:b,headers:A?{"Content-Type":"multipart/form-data"}:{},url:U,data:K}))}}If.prototype[b]=O(),If.prototype[b+"Form"]=O(!0)});let mq=class iB{constructor(b){if(typeof b!="function")throw new TypeError("executor must be a function.");let O;this.promise=new Promise(function(U){O=U});const A=this;this.promise.then(L=>{if(!A._listeners)return;let U=A._listeners.length;for(;U-- >0;)A._listeners[U](L);A._listeners=null}),this.promise.then=L=>{let U;const K=new Promise(J=>{A.subscribe(J),U=J}).then(L);return K.cancel=function(){A.unsubscribe(U)},K},b(function(U,K,J){A.reason||(A.reason=new T_(U,K,J),O(A.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(b){if(this.reason){b(this.reason);return}this._listeners?this._listeners.push(b):this._listeners=[b]}unsubscribe(b){if(!this._listeners)return;const O=this._listeners.indexOf(b);O!==-1&&this._listeners.splice(O,1)}toAbortSignal(){const b=new AbortController,O=A=>{b.abort(A)};return this.subscribe(O),b.signal.unsubscribe=()=>this.unsubscribe(O),b.signal}static source(){let b;return{token:new iB(function(L){b=L}),cancel:b}}};function Eq(E){return function(O){return E.apply(null,O)}}function _q(E){return Dt.isObject(E)&&E.isAxiosError===!0}const $I={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries($I).forEach(([E,b])=>{$I[b]=E});function rB(E){const b=new If(E),O=xV(If.prototype.request,b);return Dt.extend(O,If.prototype,b,{allOwnKeys:!0}),Dt.extend(O,b,null,{allOwnKeys:!0}),O.create=function(L){return rB(Of(E,L))},O}const Si=rB(Ky);Si.Axios=If;Si.CanceledError=T_;Si.CancelToken=mq;Si.isCancel=XV;Si.VERSION=nB;Si.toFormData=f0;Si.AxiosError=dn;Si.Cancel=Si.CanceledError;Si.all=function(b){return Promise.all(b)};Si.spread=Eq;Si.isAxiosError=_q;Si.mergeConfig=Of;Si.AxiosHeaders=Ea;Si.formToJSON=E=>qV(Dt.isHTMLForm(E)?new FormData(E):E);Si.getAdapter=eB.getAdapter;Si.HttpStatusCode=$I;Si.default=Si;const{Axios:U7,AxiosError:j7,CanceledError:V7,isCancel:B7,CancelToken:F7,VERSION:G7,all:H7,Cancel:W7,isAxiosError:K7,spread:z7,toFormData:Y7,AxiosHeaders:q7,HttpStatusCode:X7,formToJSON:J7,getAdapter:Q7,mergeConfig:Z7}=Si;console.log("https://demoapi.deveraa.com/v1","import.meta.env.REACT_APP_API_URL");const sB=()=>{const E=JSON.parse(sessionStorage.getItem("token")||"{}"),b=Si.create({baseURL:"https://demoapi.deveraa.com/v1"});return b.interceptors.request.use(O=>(O.headers.Authorization=E.token?`Bearer ${E.token}`:"",O.headers.domainName="skyvoice",O)),b.interceptors.response.use(O=>O.data,O=>{var L,U;const A=((U=(L=O.response)==null?void 0:L.data)==null?void 0:U.message)||O.message;throw console.error("API Error:",A),new Error(A)}),b};let gq={data:""},Sq=E=>typeof window=="object"?((E?E.querySelector("#_goober"):window._goober)||Object.assign((E||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:E||gq,yq=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Tq=/\/\*[^]*?\*\/|  +/g,dV=/\n+/g,hh=(E,b)=>{let O="",A="",L="";for(let U in E){let K=E[U];U[0]=="@"?U[1]=="i"?O=U+" "+K+";":A+=U[1]=="f"?hh(K,U):U+"{"+hh(K,U[1]=="k"?"":b)+"}":typeof K=="object"?A+=hh(K,b?b.replace(/([^,])+/g,J=>U.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,G=>/&/.test(G)?G.replace(/&/g,J):J?J+" "+G:G)):U):K!=null&&(U=/^--/.test(U)?U:U.replace(/[A-Z]/g,"-$&").toLowerCase(),L+=hh.p?hh.p(U,K):U+":"+K+";")}return O+(b&&L?b+"{"+L+"}":L)+A},Dd={},aB=E=>{if(typeof E=="object"){let b="";for(let O in E)b+=O+aB(E[O]);return b}return E},vq=(E,b,O,A,L)=>{let U=aB(E),K=Dd[U]||(Dd[U]=(G=>{let H=0,rt=11;for(;H<G.length;)rt=101*rt+G.charCodeAt(H++)>>>0;return"go"+rt})(U));if(!Dd[K]){let G=U!==E?E:(H=>{let rt,lt,dt=[{}];for(;rt=yq.exec(H.replace(Tq,""));)rt[4]?dt.shift():rt[3]?(lt=rt[3].replace(dV," ").trim(),dt.unshift(dt[0][lt]=dt[0][lt]||{})):dt[0][rt[1]]=rt[2].replace(dV," ").trim();return dt[0]})(E);Dd[K]=hh(L?{["@keyframes "+K]:G}:G,O?"":"."+K)}let J=O&&Dd.g?Dd.g:null;return O&&(Dd.g=Dd[K]),((G,H,rt,lt)=>{lt?H.data=H.data.replace(lt,G):H.data.indexOf(G)===-1&&(H.data=rt?G+H.data:H.data+G)})(Dd[K],b,A,J),K},bq=(E,b,O)=>E.reduce((A,L,U)=>{let K=b[U];if(K&&K.call){let J=K(O),G=J&&J.props&&J.props.className||/^go/.test(J)&&J;K=G?"."+G:J&&typeof J=="object"?J.props?"":hh(J,""):J===!1?"":J}return A+L+(K??"")},"");function _0(E){let b=this||{},O=E.call?E(b.p):E;return vq(O.unshift?O.raw?bq(O,[].slice.call(arguments,1),b.p):O.reduce((A,L)=>Object.assign(A,L&&L.call?L(b.p):L),{}):O,Sq(b.target),b.g,b.o,b.k)}let oB,tO,eO;_0.bind({g:1});let kd=_0.bind({k:1});function Rq(E,b,O,A){hh.p=b,oB=E,tO=O,eO=A}function ph(E,b){let O=this||{};return function(){let A=arguments;function L(U,K){let J=Object.assign({},U),G=J.className||L.className;O.p=Object.assign({theme:tO&&tO()},J),O.o=/ *go\d+/.test(G),J.className=_0.apply(O,A)+(G?" "+G:"");let H=E;return E[0]&&(H=J.as||E,delete J.as),eO&&H[0]&&eO(J),oB(H,J)}return L}}var Cq=E=>typeof E=="function",nO=(E,b)=>Cq(E)?E(b):E,Aq=(()=>{let E=0;return()=>(++E).toString()})(),wq=(()=>{let E;return()=>{if(E===void 0&&typeof window<"u"){let b=matchMedia("(prefers-reduced-motion: reduce)");E=!b||b.matches}return E}})(),Iq=20,cB=(E,b)=>{switch(b.type){case 0:return{...E,toasts:[b.toast,...E.toasts].slice(0,Iq)};case 1:return{...E,toasts:E.toasts.map(U=>U.id===b.toast.id?{...U,...b.toast}:U)};case 2:let{toast:O}=b;return cB(E,{type:E.toasts.find(U=>U.id===O.id)?1:0,toast:O});case 3:let{toastId:A}=b;return{...E,toasts:E.toasts.map(U=>U.id===A||A===void 0?{...U,dismissed:!0,visible:!1}:U)};case 4:return b.toastId===void 0?{...E,toasts:[]}:{...E,toasts:E.toasts.filter(U=>U.id!==b.toastId)};case 5:return{...E,pausedAt:b.time};case 6:let L=b.time-(E.pausedAt||0);return{...E,pausedAt:void 0,toasts:E.toasts.map(U=>({...U,pauseDuration:U.pauseDuration+L}))}}},Oq=[],KI={toasts:[],pausedAt:void 0},pO=E=>{KI=cB(KI,E),Oq.forEach(b=>{b(KI)})},Nq=(E,b="blank",O)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:b,ariaProps:{role:"status","aria-live":"polite"},message:E,pauseDuration:0,...O,id:(O==null?void 0:O.id)||Aq()}),zy=E=>(b,O)=>{let A=Nq(b,E,O);return pO({type:2,toast:A}),A.id},Fa=(E,b)=>zy("blank")(E,b);Fa.error=zy("error");Fa.success=zy("success");Fa.loading=zy("loading");Fa.custom=zy("custom");Fa.dismiss=E=>{pO({type:3,toastId:E})};Fa.remove=E=>pO({type:4,toastId:E});Fa.promise=(E,b,O)=>{let A=Fa.loading(b.loading,{...O,...O==null?void 0:O.loading});return typeof E=="function"&&(E=E()),E.then(L=>{let U=b.success?nO(b.success,L):void 0;return U?Fa.success(U,{id:A,...O,...O==null?void 0:O.success}):Fa.dismiss(A),L}).catch(L=>{let U=b.error?nO(b.error,L):void 0;U?Fa.error(U,{id:A,...O,...O==null?void 0:O.error}):Fa.dismiss(A)}),E};var Dq=kd`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Lq=kd`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Pq=kd`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,kq=ph("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${E=>E.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Dq} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Lq} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${E=>E.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Pq} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,xq=kd`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Mq=ph("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${E=>E.secondary||"#e0e0e0"};
  border-right-color: ${E=>E.primary||"#616161"};
  animation: ${xq} 1s linear infinite;
`,Uq=kd`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,jq=kd`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Vq=ph("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${E=>E.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Uq} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${jq} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${E=>E.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Bq=ph("div")`
  position: absolute;
`,Fq=ph("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Gq=kd`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Hq=ph("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Gq} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Wq=({toast:E})=>{let{icon:b,type:O,iconTheme:A}=E;return b!==void 0?typeof b=="string"?it.createElement(Hq,null,b):b:O==="blank"?null:it.createElement(Fq,null,it.createElement(Mq,{...A}),O!=="loading"&&it.createElement(Bq,null,O==="error"?it.createElement(kq,{...A}):it.createElement(Vq,{...A})))},Kq=E=>`
0% {transform: translate3d(0,${E*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,zq=E=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${E*-150}%,-1px) scale(.6); opacity:0;}
`,Yq="0%{opacity:0;} 100%{opacity:1;}",qq="0%{opacity:1;} 100%{opacity:0;}",Xq=ph("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Jq=ph("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Qq=(E,b)=>{let O=E.includes("top")?1:-1,[A,L]=wq()?[Yq,qq]:[Kq(O),zq(O)];return{animation:b?`${kd(A)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${kd(L)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}};it.memo(({toast:E,position:b,style:O,children:A})=>{let L=E.height?Qq(E.position||b||"top-center",E.visible):{opacity:0},U=it.createElement(Wq,{toast:E}),K=it.createElement(Jq,{...E.ariaProps},nO(E.message,E));return it.createElement(Xq,{className:E.className,style:{...L,...O,...E.style}},typeof A=="function"?A({icon:U,message:K}):it.createElement(it.Fragment,null,U,K))});Rq(it.createElement);_0`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`;var zs=Fa;const Yy=()=>{const E=sB(),b=async X=>{try{return await E.post("/superadmin/login",X)}catch(st){throw console.error(st),zs.error("Login failed"),new Error(st)}},O=async X=>{try{const st=await E.post("/admin/create",X);return console.log(st,"response in create new admin"),st.message===" Admin created successfully!"&&(console.log("Admin created successfully"),zs.success("Admin created successfully"),A()),st}catch(st){throw console.error(st),zs.error("Failed to create admin"),new Error(st)}},A=async(X=10,st=0,Ct="")=>{try{return await E.get(`/admin/list?pagesize=${X}&offset=${st}&search=${Ct}`)}catch(yt){throw console.error(yt),zs.error("Failed to fetch admin list"),new Error(yt)}};return{superadminlogin:b,createNewAdmin:O,deleteAllRecordings:async X=>{try{const st={...X};return console.log("data",st),await E.delete("/add/recordings/superadmin/delete",{data:st})}catch(st){throw console.error(st),zs.error("Failed to delete all recordings"),new Error(st)}},listAdmin:A,getAdminById:async X=>{try{return await E.get(`/admin/get/${X}`)}catch(st){throw console.error(st),zs.error("Failed to fetch admin details"),new Error(st)}},adminDropdown:async()=>{try{return await E.get("/admin/dropdown")}catch(X){throw console.error(X),zs.error("Failed to fetch admin dropdown"),new Error(X)}},updateAdmin:async(X,st)=>{try{const Ct=await E.put(`/admin/update/${X}`,st);return Ct.message===" Admin updated successfully"&&zs.success("Admin updated successfully"),Ct}catch(Ct){throw console.error(Ct),zs.error("Failed to update admin"),new Error(Ct)}},deleteAdmin:async X=>{console.log("userToDelete",X);try{const st=await E.delete(`/admin/delete/${X}`);return st.message===" Admin deleted successfully"&&zs.success("Admin deleted successfully"),st}catch(st){throw console.error(st),zs.error("Failed to delete admin"),new Error(st)}},adminhistory:async()=>{try{return await E.get("/superadmin/gethistory")}catch(X){throw console.error(X),zs.error("Failed to fetch admin history"),new Error(X)}},deleteadminhistory:async X=>{try{return await E.delete(`/superadmin/deletehistory/${X}`)}catch(st){throw console.error(st),zs.error("Failed to delete admin history"),new Error(st)}},saveprice:async X=>{try{return await E.post("/superadmin/saveprice",X)}catch(st){throw console.error(st),zs.error("Failed to create price"),new Error(st)}},getprice:async()=>{try{return await E.get("/superadmin/getprice")}catch(X){throw console.error(X),zs.error("Failed to fetch price "),new Error(X)}}}};var n0={exports:{}};/*!
* sweetalert2 v11.17.2
* Released under the MIT License.
*/var uh=n0.exports,uV;function Zq(){return uV||(uV=1,function(E,b){(function(O,A){E.exports=A()})(uh,function(){function O(y,I,j){if(typeof y=="function"?y===I:y.has(I))return arguments.length<3?I:j;throw new TypeError("Private element is not present on this object")}function A(y,I){if(I.has(y))throw new TypeError("Cannot initialize the same private elements twice on an object")}function L(y,I){return y.get(O(y,I))}function U(y,I,j){A(y,I),I.set(y,j)}function K(y,I,j){return y.set(O(y,I),j),j}const J=100,G={},H=()=>{G.previousActiveElement instanceof HTMLElement?(G.previousActiveElement.focus(),G.previousActiveElement=null):document.body&&document.body.focus()},rt=y=>new Promise(I=>{if(!y)return I();const j=window.scrollX,Q=window.scrollY;G.restoreFocusTimeout=setTimeout(()=>{H(),I()},J),window.scrollTo(j,Q)}),lt="swal2-",X=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"].reduce((y,I)=>(y[I]=lt+I,y),{}),Ct=["success","warning","info","question","error"].reduce((y,I)=>(y[I]=lt+I,y),{}),yt="SweetAlert2:",It=y=>y.charAt(0).toUpperCase()+y.slice(1),Wt=y=>{console.warn(`${yt} ${typeof y=="object"?y.join(" "):y}`)},Rt=y=>{console.error(`${yt} ${y}`)},ye=[],ne=y=>{ye.includes(y)||(ye.push(y),Wt(y))},_e=function(y){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;ne(`"${y}" is deprecated and will be removed in the next major release.${I?` Use "${I}" instead.`:""}`)},Ne=y=>typeof y=="function"?y():y,Ie=y=>y&&typeof y.toPromise=="function",Xt=y=>Ie(y)?y.toPromise():Promise.resolve(y),Qt=y=>y&&Promise.resolve(y)===y,Ae=()=>document.body.querySelector(`.${X.container}`),In=y=>{const I=Ae();return I?I.querySelector(y):null},re=y=>In(`.${y}`),Gt=()=>re(X.popup),me=()=>re(X.icon),Ut=()=>re(X["icon-content"]),Ee=()=>re(X.title),se=()=>re(X["html-container"]),be=()=>re(X.image),at=()=>re(X["progress-steps"]),Ft=()=>re(X["validation-message"]),he=()=>In(`.${X.actions} .${X.confirm}`),jt=()=>In(`.${X.actions} .${X.cancel}`),Zt=()=>In(`.${X.actions} .${X.deny}`),Lt=()=>re(X["input-label"]),Kt=()=>In(`.${X.loader}`),Re=()=>re(X.actions),te=()=>re(X.footer),ce=()=>re(X["timer-progress-bar"]),ie=()=>re(X.close),vn=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,Ue=()=>{const y=Gt();if(!y)return[];const I=y.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),j=Array.from(I).sort((oe,ze)=>{const Sn=parseInt(oe.getAttribute("tabindex")||"0"),ri=parseInt(ze.getAttribute("tabindex")||"0");return Sn>ri?1:Sn<ri?-1:0}),Q=y.querySelectorAll(vn),Tt=Array.from(Q).filter(oe=>oe.getAttribute("tabindex")!=="-1");return[...new Set(j.concat(Tt))].filter(oe=>vr(oe))},pr=()=>ps(document.body,X.shown)&&!ps(document.body,X["toast-shown"])&&!ps(document.body,X["no-backdrop"]),Di=()=>{const y=Gt();return y?ps(y,X.toast):!1},hs=()=>{const y=Gt();return y?y.hasAttribute("data-loading"):!1},Li=(y,I)=>{if(y.textContent="",I){const Q=new DOMParser().parseFromString(I,"text/html"),Tt=Q.querySelector("head");Tt&&Array.from(Tt.childNodes).forEach(ze=>{y.appendChild(ze)});const oe=Q.querySelector("body");oe&&Array.from(oe.childNodes).forEach(ze=>{ze instanceof HTMLVideoElement||ze instanceof HTMLAudioElement?y.appendChild(ze.cloneNode(!0)):y.appendChild(ze)})}},ps=(y,I)=>{if(!I)return!1;const j=I.split(/\s+/);for(let Q=0;Q<j.length;Q++)if(!y.classList.contains(j[Q]))return!1;return!0},rr=(y,I)=>{Array.from(y.classList).forEach(j=>{!Object.values(X).includes(j)&&!Object.values(Ct).includes(j)&&!Object.values(I.showClass||{}).includes(j)&&y.classList.remove(j)})},fr=(y,I,j)=>{if(rr(y,I),!I.customClass)return;const Q=I.customClass[j];if(Q){if(typeof Q!="string"&&!Q.forEach){Wt(`Invalid type of customClass.${j}! Expected string or iterable object, got "${typeof Q}"`);return}pn(y,Q)}},wc=(y,I)=>{if(!I)return null;switch(I){case"select":case"textarea":case"file":return y.querySelector(`.${X.popup} > .${X[I]}`);case"checkbox":return y.querySelector(`.${X.popup} > .${X.checkbox} input`);case"radio":return y.querySelector(`.${X.popup} > .${X.radio} input:checked`)||y.querySelector(`.${X.popup} > .${X.radio} input:first-child`);case"range":return y.querySelector(`.${X.popup} > .${X.range} input`);default:return y.querySelector(`.${X.popup} > .${X.input}`)}},sr=y=>{if(y.focus(),y.type!=="file"){const I=y.value;y.value="",y.value=I}},Ur=(y,I,j)=>{!y||!I||(typeof I=="string"&&(I=I.split(/\s+/).filter(Boolean)),I.forEach(Q=>{Array.isArray(y)?y.forEach(Tt=>{j?Tt.classList.add(Q):Tt.classList.remove(Q)}):j?y.classList.add(Q):y.classList.remove(Q)}))},pn=(y,I)=>{Ur(y,I,!0)},mi=(y,I)=>{Ur(y,I,!1)},Ha=(y,I)=>{const j=Array.from(y.children);for(let Q=0;Q<j.length;Q++){const Tt=j[Q];if(Tt instanceof HTMLElement&&ps(Tt,I))return Tt}},_a=(y,I,j)=>{j===`${parseInt(j)}`&&(j=parseInt(j)),j||parseInt(j)===0?y.style.setProperty(I,typeof j=="number"?`${j}px`:j):y.style.removeProperty(I)},bn=function(y){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"flex";y&&(y.style.display=I)},Qn=y=>{y&&(y.style.display="none")},Md=function(y){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"block";y&&new MutationObserver(()=>{Ic(y,y.innerHTML,I)}).observe(y,{childList:!0,subtree:!0})},Pl=(y,I,j,Q)=>{const Tt=y.querySelector(I);Tt&&Tt.style.setProperty(j,Q)},Ic=function(y,I){let j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"flex";I?bn(y,j):Qn(y)},vr=y=>!!(y&&(y.offsetWidth||y.offsetHeight||y.getClientRects().length)),Oc=()=>!vr(he())&&!vr(Zt())&&!vr(jt()),br=y=>y.scrollHeight>y.clientHeight,Wa=y=>{const I=window.getComputedStyle(y),j=parseFloat(I.getPropertyValue("animation-duration")||"0"),Q=parseFloat(I.getPropertyValue("transition-duration")||"0");return j>0||Q>0},Os=function(y){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const j=ce();j&&vr(j)&&(I&&(j.style.transition="none",j.style.width="100%"),setTimeout(()=>{j.style.transition=`width ${y/1e3}s linear`,j.style.width="0%"},10))},$r=()=>{const y=ce();if(!y)return;const I=parseInt(window.getComputedStyle(y).width);y.style.removeProperty("transition"),y.style.width="100%";const j=parseInt(window.getComputedStyle(y).width),Q=I/j*100;y.style.width=`${Q}%`},v_=()=>typeof window>"u"||typeof document>"u",Nc=`
 <div aria-labelledby="${X.title}" aria-describedby="${X["html-container"]}" class="${X.popup}" tabindex="-1">
   <button type="button" class="${X.close}"></button>
   <ul class="${X["progress-steps"]}"></ul>
   <div class="${X.icon}"></div>
   <img class="${X.image}" />
   <h2 class="${X.title}" id="${X.title}"></h2>
   <div class="${X["html-container"]}" id="${X["html-container"]}"></div>
   <input class="${X.input}" id="${X.input}" />
   <input type="file" class="${X.file}" />
   <div class="${X.range}">
     <input type="range" />
     <output></output>
   </div>
   <select class="${X.select}" id="${X.select}"></select>
   <div class="${X.radio}"></div>
   <label class="${X.checkbox}">
     <input type="checkbox" id="${X.checkbox}" />
     <span class="${X.label}"></span>
   </label>
   <textarea class="${X.textarea}" id="${X.textarea}"></textarea>
   <div class="${X["validation-message"]}" id="${X["validation-message"]}"></div>
   <div class="${X.actions}">
     <div class="${X.loader}"></div>
     <button type="button" class="${X.confirm}"></button>
     <button type="button" class="${X.deny}"></button>
     <button type="button" class="${X.cancel}"></button>
   </div>
   <div class="${X.footer}"></div>
   <div class="${X["timer-progress-bar-container"]}">
     <div class="${X["timer-progress-bar"]}"></div>
   </div>
 </div>
`.replace(/(^|\n)\s*/g,""),Lf=()=>{const y=Ae();return y?(y.remove(),mi([document.documentElement,document.body],[X["no-backdrop"],X["toast-shown"],X["has-column"]]),!0):!1},Ys=()=>{G.currentInstance.resetValidationMessage()},Ud=()=>{const y=Gt(),I=Ha(y,X.input),j=Ha(y,X.file),Q=y.querySelector(`.${X.range} input`),Tt=y.querySelector(`.${X.range} output`),oe=Ha(y,X.select),ze=y.querySelector(`.${X.checkbox} input`),Sn=Ha(y,X.textarea);I.oninput=Ys,j.onchange=Ys,oe.onchange=Ys,ze.onchange=Ys,Sn.oninput=Ys,Q.oninput=()=>{Ys(),Tt.value=Q.value},Q.onchange=()=>{Ys(),Tt.value=Q.value}},Lo=y=>typeof y=="string"?document.querySelector(y):y,jd=y=>{const I=Gt();I.setAttribute("role",y.toast?"alert":"dialog"),I.setAttribute("aria-live",y.toast?"polite":"assertive"),y.toast||I.setAttribute("aria-modal","true")},ga=y=>{window.getComputedStyle(y).direction==="rtl"&&pn(Ae(),X.rtl)},b_=y=>{const I=Lf();if(v_()){Rt("SweetAlert2 requires document to initialize");return}const j=document.createElement("div");j.className=X.container,I&&pn(j,X["no-transition"]),Li(j,Nc),j.dataset.swal2Theme=y.theme;const Q=Lo(y.target);Q.appendChild(j),jd(y),ga(Q),Ud()},Sa=(y,I)=>{y instanceof HTMLElement?I.appendChild(y):typeof y=="object"?Pf(y,I):y&&Li(I,y)},Pf=(y,I)=>{y.jquery?fh(I,y):Li(I,y.toString())},fh=(y,I)=>{if(y.textContent="",0 in I)for(let j=0;j in I;j++)y.appendChild(I[j].cloneNode(!0));else y.appendChild(I.cloneNode(!0))},kl=(y,I)=>{const j=Re(),Q=Kt();!j||!Q||(!I.showConfirmButton&&!I.showDenyButton&&!I.showCancelButton?Qn(j):bn(j),fr(j,I,"actions"),ts(j,Q,I),Li(Q,I.loaderHtml||""),fr(Q,I,"loader"))};function ts(y,I,j){const Q=he(),Tt=Zt(),oe=jt();!Q||!Tt||!oe||(Vd(Q,"confirm",j),Vd(Tt,"deny",j),Vd(oe,"cancel",j),kf(Q,Tt,oe,j),j.reverseButtons&&(j.toast?(y.insertBefore(oe,Q),y.insertBefore(Tt,Q)):(y.insertBefore(oe,I),y.insertBefore(Tt,I),y.insertBefore(Q,I))))}function kf(y,I,j,Q){if(!Q.buttonsStyling){mi([y,I,j],X.styled);return}pn([y,I,j],X.styled),Q.confirmButtonColor&&(y.style.backgroundColor=Q.confirmButtonColor,pn(y,X["default-outline"])),Q.denyButtonColor&&(I.style.backgroundColor=Q.denyButtonColor,pn(I,X["default-outline"])),Q.cancelButtonColor&&(j.style.backgroundColor=Q.cancelButtonColor,pn(j,X["default-outline"]))}function Vd(y,I,j){const Q=It(I);Ic(y,j[`show${Q}Button`],"inline-block"),Li(y,j[`${I}ButtonText`]||""),y.setAttribute("aria-label",j[`${I}ButtonAriaLabel`]||""),y.className=X[I],fr(y,j,`${I}Button`)}const xl=(y,I)=>{const j=ie();j&&(Li(j,I.closeButtonHtml||""),fr(j,I,"closeButton"),Ic(j,I.showCloseButton),j.setAttribute("aria-label",I.closeButtonAriaLabel||""))},mh=(y,I)=>{const j=Ae();j&&(xf(j,I.backdrop),ya(j,I.position),mr(j,I.grow),fr(j,I,"container"))};function xf(y,I){typeof I=="string"?y.style.background=I:I||pn([document.documentElement,document.body],X["no-backdrop"])}function ya(y,I){I&&(I in X?pn(y,X[I]):(Wt('The "position" parameter is not valid, defaulting to "center"'),pn(y,X.center)))}function mr(y,I){I&&pn(y,X[`grow-${I}`])}var en={innerParams:new WeakMap,domCache:new WeakMap};const Po=["input","file","range","select","radio","checkbox","textarea"],Eh=(y,I)=>{const j=Gt();if(!j)return;const Q=en.innerParams.get(y),Tt=!Q||I.input!==Q.input;Po.forEach(oe=>{const ze=Ha(j,X[oe]);ze&&(Bd(oe,I.inputAttributes),ze.className=X[oe],Tt&&Qn(ze))}),I.input&&(Tt&&R_(I),Dc(I))},R_=y=>{if(!y.input)return;if(!Zn[y.input]){Rt(`Unexpected type of input! Expected ${Object.keys(Zn).join(" | ")}, got "${y.input}"`);return}const I=ko(y.input);if(!I)return;const j=Zn[y.input](I,y);bn(I),y.inputAutoFocus&&setTimeout(()=>{sr(j)})},Mf=y=>{for(let I=0;I<y.attributes.length;I++){const j=y.attributes[I].name;["id","type","value","style"].includes(j)||y.removeAttribute(j)}},Bd=(y,I)=>{const j=Gt();if(!j)return;const Q=wc(j,y);if(Q){Mf(Q);for(const Tt in I)Q.setAttribute(Tt,I[Tt])}},Dc=y=>{if(!y.input)return;const I=ko(y.input);I&&fr(I,y,"input")},qs=(y,I)=>{!y.placeholder&&I.inputPlaceholder&&(y.placeholder=I.inputPlaceholder)},Ns=(y,I,j)=>{if(j.inputLabel){const Q=document.createElement("label"),Tt=X["input-label"];Q.setAttribute("for",y.id),Q.className=Tt,typeof j.customClass=="object"&&pn(Q,j.customClass.inputLabel),Q.innerText=j.inputLabel,I.insertAdjacentElement("beforebegin",Q)}},ko=y=>{const I=Gt();if(I)return Ha(I,X[y]||X.input)},ar=(y,I)=>{["string","number"].includes(typeof I)?y.value=`${I}`:Qt(I)||Wt(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof I}"`)},Zn={};Zn.text=Zn.email=Zn.password=Zn.number=Zn.tel=Zn.url=Zn.search=Zn.date=Zn["datetime-local"]=Zn.time=Zn.week=Zn.month=(y,I)=>(ar(y,I.inputValue),Ns(y,y,I),qs(y,I),y.type=I.input,y),Zn.file=(y,I)=>(Ns(y,y,I),qs(y,I),y),Zn.range=(y,I)=>{const j=y.querySelector("input"),Q=y.querySelector("output");return ar(j,I.inputValue),j.type=I.input,ar(Q,I.inputValue),Ns(j,y,I),y},Zn.select=(y,I)=>{if(y.textContent="",I.inputPlaceholder){const j=document.createElement("option");Li(j,I.inputPlaceholder),j.value="",j.disabled=!0,j.selected=!0,y.appendChild(j)}return Ns(y,y,I),y},Zn.radio=y=>(y.textContent="",y),Zn.checkbox=(y,I)=>{const j=wc(Gt(),"checkbox");j.value="1",j.checked=!!I.inputValue;const Q=y.querySelector("span");return Li(Q,I.inputPlaceholder||I.inputLabel),j},Zn.textarea=(y,I)=>{ar(y,I.inputValue),qs(y,I),Ns(y,y,I);const j=Q=>parseInt(window.getComputedStyle(Q).marginLeft)+parseInt(window.getComputedStyle(Q).marginRight);return setTimeout(()=>{if("MutationObserver"in window){const Q=parseInt(window.getComputedStyle(Gt()).width),Tt=()=>{if(!document.body.contains(y))return;const oe=y.offsetWidth+j(y);oe>Q?Gt().style.width=`${oe}px`:_a(Gt(),"width",I.width)};new MutationObserver(Tt).observe(y,{attributes:!0,attributeFilter:["style"]})}}),y};const Yi=(y,I)=>{const j=se();j&&(Md(j),fr(j,I,"htmlContainer"),I.html?(Sa(I.html,j),bn(j,"block")):I.text?(j.textContent=I.text,bn(j,"block")):Qn(j),Eh(y,I))},yi=(y,I)=>{const j=te();j&&(Md(j),Ic(j,I.footer,"block"),I.footer&&Sa(I.footer,j),fr(j,I,"footer"))},Uf=(y,I)=>{const j=en.innerParams.get(y),Q=me();if(!Q)return;if(j&&I.icon===j.icon){gh(Q,I),Ka(Q,I);return}if(!I.icon&&!I.iconHtml){Qn(Q);return}if(I.icon&&Object.keys(Ct).indexOf(I.icon)===-1){Rt(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${I.icon}"`),Qn(Q);return}bn(Q),gh(Q,I),Ka(Q,I),pn(Q,I.showClass&&I.showClass.icon),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",xo)},Ka=(y,I)=>{for(const[j,Q]of Object.entries(Ct))I.icon!==j&&mi(y,Q);pn(y,I.icon&&Ct[I.icon]),Sh(y,I),xo(),fr(y,I,"icon")},xo=()=>{const y=Gt();if(!y)return;const I=window.getComputedStyle(y).getPropertyValue("background-color"),j=y.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let Q=0;Q<j.length;Q++)j[Q].style.backgroundColor=I},Ta=`
  <div class="swal2-success-circular-line-left"></div>
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>
  <div class="swal2-success-circular-line-right"></div>
`,_h=`
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`,gh=(y,I)=>{if(!I.icon&&!I.iconHtml)return;let j=y.innerHTML,Q="";I.iconHtml?Q=jf(I.iconHtml):I.icon==="success"?(Q=Ta,j=j.replace(/ style=".*?"/g,"")):I.icon==="error"?Q=_h:I.icon&&(Q=jf({question:"?",warning:"!",info:"i"}[I.icon])),j.trim()!==Q.trim()&&Li(y,Q)},Sh=(y,I)=>{if(I.iconColor){y.style.color=I.iconColor,y.style.borderColor=I.iconColor;for(const j of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])Pl(y,j,"background-color",I.iconColor);Pl(y,".swal2-success-ring","border-color",I.iconColor)}},jf=y=>`<div class="${X["icon-content"]}">${y}</div>`,Fd=(y,I)=>{const j=be();if(j){if(!I.imageUrl){Qn(j);return}bn(j,""),j.setAttribute("src",I.imageUrl),j.setAttribute("alt",I.imageAlt||""),_a(j,"width",I.imageWidth),_a(j,"height",I.imageHeight),j.className=X.image,fr(j,I,"image")}};let Lc=!1,Rr=0,Cr=0,yh=0,kn=0;const Gd=y=>{y.addEventListener("mousedown",za),document.body.addEventListener("mousemove",Hd),y.addEventListener("mouseup",Ar),y.addEventListener("touchstart",za),document.body.addEventListener("touchmove",Hd),y.addEventListener("touchend",Ar)},Th=y=>{y.removeEventListener("mousedown",za),document.body.removeEventListener("mousemove",Hd),y.removeEventListener("mouseup",Ar),y.removeEventListener("touchstart",za),document.body.removeEventListener("touchmove",Hd),y.removeEventListener("touchend",Ar)},za=y=>{const I=Gt();if(y.target===I||me().contains(y.target)){Lc=!0;const j=Wd(y);Rr=j.clientX,Cr=j.clientY,yh=parseInt(I.style.insetInlineStart)||0,kn=parseInt(I.style.insetBlockStart)||0,pn(I,"swal2-dragging")}},Hd=y=>{const I=Gt();if(Lc){let{clientX:j,clientY:Q}=Wd(y);I.style.insetInlineStart=`${yh+(j-Rr)}px`,I.style.insetBlockStart=`${kn+(Q-Cr)}px`}},Ar=()=>{const y=Gt();Lc=!1,mi(y,"swal2-dragging")},Wd=y=>{let I=0,j=0;return y.type.startsWith("mouse")?(I=y.clientX,j=y.clientY):y.type.startsWith("touch")&&(I=y.touches[0].clientX,j=y.touches[0].clientY),{clientX:I,clientY:j}},Vf=(y,I)=>{const j=Ae(),Q=Gt();if(!(!j||!Q)){if(I.toast){_a(j,"width",I.width),Q.style.width="100%";const Tt=Kt();Tt&&Q.insertBefore(Tt,me())}else _a(Q,"width",I.width);_a(Q,"padding",I.padding),I.color&&(Q.style.color=I.color),I.background&&(Q.style.background=I.background),Qn(Ft()),vh(Q,I),I.draggable&&!I.toast?(pn(Q,X.draggable),Gd(Q)):(mi(Q,X.draggable),Th(Q))}},vh=(y,I)=>{const j=I.showClass||{};y.className=`${X.popup} ${vr(y)?j.popup:""}`,I.toast?(pn([document.documentElement,document.body],X["toast-shown"]),pn(y,X.toast)):pn(y,X.modal),fr(y,I,"popup"),typeof I.customClass=="string"&&pn(y,I.customClass),I.icon&&pn(y,X[`icon-${I.icon}`])},Pc=(y,I)=>{const j=at();if(!j)return;const{progressSteps:Q,currentProgressStep:Tt}=I;if(!Q||Q.length===0||Tt===void 0){Qn(j);return}bn(j),j.textContent="",Tt>=Q.length&&Wt("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),Q.forEach((oe,ze)=>{const Sn=Ml(oe);if(j.appendChild(Sn),ze===Tt&&pn(Sn,X["active-progress-step"]),ze!==Q.length-1){const ri=bh(I);j.appendChild(ri)}})},Ml=y=>{const I=document.createElement("li");return pn(I,X["progress-step"]),Li(I,y),I},bh=y=>{const I=document.createElement("li");return pn(I,X["progress-step-line"]),y.progressStepsDistance&&_a(I,"width",y.progressStepsDistance),I},Ya=(y,I)=>{const j=Ee();j&&(Md(j),Ic(j,I.title||I.titleText,"block"),I.title&&Sa(I.title,j),I.titleText&&(j.innerText=I.titleText),fr(j,I,"title"))},Bf=(y,I)=>{Vf(y,I),mh(y,I),Pc(y,I),Uf(y,I),Fd(y,I),Ya(y,I),xl(y,I),Yi(y,I),kl(y,I),yi(y,I);const j=Gt();typeof I.didRender=="function"&&j&&I.didRender(j),G.eventEmitter.emit("didRender",j)},Kd=()=>vr(Gt()),Rh=()=>{var y;return(y=he())===null||y===void 0?void 0:y.click()},zd=()=>{var y;return(y=Zt())===null||y===void 0?void 0:y.click()},C_=()=>{var y;return(y=jt())===null||y===void 0?void 0:y.click()},kc=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Ul=y=>{y.keydownTarget&&y.keydownHandlerAdded&&(y.keydownTarget.removeEventListener("keydown",y.keydownHandler,{capture:y.keydownListenerCapture}),y.keydownHandlerAdded=!1)},Ch=(y,I,j)=>{Ul(y),I.toast||(y.keydownHandler=Q=>Ff(I,Q,j),y.keydownTarget=I.keydownListenerCapture?window:Gt(),y.keydownListenerCapture=I.keydownListenerCapture,y.keydownTarget.addEventListener("keydown",y.keydownHandler,{capture:y.keydownListenerCapture}),y.keydownHandlerAdded=!0)},jl=(y,I)=>{var j;const Q=Ue();if(Q.length){y=y+I,y===Q.length?y=0:y===-1&&(y=Q.length-1),Q[y].focus();return}(j=Gt())===null||j===void 0||j.focus()},Mo=["ArrowRight","ArrowDown"],xc=["ArrowLeft","ArrowUp"],Ff=(y,I,j)=>{y&&(I.isComposing||I.keyCode===229||(y.stopKeydownPropagation&&I.stopPropagation(),I.key==="Enter"?Yd(I,y):I.key==="Tab"?Gf(I):[...Mo,...xc].includes(I.key)?Vl(I.key):I.key==="Escape"&&Ah(I,y,j)))},Yd=(y,I)=>{if(!Ne(I.allowEnterKey))return;const j=wc(Gt(),I.input);if(y.target&&j&&y.target instanceof HTMLElement&&y.target.outerHTML===j.outerHTML){if(["textarea","file"].includes(I.input))return;Rh(),y.preventDefault()}},Gf=y=>{const I=y.target,j=Ue();let Q=-1;for(let Tt=0;Tt<j.length;Tt++)if(I===j[Tt]){Q=Tt;break}y.shiftKey?jl(Q,-1):jl(Q,1),y.stopPropagation(),y.preventDefault()},Vl=y=>{const I=Re(),j=he(),Q=Zt(),Tt=jt();if(!I||!j||!Q||!Tt)return;const oe=[j,Q,Tt];if(document.activeElement instanceof HTMLElement&&!oe.includes(document.activeElement))return;const ze=Mo.includes(y)?"nextElementSibling":"previousElementSibling";let Sn=document.activeElement;if(Sn){for(let ri=0;ri<I.children.length;ri++){if(Sn=Sn[ze],!Sn)return;if(Sn instanceof HTMLButtonElement&&vr(Sn))break}Sn instanceof HTMLButtonElement&&Sn.focus()}},Ah=(y,I,j)=>{Ne(I.allowEscapeKey)&&(y.preventDefault(),j(kc.esc))};var jr={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const qa=()=>{const y=Ae();Array.from(document.body.children).forEach(j=>{j.contains(y)||(j.hasAttribute("aria-hidden")&&j.setAttribute("data-previous-aria-hidden",j.getAttribute("aria-hidden")||""),j.setAttribute("aria-hidden","true"))})},qd=()=>{Array.from(document.body.children).forEach(I=>{I.hasAttribute("data-previous-aria-hidden")?(I.setAttribute("aria-hidden",I.getAttribute("data-previous-aria-hidden")||""),I.removeAttribute("data-previous-aria-hidden")):I.removeAttribute("aria-hidden")})},Bl=typeof window<"u"&&!!window.GestureEvent,Hf=()=>{if(Bl&&!ps(document.body,X.iosfix)){const y=document.body.scrollTop;document.body.style.top=`${y*-1}px`,pn(document.body,X.iosfix),Fl()}},Fl=()=>{const y=Ae();if(!y)return;let I;y.ontouchstart=j=>{I=Xd(j)},y.ontouchmove=j=>{I&&(j.preventDefault(),j.stopPropagation())}},Xd=y=>{const I=y.target,j=Ae(),Q=se();return!j||!Q||Wf(y)||Vr(y)?!1:I===j||!br(j)&&I instanceof HTMLElement&&I.tagName!=="INPUT"&&I.tagName!=="TEXTAREA"&&!(br(Q)&&Q.contains(I))},Wf=y=>y.touches&&y.touches.length&&y.touches[0].touchType==="stylus",Vr=y=>y.touches&&y.touches.length>1,Br=()=>{if(ps(document.body,X.iosfix)){const y=parseInt(document.body.style.top,10);mi(document.body,X.iosfix),document.body.style.top="",document.body.scrollTop=y*-1}},wr=()=>{const y=document.createElement("div");y.className=X["scrollbar-measure"],document.body.appendChild(y);const I=y.getBoundingClientRect().width-y.clientWidth;return document.body.removeChild(y),I};let Ds=null;const A_=y=>{Ds===null&&(document.body.scrollHeight>window.innerHeight||y==="scroll")&&(Ds=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${Ds+wr()}px`)},wh=()=>{Ds!==null&&(document.body.style.paddingRight=`${Ds}px`,Ds=null)};function Jd(y,I,j,Q){Di()?qf(y,Q):(rt(j).then(()=>qf(y,Q)),Ul(G)),Bl?(I.setAttribute("style","display:none !important"),I.removeAttribute("class"),I.innerHTML=""):I.remove(),pr()&&(wh(),Br(),qd()),Pi()}function Pi(){mi([document.documentElement,document.body],[X.shown,X["height-auto"],X["no-backdrop"],X["toast-shown"]])}function Ls(y){y=Yf(y);const I=jr.swalPromiseResolve.get(this),j=Kf(this);this.isAwaitingPromise?y.isDismissed||(Xa(this),I(y)):j&&I(y)}const Kf=y=>{const I=Gt();if(!I)return!1;const j=en.innerParams.get(y);if(!j||ps(I,j.hideClass.popup))return!1;mi(I,j.showClass.popup),pn(I,j.hideClass.popup);const Q=Ae();return mi(Q,j.showClass.backdrop),pn(Q,j.hideClass.backdrop),Ih(y,I,j),!0};function zf(y){const I=jr.swalPromiseReject.get(this);Xa(this),I&&I(y)}const Xa=y=>{y.isAwaitingPromise&&(delete y.isAwaitingPromise,en.innerParams.get(y)||y._destroy())},Yf=y=>typeof y>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},y),Ih=(y,I,j)=>{var Q;const Tt=Ae(),oe=Wa(I);typeof j.willClose=="function"&&j.willClose(I),(Q=G.eventEmitter)===null||Q===void 0||Q.emit("willClose",I),oe?Oh(y,I,Tt,j.returnFocus,j.didClose):Jd(y,Tt,j.returnFocus,j.didClose)},Oh=(y,I,j,Q,Tt)=>{G.swalCloseEventFinishedCallback=Jd.bind(null,y,j,Q,Tt);const oe=function(ze){if(ze.target===I){var Sn;(Sn=G.swalCloseEventFinishedCallback)===null||Sn===void 0||Sn.call(G),delete G.swalCloseEventFinishedCallback,I.removeEventListener("animationend",oe),I.removeEventListener("transitionend",oe)}};I.addEventListener("animationend",oe),I.addEventListener("transitionend",oe)},qf=(y,I)=>{setTimeout(()=>{var j;typeof I=="function"&&I.bind(y.params)(),(j=G.eventEmitter)===null||j===void 0||j.emit("didClose"),y._destroy&&y._destroy()})},Ja=y=>{let I=Gt();if(I||new Gc,I=Gt(),!I)return;const j=Kt();Di()?Qn(me()):Nh(I,y),bn(j),I.setAttribute("data-loading","true"),I.setAttribute("aria-busy","true"),I.focus()},Nh=(y,I)=>{const j=Re(),Q=Kt();!j||!Q||(!I&&vr(he())&&(I=he()),bn(j),I&&(Qn(I),Q.setAttribute("data-button-to-replace",I.className),j.insertBefore(Q,I)),pn([y,j],X.loading))},Dh=(y,I)=>{I.input==="select"||I.input==="radio"?I_(y,I):["text","email","number","tel","textarea"].some(j=>j===I.input)&&(Ie(I.inputValue)||Qt(I.inputValue))&&(Ja(he()),Lh(y,I))},Xf=(y,I)=>{const j=y.getInput();if(!j)return null;switch(I.input){case"checkbox":return w_(j);case"radio":return Qa(j);case"file":return Qd(j);default:return I.inputAutoTrim?j.value.trim():j.value}},w_=y=>y.checked?1:0,Qa=y=>y.checked?y.value:null,Qd=y=>y.files&&y.files.length?y.getAttribute("multiple")!==null?y.files:y.files[0]:null,I_=(y,I)=>{const j=Gt();if(!j)return;const Q=Tt=>{I.input==="select"?O_(j,Zd(Tt),I):I.input==="radio"&&N_(j,Zd(Tt),I)};Ie(I.inputOptions)||Qt(I.inputOptions)?(Ja(he()),Xt(I.inputOptions).then(Tt=>{y.hideLoading(),Q(Tt)})):typeof I.inputOptions=="object"?Q(I.inputOptions):Rt(`Unexpected type of inputOptions! Expected object, Map or Promise, got ${typeof I.inputOptions}`)},Lh=(y,I)=>{const j=y.getInput();j&&(Qn(j),Xt(I.inputValue).then(Q=>{j.value=I.input==="number"?`${parseFloat(Q)||0}`:`${Q}`,bn(j),j.focus(),y.hideLoading()}).catch(Q=>{Rt(`Error in inputValue promise: ${Q}`),j.value="",bn(j),j.focus(),y.hideLoading()}))};function O_(y,I,j){const Q=Ha(y,X.select);if(!Q)return;const Tt=(oe,ze,Sn)=>{const ri=document.createElement("option");ri.value=Sn,Li(ri,ze),ri.selected=Za(Sn,j.inputValue),oe.appendChild(ri)};I.forEach(oe=>{const ze=oe[0],Sn=oe[1];if(Array.isArray(Sn)){const ri=document.createElement("optgroup");ri.label=ze,ri.disabled=!1,Q.appendChild(ri),Sn.forEach(Go=>Tt(ri,Go[1],Go[0]))}else Tt(Q,Sn,ze)}),Q.focus()}function N_(y,I,j){const Q=Ha(y,X.radio);if(!Q)return;I.forEach(oe=>{const ze=oe[0],Sn=oe[1],ri=document.createElement("input"),Go=document.createElement("label");ri.type="radio",ri.name=X.radio,ri.value=ze,Za(ze,j.inputValue)&&(ri.checked=!0);const Hc=document.createElement("span");Li(Hc,Sn),Hc.className=X.label,Go.appendChild(ri),Go.appendChild(Hc),Q.appendChild(Go)});const Tt=Q.querySelectorAll("input");Tt.length&&Tt[0].focus()}const Zd=y=>{const I=[];return y instanceof Map?y.forEach((j,Q)=>{let Tt=j;typeof Tt=="object"&&(Tt=Zd(Tt)),I.push([Q,Tt])}):Object.keys(y).forEach(j=>{let Q=y[j];typeof Q=="object"&&(Q=Zd(Q)),I.push([j,Q])}),I},Za=(y,I)=>!!I&&I.toString()===y.toString(),D_=y=>{const I=en.innerParams.get(y);y.disableButtons(),I.input?Qf(y,"confirm"):kh(y,!0)},Mc=y=>{const I=en.innerParams.get(y);y.disableButtons(),I.returnInputValueOnDeny?Qf(y,"deny"):Ph(y,!1)},Jf=(y,I)=>{y.disableButtons(),I(kc.cancel)},Qf=(y,I)=>{const j=en.innerParams.get(y);if(!j.input){Rt(`The "input" parameter is needed to be set when using returnInputValueOn${It(I)}`);return}const Q=y.getInput(),Tt=Xf(y,j);j.inputValidator?Qe(y,Tt,I):Q&&!Q.checkValidity()?(y.enableButtons(),y.showValidationMessage(j.validationMessage||Q.validationMessage)):I==="deny"?Ph(y,Tt):kh(y,Tt)},Qe=(y,I,j)=>{const Q=en.innerParams.get(y);y.disableInput(),Promise.resolve().then(()=>Xt(Q.inputValidator(I,Q.validationMessage))).then(oe=>{y.enableButtons(),y.enableInput(),oe?y.showValidationMessage(oe):j==="deny"?Ph(y,I):kh(y,I)})},Ph=(y,I)=>{const j=en.innerParams.get(y||void 0);j.showLoaderOnDeny&&Ja(Zt()),j.preDeny?(y.isAwaitingPromise=!0,Promise.resolve().then(()=>Xt(j.preDeny(I,j.validationMessage))).then(Tt=>{Tt===!1?(y.hideLoading(),Xa(y)):y.close({isDenied:!0,value:typeof Tt>"u"?I:Tt})}).catch(Tt=>$f(y||void 0,Tt))):y.close({isDenied:!0,value:I})},Zf=(y,I)=>{y.close({isConfirmed:!0,value:I})},$f=(y,I)=>{y.rejectPromise(I)},kh=(y,I)=>{const j=en.innerParams.get(y||void 0);j.showLoaderOnConfirm&&Ja(),j.preConfirm?(y.resetValidationMessage(),y.isAwaitingPromise=!0,Promise.resolve().then(()=>Xt(j.preConfirm(I,j.validationMessage))).then(Tt=>{vr(Ft())||Tt===!1?(y.hideLoading(),Xa(y)):Zf(y,typeof Tt>"u"?I:Tt)}).catch(Tt=>$f(y||void 0,Tt))):Zf(y,I)};function $a(){const y=en.innerParams.get(this);if(!y)return;const I=en.domCache.get(this);Qn(I.loader),Di()?y.icon&&bn(me()):Gl(I),mi([I.popup,I.actions],X.loading),I.popup.removeAttribute("aria-busy"),I.popup.removeAttribute("data-loading"),I.confirmButton.disabled=!1,I.denyButton.disabled=!1,I.cancelButton.disabled=!1}const Gl=y=>{const I=y.popup.getElementsByClassName(y.loader.getAttribute("data-button-to-replace"));I.length?bn(I[0],"inline-block"):Oc()&&Qn(y.actions)};function tm(){const y=en.innerParams.get(this),I=en.domCache.get(this);return I?wc(I.popup,y.input):null}function xh(y,I,j){const Q=en.domCache.get(y);I.forEach(Tt=>{Q[Tt].disabled=j})}function Hl(y,I){const j=Gt();if(!(!j||!y))if(y.type==="radio"){const Q=j.querySelectorAll(`[name="${X.radio}"]`);for(let Tt=0;Tt<Q.length;Tt++)Q[Tt].disabled=I}else y.disabled=I}function Mh(){xh(this,["confirmButton","denyButton","cancelButton"],!1)}function Uh(){xh(this,["confirmButton","denyButton","cancelButton"],!0)}function $d(){Hl(this.getInput(),!1)}function Uo(){Hl(this.getInput(),!0)}function Xs(y){const I=en.domCache.get(this),j=en.innerParams.get(this);Li(I.validationMessage,y),I.validationMessage.className=X["validation-message"],j.customClass&&j.customClass.validationMessage&&pn(I.validationMessage,j.customClass.validationMessage),bn(I.validationMessage);const Q=this.getInput();Q&&(Q.setAttribute("aria-invalid","true"),Q.setAttribute("aria-describedby",X["validation-message"]),sr(Q),pn(Q,X.inputerror))}function em(){const y=en.domCache.get(this);y.validationMessage&&Qn(y.validationMessage);const I=this.getInput();I&&(I.removeAttribute("aria-invalid"),I.removeAttribute("aria-describedby"),mi(I,X.inputerror))}const Uc={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},nm=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],jh={allowEnterKey:void 0},jo=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],jc=y=>Object.prototype.hasOwnProperty.call(Uc,y),im=y=>nm.indexOf(y)!==-1,Er=y=>jh[y],rm=y=>{jc(y)||Wt(`Unknown parameter "${y}"`)},sm=y=>{jo.includes(y)&&Wt(`The parameter "${y}" is incompatible with toasts`)},Vh=y=>{const I=Er(y);I&&_e(y,I)},tu=y=>{y.backdrop===!1&&y.allowOutsideClick&&Wt('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),y.theme&&!["light","dark","auto","borderless"].includes(y.theme)&&Wt(`Invalid theme "${y.theme}". Expected "light", "dark", "auto", or "borderless"`);for(const I in y)rm(I),y.toast&&sm(I),Vh(I)};function eu(y){const I=Ae(),j=Gt(),Q=en.innerParams.get(this);if(!j||ps(j,Q.hideClass.popup)){Wt("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");return}const Tt=am(y),oe=Object.assign({},Q,Tt);tu(oe),I.dataset.swal2Theme=oe.theme,Bf(this,oe),en.innerParams.set(this,oe),Object.defineProperties(this,{params:{value:Object.assign({},this.params,y),writable:!1,enumerable:!0}})}const am=y=>{const I={};return Object.keys(y).forEach(j=>{im(j)?I[j]=y[j]:Wt(`Invalid parameter to update: ${j}`)}),I};function Bh(){const y=en.domCache.get(this),I=en.innerParams.get(this);if(!I){nu(this);return}y.popup&&G.swalCloseEventFinishedCallback&&(G.swalCloseEventFinishedCallback(),delete G.swalCloseEventFinishedCallback),typeof I.didDestroy=="function"&&I.didDestroy(),G.eventEmitter.emit("didDestroy"),om(this)}const om=y=>{nu(y),delete y.params,delete G.keydownHandler,delete G.keydownTarget,delete G.currentInstance},nu=y=>{y.isAwaitingPromise?(Fh(en,y),y.isAwaitingPromise=!0):(Fh(jr,y),Fh(en,y),delete y.isAwaitingPromise,delete y.disableButtons,delete y.enableButtons,delete y.getInput,delete y.disableInput,delete y.enableInput,delete y.hideLoading,delete y.disableLoading,delete y.showValidationMessage,delete y.resetValidationMessage,delete y.close,delete y.closePopup,delete y.closeModal,delete y.closeToast,delete y.rejectPromise,delete y.update,delete y._destroy)},Fh=(y,I)=>{for(const j in y)y[j].delete(I)};var L_=Object.freeze({__proto__:null,_destroy:Bh,close:Ls,closeModal:Ls,closePopup:Ls,closeToast:Ls,disableButtons:Uh,disableInput:Uo,disableLoading:$a,enableButtons:Mh,enableInput:$d,getInput:tm,handleAwaitingPromise:Xa,hideLoading:$a,rejectPromise:zf,resetValidationMessage:em,showValidationMessage:Xs,update:eu});const iu=(y,I,j)=>{y.toast?es(y,I,j):(Ps(I),cm(I),lm(y,I,j))},es=(y,I,j)=>{I.popup.onclick=()=>{y&&(Wl(y)||y.timer||y.input)||j(kc.close)}},Wl=y=>!!(y.showConfirmButton||y.showDenyButton||y.showCancelButton||y.showCloseButton);let Kl=!1;const Ps=y=>{y.popup.onmousedown=()=>{y.container.onmouseup=function(I){y.container.onmouseup=()=>{},I.target===y.container&&(Kl=!0)}}},cm=y=>{y.container.onmousedown=I=>{I.target===y.container&&I.preventDefault(),y.popup.onmouseup=function(j){y.popup.onmouseup=()=>{},(j.target===y.popup||j.target instanceof HTMLElement&&y.popup.contains(j.target))&&(Kl=!0)}}},lm=(y,I,j)=>{I.container.onclick=Q=>{if(Kl){Kl=!1;return}Q.target===I.container&&Ne(y.allowOutsideClick)&&j(kc.backdrop)}},Ir=y=>typeof y=="object"&&y.jquery,dm=y=>y instanceof Element||Ir(y),P_=y=>{const I={};return typeof y[0]=="object"&&!dm(y[0])?Object.assign(I,y[0]):["title","html","icon"].forEach((j,Q)=>{const Tt=y[Q];typeof Tt=="string"||dm(Tt)?I[j]=Tt:Tt!==void 0&&Rt(`Unexpected type of ${j}! Expected "string" or "Element", got ${typeof Tt}`)}),I};function Vc(){for(var y=arguments.length,I=new Array(y),j=0;j<y;j++)I[j]=arguments[j];return new this(...I)}function Gh(y){class I extends this{_main(Q,Tt){return super._main(Q,Object.assign({},y,Tt))}}return I}const Bc=()=>G.timeout&&G.timeout.getTimerLeft(),ru=()=>{if(G.timeout)return $r(),G.timeout.stop()},Hh=()=>{if(G.timeout){const y=G.timeout.start();return Os(y),y}},Vo=()=>{const y=G.timeout;return y&&(y.running?ru():Hh())},Bo=y=>{if(G.timeout){const I=G.timeout.increase(y);return Os(I,!0),I}},Wh=()=>!!(G.timeout&&G.timeout.isRunning());let Kh=!1;const ks={};function su(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"data-swal-template";ks[y]=this,Kh||(document.body.addEventListener("click",um),Kh=!0)}const um=y=>{for(let I=y.target;I&&I!==document;I=I.parentNode)for(const j in ks){const Q=I.getAttribute(j);if(Q){ks[j].fire({template:Q});return}}};class At{constructor(){this.events={}}_getHandlersByEventName(I){return typeof this.events[I]>"u"&&(this.events[I]=[]),this.events[I]}on(I,j){const Q=this._getHandlersByEventName(I);Q.includes(j)||Q.push(j)}once(I,j){var Q=this;const Tt=function(){Q.removeListener(I,Tt);for(var oe=arguments.length,ze=new Array(oe),Sn=0;Sn<oe;Sn++)ze[Sn]=arguments[Sn];j.apply(Q,ze)};this.on(I,Tt)}emit(I){for(var j=arguments.length,Q=new Array(j>1?j-1:0),Tt=1;Tt<j;Tt++)Q[Tt-1]=arguments[Tt];this._getHandlersByEventName(I).forEach(oe=>{try{oe.apply(this,Q)}catch(ze){console.error(ze)}})}removeListener(I,j){const Q=this._getHandlersByEventName(I),Tt=Q.indexOf(j);Tt>-1&&Q.splice(Tt,1)}removeAllListeners(I){this.events[I]!==void 0&&(this.events[I].length=0)}reset(){this.events={}}}G.eventEmitter=new At;var hm=Object.freeze({__proto__:null,argsToParams:P_,bindClickHandler:su,clickCancel:C_,clickConfirm:Rh,clickDeny:zd,enableLoading:Ja,fire:Vc,getActions:Re,getCancelButton:jt,getCloseButton:ie,getConfirmButton:he,getContainer:Ae,getDenyButton:Zt,getFocusableElements:Ue,getFooter:te,getHtmlContainer:se,getIcon:me,getIconContent:Ut,getImage:be,getInputLabel:Lt,getLoader:Kt,getPopup:Gt,getProgressSteps:at,getTimerLeft:Bc,getTimerProgressBar:ce,getTitle:Ee,getValidationMessage:Ft,increaseTimer:Bo,isDeprecatedParameter:Er,isLoading:hs,isTimerRunning:Wh,isUpdatableParameter:im,isValidParameter:jc,isVisible:Kd,mixin:Gh,off:(y,I)=>{if(!y){G.eventEmitter.reset();return}I?G.eventEmitter.removeListener(y,I):G.eventEmitter.removeAllListeners(y)},on:(y,I)=>{G.eventEmitter.on(y,I)},once:(y,I)=>{G.eventEmitter.once(y,I)},resumeTimer:Hh,showLoading:Ja,stopTimer:ru,toggleTimer:Vo});class pm{constructor(I,j){this.callback=I,this.remaining=j,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}increase(I){const j=this.running;return j&&this.stop(),this.remaining+=I,j&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const zh=["swal-title","swal-html","swal-footer"],xs=y=>{const I=typeof y.template=="string"?document.querySelector(y.template):y.template;if(!I)return{};const j=I.content;return cu(j),Object.assign(fs(j),va(j),to(j),au(j),ou(j),Yh(j),eo(j,zh))},fs=y=>{const I={};return Array.from(y.querySelectorAll("swal-param")).forEach(Q=>{Js(Q,["name","value"]);const Tt=Q.getAttribute("name"),oe=Q.getAttribute("value");!Tt||!oe||(typeof Uc[Tt]=="boolean"?I[Tt]=oe!=="false":typeof Uc[Tt]=="object"?I[Tt]=JSON.parse(oe):I[Tt]=oe)}),I},va=y=>{const I={};return Array.from(y.querySelectorAll("swal-function-param")).forEach(Q=>{const Tt=Q.getAttribute("name"),oe=Q.getAttribute("value");!Tt||!oe||(I[Tt]=new Function(`return ${oe}`)())}),I},to=y=>{const I={};return Array.from(y.querySelectorAll("swal-button")).forEach(Q=>{Js(Q,["type","color","aria-label"]);const Tt=Q.getAttribute("type");!Tt||!["confirm","cancel","deny"].includes(Tt)||(I[`${Tt}ButtonText`]=Q.innerHTML,I[`show${It(Tt)}Button`]=!0,Q.hasAttribute("color")&&(I[`${Tt}ButtonColor`]=Q.getAttribute("color")),Q.hasAttribute("aria-label")&&(I[`${Tt}ButtonAriaLabel`]=Q.getAttribute("aria-label")))}),I},au=y=>{const I={},j=y.querySelector("swal-image");return j&&(Js(j,["src","width","height","alt"]),j.hasAttribute("src")&&(I.imageUrl=j.getAttribute("src")||void 0),j.hasAttribute("width")&&(I.imageWidth=j.getAttribute("width")||void 0),j.hasAttribute("height")&&(I.imageHeight=j.getAttribute("height")||void 0),j.hasAttribute("alt")&&(I.imageAlt=j.getAttribute("alt")||void 0)),I},ou=y=>{const I={},j=y.querySelector("swal-icon");return j&&(Js(j,["type","color"]),j.hasAttribute("type")&&(I.icon=j.getAttribute("type")),j.hasAttribute("color")&&(I.iconColor=j.getAttribute("color")),I.iconHtml=j.innerHTML),I},Yh=y=>{const I={},j=y.querySelector("swal-input");j&&(Js(j,["type","label","placeholder","value"]),I.input=j.getAttribute("type")||"text",j.hasAttribute("label")&&(I.inputLabel=j.getAttribute("label")),j.hasAttribute("placeholder")&&(I.inputPlaceholder=j.getAttribute("placeholder")),j.hasAttribute("value")&&(I.inputValue=j.getAttribute("value")));const Q=Array.from(y.querySelectorAll("swal-input-option"));return Q.length&&(I.inputOptions={},Q.forEach(Tt=>{Js(Tt,["value"]);const oe=Tt.getAttribute("value");if(!oe)return;const ze=Tt.innerHTML;I.inputOptions[oe]=ze})),I},eo=(y,I)=>{const j={};for(const Q in I){const Tt=I[Q],oe=y.querySelector(Tt);oe&&(Js(oe,[]),j[Tt.replace(/^swal-/,"")]=oe.innerHTML.trim())}return j},cu=y=>{const I=zh.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(y.children).forEach(j=>{const Q=j.tagName.toLowerCase();I.includes(Q)||Wt(`Unrecognized element <${Q}>`)})},Js=(y,I)=>{Array.from(y.attributes).forEach(j=>{I.indexOf(j.name)===-1&&Wt([`Unrecognized attribute "${j.name}" on <${y.tagName.toLowerCase()}>.`,`${I.length?`Allowed attributes are: ${I.join(", ")}`:"To set the value, use HTML within the element."}`])})},no=10,ms=y=>{const I=Ae(),j=Gt();typeof y.willOpen=="function"&&y.willOpen(j),G.eventEmitter.emit("willOpen",j);const Tt=window.getComputedStyle(document.body).overflowY;lu(I,j,y),setTimeout(()=>{Qs(I,j)},no),pr()&&(Fc(I,y.scrollbarPadding,Tt),qa()),!Di()&&!G.previousActiveElement&&(G.previousActiveElement=document.activeElement),typeof y.didOpen=="function"&&setTimeout(()=>y.didOpen(j)),G.eventEmitter.emit("didOpen",j),mi(I,X["no-transition"])},Or=y=>{const I=Gt();if(y.target!==I)return;const j=Ae();I.removeEventListener("animationend",Or),I.removeEventListener("transitionend",Or),j.style.overflowY="auto"},Qs=(y,I)=>{Wa(I)?(y.style.overflowY="hidden",I.addEventListener("animationend",Or),I.addEventListener("transitionend",Or)):y.style.overflowY="auto"},Fc=(y,I,j)=>{Hf(),I&&j!=="hidden"&&A_(j),setTimeout(()=>{y.scrollTop=0})},lu=(y,I,j)=>{pn(y,j.showClass.backdrop),j.animation?(I.style.setProperty("opacity","0","important"),bn(I,"grid"),setTimeout(()=>{pn(I,j.showClass.popup),I.style.removeProperty("opacity")},no)):bn(I,"grid"),pn([document.documentElement,document.body],X.shown),j.heightAuto&&j.backdrop&&!j.toast&&pn([document.documentElement,document.body],X["height-auto"])};var zl={email:(y,I)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(y)?Promise.resolve():Promise.resolve(I||"Invalid email address"),url:(y,I)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(y)?Promise.resolve():Promise.resolve(I||"Invalid URL")};function ns(y){y.inputValidator||(y.input==="email"&&(y.inputValidator=zl.email),y.input==="url"&&(y.inputValidator=zl.url))}function Es(y){(!y.target||typeof y.target=="string"&&!document.querySelector(y.target)||typeof y.target!="string"&&!y.target.appendChild)&&(Wt('Target parameter is not valid, defaulting to "body"'),y.target="body")}function Fo(y){ns(y),y.showLoaderOnConfirm&&!y.preConfirm&&Wt(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),Es(y),typeof y.title=="string"&&(y.title=y.title.split(`
`).join("<br />")),b_(y)}let qi;var Fr=new WeakMap;class zn{constructor(){if(U(this,Fr,void 0),typeof window>"u")return;qi=this;for(var I=arguments.length,j=new Array(I),Q=0;Q<I;Q++)j[Q]=arguments[Q];const Tt=Object.freeze(this.constructor.argsToParams(j));this.params=Tt,this.isAwaitingPromise=!1,K(Fr,this,this._main(qi.params))}_main(I){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(tu(Object.assign({},j,I)),G.currentInstance){const oe=jr.swalPromiseResolve.get(G.currentInstance),{isAwaitingPromise:ze}=G.currentInstance;G.currentInstance._destroy(),ze||oe({isDismissed:!0}),pr()&&qd()}G.currentInstance=qi;const Q=du(I,j);Fo(Q),Object.freeze(Q),G.timeout&&(G.timeout.stop(),delete G.timeout),clearTimeout(G.restoreFocusTimeout);const Tt=Xh(qi);return Bf(qi,Q),en.innerParams.set(qi,Q),qh(qi,Tt,Q)}then(I){return L(Fr,this).then(I)}finally(I){return L(Fr,this).finally(I)}}const qh=(y,I,j)=>new Promise((Q,Tt)=>{const oe=ze=>{y.close({isDismissed:!0,dismiss:ze})};jr.swalPromiseResolve.set(y,Q),jr.swalPromiseReject.set(y,Tt),I.confirmButton.onclick=()=>{D_(y)},I.denyButton.onclick=()=>{Mc(y)},I.cancelButton.onclick=()=>{Jf(y,oe)},I.closeButton.onclick=()=>{oe(kc.close)},iu(j,I,oe),Ch(G,j,oe),Dh(y,j),ms(j),_r(G,j,oe),ki(I,j),setTimeout(()=>{I.container.scrollTop=0})}),du=(y,I)=>{const j=xs(y),Q=Object.assign({},Uc,I,j,y);return Q.showClass=Object.assign({},Uc.showClass,Q.showClass),Q.hideClass=Object.assign({},Uc.hideClass,Q.hideClass),Q.animation===!1&&(Q.showClass={backdrop:"swal2-noanimation"},Q.hideClass={}),Q},Xh=y=>{const I={popup:Gt(),container:Ae(),actions:Re(),confirmButton:he(),denyButton:Zt(),cancelButton:jt(),loader:Kt(),closeButton:ie(),validationMessage:Ft(),progressSteps:at()};return en.domCache.set(y,I),I},_r=(y,I,j)=>{const Q=ce();Qn(Q),I.timer&&(y.timeout=new pm(()=>{j("timer"),delete y.timeout},I.timer),I.timerProgressBar&&(bn(Q),fr(Q,I,"timerProgressBar"),setTimeout(()=>{y.timeout&&y.timeout.running&&Os(I.timer)})))},ki=(y,I)=>{if(!I.toast){if(!Ne(I.allowEnterKey)){_e("allowEnterKey"),Zs();return}On(y)||Ms(y,I)||jl(-1,1)}},On=y=>{const I=Array.from(y.popup.querySelectorAll("[autofocus]"));for(const j of I)if(j instanceof HTMLElement&&vr(j))return j.focus(),!0;return!1},Ms=(y,I)=>I.focusDeny&&vr(y.denyButton)?(y.denyButton.focus(),!0):I.focusCancel&&vr(y.cancelButton)?(y.cancelButton.focus(),!0):I.focusConfirm&&vr(y.confirmButton)?(y.confirmButton.focus(),!0):!1,Zs=()=>{document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){const y=new Date,I=localStorage.getItem("swal-initiation");I?(y.getTime()-Date.parse(I))/(1e3*60*60*24)>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const j=document.createElement("audio");j.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",j.loop=!0,document.body.appendChild(j),setTimeout(()=>{j.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${y}`)}zn.prototype.disableButtons=Uh,zn.prototype.enableButtons=Mh,zn.prototype.getInput=tm,zn.prototype.disableInput=Uo,zn.prototype.enableInput=$d,zn.prototype.hideLoading=$a,zn.prototype.disableLoading=$a,zn.prototype.showValidationMessage=Xs,zn.prototype.resetValidationMessage=em,zn.prototype.close=Ls,zn.prototype.closePopup=Ls,zn.prototype.closeModal=Ls,zn.prototype.closeToast=Ls,zn.prototype.rejectPromise=zf,zn.prototype.update=eu,zn.prototype._destroy=Bh,Object.assign(zn,hm),Object.keys(L_).forEach(y=>{zn[y]=function(){return qi&&qi[y]?qi[y](...arguments):null}}),zn.DismissReason=kc,zn.version="11.17.2";const Gc=zn;return Gc.default=Gc,Gc}),typeof uh<"u"&&uh.Sweetalert2&&(uh.swal=uh.sweetAlert=uh.Swal=uh.SweetAlert=uh.Sweetalert2)}(n0)),n0.exports}var $q=Zq();const ws=iO($q);function t7(){const E=S_(),[b,O]=Nl.useState({username:"",password:""}),{superadminlogin:A}=Yy(),L=async()=>{try{const U=await A(b);console.log(U.message),U.message==" Login successful!"?(localStorage.setItem("token",U.token),E("/superadmindashboard")):ws.fire({icon:"error",title:"Sorry",text:U.data.message})}catch(U){console.log(U),ws.fire({icon:"error",title:"Sorry",text:"Invalid Credentials !"})}};return R.jsxs("div",{className:"flex flex-col md:flex-row h-screen bg-gradient-to-r from-blue-500 to-blue-700",children:[R.jsxs("div",{className:"w-full md:w-1/2 flex flex-col justify-center items-center bg-white text-blue-600 p-10 shadow-xl rounded-lg",children:[R.jsx("img",{src:Vy,alt:"Logo",className:"w-24 h-24 mb-4 animate-pulse"}),R.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Welcome Back"}),R.jsx("p",{className:"mb-6 text-lg text-gray-600",children:"Login to your Super Admin account"}),R.jsxs("div",{className:"w-full max-w-sm bg-gray-50 p-6 rounded-lg shadow-2xl transform transition hover:scale-105",children:[R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"username"}),R.jsx("input",{type:"email",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 shadow-sm",placeholder:"Enter your username",onChange:U=>O({...b,username:U.target.value})})]}),R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Password"}),R.jsx("input",{type:"password",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 shadow-sm",placeholder:"Enter your password",onChange:U=>O({...b,password:U.target.value})})]}),R.jsx("button",{onClick:L,className:"w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition transform hover:scale-105 shadow-md hover:shadow-lg",children:"Login"})]})]}),R.jsx("div",{className:"hidden md:flex w-1/2 items-center justify-center p-10 animate-slide-in",children:R.jsx("img",{src:kV,alt:"Illustration",className:"max-w-full h-auto drop-shadow-xl rounded-lg"})})]})}/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e7=E=>E.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),lB=(...E)=>E.filter((b,O,A)=>!!b&&b.trim()!==""&&A.indexOf(b)===O).join(" ").trim();/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var n7={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i7=it.forwardRef(({color:E="currentColor",size:b=24,strokeWidth:O=2,absoluteStrokeWidth:A,className:L="",children:U,iconNode:K,...J},G)=>it.createElement("svg",{ref:G,...n7,width:b,height:b,stroke:E,strokeWidth:A?Number(O)*24/Number(b):O,className:lB("lucide",L),...J},[...K.map(([H,rt])=>it.createElement(H,rt)),...Array.isArray(U)?U:[U]]));/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Df=(E,b)=>{const O=it.forwardRef(({className:A,...L},U)=>it.createElement(i7,{ref:U,iconNode:b,className:lB(`lucide-${e7(E)}`,A),...L}));return O.displayName=`${E}`,O};/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r7=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ol=Df("EyeOff",r7);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s7=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Cc=Df("Eye",s7);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a7=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],dB=Df("LockOpen",a7);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o7=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],uB=Df("Lock",o7);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c7=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],qy=Df("Search",c7);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l7=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],hB=Df("SquarePen",l7);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d7=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],E_=Df("Trash2",d7);function fO({setUserAdded:E}){const b=S_(),[O,A]=it.useState(!1),{createNewAdmin:L,saveprice:U,getprice:K}=Yy(),[J,G]=it.useState(!1),[H,rt]=it.useState(!1),[lt,dt]=it.useState(!1),[X,st]=it.useState();it.useEffect(()=>{(async()=>{try{const Xt=await K();console.log("Full Response:",Xt),Xt!=null&&Xt.Price&&Array.isArray(Xt.Price)&&Xt.Price.length>0?(console.log("Price:",Xt.Price[0].price),st(Xt.Price[0].price)):console.log("No price data found")}catch(Xt){console.log(" Error fetching price:",Xt)}})()},[J,H]);const[Ct,yt]=it.useState({name:"",adminlimits:"",password:"",confirmPassword:"",app_id:"",token_id:"",channel_name:"",phoneNumber:"",username:"",customerId:"",customerSecret:""}),[It,Wt]=it.useState(!1),[Rt,ye]=it.useState(!1),ne=Ie=>{yt({...Ct,[Ie.target.name]:Ie.target.value})},_e=async Ie=>{if(Ie.preventDefault(),console.log(Ct),Ct.password!==Ct.confirmPassword){ws.fire({icon:"error",title:"Sorry",text:"Password Not Match!"});return}try{(await L(Ct)).message===" Admin created successfully!"?(ws.fire({title:"Successfull !",text:"Admin created successfully",icon:"success"}),G(!1),E(!0)):ws.fire({icon:"error",title:"Sorry",text:"Something went wrong!"})}catch(Xt){console.log(Xt),ws.fire({icon:"error",title:"Sorry",text:Xt.message})}},Ne=async()=>{const Ie={price:X};try{const Xt=await U(Ie);console.log(Xt),rt(!1)}catch(Xt){console.log(Xt)}};return R.jsxs(R.Fragment,{children:[R.jsxs("nav",{className:"sticky top-0 px-4 py-4 flex justify-between shadow-md items-center bg-white z-50",children:[R.jsx("a",{className:"text-3xl font-bold leading-none",href:"#",children:R.jsx("img",{src:Vy,alt:"",width:70})}),R.jsx("div",{className:"lg:hidden",children:R.jsx("button",{onClick:()=>A(!O),className:"navbar-burger flex items-center text-blue-600 p-3",children:R.jsxs("svg",{className:"block h-4 w-4 fill-current",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:[R.jsx("title",{children:"Mobile menu"}),R.jsx("path",{d:"M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"})]})})}),R.jsxs("ul",{className:"hidden absolute top-1/2 left-1/2 transform -translate-y-1/2 -translate-x-1/2 lg:flex lg:mx-auto  lg:items-center lg:w-auto lg:space-x-6",children:[R.jsx("li",{children:R.jsx(Rc,{to:"/superadmindashboard",className:({isActive:Ie})=>Ie?"text-sm text-blue-600 font-bold ":" text-sm text-gray-400 hover:text-gray-500",children:"Home"})}),R.jsx("li",{className:"text-gray-300",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",className:"w-4 h-4 current-fill",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),R.jsx("li",{onClick:()=>G(!0),children:R.jsx("a",{className:J?"text-sm text-blue-600 font-bold cursor-pointer":"text-sm text-gray-400 hover:text-gray-500 cursor-pointer",children:"Add Admin"})}),R.jsx("li",{className:"text-gray-300",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",className:"w-4 h-4 current-fill",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),R.jsx("li",{onClick:()=>rt(!0),children:R.jsx("a",{className:J?"text-sm text-blue-600 font-bold cursor-pointer":"text-sm text-gray-400 hover:text-gray-500 cursor-pointer",children:"Add Price"})}),R.jsx("li",{className:"text-gray-300",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",className:"w-4 h-4 current-fill",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),R.jsx("li",{children:R.jsx(Rc,{to:"/callhistory",className:({isActive:Ie})=>Ie?"text-sm text-blue-600 font-bold ":" text-sm text-gray-400 hover:text-gray-500",children:"Call History"})})]}),R.jsx("a",{className:"hidden lg:inline-block py-2 px-6 bg-blue-500 hover:bg-blue-600 text-sm text-white font-bold rounded-xl transition duration-200",onClick:()=>dt(!0),children:"Log out"})]}),R.jsxs("div",{className:`navbar-menu relative z-50 ${O?"":"hidden"}`,children:[R.jsx("div",{className:"navbar-backdrop fixed inset-0 bg-gray-800 opacity-25",onClick:()=>A(!1)}),R.jsxs("nav",{className:"fixed top-0 left-0 bottom-0 flex flex-col w-5/6 max-w-sm py-6 px-6 bg-white border-r overflow-y-auto",children:[R.jsxs("div",{className:"flex items-center mb-8",children:[R.jsx("a",{className:"mr-auto text-3xl font-bold leading-none",href:"#",children:R.jsx("img",{src:Vy,alt:"",width:100})}),R.jsx("button",{className:"navbar-close",onClick:()=>A(!1),children:R.jsx("svg",{className:"h-6 w-6 text-gray-400 cursor-pointer hover:text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),R.jsx("div",{children:R.jsxs("ul",{children:[R.jsx("li",{className:"mb-1",children:R.jsx(Rc,{to:"/superadmindashboard",className:({isActive:Ie})=>Ie?"text-sm text-blue-600 font-bold ":" text-sm text-gray-400 hover:text-gray-500",children:"Home"})}),R.jsx("li",{className:"mb-1",onClick:()=>G(!0),children:R.jsx("a",{className:"block py-4 text-sm font-semibold text-gray-400 hover:bg-blue-50 hover:text-blue-600 rounded",href:"#",children:"Add Admin"})}),R.jsx("li",{onClick:()=>rt(!0),children:R.jsx("a",{className:J?"text-sm text-blue-600 font-bold cursor-pointer":"text-sm text-gray-400 hover:text-gray-500 cursor-pointer",children:"Add Price"})}),R.jsx("li",{className:"text-gray-300",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",className:"w-4 h-4 current-fill",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),R.jsx("li",{className:"mb-1",children:R.jsx(Rc,{to:"/callhistory",className:({isActive:Ie})=>Ie?"text-sm text-blue-600 font-bold ":" text-sm text-gray-400 hover:text-gray-500",children:"Call History"})})]})}),R.jsxs("div",{className:"mt-auto",children:[R.jsx("div",{className:"pt-6",onClick:()=>dt(!0),children:R.jsx("a",{className:"block px-4 py-3 mb-2 leading-loose text-xs text-center text-white font-semibold bg-blue-600 hover:bg-blue-700  rounded-xl",children:"Log Out"})}),R.jsx("p",{className:"my-4 text-xs text-center text-gray-400"})]})]})]}),J&&R.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/30 backdrop-blur-sm z-50 animate-fadeIn",children:R.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-2xl w-[500px] max-w-[95%] border border-gray-100 animate-scaleIn",children:[R.jsxs("div",{className:"flex justify-between items-center pb-4 mb-4 border-b border-gray-200",children:[R.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Add New Admin"}),R.jsx("button",{onClick:()=>G(!1),className:"text-gray-400 hover:text-gray-600 transition-colors p-1 cursor-pointer rounded-full hover:bg-gray-100",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),R.jsxs("form",{className:"space-y-4",onSubmit:_e,children:[R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),R.jsx("input",{required:!0,type:"text",name:"name",placeholder:"Enter full name",onChange:ne,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Limit"}),R.jsx("input",{type:"number",required:!0,name:"adminlimits",placeholder:"Set admin limit",onChange:ne,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs("div",{className:"relative",children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),R.jsx("input",{required:!0,type:It?"text":"password",name:"password",placeholder:"Create password",onChange:ne,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),R.jsx("button",{type:"button",onClick:()=>Wt(!It),className:"cursor-pointer absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:It?R.jsx(Ol,{className:"h-5 w-5"}):R.jsx(Cc,{className:"h-5 w-5"})})]}),R.jsxs("div",{className:"relative",children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),R.jsx("input",{required:!0,type:Rt?"text":"password",name:"confirmPassword",placeholder:"Confirm your password",onChange:ne,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),R.jsx("button",{type:"button",onClick:()=>ye(!Rt),className:"cursor-pointer absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:Rt?R.jsx(Ol,{className:"h-5 w-5"}):R.jsx(Cc,{className:"h-5 w-5"})})]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"App ID"}),R.jsx("input",{required:!0,type:"text",name:"app_id",placeholder:"Enter app ID",onChange:ne,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"App Certificate"}),R.jsx("input",{required:!0,type:"text",name:"token_id",placeholder:"Enter app certificate",onChange:ne,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Channel ID"}),R.jsx("input",{required:!0,type:"text",name:"channel_name",placeholder:"Channel ID",onChange:ne,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),R.jsx("input",{type:"text",required:!0,pattern:"[0-9]*",inputMode:"numeric",name:"phoneNumber",placeholder:"Phone number",onChange:ne,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Id"}),R.jsx("input",{required:!0,type:"text",name:"customerId",placeholder:"Customer ID",onChange:ne,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Secret"}),R.jsx("input",{required:!0,type:"text",name:"customerSecret",placeholder:"Customer Secret",onChange:ne,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),R.jsx("input",{required:!0,type:"text",name:"username",placeholder:"Username",onChange:ne,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsx("button",{type:"submit",className:"cursor-pointer w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-medium hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg active:scale-95 transform mt-4",children:"Add Admin"})]})]})}),lt&&R.jsx("div",{id:"logout-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:R.jsx("div",{className:"relative p-4 w-full max-w-md",children:R.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[R.jsx("button",{type:"button",className:"cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>dt(!1),children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),R.jsxs("div",{className:"p-6 text-center",children:[R.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Do you want to logout?"}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsx("button",{className:"cursor-pointer px-6 py-2 text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",onClick:()=>b("/"),children:"Yes"}),R.jsx("button",{onClick:()=>dt(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})}),H&&R.jsx("div",{id:"logout-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:R.jsx("div",{className:"relative p-4 w-full max-w-md",children:R.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[R.jsx("button",{type:"button",className:"cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>rt(!1),children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),R.jsxs("div",{className:"p-6 text-center",children:[R.jsxs("div",{children:[R.jsx("label",{className:"text-left block text-sm font-medium text-gray-700 mb-1",children:"Price"}),R.jsx("input",{required:!0,type:"text",name:"name",value:X,placeholder:"Enter Price",onChange:Ie=>st(Ie.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsx("br",{}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsx("button",{className:"cursor-pointer px-6 py-2 text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",onClick:()=>Ne(),children:"Save"}),R.jsx("button",{onClick:()=>rt(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})})]})}function u7(){const{listAdmin:E,deleteAdmin:b,getAdminById:O,updateAdmin:A}=Yy(),[L,U]=it.useState(!1),[K,J]=it.useState(""),[G,H]=it.useState(1),rt=10,[lt,dt]=it.useState(0),[X,st]=it.useState(!1),[Ct,yt]=it.useState(!1),[It,Wt]=it.useState(!1),[Rt,ye]=it.useState(),[ne,_e]=it.useState([]),[Ne,Ie]=it.useState(!1);it.useEffect(()=>{Xt()},[G]);const Xt=async()=>{try{const ce=rt,ie=(G-1)*rt,vn=await E(ce,ie);_e(vn),console.log("response",vn),vn.totalCount&&dt(vn.totalCount),console.log(vn)}catch(ce){console.log(ce)}},Qt=ne.filter(ce=>{var ie,vn,Ue;return((ie=ce.username)==null?void 0:ie.toLowerCase().includes(K.toLowerCase()))||((vn=ce.email)==null?void 0:vn.toLowerCase().includes(K.toLowerCase()))||((Ue=ce.name)==null?void 0:Ue.toLowerCase().includes(K.toLowerCase()))}),Ae=Math.ceil(lt?lt/rt:Qt.length/rt),In=G*rt,re=In-rt,Gt=Qt.slice(re,In),[me,Ut]=it.useState({id:null,email:"",adminlimits:"",name:"",confirmPassword:"",app_id:"",token_id:"",channel_name:"",username:"",customerId:"",customerSecret:""}),Ee=async ce=>{const ie=await O(ce.id);console.log(ie,"fullUserDetails"),Ut({id:ie.id,email:ie.email||"",adminlimits:ie.adminlimits||"",name:ie.name,password:ie.password||"",confirmPassword:ie.password||"",app_id:ie.app_id||"",token_id:ie.token_id||"",channel_name:ie.channel_name||"",username:ie.username||"",customerId:ie.customerId||"",customerSecret:ie.customerSecret||""}),U(!0)},se=ce=>{Ut({...me,[ce.target.name]:ce.target.value})},[be,at]=it.useState(!1),[Ft,he]=it.useState(null),jt=async ce=>{ce.preventDefault();try{const ie={...me};console.log(ie),ie.password||(delete ie.password,delete ie.confirmPassword),delete ie.confirmPassword,await A(ie.id,ie),Xt(),U(!1)}catch(ie){console.error("Update failed",ie)}},Zt=ce=>{he(ce),at(!0)},Lt=async ce=>{console.log(ce),await b(ce),Xt()},Kt=()=>{G>1&&H(G-1)},Re=()=>{G<Ae&&H(G+1)},te=async(ce,ie)=>{console.log(ce,Rt.lcokstatus);try{const vn={lcokstatus:Rt!=null&&Rt.lcokstatus?0:1};console.log("updateData",vn),await A(ce,vn),Xt(),E(rt,(G-1)*rt)}catch(vn){console.error("Error updating lock status:",vn)}};return console.log("currentRecords",Gt),it.useEffect(()=>{console.log("Dashboard - useradded changed:",Ne),Xt()},[Ne]),R.jsxs(R.Fragment,{children:[R.jsx(fO,{setUserAdded:Ie,modalOpen:L}),R.jsxs("div",{className:"container mx-auto p-6 w-4/5",children:[R.jsx("div",{className:"flex items-center justify-between mb-4",children:R.jsxs("div",{className:"relative w-1/3",children:[R.jsx("input",{type:"text",placeholder:"Search...",className:"w-full p-2 pl-10 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200",value:K,onChange:ce=>J(ce.target.value)}),R.jsx(qy,{className:"absolute left-3 top-2.5 text-gray-400",size:20})]})}),R.jsx("div",{className:"overflow-x-auto shadow-lg rounded-lg",children:R.jsx("div",{className:"min-w-full inline-block align-middle",children:R.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:R.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[R.jsx("thead",{className:"bg-blue-600 text-white",children:R.jsxs("tr",{children:[R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Name"}),R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Username"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Admin Limits"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Lock/Unlock"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Update"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Delete"})]})}),R.jsx("tbody",{className:"divide-y divide-gray-300 bg-white",children:Gt.map((ce,ie)=>R.jsxs("tr",{className:"hover:bg-gray-100 transition",children:[R.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800",children:ce.name}),R.jsx("td",{className:"px-6 py-4 text-sm text-gray-800",children:ce.username}),R.jsx("td",{className:"px-6 py-4 text-center text-sm text-gray-800",children:ce.adminlimits}),R.jsx("td",{className:"px-6 py-4 text-center",children:R.jsx("button",{onClick:()=>{ye(ce),Wt(!0)},className:"cursor-pointer text-gray-600 hover:text-gray-800 transition",children:ce.lcokstatus?R.jsx(dB,{size:20}):R.jsx(uB,{size:20})})}),R.jsx("td",{className:"cursor-pointer px-6 py-4 text-center",children:R.jsx("button",{onClick:()=>Ee(ce),className:"cursor-pointer text-yellow-500 hover:text-yellow-700 transition",children:R.jsx(hB,{size:20})})}),R.jsx("td",{className:"cursor-pointer px-6 py-4 text-center",children:R.jsx("button",{onClick:()=>Zt(ce),className:"cursor-pointer text-red-500 hover:text-red-700 transition",children:R.jsx(E_,{size:20})})})]},ie))})]})})})}),R.jsxs("div",{className:"flex justify-between mt-4",children:[R.jsx("button",{disabled:G===1,onClick:Kt,className:"px-4 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-200 transition disabled:opacity-50",children:"Previous"}),R.jsxs("span",{className:"text-gray-700",children:["Page ",G," of ",Ae||1]}),R.jsx("button",{disabled:G===Ae||Ae===0,onClick:Re,className:"px-4 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-200 transition disabled:opacity-50",children:"Next"})]})]}),L&&R.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/30 backdrop-blur-sm z-50 animate-fadeIn",children:R.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-2xl w-[500px] max-w-[95%] border border-gray-100 animate-scaleIn",children:[R.jsxs("div",{className:"flex justify-between items-center pb-4 mb-4 border-b border-gray-200",children:[R.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Update Admin"}),R.jsx("button",{onClick:()=>U(!1),className:"cursor-pointer text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),R.jsxs("form",{onSubmit:jt,className:"space-y-4",children:[R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),R.jsx("input",{type:"text",name:"username",value:me.username,placeholder:"Username",onChange:se,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"App ID"}),R.jsx("input",{type:"text",name:"app_id",value:me.app_id,placeholder:"Enter app ID",onChange:se,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"App Certificate"}),R.jsx("input",{type:"text",name:"token_id",value:me.token_id,placeholder:"Enter app certificate",onChange:se,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Limit"}),R.jsx("input",{type:"number",name:"adminlimits",value:me.adminlimits,placeholder:"Set admin limit",onChange:se,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Channel Name"}),R.jsx("input",{type:"text",name:"channel_name",value:me.channel_name,placeholder:"Channel Name",onChange:se,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{className:"relative",children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),R.jsx("input",{name:"name",value:me.name,placeholder:"Enter Name",onChange:se,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Id"}),R.jsx("input",{required:!0,type:"text",value:me.customerId,name:"customerId",placeholder:"Custome ID",onChange:se,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Secret"}),R.jsx("input",{required:!0,type:"text",value:me.customerSecret,name:"customerSecret",placeholder:"Customer Secret",onChange:se,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{className:"relative",children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),R.jsx("input",{type:X?"text":"password",value:me.password,name:"password",placeholder:"Create password",onChange:se,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),R.jsx("button",{type:"button",onClick:()=>st(!X),className:"absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:X?R.jsx(Ol,{className:"h-5 w-5"}):R.jsx(Cc,{className:"h-5 w-5"})})]}),R.jsxs("div",{className:"relative",children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),R.jsx("input",{type:Ct?"text":"password",name:"confirmPassword",value:me.confirmPassword!==void 0?me.confirmPassword:me.password,placeholder:"Confirm password",onChange:se,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),R.jsx("button",{type:"button",onClick:()=>yt(!Ct),className:"absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:Ct?R.jsx(Ol,{className:"h-5 w-5"}):R.jsx(Cc,{className:"h-5 w-5"})})]}),R.jsx("div",{className:"grid grid-cols-1 gap-4"})]}),R.jsx("button",{type:"submit",className:"cursor-pointer w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600",children:"Update Admin"})]})]})}),be&&R.jsx("div",{id:"popup-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:R.jsx("div",{className:"relative p-4 w-full max-w-md",children:R.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[R.jsx("button",{type:"button",className:" cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>at(!1),children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),R.jsxs("div",{className:"cursor-pointer p-6 text-center",children:[R.jsx("svg",{className:"cursor-pointer mx-auto mb-4 text-red-600 w-14 h-14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),R.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Confirm Permanent Deletion"}),R.jsxs("p",{className:"mb-6 text-gray-600",children:["This will permanently delete the admin"," ",R.jsx("span",{className:"font-semibold",children:Ft==null?void 0:Ft.username})," ","and cannot be recovered. Are you sure you want to continue?"]}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsx("button",{className:"cursor-pointer px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",onClick:()=>{Lt(Ft.id),at(!1),E(rt,(G-1)*rt)},children:"Delete Permanently"}),R.jsx("button",{onClick:()=>at(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})}),It&&R.jsx("div",{id:"lock-unlock-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:R.jsx("div",{className:"relative p-4 w-full max-w-md",children:R.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[R.jsx("button",{type:"button",className:"cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>Wt(!1),children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),R.jsxs("div",{className:"p-6 text-center",children:[R.jsx("svg",{className:` mx-auto mb-4 ${Rt!=null&&Rt.lcokstatus?"text-red-600":"text-green-600"} w-14 h-14`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:Rt!=null&&Rt.lcokstatus?"M6 18L18 6M6 6l12 12":"M5 12h14M12 5v14M9 9l6 6M9 15l6-6"})}),R.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:Rt!=null&&Rt.lcokstatus?"Lock Admin Access":"Unlock Admin Access"}),R.jsxs("p",{className:"mb-6 text-gray-600",children:["Are you sure you want to"," ",Rt!=null&&Rt.lcokstatus?"lock":"unlock"," the User"," ",R.jsx("span",{className:"font-semibold",children:!(Rt!=null&&Rt.lcokstatus)}),"?"]}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsx("button",{className:`cursor-pointer px-6 py-2 text-white rounded-md transition-colors ${Rt!=null&&Rt.lcokstatus?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"}`,onClick:()=>{te(Rt.id,!Rt.locked),Wt(!1),E(rt,(G-1)*rt)},children:Rt!=null&&Rt.lcokstatus?"Lock":"Unlock"}),R.jsx("button",{onClick:()=>Wt(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})})]})}function hV(){return R.jsx(R.Fragment,{children:R.jsx(u7,{})})}function h7(){const[E,b]=it.useState(""),[O,A]=it.useState(1),L=8,[U,K]=it.useState([{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"}]),J=U.filter(dt=>dt.Date.toLowerCase().includes(E.toLowerCase())||dt.Cost.toLowerCase().includes(E.toLowerCase())||dt.Time.toLowerCase().includes(E.toLowerCase())),G=Math.ceil(J.length/L),H=O*L,rt=H-L,lt=J.slice(rt,H);return R.jsxs(R.Fragment,{children:[R.jsx(fO,{}),R.jsxs("div",{className:"container mx-auto p-6 w-4/5",children:[R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[R.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4 border-b pb-2",children:"Nayan Karemore"}),R.jsxs("div",{className:"relative w-1/3",children:[R.jsx("input",{type:"text",placeholder:"Search...",className:"w-full p-2 pl-10 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200",value:E,onChange:dt=>b(dt.target.value)}),R.jsx(qy,{className:"absolute left-3 top-2.5 text-gray-400",size:20})]})]}),R.jsx("div",{className:"overflow-x-auto shadow-lg rounded-lg",children:R.jsx("div",{className:"min-w-full inline-block align-middle",children:R.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:R.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[R.jsx("thead",{className:"bg-blue-600 text-white",children:R.jsxs("tr",{children:[R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Date"}),R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Time"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Cost"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Delete"})]})}),R.jsx("tbody",{className:"divide-y divide-gray-300 bg-white",children:lt.map((dt,X)=>R.jsxs("tr",{className:"hover:bg-gray-100 transition",children:[R.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800",children:dt.Date}),R.jsx("td",{className:"px-6 py-4 text-sm text-gray-800 ",children:dt.Time}),R.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800 text-center",children:dt.Cost}),R.jsx("td",{className:"px-6 py-4 text-center",children:R.jsx("button",{className:"text-red-500 hover:text-red-700 transition",children:R.jsx(E_,{size:20})})})]},X))})]})})})}),R.jsxs("div",{className:"flex justify-between mt-4",children:[R.jsx("button",{disabled:O===1,onClick:()=>A(O-1),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-200 transition disabled:opacity-50",children:"Previous"}),R.jsxs("span",{className:"text-gray-700",children:["Page ",O," of ",G]}),R.jsx("button",{disabled:O===G,onClick:()=>A(O+1),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-200 transition disabled:opacity-50",children:"Next"})]})]})]})}function p7(){const{adminhistory:E,deleteadminhistory:b,deleteAllRecordings:O,adminDropdown:A}=Yy(),[L,U]=it.useState(""),[K,J]=it.useState(1),[G,H]=it.useState(!1),[rt,lt]=it.useState(),[dt,X]=it.useState(null),st=8,[Ct,yt]=it.useState(""),[It,Wt]=it.useState(""),[Rt,ye]=it.useState([]),[ne,_e]=it.useState(!1),[Ne,Ie]=it.useState([]),[Xt,Qt]=it.useState([]),[Ae,In]=it.useState([]);it.useEffect(()=>{A().then(Zt=>{In(Zt)})},[]),console.log("adminValues",Ae);const re=jt=>{const Zt=new Map;return jt.forEach(Lt=>{Zt.has(Lt.name)||Zt.set(Lt.name,{name:Lt.name,totalTime:0,totalCost:0});const Kt=Zt.get(Lt.name);Kt.totalTime+=Number(Lt.calltime),Kt.totalCost+=Number(Lt.cost)}),Array.from(Zt.values())},Gt=dt?Ne.filter(jt=>jt.name===dt):Xt.filter(jt=>jt.name.toLowerCase().includes(L.toLowerCase()));Math.ceil(Gt.length/st);const me=K*st,Ut=me-st,Ee=Gt.slice(Ut,me),se=async()=>{try{const jt=await E();Ie(jt.Histoty),Qt(re(jt.Histoty))}catch(jt){console.log(jt)}};it.useEffect(()=>{se()},[G]);const be=jt=>{console.log(jt),lt(jt),H(!0)},at=async()=>{console.log(typeof rt);const Zt=await b(rt);console.log(Zt),ws.fire({title:"Successfull !",text:"Delete successfully",icon:"success"}),se()},Ft=async()=>{if(!Ct||!It){alert("Please select both from and to dates.");return}console.log("first",{superadminname:"admin@123",fromDate:new Date(Ct).toISOString(),toDate:new Date(It+"T23:59:59").toISOString(),selectedUser:dt});try{const jt=O({superadminname:"admin@123",fromDate:new Date(Ct).toISOString(),toDate:new Date(It+"T23:59:59").toISOString(),selectedUser:dt});se(),ws.fire({title:"Successfull !",text:"Delete successfully",icon:"success"}),yt(""),Wt("")}catch(jt){console.log("data",data),console.error(jt),alert("Error deleting recordings.")}},he=async()=>{try{await Promise.all(Rt.map(jt=>b(jt))),se(),ws.fire({title:"Successfull !",text:"Delete successfully",icon:"success"}),ye([])}catch(jt){console.error(jt),alert("Error deleting selected records.")}};return R.jsxs(R.Fragment,{children:[R.jsx(fO,{}),R.jsxs("div",{className:"container mx-auto p-6 w-full md:w-4/5",children:[R.jsxs("div",{className:"flex items-center justify-between mb-6",children:[R.jsxs("div",{className:"flex gap-4 items-center",children:[R.jsxs("div",{children:[R.jsx("label",{className:"text-sm text-gray-700 block mb-1",children:"From Date"}),R.jsx("input",{type:"date",value:Ct,onChange:jt=>yt(jt.target.value),className:"p-2 border rounded-md text-sm"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"text-sm text-gray-700 block mb-1",children:"To Date"}),R.jsx("input",{type:"date",value:It,onChange:jt=>Wt(jt.target.value),className:"p-2 border rounded-md text-sm"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"text-sm text-gray-700 block mb-1",children:"Select Admin"}),R.jsxs("select",{className:"p-2 border rounded-md text-sm",onChange:jt=>{X(jt.target.value),console.log("selected user",jt.target.value)},value:dt,children:[R.jsx("option",{value:"all",children:"All"}),Ae.map(jt=>R.jsx("option",{value:jt.name,children:jt.name},jt.id))]})]})]}),R.jsx("button",{className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition",onClick:()=>_e(!0),children:"Delete by Date"})]}),R.jsxs("div",{className:"flex items-center justify-between mb-4",children:[dt===null&&R.jsxs("div",{className:"relative w-1/3",children:[R.jsx("input",{type:"text",placeholder:"Search...",className:"w-full p-2 pl-10 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200",value:L,onChange:jt=>U(jt.target.value)}),R.jsx(qy,{className:"absolute left-3 top-2.5 text-gray-400",size:20})]}),dt&&R.jsx("button",{onClick:()=>X(null),className:"ml-2 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Back to All Users"}),dt&&Rt.length>0&&R.jsx("div",{className:"mb-4",children:R.jsxs("button",{onClick:he,className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition",children:["Delete Selected (",Rt.length,")"]})})]}),R.jsx("div",{className:"overflow-x-auto shadow-lg rounded-lg",children:R.jsx("div",{className:"min-w-full inline-block align-middle",children:R.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:R.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[R.jsx("thead",{className:"bg-blue-600 text-white",children:R.jsxs("tr",{children:[R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Name"}),dt?R.jsxs(R.Fragment,{children:[R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Date"}),R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Time"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Cost"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Delete"}),dt&&R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:R.jsx("input",{type:"checkbox",checked:Ee.length>0&&Ee.every(jt=>Rt.includes(jt.id)),onChange:jt=>{const Zt=jt.target.checked?Ee.map(Lt=>Lt.id):[];ye(Zt)}})})]}):R.jsxs(R.Fragment,{children:[R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Total Time"}),R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Total Cost"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"View"})]})]})}),R.jsx("tbody",{className:"divide-y divide-gray-300 bg-white",children:Ee.map((jt,Zt)=>R.jsxs("tr",{className:"hover:bg-gray-100 transition",onClick:()=>!dt&&X(jt.name),style:{cursor:dt?"default":"pointer"},children:[R.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800 text-nowrap",children:jt.name}),dt?R.jsxs(R.Fragment,{children:[R.jsx("td",{className:"px-6 py-4 text-sm text-gray-800 text-nowrap",children:jt.date}),R.jsx("td",{className:"px-6 py-4 text-sm text-gray-800 text-nowrap",children:`${parseFloat(jt.calltime).toFixed(2)} Sec`}),R.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800 text-center text-nowrap",children:`$ ${parseFloat(jt.cost).toFixed(2)}`}),R.jsx("td",{className:"px-6 py-4 text-center",children:R.jsx("button",{onClick:Lt=>{Lt.stopPropagation(),be(jt.id)},className:"text-red-500 hover:text-red-700 transition",children:R.jsx(E_,{size:20})})}),dt&&R.jsx("td",{className:"px-6 py-4 text-center",children:R.jsx("input",{type:"checkbox",checked:Rt.includes(jt.id),onChange:Lt=>{Lt.stopPropagation();const Kt=Lt.target.checked?[...Rt,jt.id]:Rt.filter(Re=>Re!==jt.id);ye(Kt)}})})]}):R.jsxs(R.Fragment,{children:[R.jsx("td",{className:"px-6 py-4 text-sm text-gray-800 text-nowrap",children:`${parseFloat(jt.totalTime).toFixed(2)} Sec`}),R.jsx("td",{className:"px-6 py-4 text-sm text-gray-800 text-nowrap",children:`$ ${parseFloat(jt.totalCost).toFixed(2)}`}),R.jsx("td",{className:"px-6 py-4 text-center",children:R.jsx("button",{onClick:Lt=>{Lt.stopPropagation(),X(jt.name)},className:"text-blue-500 hover:text-blue-700 transition",children:R.jsx(Cc,{size:20})})})]})]},Zt))})]})})})})]}),G&&R.jsx("div",{id:"popup-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:R.jsx("div",{className:"relative p-4 w-full max-w-md",children:R.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[R.jsx("button",{type:"button",className:" cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>H(!1),children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),R.jsxs("div",{className:"cursor-pointer p-6 text-center",children:[R.jsx("svg",{className:"cursor-pointer mx-auto mb-4 text-red-600 w-14 h-14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),R.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Confirm Permanent Deletion"}),R.jsxs("p",{className:"mb-6 text-gray-600",children:["This will permanently delete the admin"," ",R.jsx("span",{className:"font-semibold"})," ","and cannot be recovered. Are you sure you want to continue?"]}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsx("button",{className:"cursor-pointer px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",onClick:()=>{at(),H(!1)},children:"Delete Permanently"}),R.jsx("button",{onClick:()=>H(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})}),ne&&R.jsx("div",{id:"popup-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:R.jsx("div",{className:"relative p-4 w-full max-w-md",children:R.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[R.jsx("button",{type:"button",className:" cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>_e(!1),children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),R.jsxs("div",{className:"cursor-pointer p-6 text-center",children:[R.jsx("svg",{className:"cursor-pointer mx-auto mb-4 text-red-600 w-14 h-14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),R.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Confirm Permanent Deletion"}),R.jsx("p",{className:"mb-6 text-gray-600",children:"This will permanently delete the admin and whose user recording and cannot be recovered. Are you sure you want to continue?"}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsx("button",{className:"cursor-pointer px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",onClick:()=>{Ft(),_e(!1)},children:"Delete Permanently"}),R.jsx("button",{onClick:()=>_e(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})})]})}const mO=()=>{const E=sB();return{login:async J=>{try{const G=await E.post("/admin/login",J);return console.log(G,"response in login"),G.message===" Login successful!"?(console.log("Login successful"),sessionStorage.setItem("token",JSON.stringify(G)),sessionStorage.setItem("channel_name",G.channel_name),sessionStorage.setItem("app_id",JSON.stringify(G.app_id)),sessionStorage.setItem("app_certificate",G.token_id),sessionStorage.setItem("adminid",JSON.stringify(G.id))):console.log("Login failed"),G}catch(G){throw console.error(G),new Error(G)}},createTeamUser:async J=>{try{const G=JSON.parse(sessionStorage.getItem("adminid")),H={...J,admin_id:G};return await E.post("/team/create",H)}catch(G){throw console.error(G),new Error(G)}},listTeamUsers:async(J,G,H,rt="")=>{try{return await E.get(`team/getuser/${J}?pagesize=${G}&offset=${H}&search=${rt}`)}catch(lt){throw console.error(lt),new Error(lt)}},getTeamUserById:async J=>{try{return await E.get(`/team/get/${J}`)}catch(G){throw console.error(G),new Error(G)}},updateTeamUser:async(J,G)=>{try{return await E.put(`/team/update/${J}`,G)}catch(H){throw console.error(H),new Error(H)}},deleteuser:async J=>{try{return console.log("Deleting user with ID:",J),await E.delete(`/team/delete/${J}`)}catch(G){console.log("error in delete user",G)}}}};function f7(){const E=S_(),{login:b}=mO(),[O,A]=Nl.useState({username:"",password:""}),[L,U]=Nl.useState(""),K=G=>{const{name:H,value:rt}=G.target;A(lt=>({...lt,[H]:rt}))},J=async G=>{if(G.preventDefault(),U(""),!O.username||!O.password){U("Please fill in all fields");return}try{console.log("data",O);const H=await b(O);console.log(H==null?void 0:H.name),localStorage.setItem("admin_name",H==null?void 0:H.name),localStorage.setItem("admin_id",H==null?void 0:H.username),localStorage.setItem("admin_limit",H==null?void 0:H.adminlimits),localStorage.setItem("admin_email",H==null?void 0:H.email),localStorage.setItem("admin_id",H==null?void 0:H.id),H.message===" Login successful!"&&E("/admindashboard"),H.message==="Your are Lock, Contact your Superadmin"?U("Your are Lock, Contact your Superadmin"):U("Invalid credentials")}catch(H){let rt=H.message||"Login failed. Please try again.";rt=rt==null?void 0:rt.replace(/^Error:\s*/,""),U(rt),console.error(H)}};return R.jsxs("div",{className:"flex flex-col md:flex-row h-screen bg-gradient-to-r from-blue-500 to-blue-700",children:[R.jsxs("div",{className:"w-full md:w-1/2 flex flex-col justify-center items-center bg-white text-blue-600 p-10 shadow-xl rounded-lg",children:[R.jsx("img",{src:Vy,alt:"Logo",className:"w-24 h-24 mb-4 animate-pulse"}),R.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Welcome Back"}),R.jsx("p",{className:"mb-6 text-lg text-gray-600",children:"Login to your Admin account"}),R.jsxs("form",{onSubmit:J,className:"w-full max-w-sm bg-gray-50 p-6 rounded-lg shadow-2xl transform transition hover:scale-105",children:[L&&R.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:L}),R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"username"}),R.jsx("input",{type:"text",name:"username",value:O.username,onChange:K,className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 shadow-sm",placeholder:"Enter your email"})]}),R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Password"}),R.jsx("input",{type:"password",name:"password",value:O.password,onChange:K,className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 shadow-sm",placeholder:"Enter your password"})]}),R.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition transform hover:scale-105 shadow-md hover:shadow-lg",children:"Login"})]})]}),R.jsx("div",{className:"hidden md:flex w-1/2 items-center justify-center p-10 animate-slide-in",children:R.jsx("img",{src:kV,alt:"Illustration",className:"max-w-full h-auto drop-shadow-xl rounded-lg"})})]})}var pB={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},pV=Nl.createContext&&Nl.createContext(pB),m7=["attr","size","title"];function E7(E,b){if(E==null)return{};var O=_7(E,b),A,L;if(Object.getOwnPropertySymbols){var U=Object.getOwnPropertySymbols(E);for(L=0;L<U.length;L++)A=U[L],!(b.indexOf(A)>=0)&&Object.prototype.propertyIsEnumerable.call(E,A)&&(O[A]=E[A])}return O}function _7(E,b){if(E==null)return{};var O={};for(var A in E)if(Object.prototype.hasOwnProperty.call(E,A)){if(b.indexOf(A)>=0)continue;O[A]=E[A]}return O}function o0(){return o0=Object.assign?Object.assign.bind():function(E){for(var b=1;b<arguments.length;b++){var O=arguments[b];for(var A in O)Object.prototype.hasOwnProperty.call(O,A)&&(E[A]=O[A])}return E},o0.apply(this,arguments)}function fV(E,b){var O=Object.keys(E);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(E);b&&(A=A.filter(function(L){return Object.getOwnPropertyDescriptor(E,L).enumerable})),O.push.apply(O,A)}return O}function c0(E){for(var b=1;b<arguments.length;b++){var O=arguments[b]!=null?arguments[b]:{};b%2?fV(Object(O),!0).forEach(function(A){g7(E,A,O[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(O)):fV(Object(O)).forEach(function(A){Object.defineProperty(E,A,Object.getOwnPropertyDescriptor(O,A))})}return E}function g7(E,b,O){return b=S7(b),b in E?Object.defineProperty(E,b,{value:O,enumerable:!0,configurable:!0,writable:!0}):E[b]=O,E}function S7(E){var b=y7(E,"string");return typeof b=="symbol"?b:b+""}function y7(E,b){if(typeof E!="object"||!E)return E;var O=E[Symbol.toPrimitive];if(O!==void 0){var A=O.call(E,b);if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return(b==="string"?String:Number)(E)}function fB(E){return E&&E.map((b,O)=>Nl.createElement(b.tag,c0({key:O},b.attr),fB(b.child)))}function T7(E){return b=>Nl.createElement(v7,o0({attr:c0({},E.attr)},b),fB(E.child))}function v7(E){var b=O=>{var{attr:A,size:L,title:U}=E,K=E7(E,m7),J=L||O.size||"1em",G;return O.className&&(G=O.className),E.className&&(G=(G?G+" ":"")+E.className),Nl.createElement("svg",o0({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},O.attr,A,K,{className:G,style:c0(c0({color:E.color||O.color},O.style),E.style),height:J,width:J,xmlns:"http://www.w3.org/2000/svg"}),U&&Nl.createElement("title",null,U),E.children)};return pV!==void 0?Nl.createElement(pV.Consumer,null,O=>b(O)):b(pB)}function b7(E){return T7({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4zm-132.9 88.7L299.3 420.7c-6.2 6.2-16.4 6.2-22.6 0L171.3 315.3c-10.1-10.1-2.9-27.3 11.3-27.3H248V176c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16v112h65.4c14.2 0 21.4 17.2 11.3 27.3z"},child:[]}]})(E)}const EO=({setusercreated:E})=>{const b=it.useRef(null),O=S_(),[A,L]=it.useState(!1),[U,K]=it.useState(!1),{updateAdmin:J,getAdminById:G}=Yy(),[H,rt]=it.useState(!1),[lt,dt]=it.useState(!1),[X,st]=it.useState(!1),[Ct,yt]=it.useState(!1),[It,Wt]=it.useState(!1),[Rt,ye]=it.useState(!1),{createTeamUser:ne}=mO(),[_e,Ne]=it.useState(""),[Ie,Xt]=it.useState(""),[Qt,Ae]=it.useState(""),[In,re]=it.useState(""),[Gt,me]=it.useState(0),[Ut,Ee]=it.useState(!1),[se,be]=it.useState(!1),[at,Ft]=it.useState(!1),[he,jt]=it.useState(),[Zt,Lt]=it.useState({name:"",password:"",confirmPassword:"",mobilenumber:"",username:"",createdby:In,Channelid:"Channelid"});it.useEffect(()=>{Ne(localStorage.getItem("admin_name")),Xt(localStorage.getItem("admin_email")),Ae(localStorage.getItem("admin_limit")),re(localStorage.getItem("admin_id")),me(localStorage.getItem("totaluser")),jt(localStorage.getItem("admin_id")),Lt({...Zt,createdby:localStorage.getItem("admin_id")})},[]),it.useEffect(()=>{const Ue=()=>{window.innerWidth>768&&rt(!1)};return window.addEventListener("resize",Ue),()=>window.removeEventListener("resize",Ue)},[]);const Kt=Ue=>{Lt({...Zt,[Ue.target.name]:Ue.target.value})};it.useEffect(()=>{(async()=>{const pr=localStorage.getItem("admin_id");try{const Di=await G(pr);Ae(Di==null?void 0:Di.adminlimits),re(Di==null?void 0:Di.username),console.log("response",Di)}catch(Di){console.log("error",Di)}})()},[]);const Re=async Ue=>{Ue.preventDefault(),console.log("Form data submitted");const{name:pr,password:Di,confirmPassword:hs,username:Li,mobilenumber:ps}=Zt;if(pr&&Di&&hs&&Li)if(Di===hs){console.log("Form submitted:",Zt);try{const rr=await ne(Zt);console.log(rr,"Response in create new user"),rr.message===" Team created successfully!"&&(console.log("User created successfully"),ws.fire({title:"Success!",text:"User Added Successfully!",icon:"success"}),yt(!1),E(!0))}catch(rr){console.error(rr.message),ws.fire({icon:"error",title:"Oops...",text:rr.message})}}else ws.fire({icon:"error",title:"Oops...",text:"Password Does Not Match"});else ws.fire({icon:"error",title:"Oops...",text:"All Fields are Required"})},[te,ce]=it.useState({password:"",conformpassword:""}),ie=async()=>{if(te.password!==te.conformpassword){ws.fire({title:"Error!",text:"Passwords do not match. Please try again.",icon:"error"});return}console.log("Adminid",he);const Ue={password:te.password};console.log("Passwordreset",Ue);const pr=await J(he,Ue);console.log(pr),Ft(!1),ws.fire({title:"Successfuly!",text:"Password Reset Successfuly!",icon:"success"})},vn=()=>{b.current&&b.current.click()};return R.jsxs(R.Fragment,{children:[R.jsx("nav",{className:"bg-white shadow-md",children:R.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[R.jsxs("div",{className:"flex justify-between items-center h-16",children:[R.jsxs("div",{className:"flex items-center space-x-8",children:[R.jsx("img",{src:Vy,alt:"Logo",className:"h-8 w-auto"}),R.jsxs("div",{className:"hidden md:flex space-x-6",children:[R.jsx(Rc,{to:"/admindashboard",className:({isActive:Ue})=>Ue?"text-sm text-blue-600 px-3 py-2 font-bold ":" text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:"Home"}),R.jsx(Rc,{to:"/user",className:({isActive:Ue})=>Ue?"text-sm text-blue-600 px-3 py-2 font-bold ":" text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:"User"}),R.jsx(Rc,{to:"/calllog",className:({isActive:Ue})=>Ue?"text-sm text-blue-600 px-3 py-2 font-bold ":" text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:"Call Log"})]})]}),R.jsxs("div",{className:"flex items-center space-x-4",children:[R.jsx("button",{onClick:vn,className:"text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:R.jsx(b7,{className:"h-5 w-5"})}),R.jsx("a",{ref:b,href:"https://demoapi.deveraa.com/v1/download/app",download:"app",style:{display:"none"}}),R.jsx("button",{onClick:()=>{yt(!0),setuserModalOpen(Ue=>!Ue)},className:"cursor-pointer hidden md:inline-flex items-center bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors",children:"+ New User"}),R.jsxs("div",{className:"hidden md:flex items-center space-x-2 cursor-pointer",onClick:()=>st(!X),children:[R.jsx("img",{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSqf0Wx4wmsKfLYsiLdBx6H4D8bwQBurWhx5g&s",alt:"User profile",className:"h-8 w-8 rounded-full"}),R.jsx("span",{className:"text-gray-600 text-sm",children:_e})]}),R.jsx("button",{onClick:()=>rt(!H),className:"md:hidden text-gray-500 hover:text-gray-700 focus:outline-none",children:R.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]}),H&&R.jsxs("div",{className:"md:hidden pb-4 space-y-2",children:[R.jsx(Rc,{to:"/admindashboard",className:({isActive:Ue})=>Ue?"text-sm text-blue-600 px-3 py-2 font-bold ":" text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:"Home"}),R.jsx(Rc,{to:"/user",className:({isActive:Ue})=>Ue?"text-sm text-blue-600 px-3 py-2 font-bold ":" text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:"User"}),R.jsx(Rc,{to:"/calllog",className:({isActive:Ue})=>Ue?"text-sm text-blue-600 px-3 py-2 font-bold ":" text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:"Call Log"}),R.jsx("button",{onClick:()=>{yt(!0),setuserModalOpen(Ue=>!Ue)},className:"cursor-pointer w-full my-3 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md text-base font-medium transition-colors",children:"+ New User"}),R.jsxs("div",{className:"flex md:hidden items-center space-x-2 cursor-pointer",onClick:()=>st(!X),children:[R.jsx("img",{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSqf0Wx4wmsKfLYsiLdBx6H4D8bwQBurWhx5g&s",alt:"User profile",className:"h-8 w-8 rounded-full"}),R.jsx("span",{className:"text-gray-600 text-sm",children:_e})]})]})]})}),X&&R.jsx("div",{className:"fixed right-4 md:right-8 top-16 z-50 transition-all duration-300 ease-out",children:R.jsx("div",{className:"w-80 max-w-[90vw] border border-gray-200 rounded-xl bg-white shadow-xl overflow-hidden transform hover:shadow-2xl transition-shadow duration-300",children:R.jsxs("div",{className:"px-6 py-4",children:[R.jsxs("div",{className:"flex flex-col items-start space-y-2",children:[R.jsx("h3",{className:"text-2xl font-bold text-blue-500",children:_e}),R.jsx("span",{className:"px-3 py-1 rounded-full bg-white/20 text-sm text-blue-500 font-medium tracking-wide",children:"Admin"})]}),R.jsxs("div",{className:"space-y-4",children:[R.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg transition-colors",children:[R.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),R.jsx("span",{className:"text-gray-700 font-medium",children:In})]}),R.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg transition-colors",children:[R.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),R.jsxs("span",{className:"text-gray-700 font-medium",children:[Qt!=null?Qt+" ":"Not Added","Users Limit"]})]})]}),R.jsxs("div",{className:"mt-8 space-y-4",children:[R.jsxs("button",{onClick:()=>be(!0),className:"w-full flex items-center justify-center space-x-2 py-3 px-6 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-all duration-300 shadow-md hover:shadow-lg",children:[R.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[R.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),R.jsx("polyline",{points:"16 17 21 12 16 7"}),R.jsx("line",{x1:"21",x2:"9",y1:"12",y2:"12"})]}),R.jsx("span",{className:"font-semibold",children:"Log Out"})]}),R.jsx("div",{className:"text-center pt-2",children:R.jsx("a",{onClick:()=>Ft(!0),className:"text-blue-600 hover:text-blue-700 text-sm font-medium transition-colors duration-300 hover:underline",children:"Forgot Password?"})})]})]})})}),Ct&&R.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/30 backdrop-blur-sm z-50 animate-fadeIn",children:R.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-2xl w-[500px] max-w-[95%] border border-gray-100 animate-scaleIn",children:[R.jsxs("div",{className:"flex justify-between items-center pb-4 mb-4 border-b border-gray-200",children:[R.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Add New User"}),R.jsx("button",{onClick:()=>{yt(!1),setuserModalOpen(Ue=>!Ue)},className:"cursor-pointer text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),R.jsxs("form",{className:"space-y-4",onSubmit:Re,children:[R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),R.jsx("input",{type:"text",name:"name",required:!0,placeholder:"Enter full name",onChange:Kt,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),R.jsx("input",{type:"text",name:"mobilenumber",pattern:"\\d{10}",maxLength:"10",inputMode:"numeric",placeholder:"Phone number",onChange:Kt,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs("div",{className:"relative",children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),R.jsx("input",{type:It?"text":"password",name:"password",required:!0,placeholder:"Create password",onChange:Kt,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),R.jsx("button",{type:"button",onClick:()=>Wt(!It),className:" cursor-pointer absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:It?R.jsx(Ol,{className:"h-5 w-5"}):R.jsx(Cc,{className:"h-5 w-5"})})]}),R.jsxs("div",{className:"relative",children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),R.jsx("input",{type:Rt?"text":"password",name:"confirmPassword",required:!0,placeholder:"Confirm password",onChange:Kt,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),R.jsx("button",{type:"button",onClick:()=>ye(!Rt),className:"cursor-pointer absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:Rt?R.jsx(Ol,{className:"h-5 w-5"}):R.jsx(Cc,{className:"h-5 w-5"})})]})]}),R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),R.jsx("input",{type:"text",required:!0,name:"username",placeholder:"Username",onChange:Kt,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Channel Name"}),R.jsx("input",{type:"text",readOnly:!0,value:sessionStorage.getItem("channel_name"),name:"Channelid",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),R.jsx("div",{className:"grid grid-cols-2 gap-4"}),R.jsx("button",{type:"submit",className:"cursor-pointer w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-medium hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg active:scale-95 transform mt-4",children:"Add User"})]})]})}),Ut&&R.jsx("div",{id:"popup-modal",className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:R.jsx("div",{className:"relative p-4 w-full max-w-md",children:R.jsx("div",{className:"relative bg-white rounded-lg shadow-lg",children:R.jsxs("div",{onClick:()=>Ee(!1),className:"p-6 text-center",children:[R.jsx("svg",{className:"mx-auto mb-4 text-red-600 w-14 h-14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),R.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"User Limit Reached"}),R.jsx("p",{className:"mb-6 text-gray-600",children:"You have reached your limit to create a user. Please contact your SuperUser."}),R.jsx("button",{onClick:()=>Ee(!1),className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"OK"})]})})})}),se&&R.jsx("div",{id:"logout-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:R.jsx("div",{className:"relative p-4 w-full max-w-md",children:R.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[R.jsx("button",{type:"button",className:"cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>be(!1),children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),R.jsxs("div",{className:"p-6 text-center",children:[R.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Do you want to logout?"}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsx("button",{className:"cursor-pointer px-6 py-2 text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",onClick:()=>O("/adminlogin"),children:"Yes"}),R.jsx("button",{onClick:()=>be(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})}),at&&R.jsx("div",{id:"password-reset-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:R.jsx("div",{className:"relative p-4 w-full max-w-md",children:R.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg p-6",children:[R.jsx("button",{type:"button",className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>Ft(!1),children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),R.jsxs("div",{className:"text-center",children:[R.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Reset Password"}),R.jsxs("div",{className:"mb-4 relative",children:[R.jsx("input",{type:A?"text":"password",onChange:Ue=>ce({...te,password:Ue.target.value}),placeholder:"New Password",className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),R.jsx("button",{type:"button",className:"absolute inset-y-0 right-3 flex items-center text-gray-500 hover:text-gray-700",onClick:()=>L(!A),children:A?R.jsx(Ol,{className:"w-5 h-5"}):R.jsx(Cc,{className:"w-5 h-5"})})]}),R.jsxs("div",{className:"mb-6 relative",children:[R.jsx("input",{type:U?"text":"password",onChange:Ue=>ce({...te,conformpassword:Ue.target.value}),placeholder:"Confirm New Password",className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),R.jsx("button",{type:"button",className:"absolute inset-y-0 right-3 flex items-center text-gray-500 hover:text-gray-700",onClick:()=>K(!U),children:U?R.jsx(Ol,{className:"w-5 h-5"}):R.jsx(Cc,{className:"w-5 h-5"})})]}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsx("button",{className:"px-6 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors",onClick:ie,children:"Reset Password"}),R.jsx("button",{onClick:()=>Ft(!1),className:"px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})})]})};var i0={exports:{}},R7=i0.exports,mV;function C7(){return mV||(mV=1,function(E,b){(function(O,A){E.exports=A()})(R7,function(){function O(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var A=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof PI<"u"?PI:typeof self<"u"?self:{};function L(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var U=function(t){try{return!!t()}catch{return!0}},K=!U(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),J=K,G=Function.prototype,H=G.call,rt=J&&G.bind.bind(H,H),lt=J?rt:function(t){return function(){return H.apply(t,arguments)}},dt=lt({}.isPrototypeOf),X=function(t){return t&&t.Math==Math&&t},st=X(typeof globalThis=="object"&&globalThis)||X(typeof window=="object"&&window)||X(typeof self=="object"&&self)||X(typeof A=="object"&&A)||function(){return this}()||A||Function("return this")(),Ct=K,yt=Function.prototype,It=yt.apply,Wt=yt.call,Rt=typeof Reflect=="object"&&Reflect.apply||(Ct?Wt.bind(It):function(){return Wt.apply(It,arguments)}),ye=lt,ne=ye({}.toString),_e=ye("".slice),Ne=function(t){return _e(ne(t),8,-1)},Ie=Ne,Xt=lt,Qt=function(t){if(Ie(t)==="Function")return Xt(t)},Ae=typeof document=="object"&&document.all,In={all:Ae,IS_HTMLDDA:Ae===void 0&&Ae!==void 0},re=In.all,Gt=In.IS_HTMLDDA?function(t){return typeof t=="function"||t===re}:function(t){return typeof t=="function"},me={},Ut=!U(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Ee=K,se=Function.prototype.call,be=Ee?se.bind(se):function(){return se.apply(se,arguments)},at={},Ft={}.propertyIsEnumerable,he=Object.getOwnPropertyDescriptor,jt=he&&!Ft.call({1:2},1);at.f=jt?function(t){var e=he(this,t);return!!e&&e.enumerable}:Ft;var Zt,Lt,Kt=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Re=U,te=Ne,ce=Object,ie=lt("".split),vn=Re(function(){return!ce("z").propertyIsEnumerable(0)})?function(t){return te(t)=="String"?ie(t,""):ce(t)}:ce,Ue=function(t){return t==null},pr=Ue,Di=TypeError,hs=function(t){if(pr(t))throw Di("Can't call method on "+t);return t},Li=vn,ps=hs,rr=function(t){return Li(ps(t))},fr=Gt,wc=In.all,sr=In.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:fr(t)||t===wc}:function(t){return typeof t=="object"?t!==null:fr(t)},Ur={},pn=Ur,mi=st,Ha=Gt,_a=function(t){return Ha(t)?t:void 0},bn=function(t,e){return arguments.length<2?_a(pn[t])||_a(mi[t]):pn[t]&&pn[t][e]||mi[t]&&mi[t][e]},Qn=typeof navigator<"u"&&String(navigator.userAgent)||"",Md=st,Pl=Qn,Ic=Md.process,vr=Md.Deno,Oc=Ic&&Ic.versions||vr&&vr.version,br=Oc&&Oc.v8;br&&(Lt=(Zt=br.split("."))[0]>0&&Zt[0]<4?1:+(Zt[0]+Zt[1])),!Lt&&Pl&&(!(Zt=Pl.match(/Edge\/(\d+)/))||Zt[1]>=74)&&(Zt=Pl.match(/Chrome\/(\d+)/))&&(Lt=+Zt[1]);var Wa=Lt,Os=Wa,$r=U,v_=st.String,Nc=!!Object.getOwnPropertySymbols&&!$r(function(){var t=Symbol();return!v_(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Os&&Os<41}),Lf=Nc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ys=bn,Ud=Gt,Lo=dt,jd=Object,ga=Lf?function(t){return typeof t=="symbol"}:function(t){var e=Ys("Symbol");return Ud(e)&&Lo(e.prototype,jd(t))},b_=String,Sa=function(t){try{return b_(t)}catch{return"Object"}},Pf=Gt,fh=Sa,kl=TypeError,ts=function(t){if(Pf(t))return t;throw kl(fh(t)+" is not a function")},kf=ts,Vd=Ue,xl=function(t,e){var n=t[e];return Vd(n)?void 0:kf(n)},mh=be,xf=Gt,ya=sr,mr=TypeError,en={exports:{}},Po=st,Eh=Object.defineProperty,R_=function(t,e){try{Eh(Po,t,{value:e,configurable:!0,writable:!0})}catch{Po[t]=e}return e},Mf="__core-js_shared__",Bd=st[Mf]||R_(Mf,{}),Dc=Bd;(en.exports=function(t,e){return Dc[t]||(Dc[t]=e!==void 0?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var qs=en.exports,Ns=hs,ko=Object,ar=function(t){return ko(Ns(t))},Zn=ar,Yi=lt({}.hasOwnProperty),yi=Object.hasOwn||function(t,e){return Yi(Zn(t),e)},Uf=lt,Ka=0,xo=Math.random(),Ta=Uf(1 .toString),_h=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Ta(++Ka+xo,36)},gh=qs,Sh=yi,jf=_h,Fd=Nc,Lc=Lf,Rr=st.Symbol,Cr=gh("wks"),yh=Lc?Rr.for||Rr:Rr&&Rr.withoutSetter||jf,kn=function(t){return Sh(Cr,t)||(Cr[t]=Fd&&Sh(Rr,t)?Rr[t]:yh("Symbol."+t)),Cr[t]},Gd=be,Th=sr,za=ga,Hd=xl,Ar=function(t,e){var n,i;if(xf(n=t.toString)&&!ya(i=mh(n,t))||xf(n=t.valueOf)&&!ya(i=mh(n,t)))return i;throw mr("Can't convert object to primitive value")},Wd=TypeError,Vf=kn("toPrimitive"),vh=function(t,e){if(!Th(t)||za(t))return t;var n,i=Hd(t,Vf);if(i){if(n=Gd(i,t,e),!Th(n)||za(n))return n;throw Wd("Can't convert object to primitive value")}return Ar(t)},Pc=ga,Ml=function(t){var e=vh(t,"string");return Pc(e)?e:e+""},bh=sr,Ya=st.document,Bf=bh(Ya)&&bh(Ya.createElement),Kd=function(t){return Bf?Ya.createElement(t):{}},Rh=Kd,zd=!Ut&&!U(function(){return Object.defineProperty(Rh("div"),"a",{get:function(){return 7}}).a!=7}),C_=Ut,kc=be,Ul=at,Ch=Kt,jl=rr,Mo=Ml,xc=yi,Ff=zd,Yd=Object.getOwnPropertyDescriptor;me.f=C_?Yd:function(t,e){if(t=jl(t),e=Mo(e),Ff)try{return Yd(t,e)}catch{}if(xc(t,e))return Ch(!kc(Ul.f,t,e),t[e])};var Gf=U,Vl=Gt,Ah=/#|\.prototype\./,jr=function(t,e){var n=qd[qa(t)];return n==Hf||n!=Bl&&(Vl(e)?Gf(e):!!e)},qa=jr.normalize=function(t){return String(t).replace(Ah,".").toLowerCase()},qd=jr.data={},Bl=jr.NATIVE="N",Hf=jr.POLYFILL="P",Fl=jr,Xd=ts,Wf=K,Vr=Qt(Qt.bind),Br=function(t,e){return Xd(t),e===void 0?t:Wf?Vr(t,e):function(){return t.apply(e,arguments)}},wr={},Ds=Ut&&U(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),A_=sr,wh=String,Jd=TypeError,Pi=function(t){if(A_(t))return t;throw Jd(wh(t)+" is not an object")},Ls=Ut,Kf=zd,zf=Ds,Xa=Pi,Yf=Ml,Ih=TypeError,Oh=Object.defineProperty,qf=Object.getOwnPropertyDescriptor,Ja="enumerable",Nh="configurable",Dh="writable";wr.f=Ls?zf?function(t,e,n){if(Xa(t),e=Yf(e),Xa(n),typeof t=="function"&&e==="prototype"&&"value"in n&&Dh in n&&!n[Dh]){var i=qf(t,e);i&&i[Dh]&&(t[e]=n.value,n={configurable:Nh in n?n[Nh]:i[Nh],enumerable:Ja in n?n[Ja]:i[Ja],writable:!1})}return Oh(t,e,n)}:Oh:function(t,e,n){if(Xa(t),e=Yf(e),Xa(n),Kf)try{return Oh(t,e,n)}catch{}if("get"in n||"set"in n)throw Ih("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var Xf=wr,w_=Kt,Qa=Ut?function(t,e,n){return Xf.f(t,e,w_(1,n))}:function(t,e,n){return t[e]=n,t},Qd=st,I_=Rt,Lh=Qt,O_=Gt,N_=me.f,Zd=Fl,Za=Ur,D_=Br,Mc=Qa,Jf=yi,Qf=function(t){var e=function(n,i,r){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,i)}return new t(n,i,r)}return I_(t,this,arguments)};return e.prototype=t.prototype,e},Qe=function(t,e){var n,i,r,a,c,l,u,h,p,m=t.target,g=t.global,S=t.stat,D=t.proto,w=g?Qd:S?Qd[m]:(Qd[m]||{}).prototype,N=g?Za:Za[m]||Mc(Za,m,{})[m],k=N.prototype;for(a in e)i=!(n=Zd(g?a:m+(S?".":"#")+a,t.forced))&&w&&Jf(w,a),l=N[a],i&&(u=t.dontCallGetSet?(p=N_(w,a))&&p.value:w[a]),c=i&&u?u:e[a],i&&typeof l==typeof c||(h=t.bind&&i?D_(c,Qd):t.wrap&&i?Qf(c):D&&O_(c)?Lh(c):c,(t.sham||c&&c.sham||l&&l.sham)&&Mc(h,"sham",!0),Mc(N,a,h),D&&(Jf(Za,r=m+"Prototype")||Mc(Za,r,{}),Mc(Za[r],a,c),t.real&&k&&(n||!k[a])&&Mc(k,a,c)))},Ph=Math.ceil,Zf=Math.floor,$f=Math.trunc||function(t){var e=+t;return(e>0?Zf:Ph)(e)},kh=$f,$a=function(t){var e=+t;return e!=e||e===0?0:kh(e)},Gl=$a,tm=Math.max,xh=Math.min,Hl=function(t,e){var n=Gl(t);return n<0?tm(n+e,0):xh(n,e)},Mh=$a,Uh=Math.min,$d=function(t){return t>0?Uh(Mh(t),9007199254740991):0},Uo=$d,Xs=function(t){return Uo(t.length)},em=rr,Uc=Hl,nm=Xs,jh=function(t){return function(e,n,i){var r,a=em(e),c=nm(a),l=Uc(i,c);if(t&&n!=n){for(;c>l;)if((r=a[l++])!=r)return!0}else for(;c>l;l++)if((t||l in a)&&a[l]===n)return t||l||0;return!t&&-1}},jo={includes:jh(!0),indexOf:jh(!1)},jc=jo.includes;Qe({target:"Array",proto:!0,forced:U(function(){return!Array(1).includes()})},{includes:function(t){return jc(this,t,arguments.length>1?arguments[1]:void 0)}});var im=Ur,Er=function(t){return im[t+"Prototype"]},rm=Er("Array").includes,sm=sr,Vh=Ne,tu=kn("match"),eu=function(t){var e;return sm(t)&&((e=t[tu])!==void 0?!!e:Vh(t)=="RegExp")},am=eu,Bh=TypeError,om={};om[kn("toStringTag")]="z";var nu=String(om)==="[object z]",Fh=nu,L_=Gt,iu=Ne,es=kn("toStringTag"),Wl=Object,Kl=iu(function(){return arguments}())=="Arguments",Ps=Fh?iu:function(t){var e,n,i;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(r,a){try{return r[a]}catch{}}(e=Wl(t),es))=="string"?n:Kl?iu(e):(i=iu(e))=="Object"&&L_(e.callee)?"Arguments":i},cm=Ps,lm=String,Ir=function(t){if(cm(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return lm(t)},dm=kn("match"),P_=Qe,Vc=function(t){if(am(t))throw Bh("The method doesn't accept regular expressions");return t},Gh=hs,Bc=Ir,ru=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[dm]=!1,"/./"[t](e)}catch{}}return!1},Hh=lt("".indexOf);P_({target:"String",proto:!0,forced:!ru("includes")},{includes:function(t){return!!~Hh(Bc(Gh(this)),Bc(Vc(t)),arguments.length>1?arguments[1]:void 0)}});var Vo=Er("String").includes,Bo=dt,Wh=rm,Kh=Vo,ks=Array.prototype,su=String.prototype,um=function(t){var e=t.includes;return t===ks||Bo(ks,t)&&e===ks.includes?Wh:typeof t=="string"||t===su||Bo(su,t)&&e===su.includes?Kh:e},At=L(um),Xy=ts,Jy=ar,Qy=vn,hm=Xs,pm=TypeError,zh=function(t){return function(e,n,i,r){Xy(n);var a=Jy(e),c=Qy(a),l=hm(a),u=t?l-1:0,h=t?-1:1;if(i<2)for(;;){if(u in c){r=c[u],u+=h;break}if(u+=h,t?u<0:l<=u)throw pm("Reduce of empty array with no initial value")}for(;t?u>=0:l>u;u+=h)u in c&&(r=n(r,c[u],u,a));return r}},xs={left:zh(!1)},fs=U,va=function(t,e){var n=[][t];return!!n&&fs(function(){n.call(null,e||function(){return 1},1)})},to=typeof process<"u"&&Ne(process)=="process",au=xs.left;Qe({target:"Array",proto:!0,forced:!to&&Wa>79&&Wa<83||!va("reduce")},{reduce:function(t){var e=arguments.length;return au(this,t,e,e>1?arguments[1]:void 0)}});var ou=Er("Array").reduce,Yh=dt,eo=ou,cu=Array.prototype,Js=function(t){var e=t.reduce;return t===cu||Yh(cu,t)&&e===cu.reduce?eo:e},no=Js,ms=L(no),Or=Ne,Qs=Array.isArray||function(t){return Or(t)=="Array"},Fc=Qe,lu=Qs,zl=lt([].reverse),ns=[1,2];Fc({target:"Array",proto:!0,forced:String(ns)===String(ns.reverse())},{reverse:function(){return lu(this)&&(this.length=this.length),zl(this)}});var Es=Er("Array").reverse,Fo=dt,qi=Es,Fr=Array.prototype,zn=function(t){var e=t.reverse;return t===Fr||Fo(Fr,t)&&e===Fr.reverse?qi:e},qh=zn,du=L(qh),Xh=_h,_r=qs("keys"),ki=function(t){return _r[t]||(_r[t]=Xh(t))},On=!U(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Ms=yi,Zs=Gt,Gc=ar,y=On,I=ki("IE_PROTO"),j=Object,Q=j.prototype,Tt=y?j.getPrototypeOf:function(t){var e=Gc(t);if(Ms(e,I))return e[I];var n=e.constructor;return Zs(n)&&e instanceof n?n.prototype:e instanceof j?Q:null},oe=lt,ze=ts,Sn=Gt,ri=String,Go=TypeError,Hc=function(t,e,n){try{return oe(ze(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},Zy=Pi,Jh=function(t){if(typeof t=="object"||Sn(t))return t;throw Go("Can't set "+ri(t)+" as a prototype")},$y=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Hc(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(i,r){return Zy(i),Jh(r),e?t(i,r):i.__proto__=r,i}}():void 0),Ho={},Wc={},uu=yi,Qh=rr,fm=jo.indexOf,tT=Wc,k_=lt([].push),Kc=function(t,e){var n,i=Qh(t),r=0,a=[];for(n in i)!uu(tT,n)&&uu(i,n)&&k_(a,n);for(;e.length>r;)uu(i,n=e[r++])&&(~fm(a,n)||k_(a,n));return a},mm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],hu=Kc,Em=mm.concat("length","prototype");Ho.f=Object.getOwnPropertyNames||function(t){return hu(t,Em)};var pu={};pu.f=Object.getOwnPropertySymbols;var x_=bn,M_=Ho,$s=pu,io=Pi,zc=lt([].concat),eT=x_("Reflect","ownKeys")||function(t){var e=M_.f(io(t)),n=$s.f;return n?zc(e,n(t)):e},Wo=yi,Ko=eT,or=me,_m=wr,U_={},g0=Kc,S0=mm,xi=Object.keys||function(t){return g0(t,S0)},j_=Ut,Zh=Ds,$h=wr,V_=Pi,fu=rr,mu=xi;U_.f=j_&&!Zh?Object.defineProperties:function(t,e){V_(t);for(var n,i=fu(e),r=mu(e),a=r.length,c=0;a>c;)$h.f(t,n=r[c++],i[n]);return t};var gm,B_=bn("document","documentElement"),y0=Pi,nT=U_,Yc=mm,F_=Wc,Sm=B_,iT=Kd,ro="prototype",rn="script",Yn=ki("IE_PROTO"),Mi=function(){},tp=function(t){return"<"+rn+">"+t+"</"+rn+">"},Yl=function(t){t.write(tp("")),t.close();var e=t.parentWindow.Object;return t=null,e},so=function(){try{gm=new ActiveXObject("htmlfile")}catch{}var t,e,n;so=typeof document<"u"?document.domain&&gm?Yl(gm):(e=iT("iframe"),n="java"+rn+":",e.style.display="none",Sm.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(tp("document.F=Object")),t.close(),t.F):Yl(gm);for(var i=Yc.length;i--;)delete so[ro][Yc[i]];return so()};F_[Yn]=!0;var qc=Object.create||function(t,e){var n;return t!==null?(Mi[ro]=y0(t),n=new Mi,Mi[ro]=null,n[Yn]=t):n=so(),e===void 0?n:nT.f(n,e)},ep=sr,Eu=Qa,rT=Error,Bi=lt("".replace),G_=String(rT("zxcasd").stack),ym=/\n\s*at [^:]*:[^\n]*/,sT=ym.test(G_),aT=Kt,T0=!U(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",aT(1,7)),t.stack!==7)}),H_=Qa,W_=function(t,e){if(sT&&typeof t=="string"&&!rT.prepareStackTrace)for(;e--;)t=Bi(t,ym,"");return t},K_=T0,is=Error.captureStackTrace,di={},Tm=di,np=kn("iterator"),vm=Array.prototype,bm=function(t){return t!==void 0&&(Tm.Array===t||vm[np]===t)},zo=Ps,ip=xl,z_=Ue,Y_=di,oT=kn("iterator"),rp=function(t){if(!z_(t))return ip(t,oT)||ip(t,"@@iterator")||Y_[zo(t)]},cT=be,lT=ts,dT=Pi,uT=Sa,q_=rp,hT=TypeError,X_=function(t,e){var n=arguments.length<2?q_(t):e;if(lT(n))return dT(cT(n,t));throw hT(uT(t)+" is not iterable")},pT=be,J_=Pi,fT=xl,Rm=function(t,e,n){var i,r;J_(t);try{if(!(i=fT(t,"return"))){if(e==="throw")throw n;return n}i=pT(i,t)}catch(a){r=!0,i=a}if(e==="throw")throw n;if(r)throw i;return J_(i),n},mT=Br,ET=be,_T=Pi,gT=Sa,ST=bm,v0=Xs,Q_=dt,_u=X_,yT=rp,sp=Rm,Cm=TypeError,ap=function(t,e){this.stopped=t,this.result=e},Am=ap.prototype,gu=function(t,e,n){var i,r,a,c,l,u,h,p=n&&n.that,m=!(!n||!n.AS_ENTRIES),g=!(!n||!n.IS_RECORD),S=!(!n||!n.IS_ITERATOR),D=!(!n||!n.INTERRUPTED),w=mT(e,p),N=function(x){return i&&sp(i,"normal",x),new ap(!0,x)},k=function(x){return m?(_T(x),D?w(x[0],x[1],N):w(x[0],x[1])):D?w(x,N):w(x)};if(g)i=t.iterator;else if(S)i=t;else{if(!(r=yT(t)))throw Cm(gT(t)+" is not iterable");if(ST(r)){for(a=0,c=v0(t);c>a;a++)if((l=k(t[a]))&&Q_(Am,l))return l;return new ap(!1)}i=_u(t,r)}for(u=g?t.next:i.next;!(h=ET(u,i)).done;){try{l=k(h.value)}catch(x){sp(i,"throw",x)}if(typeof l=="object"&&l&&Q_(Am,l))return l}return new ap(!1)},TT=Ir,vT=Qe,bT=dt,Z_=Tt,op=$y,RT=function(t,e,n){for(var i=Ko(e),r=_m.f,a=or.f,c=0;c<i.length;c++){var l=i[c];Wo(t,l)||n&&Wo(n,l)||r(t,l,a(e,l))}},wm=qc,Im=Qa,Om=Kt,b0=function(t,e){ep(e)&&"cause"in e&&Eu(t,"cause",e.cause)},$_=function(t,e,n,i){K_&&(is?is(t,e):H_(t,"stack",W_(n,i)))},CT=gu,AT=function(t,e){return t===void 0?arguments.length<2?"":e:TT(t)},tg=kn("toStringTag"),cp=Error,wT=[].push,Su=function(t,e){var n,i=bT(eg,this);op?n=op(cp(),i?Z_(this):eg):(n=i?this:wm(eg),Im(n,tg,"Error")),e!==void 0&&Im(n,"message",AT(e)),$_(n,Su,n.stack,1),arguments.length>2&&b0(n,arguments[2]);var r=[];return CT(t,wT,{that:r}),Im(n,"errors",r),n};op?op(Su,cp):RT(Su,cp,{name:!0});var eg=Su.prototype=wm(cp.prototype,{constructor:Om(1,Su),message:Om(1,""),name:Om(1,"AggregateError")});vT({global:!0},{AggregateError:Su});var lp,Yo,yu,Nm=Gt,ng=st.WeakMap,IT=Nm(ng)&&/native code/.test(String(ng)),ba=st,ql=sr,Xc=Qa,qo=yi,dp=Bd,ig=ki,OT=Wc,rg="Object already initialized",Xo=ba.TypeError,Dm=ba.WeakMap;if(IT||dp.state){var Ra=dp.state||(dp.state=new Dm);Ra.get=Ra.get,Ra.has=Ra.has,Ra.set=Ra.set,lp=function(t,e){if(Ra.has(t))throw Xo(rg);return e.facade=t,Ra.set(t,e),e},Yo=function(t){return Ra.get(t)||{}},yu=function(t){return Ra.has(t)}}else{var Xl=ig("state");OT[Xl]=!0,lp=function(t,e){if(qo(t,Xl))throw Xo(rg);return e.facade=t,Xc(t,Xl,e),e},Yo=function(t){return qo(t,Xl)?t[Xl]:{}},yu=function(t){return qo(t,Xl)}}var Jc,up,sg,Jo={set:lp,get:Yo,has:yu,enforce:function(t){return yu(t)?Yo(t):lp(t,{})},getterFor:function(t){return function(e){var n;if(!ql(e)||(n=Yo(e)).type!==t)throw Xo("Incompatible receiver, "+t+" required");return n}}},Lm=Ut,NT=yi,DT=Function.prototype,LT=Lm&&Object.getOwnPropertyDescriptor,cr=NT(DT,"name"),gr={PROPER:cr&&(function(){}).name==="something",CONFIGURABLE:cr&&(!Lm||Lm&&LT(DT,"name").configurable)},PT=Qa,Qo=function(t,e,n,i){return i&&i.enumerable?t[e]=n:PT(t,e,n),t},kT=U,xT=Gt,MT=sr,hp=qc,Pm=Tt,UT=Qo,km=kn("iterator"),ag=!1;[].keys&&("next"in(sg=[].keys())?(up=Pm(Pm(sg)))!==Object.prototype&&(Jc=up):ag=!0);var og=!MT(Jc)||kT(function(){var t={};return Jc[km].call(t)!==t});xT((Jc=og?{}:hp(Jc))[km])||UT(Jc,km,function(){return this});var xm={IteratorPrototype:Jc,BUGGY_SAFARI_ITERATORS:ag},cg=Ps,jT=nu?{}.toString:function(){return"[object "+cg(this)+"]"},lg=nu,dg=wr.f,ug=Qa,VT=yi,hg=jT,pg=kn("toStringTag"),Gr=function(t,e,n,i){if(t){var r=n?t:t.prototype;VT(r,pg)||dg(r,pg,{configurable:!0,value:e}),i&&!lg&&ug(r,"toString",hg)}},fg=xm.IteratorPrototype,R0=qc,BT=Kt,mg=Gr,Jl=di,Zo=function(){return this},ao=function(t,e,n,i){var r=e+" Iterator";return t.prototype=R0(fg,{next:BT(+!i,n)}),mg(t,r,!1,!0),Jl[r]=Zo,t},$o=Qe,Eg=be,_g=gr,pp=ao,Mm=Tt,Ql=Gr,Nr=Qo,fp=di,FT=xm,Qc=_g.PROPER,Tu=FT.BUGGY_SAFARI_ITERATORS,mp=kn("iterator"),tc="keys",Ca="values",vu="entries",gg=function(){return this},Um=function(t,e,n,i,r,a,c){pp(n,e,i);var l,u,h,p=function(k){if(k===r&&w)return w;if(!Tu&&k in S)return S[k];switch(k){case tc:case Ca:case vu:return function(){return new n(this,k)}}return function(){return new n(this)}},m=e+" Iterator",g=!1,S=t.prototype,D=S[mp]||S["@@iterator"]||r&&S[r],w=!Tu&&D||p(r),N=e=="Array"&&S.entries||D;if(N&&(l=Mm(N.call(new t)))!==Object.prototype&&l.next&&(Ql(l,m,!0,!0),fp[m]=gg),Qc&&r==Ca&&D&&D.name!==Ca&&(g=!0,w=function(){return Eg(D,this)}),r)if(u={values:p(Ca),keys:a?w:p(tc),entries:p(vu)},c)for(h in u)(Tu||g||!(h in S))&&Nr(S,h,u[h]);else $o({target:e,proto:!0,forced:Tu||g},u);return c&&S[mp]!==w&&Nr(S,mp,w,{}),fp[e]=w,u},Zl=function(t,e){return{value:t,done:e}},Ep=rr,Sg=di,yg=Jo;wr.f;var _p=Um,ec=Zl,Tg="Array Iterator",GT=yg.set,$l=yg.getterFor(Tg);_p(Array,"Array",function(t,e){GT(this,{type:Tg,target:Ep(t),index:0,kind:e})},function(){var t=$l(this),e=t.target,n=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,ec(void 0,!0)):ec(n=="keys"?i:n=="values"?e[i]:[i,e[i]],!1)},"values"),Sg.Arguments=Sg.Array;var Us=wr,gp=function(t,e,n){return Us.f(t,e,n)},HT=bn,WT=gp,vg=Ut,jm=kn("species"),Vm=dt,nc=TypeError,Ti=function(t,e){if(Vm(e,t))return t;throw nc("Incorrect invocation")},bg=Gt,Bm=Bd,Sr=lt(Function.toString);bg(Bm.inspectSource)||(Bm.inspectSource=function(t){return Sr(t)});var Rg=Bm.inspectSource,C0=lt,KT=U,Cg=Gt,Xi=Ps,js=Rg,oo=function(){},zT=[],Ag=bn("Reflect","construct"),wg=/^\s*(?:class|function)\b/,Ig=C0(wg.exec),ta=!wg.exec(oo),rs=function(t){if(!Cg(t))return!1;try{return Ag(oo,zT,t),!0}catch{return!1}},Og=function(t){if(!Cg(t))return!1;switch(Xi(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return ta||!!Ig(wg,js(t))}catch{return!0}};Og.sham=!0;var Hr,td,co,Zc,Aa=!Ag||KT(function(){var t;return rs(rs.call)||!rs(Object)||!rs(function(){t=!0})||t})?Og:rs,Ng=Aa,Dg=Sa,$c=TypeError,Lg=Pi,bu=function(t){if(Ng(t))return t;throw $c(Dg(t)+" is not a constructor")},Sp=Ue,yp=kn("species"),tl=function(t,e){var n,i=Lg(t).constructor;return i===void 0||Sp(n=Lg(i)[yp])?e:bu(n)},Tp=lt([].slice),YT=TypeError,lo=function(t,e){if(t<e)throw YT("Not enough arguments");return t},Pg=/(?:ipad|iphone|ipod).*applewebkit/i.test(Qn),Wr=st,qT=Rt,A0=Br,Vs=Gt,kg=yi,ic=U,xg=B_,Fm=Tp,el=Kd,XT=lo,Mg=Pg,Ug=to,wa=Wr.setImmediate,Gm=Wr.clearImmediate,Hm=Wr.process,ed=Wr.Dispatch,Ri=Wr.Function,JT=Wr.MessageChannel,w0=Wr.String,Wm=0,vp={},QT="onreadystatechange";ic(function(){Hr=Wr.location});var Ei=function(t){if(kg(vp,t)){var e=vp[t];delete vp[t],e()}},$n=function(t){return function(){Ei(t)}},fn=function(t){Ei(t.data)},Rn=function(t){Wr.postMessage(w0(t),Hr.protocol+"//"+Hr.host)};wa&&Gm||(wa=function(t){XT(arguments.length,1);var e=Vs(t)?t:Ri(t),n=Fm(arguments,1);return vp[++Wm]=function(){qT(e,void 0,n)},td(Wm),Wm},Gm=function(t){delete vp[t]},Ug?td=function(t){Hm.nextTick($n(t))}:ed&&ed.now?td=function(t){ed.now($n(t))}:JT&&!Mg?(Zc=(co=new JT).port2,co.port1.onmessage=fn,td=A0(Zc.postMessage,Zc)):Wr.addEventListener&&Vs(Wr.postMessage)&&!Wr.importScripts&&Hr&&Hr.protocol!=="file:"&&!ic(Rn)?(td=Rn,Wr.addEventListener("message",fn,!1)):td=QT in el("script")?function(t){xg.appendChild(el("script"))[QT]=function(){xg.removeChild(this),Ei(t)}}:function(t){setTimeout($n(t),0)});var qn={set:wa,clear:Gm},_s=function(){this.head=null,this.tail=null};_s.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var gs,nl,bp,Ia,Ci,rc=_s,nd=/ipad|iphone|ipod/i.test(Qn)&&typeof Pebble<"u",jg=/web0s(?!.*chrome)/i.test(Qn),yr=st,id=Br,Rp=me.f,ea=qn.set,Vg=rc,Bg=Pg,Km=nd,zm=jg,uo=to,Cp=yr.MutationObserver||yr.WebKitMutationObserver,il=yr.document,Ru=yr.process,Cu=yr.Promise,Ym=Rp(yr,"queueMicrotask"),rd=Ym&&Ym.value;if(!rd){var Au=new Vg,Kr=function(){var t,e;for(uo&&(t=Ru.domain)&&t.exit();e=Au.get();)try{e()}catch(n){throw Au.head&&gs(),n}t&&t.enter()};Bg||uo||zm||!Cp||!il?!Km&&Cu&&Cu.resolve?((Ia=Cu.resolve(void 0)).constructor=Cu,Ci=id(Ia.then,Ia),gs=function(){Ci(Kr)}):uo?gs=function(){Ru.nextTick(Kr)}:(ea=id(ea,yr),gs=function(){ea(Kr)}):(nl=!0,bp=il.createTextNode(""),new Cp(Kr).observe(bp,{characterData:!0}),gs=function(){bp.data=nl=!nl}),rd=function(t){Au.head||gs(),Au.add(t)}}var Fg=rd,Ji=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},rl=st.Promise,qm=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",ZT=!qm&&!to&&typeof window=="object"&&typeof document=="object",I0=st,Bs=rl,Xm=Gt,Gg=Fl,wu=Rg,$T=kn,tv=ZT,ev=qm,Ap=Wa,Jm=Bs&&Bs.prototype,O0=$T("species"),nv=Xm(I0.PromiseRejectionEvent),N0=Gg("Promise",function(){var t=wu(Bs),e=t!==String(Bs);if(!e&&Ap===66||!Jm.catch||!Jm.finally)return!0;if(!Ap||Ap<51||!/native code/.test(t)){var n=new Bs(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((n.constructor={})[O0]=i,!(n.then(function(){})instanceof i))return!0}return!e&&(tv||ev)&&!nv}),Iu={CONSTRUCTOR:N0,REJECTION_EVENT:nv},Oa={},sd=ts,Qm=TypeError,iv=function(t){var e,n;this.promise=new t(function(i,r){if(e!==void 0||n!==void 0)throw Qm("Bad Promise constructor");e=i,n=r}),this.resolve=sd(e),this.reject=sd(n)};Oa.f=function(t){return new iv(t)};var Zm,rv,sv=Qe,sc=to,ac=st,jn=be,Hg=Qo,D0=Gr,av=function(t){var e=HT(t);vg&&e&&!e[jm]&&WT(e,jm,{configurable:!0,get:function(){return this}})},L0=ts,Wg=Gt,P0=sr,$m=Ti,Ou=tl,tE=qn.set,Nu=Fg,Kg=function(t,e){try{arguments.length==1?console.error(t):console.error(t,e)}catch{}},ad=Ji,ho=rc,Du=Jo,zg=rl,Yg=Iu,qg=Oa,wp="Promise",ov=Yg.CONSTRUCTOR,Xg=Yg.REJECTION_EVENT,eE=Du.getterFor(wp),cv=Du.set,k0=zg&&zg.prototype,od=zg,Ip=k0,lv=ac.TypeError,Jg=ac.document,cd=ac.process,Qg=qg.f,dv=Qg,Cn=!!(Jg&&Jg.createEvent&&ac.dispatchEvent),nE="unhandledrejection",Op=function(t){var e;return!(!P0(t)||!Wg(e=t.then))&&e},iE=function(t,e){var n,i,r,a=e.value,c=e.state==1,l=c?t.ok:t.fail,u=t.resolve,h=t.reject,p=t.domain;try{l?(c||(e.rejection===2&&Lu(e),e.rejection=1),l===!0?n=a:(p&&p.enter(),n=l(a),p&&(p.exit(),r=!0)),n===t.promise?h(lv("Promise-chain cycle")):(i=Op(n))?jn(i,n,u,h):u(n)):h(a)}catch(m){p&&!r&&p.exit(),h(m)}},Zg=function(t,e){t.notified||(t.notified=!0,Nu(function(){for(var n,i=t.reactions;n=i.get();)iE(n,t);t.notified=!1,e&&!t.rejection&&Np(t)}))},rE=function(t,e,n){var i,r;Cn?((i=Jg.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),ac.dispatchEvent(i)):i={promise:e,reason:n},!Xg&&(r=ac["on"+t])?r(i):t===nE&&Kg("Unhandled promise rejection",n)},Np=function(t){jn(tE,ac,function(){var e,n=t.facade,i=t.value;if(Dp(t)&&(e=ad(function(){sc?cd.emit("unhandledRejection",i,n):rE(nE,n,i)}),t.rejection=sc||Dp(t)?2:1,e.error))throw e.value})},Dp=function(t){return t.rejection!==1&&!t.parent},Lu=function(t){jn(tE,ac,function(){var e=t.facade;sc?cd.emit("rejectionHandled",e):rE("rejectionhandled",e,t.value)})},ld=function(t,e,n){return function(i){t(e,i,n)}},Pu=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,Zg(t,!0))},$g=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw lv("Promise can't be resolved itself");var i=Op(e);i?Nu(function(){var r={done:!1};try{jn(i,e,ld($g,r,t),ld(Pu,r,t))}catch(a){Pu(r,a,t)}}):(t.value=e,t.state=1,Zg(t,!1))}catch(r){Pu({done:!1},r,t)}}};ov&&(Ip=(od=function(t){$m(this,Ip),L0(t),jn(Zm,this);var e=eE(this);try{t(ld($g,e),ld(Pu,e))}catch(n){Pu(e,n)}}).prototype,(Zm=function(t){cv(this,{type:wp,done:!1,notified:!1,parent:!1,reactions:new ho,rejection:!1,state:0,value:void 0})}).prototype=Hg(Ip,"then",function(t,e){var n=eE(this),i=Qg(Ou(this,od));return n.parent=!0,i.ok=!Wg(t)||t,i.fail=Wg(e)&&e,i.domain=sc?cd.domain:void 0,n.state==0?n.reactions.add(i):Nu(function(){iE(i,n)}),i.promise}),rv=function(){var t=new Zm,e=eE(t);this.promise=t,this.resolve=ld($g,e),this.reject=ld(Pu,e)},qg.f=Qg=function(t){return t===od||t===void 0?new rv(t):dv(t)}),sv({global:!0,wrap:!0,forced:ov},{Promise:od}),D0(od,wp,!1,!0),av(wp);var tS=kn("iterator"),eS=!1;try{var sE=0,Xn={next:function(){return{done:!!sE++}},return:function(){eS=!0}};Xn[tS]=function(){return this},Array.from(Xn,function(){throw 2})}catch{}var nS=rl,Dr=function(t,e){if(!eS)return!1;var n=!1;try{var i={};i[tS]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch{}return n},aE=Iu.CONSTRUCTOR||!Dr(function(t){nS.all(t).then(void 0,function(){})}),iS=be,rS=ts,oE=Oa,uv=Ji,hv=gu;Qe({target:"Promise",stat:!0,forced:aE},{all:function(t){var e=this,n=oE.f(e),i=n.resolve,r=n.reject,a=uv(function(){var c=rS(e.resolve),l=[],u=0,h=1;hv(t,function(p){var m=u++,g=!1;h++,iS(c,e,p).then(function(S){g||(g=!0,l[m]=S,--h||i(l))},r)}),--h||i(l)});return a.error&&r(a.value),n.promise}});var sS=Qe,aS=Iu.CONSTRUCTOR;rl&&rl.prototype,sS({target:"Promise",proto:!0,forced:aS,real:!0},{catch:function(t){return this.then(void 0,t)}});var x0=be,pv=ts,M0=Oa,fv=Ji,U0=gu;Qe({target:"Promise",stat:!0,forced:aE},{race:function(t){var e=this,n=M0.f(e),i=n.reject,r=fv(function(){var a=pv(e.resolve);U0(t,function(c){x0(a,e,c).then(n.resolve,i)})});return r.error&&i(r.value),n.promise}});var j0=be,oS=Oa;Qe({target:"Promise",stat:!0,forced:Iu.CONSTRUCTOR},{reject:function(t){var e=oS.f(this);return j0(e.reject,void 0,t),e.promise}});var cS=Pi,V0=sr,B0=Oa,na=function(t,e){if(cS(t),V0(e)&&e.constructor===t)return e;var n=B0.f(t);return(0,n.resolve)(e),n.promise},mv=Qe,Ev=rl,ia=Iu.CONSTRUCTOR,_v=na,cE=bn("Promise"),oc=!ia;mv({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return _v(oc&&this===cE?Ev:this,t)}});var F0=be,G0=ts,ku=Oa,gv=Ji,H0=gu;Qe({target:"Promise",stat:!0,forced:aE},{allSettled:function(t){var e=this,n=ku.f(e),i=n.resolve,r=n.reject,a=gv(function(){var c=G0(e.resolve),l=[],u=0,h=1;H0(t,function(p){var m=u++,g=!1;h++,F0(c,e,p).then(function(S){g||(g=!0,l[m]={status:"fulfilled",value:S},--h||i(l))},function(S){g||(g=!0,l[m]={status:"rejected",reason:S},--h||i(l))})}),--h||i(l)});return a.error&&r(a.value),n.promise}});var W0=be,K0=ts,z0=bn,Y0=Oa,q0=Ji,X0=gu,lS="No one promise resolved";Qe({target:"Promise",stat:!0,forced:aE},{any:function(t){var e=this,n=z0("AggregateError"),i=Y0.f(e),r=i.resolve,a=i.reject,c=q0(function(){var l=K0(e.resolve),u=[],h=0,p=1,m=!1;X0(t,function(g){var S=h++,D=!1;p++,W0(l,e,g).then(function(w){D||m||(m=!0,r(w))},function(w){D||m||(D=!0,u[S]=w,--p||a(new n(u,lS)))})}),--p||a(new n(u,lS))});return c.error&&a(c.value),i.promise}});var xu=Qe,dd=rl,Sv=U,J0=bn,Mu=Gt,Lp=tl,dS=na,lE=dd&&dd.prototype;xu({target:"Promise",proto:!0,real:!0,forced:!!dd&&Sv(function(){lE.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=Lp(this,J0("Promise")),n=Mu(t);return this.then(n?function(i){return dS(e,t()).then(function(){return i})}:t,n?function(i){return dS(e,t()).then(function(){throw i})}:t)}});var Pp=lt,uS=$a,dE=Ir,yv=hs,Tv=Pp("".charAt),vv=Pp("".charCodeAt),bv=Pp("".slice),Uu=function(t){return function(e,n){var i,r,a=dE(yv(e)),c=uS(n),l=a.length;return c<0||c>=l?t?"":void 0:(i=vv(a,c))<55296||i>56319||c+1===l||(r=vv(a,c+1))<56320||r>57343?t?Tv(a,c):i:t?bv(a,c,c+2):r-56320+(i-55296<<10)+65536}},hS={codeAt:Uu(!1),charAt:Uu(!0)},Q0=hS.charAt,Z0=Ir,kp=Jo,uE=Um,hE=Zl,Rv="String Iterator",xp=kp.set,$0=kp.getterFor(Rv);uE(String,"String",function(t){xp(this,{type:Rv,string:Z0(t),index:0})},function(){var t,e=$0(this),n=e.string,i=e.index;return i>=n.length?hE(void 0,!0):(t=Q0(n,i),e.index+=t.length,hE(t,!1))});var Cv=Ur.Promise,Av={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},wv=st,Iv=Ps,pS=Qa,fS=di,Mp=kn("toStringTag");for(var mS in Av){var Ov=wv[mS],Up=Ov&&Ov.prototype;Up&&Iv(Up)!==Mp&&pS(Up,Mp,mS),fS[mS]=fS.Array}var pE=Cv,wt=L(pE),ES=Er("Array").values,Nv=Ps,_S=yi,sl=dt,al=ES,po=Array.prototype,jp={DOMTokenList:!0,NodeList:!0},Vp=function(t){var e=t.values;return t===po||sl(po,t)&&e===po.values||_S(jp,Nv(t))?al:e},Fi=L(Vp),tC=U,Dv=kn("iterator"),ud=!tC(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2"),i="";return t.pathname="c%20d",e.forEach(function(r,a){e.delete("b"),i+=a+r}),n.delete("a",2),!t.toJSON||!n.has("a",1)||n.has("a",2)||!e.size&&!0||!e.sort||t.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[Dv]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("http://x",void 0).host!=="x"}),eC=Qo,Lv=Ml,fE=wr,Pv=Kt,mE=function(t,e,n){var i=Lv(e);i in t?fE.f(t,i,Pv(0,n)):t[i]=n},Bp=Hl,EE=Xs,kv=mE,Fp=Array,gS=Math.max,ju=function(t,e,n){for(var i=EE(t),r=Bp(e,i),a=Bp(n===void 0?i:n,i),c=Fp(gS(a-r,0)),l=0;r<a;r++,l++)kv(c,l,t[r]);return c.length=l,c},SS=ju,nC=Math.floor,Vu=function(t,e){var n=t.length,i=nC(n/2);return n<8?s(t,e):o(t,Vu(SS(t,0,i),e),Vu(SS(t,i),e),e)},s=function(t,e){for(var n,i,r=t.length,a=1;a<r;){for(i=a,n=t[a];i&&e(t[i-1],n)>0;)t[i]=t[--i];i!==a++&&(t[i]=n)}return t},o=function(t,e,n,i){for(var r=e.length,a=n.length,c=0,l=0;c<r||l<a;)t[c+l]=c<r&&l<a?i(e[c],n[l])<=0?e[c++]:n[l++]:c<r?e[c++]:n[l++];return t},d=Vu,f=Qe,_=st,v=be,V=lt,Y=Ut,tt=ud,ht=Qo,xt=gp,$t=function(t,e,n){for(var i in e)n&&n.unsafe&&t[i]?t[i]=e[i]:eC(t,i,e[i],n);return t},vt=Gr,Pt=ao,Ce=Jo,Je=Ti,vi=Gt,mt=yi,ut=Br,gt=Ps,zt=Pi,Te=sr,Me=Ir,Oe=qc,je=Kt,Qi=X_,xn=rp,Fs=lo,iC=d,_B=kn("iterator"),yS="URLSearchParams",_O=yS+"Iterator",gO=Ce.set,fo=Ce.getterFor(yS),gB=Ce.getterFor(_O),SB=Object.getOwnPropertyDescriptor,rC=function(t){if(!Y)return _[t];var e=SB(_,t);return e&&e.value},SO=rC("fetch"),xv=rC("Request"),TS=rC("Headers"),sC=xv&&xv.prototype,yO=TS&&TS.prototype,yB=_.RegExp,TB=_.TypeError,TO=_.decodeURIComponent,vB=_.encodeURIComponent,bB=V("".charAt),vO=V([].join),Gp=V([].push),aC=V("".replace),RB=V([].shift),bO=V([].splice),RO=V("".split),CB=V("".slice),AB=/\+/g,CO=Array(4),wB=function(t){return CO[t-1]||(CO[t-1]=yB("((?:%[\\da-f]{2}){"+t+"})","gi"))},IB=function(t){try{return TO(t)}catch{return t}},AO=function(t){var e=aC(t,AB," "),n=4;try{return TO(e)}catch{for(;n;)e=aC(e,wB(n--),IB);return e}},OB=/[!'()~]|%20/g,NB={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},DB=function(t){return NB[t]},wO=function(t){return aC(vB(t),OB,DB)},oC=Pt(function(t,e){gO(this,{type:_O,iterator:Qi(fo(t).entries),kind:e})},"Iterator",function(){var t=gB(this),e=t.kind,n=t.iterator.next(),i=n.value;return n.done||(n.value=e==="keys"?i.key:e==="values"?i.value:[i.key,i.value]),n},!0),IO=function(t){this.entries=[],this.url=null,t!==void 0&&(Te(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?bB(t,0)==="?"?CB(t,1):t:Me(t)))};IO.prototype={type:yS,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,i,r,a,c,l,u=xn(t);if(u)for(n=(e=Qi(t,u)).next;!(i=v(n,e)).done;){if(a=(r=Qi(zt(i.value))).next,(c=v(a,r)).done||(l=v(a,r)).done||!v(a,r).done)throw TB("Expected sequence with length 2");Gp(this.entries,{key:Me(c.value),value:Me(l.value)})}else for(var h in t)mt(t,h)&&Gp(this.entries,{key:h,value:Me(t[h])})},parseQuery:function(t){if(t)for(var e,n,i=RO(t,"&"),r=0;r<i.length;)(e=i[r++]).length&&(n=RO(e,"="),Gp(this.entries,{key:AO(RB(n)),value:AO(vO(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],i=0;i<e.length;)t=e[i++],Gp(n,wO(t.key)+"="+wO(t.value));return vO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Mv=function(){Je(this,_E);var t=gO(this,new IO(arguments.length>0?arguments[0]:void 0));Y||(this.size=t.entries.length)},_E=Mv.prototype;if($t(_E,{append:function(t,e){var n=fo(this);Fs(arguments.length,2),Gp(n.entries,{key:Me(t),value:Me(e)}),Y||this.length++,n.updateURL()},delete:function(t){for(var e=fo(this),n=Fs(arguments.length,1),i=e.entries,r=Me(t),a=n<2?void 0:arguments[1],c=a===void 0?a:Me(a),l=0;l<i.length;){var u=i[l];if(u.key!==r||c!==void 0&&u.value!==c)l++;else if(bO(i,l,1),c!==void 0)break}Y||(this.size=i.length),e.updateURL()},get:function(t){var e=fo(this).entries;Fs(arguments.length,1);for(var n=Me(t),i=0;i<e.length;i++)if(e[i].key===n)return e[i].value;return null},getAll:function(t){var e=fo(this).entries;Fs(arguments.length,1);for(var n=Me(t),i=[],r=0;r<e.length;r++)e[r].key===n&&Gp(i,e[r].value);return i},has:function(t){for(var e=fo(this).entries,n=Fs(arguments.length,1),i=Me(t),r=n<2?void 0:arguments[1],a=r===void 0?r:Me(r),c=0;c<e.length;){var l=e[c++];if(l.key===i&&(a===void 0||l.value===a))return!0}return!1},set:function(t,e){var n=fo(this);Fs(arguments.length,1);for(var i,r=n.entries,a=!1,c=Me(t),l=Me(e),u=0;u<r.length;u++)(i=r[u]).key===c&&(a?bO(r,u--,1):(a=!0,i.value=l));a||Gp(r,{key:c,value:l}),Y||(this.size=r.length),n.updateURL()},sort:function(){var t=fo(this);iC(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=fo(this).entries,i=ut(t,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((e=n[r++]).value,e.key,this)},keys:function(){return new oC(this,"keys")},values:function(){return new oC(this,"values")},entries:function(){return new oC(this,"entries")}},{enumerable:!0}),ht(_E,_B,_E.entries,{}),ht(_E,"toString",function(){return fo(this).serialize()},{enumerable:!0}),Y&&xt(_E,"size",{get:function(){return fo(this).entries.length},configurable:!0,enumerable:!0}),vt(Mv,yS),f({global:!0,forced:!tt},{URLSearchParams:Mv}),!tt&&vi(TS)){var LB=V(yO.has),PB=V(yO.set),OO=function(t){if(Te(t)){var e,n=t.body;if(gt(n)===yS)return e=t.headers?new TS(t.headers):new TS,LB(e,"content-type")||PB(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Oe(t,{body:je(0,Me(n)),headers:je(0,e)})}return t};if(vi(SO)&&f({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return SO(t,arguments.length>1?OO(arguments[1]):{})}}),vi(xv)){var cC=function(t){return Je(this,sC),new xv(t,arguments.length>1?OO(arguments[1]):{})};sC.constructor=cC,cC.prototype=sC,f({global:!0,dontCallGetSet:!0,forced:!0},{Request:cC})}}var mo,kB={URLSearchParams:Mv,getState:fo},xB=Ur.URLSearchParams,NO=Ut,MB=lt,UB=be,jB=U,lC=xi,VB=pu,BB=at,FB=ar,GB=vn,gE=Object.assign,DO=Object.defineProperty,HB=MB([].concat),WB=!gE||jB(function(){if(NO&&gE({b:1},gE(DO({},"a",{enumerable:!0,get:function(){DO(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol(),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(r){e[r]=r}),gE({},t)[n]!=7||lC(gE({},e)).join("")!=i})?function(t,e){for(var n=FB(t),i=arguments.length,r=1,a=VB.f,c=BB.f;i>r;)for(var l,u=GB(arguments[r++]),h=a?HB(lC(u),a(u)):lC(u),p=h.length,m=0;p>m;)l=h[m++],NO&&!UB(c,u,l)||(n[l]=u[l]);return n}:gE,KB=Pi,zB=Rm,YB=Br,qB=be,XB=ar,JB=function(t,e,n,i){try{return i?e(KB(n)[0],n[1]):e(n)}catch(r){zB(t,"throw",r)}},QB=bm,ZB=Aa,$B=Xs,LO=mE,t3=X_,e3=rp,PO=Array,Hp=lt,dC=2147483647,n3=/[^\0-\u007E]/,kO=/[.\u3002\uFF0E\uFF61]/g,xO="Overflow: input needs wider integers to process",MO=RangeError,i3=Hp(kO.exec),SE=Math.floor,uC=String.fromCharCode,UO=Hp("".charCodeAt),jO=Hp([].join),Bu=Hp([].push),r3=Hp("".replace),s3=Hp("".split),a3=Hp("".toLowerCase),VO=function(t){return t+22+75*(t<26)},o3=function(t,e,n){var i=0;for(t=n?SE(t/700):t>>1,t+=SE(t/e);t>455;)t=SE(t/35),i+=36;return SE(i+36*t/(t+38))},c3=function(t){var e=[];t=function(k){for(var x=[],W=0,Z=k.length;W<Z;){var $=UO(k,W++);if($>=55296&&$<=56319&&W<Z){var q=UO(k,W++);(64512&q)==56320?Bu(x,((1023&$)<<10)+(1023&q)+65536):(Bu(x,$),W--)}else Bu(x,$)}return x}(t);var n,i,r=t.length,a=128,c=0,l=72;for(n=0;n<t.length;n++)(i=t[n])<128&&Bu(e,uC(i));var u=e.length,h=u;for(u&&Bu(e,"-");h<r;){var p=dC;for(n=0;n<t.length;n++)(i=t[n])>=a&&i<p&&(p=i);var m=h+1;if(p-a>SE((dC-c)/m))throw MO(xO);for(c+=(p-a)*m,a=p,n=0;n<t.length;n++){if((i=t[n])<a&&++c>dC)throw MO(xO);if(i==a){for(var g=c,S=36;;){var D=S<=l?1:S>=l+26?26:S-l;if(g<D)break;var w=g-D,N=36-D;Bu(e,uC(VO(D+w%N))),g=SE(w/N),S+=36}Bu(e,uC(VO(g))),l=o3(c,m,h==u),c=0,h++}}c++,a++}return jO(e,"")},l3=Qe,hC=Ut,d3=ud,pC=st,BO=Br,Eo=lt,Uv=Qo,_o=gp,u3=Ti,fC=yi,mC=WB,yE=function(t){var e=XB(t),n=ZB(this),i=arguments.length,r=i>1?arguments[1]:void 0,a=r!==void 0;a&&(r=YB(r,i>2?arguments[2]:void 0));var c,l,u,h,p,m,g=e3(e),S=0;if(!g||this===PO&&QB(g))for(c=$B(e),l=n?new this(c):PO(c);c>S;S++)m=a?r(e[S],S):e[S],LO(l,S,m);else for(p=(h=t3(e,g)).next,l=n?new this:[];!(u=qB(p,h)).done;S++)m=a?JB(h,r,[u.value,S],!0):u.value,LO(l,S,m);return l.length=S,l},cc=ju,h3=hS.codeAt,p3=function(t){var e,n,i=[],r=s3(r3(a3(t),kO,"."),".");for(e=0;e<r.length;e++)n=r[e],Bu(i,i3(n3,n)?"xn--"+c3(n):n);return jO(i,".")},hd=Ir,f3=Gr,m3=lo,FO=kB,GO=Jo,E3=GO.set,jv=GO.getterFor("URL"),_3=FO.URLSearchParams,g3=FO.getState,vS=pC.URL,EC=pC.TypeError,Vv=pC.parseInt,S3=Math.floor,HO=Math.pow,go=Eo("".charAt),lc=Eo(/./.exec),bS=Eo([].join),y3=Eo(1 .toString),T3=Eo([].pop),TE=Eo([].push),_C=Eo("".replace),v3=Eo([].shift),b3=Eo("".split),RS=Eo("".slice),Bv=Eo("".toLowerCase),R3=Eo([].unshift),gC="Invalid scheme",Wp="Invalid host",WO="Invalid port",KO=/[a-z]/i,C3=/[\d+-.a-z]/i,SC=/\d/,A3=/^0x/i,w3=/^[0-7]+$/,I3=/^\d+$/,zO=/^[\da-f]+$/i,O3=/[\0\t\n\r #%/:<>?@[\\\]^|]/,N3=/[\0\t\n\r #/:<>?@[\\\]^|]/,D3=/^[\u0000-\u0020]+/,L3=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,P3=/[\t\n\r]/g,CS=function(t){var e,n,i,r;if(typeof t=="number"){for(e=[],n=0;n<4;n++)R3(e,t%256),t=S3(t/256);return bS(e,".")}if(typeof t=="object"){for(e="",i=function(a){for(var c=null,l=1,u=null,h=0,p=0;p<8;p++)a[p]!==0?(h>l&&(c=u,l=h),u=null,h=0):(u===null&&(u=p),++h);return h>l&&(c=u,l=h),c}(t),n=0;n<8;n++)r&&t[n]===0||(r&&(r=!1),i===n?(e+=n?":":"::",r=!0):(e+=y3(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},Fv={},YO=mC({},Fv,{" ":1,'"':1,"<":1,">":1,"`":1}),qO=mC({},YO,{"#":1,"?":1,"{":1,"}":1}),yC=mC({},qO,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Fu=function(t,e){var n=h3(t,0);return n>32&&n<127&&!fC(e,t)?t:encodeURIComponent(t)},Gv={ftp:21,file:null,http:80,https:443,ws:80,wss:443},AS=function(t,e){var n;return t.length==2&&lc(KO,go(t,0))&&((n=go(t,1))==":"||!e&&n=="|")},XO=function(t){var e;return t.length>1&&AS(RS(t,0,2))&&(t.length==2||(e=go(t,2))==="/"||e==="\\"||e==="?"||e==="#")},k3=function(t){return t==="."||Bv(t)==="%2e"},TC={},JO={},vC={},QO={},ZO={},bC={},$O={},tN={},Hv={},Wv={},RC={},CC={},AC={},wC={},eN={},IC={},vE={},ol={},nN={},Kp={},pd={},OC=function(t,e,n){var i,r,a,c=hd(t);if(e){if(r=this.parse(c))throw EC(r);this.searchParams=null}else{if(n!==void 0&&(i=new OC(n,!0)),r=this.parse(c,null,i))throw EC(r);(a=g3(new _3)).bindURL(this),this.searchParams=a}};OC.prototype={type:"URL",parse:function(t,e,n){var i,r,a,c,l,u=this,h=e||TC,p=0,m="",g=!1,S=!1,D=!1;for(t=hd(t),e||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,t=_C(t,D3,""),t=_C(t,L3,"$1")),t=_C(t,P3,""),i=yE(t);p<=i.length;){switch(r=i[p],h){case TC:if(!r||!lc(KO,r)){if(e)return gC;h=vC;continue}m+=Bv(r),h=JO;break;case JO:if(r&&(lc(C3,r)||r=="+"||r=="-"||r=="."))m+=Bv(r);else{if(r!=":"){if(e)return gC;m="",h=vC,p=0;continue}if(e&&(u.isSpecial()!=fC(Gv,m)||m=="file"&&(u.includesCredentials()||u.port!==null)||u.scheme=="file"&&!u.host))return;if(u.scheme=m,e)return void(u.isSpecial()&&Gv[u.scheme]==u.port&&(u.port=null));m="",u.scheme=="file"?h=wC:u.isSpecial()&&n&&n.scheme==u.scheme?h=QO:u.isSpecial()?h=tN:i[p+1]=="/"?(h=ZO,p++):(u.cannotBeABaseURL=!0,TE(u.path,""),h=nN)}break;case vC:if(!n||n.cannotBeABaseURL&&r!="#")return gC;if(n.cannotBeABaseURL&&r=="#"){u.scheme=n.scheme,u.path=cc(n.path),u.query=n.query,u.fragment="",u.cannotBeABaseURL=!0,h=pd;break}h=n.scheme=="file"?wC:bC;continue;case QO:if(r!="/"||i[p+1]!="/"){h=bC;continue}h=Hv,p++;break;case ZO:if(r=="/"){h=Wv;break}h=ol;continue;case bC:if(u.scheme=n.scheme,r==mo)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=cc(n.path),u.query=n.query;else if(r=="/"||r=="\\"&&u.isSpecial())h=$O;else if(r=="?")u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=cc(n.path),u.query="",h=Kp;else{if(r!="#"){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=cc(n.path),u.path.length--,h=ol;continue}u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=cc(n.path),u.query=n.query,u.fragment="",h=pd}break;case $O:if(!u.isSpecial()||r!="/"&&r!="\\"){if(r!="/"){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,h=ol;continue}h=Wv}else h=Hv;break;case tN:if(h=Hv,r!="/"||go(m,p+1)!="/")continue;p++;break;case Hv:if(r!="/"&&r!="\\"){h=Wv;continue}break;case Wv:if(r=="@"){g&&(m="%40"+m),g=!0,a=yE(m);for(var w=0;w<a.length;w++){var N=a[w];if(N!=":"||D){var k=Fu(N,yC);D?u.password+=k:u.username+=k}else D=!0}m=""}else if(r==mo||r=="/"||r=="?"||r=="#"||r=="\\"&&u.isSpecial()){if(g&&m=="")return"Invalid authority";p-=yE(m).length+1,m="",h=RC}else m+=r;break;case RC:case CC:if(e&&u.scheme=="file"){h=IC;continue}if(r!=":"||S){if(r==mo||r=="/"||r=="?"||r=="#"||r=="\\"&&u.isSpecial()){if(u.isSpecial()&&m=="")return Wp;if(e&&m==""&&(u.includesCredentials()||u.port!==null))return;if(c=u.parseHost(m))return c;if(m="",h=vE,e)return;continue}r=="["?S=!0:r=="]"&&(S=!1),m+=r}else{if(m=="")return Wp;if(c=u.parseHost(m))return c;if(m="",h=AC,e==CC)return}break;case AC:if(!lc(SC,r)){if(r==mo||r=="/"||r=="?"||r=="#"||r=="\\"&&u.isSpecial()||e){if(m!=""){var x=Vv(m,10);if(x>65535)return WO;u.port=u.isSpecial()&&x===Gv[u.scheme]?null:x,m=""}if(e)return;h=vE;continue}return WO}m+=r;break;case wC:if(u.scheme="file",r=="/"||r=="\\")h=eN;else{if(!n||n.scheme!="file"){h=ol;continue}if(r==mo)u.host=n.host,u.path=cc(n.path),u.query=n.query;else if(r=="?")u.host=n.host,u.path=cc(n.path),u.query="",h=Kp;else{if(r!="#"){XO(bS(cc(i,p),""))||(u.host=n.host,u.path=cc(n.path),u.shortenPath()),h=ol;continue}u.host=n.host,u.path=cc(n.path),u.query=n.query,u.fragment="",h=pd}}break;case eN:if(r=="/"||r=="\\"){h=IC;break}n&&n.scheme=="file"&&!XO(bS(cc(i,p),""))&&(AS(n.path[0],!0)?TE(u.path,n.path[0]):u.host=n.host),h=ol;continue;case IC:if(r==mo||r=="/"||r=="\\"||r=="?"||r=="#"){if(!e&&AS(m))h=ol;else if(m==""){if(u.host="",e)return;h=vE}else{if(c=u.parseHost(m))return c;if(u.host=="localhost"&&(u.host=""),e)return;m="",h=vE}continue}m+=r;break;case vE:if(u.isSpecial()){if(h=ol,r!="/"&&r!="\\")continue}else if(e||r!="?")if(e||r!="#"){if(r!=mo&&(h=ol,r!="/"))continue}else u.fragment="",h=pd;else u.query="",h=Kp;break;case ol:if(r==mo||r=="/"||r=="\\"&&u.isSpecial()||!e&&(r=="?"||r=="#")){if((l=Bv(l=m))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(u.shortenPath(),r=="/"||r=="\\"&&u.isSpecial()||TE(u.path,"")):k3(m)?r=="/"||r=="\\"&&u.isSpecial()||TE(u.path,""):(u.scheme=="file"&&!u.path.length&&AS(m)&&(u.host&&(u.host=""),m=go(m,0)+":"),TE(u.path,m)),m="",u.scheme=="file"&&(r==mo||r=="?"||r=="#"))for(;u.path.length>1&&u.path[0]==="";)v3(u.path);r=="?"?(u.query="",h=Kp):r=="#"&&(u.fragment="",h=pd)}else m+=Fu(r,qO);break;case nN:r=="?"?(u.query="",h=Kp):r=="#"?(u.fragment="",h=pd):r!=mo&&(u.path[0]+=Fu(r,Fv));break;case Kp:e||r!="#"?r!=mo&&(r=="'"&&u.isSpecial()?u.query+="%27":u.query+=r=="#"?"%23":Fu(r,Fv)):(u.fragment="",h=pd);break;case pd:r!=mo&&(u.fragment+=Fu(r,YO))}p++}},parseHost:function(t){var e,n,i;if(go(t,0)=="["){if(go(t,t.length-1)!="]"||(e=function(r){var a,c,l,u,h,p,m,g=[0,0,0,0,0,0,0,0],S=0,D=null,w=0,N=function(){return go(r,w)};if(N()==":"){if(go(r,1)!=":")return;w+=2,D=++S}for(;N();){if(S==8)return;if(N()!=":"){for(a=c=0;c<4&&lc(zO,N());)a=16*a+Vv(N(),16),w++,c++;if(N()=="."){if(c==0||(w-=c,S>6))return;for(l=0;N();){if(u=null,l>0){if(!(N()=="."&&l<4))return;w++}if(!lc(SC,N()))return;for(;lc(SC,N());){if(h=Vv(N(),10),u===null)u=h;else{if(u==0)return;u=10*u+h}if(u>255)return;w++}g[S]=256*g[S]+u,++l!=2&&l!=4||S++}if(l!=4)return;break}if(N()==":"){if(w++,!N())return}else if(N())return;g[S++]=a}else{if(D!==null)return;w++,D=++S}}if(D!==null)for(p=S-D,S=7;S!=0&&p>0;)m=g[S],g[S--]=g[D+p-1],g[D+--p]=m;else if(S!=8)return;return g}(RS(t,1,-1)),!e))return Wp;this.host=e}else if(this.isSpecial()){if(t=p3(t),lc(O3,t)||(e=function(r){var a,c,l,u,h,p,m,g=b3(r,".");if(g.length&&g[g.length-1]==""&&g.length--,(a=g.length)>4)return r;for(c=[],l=0;l<a;l++){if((u=g[l])=="")return r;if(h=10,u.length>1&&go(u,0)=="0"&&(h=lc(A3,u)?16:8,u=RS(u,h==8?1:2)),u==="")p=0;else{if(!lc(h==10?I3:h==8?w3:zO,u))return r;p=Vv(u,h)}TE(c,p)}for(l=0;l<a;l++)if(p=c[l],l==a-1){if(p>=HO(256,5-a))return null}else if(p>255)return null;for(m=T3(c),l=0;l<c.length;l++)m+=c[l]*HO(256,3-l);return m}(t),e===null))return Wp;this.host=e}else{if(lc(N3,t))return Wp;for(e="",n=yE(t),i=0;i<n.length;i++)e+=Fu(n[i],Fv);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return fC(Gv,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme=="file"&&e==1&&AS(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,i=t.password,r=t.host,a=t.port,c=t.path,l=t.query,u=t.fragment,h=e+":";return r!==null?(h+="//",t.includesCredentials()&&(h+=n+(i?":"+i:"")+"@"),h+=CS(r),a!==null&&(h+=":"+a)):e=="file"&&(h+="//"),h+=t.cannotBeABaseURL?c[0]:c.length?"/"+bS(c,"/"):"",l!==null&&(h+="?"+l),u!==null&&(h+="#"+u),h},setHref:function(t){var e=this.parse(t);if(e)throw EC(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t=="blob")try{return new bE(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+CS(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(hd(t)+":",TC)},getUsername:function(){return this.username},setUsername:function(t){var e=yE(hd(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=Fu(e[n],yC)}},getPassword:function(){return this.password},setPassword:function(t){var e=yE(hd(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=Fu(e[n],yC)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?CS(t):CS(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,RC)},getHostname:function(){var t=this.host;return t===null?"":CS(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,CC)},getPort:function(){var t=this.port;return t===null?"":hd(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=hd(t))==""?this.port=null:this.parse(t,AC))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+bS(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,vE))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=hd(t))==""?this.query=null:(go(t,0)=="?"&&(t=RS(t,1)),this.query="",this.parse(t,Kp)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=hd(t))!=""?(go(t,0)=="#"&&(t=RS(t,1)),this.fragment="",this.parse(t,pd)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var bE=function(t){var e=u3(this,Gs),n=m3(arguments.length,1)>1?arguments[1]:void 0,i=E3(e,new OC(t,!1,n));hC||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},Gs=bE.prototype,So=function(t,e){return{get:function(){return jv(this)[t]()},set:e&&function(n){return jv(this)[e](n)},configurable:!0,enumerable:!0}};if(hC&&(_o(Gs,"href",So("serialize","setHref")),_o(Gs,"origin",So("getOrigin")),_o(Gs,"protocol",So("getProtocol","setProtocol")),_o(Gs,"username",So("getUsername","setUsername")),_o(Gs,"password",So("getPassword","setPassword")),_o(Gs,"host",So("getHost","setHost")),_o(Gs,"hostname",So("getHostname","setHostname")),_o(Gs,"port",So("getPort","setPort")),_o(Gs,"pathname",So("getPathname","setPathname")),_o(Gs,"search",So("getSearch","setSearch")),_o(Gs,"searchParams",So("getSearchParams")),_o(Gs,"hash",So("getHash","setHash"))),Uv(Gs,"toJSON",function(){return jv(this).serialize()},{enumerable:!0}),Uv(Gs,"toString",function(){return jv(this).serialize()},{enumerable:!0}),vS){var iN=vS.createObjectURL,rN=vS.revokeObjectURL;iN&&Uv(bE,"createObjectURL",BO(iN,vS)),rN&&Uv(bE,"revokeObjectURL",BO(rN,vS))}f3(bE,"URL"),l3({global:!0,forced:!d3,sham:!hC},{URL:bE});var x3=Qe,M3=U,U3=lo,sN=Ir,j3=ud,aN=bn("URL");x3({target:"URL",stat:!0,forced:!(j3&&M3(function(){aN.canParse()}))},{canParse:function(t){var e=U3(arguments.length,1),n=sN(t),i=e<2||arguments[1]===void 0?void 0:sN(arguments[1]);try{return!!new aN(n,i)}catch{return!1}}});var Kv=L(Ur.URL);let oN=!0,cN=!0;function zv(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function zp(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(c,l){if(c!==e)return r.apply(this,arguments);const u=h=>{const p=n(h);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,u),r.apply(this,[c,u])};const a=i.removeEventListener;i.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return a.apply(this,arguments);if(!this._eventMap[e].has(l))return a.apply(this,arguments);const u=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[c,u])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function V3(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(oN=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function B3(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(cN=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function lN(){if(typeof window=="object"){if(oN)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function NC(t,e){cN&&console.warn(t+" is deprecated, please use "+e+" instead.")}function dN(t){return Object.prototype.toString.call(t)==="[object Object]"}function uN(t){var e;return dN(t)?ms(e=Object.keys(t)).call(e,function(n,i){const r=dN(t[i]),a=r?uN(t[i]):t[i],c=r&&!Object.keys(a).length;return a===void 0||c?n:Object.assign(n,{[i]:a})},{}):t}function DC(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?DC(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{DC(t,t.get(r),n)})}))}function hN(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const a=[];return t.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&a.push(c)}),a.forEach(c=>{t.forEach(l=>{l.type===i&&l.trackId===c.id&&DC(t,l,r)})}),r}const pN=lN;function fN(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const h=typeof c[u]=="object"?c[u]:{ideal:c[u]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const p=function(m,g){return m?m+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(h.ideal!==void 0){l.optional=l.optional||[];let m={};typeof h.ideal=="number"?(m[p("min",u)]=h.ideal,l.optional.push(m),m={},m[p("max",u)]=h.ideal,l.optional.push(m)):(m[p("",u)]=h.ideal,l.optional.push(m))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[p("",u)]=h.exact):["min","max"].forEach(m=>{h[m]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[p(m,u)]=h[m])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},r=function(c,l){if(e.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const u=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])};u((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),u(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let u=c.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const h=e.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||h)){let p;if(delete c.video.facingMode,u.exact==="environment"||u.ideal==="environment"?p=["back","rear"]:u.exact!=="user"&&u.ideal!=="user"||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(m=>{let g=(m=m.filter(S=>S.kind==="videoinput")).find(S=>p.some(D=>{var w;return At(w=S.label.toLowerCase()).call(w,D)}));return!g&&m.length&&At(p).call(p,"back")&&(g=m[m.length-1]),g&&(c.video.deviceId=u.exact?{exact:g.deviceId}:{ideal:g.deviceId}),c.video=i(c.video),pN("chrome: "+JSON.stringify(c)),l(c)})}c.video=i(c.video)}return pN("chrome: "+JSON.stringify(c)),l(c)},a=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,l,u){r(c,h=>{n.webkitGetUserMedia(h,l,p=>{u&&u(a(p))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,u=>c(u).then(h=>{if(u.audio&&!h.getAudioTracks().length||u.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return h},h=>wt.reject(a(h))))}}}function mN(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function EN(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const a=new Event("track");a.track=i.track,a.receiver=r,a.transceiver={receiver:r},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const a=new Event("track");a.track=i,a.receiver=r,a.transceiver={receiver:r},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else zp(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function _N(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=r.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){let u=r.apply(this,arguments);return u||(u=e(this,c),this._senders.push(u)),u};const a=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){a.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(a=>{const c=this._senders.find(l=>l.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function gN(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,r]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const a=function(l){const u={};return l.result().forEach(h=>{const p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(m=>{p[m]=h.stat(m)}),u[p.id]=p}),u},c=function(l){return new Map(Object.keys(l).map(u=>[u,l[u]]))};if(arguments.length>=2){const l=function(u){i(c(a(u)))};return e.apply(this,[l,n])}return new wt((l,u)=>{e.apply(this,[function(h){l(c(a(h)))},u])}).then(i,r)}}function SN(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(a=>a._pc=this),r});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(a=>hN(a,r.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),zp(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>hN(r,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,r,a;return this.getSenders().forEach(c=>{c.track===n&&(i?a=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(r?a=!0:r=c),c.track===n)),a||i&&r?wt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():wt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function yN(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(u=>{if(this.getSenders().find(p=>p.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(u=>c.indexOf(u)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(a);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),r.apply(this,arguments)}}function TN(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return yN(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;function a(u,h){let p=h.sdp;return Object.keys(u._reverseStreams||[]).forEach(m=>{const g=u._reverseStreams[m],S=u._streams[g.id];p=p.replace(new RegExp(S.id,"g"),g.id)}),new RTCSessionDescription({type:h.type,sdp:p})}t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(S=>S===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[h.id];if(g)g.addTrack(u),wt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new t.MediaStream([u]);this._streams[h.id]=S,this._reverseStreams[S.id]=h,this.addStream(S)}return this.getSenders().find(S=>S.track===u)},["createOffer","createAnswer"].forEach(function(u){const h=t.RTCPeerConnection.prototype[u],p={[u](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[g=>{const S=a(this,g);m[0].apply(null,[S])},g=>{m[1]&&m[1].apply(null,g)},arguments[2]]):h.apply(this,arguments).then(g=>a(this,g))}};t.RTCPeerConnection.prototype[u]=p[u]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(u,h){let p=h.sdp;return Object.keys(u._reverseStreams||[]).forEach(m=>{const g=u._reverseStreams[m],S=u._streams[g.id];p=p.replace(new RegExp(g.id,"g"),S.id)}),new RTCSessionDescription({type:h.type,sdp:p})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=l.get.apply(this);return u.type===""?u:a(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(u._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(m=>u.track===m)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function LC(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function vN(t,e){zp(t,"negotiationneeded",n=>{const i=n.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var bN=Object.freeze({__proto__:null,fixNegotiationNeeded:vN,shimAddTrackRemoveTrack:TN,shimAddTrackRemoveTrackWithNative:yN,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(i=>{const r=n.video&&n.video.width,a=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},r&&(n.video.mandatory.maxWidth=r),a&&(n.video.mandatory.maxHeight=a),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:_N,shimGetStats:gN,shimGetUserMedia:fN,shimMediaStream:mN,shimOnTrack:EN,shimPeerConnection:LC,shimSenderReceiverGetStats:SN});function RN(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,a,c){NC("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(a,c)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(c,l,u){l in c&&!(u in c)&&(c[u]=c[l],delete c[l])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c.audio,"autoGainControl","mozAutoGainControl"),r(c.audio,"noiseSuppression","mozNoiseSuppression")),a(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const l=c.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function CN(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function PC(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const a=t.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=c[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,a,c]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!a)try{l.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;l.forEach((h,p)=>{l.set(p,Object.assign({},h,{type:n[h.type]||h.type}))})}return l}).then(a,c)}}function AN(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):wt.resolve(new Map)}}function wN(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n}),zp(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function IN(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){NC("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&At(i=e.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function ON(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function NN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(i){const{sender:a}=r,c=a.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,a.sendEncodings=n,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return r})}function DN(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function LN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?wt.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function PN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?wt.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var kN=Object.freeze({__proto__:null,shimAddTransceiver:NN,shimCreateAnswer:PN,shimCreateOffer:LN,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,wt.reject(i)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:DN,shimGetUserMedia:RN,shimOnTrack:CN,shimPeerConnection:PC,shimRTCDataChannel:ON,shimReceiverGetStats:wN,shimRemoveStream:IN,shimSenderGetStats:AN});function xN(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),At(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r&&r.forEach(c=>{var l;this._localStreams?At(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(r=>{At(i).call(i,r.track)&&this.removeTrack(r)})})}}function MN(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var a;if(this._remoteStreams||(this._remoteStreams=[]),At(a=this._remoteStreams).call(a,r))return;this._remoteStreams.push(r);const c=new Event("addstream");c.stream=r,this.dispatchEvent(c)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(r)>=0)return;n._remoteStreams.push(r);const a=new Event("addstream");a.stream=r,n.dispatchEvent(a)})}),e.apply(n,arguments)}}}function UN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,a=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(u,h){const p=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[p]);return h?(m.then(u,h),wt.resolve()):m},e.createAnswer=function(u,h){const p=arguments.length>=2?arguments[2]:arguments[0],m=i.apply(this,[p]);return h?(m.then(u,h),wt.resolve()):m};let l=function(u,h,p){const m=r.apply(this,[u]);return p?(m.then(h,p),wt.resolve()):m};e.setLocalDescription=l,l=function(u,h,p){const m=a.apply(this,[u]);return p?(m.then(h,p),wt.resolve()):m},e.setRemoteDescription=l,l=function(u,h,p){const m=c.apply(this,[u]);return p?(m.then(h,p),wt.resolve()):m},e.addIceCandidate=l}function jN(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(VN(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,i,r){e.mediaDevices.getUserMedia(n).then(i,r)}).bind(e))}function VN(t){return t&&t.video!==void 0?Object.assign({},t,{video:uN(t.video)}):t}function BN(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const r=[];for(let a=0;a<n.iceServers.length;a++){let c=n.iceServers[a];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(NC("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,r.push(c)):r.push(n.iceServers[a])}n.iceServers=r}return new e(n,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function FN(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function GN(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function HN(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var WN=Object.freeze({__proto__:null,shimAudioContext:HN,shimCallbacksAPI:UN,shimConstraints:VN,shimCreateOfferLegacy:GN,shimGetUserMedia:jN,shimLocalStreamsAPI:xN,shimRTCIceServerUrls:BN,shimRemoteStreamsAPI:MN,shimTrackEventTransceiver:FN}),KN=`	
\v\f\r \u2028\u2029\uFEFF`,F3=hs,G3=Ir,kC=KN,zN=lt("".replace),H3=RegExp("^["+kC+"]+"),W3=RegExp("(^|[^"+kC+"])["+kC+"]+$"),K3=function(t){return function(e){var n=G3(F3(e));return 1&t&&(n=zN(n,H3,"")),2&t&&(n=zN(n,W3,"$1")),n}},z3={trim:K3(3)},Y3=gr.PROPER,q3=U,YN=KN,X3=z3.trim;Qe({target:"String",proto:!0,forced:function(t){return q3(function(){return!!YN[t]()||""[t]()!==""||Y3&&YN[t].name!==t})}("trim")},{trim:function(){return X3(this)}});var J3=Er("String").trim,Q3=dt,Z3=J3,xC=String.prototype,$3=function(t){var e=t.trim;return typeof t=="string"||t===xC||Q3(xC,t)&&e===xC.trim?Z3:e},Lr=L($3),qN={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let a=8;a<i.length;a+=2)switch(i[a]){case"raddr":r.relatedAddress=i[a+1];break;case"rport":r.relatedPort=parseInt(i[a+1],10);break;case"tcptype":r.tcpType=i[a+1];break;case"ufrag":r.ufrag=i[a+1],r.usernameFragment=i[a+1];break;default:r[i[a]]===void 0&&(r[i[a]]=i[a+1])}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const a=n.type;return i.push("typ"),i.push(a),a!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const a=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<a.length;c++)r=a[c].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const a=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?a.push(c+"="+n.parameters[c]):a.push(c)}),i+="a=fmtp:"+r+" "+a.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(a=>{i+="a=rtcp-fb:"+r+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},a=n.indexOf(":",i);return a>-1?(r.attribute=n.substring(i+1,a),r.value=n.substring(a+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(a=>{r+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],a=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&a?{usernameFragment:r.substring(12),password:a.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(n)[0].split(" ");i.profile=r[2];for(let c=3;c<r.length;c++){const l=r[c],u=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(u){const h=e.parseRtpMap(u),p=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(h.parameters=p.length?e.parseFmtp(p[0]):{},h.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(h.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(c=>{i.headerExtensions.push(e.parseExtmap(c))});const a=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(c=>{a.forEach(l=>{c.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{r+=e.writeRtpMap(c),r+=e.writeFmtp(c),r+=e.writeRtcpFb(c)});let a=0;return i.codecs.forEach(c=>{c.maxptime>a&&(a=c.maxptime)}),a>0&&(r+="a=maxptime:"+a+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{r+=e.writeExtmap(c)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),a=r.fecMechanisms.indexOf("RED")!==-1,c=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(g=>e.parseSsrcMedia(g)).filter(g=>g.attribute==="cname"),u=l.length>0&&l[0].ssrc;let h;const p=e.matchPrefix(n,"a=ssrc-group:FID").map(g=>g.substring(17).split(" ").map(S=>parseInt(S,10)));p.length>0&&p[0].length>1&&p[0][0]===u&&(h=p[0][1]),r.codecs.forEach(g=>{if(g.name.toUpperCase()==="RTX"&&g.parameters.apt){let S={ssrc:u,codecPayloadType:parseInt(g.parameters.apt,10)};u&&h&&(S.rtx={ssrc:h}),i.push(S),a&&(S=JSON.parse(JSON.stringify(S)),S.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},i.push(S))}}),i.length===0&&u&&i.push({ssrc:u});let m=e.matchPrefix(n,"b=");return m.length&&(m=m[0].indexOf("b=TIAS:")===0?parseInt(m[0].substring(7),10):m[0].indexOf("b=AS:")===0?1e3*parseInt(m[0].substring(5),10)*.95-16e3:void 0,i.forEach(g=>{g.maxBitrate=m})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const a=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=a.length>0,i.compound=a.length===0;const c=e.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const a=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return a.length>0?(i=a[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let a;r.length>0&&(a=parseInt(r[0].substring(19),10)),isNaN(a)&&(a=65536);const c=e.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:a};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const u=l[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:a}}},e.writeSctpDescription=function(n,i){let r=[];return r=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let a;const c=i!==void 0?i:2;return a=n||e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+a+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let a=0;a<r.length;a++)switch(r[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[a].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(qN);var XN=qN.exports,RE=L(XN),tF=O({__proto__:null,default:RE},[XN]);function Yv(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new e(n),r=RE.parseCandidate(n.candidate),a=Object.assign(i,r);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,zp(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function MC(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||zp(t,"icecandidate",e=>{if(e.candidate){const n=RE.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function qv(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const u=RE.splitSections(l.sdp);return u.shift(),u.some(h=>{const p=RE.parseMLine(h);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},i=function(l){const u=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const h=parseInt(u[1],10);return h!=h?-1:h},r=function(l){let u=65536;return e.browser==="firefox"&&(u=e.version<57?l===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),u},a=function(l,u){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const p=RE.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?h=parseInt(p[0].substr(19),10):e.browser==="firefox"&&u!==-1&&(h=2147483637),h},c=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),u=r(l),h=a(arguments[0],l);let p;p=u===0&&h===0?Number.POSITIVE_INFINITY:u===0||h===0?Math.max(u,h):Math.min(u,h);const m={};Object.defineProperty(m,"maxMessageSize",{get:()=>p}),this._sctp=m}return c.apply(this,arguments)}}function Xv(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const a=i.send;i.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return a.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},zp(t,"datachannel",i=>(e(i.channel,i.target),i))}function UC(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const a=r.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const c=new Event("connectionstatechange",r);a.dispatchEvent(c)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function jC(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(a=>Lr(a).call(a)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function Jv(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?wt.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),wt.resolve())})}function Qv(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var eF=Object.freeze({__proto__:null,removeExtmapAllowMixed:jC,shimAddIceCandidateNullOrEmpty:Jv,shimConnectionState:UC,shimMaxMessageSize:qv,shimParameterlessSetLocalDescription:Qv,shimRTCIceCandidate:Yv,shimRTCIceCandidateRelayProtocol:MC,shimSendThrowTypeError:Xv});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=lN,i=function(a){const c={browser:null,version:null};if(a===void 0||!a.navigator)return c.browser="Not a browser.",c;const{navigator:l}=a;if(l.mozGetUserMedia)c.browser="firefox",c.version=zv(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||a.isSecureContext===!1&&a.webkitRTCPeerConnection)c.browser="chrome",c.version=zv(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!a.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=zv(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype}return c}(t),r={browserDetails:i,commonShim:eF,extractVersion:zv,disableLog:V3,disableWarnings:B3,sdp:tF};switch(i.browser){case"chrome":if(!bN||!LC||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=bN,Jv(t,i),Qv(t),fN(t,i),mN(t),LC(t,i),EN(t),TN(t,i),_N(t),gN(t),SN(t),vN(t,i),Yv(t),MC(t),UC(t),qv(t,i),Xv(t),jC(t,i);break;case"firefox":if(!kN||!PC||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=kN,Jv(t,i),Qv(t),RN(t,i),PC(t,i),CN(t),IN(t),AN(t),wN(t),ON(t),NN(t),DN(t),LN(t),PN(t),Yv(t),UC(t),qv(t,i),Xv(t);break;case"safari":if(!WN||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=WN,Jv(t,i),Qv(t),BN(t),GN(t),UN(t),xN(t),MN(t),FN(t),jN(t),HN(t),Yv(t),MC(t),qv(t,i),Xv(t),jC(t,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var JN=Sa,nF=TypeError,QN=Qn.match(/firefox\/(\d+)/i),iF=!!QN&&+QN[1],rF=/MSIE|Trident/.test(Qn),ZN=Qn.match(/AppleWebKit\/(\d+)\./),sF=!!ZN&&+ZN[1],aF=Qe,$N=lt,oF=ts,cF=ar,tD=Xs,lF=function(t,e){if(!delete t[e])throw nF("Cannot delete property "+JN(e)+" of "+JN(t))},eD=Ir,VC=U,dF=d,uF=va,nD=iF,hF=rF,iD=Wa,rD=sF,Gu=[],sD=$N(Gu.sort),pF=$N(Gu.push),fF=VC(function(){Gu.sort(void 0)}),mF=VC(function(){Gu.sort(null)}),EF=uF("sort"),aD=!VC(function(){if(iD)return iD<70;if(!(nD&&nD>3)){if(hF)return!0;if(rD)return rD<603;var t,e,n,i,r="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)Gu.push({k:e+i,v:n})}for(Gu.sort(function(a,c){return c.v-a.v}),i=0;i<Gu.length;i++)e=Gu[i].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return r!=="DGBEFHACIJK"}});aF({target:"Array",proto:!0,forced:fF||!mF||!EF||!aD},{sort:function(t){t!==void 0&&oF(t);var e=cF(this);if(aD)return t===void 0?sD(e):sD(e,t);var n,i,r=[],a=tD(e);for(i=0;i<a;i++)i in e&&pF(r,e[i]);for(dF(r,function(c){return function(l,u){return u===void 0?-1:l===void 0?1:c!==void 0?+c(l,u)||0:eD(l)>eD(u)?1:-1}}(t)),n=tD(r),i=0;i<n;)e[i]=r[i++];for(;i<a;)lF(e,i++);return e}});var _F=Er("Array").sort,gF=dt,SF=_F,BC=Array.prototype,yF=function(t){var e=t.sort;return t===BC||gF(BC,t)&&e===BC.sort?SF:e},wS=L(yF),FC=st;Qe({global:!0,forced:FC.globalThis!==FC},{globalThis:FC});var oD=L(st),GC={exports:{}};(function(t,e){(function(n,i){var r="function",a="undefined",c="object",l="string",u="major",h="model",p="name",m="type",g="vendor",S="version",D="architecture",w="console",N="mobile",k="tablet",x="smarttv",W="wearable",Z="embedded",$="Amazon",q="Apple",ot="ASUS",_t="BlackBerry",Nt="Browser",Mt="Chrome",ke="Firefox",xe="Google",gn="Huawei",ni="LG",Kn="Microsoft",us="Motorola",pt="Opera",bt="Samsung",qt="Sharp",ft="Sony",C="Xiaomi",F="Zebra",z="Facebook",St="Chromium OS",ge="Mac OS",ln=function(fi){for(var Ni={},Nn=0;Nn<fi.length;Nn++)Ni[fi[Nn].toUpperCase()]=fi[Nn];return Ni},Oi=function(fi,Ni){return typeof fi===l&&Rs(Ni).indexOf(Rs(fi))!==-1},Rs=function(fi){return fi.toLowerCase()},Nd=function(fi,Ni){if(typeof fi===l)return fi=fi.replace(/^\s\s*/,""),typeof Ni===a?fi:fi.substring(0,350)},Rf=function(fi,Ni){for(var Nn,Ks,Al,ii,Xe,Cs,dh=0;dh<Ni.length&&!Xe;){var bc=Ni[dh],kj=Ni[dh+1];for(Nn=Ks=0;Nn<bc.length&&!Xe&&bc[Nn];)if(Xe=bc[Nn++].exec(fi))for(Al=0;Al<kj.length;Al++)Cs=Xe[++Ks],typeof(ii=kj[Al])===c&&ii.length>0?ii.length===2?typeof ii[1]==r?this[ii[0]]=ii[1].call(this,Cs):this[ii[0]]=ii[1]:ii.length===3?typeof ii[1]!==r||ii[1].exec&&ii[1].test?this[ii[0]]=Cs?Cs.replace(ii[1],ii[2]):i:this[ii[0]]=Cs?ii[1].call(this,Cs,ii[2]):i:ii.length===4&&(this[ii[0]]=Cs?ii[3].call(this,Cs.replace(ii[1],ii[2])):i):this[ii]=Cs||i;dh+=2}},Ny=function(fi,Ni){for(var Nn in Ni)if(typeof Ni[Nn]===c&&Ni[Nn].length>0){for(var Ks=0;Ks<Ni[Nn].length;Ks++)if(Oi(Ni[Nn][Ks],fi))return Nn==="?"?i:Nn}else if(Oi(Ni[Nn],fi))return Nn==="?"?i:Nn;return fi},qR={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},XR={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,S],[/opios[\/ ]+([\w\.]+)/i],[S,[p,pt+" Mini"]],[/\bopr\/([\w\.]+)/i],[S,[p,pt]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,S],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[p,"UC"+Nt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[S,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[S,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[S,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+Nt],S],[/\bfocus\/([\w\.]+)/i],[S,[p,ke+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[p,pt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[p,pt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[p,"MIUI "+Nt]],[/fxios\/([-\w\.]+)/i],[S,[p,ke]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 "+Nt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 "+Nt],S],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,S],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,z],S],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[p,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[p,Mt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,Mt+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[p,"Android "+Nt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[S,Ny,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[p,ke+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,S],[/(cobalt)\/([\w\.]+)/i],[p,[S,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[D,"amd64"]],[/(ia32(?=;))/i],[[D,Rs]],[/((?:i[346]|x)86)[;\)]/i],[[D,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[D,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[D,"armhf"]],[/windows (ce|mobile); ppc;/i],[[D,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[D,/ower/,"",Rs]],[/(sun4\w)[;\)]/i],[[D,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[D,Rs]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[g,bt],[m,k]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[g,bt],[m,N]],[/\((ip(?:hone|od)[\w ]*);/i],[h,[g,q],[m,N]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[g,q],[m,k]],[/(macintosh);/i],[h,[g,q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[g,qt],[m,N]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[g,gn],[m,k]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[g,gn],[m,N]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[g,C],[m,N]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[g,C],[m,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[g,"OPPO"],[m,N]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[g,"Vivo"],[m,N]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[h,[g,"Realme"],[m,N]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[g,us],[m,N]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[g,us],[m,k]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[g,ni],[m,k]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[g,ni],[m,N]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[g,"Lenovo"],[m,k]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[g,"Nokia"],[m,N]],[/(pixel c)\b/i],[h,[g,xe],[m,k]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[g,xe],[m,N]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[g,ft],[m,N]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[g,ft],[m,k]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[g,"OnePlus"],[m,N]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[g,$],[m,k]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[g,$],[m,N]],[/(playbook);[-\w\),; ]+(rim)/i],[h,g,[m,k]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[g,_t],[m,N]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[g,ot],[m,k]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[g,ot],[m,N]],[/(nexus 9)/i],[h,[g,"HTC"],[m,k]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[h,/_/g," "],[m,N]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[g,"Acer"],[m,k]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[g,"Meizu"],[m,N]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,h,[m,N]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,h,[m,k]],[/(surface duo)/i],[h,[g,Kn],[m,k]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[g,"Fairphone"],[m,N]],[/(u304aa)/i],[h,[g,"AT&T"],[m,N]],[/\bsie-(\w*)/i],[h,[g,"Siemens"],[m,N]],[/\b(rct\w+) b/i],[h,[g,"RCA"],[m,k]],[/\b(venue[\d ]{2,7}) b/i],[h,[g,"Dell"],[m,k]],[/\b(q(?:mv|ta)\w+) b/i],[h,[g,"Verizon"],[m,k]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[g,"Barnes & Noble"],[m,k]],[/\b(tm\d{3}\w+) b/i],[h,[g,"NuVision"],[m,k]],[/\b(k88) b/i],[h,[g,"ZTE"],[m,k]],[/\b(nx\d{3}j) b/i],[h,[g,"ZTE"],[m,N]],[/\b(gen\d{3}) b.+49h/i],[h,[g,"Swiss"],[m,N]],[/\b(zur\d{3}) b/i],[h,[g,"Swiss"],[m,k]],[/\b((zeki)?tb.*\b) b/i],[h,[g,"Zeki"],[m,k]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],h,[m,k]],[/\b(ns-?\w{0,9}) b/i],[h,[g,"Insignia"],[m,k]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[g,"NextBook"],[m,k]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],h,[m,N]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],h,[m,N]],[/\b(ph-1) /i],[h,[g,"Essential"],[m,N]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[g,"Envizen"],[m,k]],[/\b(trio[-\w\. ]+) b/i],[h,[g,"MachSpeed"],[m,k]],[/\btu_(1491) b/i],[h,[g,"Rotor"],[m,k]],[/(shield[\w ]+) b/i],[h,[g,"Nvidia"],[m,k]],[/(sprint) (\w+)/i],[g,h,[m,N]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[g,Kn],[m,N]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[g,F],[m,k]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[g,F],[m,N]],[/smart-tv.+(samsung)/i],[g,[m,x]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[g,bt],[m,x]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,ni],[m,x]],[/(apple) ?tv/i],[g,[h,q+" TV"],[m,x]],[/crkey/i],[[h,Mt+"cast"],[g,xe],[m,x]],[/droid.+aft(\w)( bui|\))/i],[h,[g,$],[m,x]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[g,qt],[m,x]],[/(bravia[\w ]+)( bui|\))/i],[h,[g,ft],[m,x]],[/(mitv-\w{5}) bui/i],[h,[g,C],[m,x]],[/Hbbtv.*(technisat) (.*);/i],[g,h,[m,x]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,Nd],[h,Nd],[m,x]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,x]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,h,[m,w]],[/droid.+; (shield) bui/i],[h,[g,"Nvidia"],[m,w]],[/(playstation [345portablevi]+)/i],[h,[g,ft],[m,w]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[g,Kn],[m,w]],[/((pebble))app/i],[g,h,[m,W]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[g,q],[m,W]],[/droid.+; (glass) \d/i],[h,[g,xe],[m,W]],[/droid.+; (wt63?0{2,3})\)/i],[h,[g,F],[m,W]],[/(quest( 2| pro)?)/i],[h,[g,z],[m,W]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[m,Z]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[h,[m,N]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[m,k]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,k]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,N]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[p,S],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,S],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[S,Ny,qR]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[S,Ny,qR]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,ge],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,S],[/\(bb(10);/i],[S,[p,_t]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[S,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[p,ke+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[S,[p,Mt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,St],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,S],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[p,S]]},Ba=function(fi,Ni){if(typeof fi===c&&(Ni=fi,fi=i),!(this instanceof Ba))return new Ba(fi,Ni).getResult();var Nn=typeof n!==a&&n.navigator?n.navigator:i,Ks=fi||(Nn&&Nn.userAgent?Nn.userAgent:""),Al=Nn&&Nn.userAgentData?Nn.userAgentData:i,ii=Ni?function(Xe,Cs){var dh={};for(var bc in Xe)Cs[bc]&&Cs[bc].length%2==0?dh[bc]=Cs[bc].concat(Xe[bc]):dh[bc]=Xe[bc];return dh}(XR,Ni):XR;return this.getBrowser=function(){var Xe={};return Xe[p]=i,Xe[S]=i,Rf.call(Xe,Ks,ii.browser),Xe[u]=function(Cs){return typeof Cs===l?Cs.replace(/[^\d\.]/g,"").split(".")[0]:i}(Xe[S]),Nn&&Nn.brave&&typeof Nn.brave.isBrave==r&&(Xe[p]="Brave"),Xe},this.getCPU=function(){var Xe={};return Xe[D]=i,Rf.call(Xe,Ks,ii.cpu),Xe},this.getDevice=function(){var Xe={};return Xe[g]=i,Xe[h]=i,Xe[m]=i,Rf.call(Xe,Ks,ii.device),!Xe[m]&&Al&&Al.mobile&&(Xe[m]=N),Xe[h]=="Macintosh"&&Nn&&typeof Nn.standalone!==a&&Nn.maxTouchPoints&&Nn.maxTouchPoints>2&&(Xe[h]="iPad",Xe[m]=k),Xe},this.getEngine=function(){var Xe={};return Xe[p]=i,Xe[S]=i,Rf.call(Xe,Ks,ii.engine),Xe},this.getOS=function(){var Xe={};return Xe[p]=i,Xe[S]=i,Rf.call(Xe,Ks,ii.os),!Xe[p]&&Al&&Al.platform!="Unknown"&&(Xe[p]=Al.platform.replace(/chrome os/i,St).replace(/macos/i,ge)),Xe},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ks},this.setUA=function(Xe){return Ks=typeof Xe===l&&Xe.length>350?Nd(Xe,350):Xe,this},this.setUA(Ks),this};Ba.VERSION="0.7.34",Ba.BROWSER=ln([p,S,u]),Ba.CPU=ln([D]),Ba.DEVICE=ln([h,g,m,w,N,x,k,W,Z]),Ba.ENGINE=Ba.OS=ln([p,S]),t.exports&&(e=t.exports=Ba),e.UAParser=Ba;var lh=typeof n!==a&&(n.jQuery||n.Zepto);if(lh&&!lh.ua){var Cf=new Ba;lh.ua=Cf.getResult(),lh.ua.get=function(){return Cf.getUA()},lh.ua.set=function(fi){Cf.setUA(fi);var Ni=Cf.getResult();for(var Nn in Ni)lh.ua[Nn]=Ni[Nn]}}})(typeof window=="object"?window:A)})(GC,GC.exports);var TF=L(GC.exports),vF=Ps,bF=yi,RF=Ue,CF=di,AF=kn("iterator"),wF=Object,IF=function(t){if(RF(t))return!1;var e=wF(t);return e[AF]!==void 0||"@@iterator"in e||bF(CF,vF(e))},OF=L(IF),cD=qn.clear;Qe({global:!0,bind:!0,forced:st.clearImmediate!==cD},{clearImmediate:cD});var NF=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",lD=st,DF=Rt,LF=Gt,PF=NF,kF=Qn,xF=Tp,MF=lo,UF=lD.Function,jF=/MSIE .\./.test(kF)||PF&&function(){var t=lD.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),VF=Qe,dD=st,uD=qn.set,BF=function(t,e){var n=1;return jF?function(i,r){var a=MF(arguments.length,1)>n,c=LF(i)?i:UF(i),l=a?xF(arguments,n):[],u=a?function(){DF(c,this,l)}:c;return t(u)}:t},hD=dD.setImmediate?BF(uD):uD;VF({global:!0,bind:!0,forced:dD.setImmediate!==hD},{setImmediate:hD});var pD=L(Ur.setImmediate),FF=Qe,GF=Fg,HF=ts,WF=lo,KF=to,zF=st.process;FF({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){WF(arguments.length,1),HF(t);var e=KF&&zF.domain;GF(e?e.bind(t):t)}});var fD=L(Ur.queueMicrotask);function mD(t,e){return function(){return t.apply(e,arguments)}}const{toString:YF}=Object.prototype,{getPrototypeOf:HC}=Object,Zv=(WC=Object.create(null),t=>{const e=YF.call(t);return WC[e]||(WC[e]=e.slice(8,-1).toLowerCase())});var WC;const dc=t=>(t=t.toLowerCase(),e=>Zv(e)===t),$v=t=>e=>typeof e===t,{isArray:CE}=Array,IS=$v("undefined"),ED=dc("ArrayBuffer"),qF=$v("string"),Na=$v("function"),_D=$v("number"),tb=t=>t!==null&&typeof t=="object",eb=t=>{if(Zv(t)!=="object")return!1;const e=HC(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in t||OF(t))},XF=dc("Date"),JF=dc("File"),QF=dc("Blob"),ZF=dc("FileList"),$F=dc("URLSearchParams"),[t4,e4,n4,i4]=["ReadableStream","Request","Response","Headers"].map(dc);function OS(t,e){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),CE(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{const a=r?Object.getOwnPropertyNames(t):Object.keys(t),c=a.length;let l;for(n=0;n<c;n++)l=a[n],e.call(null,t[l],l,t)}}function gD(t,e){e=e.toLowerCase();const n=Object.keys(t);let i,r=n.length;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const Yp=oD!==void 0?oD:typeof self<"u"?self:typeof window<"u"?window:PI,SD=t=>!IS(t)&&t!==Yp,r4=(KC=typeof Uint8Array<"u"&&HC(Uint8Array),t=>KC&&t instanceof KC);var KC;const s4=dc("HTMLFormElement"),yD=(t=>{let{hasOwnProperty:e}=t;return(n,i)=>e.call(n,i)})(Object.prototype),a4=dc("RegExp"),TD=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};OS(n,(r,a)=>{let c;(c=e(r,a,t))!==!1&&(i[a]=c||r)}),Object.defineProperties(t,i)},zC="abcdefghijklmnopqrstuvwxyz",vD="0123456789",bD={DIGIT:vD,ALPHA:zC,ALPHA_DIGIT:zC+zC.toUpperCase()+vD},o4=dc("AsyncFunction"),RD=(CD=typeof pD=="function",AD=Na(Yp.postMessage),CD?pD:AD?(YC="axios@".concat(Math.random()),nb=[],Yp.addEventListener("message",t=>{let{source:e,data:n}=t;e===Yp&&n===YC&&nb.length&&nb.shift()()},!1),t=>{nb.push(t),Yp.postMessage(YC,"*")}):t=>setTimeout(t));var CD,AD,YC,nb;const c4=fD!==void 0?fD.bind(Yp):typeof process<"u"&&process.nextTick||RD;var Ot={isArray:CE,isArrayBuffer:ED,isBuffer:function(t){return t!==null&&!IS(t)&&t.constructor!==null&&!IS(t.constructor)&&Na(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Na(t.append)&&((e=Zv(t))==="formdata"||e==="object"&&Na(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&ED(t.buffer),e},isString:qF,isNumber:_D,isBoolean:t=>t===!0||t===!1,isObject:tb,isPlainObject:eb,isReadableStream:t4,isRequest:e4,isResponse:n4,isHeaders:i4,isUndefined:IS,isDate:XF,isFile:JF,isBlob:QF,isRegExp:a4,isFunction:Na,isStream:t=>tb(t)&&Na(t.pipe),isURLSearchParams:$F,isTypedArray:r4,isFileList:ZF,forEach:OS,merge:function t(){const{caseless:e}=SD(this)&&this||{},n={},i=(r,a)=>{const c=e&&gD(n,a)||a;eb(n[c])&&eb(r)?n[c]=t(n[c],r):eb(r)?n[c]=t({},r):CE(r)?n[c]=r.slice():n[c]=r};for(let r=0,a=arguments.length;r<a;r++)arguments[r]&&OS(arguments[r],i);return n},extend:function(t,e,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return OS(e,(r,a)=>{n&&Na(r)?t[a]=mD(r,n):t[a]=r},{allOwnKeys:i}),t},trim:t=>Lr(t)?Lr(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,i)=>{let r,a,c;const l={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),a=r.length;a-- >0;)c=r[a],i&&!i(c,t,e)||l[c]||(e[c]=t[c],l[c]=!0);t=n!==!1&&HC(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:Zv,kindOfTest:dc,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},toArray:t=>{if(!t)return null;if(CE(t))return t;let e=t.length;if(!_D(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=n.next())&&!i.done;){const r=i.value;e.call(t,r[0],r[1])}},matchAll:(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},isHTMLForm:s4,hasOwnProperty:yD,hasOwnProp:yD,reduceDescriptors:TD,freezeMethods:t=>{TD(t,(e,n)=>{if(Na(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];Na(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},i=r=>{r.forEach(a=>{n[a]=!0})};return CE(t)?i(t):i(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:gD,global:Yp,isContextDefined:SD,ALPHABET:bD,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bD.ALPHA_DIGIT,n="";const{length:i}=e;for(;t--;)n+=e[Math.random()*i|0];return n},isSpecCompliantForm:function(t){return!!(t&&Na(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(i,r)=>{if(tb(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const a=CE(i)?[]:{};return OS(i,(c,l)=>{const u=n(c,r+1);!IS(u)&&(a[l]=u)}),e[r]=void 0,a}}return i};return n(t,0)},isAsyncFn:o4,isThenable:t=>t&&(tb(t)||Na(t))&&Na(t.then)&&Na(t.catch),setImmediate:RD,asap:c4};function on(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}Ot.inherits(on,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ot.toJSONObject(this.config),code:this.code,status:this.status}}});const wD=on.prototype,ID={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{ID[t]={value:t}}),Object.defineProperties(on,ID),Object.defineProperty(wD,"isAxiosError",{value:!0}),on.from=(t,e,n,i,r,a)=>{const c=Object.create(wD);return Ot.toFlatObject(t,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),on.call(c,t.message,e,n,i,r),c.cause=t,c.name=t.name,a&&Object.assign(c,a),c};function qC(t){return Ot.isPlainObject(t)||Ot.isArray(t)}function OD(t){return Ot.endsWith(t,"[]")?t.slice(0,-2):t}function ND(t,e,n){return t?t.concat(e).map(function(i,r){return i=OD(i),!n&&r?"["+i+"]":i}).join(n?".":""):e}const l4=Ot.toFlatObject(Ot,{},null,function(t){return/^is[A-Z]/.test(t)});function ib(t,e,n){if(!Ot.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const i=(n=Ot.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,S){return!Ot.isUndefined(S[g])})).metaTokens,r=n.visitor||h,a=n.dots,c=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&Ot.isSpecCompliantForm(e);if(!Ot.isFunction(r))throw new TypeError("visitor must be a function");function u(g){if(g===null)return"";if(Ot.isDate(g))return g.toISOString();if(!l&&Ot.isBlob(g))throw new on("Blob is not supported. Use a Buffer instead.");return Ot.isArrayBuffer(g)||Ot.isTypedArray(g)?l&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function h(g,S,D){let w=g;if(g&&!D&&typeof g=="object"){if(Ot.endsWith(S,"{}"))S=i?S:S.slice(0,-2),g=JSON.stringify(g);else if(Ot.isArray(g)&&function(N){return Ot.isArray(N)&&!N.some(qC)}(g)||(Ot.isFileList(g)||Ot.endsWith(S,"[]"))&&(w=Ot.toArray(g)))return S=OD(S),w.forEach(function(N,k){!Ot.isUndefined(N)&&N!==null&&e.append(c===!0?ND([S],k,a):c===null?S:S+"[]",u(N))}),!1}return!!qC(g)||(e.append(ND(D,S,a),u(g)),!1)}const p=[],m=Object.assign(l4,{defaultVisitor:h,convertValue:u,isVisitable:qC});if(!Ot.isObject(t))throw new TypeError("data must be an object");return function g(S,D){if(!Ot.isUndefined(S)){if(p.indexOf(S)!==-1)throw Error("Circular reference detected in "+D.join("."));p.push(S),Ot.forEach(S,function(w,N){(!(Ot.isUndefined(w)||w===null)&&r.call(e,w,Ot.isString(N)?Lr(N).call(N):N,D,m))===!0&&g(w,D?D.concat(N):[N])}),p.pop()}}(t),e}function DD(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function XC(t,e){this._pairs=[],t&&ib(t,this,e)}const LD=XC.prototype;function d4(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function PD(t,e,n){if(!e)return t;const i=n&&n.encode||d4;Ot.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let a;if(a=r?r(e,n):Ot.isURLSearchParams(e)?e.toString():new XC(e,n).toString(i),a){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}LD.append=function(t,e){this._pairs.push([t,e])},LD.toString=function(t){const e=t?function(n){return t.call(this,n,DD)}:DD;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var kD=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Ot.forEach(this.handlers,function(e){e!==null&&t(e)})}},xD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},MD={exports:{}},u4=Qe,h4=Ut,UD=wr.f;u4({target:"Object",stat:!0,forced:Object.defineProperty!==UD,sham:!h4},{defineProperty:UD});var jD=Ur.Object,p4=MD.exports=function(t,e,n){return jD.defineProperty(t,e,n)};jD.defineProperty.sham&&(p4.sham=!0);var VD=L(MD.exports),f4=TypeError,BD=Qs,m4=Aa,E4=sr,_4=kn("species"),FD=Array,g4=function(t){var e;return BD(t)&&(e=t.constructor,(m4(e)&&(e===FD||BD(e.prototype))||E4(e)&&(e=e[_4])===null)&&(e=void 0)),e===void 0?FD:e},GD=function(t,e){return new(g4(t))(e===0?0:e)},S4=U,y4=Wa,T4=kn("species"),HD=function(t){return y4>=51||!S4(function(){var e=[];return(e.constructor={})[T4]=function(){return{foo:1}},e[t](Boolean).foo!==1})},v4=Qe,b4=U,R4=Qs,C4=sr,A4=ar,w4=Xs,WD=function(t){if(t>9007199254740991)throw f4("Maximum allowed index exceeded");return t},KD=mE,I4=GD,O4=HD,N4=Wa,zD=kn("isConcatSpreadable"),D4=N4>=51||!b4(function(){var t=[];return t[zD]=!1,t.concat()[0]!==t}),L4=function(t){if(!C4(t))return!1;var e=t[zD];return e!==void 0?!!e:R4(t)};v4({target:"Array",proto:!0,forced:!D4||!O4("concat")},{concat:function(t){var e,n,i,r,a,c=A4(this),l=I4(c,0),u=0;for(e=-1,i=arguments.length;e<i;e++)if(L4(a=e===-1?c:arguments[e]))for(r=w4(a),WD(u+r),n=0;n<r;n++,u++)n in a&&KD(l,u,a[n]);else WD(u+1),KD(l,u++,a);return l.length=u,l}});var YD={},P4=Ne,k4=rr,qD=Ho.f,x4=ju,XD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];YD.f=function(t){return XD&&P4(t)=="Window"?function(e){try{return qD(e)}catch{return x4(XD)}}(t):qD(k4(t))};var AE={},M4=kn;AE.f=M4;var JD=Ur,U4=yi,j4=AE,V4=wr.f,Zi=function(t){var e=JD.Symbol||(JD.Symbol={});U4(e,t)||V4(e,t,{value:j4.f(t)})},B4=be,F4=bn,G4=kn,H4=Qo,QD=function(){var t=F4("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,i=G4("toPrimitive");e&&!e[i]&&H4(e,i,function(r){return B4(n,this)},{})},W4=Br,K4=vn,z4=ar,Y4=Xs,q4=GD,ZD=lt([].push),X4=function(t){var e=t==1,n=t==2,i=t==3,r=t==4,a=t==6,c=t==7,l=t==5||a;return function(u,h,p,m){for(var g,S,D=z4(u),w=K4(D),N=W4(h,p),k=Y4(w),x=0,W=m||q4,Z=e?W(u,k):n||c?W(u,0):void 0;k>x;x++)if((l||x in w)&&(S=N(g=w[x],x,D),t))if(e)Z[x]=S;else if(S)switch(t){case 3:return!0;case 5:return g;case 6:return x;case 2:ZD(Z,g)}else switch(t){case 4:return!1;case 7:ZD(Z,g)}return a?-1:i||r?r:Z}},$D={forEach:X4(0)},rb=Qe,JC=st,QC=be,J4=lt,wE=Ut,IE=Nc,Q4=U,zr=yi,Z4=dt,ZC=Pi,sb=rr,$C=Ml,$4=Ir,tA=Kt,NS=qc,tL=xi,t5=Ho,eL=YD,e5=pu,nL=me,iL=wr,n5=U_,rL=at,sL=Qo,i5=gp,eA=qs,aL=Wc,oL=_h,r5=kn,s5=AE,a5=Zi,o5=QD,c5=Gr,cL=Jo,ab=$D.forEach,ra=ki("hidden"),ob="Symbol",DS="prototype",l5=cL.set,lL=cL.getterFor(ob),uc=Object[DS],qp=JC.Symbol,cb=qp&&qp[DS],d5=JC.TypeError,nA=JC.QObject,dL=nL.f,Xp=iL.f,uL=eL.f,u5=rL.f,hL=J4([].push),fd=eA("symbols"),LS=eA("op-symbols"),h5=eA("wks"),iA=!nA||!nA[DS]||!nA[DS].findChild,rA=wE&&Q4(function(){return NS(Xp({},"a",{get:function(){return Xp(this,"a",{value:7}).a}})).a!=7})?function(t,e,n){var i=dL(uc,e);i&&delete uc[e],Xp(t,e,n),i&&t!==uc&&Xp(uc,e,i)}:Xp,sA=function(t,e){var n=fd[t]=NS(cb);return l5(n,{type:ob,tag:t,description:e}),wE||(n.description=e),n},lb=function(t,e,n){t===uc&&lb(LS,e,n),ZC(t);var i=$C(e);return ZC(n),zr(fd,i)?(n.enumerable?(zr(t,ra)&&t[ra][i]&&(t[ra][i]=!1),n=NS(n,{enumerable:tA(0,!1)})):(zr(t,ra)||Xp(t,ra,tA(1,{})),t[ra][i]=!0),rA(t,i,n)):Xp(t,i,n)},aA=function(t,e){ZC(t);var n=sb(e),i=tL(n).concat(EL(n));return ab(i,function(r){wE&&!QC(pL,n,r)||lb(t,r,n[r])}),t},pL=function(t){var e=$C(t),n=QC(u5,this,e);return!(this===uc&&zr(fd,e)&&!zr(LS,e))&&(!(n||!zr(this,e)||!zr(fd,e)||zr(this,ra)&&this[ra][e])||n)},fL=function(t,e){var n=sb(t),i=$C(e);if(n!==uc||!zr(fd,i)||zr(LS,i)){var r=dL(n,i);return!r||!zr(fd,i)||zr(n,ra)&&n[ra][i]||(r.enumerable=!0),r}},mL=function(t){var e=uL(sb(t)),n=[];return ab(e,function(i){zr(fd,i)||zr(aL,i)||hL(n,i)}),n},EL=function(t){var e=t===uc,n=uL(e?LS:sb(t)),i=[];return ab(n,function(r){!zr(fd,r)||e&&!zr(uc,r)||hL(i,fd[r])}),i};IE||(qp=function(){if(Z4(cb,this))throw d5("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?$4(arguments[0]):void 0,e=oL(t),n=function(i){this===uc&&QC(n,LS,i),zr(this,ra)&&zr(this[ra],e)&&(this[ra][e]=!1),rA(this,e,tA(1,i))};return wE&&iA&&rA(uc,e,{configurable:!0,set:n}),sA(e,t)},sL(cb=qp[DS],"toString",function(){return lL(this).tag}),sL(qp,"withoutSetter",function(t){return sA(oL(t),t)}),rL.f=pL,iL.f=lb,n5.f=aA,nL.f=fL,t5.f=eL.f=mL,e5.f=EL,s5.f=function(t){return sA(r5(t),t)},wE&&i5(cb,"description",{configurable:!0,get:function(){return lL(this).description}})),rb({global:!0,wrap:!0,forced:!IE,sham:!IE},{Symbol:qp}),ab(tL(h5),function(t){a5(t)}),rb({target:ob,stat:!0,forced:!IE},{useSetter:function(){iA=!0},useSimple:function(){iA=!1}}),rb({target:"Object",stat:!0,forced:!IE,sham:!wE},{create:function(t,e){return e===void 0?NS(t):aA(NS(t),e)},defineProperty:lb,defineProperties:aA,getOwnPropertyDescriptor:fL}),rb({target:"Object",stat:!0,forced:!IE},{getOwnPropertyNames:mL}),o5(),c5(qp,ob),aL[ra]=!0;var _L=Nc&&!!Symbol.for&&!!Symbol.keyFor,p5=Qe,f5=bn,m5=yi,E5=Ir,gL=qs,_5=_L,oA=gL("string-to-symbol-registry"),g5=gL("symbol-to-string-registry");p5({target:"Symbol",stat:!0,forced:!_5},{for:function(t){var e=E5(t);if(m5(oA,e))return oA[e];var n=f5("Symbol")(e);return oA[e]=n,g5[n]=e,n}});var S5=Qe,y5=yi,T5=ga,v5=Sa,b5=_L,SL=qs("symbol-to-string-registry");S5({target:"Symbol",stat:!0,forced:!b5},{keyFor:function(t){if(!T5(t))throw TypeError(v5(t)+" is not a symbol");if(y5(SL,t))return SL[t]}});var yL=Qs,R5=Gt,TL=Ne,C5=Ir,vL=lt([].push),A5=Qe,bL=bn,RL=Rt,w5=be,PS=lt,CL=U,AL=Gt,wL=ga,IL=Tp,I5=function(t){if(R5(t))return t;if(yL(t)){for(var e=t.length,n=[],i=0;i<e;i++){var r=t[i];typeof r=="string"?vL(n,r):typeof r!="number"&&TL(r)!="Number"&&TL(r)!="String"||vL(n,C5(r))}var a=n.length,c=!0;return function(l,u){if(c)return c=!1,u;if(yL(this))return u;for(var h=0;h<a;h++)if(n[h]===l)return u}}},O5=Nc,N5=String,Hu=bL("JSON","stringify"),db=PS(/./.exec),OL=PS("".charAt),D5=PS("".charCodeAt),L5=PS("".replace),P5=PS(1 .toString),k5=/[\uD800-\uDFFF]/g,NL=/^[\uD800-\uDBFF]$/,DL=/^[\uDC00-\uDFFF]$/,LL=!O5||CL(function(){var t=bL("Symbol")();return Hu([t])!="[null]"||Hu({a:t})!="{}"||Hu(Object(t))!="{}"}),PL=CL(function(){return Hu("\uDF06\uD834")!=='"\\udf06\\ud834"'||Hu("\uDEAD")!=='"\\udead"'}),x5=function(t,e){var n=IL(arguments),i=I5(e);if(AL(i)||t!==void 0&&!wL(t))return n[1]=function(r,a){if(AL(i)&&(a=w5(i,this,N5(r),a)),!wL(a))return a},RL(Hu,null,n)},M5=function(t,e,n){var i=OL(n,e-1),r=OL(n,e+1);return db(NL,t)&&!db(DL,r)||db(DL,t)&&!db(NL,i)?"\\u"+P5(D5(t,0),16):t};Hu&&A5({target:"JSON",stat:!0,forced:LL||PL},{stringify:function(t,e,n){var i=IL(arguments),r=RL(LL?x5:Hu,null,i);return PL&&typeof r=="string"?L5(r,k5,M5):r}});var kL=pu,U5=ar;Qe({target:"Object",stat:!0,forced:!Nc||U(function(){kL.f(1)})},{getOwnPropertySymbols:function(t){var e=kL.f;return e?e(U5(t)):[]}}),Zi("asyncIterator"),Zi("hasInstance"),Zi("isConcatSpreadable"),Zi("iterator"),Zi("match"),Zi("matchAll"),Zi("replace"),Zi("search"),Zi("species"),Zi("split");var j5=QD;Zi("toPrimitive"),j5();var V5=bn,B5=Gr;Zi("toStringTag"),B5(V5("Symbol"),"Symbol"),Zi("unscopables"),Gr(st.JSON,"JSON",!0);var F5=Ur.Symbol,G5=kn,H5=wr.f,xL=G5("metadata"),ML=Function.prototype;ML[xL]===void 0&&H5(ML,xL,{value:null}),Zi("dispose"),Zi("metadata");var W5=F5;Zi("asyncDispose");var K5=lt,cA=bn("Symbol"),z5=cA.keyFor,Y5=K5(cA.prototype.valueOf),UL=cA.isRegisteredSymbol||function(t){try{return z5(Y5(t))!==void 0}catch{return!1}};Qe({target:"Symbol",stat:!0},{isRegisteredSymbol:UL});for(var q5=qs,jL=bn,X5=lt,J5=ga,Q5=kn,ub=jL("Symbol"),VL=ub.isWellKnownSymbol,BL=jL("Object","getOwnPropertyNames"),Z5=X5(ub.prototype.valueOf),FL=q5("wks"),lA=0,GL=BL(ub),$5=GL.length;lA<$5;lA++)try{var HL=GL[lA];J5(ub[HL])&&Q5(HL)}catch{}var WL=function(t){if(VL&&VL(t))return!0;try{for(var e=Z5(t),n=0,i=BL(FL),r=i.length;n<r;n++)if(FL[i[n]]==e)return!0}catch{}return!1};Qe({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:WL}),Zi("matcher"),Zi("observable"),Qe({target:"Symbol",stat:!0},{isRegistered:UL}),Qe({target:"Symbol",stat:!0,forced:!0},{isWellKnown:WL}),Zi("metadataKey"),Zi("patternMatch"),Zi("replaceAll");var OE=L(W5),KL=L(AE.f("iterator"));function kS(t){return kS=typeof OE=="function"&&typeof KL=="symbol"?function(e){return typeof e}:function(e){return e&&typeof OE=="function"&&e.constructor===OE&&e!==OE.prototype?"symbol":typeof e},kS(t)}var t6=L(AE.f("toPrimitive"));function e6(t){var e=function(n,i){if(kS(n)!=="object"||n===null)return n;var r=n[t6];if(r!==void 0){var a=r.call(n,i);if(kS(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(t,"string");return kS(e)==="symbol"?e:String(e)}function P(t,e,n){return(e=e6(e))in t?VD(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var zL=L(xB),n6={isBrowser:!0,classes:{URLSearchParams:zL!==void 0?zL:XC,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const dA=typeof window<"u"&&typeof document<"u",uA=typeof navigator=="object"&&navigator||void 0,i6=dA&&(!uA||["ReactNative","NativeScript","NS"].indexOf(uA.product)<0),r6=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",s6=dA&&window.location.href||"http://localhost";function YL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function qL(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?YL(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):YL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var Ss=qL(qL({},Object.freeze({__proto__:null,hasBrowserEnv:dA,hasStandardBrowserEnv:i6,hasStandardBrowserWebWorkerEnv:r6,navigator:uA,origin:s6})),n6),a6=Pi,o6=be,c6=yi,l6=dt,d6=function(){var t=a6(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},XL=RegExp.prototype,JL=function(t){var e=t.flags;return e!==void 0||"flags"in XL||c6(t,"flags")||!l6(XL,t)?e:o6(d6,t)},u6=hS.charAt,QL=be,h6=Pi,p6=Gt,f6=Ne,m6=/./.exec,E6=TypeError,_6=Qe,ZL=be,$L=Qt,g6=ao,hb=Zl,tP=hs,eP=$d,xS=Ir,S6=Pi,y6=Ue,T6=Ne,v6=eu,nP=JL,b6=xl,R6=U,C6=tl,A6=function(t,e,n){return e+(n?u6(t,e).length:1)},w6=function(t,e){var n=t.exec;if(p6(n)){var i=QL(n,t,e);return i!==null&&h6(i),i}if(f6(t)==="RegExp")return QL(m6,t,e);throw E6("RegExp#exec called on incompatible receiver")},iP=Jo,I6=kn("matchAll"),rP="RegExp String",sP=rP+" Iterator",O6=iP.set,N6=iP.getterFor(sP),D6=TypeError,hA=$L("".indexOf),pb=$L("".matchAll),pA=!!pb&&!R6(function(){pb("a",/./)}),L6=g6(function(t,e,n,i){O6(this,{type:sP,regexp:t,string:e,global:n,unicode:i,done:!1})},rP,function(){var t=N6(this);if(t.done)return hb(void 0,!0);var e=t.regexp,n=t.string,i=w6(e,n);return i===null?(t.done=!0,hb(void 0,!0)):t.global?(xS(i[0])===""&&(e.lastIndex=A6(n,eP(e.lastIndex),t.unicode)),hb(i,!1)):(t.done=!0,hb(i,!1))}),aP=function(t){var e,n,i,r=S6(this),a=xS(t),c=C6(r,RegExp),l=xS(nP(r));return e=new c(c===RegExp?r.source:r,l),n=!!~hA(l,"g"),i=!!~hA(l,"u"),e.lastIndex=eP(r.lastIndex),new L6(e,a,n,i)};_6({target:"String",proto:!0,forced:pA},{matchAll:function(t){var e,n,i,r,a=tP(this);if(y6(t)){if(pA)return pb(a,t)}else{if(v6(t)&&(e=xS(tP(nP(t))),!~hA(e,"g")))throw D6("`.matchAll` does not allow non-global regexes");if(pA)return pb(a,t);if((i=b6(t,I6))===void 0&&T6(t)=="RegExp"&&(i=aP),i)return ZL(i,t,a)}return n=xS(a),r=new RegExp(t,"g"),ZL(aP,r,n)}});var P6=Er("String").matchAll,k6=dt,x6=P6,fA=String.prototype,M6=function(t){var e=t.matchAll;return typeof t=="string"||t===fA||k6(fA,t)&&e===fA.matchAll?x6:e},U6=L(M6);function oP(t){function e(n,i,r,a){let c=n[a++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),u=a>=n.length;return c=!c&&Ot.isArray(r)?r.length:c,u?(Ot.hasOwnProp(r,c)?r[c]=[r[c],i]:r[c]=i,!l):(r[c]&&Ot.isObject(r[c])||(r[c]=[]),e(n,i,r[c],a)&&Ot.isArray(r[c])&&(r[c]=function(h){const p={},m=Object.keys(h);let g;const S=m.length;let D;for(g=0;g<S;g++)D=m[g],p[D]=h[D];return p}(r[c])),!l)}if(Ot.isFormData(t)&&Ot.isFunction(t.entries)){const n={};return Ot.forEachEntry(t,(i,r)=>{e(function(a){return U6(Ot).call(Ot,/\w+|\[(\w*)]/g,a).map(c=>c[0]==="[]"?"":c[1]||c[0])}(i),r,n,0)}),n}return null}const mA={transitional:xD,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,r=Ot.isObject(t);if(r&&Ot.isHTMLForm(t)&&(t=new FormData(t)),Ot.isFormData(t))return i?JSON.stringify(oP(t)):t;if(Ot.isArrayBuffer(t)||Ot.isBuffer(t)||Ot.isStream(t)||Ot.isFile(t)||Ot.isBlob(t)||Ot.isReadableStream(t))return t;if(Ot.isArrayBufferView(t))return t.buffer;if(Ot.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(c,l){return ib(c,new Ss.classes.URLSearchParams,Object.assign({visitor:function(u,h,p,m){return Ss.isNode&&Ot.isBuffer(u)?(this.append(h,u.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)}},l))}(t,this.formSerializer).toString();if((a=Ot.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return ib(a?{"files[]":t}:t,c&&new c,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),function(c,l,u){if(Ot.isString(c))try{return(l||JSON.parse)(c),Lr(Ot).call(Ot,c)}catch(h){if(h.name!=="SyntaxError")throw h}return(u||JSON.stringify)(c)}(t)):t}],transformResponse:[function(t){const e=this.transitional||mA.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(Ot.isResponse(t)||Ot.isReadableStream(t))return t;if(t&&Ot.isString(t)&&(n&&!this.responseType||i)){const r=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(a){if(r)throw a.name==="SyntaxError"?on.from(a,on.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ss.classes.FormData,Blob:Ss.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ot.forEach(["delete","get","head","post","put","patch"],t=>{mA.headers[t]={}});var EA=mA;const j6=Ot.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),cP=Symbol("internals");function MS(t){var e;return t&&Lr(e=String(t)).call(e).toLowerCase()}function fb(t){return t===!1||t==null?t:Ot.isArray(t)?t.map(fb):String(t)}function _A(t,e,n,i,r){return Ot.isFunction(i)?i.call(this,e,n):(r&&(e=n),Ot.isString(e)?Ot.isString(i)?e.indexOf(i)!==-1:Ot.isRegExp(i)?i.test(e):void 0:void 0)}class mb{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function a(u,h,p){const m=MS(h);if(!m)throw new Error("header name must be a non-empty string");const g=Ot.findKey(r,m);(!g||r[g]===void 0||p===!0||p===void 0&&r[g]!==!1)&&(r[g||h]=fb(u))}const c=(u,h)=>Ot.forEach(u,(p,m)=>a(p,m,h));if(Ot.isPlainObject(e)||e instanceof this.constructor)c(e,n);else if(Ot.isString(e)&&(e=Lr(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Lr(l=e).call(l)))c((u=>{const h={};let p,m,g;return u&&u.split(`
`).forEach(function(S){var D,w;g=S.indexOf(":"),p=Lr(D=S.substring(0,g)).call(D).toLowerCase(),m=Lr(w=S.substring(g+1)).call(w),!p||h[p]&&j6[p]||(p==="set-cookie"?h[p]?h[p].push(m):h[p]=[m]:h[p]=h[p]?h[p]+", "+m:m)}),h})(e),n);else if(Ot.isHeaders(e))for(const[u,h]of e.entries())a(h,u,i);else e!=null&&a(n,e,i);var l;return this}get(e,n){if(e=MS(e)){const i=Ot.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return function(a){const c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=l.exec(a);)c[u[1]]=u[2];return c}(r);if(Ot.isFunction(n))return n.call(this,r,i);if(Ot.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=MS(e)){const i=Ot.findKey(this,e);return!(!i||this[i]===void 0||n&&!_A(0,this[i],i,n))}return!1}delete(e,n){const i=this;let r=!1;function a(c){if(c=MS(c)){const l=Ot.findKey(i,c);!l||n&&!_A(0,i[l],l,n)||(delete i[l],r=!0)}}return Ot.isArray(e)?e.forEach(a):a(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const a=n[i];e&&!_A(0,this[a],a,e,!0)||(delete this[a],r=!0)}return r}normalize(e){const n=this,i={};return Ot.forEach(this,(r,a)=>{var c;const l=Ot.findKey(i,a);if(l)return n[l]=fb(r),void delete n[a];const u=e?function(h){return Lr(h).call(h).toLowerCase().replace(/([a-z\d])(\w*)/g,(p,m,g)=>m.toUpperCase()+g)}(a):Lr(c=String(a)).call(c);u!==a&&delete n[a],n[u]=fb(r),i[u]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return Ot.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&Ot.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,i]=e;return n+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r.forEach(c=>n.set(c)),n}static accessor(e){const n=(this[cP]=this[cP]={accessors:{}}).accessors,i=this.prototype;function r(a){const c=MS(a);n[c]||(function(l,u){const h=Ot.toCamelCase(" "+u);["get","set","has"].forEach(p=>{Object.defineProperty(l,p+h,{value:function(m,g,S){return this[p].call(this,u,m,g,S)},configurable:!0})})}(i,a),n[c]=!0)}return Ot.isArray(e)?e.forEach(r):r(e),this}}mb.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ot.reduceDescriptors(mb.prototype,(t,e)=>{let{value:n}=t,i=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[i]=r}}}),Ot.freezeMethods(mb);var hc=mb;function gA(t,e){const n=this||EA,i=e||n,r=hc.from(i.headers);let a=i.data;return Ot.forEach(t,function(c){a=c.call(n,a,r.normalize(),e?e.status:void 0)}),r.normalize(),a}function lP(t){return!(!t||!t.__CANCEL__)}function NE(t,e,n){on.call(this,t??"canceled",on.ERR_CANCELED,e,n),this.name="CanceledError"}function dP(t,e,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(new on("Request failed with status code "+n.status,[on.ERR_BAD_REQUEST,on.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}Ot.inherits(NE,on,{__CANCEL__:!0});const Eb=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const r=function(a,c){a=a||10;const l=new Array(a),u=new Array(a);let h,p=0,m=0;return c=c!==void 0?c:1e3,function(g){const S=Date.now(),D=u[m];h||(h=S),l[p]=g,u[p]=S;let w=m,N=0;for(;w!==p;)N+=l[w++],w%=a;if(p=(p+1)%a,p===m&&(m=(m+1)%a),S-h<c)return;const k=D&&S-D;return k?Math.round(1e3*N/k):void 0}}(50,250);return function(a,c){let l,u,h=0,p=1e3/c;const m=function(g){h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),l=null,u&&(clearTimeout(u),u=null),a.apply(null,g)};return[function(){const g=Date.now(),S=g-h;for(var D=arguments.length,w=new Array(D),N=0;N<D;N++)w[N]=arguments[N];S>=p?m(w,g):(l=w,u||(u=setTimeout(()=>{u=null,m(l)},p-S)))},()=>l&&m(l)]}(a=>{const c=a.loaded,l=a.lengthComputable?a.total:void 0,u=c-i,h=r(u);i=c,t({loaded:c,total:l,progress:l?c/l:void 0,bytes:u,rate:h||void 0,estimated:h&&l&&c<=l?(l-c)/h:void 0,event:a,lengthComputable:l!=null,[e?"download":"upload"]:!0})},n)},uP=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},hP=t=>function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return Ot.asap(()=>t(...n))};var V6=Ss.hasStandardBrowserEnv?((t,e)=>n=>(n=new Kv(n,Ss.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new Kv(Ss.origin),Ss.navigator&&/(msie|trident)/i.test(Ss.navigator.userAgent)):()=>!0,B6=Ss.hasStandardBrowserEnv?{write(t,e,n,i,r,a){const c=[t+"="+encodeURIComponent(e)];Ot.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),Ot.isString(i)&&c.push("path="+i),Ot.isString(r)&&c.push("domain="+r),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function pP(t,e){return t&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(e)?function(n,i){return i?n.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):n}(t,e):e}function fP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const mP=t=>t instanceof hc?function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?fP(Object(i),!0).forEach(function(r){P(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t):t;function Jp(t,e){e=e||{};const n={};function i(h,p,m,g){return Ot.isPlainObject(h)&&Ot.isPlainObject(p)?Ot.merge.call({caseless:g},h,p):Ot.isPlainObject(p)?Ot.merge({},p):Ot.isArray(p)?p.slice():p}function r(h,p,m,g){return Ot.isUndefined(p)?Ot.isUndefined(h)?void 0:i(void 0,h,0,g):i(h,p,0,g)}function a(h,p){if(!Ot.isUndefined(p))return i(void 0,p)}function c(h,p){return Ot.isUndefined(p)?Ot.isUndefined(h)?void 0:i(void 0,h):i(void 0,p)}function l(h,p,m){return m in e?i(h,p):m in t?i(void 0,h):void 0}const u={url:a,method:a,data:a,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(h,p,m)=>r(mP(h),mP(p),0,!0)};return Ot.forEach(Object.keys(Object.assign({},t,e)),function(h){const p=u[h]||r,m=p(t[h],e[h],h);Ot.isUndefined(m)&&p!==l||(n[h]=m)}),n}var EP=t=>{const e=Jp({},t);let n,{data:i,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:c,headers:l,auth:u}=e;if(e.headers=l=hc.from(l),e.url=PD(pP(e.baseURL,e.url),t.params,t.paramsSerializer),u&&l.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),Ot.isFormData(i)){if(Ss.hasStandardBrowserEnv||Ss.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((n=l.getContentType())!==!1){const[h,...p]=n?n.split(";").map(m=>Lr(m).call(m)).filter(Boolean):[];l.setContentType([h||"multipart/form-data",...p].join("; "))}}if(Ss.hasStandardBrowserEnv&&(r&&Ot.isFunction(r)&&(r=r(e)),r||r!==!1&&V6(e.url))){const h=a&&c&&B6.read(c);h&&l.set(a,h)}return e},F6=typeof XMLHttpRequest<"u"&&function(t){return new wt(function(e,n){const i=EP(t);let r=i.data;const a=hc.from(i.headers).normalize();let c,l,u,h,p,{responseType:m,onUploadProgress:g,onDownloadProgress:S}=i;function D(){h&&h(),p&&p(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let w=new XMLHttpRequest;function N(){if(!w)return;const x=hc.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders());dP(function(W){e(W),D()},function(W){n(W),D()},{data:m&&m!=="text"&&m!=="json"?w.response:w.responseText,status:w.status,statusText:w.statusText,headers:x,config:t,request:w}),w=null}w.open(i.method.toUpperCase(),i.url,!0),w.timeout=i.timeout,"onloadend"in w?w.onloadend=N:w.onreadystatechange=function(){w&&w.readyState===4&&(w.status!==0||w.responseURL&&w.responseURL.indexOf("file:")===0)&&setTimeout(N)},w.onabort=function(){w&&(n(new on("Request aborted",on.ECONNABORTED,t,w)),w=null)},w.onerror=function(){n(new on("Network Error",on.ERR_NETWORK,t,w)),w=null},w.ontimeout=function(){let x=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const W=i.transitional||xD;i.timeoutErrorMessage&&(x=i.timeoutErrorMessage),n(new on(x,W.clarifyTimeoutError?on.ETIMEDOUT:on.ECONNABORTED,t,w)),w=null},r===void 0&&a.setContentType(null),"setRequestHeader"in w&&Ot.forEach(a.toJSON(),function(x,W){w.setRequestHeader(W,x)}),Ot.isUndefined(i.withCredentials)||(w.withCredentials=!!i.withCredentials),m&&m!=="json"&&(w.responseType=i.responseType),S&&([u,p]=Eb(S,!0),w.addEventListener("progress",u)),g&&w.upload&&([l,h]=Eb(g),w.upload.addEventListener("progress",l),w.upload.addEventListener("loadend",h)),(i.cancelToken||i.signal)&&(c=x=>{w&&(n(!x||x.type?new NE(null,t,w):x),w.abort(),w=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const k=function(x){const W=/^([-+\w]{1,25})(:?\/\/|:)/.exec(x);return W&&W[1]||""}(i.url);k&&Ss.protocols.indexOf(k)===-1?n(new on("Unsupported protocol "+k+":",on.ERR_BAD_REQUEST,t)):w.send(r||null)})},G6=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i,r=new AbortController;const a=function(h){if(!i){i=!0,l();const p=h instanceof Error?h:this.reason;r.abort(p instanceof on?p:new NE(p instanceof Error?p.message:p))}};let c=e&&setTimeout(()=>{c=null,a(new on("timeout ".concat(e," of ms exceeded"),on.ETIMEDOUT))},e);const l=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(h=>{h.unsubscribe?h.unsubscribe(a):h.removeEventListener("abort",a)}),t=null)};t.forEach(h=>h.addEventListener("abort",a));const{signal:u}=r;return u.unsubscribe=()=>Ot.asap(l),u}},H6=pE,W6=Oa;Qe({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=W6.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var K6=Oa,z6=Ji;Qe({target:"Promise",stat:!0,forced:!0},{try:function(t){var e=K6.f(this),n=z6(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var SA=L(H6),_P=AE.f("asyncIterator"),Y6=L(_P);function yA(t,e){this.v=t,this.k=e}function US(t){var e,n;function i(a,c){try{var l=t[a](c),u=l.value,h=u instanceof yA;SA.resolve(h?u.v:u).then(function(p){if(h){var m=a==="return"?"return":"next";if(!u.k||p.done)return i(m,p);p=t[m](p).value}r(l.done?"return":"normal",p)},function(p){i("throw",p)})}catch(p){r("throw",p)}}function r(a,c){switch(a){case"return":e.resolve({value:c,done:!0});break;case"throw":e.reject(c);break;default:e.resolve({value:c,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(a,c){return new SA(function(l,u){var h={key:a,arg:c,resolve:l,reject:u,next:null};n?n=n.next=h:(e=n=h,i(a,c))})},typeof t.return!="function"&&(this.return=void 0)}function Da(t){return function(){return new US(t.apply(this,arguments))}}function Fe(t){return new yA(t,0)}function _b(t){var e={},n=!1;function i(r,a){return n=!0,{done:!1,value:new yA(a=new SA(function(c){c(t[r](a))}),1)}}return e[OE!==void 0&&KL||"@@iterator"]=function(){return this},e.next=function(r){return n?(n=!1,r):i("next",r)},typeof t.throw=="function"&&(e.throw=function(r){if(n)throw n=!1,r;return i("throw",r)}),typeof t.return=="function"&&(e.return=function(r){return n?(n=!1,r):i("return",r)}),e}US.prototype[typeof OE=="function"&&Y6||"@@asyncIterator"]=function(){return this},US.prototype.next=function(t){return this._invoke("next",t)},US.prototype.throw=function(t){return this._invoke("throw",t)},US.prototype.return=function(t){return this._invoke("return",t)};var TA=L(_P);function vA(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=TA,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new gb(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function gb(t){function e(n){if(Object(n)!==n)return wt.reject(new TypeError(n+" is not an object."));var i=n.done;return wt.resolve(n.value).then(function(r){return{value:r,done:i}})}return gb=function(n){this.s=n,this.n=n.next},gb.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?wt.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?wt.reject(n):e(i.apply(this.s,arguments))}},new gb(t)}const q6=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let i,r=0;for(;r<n;)i=r+e,yield t.slice(r,i),r=i},X6=function(){var t=Da(function*(e,n){var i,r=!1,a=!1;try{for(var c,l=vA(J6(e));r=!(c=yield Fe(l.next())).done;r=!1){const u=c.value;yield*_b(vA(q6(u,n)))}}catch(u){a=!0,i=u}finally{try{r&&l.return!=null&&(yield Fe(l.return()))}finally{if(a)throw i}}});return function(e,n){return t.apply(this,arguments)}}(),J6=function(){var t=Da(function*(e){if(e[TA])return void(yield*_b(vA(e)));const n=e.getReader();try{for(;;){const{done:i,value:r}=yield Fe(n.read());if(i)break;yield r}}finally{yield Fe(n.cancel())}});return function(e){return t.apply(this,arguments)}}(),gP=(t,e,n,i)=>{const r=X6(t,e);let a,c=0,l=u=>{a||(a=!0,i&&i(u))};return new ReadableStream({async pull(u){try{const{done:h,value:p}=await r.next();if(h)return l(),void u.close();let m=p.byteLength;if(n){let g=c+=m;n(g)}u.enqueue(new Uint8Array(p))}catch(h){throw l(h),h}},cancel:u=>(l(u),r.return())},{highWaterMark:2})};function SP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function yP(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?SP(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):SP(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Sb=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",TP=Sb&&typeof ReadableStream=="function",Q6=Sb&&(typeof TextEncoder=="function"?(vP=new TextEncoder,t=>vP.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var vP;const bP=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return!!t(...n)}catch{return!1}},Z6=TP&&bP(()=>{let t=!1;const e=new Request(Ss.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),bA=TP&&bP(()=>Ot.isReadableStream(new Response("").body)),yb={stream:bA&&(t=>t.body)};var RP;Sb&&(RP=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!yb[t]&&(yb[t]=Ot.isFunction(RP[t])?e=>e[t]():(e,n)=>{throw new on("Response type '".concat(t,"' is not supported"),on.ERR_NOT_SUPPORT,n)})}));const $6=async(t,e)=>{const n=Ot.toFiniteNumber(t.getContentLength());return n??(async i=>i==null?0:Ot.isBlob(i)?i.size:Ot.isSpecCompliantForm(i)?(await new Request(Ss.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:Ot.isArrayBufferView(i)||Ot.isArrayBuffer(i)?i.byteLength:(Ot.isURLSearchParams(i)&&(i+=""),Ot.isString(i)?(await Q6(i)).byteLength:void 0))(e)};var tG=Sb&&(async t=>{let{url:e,method:n,data:i,signal:r,cancelToken:a,timeout:c,onDownloadProgress:l,onUploadProgress:u,responseType:h,headers:p,withCredentials:m="same-origin",fetchOptions:g}=EP(t);h=h?(h+"").toLowerCase():"text";let S,D=G6([r,a&&a.toAbortSignal()],c);const w=D&&D.unsubscribe&&(()=>{D.unsubscribe()});let N;try{if(u&&Z6&&n!=="get"&&n!=="head"&&(N=await $6(p,i))!==0){let $,q=new Request(e,{method:"POST",body:i,duplex:"half"});if(Ot.isFormData(i)&&($=q.headers.get("content-type"))&&p.setContentType($),q.body){const[ot,_t]=uP(N,Eb(hP(u)));i=gP(q.body,65536,ot,_t)}}Ot.isString(m)||(m=m?"include":"omit");const k="credentials"in Request.prototype;S=new Request(e,yP(yP({},g),{},{signal:D,method:n.toUpperCase(),headers:p.normalize().toJSON(),body:i,duplex:"half",credentials:k?m:void 0}));let x=await fetch(S);const W=bA&&(h==="stream"||h==="response");if(bA&&(l||W&&w)){const $={};["status","statusText","headers"].forEach(Nt=>{$[Nt]=x[Nt]});const q=Ot.toFiniteNumber(x.headers.get("content-length")),[ot,_t]=l&&uP(q,Eb(hP(l),!0))||[];x=new Response(gP(x.body,65536,ot,()=>{_t&&_t(),w&&w()}),$)}h=h||"text";let Z=await yb[Ot.findKey(yb,h)||"text"](x,t);return!W&&w&&w(),await new wt(($,q)=>{dP($,q,{data:Z,headers:hc.from(x.headers),status:x.status,statusText:x.statusText,config:t,request:S})})}catch(k){throw w&&w(),k&&k.name==="TypeError"&&/fetch/i.test(k.message)?Object.assign(new on("Network Error",on.ERR_NETWORK,t,S),{cause:k.cause||k}):on.from(k,k&&k.code,t,S)}});const RA={http:null,xhr:F6,fetch:tG};Ot.forEach(RA,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const CP=t=>"- ".concat(t),eG=t=>Ot.isFunction(t)||t===null||t===!1;var AP={getAdapter:t=>{t=Ot.isArray(t)?t:[t];const{length:e}=t;let n,i;const r={};for(let a=0;a<e;a++){let c;if(n=t[a],i=n,!eG(n)&&(i=RA[(c=String(n)).toLowerCase()],i===void 0))throw new on("Unknown adapter '".concat(c,"'"));if(i)break;r[c||"#"+a]=i}if(!i){const a=Object.entries(r).map(c=>{let[l,u]=c;return"adapter ".concat(l," ")+(u===!1?"is not supported by the environment":"is not available in the build")});throw new on("There is no suitable adapter to dispatch the request "+(e?a.length>1?`since :
`+a.map(CP).join(`
`):" "+CP(a[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:RA};function CA(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new NE(null,t)}function wP(t){return CA(t),t.headers=hc.from(t.headers),t.data=gA.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),AP.getAdapter(t.adapter||EA.adapter)(t).then(function(e){return CA(t),e.data=gA.call(t,t.transformResponse,e),e.headers=hc.from(e.headers),e},function(e){return lP(e)||(CA(t),e&&e.response&&(e.response.data=gA.call(t,t.transformResponse,e.response),e.response.headers=hc.from(e.response.headers))),wt.reject(e)})}const IP="1.7.9",Tb={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Tb[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const OP={};Tb.transitional=function(t,e,n){function i(r,a){return"[Axios v"+IP+"] Transitional option '"+r+"'"+a+(n?". "+n:"")}return(r,a,c)=>{if(t===!1)throw new on(i(a," has been removed"+(e?" in "+e:"")),on.ERR_DEPRECATED);return e&&!OP[a]&&(OP[a]=!0,console.warn(i(a," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,a,c)}},Tb.spelling=function(t){return(e,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(t)),!0)};var vb={assertOptions:function(t,e,n){if(typeof t!="object")throw new on("options must be an object",on.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const a=i[r],c=e[a];if(c){const l=t[a],u=l===void 0||c(l,a,t);if(u!==!0)throw new on("option "+a+" must be "+u,on.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new on("Unknown option "+a,on.ERR_BAD_OPTION)}},validators:Tb};const cl=vb.validators;let bb=class{constructor(t){this.defaults=t,this.interceptors={request:new kD,response:new kD}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+r):n.stack=r}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=Jp(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:r}=e;n!==void 0&&vb.assertOptions(n,{silentJSONParsing:cl.transitional(cl.boolean),forcedJSONParsing:cl.transitional(cl.boolean),clarifyTimeoutError:cl.transitional(cl.boolean)},!1),i!=null&&(Ot.isFunction(i)?e.paramsSerializer={serialize:i}:vb.assertOptions(i,{encode:cl.function,serialize:cl.function},!0)),vb.assertOptions(e,{baseUrl:cl.spelling("baseURL"),withXsrfToken:cl.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=r&&Ot.merge(r.common,r[e.method]);r&&Ot.forEach(["delete","get","head","post","put","patch","common"],S=>{delete r[S]}),e.headers=hc.concat(a,r);const c=[];let l=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(e)===!1||(l=l&&S.synchronous,c.unshift(S.fulfilled,S.rejected))});const u=[];let h;this.interceptors.response.forEach(function(S){u.push(S.fulfilled,S.rejected)});let p,m=0;if(!l){const S=[wP.bind(this),void 0];for(S.unshift.apply(S,c),S.push.apply(S,u),p=S.length,h=wt.resolve(e);m<p;)h=h.then(S[m++],S[m++]);return h}p=c.length;let g=e;for(m=0;m<p;){const S=c[m++],D=c[m++];try{g=S(g)}catch(w){D.call(this,w);break}}try{h=wP.call(this,g)}catch(S){return wt.reject(S)}for(m=0,p=u.length;m<p;)h=h.then(u[m++],u[m++]);return h}getUri(t){return PD(pP((t=Jp(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};Ot.forEach(["delete","get","head","options"],function(t){bb.prototype[t]=function(e,n){return this.request(Jp(n||{},{method:t,url:e,data:(n||{}).data}))}}),Ot.forEach(["post","put","patch"],function(t){function e(n){return function(i,r,a){return this.request(Jp(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}bb.prototype[t]=e(),bb.prototype[t+"Form"]=e(!0)});var Rb=bb;class AA{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new wt(function(r){n=r});const i=this;this.promise.then(r=>{if(!i._listeners)return;let a=i._listeners.length;for(;a-- >0;)i._listeners[a](r);i._listeners=null}),this.promise.then=r=>{let a;const c=new wt(l=>{i.subscribe(l),a=l}).then(r);return c.cancel=function(){i.unsubscribe(a)},c},e(function(r,a,c){i.reason||(i.reason=new NE(r,a,c),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new AA(function(i){e=i}),cancel:e}}}var nG=AA;const wA={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(wA).forEach(t=>{let[e,n]=t;wA[n]=e});var iG=wA;const Tr=function t(e){const n=new Rb(e),i=mD(Rb.prototype.request,n);return Ot.extend(i,Rb.prototype,n,{allOwnKeys:!0}),Ot.extend(i,n,null,{allOwnKeys:!0}),i.create=function(r){return t(Jp(e,r))},i}(EA);Tr.Axios=Rb,Tr.CanceledError=NE,Tr.CancelToken=nG,Tr.isCancel=lP,Tr.VERSION=IP,Tr.toFormData=ib,Tr.AxiosError=on,Tr.Cancel=Tr.CanceledError,Tr.all=function(t){return wt.all(t)},Tr.spread=function(t){return function(e){return t.apply(null,e)}},Tr.isAxiosError=function(t){return Ot.isObject(t)&&t.isAxiosError===!0},Tr.mergeConfig=Jp,Tr.AxiosHeaders=hc,Tr.formToJSON=t=>oP(Ot.isHTMLForm(t)?new FormData(t):t),Tr.getAdapter=AP.getAdapter,Tr.HttpStatusCode=iG,Tr.default=Tr;var ss=Tr;const rG=()=>{};function jS(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:rG};return t.promise=new wt((e,n)=>{t.resolve=i=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(i),t.value=i)},t.reject=i=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(i))}}),t}const Cb=new Map,Ab=new Map,ll=new Map;let Ai=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Ye=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const NP=new TF;let pc=NP.getResult(),IA=null;function Ge(t){if(!IA){pc=NP.getResult();const e=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return Ye.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ye.CHROME;case"Safari":case"Mobile Safari":return Ye.SAFARI;case"Edge":return Ye.EDGE;case"Firefox":return Ye.FIREFOX;case"QQ":case"QQBrowser":return Ye.QQ;case"Opera":return Ye.OPERA;case"WeChat":return Ye.WECHAT;default:return l.browser.name||""}}(pc),n=DP(pc),i=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}(pc),r=pc.os.version,a=DP(pc,!1),c=pc.device.type;if(!(e&&n&&i&&r))return{name:e,version:n,os:i,osVersion:r,browserVersion:a,deviceType:c};IA={name:e,version:n,os:i,osVersion:r,browserVersion:a,deviceType:c}}return IA}function DP(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function wb(){return Ge().os}function LP(){const t=Ge();return"".concat(t.os," ").concat(t.osVersion)}function Ib(){const t=Ge();return!!(pc.engine.name==="WebKit"&&t.os===Ai.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Ye.SAFARI||Yr()&&t.name!==Ye.SAFARI)}function md(){return Ge().name===Ye.CHROME}function $i(){return Ge().name===Ye.SAFARI}function PP(){return Ge().name===Ye.EDGE}function Vn(){return Ge().name===Ye.FIREFOX}function Yr(){return Ge().os===Ai.IOS}function VS(t){const e=Ge();return!(e.name!==Ye.CHROME||!e.osVersion)&&Number(e.version)>=t}function kP(t){const e=Ge();return!(e.name!==Ye.CHROME||!e.osVersion)&&Number(e.version)<t}function OA(t,e,n){const i=Ge();return!(i.name!==t||!i.osVersion)&&(n?Number(i.version)>=e&&Number(i.version)<=n:Number(i.version)===e)}function NA(t){const e=Ge();return!(e.name!==Ye.EDGE||!e.osVersion)&&Number(e.version)>=t}function xP(t){const e=Ge();return!(e.name!==Ye.SAFARI||!e.osVersion)&&Number(e.version)>=t}function MP(t,e,n){const i=Ge();if(i.os!==Ai.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t}function UP(t,e,n){const i=Ge();if(i.name!==Ye.SAFARI||!i.osVersion||!i.browserVersion)return!1;const r=i.browserVersion.split(".");return n?e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t:e?Number(r[0])===t&&Number(r[1])<=e||Number(r[0])<t:Number(r[0])<=t}function DA(t){const e=Ge();return!(e.name!==Ye.OPERA||!e.osVersion)&&Number(e.version)>=t}function jP(){const t=Ge();if(t.os!==Ai.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function DE(){const t=Ge();if(t.os!==Ai.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function LA(){const t=Ge();if(t.os!==Ai.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function VP(){const t=Ge();if(t.os!==Ai.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function yo(){return $i()&&navigator.maxTouchPoints>0}function BP(){return Ge().name===Ye.WECHAT}function FP(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function PA(){const t=wb();return function(){const{deviceType:e}=Ge();return e==="mobile"||e==="tablet"}()||t===Ai.ANDROID||t===Ai.IOS||t===Ai.HARMONY_OS}function Ed(){const t=Ge();return t.name!==Ye.EDGE&&t.name!==Ye.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Ob(){return wb()===Ai.ANDROID}function BS(){const t=Ge();return Ob()&&(t.name===Ye.CHROME||t.name===Ye.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function GP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Vt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?GP(Object(n),!0).forEach(function(i){fe(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):GP(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function fe(t,e,n){return(e=function(i){var r=function(a,c){if(typeof a!="object"||a===null)return a;var l=a[Symbol.toPrimitive];if(l!==void 0){var u=l.call(a,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}let M=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),ct=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),fe(this,"code",void 0),fe(this,"message",void 0),fe(this,"data",void 0),fe(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function _d(t,e){if(typeof t!="boolean")throw new ct(M.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function bi(t,e,n){if(!At(n).call(n,t))throw new ct(M.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function cn(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(r){return typeof r=="number"&&r%1==0}(t))throw new ct(M.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function kA(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new ct(M.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&cn(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&cn(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&cn(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&cn(t.ideal,"".concat(e,".ideal"),1,1/0)}else cn(t,e,1,1/0)}function Gi(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new ct(M.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!HP(t,n,i,r))throw new ct(M.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function gd(t,e){if(!Array.isArray(t))throw new ct(M.INVALID_PARAMS,"".concat(e," should be an array"))}function Bn(t){return t==null}function HP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!i||function(r){if(typeof r!="string")return!1;for(let a=0;a<r.length;a+=1){const c=r.charCodeAt(a);if(c<0||c>255)return!1}return!0}(t))}var FS=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(FS||{}),xA=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(xA||{});const WP=new class{constructor(){fe(this,"_clientSize",null),fe(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),fe(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),fe(this,"getStyle",t=>window.getComputedStyle(t,null)),fe(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const i=this.getStyle(t),{display:r,visibility:a,opacity:c,filter:l}=i;return(r==="none"||At(e=["hidden","collapse"]).call(e,a)||Number(c)<.1)&&(n=!1),!!n&&(l&&l.split(" ").filter(u=>{var h;const p=u.split("(")[0];return At(h=["brightness","blur","opacity"]).call(h,p)}).map(u=>{const[h,p]=u.split(/\(|\)/);return[h,Number(p.match(/^[0-9\.]+/))]}).forEach(u=>{const[h,p]=u;switch(h){case"brightness":(p<.1||p>3)&&(n=!1);break;case"blur":p>3&&(n=!1);break;case"opacity":p<.1&&(n=!1)}}),n)}),fe(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,i=!0;const r=c=>e(c);let a=t;for(;a&&i;)r(a)||(n=!1,i=!1),a=a.parentElement,a||(i=!1);return n}),fe(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),fe(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:i,right:r,top:a,bottom:c}=t.getBoundingClientRect(),l=this.getClientWidth(),u=this.getClientHeight();return{width:e,height:n,left:i,right:r,top:a,bottom:c,clientWidth:l,clientHeight:u,clientMin:Math.min(l,u)}}),fe(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),fe(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),fe(this,"checkCoverForAPoint",(t,e,n)=>{const i=this.elementFromPoint(t,e);return i!==null&&i!==n}),fe(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:i}=this._clientSize,r=t/6,a=e/6,c=[],l=10**6;for(let u=0;u<5;u++)for(let h=0;h<5;h++){const p=(n*l+(u===0?.1:u===4?(r*u*l-1e5)/l:r*u)*l)/l,m=(i*l+(h===0?.1:h===4?(a*h*l-1e5)/l:a*h)*l)/l;c.push({x:p,y:m})}return[...c]}),fe(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),fe(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),fe(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:i,clientHeight:r,clientWidth:a,clientMin:c}=this._clientSize;let l,u,h,p;if(t<0)l=0;else{if(!(t<a))return!1;l=t}if(e<0)return!1;if(u=e<a?e:a,n<0)h=0;else{if(!(n<r))return!1;h=n}if(i<0)return!1;p=i<r?i:r;const m=u-l,g=p-h;return this.checkSizeIsVisible(m,g,c)}),fe(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),fe(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(FS.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(FS.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(FS.SIZE)}}return this.returnHiddenResult(FS.STYLE)}return this.returnHiddenResult(xA.UNMOUNTED)}return this.returnHiddenResult(xA.INVALID_HTML_ELEMENT)}),fe(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function MA(t){return new TextEncoder().encode(t)}const KP=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},UA=async t=>function(e,n){let i="";return new Uint8Array(e).forEach(r=>{i+=r.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",MA(t)),16);let Mn=class{constructor(){fe(this,"_events",{}),fe(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],i=this._indexOfListener(n,e);i!==-1&&n.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(a=>a);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(let a=0;a<e.length;a+=1){const c=e[a];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];[...this._events[t]||[]].forEach(r=>{r.once&&this.off(t,r.listener);try{r.listener.apply(this,n)}catch(a){console.error("safeEmit event:".concat(t," error ").concat(a==null?void 0:a.toString()))}})}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}},GS=null;function zP(){if(GS)return GS;if(window.electron)return GS=window.electron;if(!window.require)return null;try{return GS=window.require("electron"),GS}catch{return null}}let ui=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),Fn=function(t){return t.TRACER="tracer",t}({});function YP(t){return cn(t.timeout,"config.timeout",0,1e5),cn(t.timeoutFactor,"config.timeoutFactor",0,100,!1),cn(t.maxRetryCount,"config.maxRetryConfig",0,1/0),cn(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let sG=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Ze=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function HS(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function qP(t){return Gi(t.turnServerURL,"turnServerURL"),Gi(t.username,"username"),Gi(t.password,"password"),t.udpport&&cn(t.udpport,"udpport",1,99999,!0),t.forceturn&&_d(t.forceturn,"forceturn"),t.security&&_d(t.security,"security"),t.tcpport&&cn(t.tcpport,"tcpport",1,99999,!0),!0}function jA(t){return t.level!==void 0&&bi(t.level,"level",[1,2,3]),t.delay!==void 0&&cn(t.delay,"delay",0,3e3,!0),!0}let De=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),tr=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),Hs=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),LE=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function er(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return t.getListeners(e).length===0?wt.reject(new ct(M.UNEXPECTED_ERROR,"can not emit promise")):new wt((a,c)=>{t.emit(e,...i,a,c)})}function mn(t,e){if(t.getListeners(e).length===0)return wt.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return er(t,e,...i)}function sa(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return WS(t,e,...i)}function WS(t,e){let n=null,i=null;for(var r=arguments.length,a=new Array(r>2?r-2:0),c=2;c<r;c++)a[c-2]=arguments[c];if(t.emit(e,...a,l=>{n=l},l=>{i=l}),i!==null)throw i;if(n===null)throw new ct(M.UNEXPECTED_ERROR,"handler is not sync");return n}const si=new class extends Mn{set networkState(t){this.emit(LE.NETWORK_STATE_CHANGE,t,this._networkState),t===Hs.ONLINE?this.emit(LE.ONLINE):t===Hs.OFFLINE&&(this.onlineWaiter=new wt(e=>{this.once(LE.ONLINE,()=>{this.onlineWaiter=void 0,e(Hs.ONLINE)})}),this.emit(LE.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Hs.ONLINE}constructor(){super(),fe(this,"_moduleName","network-indicator"),fe(this,"_networkState",Hs.ONLINE),fe(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Hs.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Hs.OFFLINE})}};function Nb(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function PE(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function Db(t){wt!==void 0?wt.resolve().then(t):setTimeout(t,0)}function Gn(t){return JSON.parse(JSON.stringify(t))}function Qp(t){try{return Gn(t)}catch{return t}}const XP={};function Wu(t,e){XP[e]||(XP[e]=!0,t())}function Zp(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)n[i]=e.charCodeAt(i);return n}function Ku(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function JP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const i=new Uint8Array(e);i.set(n),n=i}return n}function QP(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=ms(e).call(e,(c,l)=>c+l.length,0),r=new Uint8Array(new ArrayBuffer(i));let a=0;return e.forEach(c=>{r.set(c,a),a+=c.length}),r}function dl(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function ZP(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?dl(n):n.size}),e+138}function aG(t){const e=new ct(M.TIMEOUT,"timeout");return new wt((n,i)=>{window.setTimeout(()=>i(e),t)})}function Hi(t){return new wt(e=>{window.setTimeout(e,t)})}function En(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+En(t-n.length,"")}function $p(){return En(32,"").toUpperCase()}const Lb=()=>{},$P=new class{constructor(){fe(this,"fnMap",new Map)}throttleByKey(t,e,n,i){for(var r=arguments.length,a=new Array(r>4?r-4:0),c=4;c<r;c++)a[c-4]=arguments[c];if(this.fnMap.has(e)){const l=this.fnMap.get(e);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const u=window.setTimeout(()=>{const h=this.fnMap.get(e);h&&h.fn(...h.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:u,args:a,skipFn:i})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(e,Vt(Vt({},l),{},{fn:t,args:a,skipFn:i}))}else{const l=window.setTimeout(()=>{const u=this.fnMap.get(e);u&&u.fn(...u.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:l,args:a,skipFn:i})}}},tk=$P.throttleByKey.bind($P);function ek(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function VA(t,e){if(!ek(t)||!ek(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let i=0;i<e.length;i++)n[i]=VA(t[i],e[i]);return n}{const n=Vt({},t);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)?n[i]=VA(t[i],e[i]):n[i]=e[i]);return n}}function nk(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let i=0;for(;t>0&&(n[i]=255&t,t>>=8,i++,i!==e););return n}function BA(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function ik(t){const e="0123456789abcdef";function n(W){let Z,$="";for(Z=0;Z<=3;Z++)$+=e.charAt(W>>8*Z+4&15)+e.charAt(W>>8*Z&15);return $}function i(W,Z){const $=(65535&W)+(65535&Z);return(W>>16)+(Z>>16)+($>>16)<<16|65535&$}function r(W,Z,$,q,ot,_t){return i(function(Nt,Mt){return Nt<<Mt|Nt>>>32-Mt}(i(i(Z,W),i(q,_t)),ot),$)}function a(W,Z,$,q,ot,_t,Nt){return r(Z&$|~Z&q,W,Z,ot,_t,Nt)}function c(W,Z,$,q,ot,_t,Nt){return r(Z&q|$&~q,W,Z,ot,_t,Nt)}function l(W,Z,$,q,ot,_t,Nt){return r(Z^$^q,W,Z,ot,_t,Nt)}function u(W,Z,$,q,ot,_t,Nt){return r($^(Z|~q),W,Z,ot,_t,Nt)}const h=function(W){let Z;const $=1+(W.length+8>>6),q=new Array(16*$);for(Z=0;Z<16*$;Z++)q[Z]=0;for(Z=0;Z<W.length;Z++)q[Z>>2]|=W.charCodeAt(Z)<<Z%4*8;return q[Z>>2]|=128<<Z%4*8,q[16*$-2]=8*W.length,q}(t);let p,m,g,S,D,w=1732584193,N=-271733879,k=-1732584194,x=271733878;for(p=0;p<h.length;p+=16)m=w,g=N,S=k,D=x,w=a(w,N,k,x,h[p+0],7,-680876936),x=a(x,w,N,k,h[p+1],12,-389564586),k=a(k,x,w,N,h[p+2],17,606105819),N=a(N,k,x,w,h[p+3],22,-1044525330),w=a(w,N,k,x,h[p+4],7,-176418897),x=a(x,w,N,k,h[p+5],12,1200080426),k=a(k,x,w,N,h[p+6],17,-1473231341),N=a(N,k,x,w,h[p+7],22,-45705983),w=a(w,N,k,x,h[p+8],7,1770035416),x=a(x,w,N,k,h[p+9],12,-1958414417),k=a(k,x,w,N,h[p+10],17,-42063),N=a(N,k,x,w,h[p+11],22,-1990404162),w=a(w,N,k,x,h[p+12],7,1804603682),x=a(x,w,N,k,h[p+13],12,-40341101),k=a(k,x,w,N,h[p+14],17,-1502002290),N=a(N,k,x,w,h[p+15],22,1236535329),w=c(w,N,k,x,h[p+1],5,-165796510),x=c(x,w,N,k,h[p+6],9,-1069501632),k=c(k,x,w,N,h[p+11],14,643717713),N=c(N,k,x,w,h[p+0],20,-373897302),w=c(w,N,k,x,h[p+5],5,-701558691),x=c(x,w,N,k,h[p+10],9,38016083),k=c(k,x,w,N,h[p+15],14,-660478335),N=c(N,k,x,w,h[p+4],20,-405537848),w=c(w,N,k,x,h[p+9],5,568446438),x=c(x,w,N,k,h[p+14],9,-1019803690),k=c(k,x,w,N,h[p+3],14,-187363961),N=c(N,k,x,w,h[p+8],20,1163531501),w=c(w,N,k,x,h[p+13],5,-1444681467),x=c(x,w,N,k,h[p+2],9,-51403784),k=c(k,x,w,N,h[p+7],14,1735328473),N=c(N,k,x,w,h[p+12],20,-1926607734),w=l(w,N,k,x,h[p+5],4,-378558),x=l(x,w,N,k,h[p+8],11,-2022574463),k=l(k,x,w,N,h[p+11],16,1839030562),N=l(N,k,x,w,h[p+14],23,-35309556),w=l(w,N,k,x,h[p+1],4,-1530992060),x=l(x,w,N,k,h[p+4],11,1272893353),k=l(k,x,w,N,h[p+7],16,-155497632),N=l(N,k,x,w,h[p+10],23,-1094730640),w=l(w,N,k,x,h[p+13],4,681279174),x=l(x,w,N,k,h[p+0],11,-358537222),k=l(k,x,w,N,h[p+3],16,-722521979),N=l(N,k,x,w,h[p+6],23,76029189),w=l(w,N,k,x,h[p+9],4,-640364487),x=l(x,w,N,k,h[p+12],11,-421815835),k=l(k,x,w,N,h[p+15],16,530742520),N=l(N,k,x,w,h[p+2],23,-995338651),w=u(w,N,k,x,h[p+0],6,-198630844),x=u(x,w,N,k,h[p+7],10,1126891415),k=u(k,x,w,N,h[p+14],15,-1416354905),N=u(N,k,x,w,h[p+5],21,-57434055),w=u(w,N,k,x,h[p+12],6,1700485571),x=u(x,w,N,k,h[p+3],10,-1894986606),k=u(k,x,w,N,h[p+10],15,-1051523),N=u(N,k,x,w,h[p+1],21,-2054922799),w=u(w,N,k,x,h[p+8],6,1873313359),x=u(x,w,N,k,h[p+15],10,-30611744),k=u(k,x,w,N,h[p+6],15,-1560198380),N=u(N,k,x,w,h[p+13],21,1309151649),w=u(w,N,k,x,h[p+4],6,-145523070),x=u(x,w,N,k,h[p+11],10,-1120210379),k=u(k,x,w,N,h[p+2],15,718787259),N=u(N,k,x,w,h[p+9],21,-343485551),w=i(w,m),N=i(N,g),k=i(k,S),x=i(x,D);return n(w)+n(N)+n(k)+n(x)}let oG=1,rk=console,lr=class{static setLogger(t){rk=t}constructor(t,e){fe(this,"id",void 0),fe(this,"lockingPromise",wt.resolve()),fe(this,"locks",0),fe(this,"name",""),fe(this,"lockId",void 0),this.lockId=oG++,t&&(this.name=t),e&&(this.id=e),this.logger("created")}logger(t,e){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(e??"");rk.debug("".concat(n," ").concat(i))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,this.logger("locked",t);const n=new wt(r=>{e=()=>{this.locks-=1,this.logger("unlocked",t),r()}}),i=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function kE(t,e){return function(n,i,r){const a=r.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this[e];if(!c)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const l=await c.lock("From ".concat(t,".").concat(i));try{for(var u=arguments.length,h=new Array(u),p=0;p<u;p++)h[p]=arguments[p];return await a.apply(this,h)}finally{l()}},r}}const hi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function FA(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function fc(t,e,n,i){const r=Object.assign({},hi,i);let a=r.timeout;const c=async()=>{await function(h){return new wt(p=>{window.setTimeout(p,h)})}(a),a*=r.timeoutFactor,a=Math.min(r.maxRetryTimeout,a)};let l=!1;const u=new wt(async(h,p)=>{e=e||(()=>!1),n=n||(()=>!0);for(let m=0;m<r.maxRetryCount;m+=1){if(l)return p(new ct(M.OPERATION_ABORTED));try{const g=await t();if(!e(g,m)||m+1===r.maxRetryCount)return h(g);await c()}catch(g){if(!n(g,m)||m+1===r.maxRetryCount)return p(g);await c()}}});return u.cancel=()=>l=!0,u}let Pb,sk=class{constructor(t){fe(this,"input",[]),fe(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:ms(t=this.input).call(t,(e,n)=>e+n)/this.input.length}},kb=0,GA=0;function HA(t,e,n,i){return new wt((r,a)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),kb+=dl(e.data)):n&&(e.data.size?kb+=e.data.size:e.data instanceof FormData?kb+=ZP(e.data):kb+=dl(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,ss.request(e).then(c=>{typeof c.data=="string"?GA+=dl(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?GA+=c.data.byteLength:GA+=dl(JSON.stringify(c.data)),r(c.data)}).catch(c=>{ss.isCancel(c)?a(new ct(M.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new ct(M.NETWORK_TIMEOUT,c.message)):c.response?a(new ct(M.NETWORK_RESPONSE_ERROR,c.response.status)):a(new ct(M.NETWORK_ERROR,c.message))})})}async function cG(t,e){const n=new Blob([e.data],{type:"buffer"});return await HA(t,Vt(Vt({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const ak=()=>window.isSecureContext!==void 0;function To(t){if(Array.isArray(t))return t.map(n=>n);if(!ok(t))return t;const e={};for(const n in t){const i=t[n];ok(i)||Array.isArray(i)?e[n]=To(i):e[n]=i}return e}function ok(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let WA=class{constructor(t){fe(this,"input",[]),fe(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const ul={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},KS={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:ul,remoteCandidate:ul},updateInterval:0},ck={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},lk={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},dk={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},uk={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let KA=class{constructor(t,e){fe(this,"onFirstVideoReceived",void 0),fe(this,"onFirstVideoDecoded",void 0),fe(this,"onFirstAudioReceived",void 0),fe(this,"onFirstVideoDecodedTimeout",void 0),fe(this,"onFirstAudioDecoded",void 0),fe(this,"onSelectedLocalCandidateChanged",void 0),fe(this,"onSelectedRemoteCandidateChanged",void 0),fe(this,"videoIsReady",!1),fe(this,"videoIsReady2",{}),fe(this,"pc",void 0),fe(this,"options",void 0),fe(this,"intervalTimer",void 0),fe(this,"stats",To(KS)),fe(this,"isFirstVideoReceived",{}),fe(this,"isFirstVideoDecoded",{}),fe(this,"isFirstAudioReceived",{}),fe(this,"isFirstAudioDecoded",{}),fe(this,"isFirstVideoDecodedTimeout",{}),fe(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new wt(t=>{t({local:Vt({},ul),remote:Vt({},ul)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,r=0,a=0,c=0;for(const l of n)t[l].forEach((u,h)=>{if(!this.lossRateWindowStats[e-1][l][h]||!this.lossRateWindowStats[0][l][h])return;const p=this.lossRateWindowStats[e-1][l][h].packets-this.lossRateWindowStats[0][l][h].packets,m=this.lossRateWindowStats[e-1][l][h].packetsLost-this.lossRateWindowStats[0][l][h].packetsLost;l==="videoSend"||l==="audioSend"?(i+=p,a+=m):(r+=p,c+=m),Number.isNaN(p)||Number.isNaN(p)?u.packetLostRate=0:u.packetLostRate=p<=0||m<=0?0:m/(p+m)});t.sendPacketLossRate=i<=0||a<=0?0:a/(i+a),t.recvPacketLossRate=r<=0||c<=0?0:c/(r+c)}},lG=class extends KA{constructor(){super(...arguments),fe(this,"_stats",KS),fe(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=To(KS);const n=e.filter(r=>r.type==="ssrc");this.processSSRCStats(n);const i=e.find(r=>r.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var n;const i=At(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const r=To(lk);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{const r=To(ck),a=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(r.codec=e.googCodecName,r.targetDelayMs=Number(e.googTargetDelayMs),r.renderDelayMs=Number(e.googRenderDelayMs),r.currentDelayMs=Number(e.googCurrentDelayMs),r.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),r.decodeMs=Number(e.googDecodeMs),r.maxDecodeMs=Number(e.googMaxDecodeMs),r.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},r.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},r.decodeFrameRate=Number(e.googFrameRateDecoded),r.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},r.jitterBufferMs=Number(e.googJitterBufferMs),r.firsCount=Number(e.googFirsSent),r.nacksCount=Number(e.googNacksSent),r.plisCount=Number(e.googPlisSent),r.framesDecodeCount=Number(e.framesDecoded),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),a){const c=a.stats,l=Date.now()-a.lts;r.framesDecodeFreezeTime=c.framesDecodeFreezeTime,r.framesDecodeInterval=c.framesDecodeInterval,r.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(a.lts=Date.now(),r.framesDecodeInterval=l,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<a.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Vt({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{const r=To(uk);r.codec=e.googCodecName,r.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,r.decodingCNG=Number(e.googDecodingCNG),r.decodingCTN=Number(e.googDecodingCTN),r.decodingCTSG=Number(e.googDecodingCTSG),r.decodingNormal=Number(e.googDecodingNormal),r.decodingPLC=Number(e.googDecodingPLC),r.decodingPLCCNG=Number(e.googDecodingPLCCNG),r.expandRate=Number(e.googExpandRate),r.accelerateRate=Number(e.googAccelerateRate),r.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),r.speechExpandRate=Number(e.googSpeechExpandRate),r.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),r.jitterBufferMs=Number(e.googJitterBufferMs),r.jitterMs=Number(e.googJitterReceived),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),r.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{const r=To(dk);r.codec=e.googCodecName,r.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,r.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new wt((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(r=>{i[r]=n.stat(r)}),e.push(i)}),e}},zS=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),xb=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),zA=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),aa=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var xE=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(xE||{});function YS(t,e,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:xE.kNone;if(!e)return;const a=Number(e[n]);if(typeof a!="number")return;const c=Number(e[i]);if(typeof c!="number")return;if(!t)return c?a/c*r:void 0;const l=Number(t[n]);if(typeof l!="number")return;const u=Number(t[i]);if(typeof u!="number")return;const h=c-u;return h?(a-l)/h*r:void 0}let hk=class extends KA{constructor(){super(...arguments),fe(this,"_stats",KS),fe(this,"report",void 0),fe(this,"lastDecodeVideoReceiverStats",new Map),fe(this,"lastVideoFramesRecv",new Map),fe(this,"lastVideoFramesSent",new Map),fe(this,"lastVideoFramesDecode",new Map),fe(this,"lastVideoFramesOutput",new Map),fe(this,"lastVideoJBDelay",new Map),fe(this,"lastAudioJBDelay",new Map),fe(this,"mediaBytesSent",new Map),fe(this,"mediaBytesRetransmit",new Map),fe(this,"mediaBytesTargetEncode",new Map),fe(this,"lastDecodeAudioReceiverStats",new Map),fe(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=To(KS),this.report.forEach(t=>{switch(t.type){case aa.OUTBOUND:case aa.INBOUND:{const e=t.mediaType||t.kind,n=!e&&"frameWidth"in t,i=!e&&!("frameWidth"in t);t.type===aa.OUTBOUND?e==="audio"||i?this.processAudioOutboundStats(t):(e==="video"||n)&&this.processVideoOutboundStats(t):t.type===aa.INBOUND&&(e==="audio"||i?this.processAudioInboundStats(t):(e==="video"||n)&&this.processVideoInboundStats(t));break}case aa.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case aa.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:Vt({},ul),remote:Vt({},ul)};return t.forEach(n=>{let i;if(n.type===aa.TRANSPORT&&(i=t.get(n.selectedCandidatePairId)),n.type===aa.CANDIDATE_PAIR&&n.selected&&(i=n),i){const r=(a,c)=>{a.type=c.type,a.id=c.id,c.address&&(a.address=c.address),c.candidateType&&(a.candidateType=c.candidateType),c.port&&(a.port=c.port),c.priority&&(a.priority=c.priority),c.protocol&&(a.protocol=c.protocol),c.relayProtocol&&(a.relayProtocol=c.relayProtocol)};if(i.localCandidateId){const a=t.get(i.localCandidateId);a&&r(e.local,a)}if(i.remoteCandidateId){const a=t.get(i.remoteCandidateId);a&&r(e.remote,a)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===aa.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===aa.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===aa.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Vt({},e),Vt({},this.stats.selectedCandidatePair.localCandidate)),t.type===aa.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Vt({},e),Vt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=To(uk),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.packetsDiscarded=t.packetsDiscarded,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived,e.totalProcessingDelay=t.totalProcessingDelay,e.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=YS(n,e,"totalProcessingDelay","jitterBufferEmittedCount",xE.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,Vt({},e))}processVideoInboundStats(t){let e=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);e||(e=To(ck),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.framesDroppedCount=t.framesDropped,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,e.totalFreezesDuration=t.totalFreezesDuration,e.totalProcessingDelay=t.totalProcessingDelay,e.packetsDiscarded=t.packetsDiscarded,e.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,e.totalAssemblyTime=t.totalAssemblyTime,e.keyFramesDecoded=t.keyFramesDecoded,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(e.ssrc),i=this.lastVideoFramesDecode.get(e.ssrc),r=this.lastVideoFramesOutput.get(e.ssrc),a=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const c=e.decodedFrame?e.decodedFrame.width:0,l=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,c,l),this.isFirstVideoDecoded[e.ssrc]=!0}if(n){const c=n.stats,l=a-n.lts;e.framesDecodeFreezeTime=c.framesDecodeFreezeTime,e.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=l,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<c.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime,e.avgDecodeMs=YS(n==null?void 0:n.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=YS(n==null?void 0:n.stats,e,"totalProcessingDelay","framesDecodeCount",xE.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=YS(n==null?void 0:n.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",xE.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=YS(n==null?void 0:n.stats,e,"totalInterFrameDelay","framesDecodeCount",xE.kMillisecondsFromSeconds),i&&a-i.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-i.count)/((a-i.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:a,rate:e.decodeFrameRate})):i?e.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:a,rate:0}),e.framesDroppedCount&&t.framesReceived&&(r&&a-r.lts>=800?(e.outputFrameRate=Math.round((t.framesReceived-e.framesDroppedCount-r.count)/((a-r.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:a,rate:Math.max(e.outputFrameRate,0)})):r?e.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:a,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:Vt({},e),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);e||(e=To(lk),this._stats.videoSend.push(e));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const i=new WA(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const r=new WA(10);r.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,r)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const r=new WA(10);r.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,r)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,e.hugeFramesSent=t.hugeFramesSent,e.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const r=t.framesEncoded-i.lastFrameCount,a=t.totalEncodeTime-i.lastEncoderTime;e.avgEncodeMs=1e3*a/r}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,aa.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(n=>n.ssrc===t.ssrc);if(e||(e=To(dk),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,aa.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}findRemoteStatsId(t,e){var n;const i=Array.from(Fi(n=this.report).call(n)).find(r=>r.type===e&&r.ssrc===t);return i?i.id:null}processVideoMediaSource(t,e){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(e.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,e){const n=this.report.get(t);n&&(e.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,e,n){var i,r,a,c;const l=e?this.report.get(e):void 0,u=(i=l==null?void 0:l.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof u!="number")return;let h=(r=l==null?void 0:l.frameWidth)!==null&&r!==void 0?r:t.frameWidth,p=(a=l==null?void 0:l.frameHeight)!==null&&a!==void 0?a:t.frameHeight,m=(c=l==null?void 0:l.framesPerSecond)!==null&&c!==void 0?c:t.framesPerSecond;if(typeof h=="number"&&typeof p=="number"||(h=0,p=0),m==null){const g=Date.now(),S=this.lastVideoFramesSent.get(n.ssrc);S&&g-S.lts>=800?(m=Math.round((u-S.count)/((g-S.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:u,lts:g,rate:m})):S?m=S.rate:this.lastVideoFramesSent.set(n.ssrc,{count:u,lts:g,rate:0})}n.sentFrame={width:h,height:p,frameRate:Math.max(0,m)}}processVideoTrackReceiverStats(t,e,n){var i,r,a,c,l;const u=e?this.report.get(e):void 0,h=(i=u==null?void 0:u.framesReceived)!==null&&i!==void 0?i:t.framesReceived,p=(r=u==null?void 0:u.frameWidth)!==null&&r!==void 0?r:t.frameWidth,m=(a=u==null?void 0:u.frameHeight)!==null&&a!==void 0?a:t.frameHeight,g=(c=u==null?void 0:u.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,S=(l=u==null?void 0:u.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount;if(typeof h=="number"){const D=this.lastVideoFramesRecv.get(n.ssrc),w=Date.now();n.framesReceivedCount=h;let N=0;D&&w-D.lts>=800?(N=Math.round((h-D.count)/((w-D.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:w,rate:N})):D?N=D.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:w,rate:0}),n.receivedFrame={width:p||0,height:m||0,frameRate:N||0},n.decodedFrame={width:p||0,height:m||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:p||0,height:m||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(g&&S){const D=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let w=D.jitterBufferMs;const N=S-D.jitterBufferEmittedCount;N>0&&(w=1e3*(g-D.jitterBufferDelay)/N),n.jitterBufferMs=w,n.currentDelayMs=Math.round(w),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:g,jitterBufferEmittedCount:S,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,e,n){var i,r,a,c;const l=e?this.report.get(e):void 0,u=(i=(r=l==null?void 0:l.echoReturnLoss)!==null&&r!==void 0?r:t.echoReturnLoss)!==null&&i!==void 0?i:0,h=(a=(c=l==null?void 0:l.echoReturnLossEnhancement)!==null&&c!==void 0?c:t.echoReturnLossEnhancement)!==null&&a!==void 0?a:0;n.aecReturnLoss=u,n.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(t,e,n){var i,r,a,c,l,u,h;const p=e?this.report.get(e):void 0,m=(i=p==null?void 0:p.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,g=(r=p==null?void 0:p.totalSamplesReceived)!==null&&r!==void 0?r:t.totalSamplesReceived,S=(a=p==null?void 0:p.jitterBufferDelay)!==null&&a!==void 0?a:t.jitterBufferDelay,D=(c=p==null?void 0:p.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount,w=(l=p==null?void 0:p.audioLevel)!==null&&l!==void 0?l:t==null?void 0:t.audioLevel,N=(u=p==null?void 0:p.totalSamplesDuration)!==null&&u!==void 0?u:t==null?void 0:t.totalSamplesDuration,k=(h=p==null?void 0:p.concealedSamples)!==null&&h!==void 0?h:t.concealedSamples;if(typeof g=="number"&&(n.totalSamplesReceived=g),m&&g&&(n.accelerateRate=m/g),S&&D){const W=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Z=W.jitterBufferMs;const $=D-W.jitterBufferEmittedCount;$>0&&(Z=1e3*(S-W.jitterBufferDelay)/$),n.jitterBufferMs=Math.round(Z),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:D,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=w;let x=1920;N&&g&&(x=g/N/50,n.receivedFrames=Math.round(g/x)),k&&(n.droppedFrames=Math.round(k/x))}processRemoteInboundStats(t,e){const n=this.report.get(t);n&&(e.packetsLost=n.packetsLost,n.roundTripTime&&(e.rttMs=1e3*n.roundTripTime),n.jitter&&(e.jitterMs=1e3*n.jitter),n.timestamp&&(e.timestamp=n.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const n=e.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,e=null,n=null;this.mediaBytesSent.forEach(r=>{t+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{e=e===null?r.diffMean():e+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{n=n===null?r.diffMean():n+r.diffMean()});const i=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},dG=class extends KA{updateStats(){return wt.resolve()}};function YA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const a=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return a?a<76?new lG(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new hk(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(c){if(!window.RTCStatsReport)return!1;const l=c.getStats();return!!(l instanceof wt||function(u){return!!u&&(typeof u=="object"||typeof u=="function")&&typeof u.then=="function"}(l))}(t)?new hk(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new dG(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}const pk="websdk_ng_install_id";function qA(){try{if(B("INSTALL_ID"))return B("INSTALL_ID");let t=window.localStorage.getItem(pk);return t||(t=$p(),window.localStorage.setItem(pk,t)),sn("INSTALL_ID",t),t}catch{return}}const La=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const n=e[1],i=e[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.23.2"),XA=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let tf=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const nr=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let l=0;l<6;l++)r.push("1");const a=r.join(""),c={};return c[t]=i,c[e]=a,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=nr;const Mb={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},JA={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},QA="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",ZA={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},An=Vt(Vt(Vt({},ZA),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:JA,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Mb),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function sn(t,e,n){var i,r,a;At(i=Object.keys(An)).call(i,t)&&(!n&&At(r=Object.keys(mc)).call(r,t)||(An[t]=e,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||e!==!0||(An.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(An.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&e&&(a=!!e,An.USE_NEW_NETWORK_CONFIG=a,a&&(An.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],An.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],An.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],An.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],An.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",An.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",An.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(An.ENABLE_INSTANT_VIDEO=!0,An.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(An.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&e&&(An.NEW_TURN_MODE||(An.NEW_TURN_MODE=4))))}function B(t){return An[t]}XA||(An.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],An.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],An.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],An.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],An.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],An.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],An.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",An.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",An.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",An.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",An.AREAS=["NORTH_AMERICA","OVERSEA"]);let fk=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const mc={};var Le=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(Le||{});let Ub=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const mk=128,uG=96,Ek=1e3,ME=10;let hG=0;var _k=(()=>{var t={8:(i,r,a)=>{a.r(r),a.d(r,{Parser:()=>Nt,Printer:()=>ni,parse:()=>bt,print:()=>qt});const c=`
`,l="".concat("\r").concat(c),u=" ";let h;function p(ft){return ft>="0"&&ft<="9"}function m(ft){return ft>="!"&&ft<="~"}function g(ft){return m(ft)||ft>=""&&ft<=""}function S(ft){return ft==="!"||ft>="#"&&ft<="'"||ft>="*"&&ft<="+"||ft>="-"&&ft<="."||ft>="0"&&ft<="9"||ft>="A"&&ft<="Z"||ft>="^"&&ft<="~"}function D(ft){return ft>="1"&&ft<="9"}function w(ft){return ft>="A"&&ft<="Z"||ft>="a"&&ft<="z"}function N(ft){return ft==="d"||ft==="h"||ft==="m"||ft==="s"}function k(ft){return ft>""&&ft<"	"||ft>"\v"&&ft<"\f"||ft>""&&ft<""}function x(ft){return w(ft)||p(ft)||ft==="+"||ft==="/"}function W(ft){return p(ft)||w(ft)||ft==="+"||ft==="/"||ft==="-"||ft==="_"}function Z(ft){return w(ft)||p(ft)||ft==="+"||ft==="/"}function $(ft,C){var F=Object.keys(ft);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(ft);C&&(z=z.filter(function(St){return Object.getOwnPropertyDescriptor(ft,St).enumerable})),F.push.apply(F,z)}return F}function q(ft){for(var C=1;C<arguments.length;C++){var F=arguments[C]!=null?arguments[C]:{};C%2?$(Object(F),!0).forEach(function(z){ot(ft,z,F[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ft,Object.getOwnPropertyDescriptors(F)):$(Object(F)).forEach(function(z){Object.defineProperty(ft,z,Object.getOwnPropertyDescriptor(F,z))})}return ft}function ot(ft,C,F){return C in ft?Object.defineProperty(ft,C,{value:F,enumerable:!0,configurable:!0,writable:!0}):ft[C]=F,ft}(function(ft){ft.VERSION="v",ft.ORIGIN="o",ft.SESSION_NAME="s",ft.INFORMATION="i",ft.URI="u",ft.EMAIL="e",ft.PHONE="p",ft.CONNECTION="c",ft.BANDWIDTH="b",ft.TIME="t",ft.REPEAT="r",ft.ZONE_ADJUSTMENTS="z",ft.KEY="k",ft.ATTRIBUTE="a",ft.MEDIA="m"})(h||(h={}));class _t{consumeText(C,F){let z=F;for(;z<C.length;){const St=C[z];if(St==="\0"||St==="\r"||St===c)break;z+=1}if(z-F==0)throw new Error("Invalid text, at ".concat(C));return z}consumeUnicastAddress(C,F,z){return this.consumeTill(C,F,u)}consumeOneOrMore(C,F,z){let St=F;for(;z(C[St]);)St++;if(St-F==0)throw new Error("Invalid rule at ".concat(F,"."));return St}consumeSpace(C,F){if(C[F]===u)return F+1;throw new Error("Invalid space at ".concat(F,"."))}consumeIP4Address(C,F){let z=F;for(let St=0;St<4;St++)if(z=this.consumeDecimalUChar(C,z),St!==3){if(C[z]!==".")throw new Error("Invalid IP4 address.");z++}return z}consumeDecimalUChar(C,F){let z=F;for(let ge=0;ge<3&&p(C[z]);ge++,z++);if(z-F==0)throw new Error("Invalid decimal uchar.");const St=parseInt(C.slice(F,z));if(St>=0&&St<=255)return z;throw new Error("Invalid decimal uchar")}consumeIP6Address(C,F){let z=this.consumeHexpart(C,F);return C[z]===":"&&(z+=1,z=this.consumeIP4Address(C,z)),z}consumeHexpart(C,F){let z=F;if(C[z]===":"&&C[z+1]===":"){z+=2;try{z=this.consumeHexseq(C,z)}catch{}return z}if(z=this.consumeHexseq(C,z),C[z]===":"&&C[z+1]===":"){z+=2;try{z=this.consumeHexseq(C,z)}catch{}return z}return z}consumeHexseq(C,F){let z=F;for(;z=this.consumeHex4(C,z),C[z]===":"&&C[z+1]!==":";)z+=1;return z}consumeHex4(C,F){let z=0;for(;z<4;z++)if(!((St=C[F+z])>="0"&&St<="9"||St>="a"&&St<="f"||St>="A"&&St<="F")){if(z===0)throw new Error("Invalid hex 4");break}var St;return F+z}consumeFQDN(C,F){let z=F;for(;p(C[z])||w(C[z])||C[z]==="-"||C[z]===".";)z+=1;if(z-F<4)throw new Error("Invalid FQDN");return z}consumeExtnAddr(C,F){return this.consumeOneOrMore(C,F,g)}consumeMulticastAddress(C,F,z){switch(z){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(C,F);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(C,F);default:try{return this.consumeFQDN(C,F)}catch{return this.consumeExtnAddr(C,F)}}}consumeIP6MulticastAddress(C,F){const z=this.consumeHexpart(C,F);return C[z]==="/"?this.consumeInteger(C,z+1):z}consumeIP4MulticastAddress(C,F){let z=F+3;const St=C.slice(F,z),ge=parseInt(St);if(ge<224||ge>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let ln=0;ln<3;ln++){if(C[z]!==".")throw new Error("Invalid IP4 multicast address.");z+=1,z=this.consumeDecimalUChar(C,z)}return C[z]==="/"&&(z+=1),z=this.consumeTTL(C,z),C[z]==="/"&&(z=this.consumeInteger(C,z)),z}consumeInteger(C,F){if(!D(C[F]))throw new Error("Invalid integer.");for(F+=1;p(C[F]);)F+=1;return F}consumeTTL(C,F){if(C[F]==="0")return F+1;if(!D(C[F]))throw new Error("Invalid TTL.");F+=1;for(let z=0;z<2&&p(C[F]);z++)F+=1;return F}consumeToken(C,F){return this.consumeOneOrMore(C,F,S)}consumeTime(C,F){let z=F;if(C[z]==="0")return z+1;for(D(C[z])&&(z+=1);p(C[z]);)z++;if(z-F<10)throw new Error("Invalid time");return z}consumeAddress(C,F){return this.consumeTill(C,F,u)}consumeTypedTime(C,F){let z=F;return z=this.consumeOneOrMore(C,z,p),N(C[z])?z+1:z}consumeRepeatInterval(C,F){if(!D(C[F]))throw new Error("Invalid repeat interval");for(F+=1;p(C[F]);)F+=1;return N(C[F])&&(F+=1),F}consumePort(C,F){return this.consumeOneOrMore(C,F,p)}consume(C,F,z){for(let St=0;St<z.length;St++){if(F+St>=C.length)throw new Error("consume exceeding value length");if(C[F+St]!==z[St])throw new Error("consume ".concat(z," failed at ").concat(St))}return F+z.length}consumeTill(C,F,z){let St=F;for(;St<C.length&&(typeof z!="string"||C[St]!==z)&&(typeof z!="function"||!z(C[St]));)St++;return St}}class Nt extends _t{constructor(){super(),ot(this,"records",[]),ot(this,"currentLine",0)}parse(C){const F=this.probeEOL(C);this.records=C.split(F).filter(Cf=>!!Lr(Cf).call(Cf)).map(this.parseLine),this.currentLine=0;const z=this.parseVersion(),St=this.parseOrigin(),ge=this.parseSessionName(),ln=this.parseInformation(),Oi=this.parseUri(),Rs=this.parseEmail(),Nd=this.parsePhone(),Rf=this.parseConnection(),Ny=this.parseBandWidth(),qR=this.parseTimeFields(),XR=this.parseKey(),Ba=this.parseSessionAttribute(),lh=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:z,origin:St,sessionName:ge,information:ln,uri:Oi,emails:Rs,phones:Nd,connection:Rf,bandwidths:Ny,timeFields:qR,key:XR,attributes:Ba,mediaDescriptions:lh}}getCurrentRecord(){const C=this.records[this.currentLine];if(!C)throw new Error("Record doesn't exit.");return C}probeEOL(C){for(let F=0;F<C.length;F++)if(C[F]===c)return C[F-1]==="\r"?l:c;throw new Error("Invalid newline character.")}parseLine(C,F){if(C.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const z=C[0];if(C[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:z,value:C.slice(2),line:F,cur:0}}parseSessionAttribute(){const C=new ke;for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==h.ATTRIBUTE)break;const z={attField:this.extractOneOrMore(F,St=>S(St)&&St!==":"),_cur:0};F.value[F.cur]===":"&&(F.cur+=1,z.attValue=this.extractOneOrMore(F,k)),C.parse(z),this.currentLine++}return C.digest()}parseMediaAttributes(C){const F=new xe(C);for(;this.currentLine<this.records.length;){const z=this.getCurrentRecord();if(z.type!==h.ATTRIBUTE)break;const St={attField:this.extractOneOrMore(z,ge=>S(ge)&&ge!==":"),_cur:0};z.value[z.cur]===":"&&(z.cur+=1,St.attValue=this.extractOneOrMore(z,k)),F.parse(St),this.currentLine++}return F.digest()}parseKey(){const C=this.getCurrentRecord();if(C.type===h.KEY){if(C.value==="prompt"||C.value==="clear:"||C.value==="base64:"||C.value==="uri:")return C.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const C=this.getCurrentRecord();if(C.type===h.ZONE_ADJUSTMENTS){const F=[];for(;;)try{const z=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);let St=!1;C.value[C.cur]==="-"&&(St=!0,C.cur+=1);const ge=this.extract(C,this.consumeTypedTime);F.push({time:z,typedTime:ge,back:St})}catch{break}if(F.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,F}return[]}parseRepeat(){const C=[];for(;;){const F=this.getCurrentRecord();if(F.type!==h.REPEAT)break;{const z=this.extract(F,this.consumeRepeatInterval),St=this.parseTypedTime(F);C.push({repeatInterval:z,typedTimes:St}),this.currentLine++}}return C}parseTypedTime(C){const F=[];for(;;)try{this.consumeSpaceForRecord(C),F.push(this.extract(C,this.consumeTypedTime))}catch{break}if(F.length===0)throw new Error("Invalid typed time.");return F}parseTime(){const C=this.getCurrentRecord(),F=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);const z=this.extract(C,this.consumeTime);return this.currentLine++,{startTime:F,stopTime:z}}parseBandWidth(){const C=[];for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==h.BANDWIDTH)break;{const z=this.extractOneOrMore(F,S);if(F.value[F.cur]!==":")throw new Error("Invalid bandwidth field.");F.cur++;const St=this.extractOneOrMore(F,p);C.push({bwtype:z,bandwidth:St}),this.currentLine++}}return C}parseVersion(){const C=this.getCurrentRecord();if(C.type!==h.VERSION)throw new Error("first sdp record must be version");const F=C.value.slice(0,this.consumeOneOrMore(C.value,0,p));if(F.length!==C.value.length)throw new Error('invalid proto version, "v='.concat(C.value,'"'));return this.currentLine++,F}parseOrigin(){const C=this.getCurrentRecord();if(C.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");const F=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const z=this.extractOneOrMore(C,p);this.consumeSpaceForRecord(C);const St=this.extractOneOrMore(C,p);this.consumeSpaceForRecord(C);const ge=this.extractOneOrMore(C,S);this.consumeSpaceForRecord(C);const ln=this.extractOneOrMore(C,S);this.consumeSpaceForRecord(C);const Oi=this.extract(C,this.consumeUnicastAddress);return this.currentLine++,{username:F,sessId:z,sessVersion:St,nettype:ge,addrtype:ln,unicastAddress:Oi}}parseSessionName(){const C=this.getCurrentRecord();if(C.type===h.SESSION_NAME){const F=this.extract(C,this.consumeText);return this.currentLine++,F}}parseInformation(){const C=this.getCurrentRecord();if(C.type!==h.INFORMATION)return;const F=this.extract(C,this.consumeText);return this.currentLine++,F}parseUri(){const C=this.getCurrentRecord();if(C.type===h.URI)return this.currentLine++,C.value}parseEmail(){const C=[];for(;;){const F=this.getCurrentRecord();if(F.type!==h.EMAIL)break;C.push(F.value),this.currentLine++}return C}parsePhone(){const C=[];for(;;){const F=this.getCurrentRecord();if(F.type!==h.PHONE)break;C.push(F.value),this.currentLine++}return C}parseConnection(){const C=this.getCurrentRecord();if(C.type===h.CONNECTION){const F=this.extractOneOrMore(C,S);this.consumeSpaceForRecord(C);const z=this.extractOneOrMore(C,S);this.consumeSpaceForRecord(C);const St=this.extract(C,this.consumeAddress);return this.currentLine++,{nettype:F,addrtype:z,address:St}}}parseMedia(){const C=this.getCurrentRecord(),F=this.extract(C,this.consumeToken);this.consumeSpaceForRecord(C);let z=this.extract(C,this.consumePort);C.value[C.cur]==="/"&&(C.cur+=1,z+=this.extract(C,this.consumeInteger)),this.consumeSpaceForRecord(C);const St=[];for(St.push(this.extract(C,this.consumeToken));C.value[C.cur]==="/";)C.cur+=1,St.push(this.extract(C,this.consumeToken));if(St.length===0)throw new Error("Invalid proto");const ge=this.parseFmt(C);return this.currentLine++,{mediaType:F,port:z,protos:St,fmts:ge}}parseTimeFields(){const C=[];for(;this.getCurrentRecord().type===h.TIME;){const F=this.parseTime(),z=this.parseRepeat(),St=this.parseZone();C.push({time:F,repeats:z,zones:St})}return C}parseMediaDescription(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){const F=this.parseMedia(),z=this.parseInformation(),St=this.parseConnections(),ge=this.parseBandWidth(),ln=this.parseKey(),Oi=this.parseMediaAttributes(F);C.push({media:F,information:z,connections:St,bandwidths:ge,key:ln,attributes:Oi})}return C}parseConnections(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)C.push(this.parseConnection());return C}parseFmt(C){const F=[];for(;;)try{this.consumeSpaceForRecord(C),F.push(this.extract(C,this.consumeToken))}catch{break}if(F.length===0)throw new Error("Invalid fmts");return F}extract(C,F){for(var z=arguments.length,St=new Array(z>2?z-2:0),ge=2;ge<z;ge++)St[ge-2]=arguments[ge];const ln=F.call(this,C.value,C.cur,...St),Oi=C.value.slice(C.cur,ln);return C.cur=ln,Oi}extractOneOrMore(C,F){const z=this.consumeOneOrMore(C.value,C.cur,F),St=C.value.slice(C.cur,z);return C.cur=z,St}consumeSpaceForRecord(C){if(C.value[C.cur]!==u)throw new Error("Invalid space at ".concat(C.cur,"."));C.cur+=1}}class Mt extends _t{constructor(){super(...arguments),ot(this,"attributes",void 0),ot(this,"digested",!1)}extractOneOrMore(C,F,z){const St=this.consumeOneOrMore(C.attValue,C._cur,F),ge=C.attValue.slice(C._cur,St),[ln,Oi]=z||[];if(typeof ln=="number"&&ge.length<ln)throw new Error("error in length, should be more or equal than ".concat(ln," characters."));if(typeof Oi=="number"&&ge.length>Oi)throw new Error("error in length, should be less or equal than ".concat(Oi," characters."));return C._cur=St,ge}consumeAttributeSpace(C){if(C.attValue[C._cur]!==u)throw new Error("Invalid space at ".concat(C._cur,"."));C._cur+=1}extract(C,F){if(!C.attValue)throw new Error("Nothing to extract from attValue.");for(var z=arguments.length,St=new Array(z>2?z-2:0),ge=2;ge<z;ge++)St[ge-2]=arguments[ge];const ln=F.call(this,C.attValue,C._cur,...St),Oi=C.attValue.slice(C._cur,ln);return C._cur=ln,Oi}atEnd(C){if(!C.attValue)throw new Error;return C._cur>=C.attValue.length}peekChar(C){if(!C.attValue)throw new Error;return C.attValue[C._cur]}peek(C,F){if(!C.attValue)throw new Error;for(let z=0;z<F.length;z++)if(F[z]!==C.attValue[C._cur+z])return!1;return!0}parseIceUfrag(C){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(C,x,[4,256])}parseIcePwd(C){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(C,x,[22,256])}parseIceOptions(C){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const F=[];for(;!this.atEnd(C);){F.push(this.extractOneOrMore(C,x));try{this.consumeAttributeSpace(C)}catch(z){if(this.atEnd(C))break;throw z}}this.attributes.iceOptions=F}parseFingerprint(C){const F=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const z=this.extract(C,this.consumeTill);this.attributes.fingerprints.push({hashFunction:F,fingerprint:z})}parseExtmap(C){const F=this.extractOneOrMore(C,p);let z;this.peekChar(C)==="/"&&(this.extract(C,this.consume,"/"),z=this.extract(C,this.consumeToken)),this.consumeAttributeSpace(C);const St=this.extract(C,this.consumeTill,u),ge=q(q({entry:parseInt(F,10)},z&&{direction:z}),{},{extensionName:St});this.peekChar(C)===u&&(this.consumeAttributeSpace(C),ge.extensionAttributes=this.extract(C,this.consumeTill)),this.attributes.extmaps.push(ge)}parseSetup(C){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const F=this.extract(C,this.consumeTill);if(F!=="active"&&F!=="passive"&&F!=="actpass"&&F!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=F}}class ke extends Mt{constructor(){super(...arguments),ot(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"group":this.parseGroup(C);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"fingerprint":this.parseFingerprint(C);break;case"setup":this.parseSetup(C);break;case"tls-id":this.parseTlsId(C);break;case"identity":this.parseIdentity(C);break;case"extmap":this.parseExtmap(C);break;case"msid-semantic":this.parseMsidSemantic(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(F){throw console.error("parsing session attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),F}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(C){const F=this.extract(C,this.consumeToken),z=[];for(;!this.atEnd(C)&&this.peekChar(C)===u;)this.consumeAttributeSpace(C),z.push(this.extract(C,this.consumeToken));this.attributes.groups.push({semantic:F,identificationTag:z})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(C){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(C,W)}parseIdentity(C){const F=this.extractOneOrMore(C,Z),z=[];for(;!this.atEnd(C)&&this.peekChar(C)===u;){this.consumeAttributeSpace(C);const St=this.extract(C,this.consumeToken);this.extract(C,this.consume,"=");const ge=this.extractOneOrMore(C,ln=>ln!==u&&k(ln));z.push({name:St,value:ge})}this.attributes.identities.push({assertionValue:F,extensions:z})}parseMsidSemantic(C){this.peekChar(C)===u&&this.consumeAttributeSpace(C);const F={semantic:this.extract(C,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(C)}catch{break}if(this.peekChar(C)==="*"){this.extract(C,this.consume,"*"),F.applyForAll=!0;break}{const z=this.extract(C,this.consumeTill,u);F.identifierList.push(z)}}this.attributes.msidSemantic=F}}class xe extends Mt{constructor(C){super(),ot(this,"attributes",void 0),C.protos.indexOf("RTP")!==-1||C.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"extmap":this.parseExtmap(C);break;case"setup":this.parseSetup(C);break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"candidate":this.parseCandidate(C);break;case"remote-candidate":this.parseRemoteCandidate(C);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(C);break;case"rtpmap":this.parseRtpmap(C);break;case"ptime":this.parsePtime(C);break;case"maxptime":this.parseMaxPtime(C);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(C);break;case"ssrc":this.parseSSRC(C);break;case"fmtp":this.parseFmtp(C);break;case"rtcp-fb":this.parseRtcpFb(C);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(C);break;case"mid":this.parseMid(C);break;case"msid":this.parseMsid(C);break;case"imageattr":this.parseImageAttr(C);break;case"rid":this.parseRid(C);break;case"simulcast":this.parseSimulcast(C);break;case"sctp-port":this.parseSctpPort(C);break;case"max-message-size":this.parseMaxMessageSize(C);break;case"ssrc-group":this.parseSSRCGroup(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(F){throw console.error("parsing media attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),F}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}parseCandidate(C){const F=this.extractOneOrMore(C,x,[1,32]);this.consumeAttributeSpace(C);const z=this.extractOneOrMore(C,p,[1,5]);this.consumeAttributeSpace(C);const St=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const ge=this.extractOneOrMore(C,p,[1,10]);this.consumeAttributeSpace(C);const ln=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const Oi=this.extract(C,this.consumePort);this.consumeAttributeSpace(C),this.extract(C,this.consume,"typ"),this.consumeAttributeSpace(C);const Rs={foundation:F,componentId:z,transport:St,priority:ge,connectionAddress:ln,port:Oi,type:this.extract(C,this.consumeToken),extension:{}};for(this.peek(C," raddr")&&(this.extract(C,this.consume," raddr"),this.consumeAttributeSpace(C),Rs.relAddr=this.extract(C,this.consumeAddress)),this.peek(C," rport")&&(this.extract(C,this.consume," rport"),this.consumeAttributeSpace(C),Rs.relPort=this.extract(C,this.consumePort));this.peekChar(C)===u;){this.consumeAttributeSpace(C);const Nd=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C),Rs.extension[Nd]=this.extractOneOrMore(C,m)}this.attributes.candidates.push(Rs)}parseRemoteCandidate(C){const F=[];for(;;){const z=this.extractOneOrMore(C,p,[1,5]);this.consumeAttributeSpace(C);const St=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const ge=this.extract(C,this.consumePort);F.push({componentId:z,connectionAddress:St,port:ge});try{this.consumeAttributeSpace(C)}catch{break}}this.attributes.remoteCandidatesList.push(F)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(C){const F=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const z=this.extract(C,this.consumeTill,"/");this.extract(C,this.consume,"/");const St={encodingName:z,clockRate:this.extractOneOrMore(C,p)};this.atEnd(C)||this.peekChar(C)!=="/"||(this.extract(C,this.consume,"/"),St.encodingParameters=parseInt(this.extract(C,this.consumeTill),10));const ge=this.attributes.payloads.find(ln=>ln.payloadType===parseInt(F,10));ge?ge.rtpMap=St:this.attributes.payloads.push({payloadType:parseInt(F,10),rtpMap:St,rtcpFeedbacks:[]})}parsePtime(C){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(C,this.consumeTill)}parseMaxPtime(C){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(C,this.consumeTill)}parseDirection(C){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=C.attField}parseSSRC(C){const F=this.extractOneOrMore(C,p);this.consumeAttributeSpace(C);const z=this.extract(C,this.consumeTill,":");let St;this.peekChar(C)===":"&&(this.extract(C,this.consume,":"),St=this.extract(C,this.consumeTill));const ge=this.attributes.ssrcs.find(ln=>ln.ssrcId===parseInt(F,10));ge?ge.attributes[z]=St:this.attributes.ssrcs.push({ssrcId:parseInt(F,10),attributes:{[z]:St}})}parseFmtp(C){const F=this.extract(C,this.consumeTill,u);this.consumeAttributeSpace(C);const z=this.extract(C,this.consumeTill),St={};z.split(";").forEach(ln=>{let[Oi,Rs]=ln.split("=");Oi=Lr(Oi).call(Oi);const Nd=typeof Rs=="string"?Lr(Rs).call(Rs):null;typeof Oi=="string"&&Oi.length>0&&(St[Oi]=Nd)});const ge=this.attributes.payloads.find(ln=>ln.payloadType===parseInt(F,10));ge?ge.fmtp={parameters:St}:this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[],fmtp:{parameters:St}})}parseFmtParameters(C){const F={},z=this.extract(C,this.consumeTill,"=");C._cur++;const St=this.extract(C,this.consumeTill,";");for(F[z]=St;C.attValue[C._cur]===";";){const ge=this.extract(C,this.consumeTill,"=");C._cur++;const ln=this.extract(C,this.consumeTill,";");F[ge]=ln}return F}parseRtcpFb(C){let F="";F=this.peekChar(C)==="*"?this.extract(C,this.consume,"*"):this.extract(C,this.consumeTill,u),this.consumeAttributeSpace(C);const z=this.extract(C,this.consumeTill,u);let St;if(z==="trr-int")St={type:z,interval:this.extract(C,this.consumeTill)};else{const ge={type:z};this.peekChar(C)===u&&(this.consumeAttributeSpace(C),ge.parameter=this.extract(C,this.consumeToken),this.peekChar(C)===u&&(ge.additional=this.extract(C,this.consumeTill))),St=ge}if(F==="*")this.attributes.rtcpFeedbackWildcards.push(St);else{const ge=this.attributes.payloads.find(ln=>ln.payloadType===parseInt(F,10));ge?ge.rtcpFeedbacks.push(St):this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[St]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(C){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const F={port:this.extract(C,this.consumePort)};this.peekChar(C)===u&&(this.consumeAttributeSpace(C),F.netType=this.extractOneOrMore(C,S),this.consumeAttributeSpace(C),F.addressType=this.extractOneOrMore(C,S),this.consumeAttributeSpace(C),F.address=this.extract(C,this.consumeAddress)),this.attributes.rtcp=F}parseMsid(C){const F={id:this.extractOneOrMore(C,S,[1,64])};this.peekChar(C)===u&&(this.consumeAttributeSpace(C),F.appdata=this.extractOneOrMore(C,S,[1,64])),this.attributes.msids.push(F)}parseImageAttr(C){this.attributes.imageattr.push(C.attValue)}parseRid(C){const F=this.extractOneOrMore(C,St=>w(St)||p(St)||St==="_"||St==="-");this.consumeAttributeSpace(C);const z={id:F,direction:this.extract(C,this.consumeToken),params:[]};if(this.peekChar(C)===u){if(this.consumeAttributeSpace(C),this.peek(C,"pt=")){this.extract(C,this.consume,"pt=");const St=[];for(;;){const ge=this.extract(C,this.consumeToken);St.push(ge);try{this.extract(C,this.consume,",")}catch{break}}z.payloads=St,this.peekChar(C)===u&&this.extract(C,this.consume,u)}for(;;){const St=this.extract(C,this.consumeToken);switch(St){case"depend":{const ge={type:St,rids:this.extract(C,this.consume,"=").split(",")};z.params.push(ge);break}default:{const ge={type:St};this.peekChar(C)==="="&&(this.extract(C,this.consume,"="),ge.val=this.extract(C,this.consumeTill,";")),z.params.push(ge)}}try{this.extract(C,this.consume,";")}catch{break}}}this.attributes.rids.push(z)}parseSimulcast(C){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=C.attValue,this.extract(C,this.consumeTill)}parseSctpPort(C){this.attributes.sctpPort=this.extractOneOrMore(C,p,[1,5])}parseMaxMessageSize(C){this.attributes.maxMessageSize=this.extractOneOrMore(C,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(C){this.attributes.mid=this.extract(C,this.consumeToken)}parseSSRCGroup(C){const F=this.extract(C,this.consumeToken),z=[];for(;;)try{this.consumeAttributeSpace(C);const St=this.extract(C,this.consumeInteger);z.push(parseInt(St,10))}catch{break}this.attributes.ssrcGroups.push({semantic:F,ssrcIds:z})}}function gn(ft,C,F){return C in ft?Object.defineProperty(ft,C,{value:F,enumerable:!0,configurable:!0,writable:!0}):ft[C]=F,ft}class ni{constructor(){gn(this,"eol",l)}print(C,F){let z="";return F&&(this.eol=F),z+=this.printVersion(C.version),z+=this.printOrigin(C.origin),z+=this.printSessionName(C.sessionName),z+=this.printInformation(C.information),z+=this.printUri(C.uri),z+=this.printEmail(C.emails),z+=this.printPhone(C.phones),z+=this.printConnection(C.connection),z+=this.printBandwidth(C.bandwidths),z+=this.printTimeFields(C.timeFields),z+=this.printKey(C.key),z+=this.printSessionAttributes(C.attributes),z+=this.printMediaDescription(C.mediaDescriptions),z}printVersion(C){return"v=".concat(C).concat(this.eol)}printOrigin(C){return"o=".concat(C.username," ").concat(C.sessId," ").concat(C.sessVersion," ").concat(C.nettype," ").concat(C.addrtype," ").concat(C.unicastAddress).concat(this.eol)}printSessionName(C){return C?"s=".concat(C).concat(this.eol):""}printInformation(C){return C?"i=".concat(C).concat(this.eol):""}printUri(C){return C?"u=".concat(C).concat(this.eol):""}printEmail(C){let F="";for(const z of C)F+="e=".concat(z).concat(this.eol);return F}printPhone(C){let F="";for(const z of C)F+="e=".concat(z).concat(this.eol);return F}printConnection(C){return C?"c=".concat(C.nettype," ").concat(C.addrtype," ").concat(C.address).concat(this.eol):""}printBandwidth(C){let F="";for(const z of C)F+="b=".concat(z.bwtype,":").concat(z.bandwidth).concat(this.eol);return F}printTimeFields(C){let F="";for(const z of C){F+="t=".concat(z.time.startTime," ").concat(z.time.startTime).concat(this.eol);for(const St of z.repeats)F+="r=".concat(St.repeatInterval," ").concat(St.typedTimes.join(" ")).concat(this.eol);z.zoneAdjustments&&(F+="z=",F+="z=".concat(z.zoneAdjustments.map(St=>"".concat(St.time," ").concat(St.back?"-":""," ").concat(St.typedTime)).join(" ")).concat(this.eol),F+=this.eol)}return F}printKey(C){return C?"k=".concat(C).concat(this.eol):""}printAttributes(C){let F="";for(const z of C)F+="a=".concat(z.attField).concat(z.attValue?":".concat(z.attValue):"").concat(this.eol);return F}printMediaDescription(C){let F="";for(const z of C)F+=this.printMedia(z.media),F+=this.printInformation(z.information),F+=this.printConnections(z.connections),F+=this.printBandwidth(z.bandwidths),F+=this.printKey(z.key),F+=this.printMediaAttributes(z);return F}printConnections(C){let F="";for(const z of C)F+=this.printConnection(z);return F}printMedia(C){return"m=".concat(C.mediaType," ").concat(C.port," ").concat(C.protos.join("/")," ").concat(C.fmts.join(" ")).concat(this.eol)}printSessionAttributes(C){return new us(this.eol).print(C)}printMediaAttributes(C){return new pt(this.eol).print(C)}}class Kn{constructor(C){gn(this,"eol",void 0),this.eol=C}printIceUfrag(C){return C===void 0?"":"a=ice-ufrag:".concat(C).concat(this.eol)}printIcePwd(C){return C===void 0?"":"a=ice-pwd:".concat(C).concat(this.eol)}printIceOptions(C){return C===void 0?"":"a=ice-options:".concat(C.join(u)).concat(this.eol)}printFingerprints(C){return C.length>0?C.map(F=>"a=fingerprint:".concat(F.hashFunction).concat(u).concat(F.fingerprint)).join(this.eol)+this.eol:""}printExtmap(C){return C.map(F=>"a=extmap:".concat(F.entry).concat(F.direction?"/".concat(F.direction):"").concat(u).concat(F.extensionName).concat(F.extensionAttributes?"".concat(u).concat(F.extensionAttributes):"").concat(this.eol)).join("")}printSetup(C){return C===void 0?"":"a=setup:".concat(C).concat(this.eol)}printUnrecognized(C){return C.map(F=>"a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol)).join("")}}class us extends Kn{print(C){let F="";return F+=this.printGroups(C.groups),F+=this.printMsidSemantic(C.msidSemantic),F+=this.printIceLite(C.iceLite),F+=this.printIceUfrag(C.iceUfrag),F+=this.printIcePwd(C.icePwd),F+=this.printIceOptions(C.iceOptions),F+=this.printFingerprints(C.fingerprints),F+=this.printSetup(C.setup),F+=this.printTlsId(C.tlsId),F+=this.printIdentity(C.identities),F+=this.printExtmap(C.extmaps),F+=this.printUnrecognized(C.unrecognized),F}printGroups(C){let F="";return C.length>0&&(F+=C.map(z=>"a=group:".concat(z.semantic).concat(z.identificationTag.map(St=>"".concat(u).concat(St)).join("")).concat(this.eol)).join("")),F}printIceLite(C){return C===void 0?"":"a=ice-lite"+this.eol}printTlsId(C){return C?"a=tls-id:".concat(C).concat(this.eol):""}printIdentity(C){return C.length===0?"":C.map(F=>"a=identity:".concat(F.assertionValue).concat(F.extensions.map(z=>"".concat(u).concat(z.name).concat(z.value?"=".concat(z.value):"")))).join(this.eol)+this.eol}printMsidSemantic(C){if(!C)return"";let F="a=msid-semantic:".concat(C.semantic);return C.applyForAll?F+="".concat(u,"*"):C.identifierList.length>0&&(F+=C.identifierList.map(z=>"".concat(u).concat(z))),F+this.eol}}class pt extends Kn{print(C){const F=C.attributes;let z="";return z+=this.printRTCP(F.rtcp),z+=this.printIceUfrag(F.iceUfrag),z+=this.printIcePwd(F.icePwd),z+=this.printIceOptions(F.iceOptions),z+=this.printCandidates(F.candidates),z+=this.printRemoteCandidatesList(F.remoteCandidatesList),z+=this.printEndOfCandidates(F.endOfCandidates),z+=this.printFingerprints(F.fingerprints),z+=this.printSetup(F.setup),z+=this.printMid(F.mid),z+=this.printExtmap(F.extmaps),z+=this.printRTPRelated(F),z+=this.printPtime(F.ptime),z+=this.printMaxPtime(F.maxPtime),z+=this.printDirection(F.direction),z+=this.printSSRCGroups(F.ssrcGroups),z+=this.printSSRC(F.ssrcs),z+=this.printRTCPMux(F.rtcpMux),z+=this.printRTCPMuxOnly(F.rtcpMuxOnly),z+=this.printRTCPRsize(F.rtcpRsize),z+=this.printMSId(F.msids),z+=this.printImageattr(F.imageattr),z+=this.printRid(F.rids),z+=this.printSimulcast(F.simulcast),z+=this.printSCTPPort(F.sctpPort),z+=this.printMaxMessageSize(F.maxMessageSize),z+=this.printUnrecognized(F.unrecognized),z}printCandidates(C){return C.map(F=>"a=candidate:".concat(F.foundation).concat(u).concat(F.componentId).concat(u).concat(F.transport).concat(u).concat(F.priority).concat(u).concat(F.connectionAddress).concat(u).concat(F.port).concat(u,"typ").concat(u).concat(F.type).concat(F.relAddr?"".concat(u,"raddr").concat(u).concat(F.relAddr):"").concat(F.relPort?"".concat(u,"rport").concat(u).concat(F.relPort):"").concat(Object.keys(F.extension).map(z=>"".concat(u).concat(z).concat(u).concat(F.extension[z])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(C){return C.map(F=>"a=remote-candidates:".concat(F.join(u)).concat(this.eol)).join("")}printEndOfCandidates(C){return C===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(C){if(!C.payloads)return"";const F=C.payloads;let z="";z+=C.rtcpFeedbackWildcards.map(St=>this.printRTCPFeedback("*",St)).join("");for(const St of F)z+=this.printRtpMap(St.payloadType,St.rtpMap),z+=this.printFmtp(St.payloadType,St.fmtp),z+=St.rtcpFeedbacks.map(ge=>this.printRTCPFeedback(St.payloadType,ge)).join("");return z}printFmtp(C,F){if(!F)return"";const z=Object.keys(F.parameters);return z.length===1&&F.parameters[z[0]]===null?"a=fmtp:".concat(C).concat(u).concat(z[0]).concat(this.eol):"a=fmtp:".concat(C).concat(u).concat(Object.keys(F.parameters).map(St=>"".concat(St,"=").concat(F.parameters[St])).join(";")).concat(this.eol)}printRtpMap(C,F){return F?"a=rtpmap:".concat(C).concat(u).concat(F.encodingName,"/").concat(F.clockRate).concat(F.encodingParameters?"/".concat(F.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(C,F){let z="a=rtcp-fb:".concat(C).concat(u),St=F;return St.type==="trr-int"?z+="ttr-int".concat(u).concat(St.interval):(z+="".concat(St.type),St.parameter&&(z+="".concat(u).concat(St.parameter),St.additional&&(z+="".concat(u).concat(St.additional)))),z+this.eol}printPtime(C){return C===void 0?"":"a=ptime:".concat(C).concat(this.eol)}printMaxPtime(C){return C===void 0?"":"a=maxptime:".concat(C).concat(this.eol)}printDirection(C){return C===void 0?"":"a=".concat(C).concat(this.eol)}printSSRC(C){return C.map(F=>Object.keys(F.attributes).map(z=>"a=ssrc:".concat(F.ssrcId.toString(10)).concat(u).concat(z).concat(F.attributes[z]?":".concat(F.attributes[z]):"").concat(this.eol)).join("")).join("")}printRTCPMux(C){return C===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(C){return C===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(C){return C===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(C){if(C===void 0)return"";let F="a=rtcp:".concat(C.port);return C.netType&&(F+="".concat(u).concat(C.netType)),C.addressType&&(F+="".concat(u).concat(C.addressType)),C.address&&(F+="".concat(u).concat(C.address)),F+this.eol}printMSId(C){return C.map(F=>"a=msid:".concat(F.id).concat(F.appdata?"".concat(u).concat(F.appdata):"").concat(this.eol)).join("")}printImageattr(C){return C.map(F=>"a=imageattr:".concat(F).concat(this.eol)).join("")}printRid(C){return C.map(F=>{let z="a=rid:".concat(F.id).concat(u).concat(F.direction);return F.payloads&&(z+="".concat(u,"pt=").concat(F.payloads.join(","))),F.params.length>0&&(z+="".concat(u).concat(F.params.map(St=>St.type==="depend"?"depend=".concat(St.rids.join(",")):"".concat(St.type,"=").concat(St.val)).join(";"))),z+this.eol}).join("")}printSimulcast(C){return C===void 0?"":"a=simulcast:".concat(C).concat(this.eol)}printSCTPPort(C){return C===void 0?"":"a=sctp-port:".concat(C).concat(this.eol)}printMaxMessageSize(C){return C===void 0?"":"a=max-message-size:".concat(C).concat(this.eol)}printMid(C){return C===void 0?"":"a=mid:".concat(C).concat(this.eol)}printSSRCGroups(C){return C.map(F=>"a=ssrc-group:".concat(F.semantic).concat(F.ssrcIds.map(z=>"".concat(u).concat(z.toString(10))).join("")).concat(this.eol)).join("")}}function bt(ft){return new Nt().parse(ft)}function qt(ft,C){return new ni().print(ft,C)}}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}return n.d=(i,r)=>{for(var a in r)n.o(r,a)&&!n.o(i,a)&&Object.defineProperty(i,a,{enumerable:!0,get:r[a]})},n.o=(i,r)=>Object.prototype.hasOwnProperty.call(i,r),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function ys(t){return _k.parse(t)}function zu(t,e){return _k.print(t,e)}var pG=Er("Array").keys,fG=Ps,mG=yi,EG=dt,_G=pG,$A=Array.prototype,gG={DOMTokenList:!0,NodeList:!0},SG=function(t){var e=t.keys;return t===$A||EG($A,t)&&e===$A.keys||mG(gG,fG(t))?_G:e},oa=L(SG);function gk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ve(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gk(Object(n),!0).forEach(function(i){Hn(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gk(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Hn(t,e,n){return(e=function(i){var r=function(a,c){if(typeof a!="object"||a===null)return a;var l=a[Symbol.toPrimitive];if(l!==void 0){var u=l.call(a,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const Sk=new class extends Mn{constructor(){super(...arguments),Hn(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class yG{constructor(e){Hn(this,"logger",void 0),Hn(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function tw(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function yk(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Pa={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},jb=Date.now(),qS=t=>{for(const e in Pa)if(Object.prototype.hasOwnProperty.call(Pa,e)&&Pa[e]===t)return e;return"DEFAULT"},T=new class{constructor(){Hn(this,"proxyServerURL",void 0),Hn(this,"logLevel",Pa.DEBUG),Hn(this,"uploadState","collecting"),Hn(this,"uploadLogWaitingList",[]),Hn(this,"uploadLogUploadingList",[]),Hn(this,"uploadErrorCount",0),Hn(this,"currentLogID",0),Hn(this,"url",void 0),Hn(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Pa.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Pa.INFO].concat(e);this.log.apply(this,i)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Pa.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Pa.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Pa.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){sn("UPLOAD_LOG",!0)}disableLogUpload(){sn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new yG(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-jb<100)return void setTimeout(()=>{this.log(...e)},Date.now()-jb);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=tw()+" Agora-SDK [".concat(qS(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const r=tw()+" %cAgora-SDK [".concat(qS(i),"]:");let a=[];if(!B("USE_NEW_LOG"))switch(i){case Pa.DEBUG:a=[r,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,a);break;case Pa.INFO:a=[r,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,a);break;case Pa.WARNING:a=[r,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,a);break;case Pa.ERROR:a=[r,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-jb<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-jb);const i=Math.max(0,Math.min(4,e[0]));e[0]=tw()+" Agora-SDK [".concat(qS(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(t){if(!B("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=yk()+" Agora-SDK [".concat(qS(t),"]:"):n[0]=yk()+" Agora-SDK [".concat(qS(t),"]:");let r="";n.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),r+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:La,process_id:B("PROCESS_ID"),payload:JSON.stringify(t)};return fc(async()=>{const n=await ss.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(B("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(B("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:t.map(r=>r.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),Sk.reportLogUploadError(i),!0},{timeout:B("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:B("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,B("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var Tk;function TG(t){return Gi(t.reportId,"params.reportId",0,100,!1),Gi(t.category,"params.category",0,100,!1),Gi(t.event,"params.event",0,100,!1),Gi(t.label,"params.label",0,100,!1),cn(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(Tk={}).FREE="free",Tk.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const vG={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let wi=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Dn=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let bG=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function le(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,i){const r=i.value;if(typeof r=="function"){const a=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var c,l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];let p=u;if(t.argsMap)try{p=t.argsMap(this,...u)}catch(g){T.warning(g),p=[]}try{JSON.stringify(p)}catch{T.warning("arguments for method ".concat(a,".").concat(String(n)," not serializable for apiInvoke.")),p=[]}const m=(t.report||Jt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(a,".").concat(String(n)),options:p,tag:Fn.TRACER,reportResult:t.reportResult},t.throttleTime);try{const g=r.apply(this,u);return g instanceof wt?g.then(S=>(m.onSuccess(t.reportResult&&S),S)).catch(S=>{throw m.onError(S),S}):(m.onSuccess(t.reportResult&&g),g)}catch(g){throw m.onError(g),g}}}return i}}const Jt=new class{constructor(){Hn(this,"baseInfoMap",new Map),Hn(this,"proxyServer",void 0),Hn(this,"eventUploadTimer",void 0),Hn(this,"setSessionIdTimer",void 0),Hn(this,"url",void 0),Hn(this,"sids",new Set),Hn(this,"backupUrl",void 0),Hn(this,"_appId",void 0),Hn(this,"_aid",0),Hn(this,"keyEventUploadPendingItems",[]),Hn(this,"normalEventUploadPendingItems",[]),Hn(this,"apiInvokeUploadPendingItems",[]),Hn(this,"apiInvokeCount",0),Hn(this,"apiInvokeLoggedCount",0),Hn(this,"ltsList",[]),Hn(this,"lastSendNormalEventTime",Date.now()),Hn(this,"customReportCounterTimer",void 0),Hn(this,"customReportCount",0),Hn(this,"extApiInvoke",async t=>{for(const e of t){const n=ve(ve({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Fn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),B("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),B("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,e=>{let[n,i]=e;return n+i}),16)||0}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,a=!!B("SHOW_REPORT_INVOKER_LOG"),c=!!B("SHOW_REPORT_USER_INVOKER_LOG"),l=a||c&&e.id;l&&(this.apiInvokeLoggedCount+=1);const u=this.apiInvokeLoggedCount;function h(S,D){if(l){let w="[apiInvoke-".concat(u,"]");e.id&&(w+="[".concat(e.id,"]")),e.name&&(w+="[".concat(e.name,"]")),T.info("".concat(w," ").concat(S),S==="start"?e.options:D||"")}}const p=()=>({tag:e.tag,invokeId:r,sid:t,name:e.name,apiInvokeTime:i,options:e.options,states:e.states||null});h("start");let m=!1;Hi(e.timeout).then(()=>{m||(this.sendApiInvoke(ve(ve({},p()),{},{error:M.API_INVOKE_TIMEOUT,success:!1})),h("timeout"))});const g=new ct(M.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:S=>{const D=()=>{if(m)throw g;return m=!0,this.sendApiInvoke(ve(ve({},p()),{},{success:!0},e.reportResult&&{result:S})),h("onSuccess"),S};return n?tk(D,e.name+"Success",n,()=>m=!0):D()},onError:S=>{const D=()=>{if(m)throw S;m=!0,this.sendApiInvoke(ve(ve({},p()),{},{success:!1,error:S})),h("onFailure",S.toString())};return n?tk(D,e.name+"Error",n,()=>m=!0):D()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),i=this.createBaseInfo(t,n);i.cname=e.cname;const r=Object.assign({},{willUploadConsoleLog:B("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:XA?"global":"oversea",areas:B("AREAS")&&B("AREAS").join(",")},e.extend),{stringUid:a,channelProfile:c,channelMode:l,isABTestSuccess:u,lsid:h,clientRole:p}=e,m=Date.now(),g=ve(ve({},i),{},{eventType:wi.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:QA,lts:m,elapse:m-n,extend:JSON.stringify(r),mode:e.mode,process:B("PROCESS_ID"),appType:B("APP_TYPE"),success:!0,version:La,stringUid:a,channelProfile:c,channelMode:l,isABTestSuccess:u,lsid:h,clientType:At(S=window.navigator.userAgent).call(S,"AgoraWebView")?42:20,clientRole:p,serviceId:B("PROCESS_ID"),extensionID:B("PLUGIN_INFO").join(",")||""});var S;this.send({type:Dn.SESSION,data:g},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve({},i),{},{role:e.role,eventType:wi.JOIN_CHOOSE_SERVER,lts:r,eventElapse:e.elapse||r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0});this.send({type:Dn.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve({},i),{},{eventType:wi.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||r-n.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:Dn.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info;e.vid&&(i.vid=e.vid),i.uid=e.uid,i.cid=e.cid;const r=Date.now(),{firstSuccess:a,avoidJoinStartTime:c,addr:l,isProxy:u}=e,h=r-(a&&c?c:n.startTime),p=ve(ve({},i),{},{eventType:wi.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:h,eventElapse:r-e.lts,firstSuccess:a,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:qA(),isABTestSuccess:e.isABTestSuccess?1:0}),m=p.success?1:0;if(e.succ&&(n.lastJoinSuccessTime=r),a)this.send({type:Dn.JOIN_GATEWAY,data:p},!0);else{let g;if(l)if(u){const D=l.match(/h=(\d{1,3}-){3}\d{1,3}/g),w=l.match(/p=[0-9]{1,6}/g);g={isSuccess:m,gatewayIp:D&&D.length?D[0].split("=")[1].replace(/-/g,"."):"",port:w&&w.length?w[0].split("=")[1]:"",isProxy:u?1:0}}else{const D=l.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),w=l.match(/(:|p=)[0-9]{1,6}/g);g={isSuccess:m,gatewayIp:D&&D.length?D[0].split("//")[1].replace(/-/g,"."):"",port:w&&w.length?w[0].split(/:|p=/g)[1]:"",isProxy:u?1:0}}else g={isSuccess:m,gatewayIp:"",port:"",isProxy:u?1:0};delete p.success,delete p.eventType,delete p.firstSuccess,p.vid=Number(p.vid);const S=Object.assign({},p,g,{eventType:wi.REJOIN_GATEWAY});this.send({type:Dn.RE_JOIN_GATEWAY,data:S},!0)}}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=Date.now(),r=ve(ve({},n.info),{},{lts:i,timeout:e,elapse:i-n.startTime});this.send({type:Dn.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve({},i),{},{eventType:wi.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:Dn.PUBLISH,data:a},!0)}subscribe(t,e,n){const i=this.baseInfoMap.get(t);if(!i)return;const r=i.info,a=Date.now(),c=ve(ve({},r),{},{eventType:wi.SUBSCRIBE,lts:a,eventElapse:e.eventElapse,elapse:a-i.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?c.peerSuid=e.peerid:c.peer=e.peerid,this.send({type:Dn.SUBSCRIBE,data:c},!0)}wsCompressorInit(t){var e;const n=[...oa(e=this.baseInfoMap).call(e)],i=n.length?n[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;const a=r.info,c=Date.now(),l=ve(ve({},a),{},{eventType:wi.WS_COMPRESSOR_INIT,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,status:t.status?1:2});this.send({type:Dn.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const a=r.info,c=Date.now(),l=ve(ve(ve({},a),i),{},{elapse:c-r.startTime,eventType:e,lts:c,firstDecodeFrame:Math.max((i.firstFrame||c)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const a=r.info,c=Date.now(),l=ve(ve(ve({},a),i),{},{elapse:c-r.startTime,eventType:e,lts:c});this.send({type:n,data:l},!0)}abTest(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve(ve({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:wi.AB_TEST,lts:r});this.send({type:Dn.AB_TEST,data:a},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve(ve({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:wi.PC_STATS,lts:r,preallocation:e.preallocation?1:0});this.send({type:Dn.PC_STATS,data:a},!0)}updateRemoteRTPCapabilities(t,e){if(t){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve(ve({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:wi.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:Dn.UPDATE_REMOTE_RTPCAPABILITIES,data:a},!0)}}onGatewayStream(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const a=r.info,c=Date.now(),l=ve(ve(ve({},a),i),{},{eventType:e,lts:c});this.send({type:n,data:l},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve({},i),{},{eventType:wi.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-n.startTime,success:e.succ});this.send({type:Dn.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve({},i),{},{eventType:wi.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:Dn.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve({},i),{},{eventType:wi.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:Dn.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(t){this.proxyServer=t,t?T.debug("reportProxyServerurl: ".concat(t)):T.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve({},i),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:Dn.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now();(function(a,c,l){const u=a[c];if(!u||typeof u!="string")return[a];a[c]="";const h=dl(JSON.stringify(a));let p=0;const m=[];let g=0;for(let S=0;S<u.length;S++)g+=u.charCodeAt(S)<=127?1:3,g<=l-h||(m[m.length]=Vt(Vt({},a),{},{[c]:u.substring(p,S)}),p=S,g=u.charCodeAt(S)<=127?1:3);return p!==u.length-1&&(m[m.length]=Vt(Vt({},a),{},{[c]:u.substring(p)})),m})(ve(ve(ve({},i),e),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(a=>this.send({type:Dn.WORKER_EVENT,data:a},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve(ve({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:Dn.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve(ve({},i),e),{},{elapse:r-n.startTime,lts:r,extend:e.extend||void 0});this.send({type:Dn.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ve(ve(ve({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:Dn.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>B("CUSTOM_REPORT_LIMIT"))throw new ct(M.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=e.map(r=>({type:Dn.USER_ANALYTICS,data:ve(ve({sid:t},r),{},{lts:n})}));try{B("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(r){throw T.error("send custom report message failed",r.toString()),new ct(M.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(t){const e=B("NOT_REPORT_EVENT");if(t.tag&&At(e)&&At(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:r,cid:a}=n.info;let c;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof ct){const{code:u,message:h}=t.error;c=u||h||t.error.toString()}else c=t.error.toString();const l={invokeId:t.invokeId,sid:t.sid,cname:i,cid:a,uid:r,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?c:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Dn.API_INVOKE,data:l},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(n=>n!==null);e&&t.forEach(n=>{n&&(n.sid=e,this.sendApiInvoke(Object.assign({},n)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],i=[];for(;t.length;){const a=t.shift();n.length<20?n.push(a):i.push(a)}t.push(...i);for(const a of[...n]){var r;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),wS(r=this.ltsList).call(r,(c,l)=>c-l))}return e||(this.lastSendNormalEventTime=Date.now()),B("ENABLE_EVENT_REPORT")&&n.length&&(B("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((a=>c=>{B("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-B("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){si.networkState===Hs.OFFLINE&&await wt.race([si.onlineWaiter,Hi(2*hi.maxRetryTimeout)]);const e=r=>{let a=new Uint8Array;return r.forEach(c=>{const l=MA(JSON.stringify(c.data)),u=new ArrayBuffer(5),h=(m=>{let g=0;return Object.entries(Dn).forEach(S=>{let[D,w]=S;w===m.type&&(g=bG[D])}),g})(c),p=new DataView(u);p.setUint16(0,l.byteLength,!0),p.setUint8(2,255&h),p.setUint8(3,h>>>8&255),p.setUint8(4,h>>>16&255),a=KP(a,new Uint8Array(u)),a=KP(a,l)}),a},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let r=0;r<2;r+=1){r===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await HA(i,{timeout:1e4,data:e(t),headers:ve(ve({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(r===1)throw a;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(l=>{const u=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return u&&u.info.vid&&+u.info.vid||0})(t[0]),i=n?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(l=>JSON.stringify(l)),vid:n,aid:i};si.networkState===Hs.OFFLINE&&await wt.race([si.onlineWaiter,Hi(2*hi.maxRetryTimeout)]);const a=e?"/events/proto-raws":"/events/messages";let c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(B("EVENT_REPORT_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(a));for(let l=0;l<2;l+=1){l===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(B("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(a)));try{e?await cG(c,{timeout:1e4,data:r}):await HA(c,{timeout:1e4,data:r})}catch(u){if(l===1)throw u;continue}return}}createBaseInfo(t,e){const n=Object.assign({},vG);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),i=n[n.length-1];i&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:i,tag:Fn.TRACER}).onSuccess()}};Sk.on("REPORT_LOG_UPLOAD",t=>{t.networkState=si.networkState,Jt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Fn.TRACER}).onSuccess("logUploadError")});class nt extends ct{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Hn(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,T)}throw(){super.throw(T)}}const Wi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ke(){return Wi}function vk(){return"setSinkId"in HTMLAudioElement.prototype&&(!B("RESTRICTION_SET_PLAYBACK_DEVICE")||(md()||PP())&&!PA())}function bk(){return!Wi.supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&Ed()}let Ki=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function UE(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function He(t,e,n,i,r){return{width:t,height:e,frameRate:n,bitrateMin:i,bitrateMax:r}}function vo(t,e,n,i,r){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:i,bitrateMax:r}}function ew(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const RG={"90p":He(160,90),"90p_1":He(160,90),"120p":He(160,120,15,30,65),"120p_1":He(160,120,15,30,65),"120p_3":He(120,120,15,30,50),"120p_4":He(212,120),"180p":He(320,180,15,30,140),"180p_1":He(320,180,15,30,140),"180p_3":He(180,180,15,30,100),"180p_4":He(240,180,15,30,120),"240p":He(320,240,15,40,200),"240p_1":He(320,240,15,40,200),"240p_3":He(240,240,15,40,140),"240p_4":He(424,240,15,40,220),"360p":He(640,360,15,80,400),"360p_1":He(640,360,15,80,400),"360p_3":He(360,360,15,80,260),"360p_4":He(640,360,30,80,600),"360p_6":He(360,360,30,80,400),"360p_7":He(480,360,15,80,320),"360p_8":He(480,360,30,80,490),"360p_9":He(640,360,15,80,800),"360p_10":He(640,360,24,80,800),"360p_11":He(640,360,24,80,1e3),"480p":He(640,480,15,100,500),"480p_1":He(640,480,15,100,500),"480p_2":He(640,480,30,100,1e3),"480p_3":He(480,480,15,100,400),"480p_4":He(640,480,30,100,750),"480p_6":He(480,480,30,100,600),"480p_8":He(848,480,15,100,610),"480p_9":He(848,480,30,100,930),"480p_10":He(640,480,10,100,400),"720p":He(1280,720,15,120,1130),"720p_auto":He(1280,720,30,900,3e3),"720p_1":He(1280,720,15,120,1130),"720p_2":He(1280,720,30,120,2e3),"720p_3":He(1280,720,30,120,1710),"720p_5":He(960,720,15,120,910),"720p_6":He(960,720,30,120,1380),"1080p":He(1920,1080,15,120,2080),"1080p_1":He(1920,1080,15,120,2080),"1080p_2":He(1920,1080,30,120,3e3),"1080p_3":He(1920,1080,30,120,3150),"1080p_5":He(1920,1080,60,120,4780),"1440p":He(2560,1440,30,120,4850),"1440p_1":He(2560,1440,30,120,4850),"1440p_2":He(2560,1440,60,120,7350),"4k":He(3840,2160,30,120,8910),"4k_1":He(3840,2160,30,120,8910),"4k_3":He(3840,2160,60,120,13500)},CG={"480p":vo(640,480,5),"480p_1":vo(640,480,5),"480p_2":vo(640,480,30),"480p_3":vo(640,480,15),"720p":vo(1280,720,5),"720p_auto":He(1280,720,30,900,3e3),"720p_1":vo(1280,720,5),"720p_2":vo(1280,720,30),"720p_3":vo(1280,720,15),"1080p":vo(1920,1080,5),"1080p_1":vo(1920,1080,5),"1080p_2":vo(1920,1080,30),"1080p_3":vo(1920,1080,15)},AG={"1SL1TL":ew(1,1),"3SL3TL":ew(3,3),"2SL3TL":ew(2,3)};function hl(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},RG[t]):t}function nw(t){return typeof t=="string"?Object.assign({},CG[t]):t}function Vb(t){return typeof t=="string"?Object.assign({},AG[t]):t}const wG={speech_low_quality:UE(16e3,!1),speech_standard:UE(32e3,!1,18),music_standard:UE(48e3,!1),standard_stereo:UE(48e3,!0,56),high_quality:UE(48e3,!1,128),high_quality_stereo:UE(48e3,!0,192)};function Bb(t){return typeof t=="string"?Object.assign({},wG[t]):t}const jE=[];function Rk(t){return bi(t,"mediaSource",["screen","window","application"]),!0}let Ht=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),_n=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),VE=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),IG=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),OG=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),ef=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),BE=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),FE=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),GE=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),ca=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const iw={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},rw={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Ck={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},NG={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Ak={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let qr=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),la=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),XS=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),nf=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),Pr=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),pl=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const sw={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Fb=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function wk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ln(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?wk(Object(n),!0).forEach(function(i){et(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wk(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function et(t,e,n){return(e=function(i){var r=function(a,c){if(typeof a!="object"||a===null)return a;var l=a[Symbol.toPrimitive];if(l!==void 0){var u=l.call(a,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function We(t,e,n,i,r){var a,c,l={};return Object.keys(i).forEach(function(u){l[u]=i[u]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=ms(a=du(c=n.slice()).call(c)).call(a,function(u,h){return h(t,e,u)||u},l),r&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(r):void 0,l.initializer=void 0),l.initializer===void 0&&(Object.defineProperty(t,e,l),l=null),l}class Ik extends Mn{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(ef.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),et(this,"trackMediaType",void 0),et(this,"_ID",void 0),et(this,"_rtpTransceiver",void 0),et(this,"_lowRtpTransceiver",void 0),et(this,"_hints",[]),et(this,"_isClosed",!1),et(this,"_originMediaStreamTrack",void 0),et(this,"mediaStreamTrack",void 0),et(this,"_external",{}),this._ID=n||En(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(i){At(jE).call(jE,i)||jE.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Wu(()=>{var n;Jt.reportApiInvoke(null,{name:ui.GET_MEDIA_STREAM_TRACK,options:[],tag:Fn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===VE.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=jE.indexOf(e);n!==-1&&jE.splice(n,1)}(this),this.emit(BE.CLOSED),this.removeAllListeners(ef.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===VE.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(ef.TRANSCEIVER_UPDATED,e,n)}}class HE extends Ik{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),et(this,"_enabled",!0),et(this,"_muted",!1),et(this,"_isExternalTrack",!1),et(this,"_isClosed",!1),et(this,"_enabledMutex",void 0),et(this,"processor",void 0),et(this,"_processorContext",void 0),et(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new lr("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ht.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await mn(this,Ht.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(BE.TRACK_ENDED)}stateCheck(e,n){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),_d(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new ct(M.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",T);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new ct(M.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",T)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():wt.resolve([])}}const Ok=window.AudioContext||window.webkitAudioContext;let da=null;const an=new class extends Mn{constructor(){super(...arguments),et(this,"prevState",void 0),et(this,"curState",void 0),et(this,"currentTime",void 0),et(this,"currentTimeStuckAt",void 0),et(this,"interruptDetectorTrack",void 0),et(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(Ki.IOS_15_16_INTERRUPTION_START)}),et(this,"onLocalAudioTrackUnmute",async()=>{T.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?T.info("ios15-interruption-end-canceled"):(da&&await da.suspend(),this.emit(Ki.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){T.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){T.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function WE(){if(!da){if(function(){if(!Ok)return void T.error("your browser is not support web audio");T.info("create audio context");const t=Ln({},B("WEBAUDIO_INIT_OPTIONS"));T.debug("audio context init option:",JSON.stringify(t)),da=new Ok(t),an.curState=da.state,da.onstatechange=()=>{an.prevState=an.curState,an.curState=da?da.state:void 0;const{prevState:e,curState:n}=an,i=n==="running",r=n==="interrupted",a=e==="running",c=e==="suspended",l=e==="interrupted",u=Ge().osVersion;(Yr()||yo())&&a&&r&&(T.info("ios".concat(u,"-interruption-start")),an.emit(Ki.IOS_INTERRUPTION_START)),(Yr()||yo())&&(c||l)&&i&&(T.info("ios".concat(u,"-interruption-end")),an.emit(Ki.IOS_INTERRUPTION_END)),e!==n&&an.emit(Ki.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=da)===null||e===void 0?void 0:e.currentTime;an.currentTime!==n?(an.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(n)),an.currentTimeStuckAt=void 0),an.currentTime=n):(n!==an.currentTimeStuckAt&&(Jt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Fn.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(n))),an.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,r=!1,a=!1,c=!1;function l(w){e.state==="running"?u(!1):Yr()||yo()?e.state==="suspended"&&(u(!0),w&&e.resume().then(h,h)):e.state!=="closed"&&(u(!0),w&&e.resume().then(h,h))}function u(w){if(r!==w){r=w;for(let N=0,k=n;N<k.length;N+=1){const x=k[N];w?window.addEventListener(x,p,{capture:!0,passive:!0}):window.removeEventListener(x,p,{capture:!0,passive:!0})}}}function h(){l(!1)}function p(){l(!0)}function m(w){if(!c)if(i.paused)if(w){let N;g(!1),c=!0;try{N=i.play(),N?N.then(S,S):(i.addEventListener("playing",S),i.addEventListener("abort",S),i.addEventListener("error",S))}catch{S()}}else g(!0);else g(!1)}function g(w){if(a!==w){a=w;for(let N=0,k=n;N<k.length;N++){const x=k[N];w?window.addEventListener(x,D,{capture:!0,passive:!0}):window.removeEventListener(x,D,{capture:!0,passive:!0})}}}function S(){i.removeEventListener("playing",S),i.removeEventListener("abort",S),i.removeEventListener("error",S),c=!1,m(!1)}function D(){m(!0)}if(Yr()){const w=e.createMediaStreamDestination(),N=document.createElement("div");N.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=N.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=w.stream,m(!0)}an.on(Ki.STATE_CHANGE,function(){l(!0)}),l(!1)}(da)}(),!da)throw new ct(M.NOT_SUPPORTED,"can not create audio context");return da}return da}function rf(t){if(function(){if(aw!==null)return aw;const i=WE(),r=i.createBufferSource(),a=i.createGain(),c=i.createGain();r.connect(a),r.connect(c),r.disconnect(a);let l=!1;try{r.disconnect(a)}catch{l=!0}return r.disconnect(),aw=l,l}())return;const e=t.connect,n=t.disconnect;t.connect=(i,r,a)=>{var c;return t._inputNodes||(t._inputNodes=[]),At(c=t._inputNodes).call(c,i)||(i instanceof AudioNode?(t._inputNodes.push(i),e.call(t,i,r,a)):e.call(t,i,r)),t},t.disconnect=(i,r,a)=>{n.call(t),i?Nb(t._inputNodes,i):t._inputNodes=[];for(const c of t._inputNodes)e.call(t,c)}}let aw=null;function ow(t,e){let n=!1;const i=1/e;if(B("DISABLE_WEBAUDIO")){const r=window.setInterval(()=>{n?window.clearInterval(r):t(performance.now()/1e3)},1e3*i)}else{const r=WE();let a=r.createGain();a.gain.value=0,a.connect(r.destination);const c=()=>{if(n)return void(a=null);const l=r.createOscillator();l.onended=c,l.connect(a),l.start(0),l.stop(r.currentTime+i),t(r.currentTime)};c()}return()=>{n=!0}}class Nk{constructor(){et(this,"context",void 0),et(this,"analyserNode",void 0),et(this,"sourceNode",void 0),this.context=WE(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Yr()||yo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<e.length;++r)e[r]=i[r]/128-1}const n=ms(e).call(e,(i,r)=>i+r*r,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Dk extends Mn{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),et(this,"outputNode",void 0),et(this,"outputTrack",void 0),et(this,"isPlayed",!1),et(this,"sourceNode",void 0),et(this,"context",void 0),et(this,"audioBufferNode",void 0),et(this,"destNode",void 0),et(this,"audioOutputLevel",0),et(this,"volumeLevelAnalyser",void 0),et(this,"_processedNode",void 0),et(this,"playNode",void 0),et(this,"isDestroyed",!1),et(this,"onNoAudioInput",void 0),et(this,"isNoAudioInput",!1),et(this,"_noAudioInputCount",0),this.context=WE(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),rf(this.outputNode),this.volumeLevelAnalyser=new Nk}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(ca.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){const a=i.outputBuffer.getChannelData(r);for(let c=0;c<a.length;c+=1)a[c]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ke().webAudioMediaStreamDest)throw new ct(M.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&Db(()=>{an.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Yr()||yo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let r=!1;for(let a=0;a<i.length;a++)i[a]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await Hi(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Lk extends Dk{get isFreeze(){return!1}constructor(e,n,i){var r;if(super(),et(this,"sourceNode",void 0),et(this,"track",void 0),et(this,"clonedTrack",void 0),et(this,"audioElement",void 0),et(this,"isCurrentTrackCloned",!1),et(this,"isRemoteTrack",!1),et(this,"originVolumeLevelAnalyser",void 0),et(this,"rebuildWebAudio",async()=>{if(T.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const u=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(u),rf(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const h=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(h,this.context.currentTime),rf(this.outputNode),this.emit(ca.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=u,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new ct(M.UNEXPECTED_ERROR);this.track=e;const a=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(a),rf(this.sourceNode),i){const l=i.clone();l.enabled=!0,this.clonedTrack=l,T.debug("create an unmuted track ".concat(l.id," from the original track ").concat(i.id," to get the volume"));const u=this.context.createMediaStreamSource(new MediaStream([l]));rf(u),this.originVolumeLevelAnalyser=new Nk,this.originVolumeLevelAnalyser.updateSource(u)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;const c=Ge();n&&c.os===Ai.IOS&&Number((r=c.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(an.on(Ki.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),rf(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ca.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),an.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),T.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));rf(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Pk(t,e,n){const i=(a,c)=>a?typeof a!="number"?a.max||a.exact||a.ideal||a.min||c:a:c,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(r.video.mandatory.maxFrameRate=e.frameRate.max,r.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(r.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function DG(t,e){const n=await kk(t.mediaSource),{sourceId:i,audio:r}=await function(a){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new wt((l,u)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const m=document.createElement("div");m.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",m.setAttribute("style","height: 12%;");const g=document.createElement("div");g.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const S=document.createElement("div");S.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const D=document.createElement("button");D.innerHTML="cancel",D.setAttribute("style","width: 85px;"),D.onclick=()=>{document.body.removeChild(k);const x=new Error("NotAllowedError");x.name="NotAllowedError",u(x)};let w=c;const N=document.createElement("div");if(c){const x=document.createElement("input");x.setAttribute("type","checkbox");const W=document.createElement("span");x.setAttribute("style","margin-right: 6px;"),W.innerText="Share audio",x.checked=w,x.onchange=()=>{w=x.checked},N.appendChild(x),N.appendChild(W)}S.appendChild(N),S.appendChild(D),p.appendChild(m),p.appendChild(g),p.appendChild(S);const k=document.createElement("div");k.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),k.appendChild(h),k.appendChild(p),document.body.appendChild(k),a.map(x=>{if(x.id){const W=document.createElement("div");W.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Z=x.thumbnail;try{const{width:$}=Z.getSize();$>1920&&(Z=Z.resize({width:1920}))}catch($){throw $&&$.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),$}W.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Z.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+x.name.replace(/[\u00A0-\u9999<>\&]/g,function($){return"&#"+$.charCodeAt(0)+";"})+"</span>",W.onclick=()=>{document.body.removeChild(k),l({sourceId:x.id,audio:w})},g.appendChild(W)}})})}(n,e);return await Pk(i,t,r)}async function kk(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=zP();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new ct(M.ELECTRON_IS_NULL);let i=null;try{var r;i=((r=n.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new wt((a,c)=>{n.desktopCapturer.getSources({types:e},(l,u)=>{l?c(l):a(u)})}));try{return await i}catch(a){throw new ct(M.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}const cw=new lr("safari");let xk=!1,Mk=!1;async function ua(t,e){let n=0,i=null;for(;n<2;)try{i=await LG(t,e,n>0);break}catch(r){if(r instanceof ct)throw T.error("[".concat(e,"] ").concat(r.toString())),r;const a=Gb(r.name||r.code||r,r.message);if(a.code===M.MEDIA_OPTION_INVALID){T.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await Hi(500);continue}throw T.error("[".concat(e,"] ").concat(a.toString())),a}if(!i)throw new ct(M.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function LG(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ct(M.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const i=Ke(),r=new MediaStream;if(t.audioSource&&r.addTrack(t.audioSource),t.videoSource&&r.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return T.debug("Using Video Source/ Audio Source"),r;if(t.screen)if(zP())t.screen.sourceId?KE(r,await Pk(t.screen.sourceId,t.screen,!!t.screenAudio)):KE(r,await DG(t.screen,!!t.screenAudio));else if(md()&&t.screen.extensionId&&t.screen.mandatory){if(!i.getStreamFromExtension)throw new ct(M.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const g=await(c=t.screen.extensionId,l=e,new wt((S,D)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},w=>{if(!w||!w.streamId)return T.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),w),void D(new ct(M.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));S(w.streamId)})}catch(w){T.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),w.toString()),D(new ct(M.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=g,KE(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(i.getDisplayMedia){var a;t.screen.mediaSource&&Rk(t.screen.mediaSource);const g={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(a=t.screen.displaySurface)!==null&&a!==void 0?a:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:S,surfaceSwitching:D,systemAudio:w,preferCurrentTab:N}=t.screen,k={selfBrowserSurface:S,surfaceSwitching:D,systemAudio:w,preferCurrentTab:N};!S&&delete k.selfBrowserSurface,!D&&delete k.surfaceSwitching,!w&&delete k.systemAudio,!N&&delete k.preferCurrentTab,T.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:g,audio:t.screenAudio,controls:k})),KE(r,await navigator.mediaDevices.getDisplayMedia(Ln({video:g,audio:t.screenAudio},k)))}else{if(!Vn())throw T.error("[".concat(e,"] This browser does not support screenSharing")),new ct(M.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&Rk(t.screen.mediaSource);const g={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};T.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(g))),KE(r,await navigator.mediaDevices.getUserMedia(g))}}var c,l;if(!t.video&&!t.audio)return r;let u={video:t.video,audio:t.audio},h=B("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),u=VA(u,h)}catch{}T.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(u)),Ge();let p,m=null;($i()||Yr()||Ib())&&(m=await cw.lock());try{p=await navigator.mediaDevices.getUserMedia(u)}catch(g){throw m&&m(),g}return u.audio&&(xk=!0),u.video&&(Mk=!0),KE(r,p),m&&m(),r}function Gb(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ct(M.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new ct(M.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new ct(M.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new ct(M.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ct(M.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new ct(M.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return T.error("getUserMedia unexpected error",t),new ct(M.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function KE(t,e){const n=t.getVideoTracks()[0],i=t.getAudioTracks()[0],r=e.getVideoTracks()[0],a=e.getAudioTracks()[0];a&&(i&&t.removeTrack(i),t.addTrack(a)),r&&(n&&t.removeTrack(n),t.addTrack(r))}const ha=new class extends Mn{get state(){return this._state}set state(t){t!==this._state&&(this.emit(nf.STATE_CHANGE,t),this._state=t)}constructor(){super(),et(this,"_state",XS.IDLE),et(this,"isAccessMicrophonePermission",!1),et(this,"isAccessCameraPermission",!1),et(this,"lastAccessMicrophonePermission",!1),et(this,"lastAccessCameraPermission",!1),et(this,"checkdeviceMatched",!1),et(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(B("ENUMERATE_DEVICES_INTERVAL")||(Ob()||wb()===Ai.HARMONY_OS)&&Ed())&&this.updateDevicesInfo()},B("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>T.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ct(M.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i);let a=!this.isAccessMicrophonePermission&&t,c=!this.isAccessCameraPermission&&e;r.audio&&(a=!1),r.video&&(c=!1);let l=null,u=null,h=null;if(!n&&(a||c)){if(cw.isLocked&&(T.debug("[device manager] wait GUM lock"),(await cw.lock())(),T.debug("[device manager] GUM unlock")),xk&&(a=!1,this.isAccessMicrophonePermission=!0),Mk&&(c=!1,this.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",t,e,a,c),a&&c){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){const m=Gb(p.name||p.code||p,p.message);if(m.code===M.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{l=await navigator.mediaDevices.getUserMedia({audio:t})}catch(p){const m=Gb(p.name||p.code||p,p.message);if(m.code===M.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessMicrophonePermission=!0}else if(c){try{u=await navigator.mediaDevices.getUserMedia({video:e})}catch(p){const m=Gb(p.name||p.code||p,p.message);if(m.code===M.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",t,"cam permission",e)}try{const p=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(m=>m.stop()),u&&u.getTracks().forEach(m=>m.stop()),h&&h.getTracks().forEach(m=>m.stop()),l=null,u=null,h=null,p}catch(p){return l&&l.getTracks().forEach(m=>m.stop()),u&&u.getTracks().forEach(m=>m.stop()),h&&h.getTracks().forEach(m=>m.stop()),l=null,u=null,h=null,new ct(M.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new ct(M.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=XS.INITING;try{await this.updateDevicesInfo(),this.state=XS.INITEND}catch(t){throw T.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=XS.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new ct(M.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const r=t.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),a=t.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");r&&a?a.groupId===r.groupId?T.debug("[device-check] default input ".concat(r.label," and output ").concat(a.label," is the same group")):T.debug("[device-check] default input ".concat(r.label," and output ").concat(a.label," is not the same group")):T.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(r=>{if(!r.deviceId)return;const a=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){const c={initAt:e,updateAt:e,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),c),n.push(c)}a&&(a.updateAt=e)}),this.deviceInfoMap.forEach((r,a)=>{r.state==="ACTIVE"&&r.updateAt!==e&&(r.state="INACTIVE",n.push(r))}),this.state!==XS.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(nf.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(nf.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(nf.PLAYOUT_DEVICE_CHANGED,r)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(r=>r.kind==="audioinput"),n=t.filter(r=>r.kind==="videoinput"),i={audio:!1,video:!1};for(const r of e)if(r.label&&r.deviceId){i.audio=!0;break}for(const r of n)if(r.label&&r.deviceId){i.video=!0;break}return i}};let lw=!1;const pa=new class extends Mn{constructor(){super(...arguments),et(this,"onAutoplayFailed",void 0),et(this,"onAudioAutoplayFailed",void 0)}};function Uk(){if(Ge(),!lw){const t=e=>{e.preventDefault(),lw=!1,BS()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};lw=!0,BS()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),pa.onAutoplayFailed?pa.onAutoplayFailed():pa.onAudioAutoplayFailed?T.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):T.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),pa.emit("autoplay-failed")}}function jk(t,e,n,i){if(!t)return;const r=Jt.getBaseInfoBySessionId(t);if(!r)return;const a=r.info,c=Date.now(),l=Ln(Ln({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:c,elapse:c-r.startTime,cbRegistered:pa.onAutoplayFailed||pa.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:i,extend:void 0});Jt.send({type:Dn.AUTOPLAY_FAILED,data:l},!0)}const PG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],as=new class{constructor(){et(this,"onAutoplayFailed",void 0),et(this,"elementMap",new Map),et(this,"elementStateMap",new Map),et(this,"elementsNeedToResume",[]),et(this,"sinkIdMap",new Map),et(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const r=this.elementStateMap.get(n),a=i.srcObject.getAudioTracks()[0],c=a&&a.readyState;if(T.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(c," ").concat(t)),c==="live"){if(t)return i.pause(),void i.play();if(an.curState==="running")return DE()?(i.pause(),void i.play()):void(r&&r==="paused"&&i.play())}})}),et(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),an.on(Ki.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),an.on(Ki.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),an.on(Ki.STATE_CHANGE,()=>{Yr()&&an.prevState==="suspended"&&an.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(i){throw new ct(M.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(t,e,n,i){if(this.elementMap.has(e))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,r),this.elementMap.set(e,r),this.elementStateMap.set(e,Pr.INIT),this.setVolume(e,n);const a=this.sinkIdMap.get(e);if(a)try{r.setSinkId(a).catch(l=>{T.warning("[".concat(e,"] set sink id failed"),l.toString())})}catch(l){T.warning("[".concat(e,"] set sink id failed"),l.toString())}const c=r.play();c&&c.then&&c.catch(l=>{i&&jk(i,"audio",l.message,e),T.warning("audio element play warning",l.toString()),this.elementMap.has(e)&&l.name==="NotAllowedError"&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),Db(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Uk()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){PG.forEach(n=>{e.addEventListener(n,i=>{const r=this.elementStateMap.get(t),a=i.type==="pause"?"paused":i.type;if(T.debug("[".concat(t,"] audio-element-status change ").concat(r," => ").concat(a)),i.type==="error"){const c=e==null?void 0:e.error;c&&T.error("[".concat(t,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(t,a)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{T.debug("Auto resume audio element success")}).catch(n=>{T.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new wt(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{BS()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function ti(){return function(t,e,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new ct(M.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",T);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];const l=i.apply(this,a);return l instanceof wt?new wt((u,h)=>{l.then(u).catch(h)}):l}),n}}class Vk extends Mn{constructor(e){super(),et(this,"name","VideoProcessorDestination"),et(this,"ID","0"),et(this,"_source",void 0),et(this,"videoContext",void 0),et(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ct(M.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ct(M.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(qr.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(qr.ON_TRACK,void 0)}}class Bk extends Mn{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),et(this,"constraintsMap",new Map),et(this,"statsRegistry",[]),et(this,"usageRegistry",[]),et(this,"trackId",void 0),et(this,"direction",void 0),et(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await er(this,la.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var i;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),mn(this,la.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fi(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return T.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),mn(this,la.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fi(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:a}of this.statsRegistry)try{const c=a();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){T.error(new ct(M.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof wt&&(i=await i),e.push(Ln(Ln({},i),{},{direction:this.direction}))}catch(i){T.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class Fk extends Mn{constructor(e){super(),et(this,"name","AudioProcessorDestination"),et(this,"ID","0"),et(this,"inputTrack",void 0),et(this,"inputNode",void 0),et(this,"audioProcessorContext",void 0),et(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ct(M.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ct(M.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(qr.ON_TRACK,void 0),this.emit(qr.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(qr.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(qr.ON_NODE,this.inputNode))}}class Gk extends Mn{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,i){super(),et(this,"constraintsMap",new Map),et(this,"statsRegistry",[]),et(this,"audioContext",void 0),et(this,"trackId",void 0),et(this,"direction",void 0),et(this,"usageRegistry",[]),et(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=i}async getConstraints(){return er(this,la.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var i;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),mn(this,la.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fi(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),mn(this,la.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fi(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:a}of this.statsRegistry)try{const c=a();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){T.error(new ct(M.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof wt&&(i=await i),e.push(Ln(Ln({},i),{},{direction:this.direction}))}catch(i){T.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class dw extends Mn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),et(this,"context",void 0),et(this,"processSourceNode",void 0),et(this,"outputTrack",void 0),et(this,"processedNode",void 0),et(this,"clonedTrack",void 0),et(this,"outputNode",void 0),this.outputNode=new kG}setVolume(){}createOutputTrack(){throw new ct(M.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class kG{disconnect(){}connect(){}}function Hk(t){return new wt((e,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const a=Yr()?"canplay":"playing";r.addEventListener(a,()=>{const c=r.videoWidth,l=r.videoHeight;!c&&Vn()||(i=!0,r.srcObject=null,r.remove(),e([c,l]))}),r.srcObject=new MediaStream([t]),r.play().catch(Lb),setTimeout(()=>{i||(r.srcObject=null,r.remove(),e([r.videoWidth,r.videoHeight]))},4e3)})}function Hb(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=hl(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!FP()&&n.frameRate&&(e.frameRate=n.frameRate),PP()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),Vn()&&(e.frameRate={ideal:30,max:30}),e}function Wk(t){const e={};return FP()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,md()&&t.ANS&&(e.googHighpassFilter=t.ANS))),e}function Kk(t){const e=Wk(t);if(t.encoderConfig){const n=Bb(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),Ob()&&(e.sampleRate=void 0),e}const xG=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:i,height:r}=t.getMediaStreamTrackSettings();let{frameRate:a=n,width:c=i,height:l=r}=e;if(!a||!c||!l)return;c=BA(c),l=BA(l),a=BA(a);const{max:u,min:h}=function(S,D,w){const N=200*Math.pow(w/15,.6)*Math.pow(S*D/640/360,.75);return{min:Math.floor(N),max:Math.floor(4*N)}}(c,l,a),{bitrateMax:p,bitrateMin:m}=e||{};p||T.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(a,"] => [brMax: ").concat(p,", brMin: ").concat(m,"]"));const{maxFramerate:g}=B("ENCODER_CONFIG_LIMIT");return g&&typeof g=="number"&&(a=Math.min(a,g)),{frameRate:a,bitrateMax:p||u,bitrateMin:m||h,scaleResolutionDownBy:1,scale:0}},zk=async(t,e,n)=>await(async(i,r,a)=>{const c=function(h){const p=[];for(let m=0;m<h.length;m+=2)p.push(parseInt(h.slice(m,m+2),16));return Uint8Array.from(p)}(ik(""+r+a)).slice(0,16),l=c.slice(0,12),u=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},u,i))})(t.buffer,e,n),uw=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new wt((n,i)=>{e.toBlob(async r=>{if(e.remove(),r){const a=await Yk(r);n({buffer:a,width:e.width,height:e.height})}else i(new ct(M.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},Yk=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var qk,Xk,Jk,Qk,Zk,$k,t1,e1,n1,i1,r1,s1,a1,o1,c1,l1,d1,u1,Un,h1,p1,f1,m1,E1,_1,fl,g1,S1,y1,T1,v1,b1,R1,C1,A1,w1,I1,O1,N1,ir;let Wn=(qk=le({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),Xk=le({argsMap:(t,e)=>[t.getTrackId(),e]}),Jk=ti(),Qk=kE("LocalAudioTrack","_enabledMutex"),Zk=le({argsMap:(t,e)=>[t.getTrackId(),e]}),$k=ti(),t1=kE("LocalAudioTrack","_enabledMutex"),e1=le({argsMap:(t,e)=>[t.getTrackId(),e]}),n1=ti(),i1=ti(),r1=ti(),s1=le({argsMap:t=>[t.getTrackId()]}),a1=ti(),o1=le({argsMap:t=>[t.getTrackId()]}),c1=ti(),l1=le({argsMap:t=>[t.getTrackId()]}),d1=le({argsMap:(t,e)=>[t.getTrackId(),e.name]}),u1=le({argsMap:t=>[t.getTrackId()]}),We((Un=class extends HE{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?as.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,i){super(t,n),et(this,"trackMediaType",GE.AUDIO),et(this,"_encoderConfig",void 0),et(this,"_trackSource",void 0),et(this,"metadata",[]),et(this,"_enabled",!0),et(this,"_volume",100),et(this,"_useAudioElement",!0),et(this,"_bypassWebAudio",!1),et(this,"processor",void 0),et(this,"_processorContext",void 0),et(this,"_processorDestination",void 0),et(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!i,this._trackSource=new dw,B("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),B("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),$i()&&!da?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){cn(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&as.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,mn(this,Ht.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!vk())throw new ct(M.NOT_SUPPORTED,"your browser does not support setting the audio output device");await as.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await mn(this,Ht.NEED_ENABLE_TRACK,this),T.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(i){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await mn(this,Ht.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await mn(this,Ht.NEED_MUTE_TRACK,this):await mn(this,Ht.NEED_UNMUTE_TRACK,this))}getStats(){return Wu(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),sa(this,Ht.GET_STATS)||Ln({},iw)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ca.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(ca.ON_AUDIO_BUFFER),this._source.on(ca.ON_AUDIO_BUFFER,n=>t(n))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),as.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?as.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&as.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await mn(this,Ht.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return wt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new ct(M.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new ct(M.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(qr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await mn(this,Ht.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await mn(this,Ht.NEED_REPLACE_TRACK,this))}),t.on(qr.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(qr.ON_TRACK),t.removeAllListeners(qr.ON_NODE)}bindProcessorContextEvents(t){t.on(la.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(la.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof dw&&(this._trackSource=new Lk(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new Gk(this._source.context,this.getTrackId(),"local"),e=new Fk(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(ca.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(as.stop(this.getTrackId()),this._source.play()),mn(this,Ht.NEED_REPLACE_MIXING_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[qk],Object.getOwnPropertyDescriptor(Un.prototype,"setVolume"),Un.prototype),We(Un.prototype,"setPlaybackDevice",[Xk,Jk],Object.getOwnPropertyDescriptor(Un.prototype,"setPlaybackDevice"),Un.prototype),We(Un.prototype,"setEnabled",[Qk,Zk,$k],Object.getOwnPropertyDescriptor(Un.prototype,"setEnabled"),Un.prototype),We(Un.prototype,"setMuted",[t1,e1,n1],Object.getOwnPropertyDescriptor(Un.prototype,"setMuted"),Un.prototype),We(Un.prototype,"getStats",[i1],Object.getOwnPropertyDescriptor(Un.prototype,"getStats"),Un.prototype),We(Un.prototype,"setAudioFrameCallback",[r1],Object.getOwnPropertyDescriptor(Un.prototype,"setAudioFrameCallback"),Un.prototype),We(Un.prototype,"play",[s1,a1],Object.getOwnPropertyDescriptor(Un.prototype,"play"),Un.prototype),We(Un.prototype,"stop",[o1,c1],Object.getOwnPropertyDescriptor(Un.prototype,"stop"),Un.prototype),We(Un.prototype,"close",[l1],Object.getOwnPropertyDescriptor(Un.prototype,"close"),Un.prototype),We(Un.prototype,"pipe",[d1],Object.getOwnPropertyDescriptor(Un.prototype,"pipe"),Un.prototype),We(Un.prototype,"unpipe",[u1],Object.getOwnPropertyDescriptor(Un.prototype,"unpipe"),Un.prototype),Un),Wb=(h1=le({argsMap:(t,e)=>[t.getTrackId(),e]}),p1=ti(),f1=kE("MicrophoneAudioTrack","_enabledMutex"),m1=le({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),E1=ti(),_1=le({argsMap:t=>[t.getTrackId()]}),We((fl=class extends Wn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,i){super(t,e.encoderConfig?Bb(e.encoderConfig):{},i,B("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),et(this,"_config",void 0),et(this,"_deviceName","default"),et(this,"_constraints",void 0),et(this,"_originalConstraints",void 0),et(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(DE()||LA())&&an.bindInterruptDetectorTrack(this)}async setDevice(t){if(T.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await ha.getDeviceById(t),n={};n.audio=Ln({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let i=null;try{i=await ua(n,this.getTrackId())}catch(r){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await ua({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await ha.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}T.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return T.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),B("AUTO_RESET_AUDIO_ROUTE")&&(Yr()||yo())){const c=navigator.audioSession;c&&(t||(c.type="playback"),c.type="auto")}if(!t){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await mn(this,Ht.NEED_DISABLE_TRACK,this)}catch(c){throw T.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const r=Ln({},this._constraints),a=ha.searchDeviceIdByName(this._deviceName);a&&!r.deviceId&&(r.deviceId=a);try{n||(this._enabled=!0);const c=await ua({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await mn(this,Ht.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}T.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(DE()||LA())&&an.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Yr()||yo())&&this._enabled&&!this._isClosed&&an.duringInterruption){const t=async()=>{an.off(Ki.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};an.on(Ki.IOS_INTERRUPTION_END,t)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(BE.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=ha.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const i=await ua({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(la.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(la.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[h1,p1],Object.getOwnPropertyDescriptor(fl.prototype,"setDevice"),fl.prototype),We(fl.prototype,"setEnabled",[f1,m1,E1],Object.getOwnPropertyDescriptor(fl.prototype,"setEnabled"),fl.prototype),We(fl.prototype,"close",[_1],Object.getOwnPropertyDescriptor(fl.prototype,"close"),fl.prototype),fl),MG=(g1=le({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),S1=ti(),y1=le({argsMap:t=>[t.getTrackId()]}),T1=ti(),v1=le({argsMap:t=>[t.getTrackId()]}),b1=ti(),R1=le({argsMap:t=>[t.getTrackId()]}),C1=ti(),A1=le({argsMap:t=>[t.getTrackId()]}),w1=ti(),I1=le({argsMap:t=>[t.getTrackId()]}),O1=le({argsMap:t=>[t.getTrackId()]}),N1=ti(),We((ir=class extends Wn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,i){super(e.createOutputTrack(),n,i),et(this,"source",void 0),et(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(ca.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(BE.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){cn(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[g1,S1],Object.getOwnPropertyDescriptor(ir.prototype,"startProcessAudioBuffer"),ir.prototype),We(ir.prototype,"pauseProcessAudioBuffer",[y1,T1],Object.getOwnPropertyDescriptor(ir.prototype,"pauseProcessAudioBuffer"),ir.prototype),We(ir.prototype,"seekAudioBuffer",[v1,b1],Object.getOwnPropertyDescriptor(ir.prototype,"seekAudioBuffer"),ir.prototype),We(ir.prototype,"resumeProcessAudioBuffer",[R1,C1],Object.getOwnPropertyDescriptor(ir.prototype,"resumeProcessAudioBuffer"),ir.prototype),We(ir.prototype,"stopProcessAudioBuffer",[A1,w1],Object.getOwnPropertyDescriptor(ir.prototype,"stopProcessAudioBuffer"),ir.prototype),We(ir.prototype,"close",[I1],Object.getOwnPropertyDescriptor(ir.prototype,"close"),ir.prototype),We(ir.prototype,"setAudioBufferPlaybackSpeed",[O1,N1],Object.getOwnPropertyDescriptor(ir.prototype,"setAudioBufferPlaybackSpeed"),ir.prototype),ir);class _i extends Wn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=WE().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,En(8,"track-mix-")),et(this,"trackList",void 0),et(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(T.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):T.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){T.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}Nb(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof _i?n.emit(ef.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class UG extends Dk{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(ca.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),et(this,"audioBuffer",void 0),et(this,"sourceNode",void 0),et(this,"startPlayTime",0),et(this,"startPlayOffset",0),et(this,"pausePlayTime",0),et(this,"options",void 0),et(this,"currentLoopCount",0),et(this,"currentPlaybackSpeed",100),et(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const D1=new Map;class hw{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){et(this,"trackId",void 0),et(this,"config",void 0),et(this,"onFirstVideoFrameDecoded",void 0),et(this,"onVideoStateChanged",void 0),et(this,"freezeTimeCounterList",[]),et(this,"renderFreezeAccTime",0),et(this,"isKeepLastFrame",!1),et(this,"timeUpdatedCount",0),et(this,"freezeTime",0),et(this,"playbackTime",0),et(this,"lastTimeUpdatedTime",0),et(this,"autoplayFailed",!1),et(this,"videoTrack",void 0),et(this,"videoElement",void 0),et(this,"cacheVideoElement",void 0),et(this,"renderStats",void 0),et(this,"_videoState",pl.VideoStateStopped),et(this,"videoElementCheckInterval",void 0),et(this,"videoElementFreezeTimeout",void 0),et(this,"_videoElementStatus",Pr.NONE),et(this,"isGettingVideoDimensions",!1),et(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),et(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&an.curState==="running"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(LP())),VP()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),et(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Pr.PLAYING;break;case"loadeddata":if(this.videoState=pl.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Pr.CANPLAY;break;case"stalled":this.videoElementStatus=Pr.STALLED;break;case"suspend":this.videoElementStatus=Pr.SUSPEND;break;case"pause":this.videoElementStatus=Pr.PAUSED,Yr()||yo()||$i()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Pr.WAITING;break;case"abort":this.videoElementStatus=Pr.ABORT;break;case"ended":this.videoElementStatus=Pr.ENDED;break;case"emptied":this.videoElementStatus=Pr.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=Pr.ERROR,T.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const r=i-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Sd.lastVisibleTime<Sd.lastHiddenTime||a<Sd.lastHiddenTime||a<Sd.lastVisibleTime)return;for(r>B("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),et(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(LP())),VP()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),an.on(Ki.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),an.on(Ki.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(r=>{e&&jk(e,"video",r.message,this.trackId),r.name==="NotAllowedError"?(T.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),r)});const i=Ge();if((i.name==="Safari"&&Number(i.version)===15||DE())&&n&&n.then){const r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(r).catch(r)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return T.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new wt((a,c)=>{i.toBlob(async l=>{if(i.remove(),l){const u=await Yk(l);a({buffer:u,width:i.width,height:i.height})}else c(new ct(M.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await uw(e)}destroy(){this.renderStats=void 0,an.off(Ki.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),an.off(Ki.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=pl.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Pr.INIT,!this.videoElementCheckInterval&&(L1.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)||(this.videoElementStatus=Pr.DESTROYED)},1e3),B("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let a;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,B("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===pl.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=pl.VideoStateFrozen:document.addEventListener("visibilitychange",c))},u=(h,p)=>{if(this.videoElementStatus===Pr.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=p.mediaTime):this.renderStats={lastTs:p.mediaTime,curTs:p.mediaTime,lastRenderNum:0,renderNum:0},a){const S=p.presentationTime-a.presentationTime;this.videoState===pl.VideoStateStarting&&(this.videoState=pl.VideoStateDecoding),this.videoState===pl.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,B("VIDEO_FREEZE_DURATION"))),S<B("VIDEO_FREEZE_DURATION")&&this.videoState===pl.VideoStateFrozen&&(this.videoState=pl.VideoStateDecoding),S>B("VIDEO_FREEZE_DURATION")&&Sd.lastVisibleTime>=Sd.lastHiddenTime&&a.timestamp>Sd.lastVisibleTime&&a.timestamp>Sd.lastHiddenTime&&(this.renderFreezeAccTime+=S)}a=Ln(Ln({},p),{},{timestamp:h})}var m,g;B("ENABLE_VIDEO_FRAME_CALLBACK")&&((m=(g=this.videoElement).requestVideoFrameCallback)===null||m===void 0||m.call(g,u))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,u)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Ob()&&!B("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=Ge();i.name==="Safari"&&Number(i.version)===15||DE()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Vn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Vn()&&this.videoElement.load());const r=this.videoElement.play();r!==void 0&&r.catch(a=>{T.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){L1.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Pr.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{T.error(i)}),this.autoplayFailed=!1,BS()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};BS()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Uk()}}const L1=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class P1 extends hw{constructor(e){super(e),et(this,"container",void 0),et(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await uw(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",B("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var k1,x1,M1,U1,j1,V1,B1,F1,G1,H1,W1,K1,z1,Y1,q1,X1,J1,Q1,Z1,$1,tx,ex,nx,ix,Ve,rx,sx,ax,ox,cx,lx,dx,ux,fa;let wn=(k1=le({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),x1=ti(),M1=le({argsMap:t=>[t.getTrackId()]}),U1=kE("LocalVideoTrack","_enabledMutex"),j1=le({argsMap:(t,e)=>[t.getTrackId(),e]}),V1=ti(),B1=kE("LocalVideoTrack","_enabledMutex"),F1=le({argsMap:(t,e)=>[t.getTrackId(),e]}),G1=ti(),H1=le({argsMap:(t,e)=>[t.getTrackId(),e]}),W1=ti(),K1=ti(),z1=le({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),Y1=ti(),q1=ti(),X1=ti(),J1=ti(),Q1=ti(),Z1=ti(),$1=ti(),tx=le({argsMap:(t,e)=>[t.getTrackId(),e.name]}),ex=le({argsMap:t=>[t.getTrackId()]}),nx=le({argsMap:t=>[t.getTrackId()]}),ix=le({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),Ve=class mB extends HE{get videoHeight(){if($i()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if($i()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Pr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,i,r,a,c){if(super(e,a),et(this,"trackMediaType",GE.VIDEO),et(this,"_player",void 0),et(this,"isUseScaleResolutionDownBy",!1),et(this,"_videoVisibleTimer",null),et(this,"_previousVideoVisibleStatus",void 0),et(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),et(this,"_encoderConfig",void 0),et(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),et(this,"_optimizationMode",void 0),et(this,"_videoHeight",void 0),et(this,"_videoWidth",void 0),et(this,"_forceBitrateLimit",void 0),et(this,"_enabled",!0),et(this,"_processorDestination",void 0),et(this,"_processorContext",void 0),$i()){const{width:l,height:u}=e.getSettings();this._videoWidth=l,this._videoHeight=u}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=i,this._optimizationMode=r,this._hints=c||[],this._hints.indexOf(_n.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(OA(Ye.CHROME,115)&&wb().indexOf("Windows")!==-1){const l=function(u,h){if("VideoFrame"in window&&"TransformStream"in window&&Ke().supportWebRTCInsertableStream){const p=new MediaStreamTrackProcessor(u),m=new MediaStreamTrackGenerator({kind:"video"});let g,S,D=Date.now();const w=()=>{N&&(clearInterval(N),N=void 0),g&&(g.close(),g=void 0),u.stop(),S=void 0,m.removeEventListener("ended",w)};let N=window.setInterval(()=>{if(S&&g&&Date.now()-D>1e3)try{m.readyState==="live"?S.enqueue(g.clone()):w()}catch{w()}},1e3);const k=new TransformStream({transform:(x,W)=>{m.readyState==="live"?(S=W,D=Date.now(),g===void 0?(g=x,W.enqueue(x.clone())):(W.enqueue(g),g=x)):x.close()}});return m.addEventListener("ended",w),p.readable.pipeThrough(k).pipeTo(m.writable),m}}(e);l&&(T.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}n&&this._hints.indexOf(_n.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new Bk(this.getTrackId(),"local"),this._processorDestination=new Vk(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=Ln(Ln(Ln({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new hw(i):this._player=new P1(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(BE.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await mn(this,Ht.NEED_DISABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await mn(this,Ht.NEED_ENABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await mn(this,Ht.NEED_MUTE_TRACK,this):await mn(this,Ht.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,n){if(!this._enabled)throw new ct(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=hl(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const i=Hb({encoderConfig:e});($i()||Yr()||yo())&&(i.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(r){const a=new ct(M.UNEXPECTED_ERROR,r.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=e,this._hints.indexOf(_n.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await mn(this,Ht.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(T)}}getStats(){return Wu(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),sa(this,Ht.GET_STATS)||Ln({},rw)}async setBeautyEffect(e){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await uw(e)}async setBitrateLimit(e){T.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void T.error(M.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await mn(this,Ht.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,T.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return T.error(M.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){Hk(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(Lb)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new ct(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");T.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=hl(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(_n.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await mn(this,Ht.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!n||!i)return;const{bitrateMax:r,bitrateMin:a}=this._encoderConfig;if(a==null||r==null){const{max:c,min:l}=function(u,h,p,m,g){const S=B("BITRATE_ADAPTER_TYPE");if(S==="DEFAULT_BITRATE")return{min:m,max:g};if(g===void 0){var D;const N=Math.floor(200*Math.pow(p/15,.6)*Math.pow(u*h/640/360,.75));g=S==="STANDARD_BITRATE"?4*N:2*N,m=(D=m)!==null&&D!==void 0?D:N}else{var w;m=(w=m)!==null&&w!==void 0?w:Math.floor(g/10)}return{min:m,max:g}}(e,n,i,a,r);this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]"))}}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:c}=r;if(this.isPlaying&&a instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=WP.checkOneElementVisible(a),u=Object.assign({},l);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const h=Jt.reportApiInvoke(null,{tag:Fn.TRACER,name:ui.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(i){throw new ct(M.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new ct(M.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=Ln(Ln({},i),hl(e))),i=Qp(i);const r=En(8,"track-video-cloned-"),a=new mB(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Qp(this._scalabilityMode),this._optimizationMode,r,Qp(this._hints));return e&&i&&a.setEncoderConfiguration(i),T.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),a}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new ct(M.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new ct(M.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(Wu(()=>{Jt.reportApiInvoke(null,{name:ui.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Fn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!B("ENABLE_VIDEO_SEI")||!B("ENABLE_ENCODED_TRANSFORM"))return void T.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new ct(M.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void T.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const r=i.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"?this.safeEmit("sei-to-send",e):T.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(qr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await mn(this,Ht.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await mn(this,Ht.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(la.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(la.REQUEST_CONSTRAINTS)}},We(Ve.prototype,"play",[k1,x1],Object.getOwnPropertyDescriptor(Ve.prototype,"play"),Ve.prototype),We(Ve.prototype,"stop",[M1],Object.getOwnPropertyDescriptor(Ve.prototype,"stop"),Ve.prototype),We(Ve.prototype,"setEnabled",[U1,j1,V1],Object.getOwnPropertyDescriptor(Ve.prototype,"setEnabled"),Ve.prototype),We(Ve.prototype,"setMuted",[B1,F1,G1],Object.getOwnPropertyDescriptor(Ve.prototype,"setMuted"),Ve.prototype),We(Ve.prototype,"setEncoderConfiguration",[H1,W1],Object.getOwnPropertyDescriptor(Ve.prototype,"setEncoderConfiguration"),Ve.prototype),We(Ve.prototype,"getStats",[K1],Object.getOwnPropertyDescriptor(Ve.prototype,"getStats"),Ve.prototype),We(Ve.prototype,"setBeautyEffect",[z1,Y1],Object.getOwnPropertyDescriptor(Ve.prototype,"setBeautyEffect"),Ve.prototype),We(Ve.prototype,"getCurrentFrameData",[q1],Object.getOwnPropertyDescriptor(Ve.prototype,"getCurrentFrameData"),Ve.prototype),We(Ve.prototype,"getCurrentFrameImage",[X1],Object.getOwnPropertyDescriptor(Ve.prototype,"getCurrentFrameImage"),Ve.prototype),We(Ve.prototype,"setBitrateLimit",[J1],Object.getOwnPropertyDescriptor(Ve.prototype,"setBitrateLimit"),Ve.prototype),We(Ve.prototype,"setOptimizationMode",[Q1],Object.getOwnPropertyDescriptor(Ve.prototype,"setOptimizationMode"),Ve.prototype),We(Ve.prototype,"setScalabiltyMode",[Z1],Object.getOwnPropertyDescriptor(Ve.prototype,"setScalabiltyMode"),Ve.prototype),We(Ve.prototype,"updateMediaStreamTrackResolution",[$1],Object.getOwnPropertyDescriptor(Ve.prototype,"updateMediaStreamTrackResolution"),Ve.prototype),We(Ve.prototype,"pipe",[tx],Object.getOwnPropertyDescriptor(Ve.prototype,"pipe"),Ve.prototype),We(Ve.prototype,"unpipe",[ex],Object.getOwnPropertyDescriptor(Ve.prototype,"unpipe"),Ve.prototype),We(Ve.prototype,"close",[nx],Object.getOwnPropertyDescriptor(Ve.prototype,"close"),Ve.prototype),We(Ve.prototype,"replaceTrack",[ix],Object.getOwnPropertyDescriptor(Ve.prototype,"replaceTrack"),Ve.prototype),Ve),pw=(rx=le({argsMap:(t,e)=>[t.getTrackId(),e]}),sx=ti(),ax=kE("CameraVideoTrack","_enabledMutex"),ox=le({argsMap:(t,e)=>[t.getTrackId(),e]}),cx=ti(),lx=le({argsMap:(t,e)=>[t.getTrackId(),e]}),dx=ti(),ux=le({argsMap:t=>[t.getTrackId()]}),fa=class EB extends wn{get __className__(){return"CameraVideoTrack"}constructor(e,n,i,r,a,c){super(e,hl(n.encoderConfig),r,a,c),et(this,"_config",void 0),et(this,"_originalConstraints",void 0),et(this,"_constraints",void 0),et(this,"_enabled",!0),et(this,"_deviceName","default"),et(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(DE()||LA())&&!function(){const l=Ge();if(l.os!==Ai.IOS||!l.osVersion)return!1;const u=l.osVersion.split(".");return Number(u[0])===15&&Number(u[1])>=2}()&&BP()&&this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=hl(this._config.encoderConfig),an.on(Ki.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),an.on(Ki.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(T.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await ha.getDeviceById(e),i={};i.video=Ln({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await ua(i,this.getTrackId())}catch(a){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),r=await ua({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await ha.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}T.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){T.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:Ln(Ln({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await ua(n,this.getTrackId())}catch(r){throw T.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),i=await ua({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=Ln({},n.video),T.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await ua({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await mn(this,Ht.NEED_ENABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await mn(this,Ht.NEED_DISABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new ct(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=hl(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const i=Gn(this._config);i.encoderConfig=e;const r=Hb(i);($i()||Yr()||yo())&&(r.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(a){const c=new ct(M.UNEXPECTED_ERROR,a.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=i,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,this._hints.indexOf(_n.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await mn(this,Ht.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(T)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Yr()||yo())&&this._enabled&&!this._isClosed&&an.duringInterruption){const e=async()=>{an.off(Ki.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};an.on(Ki.IOS_INTERRUPTION_END,e)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(BE.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=ha.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const r=await ua({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),an.off(Ki.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),an.off(Ki.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=Ln(Ln({},i),hl(e))),i=Qp(i);const r=En(8,"track-cam-cloned-"),a=new EB(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Qp(Ln(Ln({},this._config),{},{encoderConfig:i})),Qp(this._constraints),Qp(this._scalabilityMode),this._optimizationMode,r);return e&&i&&a.setEncoderConfiguration(i),T.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),a}bindProcessorContextEvents(){this.processorContext.on(la.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}}),this.processorContext.on(la.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},We(fa.prototype,"setDevice",[rx,sx],Object.getOwnPropertyDescriptor(fa.prototype,"setDevice"),fa.prototype),We(fa.prototype,"setEnabled",[ax,ox,cx],Object.getOwnPropertyDescriptor(fa.prototype,"setEnabled"),fa.prototype),We(fa.prototype,"setEncoderConfiguration",[lx,dx],Object.getOwnPropertyDescriptor(fa.prototype,"setEncoderConfiguration"),fa.prototype),We(fa.prototype,"close",[ux],Object.getOwnPropertyDescriptor(fa.prototype,"close"),fa.prototype),fa);function fw(t,e,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=Ln(Ln({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?T.debug("[".concat(t,"] set content hint to"),n.optimizationMode):T.debug("[".concat(t,"] set content hint failed")))):T.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var hx,px,fx,mx,ka,Ex,_x,gx,Sx,yx,Tx,kr;class vx extends Ik{getUserId(){return this._userId}constructor(e,n,i,r){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(r.clientId,"_").concat(En(5,""))),et(this,"_userId",void 0),et(this,"_uintId",void 0),et(this,"_isDestroyed",!1),et(this,"store",void 0),et(this,"processor",void 0),et(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let zE=(hx=le({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),px=le({argsMap:t=>[t.getTrackId()]}),fx=le({argsMap:(t,e)=>[t.getTrackId(),e.name]}),mx=le({argsMap:t=>[t.getTrackId()]}),We((ka=class extends vx{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Pr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,i){super(t,e,n,i),et(this,"_videoVisibleTimer",null),et(this,"_previousVideoVisibleStatus",void 0),et(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),et(this,"trackMediaType",GE.VIDEO),et(this,"_videoWidth",void 0),et(this,"_videoHeight",void 0),et(this,"_player",void 0),et(this,"processorDestination",void 0),et(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Bk(this.getTrackId(),"remote"),this.processorDestination=new Vk(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Wu(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),sa(this,Ht.GET_STATS)||Ln({},Ak)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=Ln(Ln({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new hw(n):this._player=new P1(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(FE.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(FE.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(FE.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Hk(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(Lb)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:r,slot:a}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&a instanceof HTMLElement){const c=WP.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const u=Jt.reportApiInvoke(null,{tag:Fn.TRACER,name:ui.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new ct(M.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new ct(M.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(qr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(ef.SEI_RECEIVED,t)}}).prototype,"play",[hx],Object.getOwnPropertyDescriptor(ka.prototype,"play"),ka.prototype),We(ka.prototype,"stop",[px],Object.getOwnPropertyDescriptor(ka.prototype,"stop"),ka.prototype),We(ka.prototype,"pipe",[fx],Object.getOwnPropertyDescriptor(ka.prototype,"pipe"),ka.prototype),We(ka.prototype,"unpipe",[mx],Object.getOwnPropertyDescriptor(ka.prototype,"unpipe"),ka.prototype),ka),YE=(Ex=le({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),_x=le({argsMap:(t,e)=>[t.getTrackId(),e]}),gx=le({argsMap:t=>[t.getTrackId()]}),Sx=le({argsMap:t=>[t.getTrackId()]}),yx=le({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Tx=le({argsMap:t=>[t.getTrackId()]}),We((kr=class extends vx{get isPlaying(){return this._useAudioElement?as.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,i){super(t,e,n,i),et(this,"trackMediaType",GE.AUDIO),et(this,"_source",void 0),et(this,"_useAudioElement",!0),et(this,"_volume",100),et(this,"processorContext",void 0),et(this,"processorDestination",void 0),et(this,"_played",!1),et(this,"_bypassWebAudio",!1),B("DISABLE_WEBAUDIO")?(this._source=new dw,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Lk(t,!0),B("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ca.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(FE.FIRST_FRAME_DECODED)}),this.processorContext=new Gk(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Fk(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ca.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ca.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(ca.ON_AUDIO_BUFFER),this._source.on(ca.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?as.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!vk())throw new ct(M.NOT_SUPPORTED,"your browser does not support setting the audio output device");await as.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Wu(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),sa(this,Ht.GET_STATS)||Ln({},Ck)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),as.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?as.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&as.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new ct(M.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new ct(M.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new ct(M.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(qr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(qr.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qr.ON_TRACK),this.processorDestination.removeAllListeners(qr.ON_NODE)}}).prototype,"setVolume",[Ex],Object.getOwnPropertyDescriptor(kr.prototype,"setVolume"),kr.prototype),We(kr.prototype,"setPlaybackDevice",[_x],Object.getOwnPropertyDescriptor(kr.prototype,"setPlaybackDevice"),kr.prototype),We(kr.prototype,"play",[gx],Object.getOwnPropertyDescriptor(kr.prototype,"play"),kr.prototype),We(kr.prototype,"stop",[Sx],Object.getOwnPropertyDescriptor(kr.prototype,"stop"),kr.prototype),We(kr.prototype,"pipe",[yx],Object.getOwnPropertyDescriptor(kr.prototype,"pipe"),kr.prototype),We(kr.prototype,"unpipe",[Tx],Object.getOwnPropertyDescriptor(kr.prototype,"unpipe"),kr.prototype),kr);const Sd=new class extends Mn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),et(this,"_lastHiddenTime",0),et(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),T.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class bx extends Mn{constructor(e,n){super(),et(this,"trackMediaType",GE.DATA),et(this,"_version",1),et(this,"_type",3),et(this,"_config",void 0),et(this,"_originDataChannel",void 0),et(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),et(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),et(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return B("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new wt((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const i=setTimeout(()=>{var r;n(new ct(M.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new ct(M.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new ct(M.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[Fb.OPEN,Fb.CLOSE,Fb.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),e.addEventListener(n,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,r]=n;e.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class jG extends bx{constructor(e){super(e),et(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(B("SHOW_DATASTREAM2_LOG")&&T.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let a=n.data.slice(this._dataStreamPacketHeader.byteLength);a=this._dataStreamPacketHandler.deserialize(a),this.emit(Fb.MESSAGE,a)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class VG extends bx{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function Kb(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>Kv.revokeObjectURL(t),0),new Worker(Kv.createObjectURL(t))}const Rx=71,mw=1,Ew=2,_w=1,Cx=2;var yd=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(yd||{});function Ax(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=t.getUint8(0);if(n!==Rx)return;const i=t.getUint16(1),r=mw+Ew+i,a=new Uint8Array(t.byteLength-r);a.set(new Uint8Array(t.buffer,r,t.byteLength-r));const c={m:n,tlvLen:i,tlv:[],frame:a};let l=mw+Ew;for(;l<r;){const u=t.getUint8(l),h=t.getUint16(l+_w),p=_w+Cx;if(u===yd.AUDIO_LEVEL){let m=t.getUint8(l+p);for(let g=1;g<h;g++)m=m<<8|t.getUint8(l+p+g);c.tlv.push({tag:u,length:h,value:e?127^m>>1:127&m})}else if(u===yd.METADATA||u===yd.AUDIO_64_BIT_PTS){const m=new Uint8Array(h);for(let g=0;g<h;g++)m[g]=t.getUint8(l+p+g);c.tlv.push({tag:u,length:h,value:m})}l+=p+h}return c}const zb=new Map,Yb=127,sf=1e-10,gw=139/13,qb=new Map;function Sw(t,e,n){const i="".concat(t,"-").concat(e,"-").concat(n);let r=0;return qb.has(i)?r=qb.get(i):(r=Math.log(function(c,l){const u=c-l;l<u&&(l=u);let h=1;for(let p=c,m=1;p>l;p--,m++)h=h*p/m;return h}(e,t))+t*Math.log(.5)+(e-t)*Math.log(1-.5)-Math.log(n)+n*t,qb.set(i,r)),r<sf&&(r=sf),r}function wx(t,e,n){const i=e.length,r=t.length/i;let a=!1;for(let c=0,l=0;c<i;c++){let u=0;for(let h=l+r;l<h;l++)t[l]>n&&u++;e[c]!==u&&(e[c]=u,a=!0)}return a}window.cache=qb;let BG=0;class Ix{constructor(e){et(this,"id",void 0),et(this,"immediates",[]),et(this,"lastNonSilence",-1),et(this,"immediateSpeechActivityScore",sf),et(this,"lastLevelChangedTime",Date.now()),et(this,"levels",[]),et(this,"longs",[]),et(this,"longSpeechActivityScore",sf),et(this,"mediums",[]),et(this,"mediumSpeechActivityScore",sf),et(this,"minLevel",0),et(this,"nextMinLevel",0),et(this,"nextMinLevelWindowLength",0),et(this,"energyScore",0),this.id=e||"".concat(BG++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,n=this.levels,i=this.minLevel+gw;let r=!1;for(let a=0;a<e.length;++a){let c=n[a];c<i&&(c=0);const l=Math.floor(c/gw);e[a]!==l&&(e[a]=l,r=!0)}return r}computeLongs(){return wx(this.mediums,this.longs,4)}computeMediums(){return wx(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=Sw(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=Sw(this.longs[0],10,47),this.longSpeechActivityScore>sf&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=Sw(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(du(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=e;return e<0&&(i=0),e>Yb&&(i=Yb),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+gw?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>Yb&&(n=Yb),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class FG{constructor(e){et(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?e=!0:setTimeout(this.execute.bind(this),n)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class yw{constructor(e,n,i){et(this,"isDominant",void 0),et(this,"energyRanking",void 0),et(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=n,this.energyScore=i}}class GG extends Mn{constructor(e){super(),et(this,"dominantId",null),et(this,"lastDecisionTime",0),et(this,"lastLevelChangedTime",0),et(this,"lastLevelIdleTime",0),et(this,"relativeSpeechActivities",[]),et(this,"speakers",new Map),et(this,"enableSilence",!1),et(this,"timeoutToSilenceInterval",0),et(this,"decisionMaker",null),et(this,"loudest",[]),et(this,"numLoudestToTrack",3),et(this,"energyExpireTimeMs",250),et(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(n=>n.id===e)}levelChanged(e,n){const i=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const a=r.levelChanged(n,i);return this.updateLoudestList(r,a,i)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(e){e.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(e){let n=this.speakers.get(e);return n||(n=new Ix(e),this.speakers.set(e,n),this.maybeStartDecisionMaker()),n}updateLoudestList(e,n,i){const r=e.id===this.dominantId;if(n<0){let u=0;for(;u<this.loudest.length&&this.loudest[u]!==e;)++u;return new yw(r,u,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new yw(r,0,e.energyScore);const a=i-this.energyExpireTimeMs;let c=0;for(;c<this.loudest.length;){const u=this.loudest[c];if(u.getLastLevelChangedTime()<a&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(u.id!==e.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let l=0;for(;l<this.loudest.length&&!(this.loudest[l].energyScore<e.energyScore);)++l;return l<this.numLoudestToTrack&&(this.loudest.splice(l,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new yw(r,l,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new FG(this),this.decisionMaker.execute())}makeDecision(e){let n=null,i=null;const r=this.speakers.size;let a=null;if(r===0)a=null;else if(r===1){var c;const l=Fi(c=this.speakers).call(c).next().value;this.enableSilence&&l&&(a=l.id,l.evaluateSpeechActivityScores(e),e-l.lastNonSilence>this.timeoutToSilenceInterval&&(a=null))}else{let l=this.dominantId==null?null:this.speakers.get(this.dominantId);if(l==null){const p=this.speakers.entries().next();p.value&&(a=p.value[0],l=p.value[1])}else a=l.id;l!=null&&l.evaluateSpeechActivityScores(e);const u=this.relativeSpeechActivities;let h=2;for(const p of this.speakers.entries()){const[m,g]=p;if(g===l)continue;g.evaluateSpeechActivityScores(e);for(let N=0;N<u.length;++N){const k=l==null?sf:l.getSpeechActivityScore(N);u[N]=Math.log(g.getSpeechActivityScore(N)/k)}const S=u[0],D=u[1],w=u[2];S>3&&D>2&&w>0&&D>h&&(h=D,a=m)}this.enableSilence&&l!=null&&a===l.id&&e-l.lastNonSilence>this.timeoutToSilenceInterval&&(a=null)}a==null&&!this.enableSilence||a===this.dominantId||(n=this.dominantId,this.dominantId=a,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const e=Date.now(),n=300-(e-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):i=n;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&i>r&&(i=r),i}timeoutIdleLevels(e){const n=[];for(const r of Fi(i=this.speakers).call(i)){var i;const a=e-r.getLastLevelChangedTime();36e5<a&&(this.dominantId==null||r.id!==this.dominantId)?n.push(r.id):300<a&&r.levelTimedOut()}n.forEach(r=>this.speakers.delete(r))}}const qE=new Map;let Ec=null,Xb=null;const Ox=3;let af=[];const _c=new Map,Jb=new Map;class HG{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,n){et(this,"id",void 0),et(this,"track",void 0),et(this,"score",0),et(this,"active",!0),et(this,"muted",!1),et(this,"timer",0),et(this,"actives",0),et(this,"inactives",0),this.id=e,this.track=n,this.setActive(_c.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const r=[],a=[];return Array.from(Fi(_c).call(_c)).forEach(c=>{c.active?r.push(c):a.push(c)}),{actives:r,inactives:a}}();if(n.length>3){let r;n.forEach(a=>{(!r||r.score>a.score)&&(r=a)}),r&&r.setActive(!1)}if(n.length<3&&i.length>0){let r;i.forEach(a=>{(!r||r.score<a.score)&&a.id!==this.id&&(r=a)}),r&&e&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(n){let i;return Array.from(Fi(_c).call(_c)).forEach(r=>{!r.active||r.id===n||r.samples<40||(!i||r.score<i.score)&&(i=r)}),i}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(n){let i;return Array.from(Fi(_c).call(_c)).forEach(r=>{r.active||r.id===n||r.samples<40||(!i||r.score>i.score)&&(i=r)}),i}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Qb;function Nx(t){const e=_c.get(t);e&&(_c.delete(t),e.clearTimer())}const Zb=new Map,WG=new Map;function KG(t,e,n){let i=new Uint8Array(t,e,n),r=[],a=0;for(;r.length<n;)a+3<n&&i[a]===0&&i[a+1]===0&&i[a+2]===3&&(i[a+3]===0||i[a+3]===1||i[a+3]===2||i[a+3]===3)?(r.push(i[a],i[a+1],i[a+3]),a+=4):(r.push(i[a]),a++);return new Uint8Array(r)}const $b=new Map,JS=new Map;(function(){const t=Ge();Wi.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Wi.getStreamFromExtension=t.name===Ye.CHROME&&Number(t.version)>34,Wi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),Wi.supportMinBitrate=t.name===Ye.CHROME||t.name===Ye.EDGE,Wi.supportSetRtpSenderParameters=function(){const e=Ge();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ed()||!(!$i()&&!Ib())||e.name===Ye.FIREFOX&&Number(e.version)>=64)}(),t.name===Ye.SAFARI&&(Number(t.version)>=14?Wi.supportDualStream=!0:Wi.supportDualStream=!1),Wi.webAudioMediaStreamDest=function(){const e=Ge();return!(e.name===Ye.SAFARI&&Number(e.version)<12)}(),Wi.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Wi.supportWebGL=typeof WebGLRenderingContext<"u",Wi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ed()||(Wi.webAudioWithAEC=!0),Wi.supportShareAudio=function(){const e=Ge();return(e.os===Ai.WIN_10||e.os===Ai.WIN_81||e.os===Ai.WIN_7||e.os===Ai.LINUX||e.os===Ai.MAC_OS||e.os===Ai.CHROMIUM_OS)&&e.name===Ye.CHROME&&Number(e.version)>=74}(),Wi.supportDataChannel=!!(VS(76)||function(e){const n=Ge();return!(n.name!==Ye.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||xP(14)),Wi.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!Vn()&&!!e&&e.prototype.setConfiguration instanceof Function}(),Wi.supportWebRTCEncodedTransform=function(){const e=Ge();return e.name==="Chrome"&&Number(e.version)>=87||e.name==="Safari"&&Number(e.version)>=15}(),Wi.supportWebRTCInsertableStream=function(){const e=Ge();return(e.name===Ye.CHROME||e.name===Ye.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Wi.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Wi.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Db(()=>{Wi.supportDualStreamEncoding=function(){const e=Ge();return!!B("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&B("CHROME_DUAL_STREAM_USE_ENCODING"))}(),T.debug("browser ua: ",navigator.userAgent),T.info("browser info: ",t),T.info("browser compatibility: ",Wi)})})();const zG=["CHINA","GLOBAL"],Dx=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],of=[],XE=[];function cf(t,e){return!!e&&of.some(n=>n.uid===t&&n.channelName===e)}function Tw(){return XE.length>0}var YG=$D.forEach,Lx=va("forEach")?[].forEach:function(t){return YG(this,t,arguments.length>1?arguments[1]:void 0)};Qe({target:"Array",proto:!0,forced:[].forEach!=Lx},{forEach:Lx});var qG=Er("Array").forEach,XG=Ps,JG=yi,QG=dt,ZG=qG,vw=Array.prototype,$G={DOMTokenList:!0,NodeList:!0},tH=function(t){var e=t.forEach;return t===vw||QG(vw,t)&&e===vw.forEach||JG($G,XG(t))?ZG:e},eH=L(tH),nH=ar,Px=xi;Qe({target:"Object",stat:!0,forced:U(function(){Px(1)})},{keys:function(t){return Px(nH(t))}});var kx=L(Ur.Object.keys),iH=L(no),rH=L(qh),sH=Qe,xx=Qs,aH=Aa,oH=sr,Mx=Hl,cH=Xs,lH=rr,dH=mE,uH=kn,hH=Tp,pH=HD("slice"),fH=uH("species"),bw=Array,mH=Math.max;sH({target:"Array",proto:!0,forced:!pH},{slice:function(t,e){var n,i,r,a=lH(this),c=cH(a),l=Mx(t,c),u=Mx(e===void 0?c:e,c);if(xx(a)&&(n=a.constructor,(aH(n)&&(n===bw||xx(n.prototype))||oH(n)&&(n=n[fH])===null)&&(n=void 0),n===bw||n===void 0))return hH(a,l,u);for(i=new(n===void 0?bw:n)(mH(u-l,0)),r=0;l<u;l++,r++)l in a&&dH(i,r,a[l]);return i.length=r,i}});var EH=Er("Array").slice,_H=dt,gH=EH,Rw=Array.prototype,SH=function(t){var e=t.slice;return t===Rw||_H(Rw,t)&&e===Rw.slice?gH:e},yH=L(SH);function Yt(t,e,n,i,r){var a,c,l,u={};return eH(a=kx(i)).call(a,function(h){u[h]=i[h]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=iH(c=rH(l=yH(n).call(n)).call(l)).call(c,function(h,p){return p(t,e,h)||h},u),r&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(r):void 0,u.initializer=void 0),u.initializer===void 0&&(VD(t,e,u),u=null),u}let tR=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),Cw=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),bo=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Xr=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),ae=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),yn=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),pe=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),ue=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),QS=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),Pe=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Jr=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),Se=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function eR(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw T.error("Invalid Channel Name ".concat(t)),new nt(M.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function nR(t){if(e=t,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||HP(t,1,255)))throw new nt(M.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof t=="string"&&T.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Td=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const TH={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Aw={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function ww(t,e){Gi(t.url,"".concat(e,".url"),1,1e3,!1),Bn(t.x)||cn(t.x,"".concat(e,".x"),0,1e4),Bn(t.y)||cn(t.y,"".concat(e,".y"),0,1e4),Bn(t.width)||cn(t.width,"".concat(e,".width"),0,1e4),Bn(t.height)||cn(t.height,"".concat(e,".height"),0,1e4),Bn(t.zOrder)||cn(t.zOrder,"".concat(e,".zOrder"),0,255),Bn(t.alpha)||cn(t.alpha,"".concat(e,".alpha"),0,1,!1)}const vH={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Yu=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),Iw=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),gi=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function Ux(t){if(!t.channelName)throw new nt(M.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new nt(M.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Gi(t.token,"info.token",1,2047),nR(t.uid),eR(t.channelName),!0}let Qr=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),vd=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Ts=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),JE=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),tn=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),Ui=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),iR=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),Ii=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),qe=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const jx=[qe.AFRICA,qe.ASIA,qe.CHINA,qe.EUROPE,qe.GLOBAL,qe.INDIA,qe.JAPAN,qe.NORTH_AMERICA,qe.OCEANIA,qe.OVERSEA,qe.SOUTH_AMERICA];let dr=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const rR={CHINA:{},ASIA:{CODE:dr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:dr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:dr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:dr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:dr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:dr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:dr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:dr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:dr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:dr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:dr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:dr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:dr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};XA&&(rR.CHINA={CODE:dr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let ZS=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function Vx(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class Bx extends Mn{constructor(e,n){super(),P(this,"onICEConnectionStateChange",void 0),P(this,"onConnectionStateChange",void 0),P(this,"onDTLSTransportStateChange",void 0),P(this,"onDTLSTransportError",void 0),P(this,"onICETransportStateChange",void 0),P(this,"onFirstAudioReceived",void 0),P(this,"onFirstVideoReceived",void 0),P(this,"onFirstAudioDecoded",void 0),P(this,"onFirstVideoDecoded",void 0),P(this,"onFirstVideoDecodedTimeout",void 0),P(this,"onSelectedLocalCandidateChanged",void 0),P(this,"onSelectedRemoteCandidateChanged",void 0),P(this,"onICECandidateError",void 0),P(this,"getLocalVideoStats",void 0)}}class Fx extends Bx{constructor(e,n){super(e,n),P(this,"establishPromise",void 0)}}let Bt=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),ur=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),bd=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const Gx=["disconnected","failed"];let Et=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),$e=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),ee=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Ro=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Co=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),ji=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Hx=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),ml=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),xa=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),gc=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),QE=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),ei=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),ZE=function(t){return t.ABORT="abort",t}({}),qu=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),bH=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const RH={[tR.ACCESS_POINT]:{[Xr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Xr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Xr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Xr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Xr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Xr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[tR.UNILBS]:{[bo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[bo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[bo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[bo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[bo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[bo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[bo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[bo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[bo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[bo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[bo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[bo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[tR.STRING_UID_ALLOCATOR]:{[Cw.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Cw.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Cw.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function $E(t){const e=RH[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===tR.ACCESS_POINT){const i=t%1e4;if(i.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const CH={[ae.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[ae.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[ae.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[ae.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[ae.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[ae.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[ae.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[ae.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[ae.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[ae.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[ae.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[ae.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[ae.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[ae.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ae.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ae.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[ae.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[ae.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[ae.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[ae.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[ae.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[ae.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[ae.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[ae.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[ae.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[ae.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[ae.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[ae.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[ae.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[ae.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[ae.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[ae.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[ae.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[ae.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[ae.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[ae.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[ae.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[ae.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[ae.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[ae.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[ae.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[ae.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ae.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ae.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[ae.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[ae.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[ae.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[ae.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[ae.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[ae.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[ae.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[ae.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[ae.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[ae.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[ae.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[ae.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[ae.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[ae.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[ae.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[ae.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[ae.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[ae.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[ae.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[ae.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function $S(t){return CH[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function Wx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ow(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Wx(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Wx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Kx(t,e){if(typeof t=="string")return t;const{proxy:n,host:i,port:r}=t;if(e){const a=B("JOIN_GATEWAY_FALLBACK_PORT")||443;return a===443?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(a,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const AH=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,wH=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,IH=/wss:\/\/(.+):([0-9]+)\/?/,OH=/wss:\/\/(.[^\/]+)\/?/;let NH=0;class DH{constructor(e,n){P(this,"id",0),P(this,"store",void 0),P(this,"recordIndex",void 0),P(this,"websockets",[]),P(this,"try443PortDuration",2e3),P(this,"forceCloseWSDuration",5e3),P(this,"try443PortTimeout",null),P(this,"forceCloseTimeout",null),P(this,"isTry443PortFailed",!1),P(this,"isNormalPortFailed",!1),P(this,"useDoubleDomain",!1),P(this,"useProxy",!1),P(this,"startTime",Date.now()),this.id=++NH,this.try443PortDuration=B("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const n=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];T.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...r)}createWebSocket(e,n,i){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:i});const r=B("GATEWAY_DOMAINS"),a=Date.now(),c=[],l=r.find(g=>{var S;return At(S=e.host).call(S,g)});l||(this.useDoubleDomain=!1);const u=[];if(this.useDoubleDomain)r.forEach(g=>{u.push(Kx(Ow(Ow({},e),{},{host:e.host.replace(l,g)}),n))});else{const g=Ow({},e);if(n&&l){const S=r.find(D=>D!==l);S&&(g.host=g.host.replace(l,S))}u.push(Kx(g,n))}try{u.forEach(g=>{const S=new WebSocket(g);S.binaryType="arraybuffer",c.push(S),this.logger("ws is connecting:",S.url)})}catch(g){if(this.logger("ws create failed"),c.forEach(S=>S.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,i);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new nt(M.WS_ERR,"init websocket failed! Error: ".concat(g.toString()))}const h=jS();this.store&&this.store.recordJoinChannelService({urls:c.map(g=>g.url),service:"gateway"},this.recordIndex),c.forEach(g=>{g.onopen=()=>{this.logger("onopen: ws ".concat(g.url," open cost ").concat(Date.now()-a,"ms")),this.websockets.forEach(S=>{S!==g&&(S.onopen=null,S.onclose=null,S.onmessage=null,S.close(),this.logger("close backup websocket: ".concat(S.url)))}),this.websockets.length=0,h.resolve(g)},g.onclose=S=>{this.logger("onclose: ws ".concat(g.url," closed cost ").concat(Date.now()-a,"ms state: ").concat(g.readyState));const D=c.every(w=>w.readyState===WebSocket.CLOSED||w.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(D)),D&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(S.reason)),h.reject({code:S.code,reason:iR.A_ROUND_WS_FAILED})):!n&&D&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),m()),n?this.isTry443PortFailed=D:this.isNormalPortFailed=D},g.onmessage=S=>this.logger("".concat(g.url," onmessage: ").concat(S.data))}),this.websockets.push(...c);const p=()=>{this.websockets.forEach(g=>g.readyState!==WebSocket.OPEN&&g.close())},m=()=>{if(h.isResolved)return p();Ge().os===Ai.MAC_OS&&Vn()&&p(),this.createWebSocket(e,!0,!0).then(g=>{h.resolve(g)}).catch(g=>{this.isNormalPortFailed&&h.reject(g),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",h.isResolved),this.forceCloseTimeout=null,p()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,p()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",h.isResolved),this.try443PortTimeout=null,m()},this.try443PortDuration)})(),h.promise}chooseBestWebsocket(e,n,i,r){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(a){let c,l,u;return[,c,l,u]=a.match(AH)||[],c||([,l,u]=a.match(wH)||[]),l&&u||([,l,u]=a.match(IH)||[]),l&&u||([,l]=a.match(OH)||[]),l||T.warning("un-destructible url: ",a),{proxy:c,host:l,port:u||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,i&&this.useProxy&&(T.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function zx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class Yx extends Mn{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;At(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(Se.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Se.CONNECTED):this._state==="closed"?this.emit(Se.CLOSED):this._state==="failed"&&this.emit(Se.FAILED))}resetReconnectCount(e){T.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),P(this,"connectionID",0),P(this,"currentURLIndex",0),P(this,"urls",[]),P(this,"_reconnectMode","tryNext"),P(this,"reconnectReason",void 0),P(this,"_initMutex",void 0),P(this,"name",void 0),P(this,"_state","closed"),P(this,"reconnectInterrupter",void 0),P(this,"websocket",void 0),P(this,"retryConfig",void 0),P(this,"reconnectCount",0),P(this,"forceCloseTimeout",5e3),P(this,"onlineReconnectListener",void 0),P(this,"useCompress",void 0),P(this,"tryDoubleDomain",!1),P(this,"use443PortOnly",!1),P(this,"wsInflateLength",0),P(this,"wsDeflateLength",0),P(this,"closeEstablishingWs",()=>{}),P(this,"store",void 0),P(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=e,this.retryConfig=function(m){for(var g=1;g<arguments.length;g++){var S=arguments[g]!=null?arguments[g]:{};g%2?zx(Object(S),!0).forEach(function(D){P(m,D,S[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(S)):zx(Object(S)).forEach(function(D){Object.defineProperty(m,D,Object.getOwnPropertyDescriptor(S,D))})}return m}({},n),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=a,this._initMutex=new lr("websocket",c?c.clientId:void 0);const{timeout:l,timeoutFactor:u}=n,h=Math.max(300,Math.floor(3*l/5)),p=Math.max(1.2,Math.floor(8*u)/10);Hs.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p),si.on(LE.NETWORK_STATE_CHANGE,(m,g)=>{m!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(m)),m===Hs.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=u))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const r=jS(),a=this.urls[this.currentURLIndex];B("ENABLE_PREALLOC_PC")&&this.emit(Hx.PRE_CONNECT_PC),this.createWebSocketConnection(a).then(r.resolve).catch(r.reject),this.once(Se.CLOSED,()=>{r.reject(new ct(M.WS_DISCONNECT))}),this.once(Se.CONNECTED,r.resolve),await r.promise}catch{}finally{i()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ct(M.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new ct(M.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const i=jS();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=p=>{var m;(m=this.store)===null||m===void 0||m.signalChannelOpen(),T.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},a=async p=>{var m;if(T.debug("[".concat(this.name,"] websocket close ").concat((m=this.websocket)===null||m===void 0?void 0:m.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new ct(M.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const g=sa(this,Se.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,S=await this.reconnectWithAction(g);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!S)return i.reject(new ct(M.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);i.resolve()}},c=p=>{this.emit(Se.ON_MESSAGE,p)},l=p=>{T.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),B("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=B("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(this.name,"] start connect, url:"),e);const u=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var h;const p=await this.chooseBestWebsocketConnection(e);this.websocket=p,r&&r(this.websocket.url),this.websocket.onclose=a,this.websocket.onmessage=c,this.websocket.onerror=l,(h=this.store)===null||h===void 0||h.recordJoinChannelService({endTs:Date.now(),status:"success"},u),this.joinGatewayRecordIndex=u}catch(p){const m=this.state==="closed",g=p instanceof ct,S=g&&p.code===M.WS_ABORT,D=g&&p.code===M.WS_ERR,w=g?p.message:p&&(p.reason||p.toString());T.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(w)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:S?"aborted":"error",errors:[p]},u),m||D?(i.reject(m?new ct(M.WS_DISCONNECT,"websocket is closed: ".concat(w)):new ct(M.WS_ERR,"init websocket failed: ".concat(w))),D&&T.error("[".concat(this.name,"] init websocket failed: ").concat(w))):a&&a(p)}return i.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;T.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||si.isOnline||!si.onlineWaiter||(this.onlineReconnectListener=si.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const c=FA(this.reconnectCount,this.retryConfig);T.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(e)),await wt.race([Hi(c),this.onlineReconnectListener||new wt(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const r=async(c,l)=>{this.emit(Se.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(e==="retry")await r(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);T.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else e==="recover"&&(T.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await er(this,Se.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(c){var a;T.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const l=c==null||(a=c.data)===null||a===void 0?void 0:a.desc;return Array.isArray(l)&&At(l).call(l,"dynamic key expired")?(this.emit(Se.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class Nw extends Yx{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const i=jS(),r=function(c,l){return new DH(c,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new ct(M.WS_ABORT,"choose best websocket aborted"))};const a=B("GATEWAY_DOMAINS");return T.debug("[choose-best-ws] currentDomain: ",e,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class ty extends Yx{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new wt((i,r)=>{let a=!1;const c=[];this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),c.forEach(D=>{D.onclose=null,D.onopen=null,D.onmessage=null,D.close()}),r(new ct(M.WS_ABORT,"choose best websocket aborted"))};const l=B("GATEWAY_DOMAINS");let u;const h=e.indexOf("?h="),p=l.find(D=>h!==-1?At(e).call(e,D,h):At(e).call(e,D));T.debug("[choose-best-ws] currentDomain: ",p,", domains: ",l);let m=!this.tryDoubleDomain||!p;if(!m&&p){var g;const D=Date.now();try{l.forEach(w=>{const N=h===-1?e.replace(p,w):e.substr(0,h)+e.substr(h).replace(p,w),k=new WebSocket(N);k.binaryType="arraybuffer",c.push(k),T.debug("[choose-best-ws] ws is connecting:",k.url)})}catch{for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(N=>N.close());c.length;)c.pop();m=!0}(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:c.map(w=>w.url),service:"gateway"},n),c.forEach(w=>{w.onopen=()=>{if(a)return;const N=Date.now()-D;T.debug("[choose-best-ws] ws open cost ".concat(N,"ms")),c.filter(k=>k!==w).forEach(k=>{T.debug("[choose-best-ws]close backup websocket: ".concat(k.url)),k.close()}),a=!0,i(w)},w.onclose=N=>{u=N,!a&&(c.find(k=>!(k.readyState===WebSocket.CLOSED||k.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),a=!0,r(u)))},w.onmessage=N=>{T.debug("[choose-best-ws]".concat(w.url," onmessage: ").concat(N.data))}}),Hi(this.forceCloseTimeout).then(()=>{c.forEach(w=>{w.readyState!==WebSocket.OPEN&&w.close()})})}if(m){var S;let D;T.debug("[choose-best-ws] use single url: ",e),(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:[e],service:"gateway"},n);try{D=new WebSocket(e),c.push(D),D.binaryType="arraybuffer"}catch(w){const N=new ct(M.WS_ERR,"init websocket failed! Error: ".concat(w.toString()));return T.error("[".concat(this.name,"]").concat(N)),void r(N)}D.onopen=()=>{i(D)},D.onclose=w=>{r(w)},D.onmessage=w=>{T.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(w.data))},Hi(this.forceCloseTimeout).then(()=>{D&&D.readyState!==WebSocket.OPEN&&D.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class LH extends Mn{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===yn.CONNECTED?this.emit(pe.WS_CONNECTED):e===yn.RECONNECTING?this.emit(pe.WS_RECONNECTING,this._websocketReconnectReason):e===yn.CLOSED&&this.emit(pe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),P(this,"_disconnectedReason",void 0),P(this,"_websocketReconnectReason",void 0),P(this,"_connectionState",yn.CLOSED),P(this,"reconnectToken",void 0),P(this,"websocket",void 0),P(this,"openConnectionTime",void 0),P(this,"clientId",void 0),P(this,"lastMsgTime",Date.now()),P(this,"uploadCache",[]),P(this,"uploadCacheInterval",void 0),P(this,"rttRolling",new sk(5)),P(this,"pingpongTimer",void 0),P(this,"wsInflateDataTimer",void 0),P(this,"pingpongTimeoutCount",0),P(this,"joinResponse",void 0),P(this,"multiIpOption",void 0),P(this,"initError",void 0),P(this,"spec",void 0),P(this,"store",void 0),P(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(pe.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const a="res-@".concat(r._id);this.emit(a,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===Pe.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Pe.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Ze.UID_BANNED);break;case 15:this.close(Ze.IP_BANNED);break;case 16:this.close(Ze.CHANNEL_BANNED)}if(r._type===Pe.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case ae.ERR_LICENSE_MISSING:this.close(Ze.LICENSE_MISSING);break;case ae.ERR_LICENSE_EXPIRED:this.close(Ze.LICENSE_EXPIRED);break;case ae.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ze.LICENSE_MINUTES_EXCEEDED);break;case ae.ERR_LICENSE_PERIOD_INVALID:this.close(Ze.LICENSE_PERIOD_INVALID);break;case ae.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ze.LICENSE_MULTIPLE_SDK_SERVICE);break;case ae.ERR_LICENSE_ILLEGAL:this.close(Ze.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new Nw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===yn.CONNECTED&&this.reconnect("retry",tr.OFFLINE)})}async request(e,n,i,r){const a=En(6,""),c={_id:a,_type:e,_message:n},l=this.websocket.connectionID,u=()=>new wt((D,w)=>{if(this.connectionState===yn.CONNECTED)return D();const N=()=>{this.off(pe.WS_CLOSED,k),D()},k=()=>{this.off(pe.WS_CONNECTED,N),w(new nt(M.WS_ABORT))};this.once(pe.WS_CONNECTED,N),this.once(pe.WS_CLOSED,k),e!==ue.PUBLISH&&e!==ue.PUBLISH_DATASTREAM&&e!==ue.SUBSCRIBE&&e!==ue.SUBSCRIBE_DATASTREAM&&e!==ue.UNSUBSCRIBE&&e!==ue.UNSUBSCRIBE_DATASTREAM&&e!==ue.UNPUBLISH&&e!==ue.UNPUBLISH_DATASTREAM&&e!==ue.CONTROL&&e!==ue.RESTART_ICE||this.once(pe.DISCONNECT_P2P,()=>{w(new nt(M.DISCONNECT_P2P))}),e!==ue.PUBLISH&&e!==ue.RESTART_ICE||this.once(pe.ABORT_P2P_EXECUTION,()=>{w(new nt(M.DISCONNECT_P2P))})});if(this.connectionState!==yn.CONNECTING&&this.connectionState!==yn.RECONNECTING||e===ue.JOIN||e===ue.REJOIN||await u(),this.websocket.sendMessage(c,!0),r)return;const h=new wt((D,w)=>{let N=!1;const k=(W,Z)=>{N=!0,D({isSuccess:W==="success",message:Z||{}}),this.off(pe.WS_CLOSED,x),this.off(pe.WS_RECONNECTING,x),this.emit(pe.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(a),k);const x=()=>{w(new nt(M.WS_ABORT,"type: ".concat(e))),this.off(pe.WS_CLOSED,x),this.off(pe.WS_RECONNECTING,x),this.off("res-@".concat(a),k)};this.once(pe.WS_CLOSED,x),this.once(pe.WS_RECONNECTING,x),Hi(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||N||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(pe.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(D){if(this.connectionState===yn.CLOSED||e===ue.LEAVE)throw new nt(M.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?D.throw():e===ue.JOIN||e===ue.REJOIN?null:(await u(),await this.request(e,n))}if(p.isSuccess)return p.message;const m=Number(p.message.error_code||p.message.code),g=$S(m),S=new nt(M.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(p.message.error_str),{code:m,data:p.message,desc:g.desc});return g.action==="success"?p.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(m,", message: ").concat(g.desc,", action: ").concat(g.action)),m===ae.ERR_TOO_MANY_BROADCASTERS?((e===ue.JOIN||e===ue.REJOIN)&&(this.initError=S,this.close()),S.throw()):g.action==="failed"?S.throw():g.action==="quit"?(this.initError=S,this.close(),S.throw()):(m===ae.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",tr.MULTI_IP)):this.reconnect(g.action,tr.SERVER_ERROR),e===ue.JOIN||e===ue.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new wt(i=>{const r=a=>{(!n||n(a))&&(this.off(e,r),i(a))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(QS.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const a=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==yn.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new wt((n,i)=>{this.once(pe.WS_CONNECTED,()=>n(this.joinResponse)),this.once(pe.WS_CLOSED,r=>i(this.initError||new nt(M.WS_ABORT,r))),this.connectionState=yn.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Ze.LEAVE,this.connectionState=yn.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(pe.ABORT_P2P_EXECUTION);const e=await er(this,pe.REQUEST_JOIN_INFO),n=await this.request(ue.JOIN,e);if(!n)return this.emit(pe.REPORT_JOIN_GATEWAY,iR.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(pe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new nt(M.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=WS(this,pe.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(ue.REJOIN,e);return!!n&&(this.connectionState=yn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(Pe.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Pe.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Pe.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Pe.MUTE_AUDIO,{uid:i.uid}):this.emit(Pe.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Pe.MUTE_VIDEO,{uid:i.uid}):this.emit(Pe.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Pe.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Pe.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Pe.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Pe.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Pe.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){T.debug("[".concat(this.clientId,"] receive notification: "),e);const n=$S(e.code);if(e.code===28&&"detail"in e&&(T.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(pe.RECOVER_NOTIFICATION,e.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ze.UID_BANNED),void this.close()):void this.reconnect(n.action,tr.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=B("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(T.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",tr.TIMEOUT):this.request(ue.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),B("REPORT_STATS")&&this.send(ue.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(QS.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Se.RECONNECT_CREATE_CONNECTION,e=>{this.emit(pe.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Se.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Se.CLOSED,()=>{this.connectionState=yn.CLOSED}),this.websocket.on(Se.FAILED,()=>{this._disconnectedReason=Ze.NETWORK_ERROR,this.connectionState=yn.CLOSED}),this.websocket.on(Se.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===yn.CONNECTED?this.connectionState=yn.RECONNECTING:this.connectionState=yn.CONNECTING}),this.websocket.on(Se.WILL_RECONNECT,(e,n,i)=>{const r=WS(this,pe.IS_P2P_DISCONNECTED),a=r||e!=="retry";r&&e==="retry"&&(T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=iR.P2P_DISCONNECTED),a&&(T.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(pe.REPORT_JOIN_GATEWAY,n||iR.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(pe.DISCONNECT_P2P)),i(e)}),this.websocket.on(Se.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",tr.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(pe.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof nt){if(e.code===M.UNEXPECTED_RESPONSE&&e.data.code===ae.ERR_NO_AUTHORIZED)return this.initError=new nt(M.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Ze.TOKEN_EXPIRE);T.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",tr.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(Se.REQUEST_NEW_URLS,(e,n)=>{er(this,pe.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(Se.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Hx.PRE_CONNECT_PC,()=>{this.emit(pe.PRE_CONNECT_PC)})}}let PH=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),ai=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function qx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function sR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?qx(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Xu(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(B("TURN_DOMAIN")):(T.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function Dw(t,e){t.addresses||(t.addresses=[]);const n=function(l,u){if(B("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(m=>{let{ip:g,port:S}=m;return{address:"".concat(g,":").concat(S)}});const h=B("GATEWAY_DOMAINS");let p=h[1]&&At(u).call(u,h[1])?1:0;return l.map(m=>{let{domain_prefix:g,port:S,ip:D}=m;if(g)return{address:"".concat(g,".").concat(h[p++%h.length],":").concat(S)};const w=/^[\.\:\d]+$/.test(D),N=w?"".concat(D.replace(/[^\d]/g,"-"),".").concat(h[p++%h.length],":").concat(S):"".concat(D,":").concat(S);return w||T.debug("Cannot recognized as ip address: ".concat(D,", use as host")),{ip:D,port:S,address:N}})}(t.addresses,e),i=Array.isArray(t.detail)&&t.detail[18];if(i&&typeof i=="string"){const l=i.split(";");for(let u=0;u<l.length;u++){var r;const h=Lr(r=l[u]).call(r);n[u]&&h&&(n[u].ip6=h)}}const a=t.detail&&t.detail.candidate;let c;if(a){const[l,u]=a.split(":");l&&u&&(c={port:Number(u),ip:l,address:"".concat(l,":").concat(u)})}return{gatewayAddrs:n,apGatewayAddress:c,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Ws(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function Xx(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(Ws(e.width),"x").concat(Ws(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function Jx(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function ey(t,e){let n,i,r;switch(e){case ai.CHOOSE_SERVER:i=4096,r="choose server";break;case ai.CLOUD_PROXY:i=1048576,r="proxy";break;case ai.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case ai.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new nt(M.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(a=>{a.buffer&&a.buffer.flag===i&&(n={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(c=>sR(sR({},c),{},{ticket:a.buffer.cert})),server_ts:t.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:sR(sR({},a.buffer.detail),t.detail),flag:a.buffer.flag,opid:t.opid,cert:a.buffer.cert})}),!n)throw new nt(M.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function Qx(t,e){return await wt.all(t.addresses.map(async n=>({address:B("USE_TURN_IP")?n.ip:Xu(n.ip),tcpport:n.port,udpport:n.port,username:e&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():nr.username,password:e&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await UA(e.toString()):nr.password})))}function Lw(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),i=e.videoHeight||n.height,r=e.videoWidth||n.width;return i&&r?Math.max(Math.min(i,r)/Math.min(Ws(t.height),Ws(t.width)),1):(T.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ju(t){let{candidateType:e,relayProtocol:n,type:i,address:r,port:a,protocol:c}=t;const l={candidateType:e,relayProtocol:n,protocol:c};if(i!=="local-candidate"){const u=r.split(".");u.length>=4&&(u[1]="*",u[2]="*"),l.address=u.join("."),l.port=a}return l}function aR(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:B("SVC_MODE");if(B("ENABLE_SVC"))return function(e){return e in xb}(t)?t:xb.L1T3}const Zx={[Bt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Bt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function oR(t,e,n){e.forEach(i=>{var r;const a=Zx[t].find(l=>{var u;let{key:h}=l;return At(u=i.extensionName).call(u,h)});if(!a)return;const c=n.find(l=>{let{extensionName:u}=l;return At(u).call(u,a.key)});c&&At(r=c.extensionName).call(r,"gdpr_forbidden")&&(i.extensionName=c.extensionName)})}function t_(t,e){e.forEach(n=>{var i;const r=Zx[t].find(a=>{var c;let{key:l}=a;return At(c=n.extensionName).call(c,l)});At(i=n.extensionName).call(i,"gdpr_forbidden")&&r&&(n.extensionName=r.extensionName)})}function $x(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||At(t).call(t,"abs-send-time")}function cR(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||At(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function tM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function eM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?tM(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function ny(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:a,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:u}=e,{useXR:h}=n;let p=[],m=[],g=[],S=[],D=!1,w=!1;if(ys(t).mediaDescriptions.forEach(k=>{i&&i!==k.attributes.direction||(k.media.mediaType!=="video"||D||(m=k.attributes.payloads,S=k.attributes.extmaps,D=!0),k.media.mediaType!=="audio"||w||(p=k.attributes.payloads,g=k.attributes.extmaps,w=!0))}),!S||m.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!g||p.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(m.forEach(k=>{var x;(x=k.rtpMap)!==null&&x!==void 0&&x.clockRate&&(k.rtpMap.clockRate=parseInt(k.rtpMap.clockRate)),h&&k.rtcpFeedbacks.push({type:"rrtr"})}),p.forEach(k=>{var x;(x=k.rtpMap)!==null&&x!==void 0&&x.clockRate&&(k.rtpMap.clockRate=parseInt(k.rtpMap.clockRate)),h&&k.rtcpFeedbacks.push({type:"rrtr"})}),r&&(p=p.filter(k=>{var x;return((x=k.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())!=="rtx"}),m=m.filter(k=>{var x;return((x=k.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())!=="rtx"})),a&&(m=m.filter(k=>{var x;return!/(red)|(ulpfec)|(flexfec)/i.test(((x=k.rtpMap)===null||x===void 0?void 0:x.encodingName)||"")})),c&&(p=p.filter(k=>{var x;return!/(red)|(ulpfec)|(flexfec)/i.test(((x=k.rtpMap)===null||x===void 0?void 0:x.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(p=p.filter(k=>{var x;return At(l).call(l,((x=k.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"")})),u&&(u==null?void 0:u.length)>0){const k=m.filter(x=>{var W;return At(u).call(u,((W=x.rtpMap)===null||W===void 0?void 0:W.encodingName.toLowerCase())||"")});m=k.concat(r?[]:xw(k,m))}const N=B("UNSUPPORTED_VIDEO_CODEC");return N&&N.length>0&&(m=m.filter(k=>!(k.rtpMap&&At(N).call(N,k.rtpMap.encodingName.toLowerCase())))),{audioCodecs:p,videoCodecs:m,audioExtensions:g,videoExtensions:S}}function Qu(t){const e=ys(t);let n,i;for(const r of e.mediaDescriptions){if(!n){const a=r.attributes.iceUfrag,c=r.attributes.icePwd;if(!a||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:a,icePwd:c}}if(!i){const a=r.attributes.fingerprints;a.length>0&&(i={fingerprints:a})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function nM(t,e){const n=[],i=t.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),r=t.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),a=t.attributes.ssrcs;if(r)r.ssrcIds.forEach(c=>{var l;const u=(l=i.find(h=>h.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:e?u:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],l=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:e?l:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function iM(t,e,n){const{cname:i}=t;let r=[];e&&(r=rM(e)),r.length===0&&(r=t.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}})),T.debug("Using candidates from gateway."));const a={fingerprints:t.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},c={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let l;switch(t.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}const u=dR(t.rtpCapabilities),h=[];return Array.isArray(n)&&n.length>0&&n.forEach(p=>{h.push({kind:Bt.VIDEO,ssrcId:p.v,rtx:p.v_rtx,mslabel:"".concat(p.v,"_").concat(p.a)},{kind:Bt.AUDIO,ssrcId:p.a,mslabel:"".concat(p.v,"_").concat(p.a)})}),{dtlsParameters:a,iceParameters:c,candidates:r,rtpCapabilities:u,setup:l,cname:i,preSSRCs:h}}function rM(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),e}function lf(t,e,n){const i=[],r=[];return t.forEach(a=>{let{ssrcId:c,rtx:l}=a;const u=En(8,"track-"),h={ssrcId:c,attributes:eM({label:u,mslabel:n=n||En(10,""),msid:"".concat(n," ").concat(u)},e&&{cname:e})};if(i.push(h),l!==void 0){const p={ssrcId:l,attributes:eM({label:u,mslabel:n,msid:"".concat(n," ").concat(u)},e&&{cname:e})};i.push(p),r.push({semantic:"FID",ssrcIds:[c,l]})}}),t.length>1&&r.push({semantic:"SIM",ssrcIds:t.map(a=>{let{ssrcId:c}=a;return c})}),{ssrcs:i,ssrcGroups:r}}function e_(t,e){e instanceof Wn&&t.attributes.payloads.forEach(n=>{var i;const r=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const a=e._encoderConfig;a&&r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(a.bitrate&&!Vn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function Pw(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function kw(t,e){var n;if(!(e instanceof wn&&e._encoderConfig&&e._hints.indexOf(_n.SCREEN_TRACK)===-1))return;const i=e._encoderConfig;Ke().supportMinBitrate&&i.bitrateMin&&t.attributes.payloads.forEach(r=>{var a,c;At(a=["h264","h265","vp8","vp9","av1"]).call(a,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Ke().supportMinBitrate&&!At(n=e._hints).call(n,_n.LOW_STREAM)&&i.bitrateMax&&t.attributes.payloads.forEach(r=>{var a,c;At(a=["h264","h265","vp8","vp9","av1"]).call(a,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(B("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function sM(t){if(t.media.mediaType!=="video")return;const e=Ge();if(e.name!==Ye.SAFARI&&e.os!==Ai.IOS)return;const n=t.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function lR(t,e,n){if(!e)return;let i,r;if(t.media.mediaType==="video"?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),e.twcc===!0){const a=i.find(c=>cR(c.extensionName));if(a){const c=a.extensionName;t.attributes.extmaps.find(u=>cR(u.extensionName))||t.attributes.extmaps.push({entry:a.entry,extensionName:c}),function(u,h){return h.filter(p=>!!u.find(m=>m.payloadType===p.payloadType&&!!m.rtcpFeedbacks.find(g=>g.type==="transport-cc")))}(r,t.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(h=>h.type==="transport-cc")||u.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){const a=t.attributes.extmaps.findIndex(c=>cR(c.extensionName));a!==-1&&t.attributes.extmaps.splice(a,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(e.remb===!0){const a=i.find(c=>$x(c.extensionName));if(a){const c=a.extensionName;t.attributes.extmaps.find(u=>u.extensionName===c)||t.attributes.extmaps.push({entry:a.entry,extensionName:c}),function(u,h){return h.filter(p=>!!u.find(m=>m.payloadType===p.payloadType&&!!m.rtcpFeedbacks.find(g=>g.type==="goog-remb")))}(r,t.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(h=>h.type==="goog-remb")||u.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){const a=t.attributes.extmaps.findIndex(c=>$x(c.extensionName));a!==-1&&t.attributes.extmaps.splice(a,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(u=>u.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function aM(t,e,n){if(Vn()||t.media.mediaType!=="video"||!(e instanceof wn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!B("SIMULCAST")||n==="vp9"&&B("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,r=t.attributes.ssrcs[0],a=t.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===r.ssrcId),c={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let l=1;l<i;l++)t.attributes.ssrcs.push({ssrcId:r.ssrcId+l,attributes:Gn(r.attributes)}),c.ssrcIds.push(r.ssrcId+l),a&&(t.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+l,attributes:Gn(r.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+l,a.ssrcIds[1]+l]}));t.attributes.ssrcGroups.unshift(c)}async function oM(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:r,recv:a,sendrecv:c}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const p=ny(h,l,u,"sendonly"),m=ny(h,l,u,"recvonly"),g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ao(p,m,"videoExtensions",g,S,D),Ao(p,m,"videoCodecs",g,S,D),Ao(p,m,"audioExtensions",g,S,D),Ao(p,m,"audioCodecs",g,S,D),B("RAISE_H264_BASELINE_PRIORITY")){const w=[],N=[];D.videoCodecs.forEach((k,x)=>{var W;if(((W=k.rtpMap)===null||W===void 0?void 0:W.encodingName.toLocaleLowerCase())==="h264"){var Z,$;const q=D.videoCodecs[x+1],ot=q&&hM(k,q),_t=(Z=k.fmtp)===null||Z===void 0?void 0:Z.parameters["profile-level-id"],Nt=($=k.fmtp)===null||$===void 0?void 0:$.parameters["packetization-mode"];!_t||_t!==B("FIRST_H264_PROFILE_LEVEL_ID")||B("FIRST_PACKETIZATION_MODE")&&Nt!==B("FIRST_PACKETIZATION_MODE")?ot?N.push([k,q]):N.push([k]):ot?w.push([k,q]):w.push([k])}}),w.length>0&&N.length>0&&(T.debug("raising H264 baseline profile priority"),D.videoCodecs.forEach((k,x)=>{var W;if(((W=k.rtpMap)===null||W===void 0?void 0:W.encodingName.toLocaleLowerCase())==="h264"){const Z=hM(k,D.videoCodecs[x+1]),$=w.shift()||N.shift()||[];$.length>0&&(Z?D.videoCodecs.splice(x,2,...$):D.videoCodecs.splice(x,1,...$))}}),S.videoCodecs=S.videoCodecs.filter(k=>{var x,W;return!(((x=k.rtpMap)===null||x===void 0?void 0:x.encodingName.toLocaleLowerCase())==="h264"&&((W=k.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"])!==B("FIRST_H264_PROFILE_LEVEL_ID"))}),B("FILTER_SEND_H264_BASELINE")&&(g.videoCodecs=g.videoCodecs.filter(k=>{var x,W;return!(((x=k.rtpMap)===null||x===void 0?void 0:x.encodingName.toLocaleLowerCase())==="h264"&&((W=k.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"])!==B("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:g,recv:S,sendrecv:D}}(t,e,i);try{n.close()}catch{}return{send:r,recv:a,sendrecv:c}}function cM(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=ny(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ao(t,e,"videoExtensions",n,i,r),Ao(t,e,"videoCodecs",n,i,r),Ao(t,e,"audioExtensions",n,i,r),Ao(t,e,"audioCodecs",n,i,r),B("RAISE_H264_BASELINE_PRIORITY")){const a=r.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(a!==-1){const c=r.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<a){T.debug("raising H264 baseline profile priority");const l=r.videoCodecs[a];r.videoCodecs.splice(a,1),r.videoCodecs.splice(c,0,l)}c!==-1&&(i.videoCodecs=i.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:r}}function Ao(t,e,n,i,r,a){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return t[n].forEach(l=>{e[n].some((u,h)=>{if(l.entry===u.entry&&l.extensionName===u.extensionName)return c.push(h),!0})?a[n].push(l):i[n].push(l)}),void e[n].forEach((l,u)=>{c.indexOf(u)===-1&&r[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return t[n].forEach(l=>{e[n].some((u,h)=>{if(l.payloadType===u.payloadType&&JSON.stringify(l)===JSON.stringify(u))return c.push(h),!0})?a[n].push(l):i[n].push(l)}),void e[n].forEach((l,u)=>{c.indexOf(u)===-1&&r[n].push(l)})}}function dR(t){const{send:e,recv:n,sendrecv:i}=t;if(!i){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let r,a;return e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,n?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...n.audioCodecs,...i.audioCodecs],a.videoCodecs=[...n.videoCodecs,...i.videoCodecs],a.audioExtensions=[...n.audioExtensions,...i.audioExtensions],a.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):a=i,{send:r,recv:a}}function n_(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function iy(t,e,n,i){let r=[];if(t===Bt.VIDEO){if(B("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(r=e.videoCodecs.filter(a=>{var c;return At(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,i)&&a&&a.fmtp&&a.fmtp.parameters["profile-level-id"]===B("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let a=[];const c=[],l=[],u=[];if(n.videoCodecs.forEach(h=>{const p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";At(p).call(p,i)?a.push(h):At(p).call(p,"vp9")?c.push(h):At(p).call(p,"vp8")?l.push(h):At(p).call(p,"h264")&&u.push(h)}),a.length===0){let h="";c.length!==0?(a=c,h="vp9"):l.length!==0?(a=l,h="vp8"):u.length!==0&&(a=u,h="h264"),T.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}a.length!==0&&(r=e.videoCodecs.filter(h=>a.some(p=>p.payloadType===h.payloadType)))}if(r.length===0&&(T.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),r=e.videoCodecs),B("USE_PUB_RTX")||B("USE_SUB_RTX")){const a=xw(r,e.videoCodecs);r=[...r,...a]}}else r=e.audioCodecs.filter(a=>{var c;return At(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,i)}),r.length===0&&(T.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=e.audioCodecs.filter(a=>{var c;return At(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}));return r}function xw(t,e){const n=t.map(i=>i.payloadType.toString());return e.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&At(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function ry(t,e,n){const i=e.toString(),r=dM(i,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:i});const a=await t.createAnswer();if(!a.sdp)throw new Error("cannot get answer sdp");let c=a.sdp;c=lM(c,n||{}),r==null||r(c||""),await t.setLocalDescription({type:"answer",sdp:c})}function lM(t,e,n){const i=ys(t),{useXR:r}=e;return i.mediaDescriptions.forEach(a=>{var c;a.attributes.mid&&(Array.isArray(n)&&!At(n).call(n,a.attributes.mid)||(a.media.mediaType==="audio"&&n_(a),r&&At(c=["audio","video"]).call(c,a.media.mediaType)&&a.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(u=>u.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),zu(i)}function dM(t,e,n,i){if(B("SDP_LOGGING"))return T.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(i,`
`),t),e==="offer"?r=>{dM(r,"answer",n==="local"?"remote":"local",i)}:void 0}function uM(t){const e=B("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(n=>At(t).call(t,n))}function hM(t,e){try{var n;return((n=t.fmtp)===null||n===void 0?void 0:n.parameters.apt)===e.payloadType.toString()}catch{return!1}}function pM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ma(t,e){return typeof B(t)===e?B(t):void 0}function kH(){try{const t=B("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?pM(Object(i),!0).forEach(function(r){P(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):pM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t)}catch(t){return T.debug("handle gateway attributes failed: ",t),{}}}const fM={};function Zu(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&T.debug("install service ".concat(t.name)),fM[t.name]=t}function Rd(t){const e=fM[t];if(!e)throw new ct(M.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function mM(t,e){return Rd("DataStream").create(t,e)}function uR(){return Rd("InterceptFrame").create()}function EM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Cd(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?EM(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):EM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Mw=new Map;class xH extends Mn{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(Ui.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(Ui.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){var i,r,a;super(),P(this,"store",void 0),P(this,"joinInfo",void 0),P(this,"key",void 0),P(this,"ntpOffset",0),P(this,"signal",void 0),P(this,"role",void 0),P(this,"inChannelInfo",{joinAt:null,duration:0}),P(this,"spec",void 0),P(this,"_state","DISCONNECTED"),P(this,"_statsCollector",void 0),P(this,"_disconnectedReason",void 0),P(this,"isSignalRecover",!1),P(this,"hasChangeBGPAddress",!1),P(this,"trafficStatsInterval",void 0),P(this,"networkQualityInterval",void 0),P(this,"_joinGatewayStartTime",0),P(this,"_signalTimeout",!1),P(this,"_clientRoleOptions",void 0),P(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?(i={spec:Cd(Cd({},n),{},{retryConfig:n.websocketRetryConfig}),store:e},(r=(a=Rd("P2PChannel")).createSubmodule)===null||r===void 0?void 0:r.call(a,i)):new LH(Cd(Cd({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const r=Date.now();let a=Mw.get(e.cname);if(a||(a=new Map,Mw.set(e.cname,a)),this._isProactiveJoin=!0,a.has(e.uid)){const h=new nt(M.UID_CONFLICT);throw Jt.joinGateway(e.sid,{lts:r,succ:!1,ec:h.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),h}a.set(e.uid,!0),this.joinInfo=e,this.key=n;let c=0;this.joinGatewayStartTime=r;const l=e.proxyServer;try{T.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));const h=e.gatewayAddrs.map(p=>{let{address:m}=p;const[g,S]=m.split(":"),D={host:g,port:S};return e.proxyServer&&(D.proxy=e.proxyServer),D});c=(await this.signal.init(h)).uid,T.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){var u;throw T.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),Jt.joinGateway(e.sid,{lts:r,succ:!1,ec:((u=h.data)===null||u===void 0?void 0:u.desc)||h.code,errorMsg:h.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:"0",preload:e.preload}),a.delete(e.uid),this.signal.close(),h}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{T.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Ui.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Ui.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Ui.NETWORK_QUALITY,{uplinkNetworkQuality:Jx(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Jx(this._statsCollector.trafficStats.B_dnq)}):this.emit(Ui.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Ze.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==yn.CONNECTED||await function(i,r){return r===1/0?i:wt.race([i,aG(r)])}(this.signal.request(ue.LEAVE,void 0,!0),3e3)}catch(i){T.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==Ze.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:B("PUB_EXTEND"),twcc:!!B("PUBLISH_TWCC"),rtx:!!B("USE_PUB_RTX")};try{return(await this.signal.request(ue.PUBLISH,r,!0))._message}catch(a){if(i&&a.data&&a.data.code===ae.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw a}}async publishDataChannel(e,n,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(r=n.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(ue.PUBLISH_DATASTREAM,a,!0)}catch(c){if(i&&c.data&&c.data.code===ae.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw c}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ue.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(i){T.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await wt.all(e.map(n=>this.signal.request(ue.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){T.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX")||void 0,extend:B("SUB_EXTEND"),svc:Array.isArray(B("SVC"))&&B("SVC").length!==0?B("SVC"):void 0};try{return await this.signal.request(ue.PRE_SUBSCRIBE,r,!0)}catch(a){if(i&&a.data&&a.data.code===ae.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),a.toString()),this.presubscribe(e,n,!1);throw a}}async subscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX"),extend:B("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(B("SVC"))&&B("SVC").length!==0?B("SVC"):void 0};try{return(await this.signal.request(ue.SUBSCRIBE,r,!0))._message}catch(a){if(i&&a.data&&a.data.code===ae.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw a}}async subscribeDataChannel(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(ue.SUBSCRIBE_DATASTREAM,r,!0)}catch(a){if(i&&a.data&&a.data.code===ae.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),a.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw a}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!B("USE_SUB_RTX"),twcc:!!B("SUBSCRIBE_TWCC"),svc:Array.isArray(B("SVC"))&&B("SVC").length!==0?B("SVC"):void 0};try{return await this.signal.request(ue.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(n&&r.data&&r.data.code===ae.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,a=i.width,c=i.height,l=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(l=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,r||(l=!1)),l?{stream_type:0,width:a,height:c,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(n)return this.signal.request(ue.SET_VIDEO_PROFILE,n);T.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(ue.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(i){T.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await wt.all(e.map(i=>this.signal.request(ue.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){T.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(ue.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){T.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(ue.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ue.GATEWAY_INFO)}async renewToken(e){await this.signal.request(ue.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,n){n&&(this._clientRoleOptions=Object.assign({},n)),B("CLIENT_ROLE_OPTIONS")&&(T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(B("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},B("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),B("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},B("CLIENT_ROLE_OPTIONS")),T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(B("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let i,r=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(ue.SET_CLIENT_ROLE,{role:e,level:r,delay:i,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(ue.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(ue.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(ue.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(ue.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(ue.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Cd({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ue.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=Mw.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:nr.username,password:nr.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Cd(Cd({},nr),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(ue.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&Db(()=>{this.emit(Ui.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new nt(M.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=B("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}var r;i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Ui.UPDATE_GATEWAY_CONFIG),r=this.store.clientId,At(XE).call(XE,r)||XE.push(r);const a=!(Vn()||kP(87)||bk())&&typeof B("ENABLE_PRE_SUB")=="boolean"&&B("ENABLE_PRE_SUB"),c=!bk()&&Ma("ENABLE_PREALLOC_PC","boolean"),l=kH(),u=VS(87)||function(){const p=Ge();if(p.name!==Ye.SAFARI||!p.browserVersion)return!1;const m=p.browserVersion.split(".");return Number(m[0])>15||Number(m[0])===15&&Number(m[1])>=4}(),h=Cd({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:La,browser:navigator.userAgent,process_id:B("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:B("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:Cd({enableEncodedTransform:!!B("ENABLE_AUDIO_METADATA")&&u||!!B("ENABLE_AUDIO_TOPN")&&OA(Ye.CHROME,87,116)||void 0,enableAudioMetadata:!!B("ENABLE_AUDIO_METADATA")&&u,enableAudioPts:!!B("ENABLE_AUDIO_PTS_METADATA")&&u,topnSmoothLevel:B("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:B("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:B("TOPN_SWITCH_HOLD_MS"),topnAudioGain:B("TOPN_AUDIO_GAIN"),enablePublishedUserList:B("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:B("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Ma("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Ma("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Ma("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:B("USE_PUB_RTX")===!0||B("USE_SUB_RTX")===!0||void 0,disableFEC:B("DISABLE_FEC"),enableNTPReport:!!B("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!B("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!B("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ma("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!B("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!B("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ma("USE_XR","boolean"),enableLossbasedBwe:Ma("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!B("ENABLE_AUT_CC")||void 0,enableCCFallback:Ma("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:c,preSubNum:a?Ma("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ma("PUBLISH_TWCC","boolean"),enableSubTWCC:Ma("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ma("USE_PUB_RTX","boolean"),enableSubRTX:Ma("USE_SUB_RTX","boolean"),enableSubSVC:B("ENABLE_SVC")?B("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(B("SVC"))&&B("SVC").length!==0?B("SVC"):void 0,enableSvcExtended:B("ENABLE_SVC")&&Array.isArray(B("SVC_EXTENDED"))&&B("SVC_EXTENDED").length!==0?B("SVC_EXTENDED"):void 0},l)},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,B("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new nt(M.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(pe.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(pe.WS_RECONNECTING,e=>{this.joinInfo&&Jt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||tr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Jt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(pe.WS_CLOSED,e=>{let n;switch(e){case Ze.LEAVE:n=tr.LEAVE;break;case Ze.UID_BANNED:case Ze.IP_BANNED:case Ze.CHANNEL_BANNED:case Ze.SERVER_ERROR:n=tr.SERVER_ERROR;break;case Ze.FALLBACK:n=tr.FALLBACK;break;case Ze.LICENSE_MISSING:case Ze.LICENSE_EXPIRED:case Ze.LICENSE_MINUTES_EXCEEDED:case Ze.LICENSE_PERIOD_INVALID:case Ze.LICENSE_MULTIPLE_SDK_SERVICE:case Ze.LICENSE_ILLEGAL:case Ze.TOKEN_EXPIRE:n=e;break;default:n=tr.NETWORK_ERROR}T.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+tr.NETWORK_ERROR)),this.joinInfo&&Jt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Ze.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==Ze.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(pe.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const e=B("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(Jt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));sn("EVENT_REPORT_DOMAIN",e[1]),sn("EVENT_REPORT_BACKUP_DOMAIN",e[1]),sn("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(Pe.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(pe.REQUEST_RECOVER,(e,n,i)=>{if(!this.joinInfo)return i(new nt(M.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,er(this,Ui.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(pe.REQUEST_JOIN_INFO,async(e,n,i)=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const a=Gn((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(B("NEW_TURN_MODE")&&a){let h=a.servers,p=a.serversFromGateway;const m=this.signal.currentURLIndex;h.length>0&&(h=[h[m%h.length]],a.servers=h),Array.isArray(p)&&p.length>0&&(p=[p[0]],a.serversFromGateway=p),T.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(m))}const{iceParameters:c,dtlsParameters:l,rtpCapabilities:u}=await er(this,Ui.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:a});try{e(this.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:l,rtpCapabilities:u,version:"2"}}))}catch(h){n(h)}}),this.signal.on(pe.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(pe.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let i,r="";var a;e instanceof nt?(i=((a=e.data)===null||a===void 0?void 0:a.desc)||e.code,r=e.message):i=e,Jt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(pe.IS_P2P_DISCONNECTED,e=>{e(WS(this,Ui.IS_P2P_DISCONNECTED))}),this.signal.on(pe.DISCONNECT_P2P,()=>{this.emit(Ui.DISCONNECT_P2P)}),this.signal.on(pe.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(pe.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(pe.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(Ui.JOIN_RESPONSE,e,n)}),this.signal.on(pe.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),n=B("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&n){const i=rM(e);this.emit(Ui.PRE_CONNECT_PC,{candidates:i,fingerprint:n})}}}),this.signal.on(pe.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof B("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(B("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(ue.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(ue.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw T.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(ue.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(ue.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw T.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){const n={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(ue.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,n){const i={action:e.find(r=>r.stream_type===tn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(ue.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,n){const i={action:e.find(r=>r.stream_type===tn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(ue.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,n){const i={action:e===Bt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ue.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,n){const i={action:e===Bt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ue.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(ue.RESTART_ICE,n,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(e,n){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,n||tr.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!B("GATEWAY_WSS_ADDRESS"))return B("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(T.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(ue.SET_PARAMETER,{enablePublishAudioFilter:e})}}let hR=0,Uw=0;function Sc(t,e,n,i){return new wt((r,a)=>{e.timeout=e.timeout||B("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),hR+=dl(e.data)):n&&(e.data.size?hR+=e.data.size:e.data instanceof FormData?hR+=ZP(e.data):hR+=dl(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,ss.request(e).then(c=>{typeof c.data=="string"?Uw+=dl(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?Uw+=c.data.byteLength:Uw+=dl(JSON.stringify(c.data)),i&&r({data:c.data,headers:c.headers}),r(c.data)}).catch(c=>{ss.isCancel(c)?a(new nt(M.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new nt(M.NETWORK_TIMEOUT,c.message)):c.response?a(new nt(M.NETWORK_RESPONSE_ERROR,c.response.status)):a(new nt(M.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(pt){var bt=0;return function(){return bt<pt.length?{done:!1,value:pt[bt++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(pt,bt,qt){return pt==Array.prototype||pt==Object.prototype||(pt[bt]=qt.value),pt},i,r=function(pt){pt=[typeof globalThis=="object"&&globalThis,pt,typeof window=="object"&&window,typeof self=="object"&&self,typeof A=="object"&&A];for(var bt=0;bt<pt.length;++bt){var qt=pt[bt];if(qt&&qt.Math==Math)return qt}throw Error("Cannot find global object")}(this);function a(pt,bt){if(bt)t:{var qt=r;pt=pt.split(".");for(var ft=0;ft<pt.length-1;ft++){var C=pt[ft];if(!(C in qt))break t;qt=qt[C]}(bt=bt(ft=qt[pt=pt[pt.length-1]]))!=ft&&bt!=null&&n(qt,pt,{configurable:!0,writable:!0,value:bt})}}function c(pt){return(pt={next:pt})[Symbol.iterator]=function(){return this},pt}function l(pt){var bt=typeof Symbol<"u"&&Symbol.iterator&&pt[Symbol.iterator];return bt?bt.call(pt):{next:e(pt)}}if(a("Symbol",function(pt){function bt(C,F){this.A=C,n(this,"description",{configurable:!0,writable:!0,value:F})}if(pt)return pt;bt.prototype.toString=function(){return this.A};var qt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ft=0;return function C(F){if(this instanceof C)throw new TypeError("Symbol is not a constructor");return new bt(qt+(F||"")+"_"+ft++,F)}}),a("Symbol.iterator",function(pt){if(pt)return pt;pt=Symbol("Symbol.iterator");for(var bt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),qt=0;qt<bt.length;qt++){var ft=r[bt[qt]];typeof ft=="function"&&typeof ft.prototype[pt]!="function"&&n(ft.prototype,pt,{configurable:!0,writable:!0,value:function(){return c(e(this))}})}return pt}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var u;t:{var h={};try{h.__proto__={a:!0},u=h.a;break t}catch{}u=!1}i=u?function(pt,bt){if(pt.__proto__=bt,pt.__proto__!==bt)throw new TypeError(pt+" is not extensible");return pt}:null}var p=i;function m(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function g(pt){if(pt.m)throw new TypeError("Generator is already running");pt.m=!0}function S(pt,bt){return pt.h=3,{value:bt}}function D(pt){this.g=new m,this.G=pt}function w(pt,bt,qt,ft){try{var C=bt.call(pt.g.j,qt);if(!(C instanceof Object))throw new TypeError("Iterator result "+C+" is not an object");if(!C.done)return pt.g.m=!1,C;var F=C.value}catch(z){return pt.g.j=null,pt.g.s(z),N(pt)}return pt.g.j=null,ft.call(pt.g,F),N(pt)}function N(pt){for(;pt.g.h;)try{var bt=pt.G(pt.g);if(bt)return pt.g.m=!1,{value:bt.value,done:!1}}catch(qt){pt.g.v=void 0,pt.g.s(qt)}if(pt.g.m=!1,pt.g.l){if(bt=pt.g.l,pt.g.l=null,bt.F)throw bt.D;return{value:bt.return,done:!0}}return{value:void 0,done:!0}}function k(pt){this.next=function(bt){return pt.o(bt)},this.throw=function(bt){return pt.s(bt)},this.return=function(bt){return function(qt,ft){g(qt.g);var C=qt.g.j;return C?w(qt,"return"in C?C.return:function(F){return{value:F,done:!0}},ft,qt.g.return):(qt.g.return(ft),N(qt))}(pt,bt)},this[Symbol.iterator]=function(){return this}}function x(pt,bt){return bt=new k(new D(bt)),p&&pt.prototype&&p(bt,pt.prototype),bt}if(m.prototype.o=function(pt){this.v=pt},m.prototype.s=function(pt){this.l={D:pt,F:!0},this.h=this.C||this.u},m.prototype.return=function(pt){this.l={return:pt},this.h=this.u},D.prototype.o=function(pt){return g(this.g),this.g.j?w(this,this.g.j.next,pt,this.g.o):(this.g.o(pt),N(this))},D.prototype.s=function(pt){return g(this.g),this.g.j?w(this,this.g.j.throw,pt,this.g.o):(this.g.s(pt),N(this))},a("Array.prototype.entries",function(pt){return pt||function(){return function(bt,qt){bt instanceof String&&(bt+="");var ft=0,C=!1,F={next:function(){if(!C&&ft<bt.length){var z=ft++;return{value:qt(z,bt[z]),done:!1}}return C=!0,{done:!0,value:void 0}}};return F[Symbol.iterator]=function(){return F},F}(this,function(bt,qt){return[bt,qt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var W=function(pt,bt){for(var qt=0;qt<pt.length;qt++)bt(pt[qt])},Z=function(pt){return pt.replace(/\r?\n|\r/g,`\r
`)},$=function(pt,bt,qt){return bt instanceof Blob?(qt=qt!==void 0?qt+"":typeof bt.name=="string"?bt.name:"blob",bt.name===qt&&Object.prototype.toString.call(bt)!=="[object Blob]"||(bt=new File([bt],qt)),[String(pt),bt]):[String(pt),String(bt)]},q=function(pt,bt){if(pt.length<bt)throw new TypeError(bt+" argument required, but only "+pt.length+" present.")},ot=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,_t=ot.FormData,Nt=ot.XMLHttpRequest&&ot.XMLHttpRequest.prototype.send,Mt=ot.Request&&ot.fetch,ke=ot.navigator&&ot.navigator.sendBeacon,xe=ot.Element&&ot.Element.prototype,gn=ot.Symbol&&Symbol.toStringTag;gn&&(Blob.prototype[gn]||(Blob.prototype[gn]="Blob"),"File"in ot&&!File.prototype[gn]&&(File.prototype[gn]="File"));try{new File([],"")}catch{ot.File=function(bt,qt,ft){return bt=new Blob(bt,ft||{}),Object.defineProperties(bt,{name:{value:qt},lastModified:{value:+(ft&&ft.lastModified!==void 0?new Date(ft.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),gn&&Object.defineProperty(bt,gn,{value:"File"}),bt}}var ni=function(pt){return pt.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Kn=function(pt){this.i=[];var bt=this;pt&&W(pt.elements,function(qt){if(qt.name&&!qt.disabled&&qt.type!=="submit"&&qt.type!=="button"&&!qt.matches("form fieldset[disabled] *"))if(qt.type==="file"){var ft=qt.files&&qt.files.length?qt.files:[new File([],"",{type:"application/octet-stream"})];W(ft,function(C){bt.append(qt.name,C)})}else qt.type==="select-multiple"||qt.type==="select-one"?W(qt.options,function(C){!C.disabled&&C.selected&&bt.append(qt.name,C.value)}):qt.type==="checkbox"||qt.type==="radio"?qt.checked&&bt.append(qt.name,qt.value):(ft=qt.type==="textarea"?Z(qt.value):qt.value,bt.append(qt.name,ft))})};if((t=Kn.prototype).append=function(pt,bt,qt){q(arguments,2),this.i.push($(pt,bt,qt))},t.delete=function(pt){q(arguments,1);var bt=[];pt=String(pt),W(this.i,function(qt){qt[0]!==pt&&bt.push(qt)}),this.i=bt},t.entries=function pt(){var bt,qt=this;return x(pt,function(ft){if(ft.h==1&&(bt=0),ft.h!=3)return bt<qt.i.length?ft=S(ft,qt.i[bt]):(ft.h=0,ft=void 0),ft;bt++,ft.h=2})},t.forEach=function(pt,bt){q(arguments,1);for(var qt=l(this),ft=qt.next();!ft.done;ft=qt.next()){var C=l(ft.value);ft=C.next().value,C=C.next().value,pt.call(bt,C,ft,this)}},t.get=function(pt){q(arguments,1);var bt=this.i;pt=String(pt);for(var qt=0;qt<bt.length;qt++)if(bt[qt][0]===pt)return bt[qt][1];return null},t.getAll=function(pt){q(arguments,1);var bt=[];return pt=String(pt),W(this.i,function(qt){qt[0]===pt&&bt.push(qt[1])}),bt},t.has=function(pt){q(arguments,1),pt=String(pt);for(var bt=0;bt<this.i.length;bt++)if(this.i[bt][0]===pt)return!0;return!1},t.keys=function pt(){var bt,qt,ft,C,F=this;return x(pt,function(z){if(z.h==1&&(bt=l(F),qt=bt.next()),z.h!=3)return qt.done?void(z.h=0):(ft=qt.value,C=l(ft),S(z,C.next().value));qt=bt.next(),z.h=2})},t.set=function(pt,bt,qt){q(arguments,2),pt=String(pt);var ft=[],C=$(pt,bt,qt),F=!0;W(this.i,function(z){z[0]===pt?F&&(F=!ft.push(C)):ft.push(z)}),F&&ft.push(C),this.i=ft},t.values=function pt(){var bt,qt,ft,C,F=this;return x(pt,function(z){if(z.h==1&&(bt=l(F),qt=bt.next()),z.h!=3)return qt.done?void(z.h=0):(ft=qt.value,(C=l(ft)).next(),S(z,C.next().value));qt=bt.next(),z.h=2})},Kn.prototype._asNative=function(){for(var pt=new _t,bt=l(this),qt=bt.next();!qt.done;qt=bt.next()){var ft=l(qt.value);qt=ft.next().value,ft=ft.next().value,pt.append(qt,ft)}return pt},Kn.prototype._blob=function(){var pt="----formdata-polyfill-"+Math.random(),bt=[],qt="--"+pt+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ft,C){return typeof ft=="string"?bt.push(qt+ni(Z(C))+`"\r
\r
`+Z(ft)+`\r
`):bt.push(qt+ni(Z(C))+'"; filename="'+ni(ft.name)+`"\r
Content-Type: `+(ft.type||"application/octet-stream")+`\r
\r
`,ft,`\r
`)}),bt.push("--"+pt+"--"),new Blob(bt,{type:"multipart/form-data; boundary="+pt})},Kn.prototype[Symbol.iterator]=function(){return this.entries()},Kn.prototype.toString=function(){return"[object FormData]"},xe&&!xe.matches&&(xe.matches=xe.matchesSelector||xe.mozMatchesSelector||xe.msMatchesSelector||xe.oMatchesSelector||xe.webkitMatchesSelector||function(pt){for(var bt=(pt=(this.document||this.ownerDocument).querySelectorAll(pt)).length;0<=--bt&&pt.item(bt)!==this;);return-1<bt}),gn&&(Kn.prototype[gn]="FormData"),Nt){var us=ot.XMLHttpRequest.prototype.setRequestHeader;ot.XMLHttpRequest.prototype.setRequestHeader=function(pt,bt){us.call(this,pt,bt),pt.toLowerCase()==="content-type"&&(this.B=!0)},ot.XMLHttpRequest.prototype.send=function(pt){pt instanceof Kn?(pt=pt._blob(),this.B||this.setRequestHeader("Content-Type",pt.type),Nt.call(this,pt)):Nt.call(this,pt)}}Mt&&(ot.fetch=function(pt,bt){return bt&&bt.body&&bt.body instanceof Kn&&(bt.body=bt.body._blob()),Mt.call(this,pt,bt)}),ke&&(ot.navigator.sendBeacon=function(pt,bt){return bt instanceof Kn&&(bt=bt._asNative()),ke.call(this,pt,bt)}),ot.FormData=Kn}})();const sy=()=>{const t=B("AREAS");return t.length===0&&t.push(qe.GLOBAL),ms(t).call(t,(e,n,i)=>{const r=_M(n);return r?i===0?r:"".concat(e,",").concat(r):e},"")},_M=t=>t===qe.OVERSEA?"".concat(dr.ASIA,",").concat(dr.EUROPE,",").concat(dr.AFRICA,",").concat(dr.NORTH_AMERICA,",").concat(dr.SOUTH_AMERICA,",").concat(dr.OCEANIA):dr[t],MH=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const i=rR[n],r=Object.keys(i);r&&r.map(a=>{a!=="CODE"&&(e[a]=e[a].concat(i[a]))})}),e},pR={GLOBAL:{ASIA:[qe.CHINA,qe.JAPAN,qe.INDIA,qe.KOREA,qe.HKMC],EUROPE:[],NORTH_AMERICA:[qe.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},fR=Object.keys(pR[qe.GLOBAL]),jw=[qe.CHINA,qe.NORTH_AMERICA,qe.EUROPE,qe.ASIA,qe.JAPAN,qe.INDIA,qe.OCEANIA,qe.SOUTH_AMERICA,qe.AFRICA,qe.KOREA,qe.HKMC,qe.US],UH=function(t,e){let n=[];if(At(t).call(t,qe.GLOBAL)){const a=[qe.GLOBAL,qe.OVERSEA],c=Object.keys(rR);if(e===qe.GLOBAL)throw new nt(M.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===qe.CHINA)n=[qe.OVERSEA];else if(r=e,At(fR).call(fR,r)){const l=(i=e,pR[qe.GLOBAL][i]||[]),u=[...a,e,...l];n=c.filter(h=>!At(u).call(u,h))}else if(function(l){let u=!1;return fR.forEach(h=>{var p;At(p=pR[qe.GLOBAL][h]).call(p,l)&&(u=!0)}),u}(e)){const l=function(h){let p;return fR.forEach(m=>{var g;At(g=pR[qe.GLOBAL][m]).call(g,h)&&(p=m)}),p}(e),u=[...a,l,e];n=c.filter(h=>!At(u).call(u,h))}else n=t;n=function(l){const u=[];return jw.forEach(h=>{At(l).call(l,h)&&u.push(h)}),u.concat(l.filter(h=>!At(jw).call(jw,h)))}(n)}else n=t;var i,r;return n};function gM(t){var e,n;if(!t&&At(e=B("AREAS")).call(e,qe.EXTENSIONS))return T.debug("update area from ap : reset"),void Vw(zG,!0);if(!At(n=B("AREAS")).call(n,qe.GLOBAL)||!t)return;let i=rR.EXTENSIONS;i&&(i={CODE:_M(qe.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},T.debug("update area from ap success: ".concat(t,",config is "),i),sn("AREAS",[qe.EXTENSIONS],!0),Object.keys(i).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?sn(r,i[r][0]):sn(r,i[r])}))}function Vw(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Jt.reportApiInvoke(null,{name:ui.SET_AREA,options:t,tag:Fn.TRACER});try{let i=[];if(typeof t=="string"&&(i=[t]),Array.isArray(t)&&(t.forEach(a=>{if(!At(jx).call(jx,a))throw new nt(M.INVALID_PARAMS,"invalid area code")}),i=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:a,excludedArea:c}=t;if(!a)throw new nt(M.INVALID_PARAMS,"area code is needed");let l=a;typeof a=="string"&&(l=[a]),i=c?UH(l,c):l}if(!e){if(mc.AREAS){const a=new nt(M.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(a),void T.warning("setArea is prohibited because of config-distribute")}if(At(i).call(i,qe.GLOBAL)&&B("AREAS")===qe.EXTENSIONS){const a=new nt(M.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(a),void T.warning("setArea is prohibited because of ap extensions")}}sn("AREAS",i,e);const r=MH(i);Object.keys(r).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?sn(a,r[a][0]):sn(a,r[a])}),T.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function SM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function El(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?SM(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):SM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let Bw=1;function jH(t,e,n,i,r){Bw+=1;const a={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:Bw,requestId:Bw,version:La,cname:n.cname},c={service_name:e,json_body:JSON.stringify(a)};let l,u,h=t[0];return fc(async()=>{l=Date.now();const p=await Sc(h,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(u=Date.now()-l,p.code!==0){const S=new nt(M.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:u});throw T.error(S.toString()),S}const m=JSON.parse(p.json_body);if(m.code!==200){const S=new nt(M.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(m.code,", reason: ").concat(m.reason),{code:m.code,responseTime:u});throw T.error(S.toString()),S}if(!m.servers||m.servers.length===0){const S=new nt(M.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:m.code,responseTime:u});throw T.error(S.toString()),S}const g=function(S,D){return{addressList:S.servers.map(w=>"wss://".concat(w.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(w.wss,"?serviceName=").concat(encodeURIComponent(D))),workerToken:S.workerToken,vid:S.vid}}(m,e);return B("LIVE_STREAMING_ADDRESS")&&(g.addressList=B("LIVE_STREAMING_ADDRESS")instanceof Array?B("LIVE_STREAMING_ADDRESS"):[B("LIVE_STREAMING_ADDRESS")]),El(El({},g),{},{responseTime:u})},(p,m)=>(Jt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(p.addressList),firstSuccess:m===0,responseTime:u,serverIp:t[m%t.length]}),!1),(p,m)=>(Jt.apworkerEvent(n.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:e,responseTime:u,serverIp:t[m%t.length]}),!!(p.code!==M.OPERATION_ABORTED&&p.code!==M.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(h=t[(m+1)%t.length],!0)),r)}let Fw=1;function yM(t,e,n,i){let{url:r,areaCode:a}=t;const{clientId:c,sid:l}=e,u=Date.now();let h;const p=e.role,[m,g]=Hw(e,a,[ai.CHOOSE_SERVER]);let S=si.networkState;return fc(async()=>{S&&si.networkState===Hs.OFFLINE&&si.onlineWaiter&&await wt.race([si.onlineWaiter,Hi(i&&i.maxRetryTimeout||hi.maxRetryTimeout)]),S=si.networkState;const{data:D,headers:w}=await Sc(r,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=w.http3==="1"?1:-1,Jt.reportResourceTiming(r,l),vM(D,r,e,u,[ai.CHOOSE_SERVER],h);const N=ey(D,ai.CHOOSE_SERVER);return Gw(N),Dw(N,r)},D=>(D&&Jt.joinChooseServer(l,{role:p,lts:u,succ:!0,csAddr:r,opid:g,serverList:D.gatewayAddrs.map(w=>w.address),ec:null,cid:D.cid.toString(),uid:D.uid.toString(),csIp:D.csIp,unilbsServerIds:[ai.CHOOSE_SERVER].toString(),isHttp3:h,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:D.res.detail&&D.res.detail[38]}),!1),D=>D.code!==M.OPERATION_ABORTED&&(D.code===M.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(Jt.joinChooseServer(l,{role:p,lts:u,succ:!1,csAddr:r,serverList:null,opid:g,ec:D.code,csIp:D.data&&D.data.csIp,unilbsServerIds:[ai.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:S}),isHttp3:h,corssRegionTagReq:e.apRequestDetail}),T.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),D),!0)),i)}function TM(t,e,n,i){let r,{url:a,areaCode:c,serviceIds:l}=t;const u=Date.now(),h=e.role,[p,m]=Hw(e,c,l);let g;return fc(async()=>{g&&si.networkState===Hs.OFFLINE&&si.onlineWaiter&&await wt.race([si.onlineWaiter,Hi(i&&i.maxRetryTimeout||hi.maxRetryTimeout)]),g=si.networkState;const{data:S,headers:D}=await Sc(a,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=D.http3==="1"?1:-1,Jt.reportResourceTiming(a,e.sid),vM(S,a,e,u,l,r);const w=ey(S,ai.CHOOSE_SERVER),N=ey(S,e.cloudProxyServer==="proxy5"?ai.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ai.CLOUD_PROXY:ai.CLOUD_PROXY_FALLBACK);return Gw(w),{gatewayInfo:Dw(w,a),proxyInfo:N,url:a}},S=>(S.gatewayInfo&&Jt.joinChooseServer(e.sid,{role:h,lts:u,succ:!0,csAddr:a,serverList:S.gatewayInfo.gatewayAddrs.map(D=>D.address),ec:null,opid:m,cid:S.gatewayInfo.cid.toString(),uid:S.gatewayInfo.uid.toString(),csIp:S.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:r,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:S.gatewayInfo.res.detail&&S.gatewayInfo.res.detail[38]}),S.proxyInfo&&Jt.joinWebProxyAP(e.sid,{lts:u,sucess:1,apServerAddr:a,turnServerAddrList:S.proxyInfo.addresses.map(D=>D.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:l.toString()}),!1),S=>S.code!==M.OPERATION_ABORTED&&(S.code===M.CAN_NOT_GET_GATEWAY_SERVER?S.data.retry:(Jt.joinWebProxyAP(e.sid,{lts:u,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:S.code,eventType:e.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:g})}),T.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),S),!0)),i)}const vM=(t,e,n,i,r,a)=>{const{sid:c,clientId:l,cloudProxyServer:u}=n,h=[],p=m=>{m.flag===4096?Jt.joinChooseServer(c,{role:n.role,lts:i,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:a,corssRegionTagReq:n.apRequestDetail}):m.flag!==1048576&&m.flag!==4194304&&m.flag!==4194310||Jt.joinWebProxyAP(c,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:m.error.code,eventType:u,unilbsServerIds:r.toString()})};if(t.response_body.forEach(m=>{const g=m.buffer.code;if(m.uri===23&&g===0&&!m.buffer.edges_services)if(m.buffer.flag===4194310)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const S={error:new nt(M.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:m.buffer.flag};h.push(S),p(S)}if(g!==0){const S=$E(g),D={error:new nt(M.CAN_NOT_GET_GATEWAY_SERVER,S.desc,{desc:S.desc,retry:S.retry,csIp:t.detail[502]}),flag:m.buffer.flag};m.buffer.flag===4194310?T.warning(D.error.toString()):h.push(D),p(D)}}),h.length)throw T.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new nt(M.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:t.detail[502],desc:[...new Set(h.map(m=>{var g;return m==null||(g=m.error)===null||g===void 0||(g=g.data)===null||g===void 0?void 0:g.desc}).filter(m=>!!m))]})},Gw=t=>{var e,n,i,r;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new nt(M.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(B("AP_AREA")&&((i=t.detail)!==null&&i!==void 0&&i[23]&&typeof((r=t.detail)===null||r===void 0?void 0:r[23])=="string"?gM(t.detail[23].toLowerCase()):gM()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const c=t.detail[19],l=c==null?void 0:c.split(";");for(let u=0;u<l.length;u++){var a;const h=Lr(a=l[u]).call(a);t.addresses[u]&&l&&(t.addresses[u].fingerprint=h)}}if(B("GATEWAY_ADDRESS")&&B("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",B("GATEWAY_ADDRESS"));const c=B("GATEWAY_ADDRESS").map(l=>{var u,h;const p=(u=(h=t.addresses.find(m=>m.ip===l.ip&&m.port===l.port))===null||h===void 0?void 0:h.fingerprint)!==null&&u!==void 0?u:"";return{ip:l.ip,port:l.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:p}});t.addresses=c}},VH=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const i=$E(n.buffer.code);throw new nt(M.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",e),new nt(M.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Hw=(t,e,n)=>{const i=Math.floor(Math.random()*1e12),r=t.role==="host"?"1":t.role==="audience"?"2":void 0,a={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:El(El(El({6:t.stringUid,11:e,12:B("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};a.request_bodies.forEach(l=>{t.multiIP&&t.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const c=new FormData;return c.append("request",JSON.stringify(a)),[c,i]},BH=(t,e)=>{const n=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]};let i_=0;function r_(t){return wt.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const ay=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:i,allFailedhandler:r,promisesCollector:a}=t,c=0;const l=e;let u,h=0;const p=async()=>{const m=(()=>{const g=c*l,S=g+l;return n.slice(g,S).map(i)})();a&&a.push(...m);try{u=await r_(m)}catch(g){if(h+=l,c++,!(h>=n.length))return void await p();r(g)}m.forEach(g=>g.cancel())};return await p(),u},bM=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:i}=t;const r=e.length;let a=0;const c=async()=>{const l=n(e.shift());try{return await l}catch(u){if(a++,a>=r||i!=null&&i(u))throw u;return c()}};return c()};async function Ww(t,e,n,i){return{gatewayInfo:await async function(a,c,l,u){let h=null;const p=[],m=async()=>{const S=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(N=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:sy()})),D=u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(N=>N.url)}),w=await ay({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:N=>(T.debug("[".concat(a.clientId,"] Connect to choose_server:"),N.url),yM(N,a,c,l)),allFailedhandler:N=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},D),N[0]},promisesCollector:p});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},D),w},g=async()=>{if(await Hi(1e3),h!==null)return h;const S=B("WEBCS_DOMAIN_BACKUP_LIST").map(N=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:sy()})),D=u.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(N=>N.url)}),w=await ay({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:N=>(T.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),N.url),yM(N,a,c,l)),allFailedhandler:N=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},D),N[0]},promisesCollector:p});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},D),w};try{return h=await r_([m(),g()]),p.length&&p.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),h}catch(S){throw S[0]}}(t,e,n,i)}}async function RM(t,e,n,i,r){const a=t.cloudProxyServer;if(a==="disabled"){if(t.useLocalAccessPoint)return await Ww(t,e,n,r);if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:g,proxyInfo:S}=await wM(t,e,n,r);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:g};const D=S.map(w=>({turnServerURL:w.address,tcpport:w.tcpport||nr.tcpport,udpport:w.udpport||nr.udpport,username:w.username||nr.username,password:w.password||nr.password,forceturn:!1,security:!0}));if(r.useP2P){var c;const w=(c=t.uid)!==null&&c!==void 0?c:g.uid,N="glb:".concat(w.toString()),k=await UA(N),x=S.map(W=>({turnServerURL:W.address,tcpport:W.tcpport||nr.tcpport,udpport:W.udpport||nr.udpport,username:N,password:k,forceturn:!1,security:!0}));D.push(...x)}return t.turnServer={mode:"manual",servers:D},{gatewayInfo:g}}return await Ww(t,e,n,r)}const{proxyInfo:l,gatewayInfo:u}=await wM(t,e,n,r),h={gatewayInfo:u},p=l.map(g=>({turnServerURL:g.address,tcpport:a==="proxy3"?void 0:g.tcpport?g.tcpport:nr.tcpport,udpport:a==="proxy4"?void 0:g.udpport?g.udpport:nr.udpport,username:g.username||nr.username,password:g.password||nr.password,forceturn:a!=="proxy4",security:a==="proxy5"}));if(r.useP2P){var m;const g=(m=t.uid)!==null&&m!==void 0?m:u.uid,S="glb:".concat(g.toString()),D=await UA(S),w=l.map(N=>({turnServerURL:N.address,tcpport:a==="proxy3"?void 0:N.tcpport||nr.tcpport,udpport:a==="proxy4"?void 0:N.udpport||nr.udpport,username:S,password:D,forceturn:a!=="proxy4",security:a==="proxy5"}));p.push(...w)}return t.turnServer={mode:"manual",servers:p},T.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(a)),h}async function CM(t,e,n,i,r){const a=B("ACCOUNT_REGISTER").slice(0,B("AJAX_REQUEST_CONCURRENT"));let c=[];c=e.proxyServer?a.map(u=>"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1")):a.map(u=>"https://".concat(u,"/api/v1"));const l=r==null?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const u=await async function(h,p,m,g,S){const D=Date.now(),w={sid:m.sid,opid:10,appid:m.appId,string_uid:p};let N=h[0];const k=await fc(()=>Sc(N+"".concat(N.indexOf("?")===-1?"?":"&","action=stringuid"),{data:w,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(x,W)=>{if(x.code===0){if(x.uid<=0||x.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(p," => ").concat(x.uid),x),Jt.reqUserAccount(w.sid,{lts:D,success:!1,serverAddr:N,stringUid:w.string_uid,uid:x.uid,errorCode:M.INVALID_UINT_UID_FROM_STRING_UID,extend:w}),new nt(M.INVALID_UINT_UID_FROM_STRING_UID);return Jt.reqUserAccount(w.sid,{lts:D,success:!0,serverAddr:N,stringUid:w.string_uid,uid:x.uid,errorCode:null,extend:w}),!1}const Z=$E(x.code);return Z.retry&&(N=h[(W+1)%h.length]),Jt.reqUserAccount(w.sid,{lts:D,success:!1,serverAddr:N,stringUid:w.string_uid,uid:x.uid,errorCode:Z.desc,extend:w}),Z.retry},(x,W)=>x.code!==M.OPERATION_ABORTED&&(Jt.reqUserAccount(w.sid,{lts:D,success:!1,serverAddr:N,stringUid:w.string_uid,uid:null,errorCode:x.code,extend:w}),N=h[(W+1)%h.length],!0),S);if(k.code!==0){const x=$E(k.code);throw new nt(M.UNEXPECTED_RESPONSE,x.desc)}return k}(c,t,e,n,i);return r==null||r.recordJoinChannelService({status:"success",endTs:Date.now()},l),u.uid}catch(u){throw r==null||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[u]},l),u}}async function FH(t,e,n){const i=B("ACCOUNT_REGISTER");let r=[];r=e.proxyServer?i.map(a=>"https://".concat(e.proxyServer,"/ap/?url=").concat(a+"/api/v1")):i.map(a=>"https://".concat(a,"/api/v1"));try{return await bM({referenceList:r,asyncMapHandler:c=>async function(l,u,h,p){const m=Date.now(),g={sid:h.sid,opid:10,appid:h.appId,string_uid:u};try{const S=await Sc(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:g,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(S.code!==0){const D=$E(S.code);throw new nt(M.UNEXPECTED_RESPONSE,"preload sua error:".concat(D.desc),D)}if(S.uid<=0||S.uid>=Math.pow(2,32))throw new nt(M.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:m,url:l,req:g,uid:S.uid,elapse:Date.now()-m}}catch(S){throw S}}(c,t,e,n),closeFn:c=>c.code===M.OPERATION_ABORTED||c.code===M.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(a){throw a}}async function GH(t,e,n){const i=B("CDS_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1"):"https://".concat(u,"/api/v1?action=config")),r=i.map(u=>function(h,p,m,g){const S=Ge(),D={flag:64,cipher_method:0,features:El(El(El(El(El({install_id:qA(),device:S.name,system:S.os,system_general:navigator.userAgent,vendor:p.appId,version:La,cname:p.cname,session_id:p.sid,proxyServer:p.proxyServer,sdk_type:PH.WEB_RTC,browser_name:S.name,browser_version:S.version,user_agent:navigator.userAgent,channel_name:p.cname},p.stringUid&&{string_uid:p.stringUid}),p.uid&&{uid:p.uid+""}),S.os&&{os_name:S.os}),S.osVersion&&{os_version:S.osVersion}),{},{detail:""})};return fc(()=>Sc(h,{data:D,timeout:1e3,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,w=>w.code!==M.OPERATION_ABORTED,g)}(u,t,e,n));let a=null,c=null,l={};try{a=await r_(r)}catch(u){if(u.code===M.OPERATION_ABORTED)throw u;c=u}if(r.forEach(u=>u.cancel()),Jt.reportApiInvoke(t.sid,{name:ui.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:a}}).onSuccess(),a&&a.test_tags)try{l=function(u){if(!u.test_tags)return{};const h=u.test_tags,p=Object.keys(h),m={};return p.forEach(g=>{var S;const D=Lr(S=g.slice(4)).call(S),w=JSON.parse(h[g]),N=w[1];m[D]={tag:w[0]||"",value:N}}),m}(a)}catch{}return l}async function AM(t,e){const n=B("WEBCS_DOMAIN").concat(B("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:sy(),serviceIds:[ai.CHOOSE_SERVER,ai.CLOUD_PROXY_FALLBACK]}));try{return await bM({referenceList:n,asyncMapHandler:r=>async function(a,c,l){let u,{url:h,areaCode:p,serviceIds:m}=a;const g=Date.now(),[S,D]=Hw(c,p,m);let w=si.networkState;try{w&&si.networkState===Hs.OFFLINE&&si.onlineWaiter&&await wt.race([si.onlineWaiter,Hi(hi.maxRetryTimeout)]),w=si.networkState;const{data:N,headers:k}=await Sc(h,{data:S,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=k.http3==="1"?1:-1,($=>{const q=[];if($.response_body.forEach(ot=>{const _t=ot.buffer.code;if(ot.uri===23&&_t===0&&!ot.buffer.edges_services)if(ot.buffer.flag===4194310)ot.buffer.edges_services=[];else{const Nt={error:new nt(M.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:$.detail[502]}),flag:ot.buffer.flag};q.push(Nt)}if(_t!==0){const Nt=$E(_t),Mt={error:new nt(M.CAN_NOT_GET_GATEWAY_SERVER,Nt.desc,{desc:Nt.desc,retry:Nt.retry,csIp:$.detail[502]}),flag:ot.buffer.flag};ot.buffer.flag===4194310?T.warning(Mt.error.toString()):q.push(Mt)}}),q.length)throw new nt(M.CAN_NOT_GET_GATEWAY_SERVER,q.map(ot=>"flag: ".concat(ot.flag,", message: ").concat(ot.error.message)).join(" | "),{retry:!!q.find(ot=>ot.error.data.retry),csIp:$.detail[502],desc:[...new Set(q.map(ot=>{var _t;return ot==null||(_t=ot.error)===null||_t===void 0||(_t=_t.data)===null||_t===void 0?void 0:_t.desc}).filter(ot=>!!ot))]})})(N);const W=ey(N,ai.CHOOSE_SERVER),Z=ey(N,ai.CLOUD_PROXY_FALLBACK);return Gw(W),{gatewayInfo:Dw(W,h),proxyInfo:Z,opid:D,requestTime:g,url:h,isHttp3:u,elapse:Date.now()-g}}catch(N){throw N}}(r,t,e),closeFn:r=>r.code===M.OPERATION_ABORTED||r.code===M.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(i){throw i}}async function wM(t,e,n,i){const r=B("PROXY_SERVER_TYPE3"),a=(S,D,w)=>{let N=w||r;return Array.isArray(N)&&(N=D%2==0?r[1]:r[0]),"https://".concat(N,"/ap/?url=").concat(S)};let c=null;const l=[],u=async()=>{const S=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map((N,k)=>{let x;return x=t.cloudProxyServer==="disabled"&&t.proxyServer?a("".concat(N,"/api/v2/transpond/webrtc?v=2"),k,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):a("".concat(N,"/api/v2/transpond/webrtc?v=2"),k),{url:x,areaCode:sy(),serviceIds:[ai.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?ai.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?ai.CLOUD_PROXY:ai.CLOUD_PROXY_FALLBACK]}}),D=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(N=>N.url)}),w=await ay({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:N=>(T.debug("[".concat(t.clientId,"] Connect to choose_server:"),N.url),TM(N,t,e,n)),allFailedhandler:N=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},D),N[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},D),w},h=async()=>{if(await Hi(1e3),c!==null)return c;const S=B("WEBCS_DOMAIN_BACKUP_LIST").map((N,k)=>{let x;return x=t.cloudProxyServer==="disabled"&&t.proxyServer?a("".concat(N,"/api/v2/transpond/webrtc?v=2"),k,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):a("".concat(N,"/api/v2/transpond/webrtc?v=2"),k),{url:x,areaCode:sy(),serviceIds:[ai.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?ai.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?ai.CLOUD_PROXY:ai.CLOUD_PROXY_FALLBACK]}}),D=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:S.map(N=>N.url)}),w=await ay({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:N=>(T.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),N.url),TM(N,t,e,n)),allFailedhandler:N=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},D),N[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},D),w};let p,m,g;try{({gatewayInfo:p,proxyInfo:m,url:g}=await r_([u(),h()]))}catch(S){throw S[0]}if(l.length&&l.forEach(S=>S.cancel&&typeof S.cancel=="function"&&S.cancel()),!p||!m)throw new nt(M.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=g,t.cloudProxyServer!=="disabled"&&Array.isArray(r)&&g){const S=/^https?:\/\/(.+?)(\/.*)?$/.exec(g)[1];At(r).call(r,S)&&(t.proxyServer=S,T.setProxyServer(S),Jt.setProxyServer(S))}return c={gatewayInfo:p,proxyInfo:await Qx(m,p.uid)},c}async function HH(t,e,n){const i=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(a=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap")),r=i.map(a=>function(c,l,u,h){const p={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:La,cname:l.cname,uid:l.uid.toString(),requestId:Fw,seq:Fw};Fw+=1;const m={service_name:"tele_channel",json_body:JSON.stringify(p)};return fc(async()=>{const g=await Sc(c,{data:m,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(g.code!==0){const D=new nt(M.UNEXPECTED_RESPONSE,"cross channel ap error, code"+g.code,{retry:!0});throw T.error(D.toString()),D}const S=JSON.parse(g.json_body);if(S.code!==200){const D=new nt(M.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(S.code,", reason: ").concat(S.reason));throw T.error(D.toString()),D}if(!S.servers||S.servers.length===0){const D=new nt(M.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(D.toString()),D}return{vid:S.vid,workerToken:S.workerToken,addressList:(B("CHANNEL_MEDIA_RELAY_SERVERS")||S.servers).map(D=>"wss://".concat(D.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(D.wss))}},void 0,g=>!!(g.code!==M.OPERATION_ABORTED&&g.code!==M.UNEXPECTED_RESPONSE||g.data&&g.data.retry),h)}(a,t,e,n));try{const a=await r_(r);return r.forEach(c=>c.cancel()),a}catch(a){throw a[0]}}async function WH(t,e,n){let i=null;const r=[],a=async c=>{const l=B(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v2/transpond/webrtc?v=2"):"https://".concat(u,"/api/v2/transpond/webrtc?v=2"));return c&&(await Hi(1e3),i!==null)?i:await ay({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:u=>(T.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),u),function(h,p,m,g){const[S]=BH(p,[ai.CHOOSE_SERVER]);let D=si.networkState;return fc(async()=>{D&&si.networkState===Hs.OFFLINE&&si.onlineWaiter&&await wt.race([si.onlineWaiter,Hi(g&&g.maxRetryTimeout||hi.maxRetryTimeout)]),D=si.networkState;const w=await Sc(h,{data:S,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0);return VH(w,h)},()=>!1,w=>w.code!==M.OPERATION_ABORTED&&(w.code===M.UPDATE_TICKET_FAILED?w.data.retry:(T.warning("[".concat(p.clientId,"] update ticket network error, retry"),w),!0)),g)}(u,t,e,n)),allFailedhandler:u=>{throw u[0]},promisesCollector:r})};try{return i=await r_([a(!1),a(!0)]),r.length&&r.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function IM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Kw(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?IM(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):IM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class KH extends Mn{get isSuccess(){return!!this.configs}constructor(e,n){super(),P(this,"configs",void 0),P(this,"store",void 0),P(this,"joinInfo",void 0),P(this,"cancelToken",void 0),P(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),P(this,"interval",void 0),P(this,"mutex",void 0),P(this,"mutableParamsRead",!1),P(this,"configCache",{}),P(this,"limit_bitrate",void 0),this.mutex=new lr("config-distribute",e),this.store=n}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),B("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},B("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Jt.reportApiInvoke(null,{options:void 0,name:ui.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Fn.TRACER}).onSuccess(JSON.stringify(mc))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await GH(this.joinInfo,this.cancelToken,this.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(e));const i=function(r){var a;const c=wS(a=Object.keys(r).filter(h=>/^webrtc_ng_global_parameter/.test(h))).call(a);for(let h=0;h<c.length;h++)for(let p=c.length-1;p>h;p--){const m=c[p],g=r[m].value;if(typeof g.__priority=="number"){const S=g.__priority,D=c[p-1],w=r[D].value;if(typeof w.__priority=="number"){if(!(S>w.__priority))continue;{const N=m;c[p]=c[p-1],c[p-1]=N}}else{const N=m;c[p]=c[p-1],c[p-1]=N}}}const l=Date.now();let u={};return c.forEach(h=>{const p=r[h].value.__expires;p&&p<=l||(u[h]=r[h])}),u}(e);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const r=new nt(M.NETWORK_RESPONSE_ERROR,i);T.warning("[config-distribute] ".concat(r.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){Vx(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(ZS.UPDATE_BITRATE_LIMIT,e):this.emit(ZS.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&Kw({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const n={},i=Object.keys(e),r=[];i.forEach(a=>{const c=e[a].value;n[a]=c;const l=c.__id;if(l&&this.configCache[a]&&this.configCache[a].__id===l)return;const u=c.__type,h=e[a].value,p=e[a].tag;let m=0;u?u===fk.REALTIME&&(m=1):Object.keys(h).some(g=>Object.prototype.hasOwnProperty.call(ZA,g)||!Tw()&&Object.prototype.hasOwnProperty.call(Mb,g)?(m=1,!0):void 0),r.push({tag:p,isApplied:m,feature:a,params:JSON.stringify(c)})}),r.forEach(a=>{let{tag:c,feature:l,params:u,isApplied:h}=a;this.store.sessionId&&Jt.abTest(this.store.sessionId,{intSucc:1,isApplied:h,tag:c,feature:l,params:u,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){T.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(e){const n=function(r){const a={};return Object.keys(r).forEach(c=>{const l=r[c].value,u=l.__expires,h=l.__type;Object.keys(l).forEach(p=>{p==="__id"||p==="__type"||p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(a,p)||(a[p]=Kw(Kw({value:l[p]},u&&{expires:u}),h&&{type:h}))})}),a}(e);try{var i;const r=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,r&&Vx(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(e),function(l){try{const u=Date.now();Object.keys(l).forEach(h=>{const{value:p,type:m,expires:g}=l[h];g&&g<=u||((m===fk.REALTIME||Object.prototype.hasOwnProperty.call(ZA,h))&&(mc[h]=p,An[h]=p,T.debug("Update realtime parameters from config distribute",h,p)),m||Tw()||!Object.prototype.hasOwnProperty.call(Mb,h)||(mc[h]=p,An[h]=p,T.debug("Update gateway parameters from config distribute",h,p)))})}catch(u){T.error("Error update config immediately: ".concat(l),u.message)}}(n);const a=JSON.stringify(n),c=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",c),T.debug("Caching global parameters ".concat(a))}catch(r){T.error("Error caching global parameters:",r.message)}}handleGlobalParameterConfig(e){try{const n=Date.now();Object.keys(e).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(An,i)){const{value:r,expires:a}=e[i];if(a&&a<=n)return;(function(c,l){try{return typeof c=="object"&&typeof l=="object"&&JSON.stringify(c)===JSON.stringify(l)}catch{return!1}})(An[i],r)||(mc[i]=r,An[i]=r,this.emit(ZS.UPDATE_CLIENT_ROLE_OPTIONS,r),T.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(n){T.error("Error handling global parameter config:",n.message)}}}class zH extends Mn{constructor(){super(...arguments),P(this,"resultStorage",new Map)}setLocalAudioStats(e,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(e,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i))}setRemoteAudioStats(e,n){const i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(e,n,i){if(B("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(i),r.result.length>=5)){var a;const c=At(a=r.result).call(a,!0);r.isPrevNormal&&!c&&this.emit("exception",OM[e],e,n),!r.isPrevNormal&&c&&this.emit("exception",OM[e]+2e3,e+"_RECOVER",n),r.isPrevNormal=c,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof _i&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=Ws(n._encoderConfig.frameRate));const r=e.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof _i&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const OM={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},hr=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function NM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function df(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?NM(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):NM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class oy{constructor(e){P(this,"store",void 0),P(this,"onStatsException",void 0),P(this,"onUploadPublishDuration",void 0),P(this,"onStatsChanged",void 0),P(this,"localStats",new Map),P(this,"remoteStats",new Map),P(this,"updateStatsInterval",void 0),P(this,"trafficStats",void 0),P(this,"trafficStatsPeerList",[]),P(this,"uplinkStats",void 0),P(this,"exceptionMonitor",void 0),P(this,"p2pChannel",void 0),P(this,"scalabilityMode",xb.L1T1),P(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new zH,this.exceptionMonitor.on("exception",(n,i,r)=>{this.onStatsException&&this.onStatsException(n,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Et.LocalAudioTrack)||df({},iw)}getLocalVideoTrackStats(){return this.localStats.get(Et.LocalVideoTrack)||df({},rw)}getRemoteAudioTrackStats(e){const n=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(u=>u.peer_uid===a);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const a=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.audioStats;a&&(i[e]=n(e,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{audioStats:l}]=a;l&&(i[c]=n(c,l))});return i}getRemoteNetworkQualityStats(e){const n={};if(e){var i;const r=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;r&&(n[e]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[a,{networkStats:c}]=r;c&&(n[a]=c)});return n}getRemoteVideoTrackStats(e){const n=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(u=>u.peer_uid===a);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const a=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.videoStats;a&&(i[e]=n(e,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{videoStats:l}]=a;l&&(i[c]=n(c,l))});return i}getRTCStats(){let e=0,n=0,i=0,r=0;const a=this.localStats.get(Et.LocalAudioTrack);a&&(e+=a.sendBytes,n+=a.sendBitrate);const c=this.localStats.get(Et.LocalVideoTrack);c&&(e+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(Et.LocalVideoLowTrack);l&&(e+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(h=>{let{audioStats:p,videoStats:m}=h;p&&(i+=p.receiveBytes,r+=p.receiveBitrate),m&&(i+=m.receiveBytes,r+=m.receiveBitrate)});let u=1;return this.trafficStats&&(u+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:u,SendBitrate:n,SendBytes:e,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const r=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),a=r!=null&&r.videoSSRC?hr.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,c=r!=null&&r.audioSSRC?hr.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,a>c?a:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,i){if(!e)return!1;const r=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,a=!i||n.framesDecodeCount>i.framesDecodeCount;return r||!a}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[i,r]=n;switch(i){case Et.LocalVideoTrack:case Et.LocalVideoLowTrack:{const c=r,l=df({},rw),u=e.getStats(),h=e.getLocalMedia(i);if(u){const p=u.videoSend.find(m=>m.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(p){const m=e.getLocalVideoSize(),g=e.getEncoderConfig(Et.LocalVideoTrack);p.codec!=="H264"&&p.codec!=="H265"&&p.codec!=="VP8"&&p.codec!=="VP9"&&p.codec!=="AV1X"&&p.codec!=="AV1"||(l.codecType=p.codec),l.sendBytes=p.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,p.inputFrame?(l.captureFrameRate=p.inputFrame.frameRate,l.captureResolutionHeight=p.inputFrame.height,l.captureResolutionWidth=p.inputFrame.width):m&&(l.captureResolutionWidth=m.width,l.captureResolutionHeight=m.height),p.sentFrame?(l.sendFrameRate=p.sentFrame.frameRate,l.sendResolutionHeight=p.sentFrame.height,l.sendResolutionWidth=p.sentFrame.width):m&&(l.sendResolutionWidth=m.width,l.sendResolutionHeight=m.height),p.avgEncodeMs&&(l.encodeDelay=p.avgEncodeMs),g&&g.bitrateMax&&(l.targetSendBitrate=1e3*g.bitrateMax),l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(p)&&(l.totalFreezeTime+=1),p.scalabilityMode&&this.scalabilityMode!==p.scalabilityMode&&(T.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(p.scalabilityMode)),this.scalabilityMode=p.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var a;this.localStats.set(i,l),((c==null?void 0:c.sendResolutionWidth)!==l.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==l.sendResolutionHeight)&&((a=this.onStatsChanged)===null||a===void 0||a.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&h&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,h.track,l);break}case Et.LocalAudioTrack:{const c=r,l=df({},iw),u=e.getStats(),h=e.getLocalMedia(i);if(u){const p=u.audioSend.find(m=>m.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(p){if(p.codec!=="opus"&&p.codec!=="aac"&&p.codec!=="PCMU"&&p.codec!=="PCMA"&&p.codec!=="G722"||(l.codecType=p.codec),p.inputLevel)l.sendVolumeLevel=Math.round(32767*p.inputLevel);else{const m=e.getLocalAudioVolume();m&&(l.sendVolumeLevel=Math.round(32767*m))}l.sendBytes=p.bytes,l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Et.LocalAudioTrack,l),l&&h&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,h.track,l);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var i,r;let[a,{videoStats:c,audioStats:l,videoPcStats:u}]=n;const h=l,p=c,m=u,g=df({},Ck),S=df({},Ak),D=df({},NG),{audioTrack:w,videoTrack:N,audioSSRC:k,videoSSRC:x}=e.getRemoteMedia(a);let W;W=this.store.useP2P?e.getStats(!0):e.getStats();const Z=(i=W)===null||i===void 0?void 0:i.audioRecv.find(_t=>_t.ssrc===k),$=(r=W)===null||r===void 0?void 0:r.videoRecv.find(_t=>_t.ssrc===x),q=this.trafficStats&&this.trafficStats.peer_delay.find(_t=>_t.peer_uid===a);if(Z&&(Z.codec!=="opus"&&Z.codec!=="aac"&&Z.codec!=="PCMU"&&Z.codec!=="PCMA"&&Z.codec!=="G722"||(g.codecType=Z.codec),Z.outputLevel?g.receiveLevel=Math.round(32767*Z.outputLevel):w&&(g.receiveLevel=Math.round(32767*w.getVolumeLevel())),g.receiveBytes=Z.bytes,g.receivePackets=Z.packets,g.receivePacketsLost=Z.packetsLost,g.receivePacketsDiscarded=Z.packetsDiscarded,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost),g.receiveBitrate=h?8*Math.max(0,g.receiveBytes-h.receiveBytes):0,g.totalDuration=h?h.totalDuration+1:1,g.totalFreezeTime=h?h.totalFreezeTime:0,g.freezeRate=g.totalFreezeTime/g.totalDuration,g.receiveDelay=Z.jitterBufferMs,g.totalDuration>10&&oy.isRemoteAudioFreeze(w)&&(g.totalFreezeTime+=1)),$){var ot;$.codec!=="H264"&&$.codec!=="H265"&&$.codec!=="VP8"&&$.codec!=="VP9"&&$.codec!=="AV1X"&&$.codec!=="AV1"||(S.codecType=$.codec),S.receiveBytes=$.bytes,S.receiveBitrate=p?8*Math.max(0,S.receiveBytes-p.receiveBytes):0,S.decodeFrameRate=$.decodeFrameRate<0?0:$.decodeFrameRate,S.renderFrameRate=$.decodeFrameRate<0?0:$.decodeFrameRate,$.outputFrame&&(S.renderFrameRate=$.outputFrame.frameRate),$.receivedFrame?(S.receiveFrameRate=$.receivedFrame.frameRate,S.receiveResolutionHeight=$.receivedFrame.height,S.receiveResolutionWidth=$.receivedFrame.width):N&&(S.receiveResolutionHeight=N._videoHeight||0,S.receiveResolutionWidth=N._videoWidth||0),$.framesRateFirefox!==void 0&&(S.receiveFrameRate=Math.round($.framesRateFirefox)),S.receivePackets=$.packets,S.receivePacketsLost=$.packetsLost,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost);const _t=p?p.totalFreezeTime:0,Nt=p?p.totalDuration:0;S.totalDuration=p?p.totalDuration+1:1,S.totalFreezeTime=(ot=$.totalFreezesDuration)!==null&&ot!==void 0?ot:_t||0,S.receiveDelay=$.jitterBufferMs||0;const Mt=!!x&&e.getRemoteVideoIsReady(x);$.totalFreezesDuration===void 0&&N&&Mt&&oy.isRemoteVideoFreeze(N,$,m)&&(S.totalFreezeTime+=1),S.freezeRate=Math.max(0,Math.min((S.totalFreezeTime-_t)/(S.totalDuration-Nt),1))}q&&(g.end2EndDelay=q.B_ad,S.end2EndDelay=q.B_vd,g.transportDelay=q.B_ed,S.transportDelay=q.B_ed,g.currentPacketLossRate=q.B_ealr4/100,S.currentPacketLossRate=q.B_evlr4/100,D.uplinkNetworkQuality=q.B_punq?q.B_punq:0,D.downlinkNetworkQuality=q.B_pdnq?q.B_pdnq:0),this.remoteStats.set(a,{audioStats:g,videoStats:S,videoPcStats:$,networkStats:D}),w&&this.exceptionMonitor.setRemoteAudioStats(w,g),N&&this.exceptionMonitor.setRemoteVideoStats(N,S)})}}class DM{constructor(){P(this,"destChannelMediaInfos",new Map),P(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){Ux(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){Ux(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){eR(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function LM(t){if(!(t instanceof DM))return new nt(M.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new nt(M.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new nt(M.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class $u{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){P(this,"uid",void 0),P(this,"_uintid",void 0),P(this,"_trust_in_room_",!0),P(this,"_trust_audio_enabled_state_",!0),P(this,"_trust_video_enabled_state_",!0),P(this,"_trust_audio_mute_state_",!0),P(this,"_trust_video_mute_state_",!0),P(this,"_audio_muted_",!1),P(this,"_video_muted_",!1),P(this,"_audio_enabled_",!0),P(this,"_video_enabled_",!0),P(this,"_audio_added_",!1),P(this,"_video_added_",!1),P(this,"_is_pre_created",!1),P(this,"_video_pre_subscribed",!1),P(this,"_audio_pre_subscribed",!1),P(this,"_trust_video_stream_added_state_",!0),P(this,"_trust_audio_stream_added_state_",!0),P(this,"_audioTrack",void 0),P(this,"_videoTrack",void 0),P(this,"_dataChannels",[]),P(this,"_audioSSRC",void 0),P(this,"_videoSSRC",void 0),P(this,"_audioOrtc",void 0),P(this,"_videoOrtc",void 0),P(this,"_cname",void 0),P(this,"_rtxSsrcId",void 0),P(this,"_videoMid",void 0),P(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}function PM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function kM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?PM(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):PM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const cy="9",xM=4e4;function MM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ad(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?MM(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):MM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var s_=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(s_||{});const mR=new Map;function UM(t,e,n,i){let{scale:r}=t;if(r===0&&i===s_.UP||r>=e.length-1&&i===s_.DOWN)return t;let a=Ad(Ad({},t),{},{scale:i===s_.DOWN?++r:--r});switch(n){case"maintain-framerate":a=Ad(Ad({},a),e[r].motion);break;case"maintain-resolution":a=Ad(Ad({},a),e[r].detail);break;case"balanced":a=Ad(Ad({},a),e[r].balanced)}return a}function jM(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:VM(e)};mR.set(t,n)}else mR.delete(t)}function VM(t){const e=Ad({},t),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:r,bitrateMin:a}=e,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:u,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:m,BWE_SCALE_DOWN_THRESHOLD:g,PERF_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_UP_THRESHOLD:D,BALANCE_BITRATE_FACTOR:w,BALANCE_FRAMERATE_FACTOR:N,BALANCE_RESOLUTION_FACTOR:k,MOTION_RESOLUTION_FACTOR:x,MOTION_BITRATE_FACTOR:W,DETAIL_FRAMERATE_FACTOR:Z,DETAIL_BITRATE_FACTOR:$}=JA,q=Math.min(e.frameRate,l),ot=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(g,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(S,1)*q),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:a},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:a},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:a}}];for(let _t=1;_t<=u;_t++){const Nt={bwe_up:Math.round(Math.pow(m,_t)*n),bwe_down:Math.round(Math.pow(g,_t+1)*n),fps_up:Math.round(Math.pow(D,_t)*q),fps_down:Math.round(Math.pow(S,_t+1)*q)},Mt={scaleResolutionDownBy:r/Math.pow(k,_t),frameRate:Math.max(Math.round(Math.pow(N,_t)*i),c),bitrateMax:Math.max(Math.round(Math.pow(w,_t)*n),p),bitrateMin:Math.max(Math.round(Math.pow(w,_t)*a),h)},ke={scaleResolutionDownBy:r/Math.pow(x,_t),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(W,_t)*n),p),bitrateMin:Math.max(Math.round(Math.pow(W,_t)*a),h)},xe={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Z,_t)*i),c),bitrateMax:Math.max(Math.round(Math.pow($,_t)*n),p),bitrateMin:Math.max(Math.round(Math.pow($,_t)*a),h)};ot.push({scale:_t,threshold:Nt,balanced:Mt,motion:ke,detail:xe})}return ot}function YH(t,e,n,i,r,a){const c=mR.get(t)||{overUse:0,underUse:0,adaptationList:VM(r)},{adaptationList:l}=c;mR.set(t,c);const{OVERUSE_TIMES_THRESHOLD:u,UNDERUSE_TIMES_THRESHOLD:h}=JA,{scale:p}=i;let m,g;return typeof e=="number"&&e>0&&function(S,D,w,N){if(D>=w.length)return!1;let{threshold:{fps_down:k}}=w[D];return B("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(k=w[0].threshold.fps_down),S<k}(e,p,l,a)&&(c.overUse++,g=zS.CPU,c.overUse>u)||typeof n=="number"&&n>0&&function(S,D,w){if(D>=w.length)return!1;const{threshold:{bwe_down:N}}=w[D];return S<N}(n,p,l)&&(c.overUse++,g=zS.BANDWIDTH,c.overUse>u)?(c.overUse=0,c.underUse=0,m=UM(i,l,a,s_.DOWN),[m,g]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(S,D,w,N){if(D===0)return;let{threshold:{fps_up:k}}=w[D];return B("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(k=w[1].threshold.fps_up),S>k}(e,p,l,a)&&function(S,D,w){if(D===0)return;const{threshold:{bwe_up:N}}=w[D];return S>N}(n,p,l)&&(c.underUse++,c.underUse>h&&(c.overUse=0,c.underUse=0,m=UM(i,l,a,s_.UP),m.scale===0&&(g=zS.NONE))),[m,g])}function BM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function zw(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?BM(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):BM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function qH(t){var e;return!!B("ENABLE_AG_ADAPTATION")&&!!(t instanceof pw||At(e=t._hints).call(e,_n.CUSTOM_TRACK))&&(!!B("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const i=Ge();if(i.os!==Ai.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return Number(r[0])>=n}(14)&&MP(17,4)||xP(14)&&UP(17,4,!0)))}const ER=new Map;function _R(t,e){const n=ER.get(t);if(n){const{timer:i}=n;window.clearTimeout(i),ER.delete(t)}e.qualityLimitationReason=zS.NONE,jM(t)}function XH(t,e){var n;let i;switch(e){case Et.LocalAudioTrack:i=tn.Audio;break;case Et.LocalVideoTrack:i=At(n=t._hints).call(n,_n.SCREEN_TRACK)?tn.Screen:tn.High;break;case Et.LocalVideoLowTrack:i=tn.Low}return i}function Yw(t){const e=Ke();if(t.some(n=>n._bypassWebAudio))throw new ct(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new ct(M.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function qw(t,e){Yw(t);const n=new _i;return t.forEach(i=>n.addAudioTrack(i)),n}const JH=!Ke().supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&Ed();function gR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return JH?(n={spec:e,store:t},Rd("PlanBConnection").create(n)):new _l(e,t)}function Xw(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function FM(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(HS(t.turnServer.servers))return!1;if(B("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var Be;function GM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function yc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?GM(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):GM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let _l=(Be=class Af extends Fx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return At(n=Object.keys(Ub)).call(n,e)}))]}constructor(e,n){super(e,n),P(this,"id",En(5,"connection-")),P(this,"store",void 0),P(this,"peerConnection",void 0),P(this,"forceTurn",!1),P(this,"remoteSDP",void 0),P(this,"initialOffer",void 0),P(this,"transportEventReceiver",void 0),P(this,"statsFilter",void 0),P(this,"extension",{useXR:B("USE_XR")}),P(this,"localCapabilities",void 0),P(this,"remoteCodecs",void 0),P(this,"localCandidateCount",0),P(this,"allCandidatesReceived",!1),P(this,"isPreallocation",!1),P(this,"preSSRCMap",new Map),P(this,"dataStreamChannelMap",new Map),P(this,"establishPromise",void 0),P(this,"recoveredDataChannelIds",[]),P(this,"currentDataChannelId",1),P(this,"supportAV1RtpSpec",!1),P(this,"mutex",void 0),P(this,"qualityLimitationReason",zS.NONE),P(this,"isFirstConnected",!1),this.store=n,this.forceTurn=FM(e),this.mutex=new lr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Af.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=YA(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,Vn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const n=this.preSSRCMap.get(e);if(n!==void 0){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);if(i)return{transceiver:i,track:i.receiver.track,id:n}}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const a=this.remoteSDP.toString();r==null||r(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Qu(i.sdp),a=await oM({filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterVideoCodec:B("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=dR(a),this.initialOffer=i,B("ENABLE_SVC")&&this.store.codec=="av1"){const l=await async function(){try{const u=new RTCPeerConnection;u.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:xb.L1T3}]});const h=await u.createOffer();if(!h.sdp)return void u.close();const p=ys(h.sdp).mediaDescriptions[0];if(!p)return;const m=p.attributes.extmaps.find(g=>g.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return u.close(),m}catch{return}}();var e;l&&(this.supportAV1RtpSpec=!0,(e=a.send)===null||e===void 0||e.videoExtensions.push(l))}let c;return i.sdp&&uM(i.sdp)&&(c=Gn(a),(n=c).send&&(t_(Bt.VIDEO,n.send.videoExtensions),t_(Bt.AUDIO,n.send.audioExtensions)),n.recv&&(t_(Bt.VIDEO,n.recv.videoExtensions),t_(Bt.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(t_(Bt.VIDEO,n.sendrecv.videoExtensions),t_(Bt.AUDIO,n.sendrecv.audioExtensions))),yc(yc({},r),{},{rtpCapabilities:c||a,offerSDP:i.sdp})}catch(i){throw new ct(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&uM(this.initialOffer.sdp)&&(n=e.rtpCapabilities,i=this.localCapabilities,n.send&&(oR(Bt.VIDEO,n.send.videoExtensions,i.send.videoExtensions),oR(Bt.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(oR(Bt.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),oR(Bt.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Gn(this._localCapabilities)}get rtpCapabilities(){return Gn(this._rtpCapabilities)}get candidates(){return Gn(this._candidates)}get iceParameters(){return Gn(this._iceParameters)}get dtlsParameters(){return Gn(this._dtlsParameters)}constructor(h){let p=arguments.length>1&&arguments[1]!==void 0&&arguments[1];P(this,"sessionDesc",void 0),P(this,"_localCapabilities",void 0),P(this,"_rtpCapabilities",void 0),P(this,"_candidates",void 0),P(this,"_originCandidates",void 0),P(this,"_iceParameters",void 0),P(this,"_isUseExtmapAllowMixed",void 0),P(this,"_dtlsParameters",void 0),P(this,"setup",void 0),P(this,"currentMidIndex",void 0),P(this,"cname",void 0),P(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=p,h=Gn(h);const{iceParameters:m,dtlsParameters:g,candidates:S,rtpCapabilities:D,setup:w,localCapabilities:N,cname:k}=h;this._rtpCapabilities=D,this._candidates=S,this._originCandidates=Gn(S),this._iceParameters=m,this._dtlsParameters=g,this._localCapabilities=N,this.setup=w,this.cname=k,this.sessionDesc=this.updateRemoteRTPCapabilities(D),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(h){const p=this.candidates,m=this.dtlsParameters,g=this.iceParameters,S=this.rtpCapabilities.send;let D=this.sessionDesc.mediaDescriptions.length-1;for(let w=1;w<h;w++){const N=2*w+2e4,k=2*w+xM,{ssrcs:x,ssrcGroups:W}=lf([{ssrcId:N}],this.cname),{ssrcs:Z,ssrcGroups:$}=lf([{ssrcId:k,rtx:B("USE_SUB_RTX")?k+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:cy,protos:["UDP","TLS","RTP","SAVPF"],fmts:S.videoCodecs.map(q=>q.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:g.iceUfrag,icePwd:g.icePwd,unrecognized:[],candidates:p,extmaps:S.videoExtensions,fingerprints:m.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Z,ssrcGroups:$,rtcpFeedbackWildcards:[],payloads:S.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++D)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:cy,protos:["UDP","TLS","RTP","SAVPF"],fmts:S.audioCodecs.map(q=>q.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:g.iceUfrag,icePwd:g.icePwd,unrecognized:[],candidates:p,extmaps:S.audioExtensions,fingerprints:m.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:x,ssrcGroups:W,rtcpFeedbackWildcards:[],payloads:S.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++D)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return zu(this.sessionDesc)}send(h,p,m,g){const{ssrcs:S,ssrcGroups:D}=lf(p,this.cname,B("SYNC_GROUP")?m:void 0),w=this.findPreloadMediaDesc(S);if(w){if(Vn()&&this.firefoxSsrcMidMap.set(S[0].ssrcId,w.attributes.mid),g&&(g.twcc||g.remb)){const N=this.sessionDesc.mediaDescriptions.indexOf(w);return this.sessionDesc.mediaDescriptions[N]=this.mungSendMediaDesc(w,g),{mid:w.attributes.mid,needExchangeSDP:!0}}return{mid:w.attributes.mid,needExchangeSDP:!1}}{const N=this.findAvailableMediaIndex(h,S);let k;return N===-1||N===1&&($i()||function(){const x=Ge();return!(x.name!==Ye.CHROME||!x.osVersion)&&Number(x.version)<=90}()||B("ENABLE_ENCODED_TRANSFORM")&&md())||N===0&&B("USE_SUB_RTX")||jP()?(k=this.createOrRecycleSendMedia(h,S,D,"sendonly",g),this.updateBundleMids()):(k=Gn(this.sessionDesc.mediaDescriptions[N]),k.attributes.direction="sendonly",k.attributes.ssrcs=S,k.attributes.ssrcGroups=D,this.sessionDesc.mediaDescriptions[N]=this.mungSendMediaDesc(k,g)),Vn()&&this.firefoxSsrcMidMap.set(S[0].ssrcId,k.attributes.mid),{mid:k.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:h,needExchangeSDP:p}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:h.attributes.mid,needExchangeSDP:p}}batchSend(h){const p=h.map(S=>{let{kind:D,ssrcMsg:w,mslabel:N}=S;return this.send(D,w,N)}),m=[];let g=!1;return p.forEach(S=>{let{mid:D,needExchangeSDP:w}=S;w&&(g=!0),m.push(D)}),{mids:m,needExchangeSDP:g}}stopSending(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>m.attributes.mid&&h.indexOf(m.attributes.mid)!==-1);if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");p.forEach(m=>{m.attributes.mid==="0"||Vn()||jP()?m.attributes.ssrcs=[]:(m.attributes.ssrcs=[],m.attributes.direction="inactive",m.media.port="0")}),this.updateBundleMids()}mute(h){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(h){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}muteRemote(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>At(h).call(h,m.attributes.mid||""));if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="inactive"})}unmuteRemote(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>At(h).call(h,m.attributes.mid||""));if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="recvonly"})}receive(h,p,m,g){h.forEach((S,D)=>{this.createOrRecycleRecvMedia(S,[],"recvonly",p,m,g[D])}),this.updateBundleMids()}stopReceiving(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>h.indexOf(m.attributes.mid)!==-1);if(p.length!==h.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");p.forEach(m=>{m.media.port="0",m.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(h){const p=this.sessionDesc||ys((m=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(m?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var m;this._rtpCapabilities=h;const g=this.rtpCapabilities.send,S=this.localCapabilities.send;for(const D of p.mediaDescriptions){if(D.attributes.iceUfrag=this._iceParameters.iceUfrag,D.attributes.icePwd=this._iceParameters.icePwd,D.attributes.fingerprints=this._dtlsParameters.fingerprints,D.attributes.candidates=this._candidates,D.attributes.setup=this.setup,D.media.mediaType==="application"&&(D.attributes.sctpPort="5000"),D.media.mediaType==="video"){if(g.videoCodecs.length===0){const w=S.videoCodecs.filter(N=>{var k,x;return(k=N.rtpMap)===null||k===void 0?void 0:At(x=k.encodingName.toLowerCase()).call(x,"vp8")})||[S.videoCodecs[0]];D.media.fmts=w.map(N=>N.payloadType.toString(10)),D.attributes.payloads=w,D.attributes.extmaps=[]}else if(D.media.fmts=g.videoCodecs.map(w=>w.payloadType.toString(10)),D.attributes.payloads=g.videoCodecs,D.attributes.extmaps=g.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:w,ssrcGroups:N}=lf([{ssrcId:xM,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);D.attributes.ssrcs=w,D.attributes.ssrcGroups=N}}if(D.media.mediaType==="audio"){if(g.audioCodecs.length===0){const w=S.audioCodecs.filter(N=>{var k,x;return(k=N.rtpMap)===null||k===void 0?void 0:At(x=k.encodingName.toLowerCase()).call(x,"opus")})||[S.audioCodecs[0]];D.media.fmts=w.map(N=>N.payloadType.toString(10)),D.attributes.payloads=w,D.attributes.extmaps=[]}else if(D.media.fmts=g.audioCodecs.map(w=>w.payloadType.toString(10)),D.attributes.payloads=g.audioCodecs,D.attributes.extmaps=g.audioExtensions,n_(D),B("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:w,ssrcGroups:N}=lf([{ssrcId:2e4}],this.cname);D.attributes.ssrcs=w,D.attributes.ssrcGroups=N}}}return this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(h){const p=this._originCandidates.filter(g=>g.transport==="udp"),m=[];if(p.forEach(g=>{m.push(kM(kM({},g),{},{foundation:"tcpcandidate",priority:Number(g.priority)-1+"",transport:"tcp",port:Number(g.port)+90+""}))}),p.length!==0){switch(h){case ur.TCP_RELAY:this._candidates=m;break;case ur.UDP_TCP_RELAY:case ur.RELAY:this._candidates=[...p,...m];break;default:this._candidates=p}for(const g of this.sessionDesc.mediaDescriptions)g.attributes.candidates=this.candidates}}restartICE(h){h=Gn(h),this._iceParameters=h,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=h.iceUfrag,p.attributes.icePwd=h.icePwd})}predictReceivingMids(h){const p=[];for(let m=0;m<h;m++)p.push((this.currentMidIndex+m+1).toString(10));return p}findAvailableMediaIndex(h,p){return this.sessionDesc.mediaDescriptions.findIndex(m=>{const g=m.media.mediaType===h&&m.media.port!=="0"&&(m.attributes.direction==="sendonly"||m.attributes.direction==="sendrecv")&&m.attributes.ssrcs.length===0;if(Vn()){if(g){const S=this.firefoxSsrcMidMap.get(p[0].ssrcId);return!(S||m.attributes.mid!=="0"&&m.attributes.mid!=="1")||!(!S||S!==m.attributes.mid)}return!1}return g})}createOrRecycleDataChannel(){for(const m of this.sessionDesc.mediaDescriptions)if(m.media.mediaType==="application")return{mediaDesc:m,needExchangeSDP:!1};this.currentMidIndex+=1;const h="".concat(this.currentMidIndex),p={media:{mediaType:"application",port:cy,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(h),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(p),{mediaDesc:p,needExchangeSDP:!0}}createOrRecycleRecvMedia(h,p,m,g,S,D){const w=h._mediaStreamTrack.kind,N=this.rtpCapabilities.recv,k=iy(w,N,this.localCapabilities.send,w===Bt.VIDEO?g:S),x=w===Bt.VIDEO?N.videoExtensions:N.audioExtensions;this.currentMidIndex+=1;const W="".concat(this.currentMidIndex);let Z={media:{mediaType:w,port:cy,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.map(q=>q.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:x,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:k,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:m,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(W)}};Z=this.mungRecvMediaDsec(Z,h,D);const $=this.findFirstClosedMedia(w);if($){const q=this.sessionDesc.mediaDescriptions.indexOf($);this.sessionDesc.mediaDescriptions[q]=Z}else this.sessionDesc.mediaDescriptions.push(Z);return Z}updateRemoteCodec(h,p,m){const g=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Z=>Z.rtpMap&&Z.rtpMap.encodingName.toLowerCase()||"").filter(Z=>{var $;return At($=Object.keys(Ub)).call($,Z)}))],S=new Set(p);if(g.every(Z=>S.has(Z)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(p)),!1;const D=this._rtpCapabilities.recv.videoCodecs.filter(Z=>p.some($=>{var q;return At(q=Z.rtpMap&&Z.rtpMap.encodingName.toLowerCase()||"").call(q,$)}));if(D.length===0)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(g," codecs: ").concat(p)),!1;const w=[...new Set(D.map(Z=>Z.rtpMap&&Z.rtpMap.encodingName.toLowerCase()||""))];let N;if(T.debug("updateRemoteCodec, from ".concat(g," to ").concat(w)),h.length===0)N=this.sessionDesc.mediaDescriptions.filter(Z=>Z.media.mediaType==="video"&&Z.attributes.direction==="recvonly");else if(N=this.sessionDesc.mediaDescriptions.filter(Z=>Z.attributes.mid&&At(h).call(h,Z.attributes.mid)&&Z.attributes.direction==="recvonly"),N.length!==h.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(h,", codecs: ").concat(p)),!1;if(B("USE_PUB_RTX")||B("USE_SUB_RTX")){const Z=xw(D,this.rtpCapabilities.recv.videoCodecs);D.push(...Z)}this._rtpCapabilities.recv.videoCodecs=D;const k=this.localCapabilities.send,x=this.rtpCapabilities.recv,W=iy(Bt.VIDEO,x,k,m);return N.forEach(Z=>{const $=W.map(q=>q.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(Z.attributes.mid,", from"),Z.attributes.payloads,"to",W),Z.attributes.payloads=W,Z.media.fmts=$}),!0}createOrRecycleSendMedia(h,p,m,g,S){const D=this.rtpCapabilities.send,w=h===Bt.VIDEO?D.videoCodecs:D.audioCodecs,N=h===Bt.VIDEO?D.videoExtensions:D.audioExtensions;this.currentMidIndex+=1;const k="".concat(this.currentMidIndex);let x={media:{mediaType:h,port:cy,protos:["UDP","TLS","RTP","SAVPF"],fmts:w.map(Z=>Z.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:N,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:w,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:g,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(k)}};x=this.mungSendMediaDesc(x,S);const W=this.findFirstClosedMedia(h);if(W){const Z=this.sessionDesc.mediaDescriptions.indexOf(W);this.sessionDesc.mediaDescriptions[Z]=x}else this.sessionDesc.mediaDescriptions.push(x);return x}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(h=>h.media.port!=="0").map(h=>h.attributes.mid)}mungRecvMediaDsec(h,p,m){const g=Gn(h);return Pw(g),e_(g,p),kw(g,p),sM(g),lR(g,m,this.localCapabilities.send),g}mungSendMediaDesc(h,p){const m=Gn(h);return lR(m,p,this.localCapabilities.recv),n_(m),m}updateRecvMedia(h,p){const m=this.sessionDesc.mediaDescriptions.findIndex(g=>g.attributes.mid===h);if(m!==-1){const g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],p);this.sessionDesc.mediaDescriptions[m]=g}}bumpMid(h){this.currentMidIndex+=h}findFirstClosedMedia(h){return this.sessionDesc.mediaDescriptions.find(p=>Vn()?p.media.port==="0"&&p.media.mediaType===h:p.media.port==="0")}findPreloadMediaDesc(h){return this.sessionDesc.mediaDescriptions.find(p=>{var m;return((m=p.attributes)===null||m===void 0||(m=m.ssrcs[0])===null||m===void 0?void 0:m.ssrcId)===h[0].ssrcId})}getSSRC(h){var p;return(p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h))===null||p===void 0?void 0:p.attributes.ssrcs}}(yc(yc({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),a=lM(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(a||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),c==null||c(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),B("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(B("PRELOAD_MEDIA_COUNT"));const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p)}const{preSSRCs:u}=e;if(Array.isArray(u)&&u.length>0){const{mids:h}=this.remoteSDP.batchSend(u.map(p=>({kind:p.kind,ssrcMsg:[{ssrcId:p.ssrcId,rtx:p.rtx}],mslabel:p.mslabel})));h.forEach((p,m)=>{this.preSSRCMap.set(u[m].ssrcId,p)}),await ry(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var n,i}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=e;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:i}=e;if(Array.isArray(i)&&i.length>0){const{mids:r}=this.remoteSDP.batchSend(i.map(a=>Object.assign({},{kind:a.kind,ssrcMsg:[{ssrcId:a.ssrcId,rtx:a.rtx}],mslabel:a.mslabel})));r.forEach((a,c)=>{this.preSSRCMap.set(i[c].ssrcId,a)})}await ry(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Da(function*(){const a=yield Fe(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=aR();e.forEach(N=>{const k=r.peerConnection.addTransceiver(N._mediaStreamTrack,yc({direction:"sendonly"},N.trackMediaType==="video"&&r.supportAV1RtpSpec&&l?{sendEncodings:[{scalabilityMode:l}]}:{}));c.push(k),N._updateRtpTransceiver(k)}),Vn()&&B("SIMULCAST")===!0&&(yield Fe(r.applySimulcastForFirefox(c,e)));const u=yield Fe(r.peerConnection.createOffer()),h=r.remoteSDP.predictReceivingMids(e.length),p=r.mungSendOfferSDP(u.sdp,e,h),m=ys(p),g=h.map(N=>{const k=m.mediaDescriptions.find(x=>x.attributes.mid===N);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return nM(k,B("USE_PUB_RTX"))});let S;try{S=yield g}catch(N){S=[],r.remoteSDP.receive(e,n,i,S);const k=r.remoteSDP.toString();throw yield Fe(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Fe(r.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield Fe(r.stopSending(h,!0)),N}r.remoteSDP.receive(e,n,i,S);const D=r.remoteSDP.toString(),w=r.logSDPExchange(p,"offer","local","send");return yield Fe(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Fe(r.applySimulcastEncodings(c,e)),yield Fe(r.applySendEncodings(c,e)),w==null||w(D),yield Fe(r.peerConnection.setRemoteDescription({type:"answer",sdp:D})),c.map((N,k)=>{const x=h[k];return{localSSRC:g[k],id:x,transceiver:N}})}catch(c){throw c instanceof ct?c:new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")T.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const a=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof a!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:a,negotiated:!0,ordered:!1,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}n.forEach(a=>{a._updateOriginDataChannel(i)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),T.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else T.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof ct?i:new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof ct?n:new ct(M.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(u=>e.indexOf(u.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(u=>{var h;_R(this.id+u.mid,this),u.direction="inactive",(h=u.stop)===null||h===void 0||h.call(u)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);c&&(await ry(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a,transceiver:l}}catch(a){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(e);return i&&(await ry(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(r=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:r,transceiver:a}})}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(a=>{Array.from(this.preSSRCMap.entries()).some(c=>{let[l,u]=c;if(u===a)return this.preSSRCMap.delete(l),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const a=this.remoteSDP.toString();r==null||r(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const a=this.remoteSDP.toString();r==null||r(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Da(function*(){const i=yield Fe(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Ke().supportPCSetConfiguration,a=B("FORCE_TURN_TCP")||n.forceTurn;if(e===ur.RELAY&&!r)return;if(r&&!a){const m=e===ur.RELAY?"relay":"all",g=n.peerConnection.getConfiguration();g.iceTransportPolicy!==m&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(m,"]")),g.iceTransportPolicy=m,n.peerConnection.setConfiguration(g))}n.remoteSDP.updateCandidates(e);const c=yield Fe(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=Qu(c.sdp),{remoteIceParameters:u}=yield l.iceParameters;n.remoteSDP.restartICE(u);const h=n.remoteSDP.toString(),p=n.logSDPExchange(c.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Fe(n.peerConnection.setLocalDescription(c)),p==null||p(h),yield Fe(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(r){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(ur.TCP_RELAY),await ry(this.peerConnection,this.remoteSDP,this.extension)}catch(n){T.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{_R(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return yc(yc({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new ct(M.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?Vn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:yc(yc({},ul),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:yc(yc({},ul),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var n;const i="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"";T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(e.url||"",", host_candidate:").concat(r)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&(HS(e.turnServer.servers)?n.iceServers=e.turnServer.servers:B("NEW_TURN_MODE")&&n.iceServers?(B("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&n.iceServers.push(...Af.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):n.iceServers.push(...Af.newTurnServerConfigToIceServers(e.turnServer.servers)),B("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):e.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Af.turnServerConfigToIceServers(e.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...Af.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&Ke().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Xu(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!B("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{const r=B("NEW_TURN_MODE");r===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):r===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):r===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Xu(i.turnServerURL),":443?transport=tcp")}):r===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Xu(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var r;n!=null&&n.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,n.state))},n.onerror=r=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in r?r.error:r)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const r=n==null?void 0:n.iceTransport.state;var a;r&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:a}=i.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i,r;if(n||(n=this.peerConnection.getSenders().find(N=>N.track===e._mediaStreamTrack)),!n)return T.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ke().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const a={},c={};switch(e._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;case"balanced":a.degradationPreference="balanced"}const l=function(w,N){return w.getTransceivers().find(k=>k.sender.track===N||k.receiver.track===N)}(this.peerConnection,e._mediaStreamTrack),u=xG(e);if(qH(e)&&l&&n&&u&&this.getLocalVideoStats&&At(i=["vp8","vp9"]).call(i,this.store.codec)){var h;const w=a.degradationPreference||(At(h=e._hints).call(h,_n.CUSTOM_TRACK)?B("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(N,k,x,W,Z,$){if(_R(N,x),Z(k),W!=="balanced"&&W!=="maintain-framerate"&&W!=="maintain-resolution")return;let q=-1;jM(N,k);const ot=window.setInterval(()=>{const Nt=ER.get(N);if(!B("ENABLE_AG_ADAPTATION")||!Nt)return _R(N,x),void Z(k);const Mt=$();if(Mt.sendPackets>0&&Mt.OutgoingAvailableBandwidth>0){if(q===-1)return void(q=Date.now());if(Date.now()-q<1e3)return;const ke=Mt.sendFrameRate,xe=Mt.OutgoingAvailableBandwidth,[gn,ni]=YH(N,ke,xe,Nt.adaptationConfig,k,W);ni&&(x.qualityLimitationReason=ni),gn&&Nt.adaptationConfig.scale!==gn.scale&&(T.debug("[".concat(N,"] applyAdaptation: ").concat(x.qualityLimitationReason,`
           sendFps `).concat(ke,", bwe ").concat(xe,", switch from ").concat(Nt.adaptationConfig.scale," to ").concat(gn.scale," ")),Nt.adaptationConfig=zw(zw({},Nt.adaptationConfig),gn),Z(gn))}},B("CHECK_LOCAL_STATS_INTERVAL")),_t=zw({},k);ER.set(N,{timer:ot,adaptationConfig:_t,originConfig:k,adaptationFunc:Z}),T.debug("[".concat(N,"] start adaptation, originConfig: ").concat(JSON.stringify(k),", degradationPreference: ").concat(W))})(this.id+l.mid,u,this,w,N=>{n&&this.updateAdaptation(n,N)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var p;const{bitrateMax:w,frameRate:N,scaleResolutionDownBy:k}=e._encoderConfig;w&&(c.maxBitrate=1e3*w),(At(p=e._hints).call(p,_n.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(N&&(c.maxFramerate=Ws(N)),k&&k>=1&&(c.scaleResolutionDownBy=k))}const{maxFramerate:m}=B("ENCODER_CONFIG_LIMIT");if(m&&typeof m=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,m):m),B("DSCP_TYPE")&&Ed()){var g;const w=B("DSCP_TYPE");At(g=["very-low","low","medium","high"]).call(g,w)&&(c.networkPriority=w)}const S=n.getParameters(),D=(r=S.encodings)===null||r===void 0?void 0:r[0];Vn()&&!D&&(a.encodings=[c]),D&&Object.assign(D,c),Object.assign(S,a),T.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(S.encodings))),await n.setParameters(S),await async function(w,N,k){try{var x;if(!Ke().supportSetRtpSenderParameters||!function(ot){return ot==="vp9"||ot==="av1"}(w)||!B("ENABLE_SVC"))return;const W={},Z={},$=N.getParameters(),q=(x=$.encodings)===null||x===void 0?void 0:x[0];Z.scalabilityMode=aR(k),q&&Object.assign(q,Z),Object.assign($,W),await N.setParameters($),T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify($.encodings)))}catch(W){T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",W)}}(this.store.codec,n,B("SVC_MODE"))}async updateAdaptation(e,n){var i,r;if(!e)return T.debug("[updateAdaptation] no rtpSender found");if(!Ke().supportSetRtpSenderParameters)return T.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const a={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:u}=n;c&&(a.maxBitrate=1e3*c),l&&(a.maxFramerate=Ws(l)),u&&u>=1&&At(i=["vp8","vp9"]).call(i,this.store.codec)&&(a.scaleResolutionDownBy=u);const h=e.getParameters(),p=(r=h.encodings)===null||r===void 0?void 0:r[0];p&&Object.assign(p,a),Object.assign(h,{});try{await e.setParameters(h),T.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(m){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?T.debug("[updateAdaptation] peerConnection not connected}"):T.debug("[updateAdaptation] updateRtpSenderEncodings failed",m):T.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!Ke().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],a=n[i];a instanceof wn&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,r.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=ys(e);return n.forEach((a,c)=>{const l=i[c],u=r.mediaDescriptions.find(h=>h.attributes.mid===l);u&&(e_(u,a),aM(u,a,this.store.codec))}),zu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let u=0;u<e.length;u++){var i,r,a,c,l;const h=e[u],p=n[u];if(p instanceof wn&&!At(i=p._hints).call(i,_n.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((a=p._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},g={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const S=h.sender.getParameters();await h.sender.setParameters(Object.assign(S,m))}}}async applySimulcastEncodings(e,n){if(!Vn()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof wn&&this.isVP8Simulcast(r)){const a=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const u=a.sender.getParameters();await a.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(e){var n,i,r,a,c;return!!(e instanceof wn&&B("SIMULCAST")&&this.store.codec==="vp8"&&!At(n=e._hints).call(n,_n.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=e._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(B("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(Ke().supportPCSetConfiguration){const n=Af.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Yt(Be.prototype,"updateRemoteRTPCapabilities",[os],Object.getOwnPropertyDescriptor(Be.prototype,"updateRemoteRTPCapabilities"),Be.prototype),Yt(Be.prototype,"connect",[os],Object.getOwnPropertyDescriptor(Be.prototype,"connect"),Be.prototype),Yt(Be.prototype,"updateRemoteConnect",[os],Object.getOwnPropertyDescriptor(Be.prototype,"updateRemoteConnect"),Be.prototype),Yt(Be.prototype,"createDataChannels",[os],Object.getOwnPropertyDescriptor(Be.prototype,"createDataChannels"),Be.prototype),Yt(Be.prototype,"receive",[os],Object.getOwnPropertyDescriptor(Be.prototype,"receive"),Be.prototype),Yt(Be.prototype,"batchReceive",[os],Object.getOwnPropertyDescriptor(Be.prototype,"batchReceive"),Be.prototype),Yt(Be.prototype,"stopReceiving",[os],Object.getOwnPropertyDescriptor(Be.prototype,"stopReceiving"),Be.prototype),Yt(Be.prototype,"muteRemote",[os],Object.getOwnPropertyDescriptor(Be.prototype,"muteRemote"),Be.prototype),Yt(Be.prototype,"unmuteRemote",[os],Object.getOwnPropertyDescriptor(Be.prototype,"unmuteRemote"),Be.prototype),Yt(Be.prototype,"muteLocal",[os],Object.getOwnPropertyDescriptor(Be.prototype,"muteLocal"),Be.prototype),Yt(Be.prototype,"unmuteLocal",[os],Object.getOwnPropertyDescriptor(Be.prototype,"unmuteLocal"),Be.prototype),Yt(Be.prototype,"close",[os],Object.getOwnPropertyDescriptor(Be.prototype,"close"),Be.prototype),Yt(Be.prototype,"updateEncoderConfig",[os],Object.getOwnPropertyDescriptor(Be.prototype,"updateEncoderConfig"),Be.prototype),Yt(Be.prototype,"updateSendParameters",[os],Object.getOwnPropertyDescriptor(Be.prototype,"updateSendParameters"),Be.prototype),Yt(Be.prototype,"replaceTrack",[os],Object.getOwnPropertyDescriptor(Be.prototype,"replaceTrack"),Be.prototype),Yt(Be.prototype,"updateAdaptation",[os],Object.getOwnPropertyDescriptor(Be.prototype,"updateAdaptation"),Be.prototype),Yt(Be.prototype,"getRemoteSSRC",[os],Object.getOwnPropertyDescriptor(Be.prototype,"getRemoteSSRC"),Be.prototype),Be);function os(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,a=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}function Jw(t,e){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=Ws(e.width),i.height=Ws(e.height);const r=Ws(e.framerate||15);document.body.append(n),document.body.append(i);let a=t._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();const c=i.getContext("2d");if(!c)throw new nt(M.UNEXPECTED_ERROR,"can not get canvas context");const l=Ke(),u=i.captureStream(l.supportRequestFrame?0:r).getVideoTracks()[0];u.canvas||(u.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const p=n.videoWidth,m=n.videoHeight/p,g=i.width*m;Math.abs(g-i.height)>=2&&(T.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(g)),i.height=g)}c.drawImage(n,0,0,i.width,i.height),u.requestFrame&&u.requestFrame(),a!==t._mediaStreamTrack&&(a=t._mediaStreamTrack,n.srcObject=new MediaStream([a]))},i.stopCapture=ow(()=>i.startCapture&&i.startCapture(),r);const h=u.stop;return u.stop=()=>{h.call(u),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),T.debug("clean low stream renderer")},u}var SR=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(SR||{}),oi=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(oi||{}),uf=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(uf||{}),ci=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(ci||{}),hf=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(hf||{}),HM=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(HM||{}),gl=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(gl||{}),cs=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(cs||{}),WM=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(WM||{}),ls=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(ls||{}),yR=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(yR||{});const pf=1e3,ff=6,TR=3,QH=Math.max(ff,TR);function de(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function KM(t){const e={[ls.CONN_TYPE]:0,[ls.RTT]:t.rtt,[ls.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[ls.CONN_TYPE]=1),n==="tcp"&&(e[ls.CONN_TYPE]=3),n==="tls"&&(e[ls.CONN_TYPE]=4);break}case"srflx":e[ls.CONN_TYPE]=2;break;case"unknown":e[ls.CONN_TYPE]=5;break;default:e[ls.CONN_TYPE]=0}return e}function zM(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class YM extends Mn{constructor(e){super(),P(this,"store",void 0),P(this,"uploadWRTCStatsTimer",void 0),P(this,"uploadOutboundDenoiserStatsTimer",void 0),P(this,"uploadExtStatsTimer",void 0),P(this,"uploadExtUsageStatsTimer",void 0),P(this,"uploadInboundExtStatsTimer",void 0),P(this,"requestStats",void 0),P(this,"requestTransportStats",void 0),P(this,"requestLocalMedia",void 0),P(this,"requestRemoteMedia",void 0),P(this,"requestAllTracks",void 0),P(this,"requestVideoIsReady",void 0),P(this,"requestUploadStats",void 0),P(this,"requestUpload",void 0),P(this,"uploadOutboundStarted",!1),P(this,"uploadInboundStarted",!1),P(this,"uploadTransportStarted",!1),P(this,"uploadBaseStatsStarted",!1),P(this,"uploadExtensionUsageStarted",!1),P(this,"lastRecvStats",void 0),P(this,"lastSendStats",void 0),P(this,"lastRefRecvStats",void 0),P(this,"lastRefSendStats",void 0),P(this,"lastFullRecvStats",void 0),P(this,"lastFullSendStats",void 0),P(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const n=e%TR==0,i=e%ff==0;let r,a;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(a=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!a&&this.uploadInboundStarted&&(a=this.requestStats(!0)),r||a){var c;const l={};if(this.uploadTransportStarted&&r){const h=this.getTransportStats(r,a,n);h&&(l.misc=[h])}if(this.uploadOutboundStarted&&r){const h=this.getOutboundStats(r,i?this.lastFullSendStats:n?this.lastRefSendStats:this.lastSendStats,n,i);h&&(l.outbound=[h])}if(this.uploadInboundStarted&&a){const h=this.getInboundStats(a,i?this.lastFullRecvStats:n?this.lastRefRecvStats:this.lastRecvStats,n,i);h&&(l.inbound=h)}const u=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;u&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[yR.RTC_PEER_CONNECTION_STATE]=zA[u]):l.misc=[{addition:{[yR.RTC_PEER_CONNECTION_STATE]:zA[u]}}]),this.requestUploadStats(l)}this.lastRecvStats=a,this.lastSendStats=r,i&&(this.lastFullRecvStats=a,this.lastFullSendStats=r),n&&(this.lastRefRecvStats=a,this.lastRefSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const r=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(r&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[yR.RTC_PEER_CONNECTION_STATE]:zA[r.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===QH+1&&(e=1)},pf)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,n,i){if(!this.requestStats)return;if(!i)return e.rtt==null?void 0:{addition:{[ls.RTT]:e.rtt,[ls.CONN_TYPE]:void 0,[ls.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=KM(e);if(this.store.useP2P){if(n){const a=KM(n);r[ls.CONN_TYPE]+=a[ls.CONN_TYPE]<<3}r[ls.CONN_TYPE]+=110}else r[ls.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,n,i,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const a=this.requestLocalMedia();if(!a||a.length===0)return;let c,l,u;return a.forEach(h=>{let[p,{track:m,ssrcs:g}]=h;switch(p){case Et.LocalVideoLowTrack:case Et.LocalVideoTrack:if(p===Et.LocalVideoTrack){const S=function(N,k,x,W,Z,$){const q=k.videoSend.find(Mt=>Mt.ssrc===N);if(!q)return;const ot={},{sentFrame:_t,inputFrame:Nt}=q;if($&&(de(ot,oi.QP_SUM,q.qpSumPerFrame),Nt&&_t)){const Mt=Nt.frameRate,ke=_t.frameRate;ot[oi.FREEZE]=function(xe,gn){let ni=!0;return ni=!(xe<=5)&&(xe<=10?gn<3:xe<=20?gn<4:gn<5),ni}(Mt,ke)?1:0}if(Z){switch(_t&&(de(ot,oi.HEIGHT,_t.height),de(ot,oi.WIDTH,_t.width),de(ot,oi.FRAME_RATE,_t.frameRate)),ot[oi.DISABLED]=W._originMediaStreamTrack&&!W._originMediaStreamTrack.enabled||W._mediaStreamTrack&&!W._mediaStreamTrack.enabled?1:0,q.adaptionChangeReason){case"none":ot[oi.ADAPTATION]=0;break;case"cpu":ot[oi.ADAPTATION]=1;break;case"bandwidth":ot[oi.ADAPTATION]=2;break;case"other":ot[oi.ADAPTATION]=3}let Mt=0;q.adaptionChangeReason&&(Mt+=zM(q.adaptionChangeReason)),k.qualityLimitationReason&&(Mt+=zM(k.qualityLimitationReason)<<3),ot[oi.ADAPTATION]=Mt,ot[oi.PLAYER_STATUS]=sw[W._player?W._player.videoElementStatus:"uninit"],de(ot,oi.NACKS,q.nacksCount),de(ot,oi.PLIS,q.plisCount),de(ot,oi.FIRS,q.firsCount),de(ot,oi.AVG_ENCODE,q.avgEncodeMs),de(ot,oi.HUGE_FRAME_SENT,q.hugeFramesSent),de(ot,oi.BYTES_RETRANSMIT,q.retransmittedBytesSent),de(ot,oi.PACKAGES_RETRANSMIT,q.retransmittedPacketsSent),de(ot,oi.KEY_FRAMES_ENCODED,q.keyFramesEncoded);const ke=x&&x.videoSend.find(xe=>xe.ssrc===N);if(ke){let xe=Z?pf:pf*ff;ke.timestamp&&q.timestamp&&(xe=q.timestamp-ke.timestamp),ke.packets!=null&&q.packets!=null&&de(ot,oi.PACKAGE_RATE,1e3*(q.packets-ke.packets)/xe),q.packetsLost!=null&&ke.packetsLost!=null&&de(ot,oi.PACKAGE_LOST,q.packetsLost-ke.packetsLost),ke.bytes!=null&&q.bytes!=null&&de(ot,oi.BITRATE,8*(q.bytes-ke.bytes)/xe)}}return ot}(g[0].ssrcId,e,n,m,i,r),D=m&&function(N,k,x,W){const Z=k.videoSend.find(q=>q.ssrc===N);if(!Z)return null;const $={};if(W){const q=Z.inputFrame,ot=q&&q.height||x.videoHeight||0,_t=q&&q.width||x.videoWidth||0,Nt=q&&q.frameRate||0;de($,SR.HEIGHT,ot),de($,SR.WIDTH,_t),de($,SR.FRAME_RATE,Nt)}return $}(g[0].ssrcId,e,m,i),w=function(N,k){const x={};return k&&(de(x,oi.RETRANSMIT,N.bitrate.retransmit),de(x,oi.TARGET_ENCODED,N.bitrate.targetEncoded),de(x,oi.ACTUAL_ENCODED,N.bitrate.actualEncoded),de(x,oi.TRANSMIT,N.bitrate.transmit),de(x,oi.BANDWIDTH,N.sendBandwidth)),x}(e,i);l=Object.assign({},S,D,w)}else u=function(S,D,w,N){const k=D.videoSend.find(W=>W.ssrc===S);if(!k)return;const x={};if(N){const W=k.sentFrame;if(W&&(de(x,uf.HEIGHT,W.height),de(x,uf.WIDTH,W.width),de(x,uf.FRAME_RATE,W.frameRate)),w){const Z=w.videoSend.find($=>$.ssrc===S);if(Z){let $=pf*ff;Z.timestamp&&k.timestamp&&($=k.timestamp-Z.timestamp),Z.packets!=null&&k.packets!=null&&de(x,uf.PACKAGE_RATE,1e3*(k.packets-Z.packets)/$),k.packetsLost!=null&&Z.packetsLost!=null&&de(x,uf.PACKAGE_LOST,k.packetsLost-Z.packetsLost),Z.bytes!=null&&k.bytes!=null&&de(x,uf.BITRATE,8*(k.bytes-Z.bytes)/$)}}}return x}(g[0].ssrcId,e,n,i);break;case Et.LocalAudioTrack:c=m&&function(S,D,w,N,k){const x=D.audioSend.find(Z=>Z.ssrc===S);if(!x)return;const W={};if(k){W[gl.DISABLED]=N._originMediaStreamTrack&&!N._originMediaStreamTrack.enabled||N._mediaStreamTrack&&!N._mediaStreamTrack.enabled?1:0;const Z=100*N._source.getAccurateVolumeLevel(),$=x.inputLevel;if($!=null){const ot=Math.ceil(50*Math.log10(100*$+1));de(W,gl.LEVEL,ot)}de(W,HM.PCM_LEVEL,Z),de(W,gl.AEC_RETURN_LOSS,x.aecReturnLoss),de(W,gl.AEC_RETURN_LOSS_ENH,x.aecReturnLossEnhancement),de(W,gl.BYTES_RETRANSMIT,x.retransmittedBytesSent),de(W,gl.PACKAGES_RETRANSMIT,x.retransmittedPacketsSent),W[gl.FREEZE]=0;const q=w&&w.audioSend.find(ot=>ot.ssrc===S);if(q){let ot=pf*ff;q.timestamp&&x.timestamp&&(ot=x.timestamp-q.timestamp),q.bytes!=null&&x.bytes!=null&&de(W,gl.BITRATE,8*(x.bytes-q.bytes)/ot),q.packets!=null&&x.packets!=null&&de(W,gl.PACKAGE_RATE,1e3*(x.packets-q.packets)/ot)}}return W}(g[0].ssrcId,e,n,m,i)}}),{high:l,low:u,audio:c}}getInboundStats(e,n,i,r){if(!this.requestRemoteMedia)return;const a=this.requestRemoteMedia()||[],c=[];return a.forEach(l=>{let[u,h]=l;const p={peer:u.uid};if(h.has(Bt.VIDEO)&&u.videoTrack){const m=u._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(u._videoSSRC)||!1,g=u.videoTrack?function(S,D,w,N,k,x,W,Z){const $=D.videoRecv.find(xe=>xe.ssrc===S);if(!$)return;const q={},{receivedFrame:ot,outputFrame:_t,decodeFrameRate:Nt}=$,Mt=w&&w.videoRecv.find(xe=>xe.ssrc===S);if(de(q,hf.FRAME_RATE_DECODE,Nt),$.framesRateFirefox&&de(q,ci.FRAME_RATE,$.framesRateFirefox),ot&&de(q,ci.FRAME_RATE,ot.frameRate),de(q,ci.FRAMES_DROPPED,$.framesDroppedCount),de(q,ci.BYTES_RETRANSMIT,$.retransmittedBytesReceived),de(q,ci.PACKAGES_RETRANSMIT,$.retransmittedPacketsReceived),de(q,ci.PACKAGES_DISCARDED,$.packetsDiscarded),de(q,ci.AVG_DECODE,$.avgDecodeMs),de(q,ci.AVG_PROCESSING_DELAY,$.avgProcessingDelayMs),de(q,ci.AVG_ASSEMBLY_TIME,$.avgFramesAssembledFromMultiplePacketsMs),de(q,ci.AVG_INTER_FRAME_DELAY,$.avgInterFrameDelayMs),de(q,ci.KEY_FRAMES_DECODED,$.keyFramesDecoded),Mt){const xe=D.timestamp-w.timestamp||pf*(Z?ff:W?TR:1);$.packetsLost!=null&&Mt.packetsLost!=null&&de(q,ci.PACKAGE_LOST,$.packetsLost-Mt.packetsLost),Mt.bytes!=null&&$.bytes!=null&&de(q,ci.BITRATE,8*($.bytes-Mt.bytes)/xe),Mt.packets!=null&&$.packets!=null&&de(q,ci.PACKAGE_RATE,1e3*($.packets-Mt.packets)/xe)}if(Z&&(de(q,ci.QP_SUM,$.qpSumPerFrame),q[ci.FREEZE]=k&&oy.isRemoteVideoFreeze(N,$,Mt)?1:0),W){var ke;ot?(de(q,ci.HEIGHT,ot.height),de(q,ci.WIDTH,ot.width)):N&&(de(q,ci.HEIGHT,N._videoHeight||0),de(q,ci.WIDTH,N._videoWidth||0)),_t&&de(q,hf.FRAME_RATE_OUTPUT,_t.frameRate);const xe=(ke=N._player)===null||ke===void 0?void 0:ke.rendFrameRate.toFixed(0);if(xe&&de(q,hf.FRAME_RATE_RENDER,+xe),de(q,ci.JITTER_BUFFER,$.jitterBufferMs),de(q,ci.CURRENT_DELAY,$.currentDelayMs),de(q,ci.FIRS,$.firsCount),de(q,ci.NACKS,$.nacksCount),de(q,ci.PLIS,$.plisCount),N){q[ci.DISABLED]=N._originMediaStreamTrack.enabled&&N._mediaStreamTrack.enabled?0:1;const gn=N._player;if(gn){const{freezeTimeCounterList:ni,renderFreezeAccTime:Kn,videoElementStatus:us}=gn;if(ni&&ni.length>0&&de(q,hf.FREEZE_TIME,ni.splice(0,1)[0]),x&&Sd.visibility==="visible"&&us===Pr.PLAYING&&Ke().supportRequestVideoFrameCallback){const pt=Math.min(6e3,Kn);gn.renderFreezeAccTime=Math.max(0,Kn-pt),de(q,hf.FREEZE_TIME_RENDER,pt)}if(typeof $.totalFreezesDuration=="number"){const pt=Mt&&Mt.totalFreezesDuration?$.totalFreezesDuration-Mt.totalFreezesDuration:$.totalFreezesDuration;de(q,hf.FREEZE_DURATION,1e3*pt)}}}if(q[ci.PLAYER_STATUS]=sw[N._player?N._player.videoElementStatus:"uninit"],Mt&&$.totalInterFrameDelay!==void 0&&$.totalSquaredInterFrameDelay!==void 0&&Mt.totalInterFrameDelay!==void 0&&Mt.totalSquaredInterFrameDelay!==void 0){const gn=$.totalInterFrameDelay-Mt.totalInterFrameDelay,ni=$.totalSquaredInterFrameDelay-Mt.totalSquaredInterFrameDelay,Kn=$.framesDecodeCount-Mt.framesDecodeCount,us=gn/Kn*1e3,pt=Math.round(1e3*Math.sqrt((ni-Math.pow(gn,2)/Kn)/Kn));!isNaN(pt)&&us+pt>Math.max(3*us,us+150)&&(q[ci.I_FRAME_DELAY]=pt)}}return q}(u._videoSSRC,e,n,u.videoTrack,m===!0,this.needUploadRenderFreezeTime,i,r):void 0;g&&(p.video=g)}if(h.has(Bt.AUDIO)&&u.audioTrack){const m=u.audioTrack?function(g,S,D,w,N,k){const x=S.audioRecv.find(q=>q.ssrc===g);if(!x)return;const W={},Z=D&&D.audioRecv.find(q=>q.ssrc===g);if(de(W,cs.JITTER,x.jitterMs),de(W,cs.BYTES_RETRANSMIT,x.retransmittedBytesReceived),de(W,cs.PACKAGES_RETRANSMIT,x.retransmittedPacketsReceived),de(W,cs.PACKAGES_DISCARDED,x.packetsDiscarded),de(W,cs.AVG_PROCESSING_DELAY,x.avgProcessingDelayMs),Z){const q=S.timestamp-D.timestamp||pf*(k?ff:N?TR:1);x.packets!=null&&Z.packets!=null&&de(W,cs.PACKAGE_RATE,1e3*(x.packets-Z.packets)/q),N&&Z.bytes!=null&&x.bytes!=null&&de(W,cs.BITRATE,8*(x.bytes-Z.bytes)/q),x.packetsLost!=null&&Z.packetsLost!=null&&de(W,cs.PACKAGE_LOST,x.packetsLost-Z.packetsLost)}if(k){const{receivedFrames:q,droppedFrames:ot}=x;q!=null&&ot!=null&&(W[cs.FREEZE]=($=q)===0||100*ot/$>20?1:0)}var $;if(N){const q=100*w._source.getAccurateVolumeLevel(),ot=x.outputLevel;if(ot!=null){const _t=Math.ceil(50*Math.log10(100*ot+1));de(W,WM.LEVEL,_t)}if(de(W,cs.PCM_LEVEL,q),w&&(W[cs.DISABLED]=w._originMediaStreamTrack.enabled&&w._mediaStreamTrack.enabled?0:1),de(W,cs.JITTER_BUFFER,x.jitterBufferMs),de(W,cs.CURRENT_DELAY,x.jitterBufferMs),W[cs.PLAYER_STATUS]=sw[as.getPlayerState(w.getTrackId())],Z){const _t=x.concealedSamples-Z.concealedSamples;_t>0&&de(W,cs.CONCEALED_SAMPLES,_t);const Nt=x.totalSamplesReceived-Z.totalSamplesReceived;Nt>0&&de(W,cs.TOTAL_SAMPLES_RECEIVED,Nt)}}return W}(u._audioSSRC,e,n,u.audioTrack,i,r):void 0;m&&(p.audio=m)}(p.video||p.audio)&&c.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof Wb);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(QS.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,i]=e;i.has(Bt.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(Bt.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let r=[];const a=this.requestAllTracks&&this.requestAllTracks()||[];for(const h of a)!h.muted&&h.enabled&&(r=r.concat(await h.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[h,p]of c)p.has(Bt.VIDEO)&&h.videoTrack&&(r=r.concat(await h.videoTrack.getProcessorUsage())),p.has(Bt.AUDIO)&&h.audioTrack&&(r=r.concat(await h.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=function(h,p){const m={};for(const{id:w,value:N,level:k,direction:x}of h){var g;const W=(g=p.get(w))!==null&&g!==void 0?g:0,Z=N===2?W+B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:W;var S,D;p.set(w,Z),m[w]?(N===2&&(m[w].value=N),k>m[w].level&&(m[w].level=k),x==="remote"&&(m[w].remoteUidCount+=1),m[w].totalTs=(S=p.get(w))!==null&&S!==void 0?S:0):m[w]={value:N,level:k,remoteUidCount:x==="local"?0:1,totalTs:(D=p.get(w))!==null&&D!==void 0?D:0}}return Object.keys(m).map(w=>{const{level:N,value:k,totalTs:x}=m[w];return{id:w,level:N,value:k,totalTs:x}})}(r,e);const l=Date.now(),u=l>n?l:n+1;this.requestUpload&&this.requestUpload(QS.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:u})},B("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const ZH=B("ICE_RESTART_INTERVAL");let vR=new Map,a_=new Map,th=[ur.UDP_TCP_RELAY,ur.TCP_RELAY,ur.RELAY],Qw=B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ke().supportPCSetConfiguration;function qM(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=vR.get(t.id);n&&(window.clearTimeout(n),vR.delete(t.id));const i=a_.get(t.id);e&&i&&i.index===th.length-1&&(T.debug("[".concat(t.id,"] reset ICE restart policy")),a_.delete(t.id))}function XM(t,e,n){if(vR.size===0&&a_.size===0&&(Array.isArray(B("RESTART_SEQUENCE"))&&B("RESTART_SEQUENCE").length>0&&!function(l,u){if(l.length!==u.length)return!1;for(let h=0;h<l.length;h+=1){const p=l[h];if(l.filter(m=>m===p).length!==u.filter(m=>m===p).length)return!1}return!0}(th,B("RESTART_SEQUENCE"))&&(th=B("RESTART_SEQUENCE").filter(l=>{var u;if(At(u=Object.values(ur)).call(u,l))return!0}),T.debug("use reconnection policy from config distribution, queues: ".concat(th.join(" => ")))),Qw=B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ke().supportPCSetConfiguration),th.length===0)return void n();let i,{index:r=0,type:a}=a_.get(t.id)||{};if(Qw&&a===ur.RELAY)return void n();let c=a&&r>=th.length-1;if(Qw)a=ur.RELAY;else{if(c)return void n();a?(r++,a=th[r]):(a=th[0],r=0)}T.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(a,", index: ").concat(r)),e(a),a_.set(t.id,{index:r,type:a}),i=window.setTimeout(()=>XM(t,e,n),ZH),vR.set(t.id,i)}var we;function JM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Sl(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?JM(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):JM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function QM(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=TA,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new bR(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function bR(t){function e(n){if(Object(n)!==n)return wt.reject(new TypeError(n+" is not an object."));var i=n.done;return wt.resolve(n.value).then(function(r){return{value:r,done:i}})}return bR=function(n){this.s=n,this.n=n.next},bR.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?wt.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?wt.reject(n):e(i.apply(this.s,arguments))}},new bR(t)}let ly=(we=class extends Mn{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(ee.StateChange,e,this._state)}constructor(t,e){super(),P(this,"isPlanB",void 0),P(this,"store",void 0),P(this,"statsUploader",void 0),P(this,"connection",void 0),P(this,"localTrackMap",new Map),P(this,"remoteUserMap",new Map),P(this,"localDataChannels",[]),P(this,"remoteDataChannelMap",new Map),P(this,"pendingLocalTracks",[]),P(this,"pendingRemoteTracks",[]),P(this,"pendingLocalDataChannels",[]),P(this,"pendingRemoteDataChannels",[]),P(this,"statsCollector",void 0),P(this,"shouldForwardP2PCreation",void 0),P(this,"iceFailedCount",0),P(this,"dtlsFailedCount",0),P(this,"mutex",void 0),P(this,"_state",$e.Disconnected),P(this,"_pcStatsUploadType",B("NEW_ICE_RESTART")?bd.FIRST_CONNECTION:bd.OLD_FIRST_CONNECTION),P(this,"_isStartRestartIce",!1),P(this,"_restartTimer",void 0),P(this,"_isTryConnecting",!1),P(this,"_iceError",null),P(this,"_forceTurn",!1),P(this,"_isWaitPcToRePub",!1),P(this,"handleMuteLocalTrack",async(n,i,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==$e.Connected)return void r(new ct(M.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const u=this.createMuteMessage(c);await mn(this,ee.RequestMuteLocal,u),i()}catch(c){r(c)}finally{a()}}),P(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==$e.Connected)return void r(new ct(M.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");if(l){const h=l[1];if(h.track._originMediaStreamTrack.stop(),!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding){const p=n._mediaStreamTrack.clone();h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}else{const p=Jw(n,WS(this,ee.RequestLowStreamParameter));h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}await new wt((p,m)=>{this.handleReplaceTrack(h.track,p,m,!0)})}await this.connection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const u=this.createUnmuteMessage(c);await mn(this,ee.RequestUnmuteLocal,u),i()}catch(c){r(c)}finally{a()}}),P(this,"handleUpdateVideoEncoder",async(n,i,r,a)=>{let c;a||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const u=this.localTrackMap.get(Et.LocalVideoTrack);if(!this.connection||!u||u.track!==n||this.state!==$e.Connected)return void i();const{id:h,track:p}=u;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(ee.UpdateVideoEncoder,p),i()}catch(u){r(u)}finally{var l;(l=c)===null||l===void 0||l()}}),P(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(Et.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==$e.Connected)return void i();const{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),i()}catch(c){r(c)}finally{a()}}),P(this,"handleReplaceMixingTrack",async(n,i,r,a)=>{if(!this.connection||this.state!==$e.Connected)return void i();const c=qw([n]);let l;T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof a=="boolean"&&a||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),i()}catch(h){r(h)}finally{var u;(u=l)===null||u===void 0||u()}}),P(this,"handleReplaceTrack",async(n,i,r,a)=>{let c;T.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return n===m});if(!this.connection||!h||this.state!==$e.Connected)return void i();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),this.isPlanB){const p=h[1];p.id=n._mediaStreamTrack.id,this.localTrackMap.set(h[0],p)}if(h[0]===Et.LocalVideoTrack&&!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding){const p=this.localTrackMap.get(Et.LocalVideoLowTrack);if(p){const m=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new wt((g,S)=>{this.handleReplaceTrack(p.track,g,S,!0)})}}i()}catch(h){r(h)}finally{var u;(u=c)===null||u===void 0||u()}}),P(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),P(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),P(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),P(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),P(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new YM(this.store),this.bindStatsUploaderEvents(),this.mutex=new lr("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ke().supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&Ed(),this.shouldForwardP2PCreation=B("FORWARD_P2P_CREATION")&&Ke().supportPCSetConfiguration&&PA(),this.shouldForwardP2PCreation&&(this.connection=gR(this.store),this.emit(ee.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var e;this.state=$e.New,this._forceTurn=FM(t),T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=gR(this.store,t),this.emit(ee.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new ct(M.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=B("NEW_ICE_RESTART")?bd.FIRST_CONNECTION:bd.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new ct(M.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");B("ENABLE_PREALLOC_PC")&&this.state===$e.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=$e.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(r=>{var a;let[c]=r;return At(a=[Et.LocalVideoLowTrack,Et.LocalVideoTrack]).call(a,c)}),n=e.map(r=>{let[,{id:a}]=r;return a}),i=e.map(r=>{let[a]=r;return a});if(this.connection instanceof _l){if(Jt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!At(t).call(t,this.store.codec)){const r=["vp9","vp8","h264"].find(a=>At(t).call(t,a));r&&(this.store.codec=r,T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof _l&&this.connection.peerConnectionState!=="closed"&&At(t=[$e.New,$e.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==$e.Connected){if(this.state===$e.Disconnected)throw new ct(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var i;At(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var i=this;return Da(function*(){const r=yield Fe(i.mutex.lock("From P2PChannel.publish"));try{var a;const c=i.connection&&At(a=["disconnected","failed"]).call(a,i.connection.peerConnectionState);if(!i.connection||i.state!==$e.Connected||c){if(i.state===$e.Disconnected)throw new ct(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(t);const u=t.filter(h=>i.pendingLocalTracks.indexOf(h)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(u),void(c&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,hr.markPublishStart(i.store.clientId,i.store.pubId);const l=i.filterTobePublishedTracks(t,e,n);if(l.length===0)return void(yield Fe(i.tryToUnmuteAudio(t)));yield*_b(QM(i.doPublish(i.connection,l)))}finally{r()}})()}doPublish(t,e){var n=this;return Da(function*(){e.forEach(g=>{let{track:S,type:D}=g;const w=Date.now();n.store.publish(S.getTrackId(),D===Et.LocalAudioTrack?"audio":"video",w)}),n.bindLocalTrackEvents(e);const i=e.map(g=>{let{track:S}=g;return S}),r=yield Fe(t.send(i,n.store.codec,n.store.audioCodec)),a=(yield Fe(r.next())).value,c=n.createGatewayPublishMessage(e,a);let l;try{l=yield c}catch(g){throw r.throw(g),(g==null?void 0:g.code)===M.WS_ABORT&&e.forEach(S=>{let{track:D}=S;n.pendingLocalTracks.indexOf(D)===-1&&n.pendingLocalTracks.push(D)}),n.unbindLocalTrackEvents(e),g}const u=n.mapPubResToRemoteConfig(c,l,i),h=(yield Fe(r.next(u))).value;if(n.state===$e.Disconnected)throw new ct(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");B("ENABLE_VIDEO_SEI");const p=B("ENABLE_ENCODED_TRANSFORM"),m=B("ENABLE_AUDIO_METADATA");i.forEach(async g=>{const S=g.getRTCRtpTransceiver();if(!S||!p)return;const{interceptLocalVideoFrame:D,interceptLocalAudioFrame:w}=uR();g.trackMediaType===Bt.VIDEO?await D(S.sender,g):g.trackMediaType===Bt.AUDIO&&await w(S.sender,{metadata:m?()=>{const N=g.metadata.shift();return N&&N.value}:void 0})}),e.forEach(g=>{let{type:S}=g;n.statsCollector.addLocalStats(S)}),n.assignLocalTracks(e,h),n.statsUploader.startUploadOutboundStats(),e.forEach(g=>{let{track:S,type:D}=g;const w=Date.now();n.store.publish(S.getTrackId(),D===Et.LocalAudioTrack?"audio":"video",void 0,w)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n||!this.connection)return;if(!(n.track instanceof wn))return T.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,r=function(a,c){const l={};return a.height&&a.width&&(l.scaleResolutionDownBy=Lw(a,c)),l.maxFramerate=a.framerate?Ws(a.framerate):void 0,l.maxBitrate=a.bitrate?1e3*a.bitrate:void 0,l}(t,i);if(i._encoderConfig||(i._encoderConfig={}),e!==Et.LocalVideoLowTrack||!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const a=i._originMediaStreamTrack;if(!a.canvas)return T.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(c,l){const u=c.canvas;l.width&&(u.width=Ws(l.width)),l.height&&(u.height=Ws(l.height)),l.framerate&&(u.stopCapture&&u.stopCapture(),u.stopCapture=ow(()=>{!u.startCapture&&u.stopCapture&&u.stopCapture(),u.startCapture&&u.startCapture()},Ws(l.framerate)))})(a,t)}r.maxBitrate!=null&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),T.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(t){var e=this;return Da(function*(){if(!e.connection||e.state!==$e.Connected)return;const n=yield Fe(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=e.localTrackMap.get(Et.LocalVideoTrack);if(!r)throw new ct(M.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(Et.LocalVideoLowTrack))throw new ct(M.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const a=[{track:e.getLowVideoTrack(r.track,t),type:Et.LocalVideoLowTrack}];if(yield*_b(QM(e.doPublish(e.connection,a))),r.track.muted||!r.track.enabled){var i;const c=(i=e.localTrackMap.get(Et.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield Fe(e.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await er(this,ee.RequestRePublish,this.pendingLocalTracks),this.emit(ee.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await er(this,ee.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:i}=this.pendingRemoteTracks[e];(i!==Bt.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==Bt.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await er(this,ee.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===Bt.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(ee.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==$e.Connected)return void t.forEach(i=>{const r=this.pendingLocalTracks.indexOf(i);r!==-1&&this.pendingLocalTracks.splice(r,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==$e.Connected)return void t.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==$e.Connected)return;const t=this.localTrackMap.get(Et.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[Et.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(i=>{let[,{id:r}]=i;return r})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[r,{track:a}]=i;return{type:r,track:a}})),e.forEach(i=>{let[r]=i;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==$e.Connected)throw new ct(M.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(i=>{var r;return!((r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(i=>{var r;this.remoteDataChannelMap.has(t)?(r=this.remoteDataChannelMap.get(t))===null||r===void 0||r.set(i.id,i):this.remoteDataChannelMap.set(t,new Map([[i.id,i]]));const a=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:u}=c;return l.uid===t.uid&&u===i.id});a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),n.map(i=>i.id)}async subscribe(t,e,n,i,r){var a;if(!this.connection||this.state!==$e.Connected)throw new ct(M.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((a=this.remoteUserMap.get(t))!==null&&a!==void 0&&a.has(e))return;let c,l,u;const h=this.connection.getPreMedia(n);if(h)T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),u=h.transceiver,c=h.track,l=h.id;else if(r){const g=r.find(D=>{let{stream_type:w}=D;return w===e});if(!g)throw new ct(M.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const S=await this.connection.receive(e,g.ssrcs,String(t._uintid),g.attributes);this.connection instanceof _l&&(u=S.transceiver),c=S.track,l=S.id}else{const g=await this.connection.receive(e,[{ssrcId:n,rtx:i}],String(t._uintid),void 0);this.connection instanceof _l&&(u=g.transceiver),c=g.track,l=g.id}if(e===Bt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new YE(c,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),u&&t._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new zE(c,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),u&&t._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._videoTrack)),u&&B("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:g,interceptRemoteAudioFrame:S}=uR();e==Bt.VIDEO?await g(u.receiver,{onSei:B("ENABLE_VIDEO_SEI")&&(D=>{var w;return(w=t._videoTrack)===null||w===void 0?void 0:w._onSei(D)})}):e==Bt.AUDIO&&await S(u.receiver,{enableTopn:!!B("ENABLE_AUDIO_TOPN"),enableMetadata:!!B("ENABLE_AUDIO_METADATA"),onMetadata:D=>{this.safeEmit(ee.AudioMetadata,D)}})}const p=this.remoteUserMap.get(t);p?p.set(e,l):this.remoteUserMap.set(t,new Map([[e,l]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const m=this.pendingRemoteTracks.findIndex(g=>{let{user:S,kind:D}=g;return S.uid===t.uid&&e===D});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(ee.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==$e.Connected)throw new ct(M.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(r=>{var a;let{user:c,mediaType:l}=r;return!((a=this.remoteUserMap.get(c))!==null&&a!==void 0&&a.has(l))});const e=[],n=new Map;t.forEach(r=>{if(!this.connection)return;const a=this.connection.getPreMedia(r.ssrcId);a?n.set(r.ssrcId,a):e.push(r)});const i=await this.connection.batchReceive(e.map(r=>{let{user:a,mediaType:c,ssrcId:l,rtxSsrcId:u}=r;return{kind:c,ssrcMsg:[{ssrcId:l,rtx:u}],mslabel:String(a._uintid)}}));e.forEach((r,a)=>{n.set(r.ssrcId,i[a])});for(const{user:r,mediaType:a,ssrcId:c}of t){const l=n.get(c);if(!l)return void T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(a,", ").concat(c));const{track:u,id:h,transceiver:p}=l;if(p&&B("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:S,interceptRemoteAudioFrame:D}=uR();a==Bt.VIDEO?await S(p.receiver,{onSei:B("ENABLE_VIDEO_SEI")&&(w=>{var N;return(N=r._videoTrack)===null||N===void 0?void 0:N._onSei(w)})}):a==Bt.AUDIO&&await D(p.receiver,{enableTopn:!!B("ENABLE_AUDIO_TOPN"),enableMetadata:!!B("ENABLE_AUDIO_METADATA"),onMetadata:w=>{this.safeEmit(ee.AudioMetadata,w)}})}if(a===Bt.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(u):(r._audioTrack=new YE(u,r.uid,r._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),p&&r._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(u):(r._videoTrack=new zE(u,r.uid,r._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),p&&r._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._videoTrack)),B("ENABLE_VIDEO_SEI")&&p){const{interceptRemoteVideoFrame:S,interceptRemoteAudioFrame:D}=uR();a==Bt.VIDEO?await S(p.receiver,{onSei:w=>{var N;(N=r._videoTrack)===null||N===void 0||N._onSei(w)}}):a==Bt.AUDIO&&await D(p.receiver)}const m=this.remoteUserMap.get(r);m?m.set(a,h):this.remoteUserMap.set(r,new Map([[a,h]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();const g=this.pendingRemoteTracks.findIndex(S=>{let{user:D,kind:w}=S;return D.uid===r.uid&&a===w});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(ee.MediaReconnectEnd,r.uid))}}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:u}=c;return e!==void 0?l.uid===t.uid&&e===u:l.uid===t.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===$e.Connected||n||i.forEach(c=>{let{kind:l}=c;var u;if(l===Bt.AUDIO)(u=t._audioTrack)===null||u===void 0||u._destroy(),t._audioTrack=void 0;else if(l===Bt.VIDEO){var h;(h=t._videoTrack)===null||h===void 0||h._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==$e.Connected)return;const r=this.filterTobeUnSubscribedTracks(t,e);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));const a=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[l,{kind:u}]=c;var h,p;if(u===Bt.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===Bt.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0);else if(u===Bt.AUDIO){var m;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0)}}),a}async unsubscribeDataChannel(t,e){if(e.forEach(r=>{const a=this.pendingRemoteDataChannels.findIndex(c=>c.id===r.id);a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(r=>{r._close()});const i=this.remoteDataChannelMap.get(t);return n.forEach(r=>{i&&i.delete(r.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(r=>r.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:r,mediaType:a}of t){const c=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return a!==void 0?u.uid===r.uid&&a===h:u.uid===r.uid});c.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),e=e.concat(c)}if(!this.connection||this.state!==$e.Connected)return void e.forEach(r=>{let{user:a,kind:c}=r;var l;if(c===Bt.AUDIO)(l=a._audioTrack)===null||l===void 0||l._destroy(),a._audioTrack=void 0;else if(c===Bt.VIDEO){var u;(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0}});const n=ms(t).call(t,(r,a)=>{let{user:c,mediaType:l}=a;const u=this.filterTobeUnSubscribedTracks(c,l);return r.concat(u)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(r=>{let[,{id:a}]=r;return a}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(r=>{let[a,{kind:c}]=r;var l,u;if(c===Bt.VIDEO&&a._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),c===Bt.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0;else if(c===Bt.AUDIO){var h;this.unbindRemoteTrackEvents(a._audioTrack),(h=a._audioTrack)===null||h===void 0||h._destroy(),a._audioTrack=void 0}}),i}isPreSubScribe(t){return!this.connection||this.state!==$e.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===Bt.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}addAudioMetadata(t){const e=this.localTrackMap.get(Et.LocalAudioTrack),n=e&&e.track;n&&n.metadata.push(t)}getAllTracks(t){const e=this.localTrackMap.get(Et.LocalAudioTrack);if((e==null?void 0:e.track)instanceof _i){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==Et.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===Et.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===Et.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(Et.LocalAudioTrack),l=i?this.localTrackMap.get(Et.LocalVideoLowTrack):this.localTrackMap.get(Et.LocalVideoTrack);Jt.publish(this.store.sessionId,{eventElapse:hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(_n.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var a;n||(n=[]);const c=n.find(u=>u instanceof Wn),l=i?(a=this.localTrackMap.get(Et.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(u=>u instanceof wn);Jt.publish(this.store.sessionId,{eventElapse:hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(_n.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===Bt.VIDEO?n._videoSSRC:n._audioSSRC;r&&Jt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===Bt.VIDEO,audio:i===Bt.AUDIO,peerid:n.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:hr.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new lr("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=gR(this.store),this.emit(ee.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Et.LocalAudioTrack);if((t==null?void 0:t.track)instanceof _i){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=$e.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Et.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Et.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof wn||e&&e.track instanceof Wn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(oa(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(Et.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=wS(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.connection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=$e.Reconnecting,B("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=gR(this.store),this.emit(ee.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case Et.LocalVideoTrack:At(e=i._hints).call(e,_n.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case Et.LocalAudioTrack:i instanceof _i?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case Et.LocalVideoLowTrack:}}),this.emit(ee.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(oa(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(ee.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(oa(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(e,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((t instanceof $u?t.uid:t)===i.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof $u?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return Da(function*(){if(!e.connection||e.state!==$e.Connected)return;const n=yield Fe(e.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Fe(e.connection.restartICE(t));const a=yield Fe(i.next());if(a.done)return;const c=a.value,l=yield c;switch(Xw(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),t){case ur.UDP_TCP_RELAY:e._pcStatsUploadType=bd.UDP_TCP_RESTART;break;case ur.TCP_RELAY:e._pcStatsUploadType=bd.TCP_RESTART;break;case ur.RELAY:e._pcStatsUploadType=bd.RELAY_RESTART;break;default:e._pcStatsUploadType=bd.OLD_RESTART}e._isTryConnecting=!0,i.next(l)}catch(a){var r;(r=i)===null||r===void 0||r.throw(a)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(Et.LocalVideoTrack),n=this.localTrackMap.get(Et.LocalAudioTrack),i=t.videoSend.find(S=>S.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),r=t.audioSend.find(S=>S.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!r)return 1;const a=sa(this,ee.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,u=c&&l?(c+l)/2:c||l,h=(u&&a?(u+a)/2:u||a)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,g=e==null?void 0:e.track;if(g&&g._encoderConfig&&g._hints.indexOf(_n.SCREEN_TRACK)===-1){const S=g._encoderConfig.bitrateMax,D=t.bitrate.actualEncoded;if(S&&D){const w=(1e3*S-D)/(1e3*S);return Dx[w<.15?0:w<.3?1:w<.45?2:w<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,a=i._videoSSRC,c=t.audioRecv.find(D=>D.ssrc===r),l=t.videoRecv.find(D=>D.ssrc===a);if(!c&&!l)return void(e+=1);const u=sa(this,ee.NeedSignalRTT),h=t.rtt,p=(h&&u?(h+u)/2:h||u)||0,m=c?c.jitterMs:void 0,g=t.recvPacketLossRate;let S=.7*g*100/50+.3*p/1500;m&&(S=.6*g*100/50+.2*p/1500+.2*m/400),e+=S<.1?1:S<.17?2:S<.36?3:S<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new wt((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(T.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==$e.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:c}]=a;return t===c});if(!i)return;const r=i[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:r}]),this.bindLocalTrackEvents([{track:e,type:r}]),i[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,i[1].id)),this.isPlanB){const a=i[1];a.id=e._mediaStreamTrack.id,this.localTrackMap.set(r,a)}if(r===Et.LocalVideoTrack&&!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding){const a=this.localTrackMap.get(Et.LocalVideoLowTrack);if(a){const c=t._mediaStreamTrack.clone();a.track._originMediaStreamTrack.stop(),a.track._mediaStreamTrack=c,a.track._originMediaStreamTrack=c,await new wt((l,u)=>{this.handleReplaceTrack(a.track,l,u,!0)})}}}filterTobePublishedTracks(t,e,n){const i=[],r=this.getAllTracks();t=PE(t=t.filter(u=>r.indexOf(u)===-1));let a,c=!1;const l=this.localTrackMap.get(Et.LocalAudioTrack);for(const u of t){if(u instanceof wn&&(this.localTrackMap.has(Et.LocalVideoTrack)||c?new ct(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:u,type:Et.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(u,n);i.push({track:h,type:Et.LocalVideoLowTrack})}if(u instanceof Wn)if(l){const h=l.track;if(h instanceof _i)Yw([u]),h.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0);else{const p=qw([h,u]);T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(h,p)}}else a instanceof _i?(Yw([u]),a.addAudioTrack(u)):a||!u._useAudioElement&&Ke().webAudioMediaStreamDest&&!u._bypassWebAudio?a=qw(a?[u,a]:[u]):a=u}return a&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(a.getTrackId(),"]")),i.push({track:a,type:Et.LocalAudioTrack})),i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=PE(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof Wn){const r=this.localTrackMap.get(Et.LocalAudioTrack);if(!r)continue;r.track instanceof _i?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([Et.LocalAudioTrack,r]),r.track.close())):e.push([Et.LocalAudioTrack,r])}if(i instanceof wn){const r=this.localTrackMap.get(Et.LocalVideoTrack);if(!r)continue;e.push([Et.LocalVideoTrack,r]);const a=this.localTrackMap.get(Et.LocalVideoLowTrack);a&&e.push([Et.LocalVideoLowTrack,a])}}return e}filterTobePublishedDataChannels(t){return t=(t=PE(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=PE(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case Et.LocalVideoTrack:n.addListener(Ht.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ht.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Ht.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ht.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ht.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ht.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ht.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ht.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ht.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Et.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Et.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof _i?t.trackList.forEach(n=>{n.addListener(Ht.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ht.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ht.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ht.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ht.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ht.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ht.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ht.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ht.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ht.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(Ht.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Ht.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case Et.LocalVideoTrack:n.off(Ht.GET_STATS,this.handleGetLocalVideoStats),n.off(Ht.GET_RTC_STATS,this.handleGetRTCStats),n.off(Ht.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ht.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ht.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ht.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ht.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ht.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ht.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Et.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Et.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof _i?t.trackList.forEach(e=>{e.off(Ht.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ht.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ht.GET_STATS,this.handleGetLocalAudioStats),e.off(Ht.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ht.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ht.GET_STATS,this.handleGetLocalAudioStats),t.off(Ht.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ht.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ht.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ht.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Ht.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ht.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof zE&&e.addListener(Ht.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof YE&&e.addListener(Ht.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ht.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(Bt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(Bt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let a,c,{track:l,type:u}=n;switch(u){case Et.LocalAudioTrack:a=tn.Audio,c={dtx:l instanceof Wb&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Et.LocalVideoTrack:a=At(r=l._hints).call(r,_n.SCREEN_TRACK)?tn.Screen:tn.High,c=Sl(Sl({},Xx(l)),{},{codec:this.store.codec,svc_mode:aR()});break;case Et.LocalVideoLowTrack:a=tn.Low,c=Sl(Sl({},Xx(l)),{},{codec:this.store.codec,svc_mode:aR()})}return{stream_type:a,attributes:c,ssrcs:e[i]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case Et.LocalVideoTrack:i=At(n=a._hints).call(n,_n.SCREEN_TRACK)?tn.Screen:tn.High;break;case Et.LocalAudioTrack:i=tn.Audio;break;case Et.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:a}=n;this.localTrackMap.set(a,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(ee.PeerConnectionStateChange,e),e==="connecting"&&t instanceof _l&&!Vn()&&B("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{e==="connecting"&&t.extendCandidate()},B("FIRST_TCP_CANDIDATE_INTERVAL")),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof _l&&qM(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=bd.DISCONNECTED_OR_FAILED,sa(this,ee.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(r=>r.getTrackId()),i=this.pendingLocalDataChannels.map(r=>"dc_".concat(r.id));Jt.reportApiInvoke(this.store.sessionId,{name:ui.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:Fn.TRACER}).onSuccess(),this.republish()}if(B("NEW_ICE_RESTART")&&t instanceof _l&&!Vn()&&!this._forceTurn){if(At(Gx).call(Gx,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=r=>{Xw(t)&&(T.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(r)),sa(this,ee.QueryClientConnectionState)==="CONNECTED"&&this.emit(ee.RequestRestartICE,r))},i=()=>{Xw(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),T.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(ee.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{XM(t,n,i)},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&B("ICE_RESTART")&&sa(this,ee.QueryClientConnectionState)==="CONNECTED"&&this.emit(ee.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(ee.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(ee.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Jt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Fn.TRACER}).onSuccess(),this.emit(ee.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(oa(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(FE.FIRST_FRAME_DECODED),Jt.firstRemoteFrame(this.store.sessionId,wi.FIRST_AUDIO_DECODE,Dn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(oa(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&Jt.firstRemoteFrame(this.store.sessionId,wi.FIRST_AUDIO_RECEIVED,Dn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(oa(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&Jt.firstRemoteFrame(this.store.sessionId,wi.FIRST_VIDEO_RECEIVED,Dn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(ee.ConnectionTypeChange,i),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ju(n))," -> ").concat(JSON.stringify(Ju(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ju(n))," -> ").concat(JSON.stringify(Ju(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Sl(Sl({},e),n)},t.onICECandidateError=e=>{this._iceError=e}}resetConnection(t){t instanceof _l&&function(e){a_.delete(e.id),qM(e)}(t),t.close(),this.emit(ee.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(Et.LocalAudioTrack);if(t instanceof Wn&&(n==null?void 0:n.track)instanceof _i)return n.track.isActive||e.push([Et.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(i&&(e.push(i),i[0]===Et.LocalVideoTrack)){const r=this.localTrackMap.get(Et.LocalVideoLowTrack);r&&e.push([Et.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(Et.LocalAudioTrack);if(t instanceof Wn&&(n==null?void 0:n.track)instanceof _i)return n.track.isActive&&e.push([Et.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(i)if(i[0]===Et.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(Et.LocalVideoLowTrack);r&&e.push([Et.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case Et.LocalAudioTrack:i=tn.Audio;break;case Et.LocalVideoTrack:i=At(n=a._hints).call(n,_n.SCREEN_TRACK)?tn.Screen:tn.High;break;case Et.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case Et.LocalAudioTrack:i=tn.Audio;break;case Et.LocalVideoTrack:i=At(n=a._hints).call(n,_n.SCREEN_TRACK)?tn.Screen:tn.High;break;case Et.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[a,c]=r;n.push([t,{kind:a,id:c}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(i=>{var r;(r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:a}]=n;switch(r){case Bt.VIDEO:return void(i._videoSSRC&&e.push({stream_type:Bt.VIDEO,ssrcId:i._videoSSRC}));case Bt.AUDIO:return void(i._audioSSRC&&e.push({stream_type:Bt.AUDIO,ssrcId:i._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[i,{kind:r}]=n;if(e.has(i)){let a=e.get(i);r===Bt.VIDEO?a|=Ii.Video:a|=Ii.Audio,e.set(i,a)}else r===Bt.VIDEO?e.set(i,Ii.Video):e.set(i,Ii.Audio)}),{users:Array.from(e.entries()).map(n=>{let[i,r]=n;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(Et.LocalVideoTrack),n=this.localTrackMap.get(Et.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new wt((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new wt((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e,n){return t.map((i,r)=>{var a;let{stream_type:c}=i;const l=(a=e.find(u=>{let{stream_type:h}=u;return c===h}))===null||a===void 0?void 0:a.attributes;if(l&&B("DISABLE_SCREEN_SHARE_REMB")){const u=n[r]._hints;(At(u).call(u,_n.SCREEN_TRACK)||At(u).call(u,_n.SCREEN_LOW_TRACK))&&(l.remb=!1,T.debug("disable remb for screen share, hints:",u))}return l})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof Wn){var e;const i=this.filterTobeUnmutedTracks(t[n]);if(i.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(i.map(a=>{let[,{id:c}]=a;return c})));const r=this.createUnmuteMessage(i);return void await mn(this,ee.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(ee.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(ee.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Hi(FA(this.dtlsFailedCount,hi)),this.emit(ee.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await er(this,ee.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(ee.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Et.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof wn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof wn).length>1)throw new ct(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Wn).length>1&&(t.some(e=>e instanceof Wn&&e._bypassWebAudio)||!Ke().webAudioMediaStreamDest))throw new ct(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof wn&&this.pendingLocalTracks.some(n=>n instanceof wn))throw new ct(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Wn&&this.pendingLocalTracks.some(n=>n instanceof Wn)&&(!Ke().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Wn&&n._bypassWebAudio)))throw new ct(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var n;const i=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding,r=Sl(Sl({},{width:160,height:120,framerate:15,bitrate:50}),e);let a;a=i?t._mediaStreamTrack.clone():Jw(t,r);const c=En(8,"track-low-"),l=new wn(a,Sl(Sl({},i&&{scaleResolutionDownBy:Lw(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,c);return l.on(ef.TRANSCEIVER_UPDATED,u=>{t._updateRtpTransceiver(u,VE.LOW_STREAM)}),l._hints.push(_n.LOW_STREAM),At(n=t._hints).call(n,_n.SCREEN_TRACK)&&l._hints.push(_n.SCREEN_LOW_TRACK),t.on("sei-to-send",u=>{l.emit("sei-to-send",u)}),t.addListener(Ht.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof _l){var r,a,c,l;const u=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:p,peerConnectionState:m}=this.connection,{local:g,remote:S}=await this.connection.getSelectedCandidatePair();Jt.pcStats(this.store.sessionId,{startTime:u,eventElapse:t-u||0,iceconnectionsate:h,dtlsstate:p,connectionstate:m,intSucc:e?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(r=g==null?void 0:g.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(a=g.candidateType)!==null&&a!==void 0?a:"",selectedLocalCandidateAddress:"".concat(g.address,":").concat(g.port),selectedRemoteCandidateProtocol:(c=S.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=S.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(S.address,":").concat(S.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,e,n,i){var r;const a=Array.from(oa(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(a){i||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===a.uid&&u.type==="video");Jt.firstRemoteVideoDecode(this.store.sessionId,wi.FIRST_VIDEO_DECODE,Dn.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:e,videoheight:n,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0,firstFrame:(l==null?void 0:l.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const a=await this.connection.getRemoteSSRC(r);return a!==void 0&&a!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===Et.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,VE.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Yt(we.prototype,"startP2PConnection",[xr],Object.getOwnPropertyDescriptor(we.prototype,"startP2PConnection"),we.prototype),Yt(we.prototype,"connect",[xr],Object.getOwnPropertyDescriptor(we.prototype,"connect"),we.prototype),Yt(we.prototype,"updateRemoteRTPCapabilities",[xr],Object.getOwnPropertyDescriptor(we.prototype,"updateRemoteRTPCapabilities"),we.prototype),Yt(we.prototype,"publishDataChannel",[xr],Object.getOwnPropertyDescriptor(we.prototype,"publishDataChannel"),we.prototype),Yt(we.prototype,"unpublish",[xr],Object.getOwnPropertyDescriptor(we.prototype,"unpublish"),we.prototype),Yt(we.prototype,"unpublishDataChannel",[xr],Object.getOwnPropertyDescriptor(we.prototype,"unpublishDataChannel"),we.prototype),Yt(we.prototype,"unpublishLowStream",[xr],Object.getOwnPropertyDescriptor(we.prototype,"unpublishLowStream"),we.prototype),Yt(we.prototype,"subscribeDataChannel",[xr],Object.getOwnPropertyDescriptor(we.prototype,"subscribeDataChannel"),we.prototype),Yt(we.prototype,"subscribe",[xr],Object.getOwnPropertyDescriptor(we.prototype,"subscribe"),we.prototype),Yt(we.prototype,"massSubscribe",[xr],Object.getOwnPropertyDescriptor(we.prototype,"massSubscribe"),we.prototype),Yt(we.prototype,"unsubscribe",[xr],Object.getOwnPropertyDescriptor(we.prototype,"unsubscribe"),we.prototype),Yt(we.prototype,"unsubscribeDataChannel",[xr],Object.getOwnPropertyDescriptor(we.prototype,"unsubscribeDataChannel"),we.prototype),Yt(we.prototype,"massUnsubscribe",[xr],Object.getOwnPropertyDescriptor(we.prototype,"massUnsubscribe"),we.prototype),Yt(we.prototype,"muteRemote",[xr],Object.getOwnPropertyDescriptor(we.prototype,"muteRemote"),we.prototype),Yt(we.prototype,"unmuteRemote",[xr],Object.getOwnPropertyDescriptor(we.prototype,"unmuteRemote"),we.prototype),Yt(we.prototype,"hasRemoteMediaWithLock",[xr],Object.getOwnPropertyDescriptor(we.prototype,"hasRemoteMediaWithLock"),we.prototype),Yt(we.prototype,"disconnectForReconnect",[xr],Object.getOwnPropertyDescriptor(we.prototype,"disconnectForReconnect"),we.prototype),Yt(we.prototype,"updateBitrateLimit",[xr],Object.getOwnPropertyDescriptor(we.prototype,"updateBitrateLimit"),we.prototype),Yt(we.prototype,"remoteMediaSsrcChanged",[xr],Object.getOwnPropertyDescriptor(we.prototype,"remoteMediaSsrcChanged"),we.prototype),we);function xr(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,a=await r.lock("From P2PChannel.".concat(e));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}function ZM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function $M(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ZM(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ZM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const $H=Date.now(),t8=20,Zw=new Map,RR=new Map;async function t2(t){const e=Zw.get(t),n=Array.isArray(e)&&e[e.length-1],i=RR.get(t);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const a=n.sendTs-i.firstSendTs,c=a-(Date.now()-i.firstRecvTs);c>0&&(i.firstRecvTs=Date.now()-a);let l=n.mediaDelay+c;l<=0?(e.pop(),e2(n.context,r),l=0):l=Math.min(l,t8),setTimeout(()=>e.length&&t2(t),l)}function e2(t,e){t.safeEmit(De.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function e8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return e2(n,{uid:t.uid,payload:t.payload});const i="".concat(n.id,"-").concat(t.uid),r=Zw.get(i)||[],a=r.findIndex(h=>t.sendTs>=h.sendTs),c=$M($M({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});a===-1?r.push(c):r.splice(a,0,c),Zw.set(i,r);let l=!1;var u;RR.has(i)?l=!((u=RR.get(i))===null||u===void 0||!u.isSyncing):RR.set(i,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||t2(i)}const n8=Ge().name;function n2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function i2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?n2(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):n2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const o_="websdk_ng_cache_parameter",i8=B("MAX_PRELOAD_ASYNC_LENGTH"),r8=1e4,mf=new Map,Ef=[];let $w=null,tI=0,eI=0;const CR=new Map,s8=function(t,e){const n=[];let i=0;const r=async()=>{const a=n.shift();a&&await a(),n.length>0&&i<e?r():i--};return async function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return new wt(async(u,h)=>{n.push(async()=>{try{const p=await t(...c);u(p)}catch(p){h(p)}}),i<e&&(i++,r())})}}(r2,i8),nI=ss.CancelToken.source();async function r2(t,e,n,i,r,a){try{if(!B("ENABLE_PRELOAD"))return;if(!Ke().supportWebCrypto)return void Wu(()=>{T.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new ct(M.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Gi(n,"token",1,2047),Gi(t,"appid",1,2047),eR(e),i&&nR(i);const c=$p();T.debug("preload channel ".concat(e,", uid is ").concat(i));const l={appId:t,cname:e,token:n||t,uid:typeof i!="string"?i:null,sid:c,proxyServer:r};let u,h;typeof i=="string"?(l.stringUid=i,[h,u]=await wt.all([FH(i,{sid:c,appId:t},nI.token),AM(i2(i2({},l),{},{token:n||t,uid:0}),nI.token)]),l.uid=h.uid,u.gatewayInfo.uid=l.uid,u.gatewayInfo.res.uid=l.uid):(a&&(l.stringUid=a),u=await AM(l,nI.token));const p={sid:c,appId:t,cname:e,token:n||t,uid:l.stringUid||i,intUid:l.uid||u.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:h,ap:u};await async function(m){let g;try{m.uid&&a2({appId:m.appId,cname:m.cname,token:m.token,uid:m.uid,stringUid:m.stringUid});const S=d2(m),D=await async function(N,k){try{const x=await window.crypto.subtle.importKey("raw",JP(k),"AES-GCM",!1,["encrypt"]),W=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},x,Zp(window.btoa(JSON.stringify(N))));return Ku(new Uint8Array(W))}catch{return}}(m,m.token||m.appId);if(!D)return;g=l2(o_);const w=g?JSON.parse(g):[];w.push({[S]:D}),w.length>B("AP_CACHE_NUM")&&w.shift(),AR(o_,JSON.stringify(w))}catch(S){T.warn("Error caching server parameters:",S.message),AR(o_,"")}}(p),tI++}catch(c){throw eI++,function(l){$w||($w=window.setTimeout(()=>{let h="";CR.forEach((p,m)=>{h+="".concat(m,": ").concat(p," ;")}),Jt.reportApiInvoke(null,{name:ui.PRELOAD,options:{success:tI,failed:eI,err:h}}).onError(l),tI=0,eI=0,CR.clear(),$w=null},r8));const u=CR.get(l.code)||0;CR.set(l.code,u+1)}(c),c}}async function s2(t){try{if(B("AP_REQUEST_DETAIL")||B("ENABLE_ROLE_SELECT_EDGE"))return;const e=a2(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(i,r){try{const a=await window.crypto.subtle.importKey("raw",JP(r),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},a,Zp(i));return JSON.parse(window.atob(Ku(new Uint8Array(c))))}catch{return}}(e,t.token||t.appId);if(!n||!function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token?r.stringUid?i.stringUid===r.stringUid:typeof r.uid=="number"?i.uid===r.uid:i.uid==r.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<B("AP_CACHE_LIFETIME"))return n}catch(e){T.warn("Error get preloadInfo",e.message)}}function a2(t){let e;try{if(e=l2(o_),!e)return;const n=JSON.parse(e),i=d2(t),r=function(c,l){for(let u=c.length-1;u>=0;u--)if(l(c[u]))return u;return-1}(n,c=>i in c);if(r===-1)return;const a=n.splice(r,1)[0];return AR(o_,JSON.stringify(n)),a[i]}catch(n){T.warn("Error delete preload info: ".concat(e),n.message),AR(o_,"")}}function iI(t){if(t){let e=mf.get(t);e&&(window.clearTimeout(e),e=null,mf.delete(t)),At(Ef).call(Ef,t)||t.cloudProxyServer!=="disabled"||Ef.push(t)}if(mf.size<B("AP_CACHE_NUM")&&Ef.length>0){const e=Ef.shift();mf.set(e,window.setTimeout(async()=>{const{appId:n,cname:i,token:r,stringUid:a,uid:c,proxyServer:l}=e;try{await s8(n,i,r,c,l,a),mf.has(e)&&iI(e)}catch(u){T.warn("update preload failed",u.message),o2(e)}},B("AP_UPDATE_INTERVAL")))}}function o2(t){const e=Ef.indexOf(t);e!==-1&&Ef.splice(e,1);let n=mf.get(t);n&&(window.clearTimeout(n),n=null,mf.delete(t),iI())}function c2(t,e){const n=t.sua,i=t.ap;e&&n&&Jt.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),Jt.reportResourceTiming(t.ap.url,t.sid),Jt.joinWebProxyAP(t.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[ai.CHOOSE_SERVER,ai.CLOUD_PROXY_FALLBACK].toString()}),Jt.joinChooseServer(t.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[ai.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function l2(t){return window.atob(window.localStorage.getItem(t)||"")}function AR(t,e){window.localStorage.setItem(t,window.btoa(e))}function d2(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),ik(e)}function a8(t){let e=function(){const n=l8.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let r=n.appId;r!==void 0&&(li(i,10),eh(i,r));let a=n.cid;a!==void 0&&(li(i,16),li(i,a));let c=n.cname;c!==void 0&&(li(i,26),eh(i,c));let l=n.deviceId;l!==void 0&&(li(i,34),eh(i,l));let u=n.elapse;u!==void 0&&(li(i,40),nh(i,u));let h=n.fileSize;h!==void 0&&(li(i,48),nh(i,c_(h)));let p=n.height;p!==void 0&&(li(i,56),nh(i,c_(p)));let m=n.jpg;m!==void 0&&(li(i,66),li(i,m.length),h2(i,m));let g=n.networkType;g!==void 0&&(li(i,72),nh(i,c_(g)));let S=n.osType;S!==void 0&&(li(i,80),nh(i,c_(S)));let D=n.requestId;D!==void 0&&(li(i,90),eh(i,D));let w=n.sdkVersion;w!==void 0&&(li(i,98),eh(i,w));let N=n.sequence;N!==void 0&&(li(i,104),nh(i,c_(N)));let k=n.sid;k!==void 0&&(li(i,114),eh(i,k));let x=n.timestamp;x!==void 0&&(li(i,120),nh(i,x));let W=n.uid;W!==void 0&&(li(i,128),li(i,W));let Z=n.vid;Z!==void 0&&(li(i,136),li(i,Z));let $=n.width;$!==void 0&&(li(i,144),nh(i,c_($)));let q=n.service;q!==void 0&&(li(i,152),li(i,q));let ot=n.callbackData;ot!==void 0&&(li(i,162),li(i,ot.length),h2(i,ot));let _t=n.ticket;_t!==void 0&&(li(i,170),eh(i,_t));let Nt=n.vendorConfigs;Nt!==void 0&&(li(i,178),eh(i,Nt))}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function o8(t){return function(n){let i={};t:for(;!d8(n);){let r=dy(n);switch(r>>>3){case 0:break t;case 1:i.code=dy(n);break;case 2:i.msg=p2(n,dy(n));break;case 3:i.requestId=p2(n,dy(n));break;case 4:i.timestamp=u8(n,!1);break;default:c8(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function c8(t,e){switch(e){case 0:for(;128&wo(t););break;case 2:rI(t,dy(t));break;case 5:rI(t,4);break;case 1:rI(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function c_(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let l8=[];function rI(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function d8(t){return t.offset>=t.limit}function wR(t,e){let n=t.bytes,i=t.offset,r=t.limit,a=i+e;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),t.bytes=c}return t.offset=a,a>r&&(t.limit=a),i}function u2(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function h2(t,e){let n=wR(t,e.length);t.bytes.set(e,n)}function p2(t,e){let n=u2(t,e),i=String.fromCharCode,r=t.bytes,a="",c="";for(let l=0;l<e;l++){let u,h,p,m,g=r[l+n];(128&g)==0?c+=i(g):(224&g)==192?l+1>=e?c+=a:(u=r[l+n+1],(192&u)!=128?c+=a:(m=(31&g)<<6|63&u,m<128?c+=a:(c+=i(m),l++))):(240&g)==224?l+2>=e?c+=a:(u=r[l+n+1],h=r[l+n+2],(49344&(u|h<<8))!=32896?c+=a:(m=(15&g)<<12|(63&u)<<6|63&h,m<2048||m>=55296&&m<=57343?c+=a:(c+=i(m),l+=2))):(248&g)==240?l+3>=e?c+=a:(u=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(u|h<<8|p<<16))!=8421504?c+=a:(m=(7&g)<<18|(63&u)<<12|(63&h)<<6|63&p,m<65536||m>1114111?c+=a:(m-=65536,c+=i(55296+(m>>10),56320+(1023&m)),l+=3))):c+=a}return c}function eh(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}li(t,i);let r=wR(t,i),a=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?a[r++]=l:(l<2048?a[r++]=l>>6&31|192:(l<65536?a[r++]=l>>12&15|224:(a[r++]=l>>18&7|240,a[r++]=l>>12&63|128),a[r++]=l>>6&63|128),a[r++]=63&l|128)}}function wo(t){return t.bytes[u2(t,1)]}function f2(t,e){let n=wR(t,1);t.bytes[n]=e}function dy(t){let e,n=0,i=0;do e=wo(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function li(t,e){for(e>>>=0;e>=128;)f2(t,127&e|128),e>>>=7;f2(t,e)}function u8(t,e){let n,i=0,r=0,a=0;return n=wo(t),i=127&n,128&n&&(n=wo(t),i|=(127&n)<<7,128&n&&(n=wo(t),i|=(127&n)<<14,128&n&&(n=wo(t),i|=(127&n)<<21,128&n&&(n=wo(t),r=127&n,128&n&&(n=wo(t),r|=(127&n)<<7,128&n&&(n=wo(t),r|=(127&n)<<14,128&n&&(n=wo(t),r|=(127&n)<<21,128&n&&(n=wo(t),a=127&n,128&n&&(n=wo(t),a|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|a<<24,unsigned:e}}function nh(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,a=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=wR(t,a),l=t.bytes;switch(a){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=a!==9?128|r:127&r;case 8:l[c+7]=a!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=a!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=a!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=a!==5?128|i:127&i;case 4:l[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:l[c]=a!==1?128|n:127&n}}const m2={},E2={},IR=4294967296,h8=IR*IR,p8=h8/2;g2(0,!0);const _2=g2(0),f8=uy(0,-2147483648,!1),m8=uy(-1,2147483647,!1);function g2(t,e){let n,i,r;return e?(r=0<=(t>>>=0)&&t<256)&&(i=E2[t],i)?i:(n=uy(t,0,!0),r&&(E2[t]=n),n):(r=-128<=(t|=0)&&t<128)&&(i=m2[t],i)?i:(n=uy(t,t<0?-1:0,!1),r&&(m2[t]=n),n)}function uy(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function S2(t,e){if(isNaN(t))return _2;{if(t<=-9223372036854776e3)return f8;if(t+1>=p8)return m8}return t<0?_2:uy(t%IR|0,t/IR|0,e)}function y2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class sI extends Mn{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(gc.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),P(this,"name","AgoraRTCImageModeration"),P(this,"_connectionState",xa.CONNECTING),P(this,"_sequence",0),P(this,"_moderationStartTime",void 0),P(this,"_workerConnection",void 0),P(this,"_workerMessageLengthLimit",void 0),P(this,"_qualityRatio",void 0),P(this,"_connectInfo",void 0),P(this,"_cancelTokenSource",ss.CancelToken.source()),P(this,"_retryConfig",void 0),P(this,"_moderationInterval",void 0),P(this,"_moderationTimer",null),P(this,"_moderationMode",1),P(this,"_quality",1),P(this,"_qualityTimer",null),P(this,"_ticket",void 0),P(this,"_moderationIntervalMinimum",void 0),P(this,"_uploadFailedNum",0),P(this,"_uploadNum",0),P(this,"_uploadTimer",null),P(this,"_extraInfo",void 0),P(this,"_vendor",""),P(this,"_encoder",new TextEncoder),P(this,"_moderationId",void 0),P(this,"inspectImage",()=>{if(this.connectionState!==xa.CONNECTED)throw new nt(M.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===xa.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=En(5,"image-moderation-"),this._workerMessageLengthLimit=B("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=B("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=B("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new ty("worker-"+this._moderationId,hi),this.on(gc.STATE_CHANGE,(i,r)=>{T.debug("[".concat(this._moderationId,"] Moderation operation :").concat(QE[i]," ").concat(r||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(gc.STATE_CHANGE,QE.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new wt((r,a)=>{this.on(gc.CONNECTION_STATE_CHANGE,(c,l)=>{c===xa.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorker(c)}).catch(c=>{a(c)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),T.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===xa.CONNECTED&&this.inspectImage()}async requestAP(e,n,i){const r=B("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),a=await function(u,h,p,m){let{appId:g,areaCode:S,cname:D,sid:w,token:N,uid:k}=h;i_++;const x="moderation_plugin",W={service_name:x,json_body:JSON.stringify({appId:g,areaCode:S,cname:D,command:"allocateEdge",requestId:i_,seq:i_,sid:w,appToken:N,ts:Date.now(),uid:k+""})};let Z,$,q=u[0];return fc(async()=>{Z=Date.now();const ot=await Sc(q,{data:W,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if($=Date.now()-Z,ot.code!==0){const Mt=new nt(M.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ot.code,{retry:!0,responseTime:$});throw T.error(Mt.toString()),Mt}const _t=JSON.parse(ot.json_body);if(_t.code!==200){const Mt=new nt(M.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(_t.code,", reason: ").concat(_t.reason),{code:_t.code,responseTime:$});throw T.error(Mt.toString()),Mt}if(!_t.servers||!Array.isArray(_t.servers)||_t.servers.length===0){const Mt=new nt(M.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:_t.code,responseTime:$});throw T.error(Mt.toString()),Mt}if(!_t.servers.some(Mt=>!!Mt.wss)){const Mt=new nt(M.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:_t.code,responseTime:$});throw T.error(Mt.toString()),Mt}const Nt=B("IMAGE_MODERATION_WORKER_HOST");return{addressList:_t.servers.map(Mt=>{let{address:ke,wss:xe}=Mt;if(ke&&xe)return"wss://".concat(ke.replace(/\./g,"-"),".").concat(Nt,":").concat(xe,"/moderation")}).filter(Mt=>!!Mt),workerToken:_t.workerToken,vid:_t.vid,ticket:_t.appTicket,responseTime:$}},(ot,_t)=>(Jt.apworkerEvent(w,{success:!0,sc:200,serviceName:x,responseDetail:JSON.stringify(ot.addressList),firstSuccess:_t===0,responseTime:$,serverIp:u[_t%u.length]}),!1),(ot,_t)=>(Jt.apworkerEvent(w,{success:!1,sc:ot.data&&ot.data.code||200,serviceName:x,responseTime:$,serverIp:u[_t%u.length]}),!!(ot.code!==M.OPERATION_ABORTED&&ot.code!==M.UNEXPECTED_RESPONSE||ot.data&&ot.data.retry)&&(q=u[(_t+1)%u.length],!0)),m)}(r,e,n,i);this.emit(gc.STATE_CHANGE,QE.AP_CONNECTED);const{addressList:c,ticket:l}=a;return this._ticket=l,c}async connectWorker(e){this.emit(gc.STATE_CHANGE,QE.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Se.CONNECTED,async()=>{this.emit(gc.STATE_CHANGE,QE.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=xa.CONNECTED}),this._workerConnection.on(Se.CLOSED,()=>{this.connectionState=xa.CLOSED}),this._workerConnection.on(Se.FAILED,()=>{this.connectionState=xa.CLOSED}),this._workerConnection.on(Se.RECONNECTING,()=>{this.connectionState=this.connectionState===xa.CONNECTED?xa.RECONNECTING:xa.CONNECTING}),this._workerConnection.on(Se.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=o8(new Uint8Array(e.data));B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,T.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Jt.reportApiInvoke(this._connectInfo.sid||null,{name:ui.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Fn.TRACER}).onError(new nt(M.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},B("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else T.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Se.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on(Se.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=sa(this,gc.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(e,n);this._workerConnection.sendMessage(i,!0,!0)}else B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:i,cname:r,cid:a,vid:c,sid:l,uid:u}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),m=await zk(p,i,r),g=this._sequence+"-"+a+"-"+u+"-"+h+"-"+En(12,""),S={appId:i,cid:a,cname:r,deviceId:"",elapse:sI.intToLong(Number(h-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:g,sdkVersion:"4.23.2",sequence:this._sequence,sid:l,timestamp:S2(h),uid:u,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete S.callbackData;const D=a8(S);if(D.byteLength<this._workerMessageLengthLimit){if(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const w=function(N){for(var k=1;k<arguments.length;k++){var x=arguments[k]!=null?arguments[k]:{};k%2?y2(Object(x),!0).forEach(function(W){P(N,W,x[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(x)):y2(Object(x)).forEach(function(W){Object.defineProperty(N,W,Object.getOwnPropertyDescriptor(x,W))})}return N}({},S);delete w.jpg,T.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(w))}return D}{const w=this.quality*this._qualityRatio;return this.quality=w,await this.generateRequestData(e,{appId:i,cname:r,cid:a,vid:c,sid:l,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ss.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=xa.CLOSED,this.emit(gc.STATE_CHANGE,QE.CLOSED)}}function T2(t){if(cn(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new nt(M.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new nt(M.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const E8={name:"ImageModeration",create:function(t){let{config:e}=t;return T2(e),new sI(e)}};var v2,b2,R2,C2,A2,w2,I2,O2,N2,D2,L2,P2,k2,x2,M2,U2,j2,V2,B2,F2,G2,H2,W2,K2,z2,Y2,q2,X2,J2,Q2,Z2,$2,tU,eU,nU,iU,rU,sU,aU,oU,cU,kt;function lU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Io(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?lU(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}lr.setLogger(T);let _8=(v2=le(),b2=le({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof HE))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),R2=le({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==GE.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),C2=le({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),A2=le({argsMap:(t,e,n)=>[e,n]}),w2=le({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return[i==null?void 0:i.uid,r]})}),I2=le({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),O2=le({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return{uid:i==null?void 0:i.uid,mediaType:r}})}),N2=le(),D2=le(),L2=le(),P2=le(),k2=le(),x2=le(),M2=le(),U2=le(),j2=le(),V2=le(),B2=le(),F2=le(),G2=le(),H2=le(),W2=le(),K2=le({argsMap:(t,e)=>[e]}),z2=le(),Y2=le(),q2=le(),X2=le(),J2=le(),Q2=le(),Z2=le(),$2=le(),tU=le({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),eU=le(),nU=le(),iU=le(),rU=le(),sU=le(),aU=le(),oU=le({reportResult:!0}),cU=le(),kt=class extends Mn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,e){let n;if(super(),P(this,"store",void 0),P(this,"_uid",void 0),P(this,"_channelName",void 0),P(this,"_uintUid",void 0),P(this,"_users",[]),P(this,"_config",void 0),P(this,"_clientId",void 0),P(this,"_appId",void 0),P(this,"_sessionId",null),P(this,"_key",void 0),P(this,"_rtmConfig",{}),P(this,"_joinInfo",void 0),P(this,"_gateway",void 0),P(this,"_statsCollector",void 0),P(this,"_configDistribute",void 0),P(this,"_leaveMutex",void 0),P(this,"_publishMutex",void 0),P(this,"_renewTokenMutex",void 0),P(this,"_subscribeMutex",void 0),P(this,"_encryptionMode","none"),P(this,"_encryptionSecret",null),P(this,"_encryptionSalt",null),P(this,"_encryptDataStream",!1),P(this,"_encryptDataStreamKey",null),P(this,"_encryptDataStreamIv",null),P(this,"_proxyServer",void 0),P(this,"_turnServer",{servers:[],mode:"auto"}),P(this,"_cloudProxyServerMode","disabled"),P(this,"_isDualStreamEnabled",!1),P(this,"_defaultStreamFallbackType",void 0),P(this,"_lowStreamParameter",void 0),P(this,"_streamFallbackTypeCacheMap",new Map),P(this,"_remoteStreamTypeCacheMap",new Map),P(this,"_axiosCancelSource",ss.CancelToken.source()),P(this,"_audioVolumeIndicationInterval",void 0),P(this,"_networkQualityInterval",void 0),P(this,"_userOfflineTimeout",void 0),P(this,"_streamRemovedTimeout",void 0),P(this,"_liveTranscodeStreamingClient",void 0),P(this,"_liveRawStreamingClient",void 0),P(this,"_channelMediaRelayClient",void 0),P(this,"_networkQualitySensitivity","normal"),P(this,"_p2pChannel",void 0),P(this,"_useLocalAccessPoint",!1),P(this,"_setLocalAPVersion",void 0),P(this,"_joinAndNotLeaveYet",!1),P(this,"_numberOfJoinCount",0),P(this,"_remoteDefaultVideoStreamType",void 0),P(this,"_inspect",void 0),P(this,"_moderation",void 0),P(this,"_license",void 0),P(this,"_pendingPublishedUsers",[]),P(this,"ntpAlignErrorCount",0),P(this,"remoteInboundOffset",0),P(this,"_peerConnectionState",void 0),P(this,"_handleLocalTrackEnable",(r,a,c)=>{this.publish(r,!1).then(a).catch(c)}),P(this,"_handleLocalTrackDisable",(r,a,c)=>{this.unpublish(r).then(a).catch(c)}),P(this,"_handleUserOnline",r=>{if(B("BLOCK_LOCAL_CLIENT")&&cf(r.uid,this.channelName))return void T.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const a=this._users.find(c=>c.uid===r.uid);if(a)a._trust_in_room_=!0,a._is_pre_created&&(a._is_pre_created=!1,this.safeEmit(De.USER_JOINED,a));else{const c=new $u(r.uid,r.uint_id||r.uid);this._users.push(c),T.debug("[".concat(this._clientId,"] user online"),r.uid),this.safeEmit(De.USER_JOINED,c)}}),P(this,"_handleUserOffline",r=>{if(B("BLOCK_LOCAL_CLIENT")&&cf(r.uid,this.channelName))return;const a=this._users.find(c=>c.uid===r.uid);a&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),a._audio_pre_subscribed||a._video_pre_subscribed?a._is_pre_created=!0:Nb(this._users,a),this._remoteStreamTypeCacheMap.delete(a.uid),this._streamFallbackTypeCacheMap.delete(a.uid),T.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(De.USER_LEAVED,a,r.reason))}),P(this,"_handleAddAudioOrVideoStream",(r,a,c,l,u,h,p)=>{if(B("BLOCK_LOCAL_CLIENT")&&cf(a,this.channelName))return;const m=this._users.find(S=>S.uid===a);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(a,", type ").concat(r)),this.store.subscribe(m.uid,r,void 0,void 0,void 0,Date.now());const g=r==="audio"?m.hasAudio:m.hasVideo;m._uintid||(m._uintid=u||a),r==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,r==="audio"?(m._audio_added_=!0,c!==void 0&&(m._audioSSRC=c),l!==void 0&&(m._cname=l),h&&(m._audioOrtc=h)):(m._video_added_=!0,c!==void 0&&(m._videoSSRC=c),l!==void 0&&(m._cname=l),p!==void 0&&(m._rtxSsrcId=p),h&&(m._videoOrtc=h)),(r==="audio"?m.hasAudio:m.hasVideo)&&!g&&(T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(r)),this.safeEmit(De.USER_PUBLISHED,m,r)),r==="video"?Jt.onGatewayStream(this._sessionId,wi.ON_ADD_VIDEO_STREAM,Dn.ON_ADD_VIDEO_STREAM,{peer:u||a,ssrc:m._videoSSRC}):Jt.onGatewayStream(this._sessionId,wi.ON_ADD_AUDIO_STREAM,Dn.ON_ADD_AUDIO_STREAM,{peer:u||a,ssrc:m._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(m,r,c).then(S=>{if(S&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(m.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof ly))return this._p2pChannel.unsubscribe(m,r,!0).then(()=>this._subscribe(m,r,!0).catch(D=>{T.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(m,r)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,r,!0).catch(S=>{T.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),P(this,"_handleRemoveStream",r=>{if(B("BLOCK_LOCAL_CLIENT")&&cf(r.uid,this.channelName))return;const a=this._users.find(l=>l.uid===r.uid);if(!a)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let c=()=>{};a.hasAudio&&a.hasVideo?c=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.safeEmit(De.USER_UNPUBLISHED,a,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.safeEmit(De.USER_UNPUBLISHED,a,"video")}:a.hasVideo?c=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.safeEmit(De.USER_UNPUBLISHED,a,"video")}:a.hasAudio&&(c=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.safeEmit(De.USER_UNPUBLISHED,a,"audio")}),a._video_pre_subscribed||a._audio_pre_subscribed||(a._trust_audio_stream_added_state_=!0,a._trust_video_stream_added_state_=!0,a._audio_added_=!1,a._video_added_=!1,this._p2pChannel instanceof ly&&this._p2pChannel.unsubscribe(a).then(l=>{if(l)return this._gateway.unsubscribe(l,a.uid)}),a._audioSSRC=void 0,a._videoSSRC=void 0,a._audioOrtc=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0),Jt.onGatewayStream(this._sessionId,wi.ON_REMOVE_STREAM,Dn.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),c()}),P(this,"_handleSetStreamLocalEnable",(r,a,c)=>{if(B("BLOCK_LOCAL_CLIENT")&&cf(a,this.channelName))return;const l=this._users.find(p=>p.uid===a);if(!l)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(c?"enabled":"disabled"," with uid ").concat(a));const u=r==="audio"?l.hasAudio:l.hasVideo;if(r==="audio"){l._trust_audio_enabled_state_=!0;const p=l._audio_enabled_;if(l._audio_enabled_=c,l._audio_enabled_===p)return;{const m=l._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(a,", msg: ").concat(m)),this.safeEmit(De.USER_INFO_UPDATED,a,m)}}else{l._trust_video_enabled_state_=!0;const p=l._video_enabled_;if(l._video_enabled_=c,l._video_enabled_===p)return;{const m=l._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(m)),this.safeEmit(De.USER_INFO_UPDATED,a,m)}}const h=r==="audio"?l.hasAudio:l.hasVideo;return u!==h?!u&&h?(T.info("[".concat(this._clientId,"] remote user ").concat(a," published ").concat(r)),void this.safeEmit(De.USER_PUBLISHED,l,r)):(r==="video"&&l._videoTrack&&l._videoTrack._destroy(),r==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,r),T.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished ").concat(r)),void this.safeEmit(De.USER_UNPUBLISHED,l,r)):void 0}),P(this,"_handleMuteStream",(r,a,c)=>{if(B("BLOCK_LOCAL_CLIENT")&&cf(r,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),r,a,c);const l=this._users.find(p=>p.uid===r);if(!l)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));const u=a==="audio"?l.hasAudio:l.hasVideo;if(a==="audio"){l._trust_audio_mute_state_=!0;const p=l._audio_muted_;if(l._audio_muted_=c,l._audio_muted_===p)return;{const m=l._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(De.USER_INFO_UPDATED,r,m)}}else{l._trust_video_mute_state_=!0;const p=l._video_muted_;if(l._video_muted_=c,l._video_muted_===p)return;{const m=l._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(De.USER_INFO_UPDATED,r,m)}}const h=a==="audio"?l.hasAudio:l.hasVideo;if(u!==h){if(!u&&h)return(a==="audio"?l._audioSSRC:l._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(a)),void this.safeEmit(De.USER_PUBLISHED,l,a)):void T.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(a," unmute message  before add stream message, ").concat(a," SSRC doesn't exist yet."));a==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),a==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,a),T.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(a)),this.safeEmit(De.USER_UNPUBLISHED,l,a)}}),P(this,"_handleP2PLost",async r=>{T.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():T.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),P(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(De.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),P(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),P(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(De.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(De.NETWORK_QUALITY,r)}),P(this,"_handleP2PAddAudioOrVideoStream",(r,a,c,l)=>{const u=this._users.find(p=>p.uid===a);if(!u)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(a,", type ").concat(r)),this.store.subscribe(u.uid,r,void 0,void 0,void 0,Date.now());const h=r==="audio"?u.hasAudio:u.hasVideo;r==="audio"?u._trust_audio_stream_added_state_=!0:u._trust_video_stream_added_state_=!0,r==="audio"?(u._audio_added_=!0,c!==void 0&&(u._audioSSRC=c),l!==void 0&&(u._audioMid=l)):(u._video_added_=!0,c!==void 0&&(u._videoSSRC=c),l!==void 0&&(u._videoMid=l)),(r==="audio"?u.hasAudio:u.hasVideo)&&!h&&(T.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published ").concat(r)),this.safeEmit(De.USER_PUBLISHED,u,r)),this._p2pChannel.hasPendingRemoteMedia(u,r)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(u.uid," after reconnect.")),this._subscribe(u,r,!0).catch(p=>{T.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=t,this._clientId=e||En(5,"client-"),this.store=new class{constructor(r,a,c,l){fe(this,"state",void 0),this.state={codec:r,audioCodec:a,mode:c,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:tf.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(r){this.state=function(a,c){switch(c.type){case Le.SET_SESSION_ID:return Vt(Vt({},a),{},{sessionId:c.sessionId});case Le.SET_P2P_ID:return Vt(Vt({},a),{},{p2pId:c.p2pId});case Le.SET_UID:return Vt(Vt({},a),{},{uid:c.uid});case Le.SET_INT_UID:return Vt(Vt({},a),{},{intUid:c.intUid});case Le.SET_PUB_ID:return Vt(Vt({},a),{},{pubId:c.pubId});case Le.KEY_METRIC_CLIENT_CREATED:return Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{clientCreated:c.metric})});case Le.KEY_METRIC_JOIN_START:return Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{joinStart:c.metric})});case Le.AVOID_JOIN_START:return Vt(Vt({},a),{},{avoidJoinStart:c.avoidJoinStart});case Le.KEY_METRIC_JOIN_END:return Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{joinEnd:c.metric})});case Le.KEY_METRIC_REQUEST_AP_START:return Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{requestAPStart:c.metric})});case Le.KEY_METRIC_REQUEST_AP_END:return Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{requestAPEnd:c.metric})});case Le.KEY_METRIC_JOIN_GATEWAY_START:return Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{joinGatewayStart:c.metric})});case Le.KEY_METRIC_JOIN_GATEWAY_END:return Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{joinGatewayEnd:c.metric})});case Le.KEY_METRIC_PEER_CONNECTION_START:return Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{peerConnectionStart:c.metric})});case Le.KEY_METRIC_PEER_CONNECTION_END:return Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{peerConnectionEnd:c.metric})});case Le.KEY_METRIC_DESCRIPTION_START:return Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{descriptionStart:c.metric})});case Le.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{signalChannelOpen:c.metric})});case Le.KEY_METRIC_ICE_CONNECTION_END:return Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{iceConnectionEnd:c.metric})});case Le.KEY_METRIC_PUBLISH:{const l=a.keyMetrics.publish,u=l.findIndex(h=>h.trackId===c.metric.trackId);return u!==-1?(l[u]=Vt(Vt({},l[u]),c.metric),Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{publish:[...l]})})):Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{publish:[...a.keyMetrics.publish,c.metric]})})}case Le.KEY_METRIC_SUBSCRIBE:{const l=a.keyMetrics.subscribe,u=l.findIndex(h=>h.userId===c.metric.userId&&h.type===c.metric.type);return u!==-1?(l[u]=Vt(Vt({},l[u]),c.metric),Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{subscribe:[...l]})})):Vt(Vt({},a),{},{keyMetrics:Vt(Vt({},a.keyMetrics),{},{subscribe:[...a.keyMetrics.subscribe,c.metric]})})}case Le.SET_CLOUD_PROXY_SERVER_MODE:return a.cloudProxyServerMode=c.mode,a;case Le.RECORD_JOIN_CHANNEL_SERVICE:return typeof c.index!="number"?a.joinChannelServiceRecords=[...a.joinChannelServiceRecords,c.record]:(a.joinChannelServiceRecords[c.index]=Vt(Vt({},a.joinChannelServiceRecords[c.index]),c.record),a.joinChannelServiceRecords=[...a.joinChannelServiceRecords]),a;case Le.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return a.joinChannelServiceRecords=[],a;case Le.RESET_KEY_METRICS:return a.keyMetrics={publish:[],subscribe:[]},a;case Le.SET_USE_P2P:return Vt(Vt({},a),{},{useP2P:c.val});case Le.SET_TRANSPORT_TYPE:return Vt(Vt({},a),{},{p2pTransport:c.val});default:return a}}(this.state,r)}set sessionId(r){this.dispatch({type:Le.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}set cid(r){this.state.cid=r}get cid(){return this.state.cid}set codec(r){this.state.codec=r}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:Le.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:Le.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:Le.SET_UID,uid:r})}get uid(){return this.state.uid}set intUid(r){this.dispatch({type:Le.SET_INT_UID,intUid:r})}get intUid(){return this.state.intUid}set pubId(r){this.dispatch({type:Le.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:Le.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(r){this.dispatch({type:Le.SET_USE_P2P,val:r})}get useP2P(){return this.state.useP2P}set p2pTransport(r){this.dispatch({type:Le.SET_TRANSPORT_TYPE,val:r})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(r){this.state.hasStartJoinChannel=r}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(r){this.state.isABTestSuccess=r}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Le.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Le.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Le.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Le.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Le.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Le.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Le.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Le.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Le.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Le.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Le.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Le.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,a,c,l){this.dispatch({type:Le.KEY_METRIC_PUBLISH,metric:Vt(Vt({trackId:r,type:a},c&&{publishStart:c}),l&&{publishEnd:l})})}subscribe(r,a,c,l,u,h,p){this.dispatch({type:Le.KEY_METRIC_SUBSCRIBE,metric:Vt(Vt(Vt(Vt(Vt({userId:r,type:a},c&&{subscribeStart:c}),l&&{subscribeEnd:l}),u&&{firstFrame:u}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(r,a,c,l){r.forEach(u=>{this.dispatch({type:Le.KEY_METRIC_SUBSCRIBE,metric:Vt(Vt(Vt({userId:u.userId,type:u.type},a&&{subscribeStart:a}),c&&{subscribeEnd:c}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,a){r.service==="gateway"&&Array.isArray(r.urls)&&(r.urls=r.urls.map(c=>c.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof a!="number"?(this.dispatch({type:Le.RECORD_JOIN_CHANNEL_SERVICE,record:Vt(Vt({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(a<0||a>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Le.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:a}),a)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Le.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Le.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(r){this.dispatch({type:Le.AVOID_JOIN_START,avoidJoinStart:r})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new lr("client-leave",this._clientId),this._publishMutex=new lr("client-publish",this._clientId),this._renewTokenMutex=new lr("client-renewtoken",this._clientId),this._subscribeMutex=new lr("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(La," build: ").concat(QA,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{jA(t.clientRoleOptions),n=Object.assign({},t.clientRoleOptions)}catch(r){T.warning("[".concat(this._clientId,"] ").concat(r.toString()))}var i;this._statsCollector=new oy(this.store),this._statsCollector.onStatsException=(r,a,c)=>{T.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(a,", uid: ").concat(c)),this.safeEmit(De.EXCEPTION,{code:r,msg:a,uid:c})},this._statsCollector.onUploadPublishDuration=(r,a,c,l)=>{const u=this._users.find(h=>h.uid===r);u&&Jt.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:a,videoPublishDuration:c,peer:u._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new xH(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||hi,httpRetryConfig:t.httpRetryConfig||hi,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:n}),this._configDistribute=new KH(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},Rd("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new ly(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,i,r){let a=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];sn("JOIN_GATEWAY_USE_443PORT_ONLY",a),sn("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=this._gateway.signal.websocket;return l instanceof Nw&&(l.use443PortOnly=a,l.tryDoubleDomain=c),async function(u,h,p){Cb.get(u)||Cb.set(u,[]),Ab.get(u)||Ab.set(u,h),ll.get(u)||ll.set(u,0);const m=Cb.get(u),g=Ab.get(u);if(!m||!g)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(ll.get(u)===g){const k=jS();m.push(k),await k.promise}ll.set(u,ll.get(u)+1);for(var S=arguments.length,D=new Array(S>3?S-3:0),w=3;w<S;w++)D[w-3]=arguments[w];const N=await p(...D);return ll.set(u,ll.get(u)-1),ll.get(u)===g-1&&m.length>0&&(m[0].resolve(),m.shift()),ll.get(u)===0&&(Cb.set(u,[]),Ab.set(u,0),ll.set(u,0)),N}("client.join",B("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,i,r)}async join(t,e,n,i,r){const a=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=(Pb||Pb||(Pb=(window.location.protocol.split(":")[0]||"").toUpperCase(),Pb))==="HTTPS",l=ak()?window.isSecureContext:"Browser Not Support";(!ak()&&!c||!window.isSecureContext)&&T.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),T.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Jt.setAppId(t);try{if(!n&&n!==null)throw new nt(M.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Gi(n,"token",1,2047),Gi(t,"appid",1,2047),eR(e),i&&nR(i),r&&Gi(r,"optionalInfo",1,2047)}catch(w){throw Jt.reportApiInvoke($p(),{name:ui.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:Fn.TRACER}).onError(w),w}if(this._leaveMutex.isLocked&&(T.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),T.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const w=new nt(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Jt.reportApiInvoke($p(),{name:ui.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:Fn.TRACER}).onError(w),w}this._gateway.state="CONNECTING";const u=await s2({appId:t,cname:e,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new nt(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const h=(u==null?void 0:u.sid)||$p();T.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(a)),this._sessionId||(this._sessionId=h,this.store.sessionId=this._sessionId);const p=Jt.reportApiInvoke(h,{id:this._clientId,name:ui.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:Fn.TRACER}),m=Io(Io(Io({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:r,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!u},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:B("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(m.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(m.stringUid=i,this._uintUid?(m.uid=this._uintUid,this._uintUid=void 0):m.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(m.aesmode=this._encryptionMode,m.aespassword=await(async w=>{const N=function(Z){const $=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),q=new Uint8Array(new ArrayBuffer($.length));for(let ot=0;ot<$.length;ot+=1)q[ot]=$.charCodeAt(ot);return q}(),k=await window.crypto.subtle.importKey("spki",N,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),x=MA(w),W=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},k,x);return function(Z){let $="";for(let q=0;q<Z.length;q+=1)$+=String.fromCharCode(Z[q]);return window.btoa($)}(new Uint8Array(W))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new nt(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(m.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const w=new TextEncoder,N=B("USE_PURE_ENCRYPTION_MASTER_KEY")?w.encode(m.appId+this._encryptionSecret+this._encryptionSecret):w.encode(m.appId+m.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(k,x,W){const Z=await window.crypto.subtle.importKey("raw",x,"PBKDF2",!1,["deriveBits","deriveKey"]),$=k==="aes-128-gcm2"?128:256,q=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:Ek,hash:"SHA-256",salt:W},Z,$+uG);return new Uint8Array(q).subarray($/8)}(this._encryptionMode,N,Zp(this._encryptionSalt)),this._encryptDataStreamKey=await async function(k,x,W){const Z=await window.crypto.subtle.importKey("raw",x,"PBKDF2",!1,["deriveBits","deriveKey"]),$=k==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:Ek,hash:"SHA-256",salt:W},Z,{name:"AES-GCM",length:$},!0,["encrypt","decrypt"])}(this._encryptionMode,N,Zp(this._encryptionSalt))}else l?T.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):T.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,T.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:m.stringUid});const g=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&g===this._sessionId&&Jt.joinChannelTimeout(this._sessionId,5)},5e3);try{var S;let w;const N=m.cloudProxyServer;if(At(S=["proxy3","proxy4","proxy5"]).call(S,N)){const $=B("PROXY_SERVER_TYPE3");Array.isArray($)?m.proxyServer=$[0]:m.proxyServer=$}if(Jt.setProxyServer(m.proxyServer),T.setProxyServer(m.proxyServer),this.store.requestAPStart(),u){if(T.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(m.stringUid?", ".concat(m.stringUid," => ").concat(u.intUid):""," ")),m.stringUid&&!m.uid&&(m.uid=u.intUid),w={gatewayInfo:u.ap.gatewayInfo},B("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&m.turnServer.mode==="auto")if(u.ap.proxyInfo.addresses.length===0)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const $=(await Qx(u.ap.proxyInfo,u.ap.gatewayInfo.uid)).map(q=>({turnServerURL:q.address,tcpport:q.tcpport||nr.tcpport,udpport:q.udpport||nr.udpport,username:q.username||nr.username,password:q.password||nr.password,forceturn:!1,security:!0}));m.turnServer={mode:"manual",servers:$}}c2(u,m.stringUid)}else{if(m.stringUid&&!m.uid){let $;[$,w]=await wt.all([CM(m.stringUid,m,this._axiosCancelSource.token,this._config.httpRetryConfig||hi,this.store),RM(m,this._axiosCancelSource.token,this._config.httpRetryConfig||hi,!0,this.store)]),T.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(m.stringUid," => ").concat($)),m.uid=$,w.gatewayInfo.uid=$,w.gatewayInfo.res.uid=$}else w=await RM(m,this._axiosCancelSource.token,this._config.httpRetryConfig||hi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new nt(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(m,this._axiosCancelSource.token),this._configDistribute.on(ZS.UPDATE_BITRATE_LIMIT,$=>{this._p2pChannel.updateBitrateLimit($)}),this._configDistribute.on(ZS.UPDATE_CLIENT_ROLE_OPTIONS,$=>{this._setClientRoleOptions($)})},0),this._key=n||t;const k=w.gatewayInfo,x=m.uid?m.uid:k.uid;this._joinInfo=Io(Io({},m),{},{cid:k.cid,uid:x,vid:k.vid,apResponse:k.res,apGatewayAddress:k.apGatewayAddress,uni_lbs_ip:k.uni_lbs_ip,gatewayAddrs:k.gatewayAddrs}),this.store.intUid=x,this.store.cid=k.cid;const W=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new nt(M.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));p.onSuccess(W),this._appId=t,this._channelName=m.cname,this._uid=W,this.store.uid=W,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener($i()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Z=m.stringUid?"string uid: ".concat(m.stringUid,",uid: ").concat(m.uid):"uid: ".concat(this._uid);return T.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(Z)),setTimeout(()=>{T.startUpload()},5e3),this.store.joinEnd(),D=this,At(of).call(of,D)||of.push(D),this._cloudProxyServerMode==="disabled"&&Ke().supportWebCrypto&&B("ENABLE_PRELOAD")&&iI(this._joinInfo),W}catch(w){const N=Array.isArray(w)?w[0]:w;throw N&&N.code===M.OPERATION_ABORTED?T.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),N):T.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),N),N.code!==M.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),p.onError(N),N}var D}_joinGateway(){if(!this._joinInfo||!this._key)throw new nt(M.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!B("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){T.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener($i()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=of.indexOf(e);n!==-1&&of.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return T.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Ze.LEAVE),T.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof HE))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new nt(M.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new nt(M.INVALID_OPERATION,"audience can not publish stream");for(const r of n){if(!(r instanceof HE))throw new nt(M.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&e)throw new nt(M.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}T.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(r=>{const a=this._configDistribute.getBitrateLimit();r instanceof wn&&a&&r.setBitrateLimit(a.uplink)});try{await this._publishHighStream(n),T.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw T.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{i()}}async _publishDataChannel(t){cn(t.id,"id",0,65535,!0),_d(t.ordered,"ordered"),Gi(t.metadata,"metadata",0,512),T.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===t.id)!==-1)throw new nt(M.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new nt(M.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new nt(M.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(r){return mM(r,!1)}(t),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new nt(M.CREATE_DATACHANNEL_ERROR);try{await wt.all(i.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await n._waitTillOpen()}catch(r){if(r.code!==M.DISCONNECT_P2P)throw r}}return T.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw T.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new nt(M.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof HE))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);T.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.sendExtensionMessage(ei.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.unpublish(i,this._uid),T.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}}catch(i){throw T.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),T.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),T.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(i=>"".concat(i.id))))}catch(n){throw T.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof $u)){const i=this.remoteUsers.find(r=>r.uid===t);if(!i)throw new nt(M.INVALID_REMOTE_USER,"user is not in the channel");t=i}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(bi(e,"mediaType",["audio","video"]),this.store.useP2P)throw new nt(M.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new nt(M.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===Bt.AUDIO,i=e===Bt.VIDEO,r=await this._subscribeMutex.lock();try{const{ssrcId:a,ortc:c,rtxSsrcId:l,cname:u,uint_id:h}=await this._gateway.presubscribe(t,e,!0);if(a==null)throw new nt(M.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(g=>g.uid===t);p||(p=new $u(t,h||t),p._is_pre_created=!0,this._users.push(p)),u&&(p._cname=u),p._uintid||(p._uintid=h||t),n&&(p._audioSSRC=a,p._audio_pre_subscribed=!0,c&&(p._audioOrtc=c)),i&&(p._videoSSRC=a,p._video_pre_subscribed=!0,c&&(p._videoOrtc=c),l!=null&&(p._rtxSsrcId=l)),T.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(a)),await this._p2pChannel.subscribe(p,e,a,l,c);const m=n?p._audioTrack:p._videoTrack;if(!m)throw new nt(M.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),i&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),m}catch(a){throw T.error("[".concat(this._clientId,"] presub user ").concat(t," error"),a),a}finally{r()}}async _subscribeDataChannel(t,e){var n;if(cn(e,"channelId",0,65535,!0),!this._joinInfo)throw new nt(M.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===t))throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new nt(M.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new nt(M.INVALID_REMOTE_USER,"user is not published");const r=(n=t._dataChannels)===null||n===void 0?void 0:n.find(l=>l.id===e);if(!r)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new nt(M.REMOTE_USER_IS_NOT_PUBLISHED);const a=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const l=await this._p2pChannel.subscribeDataChannel(t,[r]);if(l&&At(l).call(l,r.id))try{var c;if(typeof r._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new nt(M.CREATE_DATACHANNEL_ERROR);const u={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(c=r.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(t.uid,u,!0),await r._waitTillOpen()}catch(u){if((u==null?void 0:u.code)!==M.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[r]),u;await this._p2pChannel.unsubscribeDataChannel(t,[r]),this._p2pChannel.setPendingRemoteDataChannel(t,r.id)}return T.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),r}finally{a()}}async _p2pSubscribe(t,e,n){if(bi(e,"mediaType",["audio","video"]),!this._joinInfo)throw new nt(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===t)){const a=new nt(M.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),a}if(!t.hasAudio&&!t.hasVideo){const a=new nt(M.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),a}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const a=new nt(M.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),a}const r=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const c=e==="audio"?t._audioSSRC:t._videoSSRC,l=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,e,c,l)}catch(c){throw c}T.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(c=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const a=e==="audio"?t._audioTrack:t._videoTrack;if(!a)throw new nt(M.UNEXPECTED_ERROR,"can not find remote track in user object");return a}catch(a){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),a),a}finally{r()}}async _subscribe(t,e,n){if(this.store.useP2P)return this._p2pSubscribe(t,e);if(bi(e,"mediaType",["audio","video"]),!this._joinInfo)throw new nt(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===t)){const h=new nt(M.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),h}if(!t.hasAudio&&!t.hasVideo){const h=new nt(M.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),h}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const h=new nt(M.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),h}let r=e==="audio"?t._audioSSRC:t._videoSSRC,a=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?Bt.AUDIO:Bt.VIDEO,ssrcId:r};const u=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const p=e==="audio"?t._audioSSRC:t._videoSSRC;p!==void 0&&p!==r&&(r=p,a=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?Bt.AUDIO:Bt.VIDEO,ssrcId:r}),hr.markSubscribeStart(this.store.clientId,r),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,r,c,a);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(t.uid,l,!0)}catch(m){if((m==null?void 0:m.code)!==M.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),m;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(p){throw this._p2pChannel.reportSubscribeEvent(!1,p==null?void 0:p.code,t,e),p}T.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(p=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const h=e==="audio"?t._audioTrack:t._videoTrack;if(!h)throw new nt(M.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),h),h}finally{u()}}async massSubscribe(t){if(gd(t,"subscribeList"),!this._joinInfo)throw new nt(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,i=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(l=>{let{user:u,mediaType:h}=l;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(h)}).join("; ")));const r=(t=[...t]).map(l=>{let{user:u,mediaType:h}=l;return{user:u,mediaType:h}}),a=await this._p2pChannel.globalLock();try{var c;for(let u=t.length-1;u>=0;u--){const h=t[u],{user:p,mediaType:m}=h;if(bi(m,"mediaType",["audio","video"]),!p){const w=new nt(M.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),w}if(!this._users.find(w=>w===p)){const w=new nt(M.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),r[u].error=w,t.splice(u,1);continue}if(m==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||m==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){const w=new nt(M.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(m,", remote user is not published")),r[u].error=w,t.splice(u,1);continue}const S=Ii.Video|Ii.LwoVideo,D=n.get(p);if(D){if(m==="video"?D&S:D&Ii.Audio){t.splice(u,1),T.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(m," twice"));continue}n.set(p,D|(m==="video"?S:Ii.Audio))}else n.set(p,m==="video"?S:Ii.Audio)}for(let u=t.length-1;u>=0;u--){const h=t[u],{user:p,mediaType:m}=h,g=Ii.Video|Ii.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,m)){await this._p2pChannel.unmuteRemoteNoLock(p,m);const S=n.get(p);n.set(p,m==="video"?S^g:S^Ii.Audio),t.splice(u,1)}}this.store.massSubscribe(t.map(u=>({userId:u.user.uid,type:u.mediaType})),e);let l=ms(c=Array.from(n.entries())).call(c,(u,h)=>{let[p,m]=h;if(m===0)return u;const g={stream_id:p.uid,stream_type:m};return m&Ii.Audio&&(g.audio_ssrc=p._audioSSRC),m&Ii.Video&&(g.video_ssrc=p._videoSSRC),u.push(g),u},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(h=>{let{user:p,mediaType:m}=h;return{user:p,mediaType:m,ssrcId:m===Bt.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:m===Bt.VIDEO?p._rtxSsrcId:void 0}}));const u=new Map;if(l=l.filter(h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc),l.length>0){const h=await this._gateway.subscribeAll(l,!0);((h==null?void 0:h.users)||[]).forEach(p=>{let{stream_id:m,video_error_code:g,audio_error_code:S,error_code:D}=p;(g||S||D)&&u.set(m,{video_error_code:g,audio_error_code:S,error_code:D})})}if(Array.from(u.entries()).length>0){const h=[];Array.from(u.entries()).forEach(p=>{let[m,g]=p;const S=this.remoteUsers.find(D=>D.uid===m);if(S){let D;g.error_code||g.video_error_code&&g.audio_error_code?D=void 0:g.video_error_code?D=Bt.VIDEO:g.audio_error_code&&(D=Bt.AUDIO),h.push({user:S,mediaType:D})}}),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(const h of r){const p=u.get(h.user.uid);if(p){const m=p.error_code||h.mediaType==="audio"&&p.audio_error_code||h.mediaType==="video"&&p.video_error_code;if(m){const g=$S(m);T.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(g.desc)),h.error=new nt(M.SUBSCRIBE_FAILED,"code ".concat(m,": ").concat(g.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(r.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),r.forEach(h=>{var p;Jt.subscribe(this.store.sessionId,{succ:!!h.error,ec:((p=h.error)===null||p===void 0?void 0:p.code)||null,video:h.mediaType===Bt.VIDEO,audio:h.mediaType===Bt.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===Bt.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)}),T.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(h=>{let{user:p,mediaType:m}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(m)}).join("; "))),r}catch(u){throw await this._p2pChannel.massUnsubscribeNoLock(t),u}}finally{a(),i()}}async unsubscribe(t,e,n){if(!(t instanceof $u)){const a=this.remoteUsers.find(c=>c.uid===t);if(!a)throw new nt(M.INVALID_REMOTE_USER,"user is not in the channel");t=a}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&bi(e,"mediaType",["audio","video"]),!this._joinInfo)throw new nt(M.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(a=>a===t)){const a=new nt(M.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),a}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const r=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,e);else{const a=await this._p2pChannel.unsubscribe(t,e);a&&await this._gateway.unsubscribe(a,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&Nb(this._users,t),T.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(a){if(a.code===M.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),a.toString()),a}finally{r()}}async _unsubscribeDataChannel(t,e){if(e&&cn(e,"id",0,65535,!0),!this._joinInfo)throw new nt(M.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===t)){const r=new nt(M.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r}let i;if(typeof e=="number"){const r=t._dataChannels.find(a=>a.id===e);r&&(i=[r])}else i=t._dataChannels;if(i===void 0){const r=new nt(M.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),r}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{const r=await this._p2pChannel.unsubscribeDataChannel(t,i);r&&await this._gateway.unsubscribeDataChannel(r,t.uid),T.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===M.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),r.toString()),r}}async massUnsubscribe(t){if(gd(t,"unsubscribeList"),!this._joinInfo)throw new nt(M.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:i,mediaType:r}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(r,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:i,mediaType:r}=t[n];if(!i){const l=new nt(M.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(bi(r,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===i)){T.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),t.splice(n,1);continue}const c=Ii.Video|Ii.LwoVideo;if(e.has(i)){const l=e.get(i);let u;switch(r){case"video":u=l&c;break;case"audio":u=l&Ii.Audio;break;default:u=l&(Ii.Audio|c)}if(u){T.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),t.splice(n,1);continue}r?r==="audio"?e.set(i,l|Ii.Audio):r==="video"&&e.set(i,l|c):e.set(i,l|Ii.Audio|c)}else r?r==="audio"?e.set(i,Ii.Audio):r==="video"&&e.set(i,c):e.set(i,Ii.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),T.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(i=>{let{user:r,mediaType:a}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(a,";")}).join()))}catch(n){if(n.code===M.DISCONNECT_P2P)return void T.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw T.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new ct(M.INVALID_PARAMS);Bn(n.width)||kA(n.width,"streamParameter.width"),Bn(n.height)||kA(n.height,"streamParameter.height"),Bn(n.framerate)||kA(n.framerate,"streamParameter.framerate"),Bn(n.bitrate)||cn(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&T.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Et.LocalVideoLowTrack)}async enableDualStream(){if(!Ke().supportDualStream)throw Jt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new nt(M.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new nt(M.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Jt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Jt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new nt(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Et.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Jt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Jt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){bi(i,"role",["audience","host"])}(t),e&&jA(e),this.mode==="rtc"||this.mode==="p2p")throw T.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new nt(M.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new nt(M.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new nt(M.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==n&&B("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,e),this._config.role=t,this._gateway.reconnect("recover",tr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,e),this._config.role=t),T.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{t&&jA(t),await this._gateway.setClientRole(this._config.role,t),e=!0}catch{}finally{T.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(Gi(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new nt(M.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new nt(M.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Jt.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new nt(M.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new nt(M.INVALID_OPERATION,"You have already set the proxy")}if(HS(t))return this._turnServer={servers:t,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>qP(n)),this._turnServer={servers:t,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new nt(M.INVALID_OPERATION,"you should set license before join channel");if(Gi(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new nt(M.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,T.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new nt(M.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new nt(M.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new nt(M.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new nt(M.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new nt(M.INVALID_OPERATION,"Stop proxy server after leave channel");Jt.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new nt(M.INVALID_PARAMS,"accessPoints is required.");gd(t.accessPoints.serverList,"accessPoints.serverList"),Gi(t.accessPoints.domain,"accessPoints.domain");const e=(g,S)=>{cn(g,S,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new nt(M.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");B("CLOSE_AFB_FOR_LOCAL_AP")&&(sn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),sn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=t.accessPoints.domain,a=t.accessPoints.serverList.map(g=>i.test(g)?"".concat(g.replace(/\./g,"-"),".").concat(r):g),c=a.map(g=>"".concat(g,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,sn("WEBCS_DOMAIN",c),sn("WEBCS_DOMAIN_BACKUP_LIST",c),sn("GATEWAY_DOMAINS",[r]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(gd(t.report.hostname,"report.hostname"),sn("EVENT_REPORT_DOMAIN",t.report.hostname[0]),sn("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(sn("EVENT_REPORT_DOMAIN",a[0]),sn("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let l=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),l=t.report.port),sn("STATS_COLLECTOR_PORT",l),t.report?sn("ENABLE_EVENT_REPORT",!0):sn("ENABLE_EVENT_REPORT",!1);let u="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(gd(t.log.hostname,"log.hostname"),u=t.log.hostname[0]):u=a[0];let h=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),h=t.log.port),sn("LOG_UPLOAD_SERVER","".concat(u,":").concat(h));let p=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(gd(t.cds.hostname,"cds.hostname"),p=t.cds.hostname):p=a;let m=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),m=t.cds.port),sn("CDS_AP",p.map(g=>"".concat(g,":").concat(m))),t.cds?sn("ENABLE_CONFIG_DISTRIBUTE",!0):sn("ENABLE_CONFIG_DISTRIBUTE",!1),T.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(gd(t,"serverList"),Gi(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new nt(M.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(e):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,sn("WEBCS_DOMAIN",t),sn("WEBCS_DOMAIN_BACKUP_LIST",t),sn("GATEWAY_DOMAINS",[e]),sn("EVENT_REPORT_DOMAIN",t[0]),sn("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),sn("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),T.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(bi(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw T.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else T.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){bi(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(i=>i.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw T.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){bi(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw T.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,i){(function(a){bi(a,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Gi(e,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(At(r).call(r,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new nt(M.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new nt(M.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(_d(i,"encryptDataStream"),!At(r).call(r,t))throw new nt(M.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||T.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=Ku(n))}async renewToken(t){if(Gi(t,"token",1,2047),!this._key||!this._joinInfo)throw new nt(M.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(B("USE_NEW_TOKEN")){T.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await WH(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||hi);T.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:i})}else T.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});T.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=e,this._joinInfo.token=e,T.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(De.VOLUME_INDICATOR,t)},B("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new nt(M.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new nt(M.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new nt(M.LIVE_STREAMING_TASK_CONFLICT);const n=e?Td.TRANSCODE:Td.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(Td.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new nt(M.INVALID_PARAMS,"can not find live streaming url to stop");await wt.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){LM(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){LM(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof ly&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new nt(M.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const r=new TextEncoder;t.payload=r.encode(t.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&At(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(i=!0,t.payload=await async function(r,a,c){var l;const u=ms(l=Array.from(c)).call(l,(w,N)=>w+N,0),h={serverTs:0,seq:hG++,length:c.length,checkSum:u},p=new Uint8Array(nk(u,2)),m=new ArrayBuffer(ME),g=new DataView(m);g.setUint32(0,h.serverTs),g.setUint16(4,h.seq),g.setUint16(6,h.length),g.setUint16(8,h.checkSum);const S=16-c.length%16;c=QP(c,new Uint8Array(S));const D=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:mk,additionalData:p},a,c);return QP(new Uint8Array(m),new Uint8Array(D))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new nt(M.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ue.DATA_STREAM,{payload:Ku(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-$H},!n)}sendMetadata(t){if(!this._joinInfo)throw new nt(M.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new nt(M.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ue.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ku(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(TG),!this._joinInfo)throw new nt(M.INVALID_OPERATION,"can not send custom report, not joined");await Jt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){bi(e.spatialLayer,"spatialLayer",[0,1,2,3]),bi(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw T.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(_d(e,"apRTM"),cn(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,T.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),function(t){const e=XE.indexOf(t);e!==-1&&XE.splice(e,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=ss.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&o2(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Jt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new lr("client-publish",this._clientId),this._subscribeMutex=new lr("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const i=t||$p();t?T.debug("[".concat(this._clientId,"] new Session ").concat(i)):T.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const r=t?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,Jt.addSid(i);const a={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};Jt.sessionInit(this._sessionId,Io({cname:e.channel,appid:e.appId},a)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new nt(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new nt(M.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(ei.PUBLISH,i,!0)}catch(r){throw n.throw(r),r}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(a){if(a.code!==M.DISCONNECT_P2P)throw n.throw(a),a}await n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of t)r instanceof wn&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig).catch(a=>{T.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===M.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new nt(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new nt(M.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));T.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(a){if(a.code!==M.DISCONNECT_P2P)throw n.throw(a),a}n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===M.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new nt(M.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Rd("LiveStreaming").create(i));var i;return n.onLiveStreamError=(r,a)=>{Jt.reportApiInvoke(this._sessionId,{name:ui.ON_LIVE_STREAM_ERROR,options:[r,a],tag:Fn.TRACER}).onSuccess(),this.safeEmit(De.LIVE_STREAMING_ERROR,r,a)},n.onLiveStreamWarning=(r,a)=>{Jt.reportApiInvoke(this._sessionId,{name:ui.ON_LIVE_STREAM_WARNING,options:[r,a],tag:Fn.TRACER}).onSuccess(),this.safeEmit(De.LIVE_STREAMING_WARNING,r,a)},n.on(Iw.REQUEST_WORKER_MANAGER_LIST,(r,a,c)=>{if(!this._joinInfo)return c(new nt(M.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(l,u,h,p){const m=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(g=>u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(g+"/api/v1?action=uap"):"https://".concat(g,"/api/v1?action=uap"));return await jH(m,l,u,h,p)})(r,this._joinInfo,this._axiosCancelSource.token,hi).then(a).catch(c)}),n};return t===Td.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new nt(M.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},Rd("ChannelMediaRelay").create(t));i.on("state",r=>{r===Ts.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(De.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(De.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,a)=>{var c;r==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(a))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:i}=t,r=[];if(e){const a=[];this._users.forEach(c=>{c._dataChannels.forEach(l=>{n.every(u=>u.uid!==c._uintid||u.stream_id!==l.id)&&a.push({uid:c._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),a.length>0&&this._handleUpdateDataChannel({added:[],deleted:a})}Array.isArray(n)&&n.length>0&&n.forEach(a=>{const{uid:c,stream_id:l,ordered:u,max_retrans_times:h,metadata:p}=a,m=this._users.find(g=>g._uintid===c);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(T.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),At(r).call(r,m)||r.push(m),m._uintid||(m._uintid=c),m._dataChannels.findIndex(g=>g.id===a.stream_id)===-1){const g={id:l,ordered:!!u,maxRetransmits:h,metadata:p},S=function(D){return mM(D,!0)}(g);m._dataChannels.push(S),T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published datachannel")),e||this.safeEmit(De.USER_PUBLISHED,m,"datachannel",g)}this._p2pChannel.hasPendingRemoteDataChannel(m,a.stream_id)&&(T.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(m.uid," after reconnect.")),this._subscribeDataChannel(m,a.stream_id).catch(g=>{T.error("[".concat(this._clientId,"] resubscribe datachannel error"),g.toString())}))}),e&&(this.safeEmit(De.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(a=>{const{uid:c,stream_id:l}=a,u=this._users.find(p=>p._uintid===c);if(!u)return void T.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const h=u._dataChannels.find(p=>p.id===a.stream_id);h&&(T.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(u,[h]).then(p=>{if(u._dataChannels=u._dataChannels.filter(m=>m!==h),p)return this._gateway.unsubscribeDataChannel(p,u.uid)}),T.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(De.USER_UNPUBLISHED,u,"datachannel",h._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){T.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(i=>{this.safeEmit(De.USER_UNPUBLISHED,e,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,e.uid)}),n()}}else T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Ui.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void T.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();Object.keys(e).forEach(i=>{const{value:r,type:a,expires:c}=e[i];c&&c<=n||a||Tw()||!Object.prototype.hasOwnProperty.call(Mb,i)||(mc[i]=r,An[i]=r,T.debug("Update gateway parameters from config distribute",i,r))})}catch(e){T.error("Error update config from local cache",e.message)}})()}),this._gateway.on(Ui.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Ui.CONNECTION_STATE_CHANGE,(t,e,n)=>{var i;if(n===Ze.FALLBACK)return;const r=()=>{this.safeEmit(De.CONNECTION_STATE_CHANGE,t,e,n)};if(Jt.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:ui.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:Fn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),T.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void r();if(t==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var a;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(u=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),u)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(u=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),u)})}),this._remoteDefaultVideoStreamType!==void 0&&((a=this._joinInfo)===null||a===void 0?void 0:a.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,Bt.AUDIO,!1)),c._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,Bt.VIDEO,!1)),c._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}r()}),this._gateway.on(Ui.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new nt(M.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await s2(Io(Io({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,c2(i),this._joinInfo.preload=!0):(n=await Ww(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||hi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(a=>{let{address:c}=a;const[l,u]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:l,port:u}):r.push({host:l,port:u})}),t(r)}catch(n){e(n)}}),this._gateway.on(Ui.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(De.NETWORK_QUALITY,t)}),this._gateway.on(Ui.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(De.STREAM_TYPE_CHANGED,t,e),Jt.reportApiInvoke(this._sessionId,{name:ui.STREAM_TYPE_CHANGE,options:[t,e],tag:Fn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(Ui.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(Ui.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let i=await this._p2pChannel.getEstablishParams();B("ENABLE_PREALLOC_PC")&&i||(i=await this._p2pChannel.startP2PConnection(t)),e(i)}catch(i){n(i)}}),this._gateway.on(Ui.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;let n;t.attributes?n=t.attributes.userAttributes.preSubSsrcs:T.debug("no attributes in joinResponse");const i=iM(t.ortc,e,n);this._p2pChannel.connect(i)}),this._gateway.on(Ui.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:r,cid:a}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(a,"_").concat(r),icePwd:"".concat(a,"_").concat(r)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=B("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Pe.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Pe.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Pe.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(Pe.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(Pe.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(Pe.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Pe.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Pe.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Pe.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Bt.AUDIO,!0)),this._gateway.signal.on(Pe.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Bt.AUDIO,!1)),this._gateway.signal.on(Pe.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Bt.VIDEO,!0)),this._gateway.signal.on(Pe.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Bt.VIDEO,!1)),this._gateway.signal.on(Pe.RECEIVE_METADATA,t=>{const e=Zp(t.metadata);this.safeEmit(De.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(Pe.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=Zp(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&At(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<ME)throw new nt(M.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(ME));n=await async function(a,c,l){const u=l.subarray(0,ME),h=u.slice(8,ME),p=(h[0]<<8)+h[1],m=(u[6]<<8)+u[7],g=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a,tagLength:mk,additionalData:new Uint8Array(nk(p,2))},c,l.subarray(ME));return new Uint8Array(g).subarray(0,m)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(t.ordered||t.syncWithAudio){const r=this._p2pChannel.getStats(),a=this.remoteUsers.find(l=>l.uid===t.uid),c=r==null?void 0:r.audioRecv.find(l=>l.ssrc===(a==null?void 0:a._audioSSRC));i=c==null?void 0:c.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),e8(Io(Io({},t),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Pe.ON_CRYPT_ERROR,()=>{Wu(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(De.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Pe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ze.TOKEN_EXPIRE),this.safeEmit(De.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Pe.ON_STREAM_FALLBACK_UPDATE,t=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(De.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Pe.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(Pe.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(Pe.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(pe.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case ue.PUBLISH:{if(!e)return;const r=e.ortc;if(r){var n,i;const a=r.some(u=>{let{stream_type:h}=u;return h===tn.Audio}),c=r.some(u=>{let{stream_type:h}=u;return h!==tn.Audio}),l=r.some(u=>{let{stream_type:h}=u;return h===tn.Screen||h===tn.ScreenLow});e.state==="offer"&&Jt.publish(this._joinInfo.sid,{eventElapse:hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:M.TIMEOUT,audio:a,video:c,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:a?(n=r.find(u=>{let{stream_type:h}=u;return h===tn.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(i=r.find(u=>{let{stream_type:h}=u;return h!==tn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case ue.SUBSCRIBE:e&&Jt.subscribe(this._joinInfo.sid,{succ:!1,ec:M.TIMEOUT,audio:e.stream_type===Bt.AUDIO,video:e.stream_type===Bt.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:hr.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(Pe.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(Pe.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;B("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(i=>!cf(i.string_id||i.stream_id,this.channelName)));const e=[],n=[];for(const i of t.users){let r=this._users.find(p=>p._uintid===i.stream_id);r?r._trust_in_room_=!0:(r=new $u(i.string_id||i.stream_id,i.stream_id),this._users.push(r),this.getListeners(De.PUBLISHED_USER_LIST).length===0&&(T.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(De.USER_JOINED,r)));const a=Ii.Audio&i.stream_type,c=(Ii.Video|Ii.LwoVideo)&i.stream_type,l=(65280&i.stream_type)!=0,u=a&&r.hasAudio,h=c&&r.hasVideo;c&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=i.video_ssrc,r._rtxSsrcId=i.video_rtx),a&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=i.audio_ssrc),a&&!u&&this.getListeners(De.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(De.USER_PUBLISHED,r,"audio")),c&&!h&&this.getListeners(De.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(De.USER_PUBLISHED,r,"video")),(a&&!u||c&&!h||l)&&e.push(r),c&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&n.push({user:r,mediaType:"video"}),a&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&n.push({user:r,mediaType:"audio"})}n.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(De.PUBLISHED_USER_LIST).length>0?B("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(i=>i.uid).join(", "))),this.safeEmit(De.PUBLISHED_USER_LIST,e)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(Pe.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof ly&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var i;return At(i=Object.keys(Ub)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Pe.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ei.PUBLISH,(t,e,n)=>{const{uid:i}=t;t.forEach(r=>{const{kind:a,ssrcs:c,mid:l,isMuted:u}=r;this._handleP2PAddAudioOrVideoStream(a,i,c[0].ssrcId,l);const h=this._users.find(p=>p.uid===i);return h&&this.store.useP2P?this._p2pChannel.mockSubscribe(h,a,c[0].ssrcId,l).then(()=>{e()}).catch(n):e(),this._handleMuteStream(i,a,!!u)})}),this._gateway.signal.on(ei.CALL,async(t,e,n)=>{if(this.store.useP2P)try{var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}catch(r){n(r)}}),this._gateway.signal.on(pe.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(ei.UNPUBLISH,async(t,e,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:r}=t,a=this._users.find(c=>c.uid===r);if(!a)return T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();try{i.forEach(async c=>{let{stream_type:l}=c;const u=l===tn.Audio?Bt.AUDIO:Bt.VIDEO;await this._p2pChannel.unsubscribe(a,u),this._handleMuteStream(r,u,!0)}),e()}catch(c){n(c)}}}),this._gateway.signal.on(ei.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case qu.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,Bt.VIDEO,!0);break;case qu.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,Bt.AUDIO,!0);break;case qu.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,Bt.VIDEO,!1);break;case qu.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,Bt.AUDIO,!1)}}),this._gateway.signal.on(ei.RESTART_ICE,async(t,e,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:r}=t;i!==Jr.SEND_ONLY||r?e(await this._p2pChannel.restartICE(i,r)):(this._p2pChannel.handleDisconnect(i),e())}catch(i){n(i)}}),this._gateway.signal.on(ei.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(ee.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:i}=t;e(await this._gateway.sendExtensionMessage(ei.RESTART_ICE,t,i===Jr.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(ee.LocalCandidate,t=>{this._gateway.sendExtensionMessage(ei.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(ee.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(ei.CONTROL,t,!0),e()}catch(i){n(i)}}),this._p2pChannel.on(ee.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===M.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(ee.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===M.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(ee.StateChange,(t,e)=>{e===$e.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(ee.PeerConnectionStateChange,t=>{const e=this._peerConnectionState;t!==e&&(this.safeEmit(De.PEERCONNECTION_STATE_CHANGE,t,e),this._peerConnectionState=t)}),this._p2pChannel.on(ee.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===M.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(ee.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===M.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(ee.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(ee.RequestRePublishDataChannel,(t,e,n)=>{wt.all(t.map(async i=>{const r=await this._p2pChannel.publishDataChannel([i]);try{r.forEach(a=>{this._uid&&this._gateway.publishDataChannel(this._uid,a,!0)})}catch(a){if(a.code!==M.DISCONNECT_P2P)throw a}})).then(e).catch(n)}),this._p2pChannel.on(ee.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:i,kind:r}of t)r===Bt.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");e()}catch(i){n(i)}}),this._p2pChannel.on(ee.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(ee.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(ee.MediaReconnectStart,t=>{this.safeEmit(De.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(ee.MediaReconnectEnd,t=>{this.safeEmit(De.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(ee.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(ee.RequestRestartICE,async t=>{if(this.store.useP2P)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const i=n.value;let r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(c){return void e.throw(c)}const{iceParameters:a}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(r);await e.next({remoteIceParameters:a})}),this._p2pChannel.on(ee.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(ee.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:r,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:i}),c=iM(r,a);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(ee.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(ee.P2PLost,()=>{this.safeEmit(De.P2P_LOST,this.store.uid)}),this._p2pChannel.on(ee.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(ee.ConnectionTypeChange,t=>{this.safeEmit(De.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(ee.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(ee.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(ee.AudioMetadata,t=>{this.safeEmit(De.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new nt(M.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new nt(M.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},Rd("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:r,sid:a,token:c,uid:l,cid:u,vid:h}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:r,sid:a,token:c,uid:l,cid:u,vid:h?Number(h):0},hi)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(ji.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(De.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===Ro.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(De.CONTENT_INSPECT_ERROR,new nt(M.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(ji.INSPECT_RESULT,(e,n)=>{var i;if((n==null?void 0:n.code)===M.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return T.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(De.CONTENT_INSPECT_RESULT,e,n)}),t.on(ji.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new nt(M.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(_d(t,"enabled"),t){if(!e)throw new nt(M.INVALID_PARAMS,"config is required");if(T2(e),!this._joinInfo)throw new nt(M.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const i=(n={config:e},Rd("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:r,cname:a,sid:c,token:l,uid:u,cid:h,vid:p}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:a,sid:c,token:l,uid:u,cid:h,vid:p?Number(p):0},hi)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new nt(M.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(gc.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(De.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===xa.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new nt(M.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(gc.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){bi(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new nt(M.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,T.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){_d(t,"enabled"),sn("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Yt(kt.prototype,"leave",[v2],Object.getOwnPropertyDescriptor(kt.prototype,"leave"),kt.prototype),Yt(kt.prototype,"publish",[b2],Object.getOwnPropertyDescriptor(kt.prototype,"publish"),kt.prototype),Yt(kt.prototype,"unpublish",[R2],Object.getOwnPropertyDescriptor(kt.prototype,"unpublish"),kt.prototype),Yt(kt.prototype,"subscribe",[C2],Object.getOwnPropertyDescriptor(kt.prototype,"subscribe"),kt.prototype),Yt(kt.prototype,"presubscribe",[A2],Object.getOwnPropertyDescriptor(kt.prototype,"presubscribe"),kt.prototype),Yt(kt.prototype,"massSubscribe",[w2],Object.getOwnPropertyDescriptor(kt.prototype,"massSubscribe"),kt.prototype),Yt(kt.prototype,"unsubscribe",[I2],Object.getOwnPropertyDescriptor(kt.prototype,"unsubscribe"),kt.prototype),Yt(kt.prototype,"massUnsubscribe",[O2],Object.getOwnPropertyDescriptor(kt.prototype,"massUnsubscribe"),kt.prototype),Yt(kt.prototype,"setLowStreamParameter",[N2],Object.getOwnPropertyDescriptor(kt.prototype,"setLowStreamParameter"),kt.prototype),Yt(kt.prototype,"enableDualStream",[D2],Object.getOwnPropertyDescriptor(kt.prototype,"enableDualStream"),kt.prototype),Yt(kt.prototype,"disableDualStream",[L2],Object.getOwnPropertyDescriptor(kt.prototype,"disableDualStream"),kt.prototype),Yt(kt.prototype,"setClientRole",[P2],Object.getOwnPropertyDescriptor(kt.prototype,"setClientRole"),kt.prototype),Yt(kt.prototype,"_setClientRoleOptions",[k2],Object.getOwnPropertyDescriptor(kt.prototype,"_setClientRoleOptions"),kt.prototype),Yt(kt.prototype,"setProxyServer",[x2],Object.getOwnPropertyDescriptor(kt.prototype,"setProxyServer"),kt.prototype),Yt(kt.prototype,"setTurnServer",[M2],Object.getOwnPropertyDescriptor(kt.prototype,"setTurnServer"),kt.prototype),Yt(kt.prototype,"setLicense",[U2],Object.getOwnPropertyDescriptor(kt.prototype,"setLicense"),kt.prototype),Yt(kt.prototype,"startProxyServer",[j2],Object.getOwnPropertyDescriptor(kt.prototype,"startProxyServer"),kt.prototype),Yt(kt.prototype,"stopProxyServer",[V2],Object.getOwnPropertyDescriptor(kt.prototype,"stopProxyServer"),kt.prototype),Yt(kt.prototype,"setLocalAccessPointsV2",[B2],Object.getOwnPropertyDescriptor(kt.prototype,"setLocalAccessPointsV2"),kt.prototype),Yt(kt.prototype,"setLocalAccessPoints",[F2],Object.getOwnPropertyDescriptor(kt.prototype,"setLocalAccessPoints"),kt.prototype),Yt(kt.prototype,"setRemoteDefaultVideoStreamType",[G2],Object.getOwnPropertyDescriptor(kt.prototype,"setRemoteDefaultVideoStreamType"),kt.prototype),Yt(kt.prototype,"setRemoteVideoStreamType",[H2],Object.getOwnPropertyDescriptor(kt.prototype,"setRemoteVideoStreamType"),kt.prototype),Yt(kt.prototype,"setStreamFallbackOption",[W2],Object.getOwnPropertyDescriptor(kt.prototype,"setStreamFallbackOption"),kt.prototype),Yt(kt.prototype,"setEncryptionConfig",[K2],Object.getOwnPropertyDescriptor(kt.prototype,"setEncryptionConfig"),kt.prototype),Yt(kt.prototype,"renewToken",[z2],Object.getOwnPropertyDescriptor(kt.prototype,"renewToken"),kt.prototype),Yt(kt.prototype,"enableAudioVolumeIndicator",[Y2],Object.getOwnPropertyDescriptor(kt.prototype,"enableAudioVolumeIndicator"),kt.prototype),Yt(kt.prototype,"startLiveStreaming",[q2],Object.getOwnPropertyDescriptor(kt.prototype,"startLiveStreaming"),kt.prototype),Yt(kt.prototype,"setLiveTranscoding",[X2],Object.getOwnPropertyDescriptor(kt.prototype,"setLiveTranscoding"),kt.prototype),Yt(kt.prototype,"stopLiveStreaming",[J2],Object.getOwnPropertyDescriptor(kt.prototype,"stopLiveStreaming"),kt.prototype),Yt(kt.prototype,"startChannelMediaRelay",[Q2],Object.getOwnPropertyDescriptor(kt.prototype,"startChannelMediaRelay"),kt.prototype),Yt(kt.prototype,"updateChannelMediaRelay",[Z2],Object.getOwnPropertyDescriptor(kt.prototype,"updateChannelMediaRelay"),kt.prototype),Yt(kt.prototype,"stopChannelMediaRelay",[$2],Object.getOwnPropertyDescriptor(kt.prototype,"stopChannelMediaRelay"),kt.prototype),Yt(kt.prototype,"sendCustomReportMessage",[tU],Object.getOwnPropertyDescriptor(kt.prototype,"sendCustomReportMessage"),kt.prototype),Yt(kt.prototype,"pickSVCLayer",[eU],Object.getOwnPropertyDescriptor(kt.prototype,"pickSVCLayer"),kt.prototype),Yt(kt.prototype,"setRTMConfig",[nU],Object.getOwnPropertyDescriptor(kt.prototype,"setRTMConfig"),kt.prototype),Yt(kt.prototype,"enableContentInspect",[iU],Object.getOwnPropertyDescriptor(kt.prototype,"enableContentInspect"),kt.prototype),Yt(kt.prototype,"disableContentInspect",[rU],Object.getOwnPropertyDescriptor(kt.prototype,"disableContentInspect"),kt.prototype),Yt(kt.prototype,"setImageModeration",[sU],Object.getOwnPropertyDescriptor(kt.prototype,"setImageModeration"),kt.prototype),Yt(kt.prototype,"setP2PTransport",[aU],Object.getOwnPropertyDescriptor(kt.prototype,"setP2PTransport"),kt.prototype),Yt(kt.prototype,"getJoinChannelServiceRecords",[oU],Object.getOwnPropertyDescriptor(kt.prototype,"getJoinChannelServiceRecords"),kt.prototype),Yt(kt.prototype,"setPublishAudioFilterEnabled",[cU],Object.getOwnPropertyDescriptor(kt.prototype,"setPublishAudioFilterEnabled"),kt.prototype),kt);class hy{constructor(e,n){P(this,"id",0),P(this,"element",void 0),P(this,"peerPair",void 0),P(this,"context",void 0),P(this,"audioPlayerElement",void 0),P(this,"audioTrack",void 0),hy.count+=1,this.id=hy.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(i,r)=>{const a=r==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(a),i.iceGatheringState==="complete"?i.localDescription:new wt(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},n=async(i,r)=>await i.setRemoteDescription(r);try{const i=await e(this.peerPair[0],"offer");await n(this.peerPair[1],i);const r=await e(this.peerPair[1],"answer");await n(this.peerPair[0],r)}catch(i){throw new nt(M.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(r){throw new nt(M.LOCAL_AEC_ERROR,r.toString()).print()}if(!n)throw new nt(M.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var dU,OR;P(hy,"count",0);const g8=window.AudioContext||window.webkitAudioContext,S8=new(dU=le({report:Jt}),Yt((OR=class{constructor(){P(this,"units",[]),P(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new g8);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new hy(t,this.context),this.units.push(e)),e.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return Ge().name!==Ye.SAFARI}}).prototype,"processExternalMediaAEC",[dU],Object.getOwnPropertyDescriptor(OR.prototype,"processExternalMediaAEC"),OR.prototype),OR);function uU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function hU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?uU(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):uU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const aI=window||document;function pU(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!aI)return;const n=pi._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const i=r=>{if(!(r&&r.blockedURI&&(pi.onSecurityPolicyViolation||pi.getListeners(ml.SECURITY_POLICY_VIOLATION).length>0)))return;const a=r.blockedURI;B("CSP_DETECTED_HOSTNAME_LIST").some(c=>At(a).call(a,c))&&(pi.onSecurityPolicyViolation&&typeof pi.onSecurityPolicyViolation=="function"&&pi.onSecurityPolicyViolation(r),pi.getListeners(ml.SECURITY_POLICY_VIOLATION).length>0&&pi.safeEmit(ml.SECURITY_POLICY_VIOLATION,r))};n&&aI.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||pi.getListeners(ml.SECURITY_POLICY_VIOLATION).length>0)&&aI.addEventListener("securitypolicyviolation",i),pi._cspEventHandlerPointer=i}var y8=dt,T8=JL,fU=RegExp.prototype,v8=function(t){return t===fU||y8(fU,t)?T8(t):t.flags},Mr=L(v8);function l_(t){let e=t.length;for(;--e>=0;)t[e]=0}const oI=256,mU=286,py=30,fy=15,cI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),NR=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),b8=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),EU=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wd=new Array(576);l_(wd);const my=new Array(60);l_(my);const Ey=new Array(512);l_(Ey);const _y=new Array(256);l_(_y);const lI=new Array(29);l_(lI);const DR=new Array(py);function dI(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}let _U,gU,SU;function uI(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}l_(DR);const yU=t=>t<256?Ey[t]:Ey[256+(t>>>7)],gy=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},ma=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,gy(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},yl=(t,e,n)=>{ma(t,n[2*e],n[2*e+1])},TU=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},vU=(t,e,n)=>{const i=new Array(16);let r,a,c=0;for(r=1;r<=fy;r++)c=c+n[r-1]<<1,i[r]=c;for(a=0;a<=e;a++){let l=t[2*a+1];l!==0&&(t[2*a]=TU(i[l]++,l))}},bU=t=>{let e;for(e=0;e<mU;e++)t.dyn_ltree[2*e]=0;for(e=0;e<py;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},RU=t=>{t.bi_valid>8?gy(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},CU=(t,e,n,i)=>{const r=2*e,a=2*n;return t[r]<t[a]||t[r]===t[a]&&i[e]<=i[n]},hI=(t,e,n)=>{const i=t.heap[n];let r=n<<1;for(;r<=t.heap_len&&(r<t.heap_len&&CU(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!CU(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i},AU=(t,e,n)=>{let i,r,a,c,l=0;if(t.sym_next!==0)do i=255&t.pending_buf[t.sym_buf+l++],i+=(255&t.pending_buf[t.sym_buf+l++])<<8,r=t.pending_buf[t.sym_buf+l++],i===0?yl(t,r,e):(a=_y[r],yl(t,a+oI+1,e),c=cI[a],c!==0&&(r-=lI[a],ma(t,r,c)),i--,a=yU(i),yl(t,a,n),c=NR[a],c!==0&&(i-=DR[a],ma(t,i,c)));while(l<t.sym_next);yl(t,256,e)},pI=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,a=e.stat_desc.elems;let c,l,u,h=-1;for(t.heap_len=0,t.heap_max=573,c=0;c<a;c++)n[2*c]!==0?(t.heap[++t.heap_len]=h=c,t.depth[c]=0):n[2*c+1]=0;for(;t.heap_len<2;)u=t.heap[++t.heap_len]=h<2?++h:0,n[2*u]=1,t.depth[u]=0,t.opt_len--,r&&(t.static_len-=i[2*u+1]);for(e.max_code=h,c=t.heap_len>>1;c>=1;c--)hI(t,n,c);u=a;do c=t.heap[1],t.heap[1]=t.heap[t.heap_len--],hI(t,n,1),l=t.heap[1],t.heap[--t.heap_max]=c,t.heap[--t.heap_max]=l,n[2*u]=n[2*c]+n[2*l],t.depth[u]=(t.depth[c]>=t.depth[l]?t.depth[c]:t.depth[l])+1,n[2*c+1]=n[2*l+1]=u,t.heap[1]=u++,hI(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((p,m)=>{const g=m.dyn_tree,S=m.max_code,D=m.stat_desc.static_tree,w=m.stat_desc.has_stree,N=m.stat_desc.extra_bits,k=m.stat_desc.extra_base,x=m.stat_desc.max_length;let W,Z,$,q,ot,_t,Nt=0;for(q=0;q<=fy;q++)p.bl_count[q]=0;for(g[2*p.heap[p.heap_max]+1]=0,W=p.heap_max+1;W<573;W++)Z=p.heap[W],q=g[2*g[2*Z+1]+1]+1,q>x&&(q=x,Nt++),g[2*Z+1]=q,Z>S||(p.bl_count[q]++,ot=0,Z>=k&&(ot=N[Z-k]),_t=g[2*Z],p.opt_len+=_t*(q+ot),w&&(p.static_len+=_t*(D[2*Z+1]+ot)));if(Nt!==0){do{for(q=x-1;p.bl_count[q]===0;)q--;p.bl_count[q]--,p.bl_count[q+1]+=2,p.bl_count[x]--,Nt-=2}while(Nt>0);for(q=x;q!==0;q--)for(Z=p.bl_count[q];Z!==0;)$=p.heap[--W],$>S||(g[2*$+1]!==q&&(p.opt_len+=(q-g[2*$+1])*g[2*$],g[2*$+1]=q),Z--)}})(t,e),vU(n,h,t.bl_count)},wU=(t,e,n)=>{let i,r,a=-1,c=e[1],l=0,u=7,h=4;for(c===0&&(u=138,h=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=c,c=e[2*(i+1)+1],++l<u&&r===c||(l<h?t.bl_tree[2*r]+=l:r!==0?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[32]++):l<=10?t.bl_tree[34]++:t.bl_tree[36]++,l=0,a=r,c===0?(u=138,h=3):r===c?(u=6,h=3):(u=7,h=4))},IU=(t,e,n)=>{let i,r,a=-1,c=e[1],l=0,u=7,h=4;for(c===0&&(u=138,h=3),i=0;i<=n;i++)if(r=c,c=e[2*(i+1)+1],!(++l<u&&r===c)){if(l<h)do yl(t,r,t.bl_tree);while(--l!=0);else r!==0?(r!==a&&(yl(t,r,t.bl_tree),l--),yl(t,16,t.bl_tree),ma(t,l-3,2)):l<=10?(yl(t,17,t.bl_tree),ma(t,l-3,3)):(yl(t,18,t.bl_tree),ma(t,l-11,7));l=0,a=r,c===0?(u=138,h=3):r===c?(u=6,h=3):(u=7,h=4)}};let OU=!1;const NU=(t,e,n,i)=>{ma(t,0+(i?1:0),3),RU(t),gy(t,n),gy(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var R8=t=>{OU||((()=>{let e,n,i,r,a;const c=new Array(16);for(i=0,r=0;r<28;r++)for(lI[r]=i,e=0;e<1<<cI[r];e++)_y[i++]=r;for(_y[i-1]=r,a=0,r=0;r<16;r++)for(DR[r]=a,e=0;e<1<<NR[r];e++)Ey[a++]=r;for(a>>=7;r<py;r++)for(DR[r]=a<<7,e=0;e<1<<NR[r]-7;e++)Ey[256+a++]=r;for(n=0;n<=fy;n++)c[n]=0;for(e=0;e<=143;)wd[2*e+1]=8,e++,c[8]++;for(;e<=255;)wd[2*e+1]=9,e++,c[9]++;for(;e<=279;)wd[2*e+1]=7,e++,c[7]++;for(;e<=287;)wd[2*e+1]=8,e++,c[8]++;for(vU(wd,287,c),e=0;e<py;e++)my[2*e+1]=5,my[2*e]=TU(e,5);_U=new dI(wd,cI,257,mU,fy),gU=new dI(my,NR,0,py,fy),SU=new dI(new Array(0),b8,0,19,7)})(),OU=!0),t.l_desc=new uI(t.dyn_ltree,_U),t.d_desc=new uI(t.dyn_dtree,gU),t.bl_desc=new uI(t.bl_tree,SU),t.bi_buf=0,t.bi_valid=0,bU(t)},C8=(t,e,n,i)=>{let r,a,c=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(l=>{let u,h=4093624447;for(u=0;u<=31;u++,h>>>=1)if(1&h&&l.dyn_ltree[2*u]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(u=32;u<oI;u++)if(l.dyn_ltree[2*u]!==0)return 1;return 0})(t)),pI(t,t.l_desc),pI(t,t.d_desc),c=(l=>{let u;for(wU(l,l.dyn_ltree,l.l_desc.max_code),wU(l,l.dyn_dtree,l.d_desc.max_code),pI(l,l.bl_desc),u=18;u>=3&&l.bl_tree[2*EU[u]+1]===0;u--);return l.opt_len+=3*(u+1)+5+5+4,u})(t),r=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=r&&(r=a)):r=a=n+5,n+4<=r&&e!==-1?NU(t,e,n,i):t.strategy===4||a===r?(ma(t,2+(i?1:0),3),AU(t,wd,my)):(ma(t,4+(i?1:0),3),((l,u,h,p)=>{let m;for(ma(l,u-257,5),ma(l,h-1,5),ma(l,p-4,4),m=0;m<p;m++)ma(l,l.bl_tree[2*EU[m]+1],3);IU(l,l.dyn_ltree,u-1),IU(l,l.dyn_dtree,h-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),AU(t,t.dyn_ltree,t.dyn_dtree)),bU(t),i&&RU(t)},A8=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(_y[n]+oI+1)]++,t.dyn_dtree[2*yU(e)]++),t.sym_next===t.sym_end),w8=t=>{ma(t,2,3),yl(t,256,wd),(e=>{e.bi_valid===16?(gy(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},I8={_tr_init:R8,_tr_stored_block:NU,_tr_flush_block:C8,_tr_tally:A8,_tr_align:w8},Sy=(t,e,n,i)=>{let r=65535&t|0,a=t>>>16&65535|0,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do r=r+e[i++]|0,a=a+r|0;while(--c);r%=65521,a%=65521}return r|a<<16|0};const O8=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var Zr=(t,e,n,i)=>{const r=O8,a=i+n;t^=-1;for(let c=i;c<a;c++)t=t>>>8^r[255&(t^e[c])];return-1^t},_f={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},LR={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:N8,_tr_stored_block:fI,_tr_flush_block:D8,_tr_tally:ih,_tr_align:L8}=I8,{Z_NO_FLUSH:rh,Z_PARTIAL_FLUSH:P8,Z_FULL_FLUSH:k8,Z_FINISH:Oo,Z_BLOCK:DU,Z_OK:ds,Z_STREAM_END:LU,Z_STREAM_ERROR:Tl,Z_DATA_ERROR:x8,Z_BUF_ERROR:mI,Z_DEFAULT_COMPRESSION:M8,Z_FILTERED:U8,Z_HUFFMAN_ONLY:PR,Z_RLE:j8,Z_FIXED:V8,Z_DEFAULT_STRATEGY:B8,Z_UNKNOWN:F8,Z_DEFLATED:kR}=LR,EI=286,G8=30,H8=19,W8=2*EI+1,K8=15,gf=258,vl=262,d_=42,Sf=113,yy=666,yf=(t,e)=>(t.msg=_f[e],e),PU=t=>2*t-(t>4?9:0),sh=t=>{let e=t.length;for(;--e>=0;)t[e]=0},z8=t=>{let e,n,i,r=t.w_size;e=t.hash_size,i=e;do n=t.head[--i],t.head[i]=n>=r?n-r:0;while(--e);e=r,i=e;do n=t.prev[--i],t.prev[i]=n>=r?n-r:0;while(--e)};let ah=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const Ua=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},ja=(t,e)=>{D8(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Ua(t.strm)},Jn=(t,e)=>{t.pending_buf[t.pending++]=e},Ty=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},_I=(t,e,n,i)=>{let r=t.avail_in;return r>i&&(r=i),r===0?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),n),t.state.wrap===1?t.adler=Sy(t.adler,e,r,n):t.state.wrap===2&&(t.adler=Zr(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)},kU=(t,e)=>{let n,i,r=t.max_chain_length,a=t.strstart,c=t.prev_length,l=t.nice_match;const u=t.strstart>t.w_size-vl?t.strstart-(t.w_size-vl):0,h=t.window,p=t.w_mask,m=t.prev,g=t.strstart+gf;let S=h[a+c-1],D=h[a+c];t.prev_length>=t.good_match&&(r>>=2),l>t.lookahead&&(l=t.lookahead);do if(n=e,h[n+c]===D&&h[n+c-1]===S&&h[n]===h[a]&&h[++n]===h[a+1]){a+=2,n++;do;while(h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&a<g);if(i=gf-(g-a),a=g-gf,i>c){if(t.match_start=e,c=i,i>=l)break;S=h[a+c-1],D=h[a+c]}}while((e=m[e&p])>u&&--r!=0);return c<=t.lookahead?c:t.lookahead},u_=t=>{const e=t.w_size;let n,i,r;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-vl)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),z8(t),i+=e),t.strm.avail_in===0)break;if(n=_I(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=ah(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=ah(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<vl&&t.strm.avail_in!==0)},xU=(t,e)=>{let n,i,r,a=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,c=0,l=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r||(r=t.strm.avail_out-r,i=t.strstart-t.block_start,n>i+t.strm.avail_in&&(n=i+t.strm.avail_in),n>r&&(n=r),n<a&&(n===0&&e!==Oo||e===rh||n!==i+t.strm.avail_in)))break;c=e===Oo&&n===i+t.strm.avail_in?1:0,fI(t,0,0,c),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,Ua(t.strm),i&&(i>n&&(i=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,n-=i),n&&(_I(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(c===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),c?4:e!==rh&&e!==Oo&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(_I(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,a=r>t.w_size?t.w_size:r,i=t.strstart-t.block_start,(i>=a||(i||e===Oo)&&e!==rh&&t.strm.avail_in===0&&i<=r)&&(n=i>r?r:i,c=e===Oo&&t.strm.avail_in===0&&n===i?1:0,fI(t,t.block_start,n,c),t.block_start+=n,Ua(t.strm)),c?3:1)},gI=(t,e)=>{let n,i;for(;;){if(t.lookahead<vl){if(u_(t),t.lookahead<vl&&e===rh)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=ah(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-vl&&(t.match_length=kU(t,n)),t.match_length>=3)if(i=ih(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=ah(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ah(t,t.ins_h,t.window[t.strstart+1]);else i=ih(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(ja(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Oo?(ja(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(ja(t,!1),t.strm.avail_out===0)?1:2},h_=(t,e)=>{let n,i,r;for(;;){if(t.lookahead<vl){if(u_(t),t.lookahead<vl&&e===rh)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=ah(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-vl&&(t.match_length=kU(t,n),t.match_length<=5&&(t.strategy===U8||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=ih(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=r&&(t.ins_h=ah(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(ja(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(i=ih(t,0,t.window[t.strstart-1]),i&&ja(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=ih(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Oo?(ja(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(ja(t,!1),t.strm.avail_out===0)?1:2};function bl(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}const vy=[new bl(0,0,0,0,xU),new bl(4,4,8,4,gI),new bl(4,5,16,8,gI),new bl(4,6,32,32,gI),new bl(4,4,16,16,h_),new bl(8,16,32,32,h_),new bl(8,16,128,128,h_),new bl(8,32,128,256,h_),new bl(32,128,258,1024,h_),new bl(32,258,258,4096,h_)];function Y8(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=kR,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*W8),this.dyn_dtree=new Uint16Array(2*(2*G8+1)),this.bl_tree=new Uint16Array(2*(2*H8+1)),sh(this.dyn_ltree),sh(this.dyn_dtree),sh(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(K8+1),this.heap=new Uint16Array(2*EI+1),sh(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*EI+1),sh(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const by=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==d_&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Sf&&e.status!==yy?1:0},MU=t=>{if(by(t))return yf(t,Tl);t.total_in=t.total_out=0,t.data_type=F8;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?d_:Sf,t.adler=e.wrap===2?0:1,e.last_flush=-2,N8(e),ds},UU=t=>{const e=MU(t);return e===ds&&(n=>{n.window_size=2*n.w_size,sh(n.head),n.max_lazy_match=vy[n.level].max_lazy,n.good_match=vy[n.level].good_length,n.nice_match=vy[n.level].nice_length,n.max_chain_length=vy[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},jU=(t,e,n,i,r,a)=>{if(!t)return Tl;let c=1;if(e===M8&&(e=6),i<0?(c=0,i=-i):i>15&&(c=2,i-=16),r<1||r>9||n!==kR||i<8||i>15||e<0||e>9||a<0||a>V8||i===8&&c!==1)return yf(t,Tl);i===8&&(i=9);const l=new Y8;return t.state=l,l.strm=t,l.status=d_,l.wrap=c,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=e,l.strategy=a,l.method=n,UU(t)};var q8=(t,e)=>{if(by(t)||e>DU||e<0)return t?yf(t,Tl):Tl;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===yy&&e!==Oo)return yf(t,t.avail_out===0?mI:Tl);const i=n.last_flush;if(n.last_flush=e,n.pending!==0){if(Ua(t),t.avail_out===0)return n.last_flush=-1,ds}else if(t.avail_in===0&&PU(e)<=PU(i)&&e!==Oo)return yf(t,mI);if(n.status===yy&&t.avail_in!==0)return yf(t,mI);if(n.status===d_&&n.wrap===0&&(n.status=Sf),n.status===d_){let r=kR+(n.w_bits-8<<4)<<8,a=-1;if(a=n.strategy>=PR||n.level<2?0:n.level<6?1:n.level===6?2:3,r|=a<<6,n.strstart!==0&&(r|=32),r+=31-r%31,Ty(n,r),n.strstart!==0&&(Ty(n,t.adler>>>16),Ty(n,65535&t.adler)),t.adler=1,n.status=Sf,Ua(t),n.pending!==0)return n.last_flush=-1,ds}if(n.status===57){if(t.adler=0,Jn(n,31),Jn(n,139),Jn(n,8),n.gzhead)Jn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Jn(n,255&n.gzhead.time),Jn(n,n.gzhead.time>>8&255),Jn(n,n.gzhead.time>>16&255),Jn(n,n.gzhead.time>>24&255),Jn(n,n.level===9?2:n.strategy>=PR||n.level<2?4:0),Jn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Jn(n,255&n.gzhead.extra.length),Jn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=Zr(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Jn(n,0),Jn(n,0),Jn(n,0),Jn(n,0),Jn(n,0),Jn(n,n.level===9?2:n.strategy>=PR||n.level<2?4:0),Jn(n,3),n.status=Sf,Ua(t),n.pending!==0)return n.last_flush=-1,ds}if(n.status===69){if(n.gzhead.extra){let r=n.pending,a=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+a>n.pending_buf_size;){let l=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>r&&(t.adler=Zr(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex+=l,Ua(t),n.pending!==0)return n.last_flush=-1,ds;r=0,a-=l}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending+=a,n.gzhead.hcrc&&n.pending>r&&(t.adler=Zr(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let r,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(t.adler=Zr(t.adler,n.pending_buf,n.pending-a,a)),Ua(t),n.pending!==0)return n.last_flush=-1,ds;a=0}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Jn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>a&&(t.adler=Zr(t.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let r,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(t.adler=Zr(t.adler,n.pending_buf,n.pending-a,a)),Ua(t),n.pending!==0)return n.last_flush=-1,ds;a=0}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Jn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>a&&(t.adler=Zr(t.adler,n.pending_buf,n.pending-a,a))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Ua(t),n.pending!==0))return n.last_flush=-1,ds;Jn(n,255&t.adler),Jn(n,t.adler>>8&255),t.adler=0}if(n.status=Sf,Ua(t),n.pending!==0)return n.last_flush=-1,ds}if(t.avail_in!==0||n.lookahead!==0||e!==rh&&n.status!==yy){let r=n.level===0?xU(n,e):n.strategy===PR?((a,c)=>{let l;for(;;){if(a.lookahead===0&&(u_(a),a.lookahead===0)){if(c===rh)return 1;break}if(a.match_length=0,l=ih(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,l&&(ja(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,c===Oo?(ja(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(ja(a,!1),a.strm.avail_out===0)?1:2})(n,e):n.strategy===j8?((a,c)=>{let l,u,h,p;const m=a.window;for(;;){if(a.lookahead<=gf){if(u_(a),a.lookahead<=gf&&c===rh)return 1;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(h=a.strstart-1,u=m[h],u===m[++h]&&u===m[++h]&&u===m[++h])){p=a.strstart+gf;do;while(u===m[++h]&&u===m[++h]&&u===m[++h]&&u===m[++h]&&u===m[++h]&&u===m[++h]&&u===m[++h]&&u===m[++h]&&h<p);a.match_length=gf-(p-h),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(l=ih(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(l=ih(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),l&&(ja(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,c===Oo?(ja(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(ja(a,!1),a.strm.avail_out===0)?1:2})(n,e):vy[n.level].func(n,e);if(r!==3&&r!==4||(n.status=yy),r===1||r===3)return t.avail_out===0&&(n.last_flush=-1),ds;if(r===2&&(e===P8?L8(n):e!==DU&&(fI(n,0,0,!1),e===k8&&(sh(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Ua(t),t.avail_out===0))return n.last_flush=-1,ds}return e!==Oo?ds:n.wrap<=0?LU:(n.wrap===2?(Jn(n,255&t.adler),Jn(n,t.adler>>8&255),Jn(n,t.adler>>16&255),Jn(n,t.adler>>24&255),Jn(n,255&t.total_in),Jn(n,t.total_in>>8&255),Jn(n,t.total_in>>16&255),Jn(n,t.total_in>>24&255)):(Ty(n,t.adler>>>16),Ty(n,65535&t.adler)),Ua(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?ds:LU)},X8=(t,e)=>{let n=e.length;if(by(t))return Tl;const i=t.state,r=i.wrap;if(r===2||r===1&&i.status!==d_||i.lookahead)return Tl;if(r===1&&(t.adler=Sy(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){r===0&&(sh(i.head),i.strstart=0,i.block_start=0,i.insert=0);let u=new Uint8Array(i.w_size);u.set(e.subarray(n-i.w_size,n),0),e=u,n=i.w_size}const a=t.avail_in,c=t.next_in,l=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,u_(i);i.lookahead>=3;){let u=i.strstart,h=i.lookahead-2;do i.ins_h=ah(i,i.ins_h,i.window[u+3-1]),i.prev[u&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=u,u++;while(--h);i.strstart=u,i.lookahead=2,u_(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=c,t.input=l,t.avail_in=a,i.wrap=r,ds},Ry={deflateInit:(t,e)=>jU(t,e,kR,15,8,B8),deflateInit2:jU,deflateReset:UU,deflateResetKeep:MU,deflateSetHeader:(t,e)=>by(t)||t.state.wrap!==2?Tl:(t.state.gzhead=e,ds),deflate:q8,deflateEnd:t=>{if(by(t))return Tl;const e=t.state.status;return t.state=null,e===Sf?yf(t,x8):ds},deflateSetDictionary:X8,deflateInfo:"pako deflate (from Nodeca project)"};const J8=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var xR={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)J8(n,i)&&(t[i]=n[i])}}return t},flattenChunks:t=>{let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].length;const n=new Uint8Array(e);for(let i=0,r=0,a=t.length;i<a;i++){let c=t[i];n.set(c,r),r+=c.length}return n}};let VU=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{VU=!1}const Cy=new Uint8Array(256);for(let t=0;t<256;t++)Cy[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Cy[254]=Cy[254]=1;var Ay={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,i,r,a,c=t.length,l=0;for(r=0;r<c;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(l),a=0,r=0;a<l;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let i,r;const a=new Array(2*n);for(r=0,i=0;i<n;){let c=t[i++];if(c<128){a[r++]=c;continue}let l=Cy[c];if(l>4)a[r++]=65533,i+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&i<n;)c=c<<6|63&t[i++],l--;l>1?a[r++]=65533:c<65536?a[r++]=c:(c-=65536,a[r++]=55296|c>>10&1023,a[r++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&VU)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let u="";for(let h=0;h<l;h++)u+=String.fromCharCode(c[h]);return u})(a,r)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+Cy[t[n]]>e?n:e}},BU=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const FU=Object.prototype.toString,{Z_NO_FLUSH:Q8,Z_SYNC_FLUSH:Z8,Z_FULL_FLUSH:$8,Z_FINISH:tW,Z_OK:MR,Z_STREAM_END:eW,Z_DEFAULT_COMPRESSION:nW,Z_DEFAULT_STRATEGY:iW,Z_DEFLATED:rW}=LR;function UR(t){this.options=xR.assign({level:nW,method:rW,chunkSize:16384,windowBits:15,memLevel:8,strategy:iW},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new BU,this.strm.avail_out=0;let n=Ry.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==MR)throw new Error(_f[n]);if(e.header&&Ry.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?Ay.string2buf(e.dictionary):FU.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=Ry.deflateSetDictionary(this.strm,i),n!==MR)throw new Error(_f[n]);this._dict_set=!0}}function sW(t,e){const n=new UR(e);if(n.push(t,!0),n.err)throw n.msg||_f[n.err];return n.result}UR.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let r,a;if(this.ended)return!1;for(a=e===~~e?e:e===!0?tW:Q8,typeof t=="string"?n.input=Ay.string2buf(t):FU.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(a===Z8||a===$8)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=Ry.deflate(n,a),r===eW)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=Ry.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===MR;if(n.avail_out!==0){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},UR.prototype.onData=function(t){this.chunks.push(t)},UR.prototype.onEnd=function(t){t===MR&&(this.result=xR.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var aW={deflate:sW};const jR=16209;var oW=function(t,e){let n,i,r,a,c,l,u,h,p,m,g,S,D,w,N,k,x,W,Z,$,q,ot,_t,Nt;const Mt=t.state;n=t.next_in,_t=t.input,i=n+(t.avail_in-5),r=t.next_out,Nt=t.output,a=r-(e-t.avail_out),c=r+(t.avail_out-257),l=Mt.dmax,u=Mt.wsize,h=Mt.whave,p=Mt.wnext,m=Mt.window,g=Mt.hold,S=Mt.bits,D=Mt.lencode,w=Mt.distcode,N=(1<<Mt.lenbits)-1,k=(1<<Mt.distbits)-1;t:do{S<15&&(g+=_t[n++]<<S,S+=8,g+=_t[n++]<<S,S+=8),x=D[g&N];e:for(;;){if(W=x>>>24,g>>>=W,S-=W,W=x>>>16&255,W===0)Nt[r++]=65535&x;else{if(!(16&W)){if((64&W)==0){x=D[(65535&x)+(g&(1<<W)-1)];continue e}if(32&W){Mt.mode=16191;break t}t.msg="invalid literal/length code",Mt.mode=jR;break t}Z=65535&x,W&=15,W&&(S<W&&(g+=_t[n++]<<S,S+=8),Z+=g&(1<<W)-1,g>>>=W,S-=W),S<15&&(g+=_t[n++]<<S,S+=8,g+=_t[n++]<<S,S+=8),x=w[g&k];n:for(;;){if(W=x>>>24,g>>>=W,S-=W,W=x>>>16&255,!(16&W)){if((64&W)==0){x=w[(65535&x)+(g&(1<<W)-1)];continue n}t.msg="invalid distance code",Mt.mode=jR;break t}if($=65535&x,W&=15,S<W&&(g+=_t[n++]<<S,S+=8,S<W&&(g+=_t[n++]<<S,S+=8)),$+=g&(1<<W)-1,$>l){t.msg="invalid distance too far back",Mt.mode=jR;break t}if(g>>>=W,S-=W,W=r-a,$>W){if(W=$-W,W>h&&Mt.sane){t.msg="invalid distance too far back",Mt.mode=jR;break t}if(q=0,ot=m,p===0){if(q+=u-W,W<Z){Z-=W;do Nt[r++]=m[q++];while(--W);q=r-$,ot=Nt}}else if(p<W){if(q+=u+p-W,W-=p,W<Z){Z-=W;do Nt[r++]=m[q++];while(--W);if(q=0,p<Z){W=p,Z-=W;do Nt[r++]=m[q++];while(--W);q=r-$,ot=Nt}}}else if(q+=p-W,W<Z){Z-=W;do Nt[r++]=m[q++];while(--W);q=r-$,ot=Nt}for(;Z>2;)Nt[r++]=ot[q++],Nt[r++]=ot[q++],Nt[r++]=ot[q++],Z-=3;Z&&(Nt[r++]=ot[q++],Z>1&&(Nt[r++]=ot[q++]))}else{q=r-$;do Nt[r++]=Nt[q++],Nt[r++]=Nt[q++],Nt[r++]=Nt[q++],Z-=3;while(Z>2);Z&&(Nt[r++]=Nt[q++],Z>1&&(Nt[r++]=Nt[q++]))}break}}break}}while(n<i&&r<c);Z=S>>3,n-=Z,S-=Z<<3,g&=(1<<S)-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<c?c-r+257:257-(r-c),Mt.hold=g,Mt.bits=S};const VR=15,cW=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lW=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dW=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),uW=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var wy=(t,e,n,i,r,a,c,l)=>{const u=l.bits;let h,p,m,g,S,D,w=0,N=0,k=0,x=0,W=0,Z=0,$=0,q=0,ot=0,_t=0,Nt=null;const Mt=new Uint16Array(16),ke=new Uint16Array(16);let xe,gn,ni,Kn=null;for(w=0;w<=VR;w++)Mt[w]=0;for(N=0;N<i;N++)Mt[e[n+N]]++;for(W=u,x=VR;x>=1&&Mt[x]===0;x--);if(W>x&&(W=x),x===0)return r[a++]=20971520,r[a++]=20971520,l.bits=1,0;for(k=1;k<x&&Mt[k]===0;k++);for(W<k&&(W=k),q=1,w=1;w<=VR;w++)if(q<<=1,q-=Mt[w],q<0)return-1;if(q>0&&(t===0||x!==1))return-1;for(ke[1]=0,w=1;w<VR;w++)ke[w+1]=ke[w]+Mt[w];for(N=0;N<i;N++)e[n+N]!==0&&(c[ke[e[n+N]]++]=N);if(t===0?(Nt=Kn=c,D=20):t===1?(Nt=cW,Kn=lW,D=257):(Nt=dW,Kn=uW,D=0),_t=0,N=0,w=k,S=a,Z=W,$=0,m=-1,ot=1<<W,g=ot-1,t===1&&ot>852||t===2&&ot>592)return 1;for(;;){xe=w-$,c[N]+1<D?(gn=0,ni=c[N]):c[N]>=D?(gn=Kn[c[N]-D],ni=Nt[c[N]-D]):(gn=96,ni=0),h=1<<w-$,p=1<<Z,k=p;do p-=h,r[S+(_t>>$)+p]=xe<<24|gn<<16|ni|0;while(p!==0);for(h=1<<w-1;_t&h;)h>>=1;if(h!==0?(_t&=h-1,_t+=h):_t=0,N++,--Mt[w]==0){if(w===x)break;w=e[n+c[N]]}if(w>W&&(_t&g)!==m){for($===0&&($=W),S+=k,Z=w-$,q=1<<Z;Z+$<x&&(q-=Mt[Z+$],!(q<=0));)Z++,q<<=1;if(ot+=1<<Z,t===1&&ot>852||t===2&&ot>592)return 1;m=_t&g,r[m]=W<<24|Z<<16|S-a|0}}return _t!==0&&(r[S+_t]=w-$<<24|64<<16|0),l.bits=W,0};const{Z_FINISH:GU,Z_BLOCK:hW,Z_TREES:BR,Z_OK:Tf,Z_STREAM_END:pW,Z_NEED_DICT:fW,Z_STREAM_ERROR:No,Z_DATA_ERROR:HU,Z_MEM_ERROR:WU,Z_BUF_ERROR:mW,Z_DEFLATED:KU}=LR,FR=16180,GR=16190,Id=16191,SI=16192,yI=16194,HR=16199,WR=16200,TI=16206,Vi=16209,zU=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function EW(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const vf=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<FR||e.mode>16211?1:0},YU=t=>{if(vf(t))return No;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=FR,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,Tf},qU=t=>{if(vf(t))return No;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,YU(t)},XU=(t,e)=>{let n;if(vf(t))return No;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?No:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,qU(t))},JU=(t,e)=>{if(!t)return No;const n=new EW;t.state=n,n.strm=t,n.window=null,n.mode=FR;const i=XU(t,e);return i!==Tf&&(t.state=null),i};let vI,bI,QU=!0;const _W=t=>{if(QU){vI=new Int32Array(512),bI=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(wy(1,t.lens,0,288,vI,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;wy(2,t.lens,0,32,bI,0,t.work,{bits:5}),QU=!1}t.lencode=vI,t.lenbits=9,t.distcode=bI,t.distbits=5},ZU=(t,e,n,i)=>{let r;const a=t.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(e.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>i&&(r=i),a.window.set(e.subarray(n-i,n-i+r),a.wnext),(i-=r)?(a.window.set(e.subarray(n-i,n),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0};var gW=(t,e)=>{let n,i,r,a,c,l,u,h,p,m,g,S,D,w,N,k,x,W,Z,$,q,ot,_t=0;const Nt=new Uint8Array(4);let Mt,ke;const xe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(vf(t)||!t.output||!t.input&&t.avail_in!==0)return No;n=t.state,n.mode===Id&&(n.mode=SI),c=t.next_out,r=t.output,u=t.avail_out,a=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,m=l,g=u,ot=Tf;t:for(;;)switch(n.mode){case FR:if(n.wrap===0){n.mode=SI;break}for(;p<16;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(2&n.wrap&&h===35615){n.wbits===0&&(n.wbits=15),n.check=0,Nt[0]=255&h,Nt[1]=h>>>8&255,n.check=Zr(n.check,Nt,2,0),h=0,p=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",n.mode=Vi;break}if((15&h)!==KU){t.msg="unknown compression method",n.mode=Vi;break}if(h>>>=4,p-=4,q=8+(15&h),n.wbits===0&&(n.wbits=q),q>15||q>n.wbits){t.msg="invalid window size",n.mode=Vi;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&h?16189:Id,h=0,p=0;break;case 16181:for(;p<16;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(n.flags=h,(255&Mr(n))!==KU){t.msg="unknown compression method",n.mode=Vi;break}if(57344&Mr(n)){t.msg="unknown header flags set",n.mode=Vi;break}n.head&&(n.head.text=h>>8&1),512&Mr(n)&&4&n.wrap&&(Nt[0]=255&h,Nt[1]=h>>>8&255,n.check=Zr(n.check,Nt,2,0)),h=0,p=0,n.mode=16182;case 16182:for(;p<32;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}n.head&&(n.head.time=h),512&Mr(n)&&4&n.wrap&&(Nt[0]=255&h,Nt[1]=h>>>8&255,Nt[2]=h>>>16&255,Nt[3]=h>>>24&255,n.check=Zr(n.check,Nt,4,0)),h=0,p=0,n.mode=16183;case 16183:for(;p<16;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&Mr(n)&&4&n.wrap&&(Nt[0]=255&h,Nt[1]=h>>>8&255,n.check=Zr(n.check,Nt,2,0)),h=0,p=0,n.mode=16184;case 16184:if(1024&Mr(n)){for(;p<16;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}n.length=h,n.head&&(n.head.extra_len=h),512&Mr(n)&&4&n.wrap&&(Nt[0]=255&h,Nt[1]=h>>>8&255,n.check=Zr(n.check,Nt,2,0)),h=0,p=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&Mr(n)&&(S=n.length,S>l&&(S=l),S&&(n.head&&(q=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(a,a+S),q)),512&Mr(n)&&4&n.wrap&&(n.check=Zr(n.check,i,S,a)),l-=S,a+=S,n.length-=S),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&Mr(n)){if(l===0)break t;S=0;do q=i[a+S++],n.head&&q&&n.length<65536&&(n.head.name+=String.fromCharCode(q));while(q&&S<l);if(512&Mr(n)&&4&n.wrap&&(n.check=Zr(n.check,i,S,a)),l-=S,a+=S,q)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&Mr(n)){if(l===0)break t;S=0;do q=i[a+S++],n.head&&q&&n.length<65536&&(n.head.comment+=String.fromCharCode(q));while(q&&S<l);if(512&Mr(n)&&4&n.wrap&&(n.check=Zr(n.check,i,S,a)),l-=S,a+=S,q)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&Mr(n)){for(;p<16;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(4&n.wrap&&h!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Vi;break}h=0,p=0}n.head&&(n.head.hcrc=Mr(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Id;break;case 16189:for(;p<32;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}t.adler=n.check=zU(h),h=0,p=0,n.mode=GR;case GR:if(n.havedict===0)return t.next_out=c,t.avail_out=u,t.next_in=a,t.avail_in=l,n.hold=h,n.bits=p,fW;t.adler=n.check=1,n.mode=Id;case Id:if(e===hW||e===BR)break t;case SI:if(n.last){h>>>=7&p,p-=7&p,n.mode=TI;break}for(;p<3;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}switch(n.last=1&h,h>>>=1,p-=1,3&h){case 0:n.mode=16193;break;case 1:if(_W(n),n.mode=HR,e===BR){h>>>=2,p-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=Vi}h>>>=2,p-=2;break;case 16193:for(h>>>=7&p,p-=7&p;p<32;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Vi;break}if(n.length=65535&h,h=0,p=0,n.mode=yI,e===BR)break t;case yI:n.mode=16195;case 16195:if(S=n.length,S){if(S>l&&(S=l),S>u&&(S=u),S===0)break t;r.set(i.subarray(a,a+S),c),l-=S,a+=S,u-=S,c+=S,n.length-=S;break}n.mode=Id;break;case 16196:for(;p<14;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(n.nlen=257+(31&h),h>>>=5,p-=5,n.ndist=1+(31&h),h>>>=5,p-=5,n.ncode=4+(15&h),h>>>=4,p-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Vi;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;p<3;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}n.lens[xe[n.have++]]=7&h,h>>>=3,p-=3}for(;n.have<19;)n.lens[xe[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Mt={bits:n.lenbits},ot=wy(0,n.lens,0,19,n.lencode,0,n.work,Mt),n.lenbits=Mt.bits,ot){t.msg="invalid code lengths set",n.mode=Vi;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;_t=n.lencode[h&(1<<n.lenbits)-1],N=_t>>>24,k=_t>>>16&255,x=65535&_t,!(N<=p);){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(x<16)h>>>=N,p-=N,n.lens[n.have++]=x;else{if(x===16){for(ke=N+2;p<ke;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(h>>>=N,p-=N,n.have===0){t.msg="invalid bit length repeat",n.mode=Vi;break}q=n.lens[n.have-1],S=3+(3&h),h>>>=2,p-=2}else if(x===17){for(ke=N+3;p<ke;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}h>>>=N,p-=N,q=0,S=3+(7&h),h>>>=3,p-=3}else{for(ke=N+7;p<ke;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}h>>>=N,p-=N,q=0,S=11+(127&h),h>>>=7,p-=7}if(n.have+S>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Vi;break}for(;S--;)n.lens[n.have++]=q}}if(n.mode===Vi)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=Vi;break}if(n.lenbits=9,Mt={bits:n.lenbits},ot=wy(1,n.lens,0,n.nlen,n.lencode,0,n.work,Mt),n.lenbits=Mt.bits,ot){t.msg="invalid literal/lengths set",n.mode=Vi;break}if(n.distbits=6,n.distcode=n.distdyn,Mt={bits:n.distbits},ot=wy(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Mt),n.distbits=Mt.bits,ot){t.msg="invalid distances set",n.mode=Vi;break}if(n.mode=HR,e===BR)break t;case HR:n.mode=WR;case WR:if(l>=6&&u>=258){t.next_out=c,t.avail_out=u,t.next_in=a,t.avail_in=l,n.hold=h,n.bits=p,oW(t,g),c=t.next_out,r=t.output,u=t.avail_out,a=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,n.mode===Id&&(n.back=-1);break}for(n.back=0;_t=n.lencode[h&(1<<n.lenbits)-1],N=_t>>>24,k=_t>>>16&255,x=65535&_t,!(N<=p);){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(k&&(240&k)==0){for(W=N,Z=k,$=x;_t=n.lencode[$+((h&(1<<W+Z)-1)>>W)],N=_t>>>24,k=_t>>>16&255,x=65535&_t,!(W+N<=p);){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}h>>>=W,p-=W,n.back+=W}if(h>>>=N,p-=N,n.back+=N,n.length=x,k===0){n.mode=16205;break}if(32&k){n.back=-1,n.mode=Id;break}if(64&k){t.msg="invalid literal/length code",n.mode=Vi;break}n.extra=15&k,n.mode=16201;case 16201:if(n.extra){for(ke=n.extra;p<ke;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;_t=n.distcode[h&(1<<n.distbits)-1],N=_t>>>24,k=_t>>>16&255,x=65535&_t,!(N<=p);){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if((240&k)==0){for(W=N,Z=k,$=x;_t=n.distcode[$+((h&(1<<W+Z)-1)>>W)],N=_t>>>24,k=_t>>>16&255,x=65535&_t,!(W+N<=p);){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}h>>>=W,p-=W,n.back+=W}if(h>>>=N,p-=N,n.back+=N,64&k){t.msg="invalid distance code",n.mode=Vi;break}n.offset=x,n.extra=15&k,n.mode=16203;case 16203:if(n.extra){for(ke=n.extra;p<ke;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Vi;break}n.mode=16204;case 16204:if(u===0)break t;if(S=g-u,n.offset>S){if(S=n.offset-S,S>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Vi;break}S>n.wnext?(S-=n.wnext,D=n.wsize-S):D=n.wnext-S,S>n.length&&(S=n.length),w=n.window}else w=r,D=c-n.offset,S=n.length;S>u&&(S=u),u-=S,n.length-=S;do r[c++]=w[D++];while(--S);n.length===0&&(n.mode=WR);break;case 16205:if(u===0)break t;r[c++]=n.length,u--,n.mode=WR;break;case TI:if(n.wrap){for(;p<32;){if(l===0)break t;l--,h|=i[a++]<<p,p+=8}if(g-=u,t.total_out+=g,n.total+=g,4&n.wrap&&g&&(t.adler=n.check=Mr(n)?Zr(n.check,r,g,c-g):Sy(n.check,r,g,c-g)),g=u,4&n.wrap&&(Mr(n)?h:zU(h))!==n.check){t.msg="incorrect data check",n.mode=Vi;break}h=0,p=0}n.mode=16207;case 16207:if(n.wrap&&Mr(n)){for(;p<32;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(4&n.wrap&&h!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Vi;break}h=0,p=0}n.mode=16208;case 16208:ot=pW;break t;case Vi:ot=HU;break t;case 16210:return WU;default:return No}return t.next_out=c,t.avail_out=u,t.next_in=a,t.avail_in=l,n.hold=h,n.bits=p,(n.wsize||g!==t.avail_out&&n.mode<Vi&&(n.mode<TI||e!==GU))&&ZU(t,t.output,t.next_out,g-t.avail_out),m-=t.avail_in,g-=t.avail_out,t.total_in+=m,t.total_out+=g,n.total+=g,4&n.wrap&&g&&(t.adler=n.check=Mr(n)?Zr(n.check,r,g,t.next_out-g):Sy(n.check,r,g,t.next_out-g)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Id?128:0)+(n.mode===HR||n.mode===yI?256:0),(m===0&&g===0||e===GU)&&ot===Tf&&(ot=mW),ot},Od={inflateReset:qU,inflateReset2:XU,inflateResetKeep:YU,inflateInit:t=>JU(t,15),inflateInit2:JU,inflate:gW,inflateEnd:t=>{if(vf(t))return No;let e=t.state;return e.window&&(e.window=null),t.state=null,Tf},inflateGetHeader:(t,e)=>{if(vf(t))return No;const n=t.state;return(2&n.wrap)==0?No:(n.head=e,e.done=!1,Tf)},inflateSetDictionary:(t,e)=>{const n=e.length;let i,r,a;return vf(t)?No:(i=t.state,i.wrap!==0&&i.mode!==GR?No:i.mode===GR&&(r=1,r=Sy(r,e,n,0),r!==i.check)?HU:(a=ZU(t,e,n,n),a?(i.mode=16210,WU):(i.havedict=1,Tf)))},inflateInfo:"pako inflate (from Nodeca project)"},SW=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const $U=Object.prototype.toString,{Z_NO_FLUSH:yW,Z_FINISH:TW,Z_OK:Iy,Z_STREAM_END:RI,Z_NEED_DICT:CI,Z_STREAM_ERROR:vW,Z_DATA_ERROR:tj,Z_MEM_ERROR:bW}=LR;function KR(t){this.options=xR.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new BU,this.strm.avail_out=0;let n=Od.inflateInit2(this.strm,e.windowBits);if(n!==Iy)throw new Error(_f[n]);if(this.header=new SW,Od.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Ay.string2buf(e.dictionary):$U.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Od.inflateSetDictionary(this.strm,e.dictionary),n!==Iy)))throw new Error(_f[n])}function RW(t,e){const n=new KR(e);if(n.push(t),n.err)throw n.msg||_f[n.err];return n.result}KR.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let a,c,l;if(this.ended)return!1;for(c=e===~~e?e:e===!0?TW:yW,$U.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),a=Od.inflate(n,c),a===CI&&r&&(a=Od.inflateSetDictionary(n,r),a===Iy?a=Od.inflate(n,c):a===tj&&(a=CI));n.avail_in>0&&a===RI&&n.state.wrap>0&&t[n.next_in]!==0;)Od.inflateReset(n),a=Od.inflate(n,c);switch(a){case vW:case tj:case CI:case bW:return this.onEnd(a),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||a===RI))if(this.options.to==="string"){let u=Ay.utf8border(n.output,n.next_out),h=n.next_out-u,p=Ay.buf2string(n.output,u);n.next_out=h,n.avail_out=i-h,h&&n.output.set(n.output.subarray(u,u+h),0),this.onData(p)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==Iy||l!==0){if(a===RI)return a=Od.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},KR.prototype.onData=function(t){this.chunks.push(t)},KR.prototype.onEnd=function(t){t===Iy&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=xR.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var CW={inflate:RW};const{deflate:AW}=aW,{inflate:wW}=CW;var IW=AW,OW=wW,ej=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(ej||{});class NW{constructor(){P(this,"_sequence",0),P(this,"_startTime",Date.now()),P(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const l=new Uint8Array(4);l.set([1,0,0,0]);const u={id:0,length:4,data:l.buffer},h={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[u]};n.commonPacketHeader.extension=1,n.extension=h,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;B("SHOW_DATASTREAM2_LOG")&&T.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),r=new Uint8Array(i),a=new DataView(i);let c=0;if(a.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,a.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,a.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const l=this.serializeExtension(n.extension);r.set(new Uint8Array(l),c),c+=l.byteLength}if(r.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let i=0;const r=n.getUint16(i,!0);i+=2;const a={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let c,l;if(i+=4,B("SHOW_DATASTREAM2_LOG")&&T.debug("receive data header: ".concat(JSON.stringify(a))),n.getUint16(i,!0),i+=2,a.extension){l=this.deserializeExtension(e.slice(i)),i+=2+l.length,c=e.slice(i);let u=!1;if(l.datas.length>0){const h=l.datas.find(p=>p.id===0);h&&(u=(1&new DataView(h.data).getUint32(0,!0))==1)}c=u?this.decompress(c):c}else c=e.slice(8);return c}serializeExtension(e){const{profile:n,length:i,datas:r}=e,a=new ArrayBuffer(i+2),c=new Uint8Array(a),l=new DataView(a);let u=0;if(l.setUint8(u++,n),l.setUint8(u++,i),r.forEach(h=>{n?(l.setUint8(u++,h.id),l.setUint8(u++,h.length),c.set(new Uint8Array(h.data),u),u+=h.data.byteLength):(l.setUint8(u++,h.id|h.length<<4),c.set(new Uint8Array(h.data),u),u+=h.data.byteLength)}),u!==i+2)throw Error("serialize extension error, is ".concat(u,"!==").concat(i+2));return a}deserializeExtension(e){const n=new DataView(e);let i=0;const r=n.getUint8(i);i++;const a=n.getUint8(i);i++;const c=r===ej.TWO_BYTE,l=[],u=new DataView(e,2);let h=0;for(;h<a;){let p=0,m=0,g=new ArrayBuffer(0);c?(p=u.getUint8(h),h++,m=u.getUint8(h),h++):(p=15&u.getUint8(h),m=u.getUint8(h)>>4,h++),m>0&&(g=u.buffer.slice(h+2,h+2+m),h+=g.byteLength),l.push({id:p,length:m,data:g})}if(h!==a)throw Error("parse error");return{profile:r,length:a,datas:l}}decompress(e){return OW(new Uint8Array(e))}compress(e){return IW(new Uint8Array(e))}}const DW={name:"DataStream",create:(t,e)=>{const n=e?new jG(t):new VG(t);return n.useDataStream(new NW),n}};class LW extends Mn{constructor(e,n,i){super(),P(this,"ws",void 0),P(this,"requestId",1),P(this,"heartBeatTimer",void 0),P(this,"joinInfo",void 0),P(this,"clientId",void 0),P(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),P(this,"onClose",r=>{this.emit("close"),this.dispose()}),P(this,"onMessage",r=>{const a=JSON.parse(r.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=e,this.clientId=n,this.ws=new ty("cross-channel-".concat(this.clientId),i),this.ws.on(Se.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Se.CONNECTED,this.onOpen),this.ws.on(Se.ON_MESSAGE,this.onMessage),this.ws.on(Se.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new wt((n,i)=>{const r=window.setTimeout(()=>{i(new nt(M.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,a=>{window.clearTimeout(r),a.state&&a.state!==0?i(new nt(M.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new nt(M.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new nt(M.WS_DISCONNECT);const n=()=>new wt((c,l)=>{this.ws.once(Se.CLOSED,()=>l(new nt(M.WS_ABORT))),this.ws.once(Se.CONNECTED,c)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(e),r=new wt((c,l)=>{const u=()=>{l(new nt(M.WS_ABORT))};this.ws.once(Se.RECONNECTING,u),this.ws.once(Se.CLOSED,u),this.once("req_".concat(i),c),Hi(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Se.RECONNECTING,u),this.ws.off(Se.CLOSED,u),l(new nt(M.TIMEOUT,"cross channel ws request timeout"))})}),a=await r;if(!a||a.code!==200)throw new nt(M.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(e){this.ws.removeAllListeners(Se.REQUEST_NEW_URLS),this.ws.on(Se.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class PW extends Mn{set state(e){e!==this._state&&(e!==Ts.RELAY_STATE_FAILURE&&(this.errorCode=JE.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,i,r,a){super(),P(this,"joinInfo",void 0),P(this,"sid",void 0),P(this,"clientId",void 0),P(this,"cancelToken",ss.CancelToken.source()),P(this,"workerToken",void 0),P(this,"requestId",0),P(this,"signal",void 0),P(this,"prevChannelMediaConfig",void 0),P(this,"httpRetryConfig",void 0),P(this,"_resolution",void 0),P(this,"_state",Ts.RELAY_STATE_IDLE),P(this,"errorCode",JE.RELAY_OK),P(this,"onStatus",c=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",vd.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",vd.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=JE.SRC_TOKEN_EXPIRED,this.state=Ts.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=JE.DEST_TOKEN_EXPIRED,this.state=Ts.RELAY_STATE_FAILURE))}),P(this,"onReconnect",async()=>{T.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",vd.NETWORK_DISCONNECTED),this.state=Ts.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==Ts.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",c.toString()),this.errorCode=JE.SERVER_CONNECTION_LOST,this.state=Ts.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=$p(),this.signal=new LW(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=a}async startChannelMediaRelay(e){if(this.state!==Ts.RELAY_STATE_IDLE)throw new nt(M.INVALID_OPERATION);this.state=Ts.RELAY_STATE_CONNECTING,await this.connect(),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new nt(M.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new nt(M.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new nt(M.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Ts.RELAY_STATE_RUNNING)throw new nt(M.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Ts.RELAY_STATE_RUNNING)throw new nt(M.INVALID_OPERATION);const n=this.genMessage(Qr.SetVideoProfile);await this.signal.request(n),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),T.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ts.RELAY_STATE_IDLE,this.dispose()}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=ss.CancelToken.source(),this.state=Ts.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await HH(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",vd.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(Qr.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Qr.SetSdkProfile,e);await this.signal.request(i),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(Qr.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",vd.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(Qr.SetSourceUserId,e);await this.signal.request(a),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(Qr.SetDestChannel,e);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",vd.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(Qr.StartPacketTransfer,e);await this.signal.request(l),this.emit("event",vd.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ts.RELAY_STATE_RUNNING,T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(Qr.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",vd.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(Qr.StopPacketTransfer);await this.signal.request(e),T.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const i=[],r=[],a=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:La,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.23.2"&&(c.sdkVersion="0.0.1");let l=null,u=null;switch(e){case Qr.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case Qr.SetSourceChannel:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new nt(M.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:u.channelName,token:u.token||this.joinInfo.appId},c;case Qr.SetSourceUserId:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new nt(M.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:u.uid+""},c;case Qr.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new nt(M.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),a.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:a},c;case Qr.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case Qr.Reconnect:return c.clientRequest={command:"Reconnect"},c;case Qr.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case Qr.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new nt(M.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),a.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:a},c;case Qr.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const kW={name:"ChannelMediaRelay",create:function(t){return new PW(t.joinInfo,t.clientId,t.websocketRetryConfig||hi,t.httpRetryConfig||hi,t.resolution)}};function nj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Oy(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?nj(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):nj(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class xW extends Mn{constructor(e,n,i,r){super(),P(this,"spec",void 0),P(this,"token",void 0),P(this,"websocket",void 0),P(this,"pingpongTimer",void 0),P(this,"reconnectMode","retry"),P(this,"serviceMode",void 0),P(this,"reqId",0),P(this,"commandReqId",0),P(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),P(this,"handleWebSocketMessage",a=>{if(!a.data)return;const c=JSON.parse(a.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(Jt.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===Td.TRANSCODE?1:2}),this.emit(Yu.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=e,this.serviceMode=r,this.websocket=new ty("live-streaming",i),this.websocket.on(Se.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Se.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Se.REQUEST_NEW_URLS,(a,c)=>{er(this,Yu.REQUEST_NEW_ADDRESS).then(a).catch(c)}),this.websocket.on(Se.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,i,r){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const a=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new nt(M.UNEXPECTED_ERROR);const l=Oy({command:e,sdkVersion:La==="4.23.2"?"0.0.1":La,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new nt(M.WS_DISCONNECT);const u=()=>new wt((g,S)=>{this.websocket.once(Se.CLOSED,()=>S(new nt(M.WS_ABORT))),this.websocket.once(Se.CONNECTED,g)});this.websocket.state!=="connected"&&await u(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const h=new wt((g,S)=>{const D=()=>{S(new nt(M.WS_ABORT))};this.websocket.once(Se.RECONNECTING,D),this.websocket.once(Se.CLOSED,D),this.once("@".concat(c,"-").concat(this.spec.sid),w=>{g(w)})});r&&Jt.workerEvent(this.spec.sid,Oy(Oy({},r),{},{requestId:a,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const p=Date.now();this.websocket.sendMessage(l);let m=null;try{m=await h}catch(g){if(this.websocket.state==="closed")throw g;return await u(),await this.request(e,n,i)}return r&&Jt.workerEvent(this.spec.sid,Oy(Oy({},r),{},{requestId:a,actionType:"response",payload:JSON.stringify(m.serverResponse),serverCode:m.code,success:m.code===200,responseTime:Date.now()-p})),m.code!==200&&this.handleResponseError(m),m}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=La==="4.23.2"?"0.0.1":La;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case gi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case gi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case gi.LIVE_STREAM_RESPONSE_BAD_STREAM:case gi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new nt(M.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case gi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new nt(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case gi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new nt(M.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case gi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new nt(M.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Yu.WARNING,n,e.serverResponse.url)}case gi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new nt(M.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Yu.WARNING,n,e.serverResponse.url)}case gi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new nt(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case gi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new nt(M.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case gi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new nt(M.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Yu.WARNING,n,e.serverResponse.url)}case gi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new nt(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case gi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new nt(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case gi.LIVE_STREAM_RESPONSE_WORKER_LOST:case gi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new nt(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case gi.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new nt(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new nt(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case gi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new nt(M.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Lb)},6e3)}}function ij(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function vs(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ij(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ij(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class MW extends Mn{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hi,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:hi;super(),P(this,"onLiveStreamWarning",void 0),P(this,"onLiveStreamError",void 0),P(this,"spec",void 0),P(this,"retryTimeout",1e4),P(this,"connection",void 0),P(this,"httpRetryConfig",void 0),P(this,"wsRetryConfig",void 0),P(this,"streamingTasks",new Map),P(this,"isStartingStreamingTask",!1),P(this,"taskMutex",new lr("live-streaming")),P(this,"cancelToken",ss.CancelToken.source()),P(this,"transcodingConfig",void 0),P(this,"uapResponse",void 0),P(this,"lastTaskId",1),P(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=vs(vs({},vH),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(T.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>vs(vs(vs({},TH),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){Bn(c.width)||cn(c.width,"config.width",0,1e4),Bn(c.height)||cn(c.height,"config.height",0,1e4),Bn(c.videoBitrate)||cn(c.videoBitrate,"config.videoBitrate",1,1e6),Bn(c.videoFrameRate)||cn(c.videoFrameRate,"config.videoFrameRate"),Bn(c.lowLatency)||_d(c.lowLatency,"config.lowLatency"),Bn(c.audioSampleRate)||bi(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Bn(c.audioBitrate)||cn(c.audioBitrate,"config.audioBitrate",1,128),Bn(c.audioChannels)||bi(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),Bn(c.videoGop)||cn(c.videoGop,"config.videoGop"),Bn(c.videoCodecProfile)||bi(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Bn(c.userCount)||cn(c.userCount,"config.userCount",0,17),Bn(c.backgroundColor)||cn(c.backgroundColor,"config.backgroundColor",0,16777215),Bn(c.userConfigExtraInfo)||Gi(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!Bn(c.transcodingUsers)&&(gd(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,u)=>{nR(l.uid),Bn(l.x)||cn(l.x,"transcodingUser[".concat(u,"].x"),0,1e4),Bn(l.y)||cn(l.y,"transcodingUser[".concat(u,"].y"),0,1e4),Bn(l.width)||cn(l.width,"transcodingUser[".concat(u,"].width"),0,1e4),Bn(l.height)||cn(l.height,"transcodingUser[".concat(u,"].height"),0,1e4),Bn(l.zOrder)||cn(l.zOrder-1,"transcodingUser[".concat(u,"].zOrder"),0,100),Bn(l.alpha)||cn(l.alpha,"transcodingUser[".concat(u,"].alpha"),0,1,!1)})),Bn(c.watermark)||ww(c.watermark,"watermark"),Bn(c.backgroundImage)||ww(c.backgroundImage,"backgroundImage"),c.images&&!Bn(c.images)&&(gd(c.images,"config.images"),c.images.forEach((l,u)=>{ww(l,"images[".concat(u,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(c=>vs(vs(vs({},Aw),c),{},{zOrder:255}))),n.backgroundImage&&(i.push(vs(vs(vs({},Aw),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(vs(vs(vs({},Aw),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>vs({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const r=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?wt.resolve(c.uid):CM(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await wt.all(r)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var a;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Fi(a=this.streamingTasks).call(a)).map(l=>l.taskId).join("#")});T.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{T.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{T.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(u=>{T.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,u.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,u)})})}}async startLiveStreamingTask(e,n,i){if(!this.transcodingConfig&&n===Td.TRANSCODE)throw new nt(M.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const a=await this.taskMutex.lock();if(!this.connection&&i)return void a();if(this.streamingTasks.get(e)&&!i)return a(),new nt(M.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(l){throw a(),l}switch(n){case Td.TRANSCODE:r.transcodingConfig=vs({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const l=new wt((h,p)=>{Hi(this.retryTimeout).then(()=>{if(i)return p(i);const m=this.statusError.get(e);return m?(this.statusError.delete(e),p(m)):void 0})}),u=await wt.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:n===Td.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,T.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(u.code)),this.streamingTasks.set(e,{clientRequest:r,mode:n,url:e,taskId:c}),a()}catch(l){if(a(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||i)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,l)):await this.startLiveStreamingTask(e,n,l)}}stopLiveStreamingTask(e){return new wt((n,i)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new nt(M.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const a=r.mode;r.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:a===Td.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var e;const n=Array.from(Fi(e=this.streamingTasks).call(e));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=ss.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new nt(M.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await er(this,Iw.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new xW(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Yu.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(Yu.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Yu.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new nt(M.UNEXPECTED_ERROR,"can not get new live streaming address list"));er(this,Iw.REQUEST_WORKER_MANAGER_LIST,e).then(a=>{this.uapResponse=a,i(a.addressList)}).catch(r)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),r=e.reason;switch(e.code){case gi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new nt(M.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return T.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case gi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new nt(M.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case gi.LIVE_STREAM_RESPONSE_WORKER_LOST:case gi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(Fi(a=this.streamingTasks).call(a));for(const l of c)l.abortTask?l.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new nt(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(u=>{T.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,u)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const UW={name:"LiveStreaming",create:function(t){return new MW(t.joinInfo,t.websocketRetryConfig||hi,t.httpRetryConfig||hi)}};function jW(t){let e=aj();return function(n,i){let r=n.appId;r!==void 0&&(nn(i,10),Rl(i,r));let a=n.cid;a!==void 0&&(nn(i,16),nn(i,a));let c=n.cname;c!==void 0&&(nn(i,26),Rl(i,c));let l=n.deviceId;l!==void 0&&(nn(i,34),Rl(i,l));let u=n.elapse;u!==void 0&&(nn(i,40),oh(i,u));let h=n.fileSize;h!==void 0&&(nn(i,48),oh(i,p_(h)));let p=n.height;p!==void 0&&(nn(i,56),oh(i,p_(p)));let m=n.jpg;m!==void 0&&(nn(i,66),nn(i,m.length),function(us,pt){let bt=f_(us,pt.length);us.bytes.set(pt,bt)}(i,m));let g=n.networkType;g!==void 0&&(nn(i,72),oh(i,p_(g)));let S=n.osType;S!==void 0&&(nn(i,80),oh(i,p_(S)));let D=n.requestId;D!==void 0&&(nn(i,90),Rl(i,D));let w=n.sdkVersion;w!==void 0&&(nn(i,98),Rl(i,w));let N=n.sequence;N!==void 0&&(nn(i,104),oh(i,p_(N)));let k=n.sid;k!==void 0&&(nn(i,114),Rl(i,k));let x=n.timestamp;x!==void 0&&(nn(i,120),oh(i,x));let W=n.uid;W!==void 0&&(nn(i,128),nn(i,W));let Z=n.vid;Z!==void 0&&(nn(i,136),nn(i,Z));let $=n.width;$!==void 0&&(nn(i,144),oh(i,p_($)));let q=n.service;q!==void 0&&(nn(i,152),nn(i,q));let ot=n.callbackData;ot!==void 0&&(nn(i,162),Rl(i,ot));let _t=n.jpgEncryption;_t!==void 0&&(nn(i,168),nn(i,_t));let Nt=n.requestType;Nt!==void 0&&(nn(i,176),nn(i,Nt));let Mt=n.scorePorn;Mt!==void 0&&(nn(i,185),NI(i,Mt));let ke=n.scoreSexy;ke!==void 0&&(nn(i,193),NI(i,ke));let xe=n.scoreNeutral;xe!==void 0&&(nn(i,201),NI(i,xe));let gn=n.scene;gn!==void 0&&(nn(i,208),nn(i,gn));let ni=n.ossFilePrefix;ni!==void 0&&(nn(i,218),Rl(i,ni));let Kn=n.serviceVendor;if(Kn!==void 0)for(let us of Kn){nn(i,226);let pt=aj();FW(us,pt),nn(i,pt.limit),KW(i,pt),WW(pt)}}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function VW(t){return function(n){let i={};t:for(;!oj(n);){let r=Cl(n);switch(r>>>3){case 0:break t;case 1:i.code=Cl(n);break;case 2:i.msg=cj(n,Cl(n));break;case 3:{let a=GW(n);i.data=BW(n),n.limit=a;break}default:rj(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function BW(t){let e={};t:for(;!oj(t);){let n=Cl(t);switch(n>>>3){case 0:break t;case 1:e.requestId=cj(t,Cl(t));break;case 2:e.requestType=Cl(t)>>>0;break;case 3:e.scorePorn=OI(t);break;case 4:e.scoreSexy=OI(t);break;case 5:e.scoreNeutral=OI(t);break;case 6:e.requestScene=Cl(t)>>>0;break;case 7:e.scene=Cl(t)>>>0;break;default:rj(t,7&n)}}return e}function FW(t,e){let n=t.service;n!==void 0&&(nn(e,8),nn(e,n));let i=t.vendor;i!==void 0&&(nn(e,16),nn(e,i));let r=t.token;r!==void 0&&(nn(e,26),Rl(e,r));let a=t.callbackUrl;a!==void 0&&(nn(e,34),Rl(e,a))}function GW(t){let e=Cl(t),n=t.limit;return t.limit=t.offset+e,n}function rj(t,e){switch(e){case 0:for(;128&lj(t););break;case 2:wI(t,Cl(t));break;case 5:wI(t,4);break;case 1:wI(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let HW=new Float32Array(1);new Uint8Array(HW.buffer);let AI=new Float64Array(1),bs=new Uint8Array(AI.buffer);function p_(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let sj=[];function aj(){const t=sj.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function WW(t){sj.push(t)}function wI(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function oj(t){return t.offset>=t.limit}function f_(t,e){let n=t.bytes,i=t.offset,r=t.limit,a=i+e;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),t.bytes=c}return t.offset=a,a>r&&(t.limit=a),i}function II(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function cj(t,e){let n=II(t,e),i=String.fromCharCode,r=t.bytes,a="",c="";for(let l=0;l<e;l++){let u,h,p,m,g=r[l+n];(128&g)==0?c+=i(g):(224&g)==192?l+1>=e?c+=a:(u=r[l+n+1],(192&u)!=128?c+=a:(m=(31&g)<<6|63&u,m<128?c+=a:(c+=i(m),l++))):(240&g)==224?l+2>=e?c+=a:(u=r[l+n+1],h=r[l+n+2],(49344&(u|h<<8))!=32896?c+=a:(m=(15&g)<<12|(63&u)<<6|63&h,m<2048||m>=55296&&m<=57343?c+=a:(c+=i(m),l+=2))):(248&g)==240?l+3>=e?c+=a:(u=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(u|h<<8|p<<16))!=8421504?c+=a:(m=(7&g)<<18|(63&u)<<12|(63&h)<<6|63&p,m<65536||m>1114111?c+=a:(m-=65536,c+=i(55296+(m>>10),56320+(1023&m)),l+=3))):c+=a}return c}function Rl(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}nn(t,i);let r=f_(t,i),a=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?a[r++]=l:(l<2048?a[r++]=l>>6&31|192:(l<65536?a[r++]=l>>12&15|224:(a[r++]=l>>18&7|240,a[r++]=l>>12&63|128),a[r++]=l>>6&63|128),a[r++]=63&l|128)}}function KW(t,e){let n=f_(t,e.limit),i=t.bytes,r=e.bytes;for(let a=0,c=e.limit;a<c;a++)i[a+n]=r[a]}function lj(t){return t.bytes[II(t,1)]}function dj(t,e){let n=f_(t,1);t.bytes[n]=e}function OI(t){let e=II(t,8),n=t.bytes;return bs[0]=n[e++],bs[1]=n[e++],bs[2]=n[e++],bs[3]=n[e++],bs[4]=n[e++],bs[5]=n[e++],bs[6]=n[e++],bs[7]=n[e++],AI[0]}function NI(t,e){let n=f_(t,8),i=t.bytes;AI[0]=e,i[n++]=bs[0],i[n++]=bs[1],i[n++]=bs[2],i[n++]=bs[3],i[n++]=bs[4],i[n++]=bs[5],i[n++]=bs[6],i[n++]=bs[7]}function Cl(t){let e,n=0,i=0;do e=lj(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function nn(t,e){for(e>>>=0;e>=128;)dj(t,127&e|128),e>>>=7;dj(t,e)}function oh(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,a=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=f_(t,a),l=t.bytes;switch(a){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=a!==9?128|r:127&r;case 8:l[c+7]=a!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=a!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=a!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=a!==5?128|i:127&i;case 4:l[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:l[c]=a!==1?128|n:127&n}}function uj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const zW=new Map([["moderation",1],["supervise",2]]);class YW extends Mn{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(ji.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=ms(n=e.map(i=>zW.get(i)||0)).call(n,(i,r)=>i+r),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),P(this,"name","AgoraRTCVideoContentInspect"),P(this,"_connectionState",Ro.CONNECTING),P(this,"_innerConnectionState",void 0),P(this,"sequence",0),P(this,"inspectStartTime",void 0),P(this,"workerManagerConnection",void 0),P(this,"workerConnection",void 0),P(this,"workerMessageLengthLimit",void 0),P(this,"inspectIntervalMinimum",void 0),P(this,"qualityRatio",void 0),P(this,"_connectInfo",void 0),P(this,"_cancelTokenSource",ss.CancelToken.source()),P(this,"_retryConfig",void 0),P(this,"wmSequence",0),P(this,"inspectInterval",void 0),P(this,"inspectTimer",null),P(this,"ossFilePrefix",void 0),P(this,"extraInfo",void 0),P(this,"_inspectType",void 0),P(this,"_inspectMode",void 0),P(this,"_quality",1),P(this,"qualityTimer",null),P(this,"_inspectId",void 0),P(this,"_needWorkUrlOnly",!1),P(this,"inspectImage",()=>{if(this.connectionState!==Ro.CONNECTED)throw new nt(M.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ro.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=En(5,"inspect-"),this.workerMessageLengthLimit=B("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=B("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=B("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new ty("worker-manager-"+this._inspectId,hi),this.on(ji.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Co[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new ty("worker-"+this._inspectId,hi),this.handleWorkerEvents()}async init(e,n){this.emit(ji.STATE_CHANGE,Co.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new wt((r,a)=>{this.on(ji.CONNECTION_STATE_CHANGE,(c,l)=>{l===Ro.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{a(c)})})}async requestAP(e,n,i){const r=B("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),a=await function(l,u,h,p){let{appId:m,areaCode:g,cname:S,sid:D,token:w,uid:N}=u;i_++;const k="image_moderation_api",x={service_name:k,json_body:JSON.stringify({appId:m,areaCode:g,cname:S,command:"allocateEdge",requestId:i_,seq:i_,sid:D,token:w,ts:Date.now(),uid:N+""})};let W,Z,$=l[0];return fc(async()=>{W=Date.now();const q=await Sc($,{data:x,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Z=Date.now()-W,q.code!==0){const Mt=new nt(M.UNEXPECTED_RESPONSE,"image inspect ap error, code"+q.code,{retry:!0,responseTime:Z});throw T.error(Mt.toString()),Mt}const ot=JSON.parse(q.json_body);if(ot.code!==200){const Mt=new nt(M.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ot.code,", reason: ").concat(ot.reason),{code:ot.code,responseTime:Z});throw T.error(Mt.toString()),Mt}if(!ot.servers||!Array.isArray(ot.servers)||ot.servers.length===0){const Mt=new nt(M.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ot.code,responseTime:Z});throw T.error(Mt.toString()),Mt}const _t=B("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Nt=B("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ot.servers.map(Mt=>{let{address:ke,wss:xe}=Mt;if(ke&&xe)return"wss://".concat(ke.replace(/\./g,"-"),".").concat(_t,":").concat(Nt||xe)}).filter(Mt=>!!Mt),workerToken:ot.workerToken,vid:ot.vid,responseTime:Z}},(q,ot)=>(Jt.apworkerEvent(D,{success:!0,sc:200,serviceName:k,responseDetail:JSON.stringify(q.addressList),firstSuccess:ot===0,responseTime:Z,serverIp:l[ot%l.length]}),!1),(q,ot)=>(Jt.apworkerEvent(D,{success:!1,sc:q.data&&q.data.code||200,serviceName:k,responseTime:Z,serverIp:l[ot%l.length]}),!!(q.code!==M.OPERATION_ABORTED&&q.code!==M.UNEXPECTED_RESPONSE||q.data&&q.data.retry)&&($=l[(ot+1)%l.length],!0)),p)}(r,e,n,i);this.emit(ji.STATE_CHANGE,Co.AP_CONNECTED);const{addressList:c}=a;return this.wmSequence++,c}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(ji.STATE_CHANGE,Co.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Se.CONNECTED,async()=>{this.emit(ji.STATE_CHANGE,Co.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Se.CLOSED,()=>{this._innerConnectionState<Co.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Se.FAILED,()=>{this._innerConnectionState<Co.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Se.RECONNECTING,()=>{this._innerConnectionState<Co.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Se.ON_MESSAGE,async e=>{this.emit(ji.STATE_CHANGE,Co.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(e.data);if(i.code!==200)throw T.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new nt(M.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw T.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new nt(M.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const r=B("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,a=n.replace(/:\d+\/?$/,":".concat(r));this.emit(ji.STATE_CHANGE,Co.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(ji.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(Se.WILL_RECONNECT,(e,n,i)=>{i(e)}),this.workerManagerConnection.on(Se.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Se.CONNECTED,async()=>{this.emit(ji.STATE_CHANGE,Co.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ro.CONNECTED}),this.workerConnection.on(Se.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const i=VW(new Uint8Array(e.data));if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ji.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},a=ms(n=Object.keys(r)).call(n,(l,u)=>r[l]>r[u]?l:u,"porn"),c=Object.keys(r).find(l=>l===a);this.emit(ji.INSPECT_RESULT,c)}else this.emit(ji.INSPECT_RESULT,void 0,new nt(M.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(ji.INSPECT_RESULT,void 0,new nt(M.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else T.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ji.INSPECT_RESULT,void 0,new nt(M.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Se.CLOSED,()=>{this.connectionState=Ro.CLOSED}),this.workerConnection.on(Se.FAILED,()=>{this.connectionState=Ro.CLOSED}),this.workerConnection.on(Se.RECONNECTING,()=>{this.connectionState=this.connectionState===Ro.CONNECTED?Ro.RECONNECTING:Ro.CONNECTING}),this.workerConnection.on(Se.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(Se.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(ji.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const e=sa(this,ji.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(ji.INSPECT_RESULT,void 0,new nt(M.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(e,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(ji.INSPECT_RESULT,void 0,new nt(M.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:i,cname:r,cid:a,vid:c,sid:l,uid:u}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),m=await zk(p,i,r),g=this.sequence+"-"+a+"-"+u+"-"+h+"-"+En(12,""),S={appId:i,cid:a,cname:r,deviceId:"",elapse:(D=Number(h-this.inspectStartTime),{low:D|=0,high:D>>31,unsigned:D>=0}),fileSize:m.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:g,sdkVersion:"4.23.2",sequence:this.sequence,sid:l,timestamp:S2(h),uid:u,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var D;this.extraInfo===void 0&&delete S.callbackData,this.ossFilePrefix===void 0&&delete S.ossFilePrefix;const w=jW(S);if(w.byteLength<this.workerMessageLengthLimit){if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const N=function(k){for(var x=1;x<arguments.length;x++){var W=arguments[x]!=null?arguments[x]:{};x%2?uj(Object(W),!0).forEach(function(Z){P(k,Z,W[Z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(W)):uj(Object(W)).forEach(function(Z){Object.defineProperty(k,Z,Object.getOwnPropertyDescriptor(W,Z))})}return k}({},S);delete N.jpg,T.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(N))}return w}{const N=this.quality*this.qualityRatio;return this.quality=N,await this.generateRequestData(e,{appId:i,cname:r,cid:a,vid:c,sid:l,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ss.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ro.CLOSED,this.emit(ji.STATE_CHANGE,Co.CLOSED)}}const qW={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new nt(M.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new nt(M.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(r=>{var a;if(!At(a=["supervise","moderation"]).call(a,r))throw new nt(M.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new nt(M.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new YW(e)}};var hj=L(Ur.Object.getOwnPropertySymbols),XW=Qe,JW=jo.indexOf,QW=va,DI=Qt([].indexOf),pj=!!DI&&1/DI([1],1,-0)<0;XW({target:"Array",proto:!0,forced:pj||!QW("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return pj?DI(this,t,e)||0:JW(this,t,e)}});var ZW=Er("Array").indexOf,$W=dt,tK=ZW,LI=Array.prototype,eK=function(t){var e=t.indexOf;return t===LI||$W(LI,t)&&e===LI.indexOf?tK:e},fj=L(eK);function nK(t,e){if(t==null)return{};var n,i,r=function(c,l){if(c==null)return{};var u,h,p={},m=kx(c);for(h=0;h<m.length;h++)u=m[h],fj(l).call(l,u)>=0||(p[u]=c[u]);return p}(t,e);if(hj){var a=hj(t);for(i=0;i<a.length;i++)n=a[i],fj(e).call(e,n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}let mj=class{get localCapabilities(){return Gn(this._localCapabilities)}get rtpCapabilities(){return Gn(this._rtpCapabilities)}get candidates(){return Gn(this._candidates)}get iceParameters(){return Gn(this._iceParameters)}get dtlsParameters(){return Gn(this._dtlsParameters)}constructor(t){P(this,"sessionDesc",void 0),P(this,"_localCapabilities",void 0),P(this,"_rtpCapabilities",void 0),P(this,"_candidates",void 0),P(this,"_iceParameters",void 0),P(this,"_dtlsParameters",void 0),P(this,"setup",void 0),P(this,"currentMidIndex",void 0),P(this,"cname","o/i14u9pJrxRKAsu"),P(this,"firefoxSsrcMidMap",new Map),t=Gn(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,localCapabilities:a,direction:c,setup:l,videoCodec:u,audioCodec:h}=t;let p;this.setup=l,p=c===Jr.RECEIVE_ONLY?ys(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ys(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=a;const m=c===Jr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,g=c===Jr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,S=c===Jr.RECEIVE_ONLY?r.send.videoCodecs:iy(Bt.VIDEO,m,g,u),D=c===Jr.RECEIVE_ONLY?r.send.audioCodecs:iy(Bt.AUDIO,m,g,h);for(const w of p.mediaDescriptions)w.attributes.iceUfrag=e.iceUfrag,w.attributes.icePwd=e.icePwd,w.attributes.fingerprints=n.fingerprints,w.attributes.candidates=i,w.attributes.setup=this.setup,w.media.mediaType==="application"&&(w.attributes.sctpPort="5000"),w.media.mediaType==="video"&&(w.media.fmts=S.map(N=>N.payloadType.toString(10)),w.attributes.payloads=S,w.attributes.extmaps=m.videoExtensions),w.media.mediaType==="audio"&&(w.media.fmts=D.map(N=>N.payloadType.toString(10)),w.attributes.payloads=D,w.attributes.extmaps=m.audioExtensions,n_(w));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return zu(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,i,r){n=n.replace(/ /g,"-");const{ssrcs:a,ssrcGroups:c}=lf(e,this.cname,B("SYNC_GROUP")?n:void 0),l=this.findPreloadMediaDesc(a);if(l){if(Vn()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,l.attributes.mid),r&&(r.twcc||r.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(l,r),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(t,a,i);let h;return u===-1?(h=this.createOrRecycleSendMedia(t,a,c,"sendonly",i,r),this.updateBundleMids()):(h=Gn(this.sessionDesc.mediaDescriptions[u]),h.attributes.direction="sendonly",h.attributes.ssrcs=a,h.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(h,r)),Vn()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const i=[];return t.forEach(r=>{const a=r._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(a);let l,u=!1;c===-1?(u=!0,l=this.createOrRecycleRecvMedia(r,[],"recvonly",e,n),this.updateBundleMids()):(l=Gn(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),i.push({mid:l.attributes.mid,needCreateTransceiver:u})}),i}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:i,port:r,type:a,relatedAddress:c,relatedPort:l,priority:u}=new RTCIceCandidate(t),h={foundation:e??"",componentId:"1",transport:n??"",priority:u?u+"":"",connectionAddress:i??"",port:r?r+"":"",type:a?a+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(p=>p.priority===h.priority&&p.connectionAddress===h.connectionAddress&&p.port===h.port)||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,i,r){const a=t._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=iy(a,c,this.localCapabilities.send,a===Bt.AUDIO?r:i),u=a===Bt.VIDEO?c.videoExtensions:c.audioExtensions,h="".concat(++this.currentMidIndex);let p={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungRecvMediaDsec(p,t);const m=this.findFirstClosedMedia(a);if(m){const g=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[g]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>At(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>At(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Vn()){if(r){const a=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return r&&i.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=Gn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,i,r,a){const c=this.rtpCapabilities.send,l=t===Bt.VIDEO?c.videoCodecs:c.audioCodecs,u=t===Bt.VIDEO?c.videoExtensions:c.audioExtensions;Vn()&&(r="".concat(++this.currentMidIndex));let h={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};h=this.mungSendMediaDesc(h,a);const p=this.findFirstClosedMedia(t);if(p){const m=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[m]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(t,e,n){const i=Gn(t);return Pw(i),e_(i,e),kw(i,e),sM(i),lR(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=Gn(t);return lR(n,e,this.localCapabilities.recv),n_(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>Vn()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const iK=["sdp"];var Tn;function Ej(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ch(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ej(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ej(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let _j=(Tn=class m_ extends Bx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,i){super(e,n),P(this,"direction",void 0),P(this,"name",void 0),P(this,"store",void 0),P(this,"spec",void 0),P(this,"peerConnection",void 0),P(this,"initialOffer",void 0),P(this,"transport",void 0),P(this,"statsFilter",void 0),P(this,"localCandidateCount",0),P(this,"_isInRestartIce",!1),P(this,"mutex",void 0),P(this,"onLocalCandidate",void 0),P(this,"remoteSDP",void 0),P(this,"pendingCandidates",[]),P(this,"localCapabilities",void 0),P(this,"isReady",!1),P(this,"restartCnt",0),P(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.mutex=new lr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(m_.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Jr.SEND_ONLY,this.name=this.direction===Jr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=YA(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,Vn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await oM();if(this.localCapabilities=dR(n),e){const{sdp:i}=e,r=nK(e,iK),a=function(){const p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},m=ny(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ao(m,p,"videoExtensions",g,S,D),Ao(m,p,"videoCodecs",g,S,D),Ao(m,p,"audioExtensions",g,S,D),Ao(m,p,"audioCodecs",g,S,D),B("RAISE_H264_BASELINE_PRIORITY")){const w=D.videoCodecs.findIndex(N=>N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&N.fmtp&&N.fmtp.parameters["profile-level-id"]==="42001f");if(w!==-1){const N=D.videoCodecs.findIndex(k=>k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(N<w){T.debug("raising H264 baseline profile priority");const k=D.videoCodecs[w];D.videoCodecs.splice(w,1),D.videoCodecs.splice(N,0,k)}N!==-1&&B("FILTER_SEND_H264_BASELINE")&&(g.videoCodecs=g.videoCodecs.filter(k=>!(k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&k.fmtp&&k.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:g,recv:S,sendrecv:D}}({},{},i);this.remoteSDP=new mj({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const l=Qu(c.sdp);await this.peerConnection.setLocalDescription(c);const u=await cM({},{},c.sdp);this.localCapabilities=dR(u);const h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),ch(ch({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Qu(i.sdp);return this.initialOffer=i,ch(ch({},r),{},{sdp:i.sdp})}}catch(n){throw new ct(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:r}=e,a=await cM({},{},n);this.remoteSDP=new mj({remoteIceParameters:i,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new ct(M.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Da(function*(){const a=yield Fe(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=r.remoteSDP.receive(e,n,i);e.forEach((N,k)=>{if(l[k].needCreateTransceiver){const x=r.peerConnection.addTransceiver(N._mediaStreamTrack,{direction:"sendonly"});c.push(x),N._updateRtpTransceiver(x)}else{const x=r.peerConnection.getTransceivers().find(W=>W.mid===l[k].mid);if(!x)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[k].mid));c.push(x),N._updateRtpTransceiver(x)}}),Vn()&&B("SIMULCAST")===!0&&(yield Fe(r.applySimulcastForFirefox(c,e)));const u=l.map(N=>N.mid),h=yield Fe(r.peerConnection.createOffer()),p=r.mungSendOfferSDP(h.sdp,e,u),m=ys(p),g=u.map(N=>{const k=m.mediaDescriptions.find(x=>x.attributes.mid===N);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return nM(k,B("USE_PUB_RTX"))}),S=c.map((N,k)=>{const x=u[k];return{localSSRC:g[k],id:x}});yield Fe(r.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield S}catch(N){const k=r.remoteSDP.toString();throw yield Fe(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Fe(r.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield Fe(r.stopSending(u,!0)),N}yield Fe(r.applySimulcastEncodings(c,e)),yield Fe(r.applySendEncodings(c,e));const D=r.remoteSDP.toString(),w=r.logSDPExchange(p,"offer","local","send");return w==null||w(D),yield Fe(r.setRemoteDescription({type:"answer",sdp:D})),c.map((N,k)=>{const x=u[k];return{localSSRC:g[k],id:x}})}catch(c){throw c instanceof ct?c:new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(u=>e.indexOf(u.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));r.map(u=>{var h;u.direction="inactive",(h=u.stop)===null||h===void 0||h.call(u)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const u=this.remoteSDP.toString(),h=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});const p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,a,e);h==null||h(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(a){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async mockReceive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const l=this.remoteSDP.toString(),u=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(h.sdp,a,e);u==null||u(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(a){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===tf.Auto&&(this.store.p2pTransport=tf.SdRtn,Ke().supportPCSetConfiguration&&this.peerConnection.setConfiguration(m_.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ke().supportPCSetConfiguration&&this.peerConnection.setConfiguration(m_.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=Qu(n.sdp);return this.store.descriptionStart(),this.direction===Jr.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===Jr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=Qu(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new ct(M.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?Vn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:ch(ch({},ul),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:ch(ch({},ul),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;At(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r={iceServers:[]};var a;return e.iceServers?r.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(HS(e.turnServer.servers)?r.iceServers=e.turnServer.servers:(r.iceServers&&r.iceServers.push(...m_.turnServerConfigToIceServers(e.turnServer.servers,n,i)),B("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&e.turnServer.serversFromGateway&&r.iceServers.push(...m_.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,i)),At(a=[tf.Relay,tf.SdRtn]).call(a,n)&&(r.iceTransportPolicy="relay"),B("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&Ke().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),T.debug("P2PConnection p2pTransport is ".concat(n)),r}static turnServerConfigToIceServers(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=[],a=e.filter(l=>l.tcpport);T.debug("P2PConnection turnServers is ".concat(a,", current index is ").concat(i));const c=a.length>i?a[i]:a[0];switch(n){case tf.SdRtn:const l=e.filter(h=>{var p;return At(p=h.username).call(p,"glb:")&&h.turnServerURL==h.turnServerURL}),u=l.length>i?l[i]:l[0];u&&(r.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(Xu(u.turnServerURL),":").concat(u.tcpport,"?transport=udp")}),r.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(Xu(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}));break;case tf.Relay:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Xu(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Xu(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in i?i.error:i)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const i=e==null?void 0:e.iceTransport.state;var r;i&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:r}=n.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(p=>p.track===e._mediaStreamTrack)),!n)return T.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ke().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},a={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var c;const{bitrateMax:p,frameRate:m,scaleResolutionDownBy:g}=e._encoderConfig;p&&(a.maxBitrate=1e3*p),At(c=e._hints).call(c,_n.LOW_STREAM)&&(m&&(a.maxFramerate=Ws(m)),g&&g>=1&&(a.scaleResolutionDownBy=g))}if(B("DSCP_TYPE")&&Ed()){var l;const p=B("DSCP_TYPE");At(l=["very-low","low","medium","high"]).call(l,p)&&(a.networkPriority=p)}const u=n.getParameters(),h=(i=u.encodings)===null||i===void 0?void 0:i[0];Vn()&&!h&&(r.encodings=[a]),h&&Object.assign(h,a),Object.assign(u,r),T.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await n.setParameters(u)}async applySendEncodings(e,n){try{if(!Ke().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],a=n[i];a instanceof wn&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,r.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=ys(e);return n.forEach((a,c)=>{const l=i[c],u=r.mediaDescriptions.find(h=>h.attributes.mid===l);u&&(e_(u,a),aM(u,a,this.store.codec))}),zu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let u=0;u<e.length;u++){var i,r,a,c,l;const h=e[u],p=n[u];if(p instanceof wn&&!At(i=p._hints).call(i,_n.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((a=p._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},g={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];const S=h.sender.getParameters();await h.sender.setParameters(Object.assign(S,m))}}}async applySimulcastEncodings(e,n){if(!Vn()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof wn&&this.isVP8Simulcast(r)){const a=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const u=a.sender.getParameters();await a.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(e){var n,i,r,a,c;return!!(e instanceof wn&&B("SIMULCAST")&&this.store.codec==="vp8"&&!At(n=e._hints).call(n,_n.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=e._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(B("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const a=this.remoteSDP.toString();r==null||r(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async c=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const a=this.remoteSDP.toString();r==null||r(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var i,r;if(n=(i=n)!==null&&i!==void 0?i:(r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp){var a;const c=(a=ys(n).mediaDescriptions.find(l=>l.attributes.mid===e))===null||a===void 0?void 0:a.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),At(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,i){const r=ys(e),a=r.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&i===Bt.AUDIO&&a.media.mediaType==="audio"&&n_(a),zu(r)}},Yt(Tn.prototype,"establish",[Do],Object.getOwnPropertyDescriptor(Tn.prototype,"establish"),Tn.prototype),Yt(Tn.prototype,"connect",[Do],Object.getOwnPropertyDescriptor(Tn.prototype,"connect"),Tn.prototype),Yt(Tn.prototype,"receive",[Do],Object.getOwnPropertyDescriptor(Tn.prototype,"receive"),Tn.prototype),Yt(Tn.prototype,"mockReceive",[Do],Object.getOwnPropertyDescriptor(Tn.prototype,"mockReceive"),Tn.prototype),Yt(Tn.prototype,"stopReceiving",[Do],Object.getOwnPropertyDescriptor(Tn.prototype,"stopReceiving"),Tn.prototype),Yt(Tn.prototype,"restartICE",[Do],Object.getOwnPropertyDescriptor(Tn.prototype,"restartICE"),Tn.prototype),Yt(Tn.prototype,"close",[Do],Object.getOwnPropertyDescriptor(Tn.prototype,"close"),Tn.prototype),Yt(Tn.prototype,"updateEncoderConfig",[Do],Object.getOwnPropertyDescriptor(Tn.prototype,"updateEncoderConfig"),Tn.prototype),Yt(Tn.prototype,"updateSendParameters",[Do],Object.getOwnPropertyDescriptor(Tn.prototype,"updateSendParameters"),Tn.prototype),Yt(Tn.prototype,"replaceTrack",[Do],Object.getOwnPropertyDescriptor(Tn.prototype,"replaceTrack"),Tn.prototype),Yt(Tn.prototype,"muteLocal",[Do],Object.getOwnPropertyDescriptor(Tn.prototype,"muteLocal"),Tn.prototype),Yt(Tn.prototype,"unmuteLocal",[Do],Object.getOwnPropertyDescriptor(Tn.prototype,"unmuteLocal"),Tn.prototype),Tn);function Do(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,a=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}let Tc=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var gj,Sj,yj,Tj,vj,bj,Rj,Cj,Aj,wj,Ij,Pn;function Oj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function zR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Oj(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Oj(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let rK=(gj=vc(Tc.SEND_ONLY),Sj=vc(Tc.SEND_ONLY),yj=vc(),Tj=vc(Tc.RECEIVE_ONLY),vj=vc(Tc.RECEIVE_ONLY),bj=vc(Tc.RECEIVE_ONLY),Rj=vc(Tc.RECEIVE_ONLY),Cj=vc(Tc.RECEIVE_ONLY),Aj=vc(Tc.RECEIVE_ONLY),wj=vc(),Ij=vc(Tc.RECEIVE_ONLY),Pn=class extends Mn{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(ee.StateChange,e,this._state)}constructor(t,e){super(),P(this,"isPlanB",!1),P(this,"store",void 0),P(this,"statsUploader",void 0),P(this,"sendConnection",void 0),P(this,"recvConnection",void 0),P(this,"localTrackMap",new Map),P(this,"remoteUserMap",new Map),P(this,"localDataChannels",[]),P(this,"pendingLocalTracks",[]),P(this,"pendingRemoteTracks",[]),P(this,"statsCollector",void 0),P(this,"dtlsFailedCount",0),P(this,"sendMutex",void 0),P(this,"recvMutex",void 0),P(this,"_state",$e.Disconnected),P(this,"_restartStates",["disconnected","failed"]),P(this,"reconnectInterval",void 0),P(this,"uploadUnplinkStarted",!1),P(this,"uploadDownlinkStarted",!1),P(this,"uplinkStateUploadInterval",void 0),P(this,"downlinkStatsUploadInterval",void 0),P(this,"handleMuteLocalTrack",async(n,i,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==$e.Connected)return void r(new ct(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const u=this.filterTobeMutedTracks(n);if(u.length===0)return void i();const h=u.find(S=>S[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(u.map(S=>{let[,{id:D}]=S;return D}));let p=!1;var c,l;n.trackMediaType==="video"?p=!((c=this.localTrackMap.get(Et.LocalAudioTrack))===null||c===void 0||!c.track._muted):p=((l=this.localTrackMap.get(Et.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;const m=this.createMuteMessage(u);await mn(this,ee.RequestMuteLocal,m);const g=n.trackMediaType==="video"?qu.MUTE_LOCAL_VIDEO:qu.MUTE_LOCAL_AUDIO;await mn(this,ee.RequestP2PMuteLocal,{action:g,message:m,isMuteAll:p}),i()}catch(u){r(u)}finally{a()}}),P(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==$e.Connected)return void r(new ct(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();await this.sendConnection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const l=this.createUnmuteMessage(c),u=n.trackMediaType==="video"?qu.UNMUTE_LOCAL_VIDEO:qu.UNMUTE_LOCAL_AUDIO;await mn(this,ee.RequestP2PMuteLocal,{action:u,message:l}),i()}catch(c){r(c)}finally{a()}}),P(this,"handleUpdateVideoEncoder",async(n,i,r,a)=>{let c;typeof a=="boolean"&&a||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const u=this.localTrackMap.get(Et.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==n||this.state!==$e.Connected)return void i();const{id:h,track:p}=u;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(ee.UpdateVideoEncoder,p)),i()}catch(u){r(u)}finally{var l;(l=c)===null||l===void 0||l()}}),P(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(Et.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==$e.Connected)return void i();const{id:l,track:u}=c;l&&await this.sendConnection.updateSendParameters(l,u),i()}catch(c){r(c)}finally{a()}}),P(this,"handleReplaceTrack",async(n,i,r,a)=>{let c;T.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return n===m});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==$e.Connected)return void i();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),h[0]===Et.LocalVideoTrack&&Ke().supportDualStreamEncoding){const p=this.localTrackMap.get(Et.LocalVideoLowTrack);if(p){const m=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new wt((g,S)=>{this.handleReplaceTrack(p.track,g,S,!0)})}}i()}catch(h){r(h)}finally{var u;(u=c)===null||u===void 0||u()}}),P(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),P(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),P(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),P(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new YM(t),this.bindStatsUploaderEvents(),this.sendMutex=new lr("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new lr("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},B("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new ct(M.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new ct(M.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new _j(t,this.store,Jr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(e);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=$e.New,this.sendConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new _j(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new ct(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=$e.Connected}async addRemoteCandidate(t,e){if(e===Jr.RECEIVE_ONLY){if(!this.sendConnection)throw new ct(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new ct(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var i=this;return Da(function*(){const r=yield Fe(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==$e.Connected){i.throwIfTrackTypeNotMatch(t);const h=t.filter(p=>i.pendingLocalTracks.indexOf(p)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(h))}i.store.pubId=i.store.pubId+1,hr.markPublishStart(i.store.clientId,i.store.pubId);const a=i.filterTobePublishedTracks(t,e,n);if(a.length===0)return void(yield Fe(i.tryToUnmuteAudio(t)));a.forEach(h=>{let{track:p,type:m}=h;const g=Date.now();i.store.publish(p.getTrackId(),m===Et.LocalAudioTrack?"audio":"video",g)}),i.bindLocalTrackEvents(a);const c=yield Fe(i.sendConnection.send(a.map(h=>{let{track:p}=h;return p}),i.store.codec,i.store.audioCodec)),l=(yield Fe(c.next())).value,u=i.createGatewayPublishMessage(a,l);try{yield u}catch(h){throw c.throw(h),(h==null?void 0:h.code)===M.WS_ABORT&&a.forEach(p=>{let{track:m}=p;i.pendingLocalTracks.indexOf(m)===-1&&i.pendingLocalTracks.push(m)}),i.unbindLocalTrackEvents(a),h}yield Fe(c.next()),a.forEach(h=>{let{type:p}=h;i.statsCollector.addLocalStats(p)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(a,l),a.forEach(h=>{let{track:p,type:m}=h;const g=Date.now();i.store.publish(p.getTrackId(),m===Et.LocalAudioTrack?"audio":"video",void 0,g)}),i.startUploadUplinkState()}finally{r()}})()}async unpublish(t){if(!this.sendConnection||this.state!==$e.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!At(t).call(t,r)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(r=>r[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(r=>{let[,{id:a}]=r;return a})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[a,{track:c}]=r;return{type:a,track:c}})),e.forEach(r=>{let[a]=r;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===$e.Connected)return n&&n[1].track.close(),i;t.forEach(r=>{const a=this.pendingLocalTracks.indexOf(r);a!==-1&&this.pendingLocalTracks.splice(a,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:a,ssrcs:c}]=i;const l={stream_type:XH(a,r),ssrcs:c};a._muted||!a._enabled?e.push(l):n.push(l)}),e.length>0&&e.forEach(i=>{mn(this,ee.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{mn(this,ee.RequestUnmuteLocal,[i])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Da(function*(){throw new ct(M.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await er(this,ee.RequestRePublish,this.pendingLocalTracks),this.emit(ee.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ct(M.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,i){var r;if(!this.recvConnection)throw new ct(M.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(t))!==null&&r!==void 0&&r.has(e))return;const{track:a,mid:c,transceiver:l}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),i);e===Bt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(a):(t._audioTrack=new YE(a,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),l&&t._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(a):(t._videoTrack=new zE(a,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),l&&t._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._videoTrack));const u=this.remoteUserMap.get(t);u?u.set(e,c):this.remoteUserMap.set(t,new Map([[e,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const h=this.pendingRemoteTracks.findIndex(p=>{let{user:m,kind:g}=p;return m.uid===t.uid&&e===g});h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(ee.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,i){if(!this.recvConnection)throw new ct(M.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),i)}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(a=>{let{user:c,kind:l}=a;return e!==void 0?c.uid===t.uid&&e===l:c.uid===t.uid});if(i.forEach(a=>{const c=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||n||i.forEach(a=>{let{kind:c}=a;var l;if(c===Bt.AUDIO)(l=t._audioTrack)===null||l===void 0||l._destroy(),t._audioTrack=void 0;else if(c===Bt.VIDEO){var u;(u=t._videoTrack)===null||u===void 0||u._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const r=this.filterTobeUnSubscribedTracks(t,e);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(a=>{let[,{id:c}]=a;return c})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(a=>{let[c,{kind:l}]=a;var u,h;if(l===Bt.VIDEO&&c._videoSSRC&&((u=this.recvConnection)===null||u===void 0||u.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===Bt.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0);else if(l===Bt.AUDIO){var p;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((p=c._audioTrack)===null||p===void 0||p._destroy(),c._audioTrack=void 0)}}),r.forEach(a=>{let[,{kind:c}]=a;mn(this,ee.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[Bt.VIDEO,Bt.AUDIO].forEach(i=>{n.has(i)?mn(this,ee.RequestP2PUnmuteRemote,i):mn(this,ee.RequestP2PMuteRemote,i)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new ct(M.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new ct(M.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new ct(M.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new ct(M.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===Bt.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(Et.LocalAudioTrack);if((e==null?void 0:e.track)instanceof _i){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==Et.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===Et.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===Et.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(Et.LocalAudioTrack),l=i?this.localTrackMap.get(Et.LocalVideoLowTrack):this.localTrackMap.get(Et.LocalVideoTrack);Jt.publish(this.store.sessionId,{eventElapse:hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(_n.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var a;n||(n=[]);const c=n.find(u=>u instanceof Wn),l=i?(a=this.localTrackMap.get(Et.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(u=>u instanceof wn);Jt.publish(this.store.sessionId,{eventElapse:hr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(_n.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===Bt.VIDEO?n._videoSSRC:n._audioSSRC;r&&Jt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===Bt.VIDEO,audio:i===Bt.AUDIO,peerid:n.uid,subscribeRequestid:i===Bt.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:hr.measureFromSubscribeStart(this.store.clientId,r)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new lr("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new lr("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Et.LocalAudioTrack);if((t==null?void 0:t.track)instanceof _i){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=$e.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Et.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Et.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof wn||e&&e.track instanceof Wn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(oa(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(Et.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=wS(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=$e.Reconnecting,B("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case Et.LocalVideoTrack:At(e=i._hints).call(e,_n.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case Et.LocalAudioTrack:i instanceof _i?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case Et.LocalVideoLowTrack:}}),this.emit(ee.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(oa(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(ee.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof $u?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,i;if(t===Jr.SEND_ONLY){if(!this.sendConnection)throw new ct(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new ct(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(e){const r=await i.restartICE(e);return i.isInRestartIce=!1,r}{const r=await i.restartICE();if(r){const a=await er(this,ee.RequestP2PRestartICE,{direction:Jr.RECEIVE_ONLY,iceParameter:r});await i.restartICE(a),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(Et.LocalVideoTrack),n=this.localTrackMap.get(Et.LocalAudioTrack),i=t.videoSend.find(S=>{var D;return S.ssrc===(e==null||(D=e.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)}),r=t.audioSend.find(S=>{var D;return S.ssrc===(n==null||(D=n.ssrcs)===null||D===void 0?void 0:D[0].ssrcId)});if(!i||!r)return 1;const a=sa(this,ee.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,u=c&&l?(c+l)/2:c||l,h=(u&&a?(u+a)/2:u||a)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,g=e==null?void 0:e.track;if(g&&g._encoderConfig&&g._hints.indexOf(_n.SCREEN_TRACK)===-1){const S=g._encoderConfig.bitrateMax,D=t.bitrate.actualEncoded;if(S&&D){const w=(1e3*S-D)/(1e3*S);return Dx[w<.15?0:w<.3?1:w<.45?2:w<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,a=i._videoSSRC,c=t.audioRecv.find(D=>D.ssrc===r),l=t.videoRecv.find(D=>D.ssrc===a);if(!c&&!l)return void(e+=1);const u=sa(this,ee.NeedSignalRTT),h=t.rtt,p=(h&&u?(h+u)/2:h||u)||0,m=c?c.jitterMs:void 0,g=t.recvPacketLossRate;let S=.7*g*100/50+.3*p/1500;m&&(S=.6*g*100/50+.2*p/1500+.2*m/400),e+=S<.1?1:S<.17?2:S<.36?3:S<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new wt((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const i=[],r=Ke(),a=this.getAllTracks();t=PE(t=t.filter(u=>a.indexOf(u)===-1));let c=!1,l=!1;for(const u of t){if(u instanceof wn&&(this.localTrackMap.has(Et.LocalVideoTrack)||c?new ct(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:u,type:Et.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(u,n);i.push({track:h,type:Et.LocalVideoLowTrack})}if(u instanceof Wn){const h=this.localTrackMap.get(Et.LocalAudioTrack);if(h){if(!(h.track instanceof _i))throw new ct(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new ct(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(l){const p=i.find(m=>{let{type:g}=m;return g===Et.LocalAudioTrack});if(!(p.track instanceof _i))throw new ct(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new ct(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(u)}else{if(!r.webAudioMediaStreamDest||u instanceof _i||u._bypassWebAudio)i.push({track:u,type:Et.LocalAudioTrack});else{const p=new _i;p.addAudioTrack(u),i.push({track:p,type:Et.LocalAudioTrack})}l=!0}}}return i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=PE(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof Wn){const r=this.localTrackMap.get(Et.LocalAudioTrack);if(!r)continue;r.track instanceof _i?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([Et.LocalAudioTrack,r]),r.track.close())):e.push([Et.LocalAudioTrack,r])}if(i instanceof wn){const r=this.localTrackMap.get(Et.LocalVideoTrack);if(!r)continue;e.push([Et.LocalVideoTrack,r]);const a=this.localTrackMap.get(Et.LocalVideoLowTrack);a&&e.push([Et.LocalVideoLowTrack,a])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case Et.LocalVideoTrack:n.addListener(Ht.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ht.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ht.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ht.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ht.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ht.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ht.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ht.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Et.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Et.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof _i?t.trackList.forEach(n=>{n.addListener(Ht.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ht.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ht.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ht.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ht.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ht.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ht.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ht.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ht.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ht.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(Ht.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case Et.LocalVideoTrack:n.off(Ht.GET_STATS,this.handleGetLocalVideoStats),n.off(Ht.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ht.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ht.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ht.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ht.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ht.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ht.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Et.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Et.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof _i?t.trackList.forEach(e=>{e.off(Ht.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ht.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ht.GET_STATS,this.handleGetLocalAudioStats),e.off(Ht.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ht.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ht.GET_STATS,this.handleGetLocalAudioStats),t.off(Ht.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ht.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ht.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ht.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ht.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof zE&&e.addListener(Ht.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof YE&&e.addListener(Ht.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ht.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(Bt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(Bt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let a,{track:c,type:l}=n;switch(l){case Et.LocalAudioTrack:a=tn.Audio;break;case Et.LocalVideoTrack:a=At(r=c._hints).call(r,_n.SCREEN_TRACK)?tn.Screen:tn.High;break;case Et.LocalVideoLowTrack:a=tn.Low}return{kind:l===Et.LocalAudioTrack?Bt.AUDIO:Bt.VIDEO,stream_type:a,mid:e[i].id,ssrcs:e[i].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case Et.LocalVideoTrack:i=At(n=a._hints).call(n,_n.SCREEN_TRACK)?tn.Screen:tn.High;break;case Et.LocalAudioTrack:i=tn.Audio;break;case Et.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:a}=n;this.localTrackMap.set(a,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(ee.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),At(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await Hi(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Jt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Fn.TRACER}).onSuccess(),this.emit(ee.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(oa(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(FE.FIRST_FRAME_DECODED),Jt.firstRemoteFrame(this.store.sessionId,wi.FIRST_AUDIO_DECODE,Dn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(oa(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&Jt.firstRemoteFrame(this.store.sessionId,wi.FIRST_AUDIO_RECEIVED,Dn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(oa(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&Jt.firstRemoteFrame(this.store.sessionId,wi.FIRST_VIDEO_RECEIVED,Dn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(ee.ConnectionTypeChange,i),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ju(n))," -> ").concat(JSON.stringify(Ju(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ju(n))," -> ").concat(JSON.stringify(Ju(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(ee.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===Jr.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,T.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===Jr.SEND_ONLY?this.restartICE(t):er(this,ee.RequestP2PRestartICE,{direction:Jr.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(Et.LocalAudioTrack);if(t instanceof Wn&&(n==null?void 0:n.track)instanceof _i)return n.track.isActive||e.push([Et.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(i&&(e.push(i),i[0]===Et.LocalVideoTrack)){const r=this.localTrackMap.get(Et.LocalVideoLowTrack);r&&e.push([Et.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(Et.LocalAudioTrack);if(t instanceof Wn&&(n==null?void 0:n.track)instanceof _i)return n.track.isActive&&e.push([Et.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(i)if(i[0]===Et.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(Et.LocalVideoLowTrack);r&&e.push([Et.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case Et.LocalAudioTrack:i=tn.Audio;break;case Et.LocalVideoTrack:i=At(n=a._hints).call(n,_n.SCREEN_TRACK)?tn.Screen:tn.High;break;case Et.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case Et.LocalAudioTrack:i=tn.Audio;break;case Et.LocalVideoTrack:i=At(n=a._hints).call(n,_n.SCREEN_TRACK)?tn.Screen:tn.High;break;case Et.LocalVideoLowTrack:i=tn.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[a,c]=r;n.push([t,{kind:a,id:c}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:a}]=n;switch(r){case Bt.VIDEO:return void(i._videoSSRC&&e.push({stream_type:Bt.VIDEO,ssrcId:i._videoSSRC}));case Bt.AUDIO:return void(i._audioSSRC&&e.push({stream_type:Bt.AUDIO,ssrcId:i._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(Et.LocalVideoTrack),n=this.localTrackMap.get(Et.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new wt((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new wt((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof Wn){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await mn(this,ee.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(ee.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(ee.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Hi(FA(this.dtlsFailedCount,hi)),this.emit(ee.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Et.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof wn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof wn).length>1)throw new ct(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Wn).length>1&&(t.some(e=>e instanceof Wn&&e._bypassWebAudio)||!Ke().webAudioMediaStreamDest))throw new ct(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof wn&&this.pendingLocalTracks.some(n=>n instanceof wn))throw new ct(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Wn&&this.pendingLocalTracks.some(n=>n instanceof Wn)&&(!Ke().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Wn&&n._bypassWebAudio)))throw new ct(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ke().supportDualStreamEncoding,i=zR(zR({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=n?t._mediaStreamTrack.clone():Jw(t,i);const a=En(8,"track-low-"),c=new wn(r,zR(zR({},n&&{scaleResolutionDownBy:Lw(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return c.on(ef.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,VE.LOW_STREAM)}),c._hints.push(_n.LOW_STREAM),t.addListener(Ht.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,i){var r;const a=Array.from(oa(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(a){i||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===a.uid&&u.type==="video");Jt.firstRemoteVideoDecode(this.store.sessionId,wi.FIRST_VIDEO_DECODE,Dn.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:e,videoheight:n,subscribeElapse:hr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const a=await this.recvConnection.getRemoteSSRC(r);return a!==void 0&&a!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new ct(M.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new ct(M.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new ct(M.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new ct(M.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new ct(M.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new ct(M.NOT_SUPPORTED)}async preConnect(t){throw new ct(M.NOT_SUPPORTED)}getEstablishParams(){throw new ct(M.NOT_SUPPORTED)}async reSubscribe(t){throw new ct(M.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new ct(M.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===Et.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,VE.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Yt(Pn.prototype,"p2pConnect",[gj],Object.getOwnPropertyDescriptor(Pn.prototype,"p2pConnect"),Pn.prototype),Yt(Pn.prototype,"unpublish",[Sj],Object.getOwnPropertyDescriptor(Pn.prototype,"unpublish"),Pn.prototype),Yt(Pn.prototype,"unpublishLowStream",[yj],Object.getOwnPropertyDescriptor(Pn.prototype,"unpublishLowStream"),Pn.prototype),Yt(Pn.prototype,"subscribe",[Tj],Object.getOwnPropertyDescriptor(Pn.prototype,"subscribe"),Pn.prototype),Yt(Pn.prototype,"mockSubscribe",[vj],Object.getOwnPropertyDescriptor(Pn.prototype,"mockSubscribe"),Pn.prototype),Yt(Pn.prototype,"unsubscribe",[bj],Object.getOwnPropertyDescriptor(Pn.prototype,"unsubscribe"),Pn.prototype),Yt(Pn.prototype,"muteRemote",[Rj],Object.getOwnPropertyDescriptor(Pn.prototype,"muteRemote"),Pn.prototype),Yt(Pn.prototype,"unmuteRemote",[Cj],Object.getOwnPropertyDescriptor(Pn.prototype,"unmuteRemote"),Pn.prototype),Yt(Pn.prototype,"hasRemoteMediaWithLock",[Aj],Object.getOwnPropertyDescriptor(Pn.prototype,"hasRemoteMediaWithLock"),Pn.prototype),Yt(Pn.prototype,"disconnectForReconnect",[wj],Object.getOwnPropertyDescriptor(Pn.prototype,"disconnectForReconnect"),Pn.prototype),Yt(Pn.prototype,"remoteMediaSsrcChanged",[Ij],Object.getOwnPropertyDescriptor(Pn.prototype,"remoteMediaSsrcChanged"),Pn.prototype),Pn);function vc(t){return function(e,n,i){const r=e[n];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];switch(t){case Tc.SEND_ONLY:{const u=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{u()}}case Tc.RECEIVE_ONLY:{const u=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{u()}}default:{const u=await this.sendMutex.lock("From P2PChannel2.".concat(n)),h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{u(),h()}}}},i}}class bf extends Mn{constructor(e,n){super(),P(this,"signal",void 0),P(this,"token",void 0),P(this,"tokenTimeout",void 0),P(this,"tokenInterval",void 0),P(this,"_sequence",0),P(this,"userMap",new Map),P(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const i=()=>{this.signal.connectionState===yn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*B("P2P_TOKEN_INTERVAL"))};i()}async send(e,n,i,r,a){var c,l,u;if(this.userMap.size===0)return;const h=Array.from(Fi(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),r=(l=r)!==null&&l!==void 0?l:En(6,""),a=(u=a)!==null&&u!==void 0?u:this._sequence++;const p={_id:r,_type:e,_seq:a,_message:n,token:"".concat(this.token,"_").concat(h)};B("SHOW_P2P_LOG")&&T.debug("send message",p,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(p)).forEach(g=>{this.signal.request(ue.DATA_STREAM,{payload:Ku(this.encoder.encode(g))})});const m=new wt((g,S)=>{const D=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),w),this.off("res-@".concat(r),k),this.off(ZE.ABORT,N),T.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),this.userMap.size===0?S(new ct(M.INVALID_REMOTE_USER)):S(new ct(M.TIMEOUT))},B("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),w=()=>{D&&window.clearTimeout(D),this.off(ZE.ABORT,N),i&&g()},N=()=>{D&&window.clearTimeout(D),this.off("res-@".concat(r,"_ack"),w),this.off("res-@".concat(r),k),S(new ct(M.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(ZE.ABORT,N),this.once("res-@".concat(r,"_ack"),w);const k=(W,Z)=>{x=!0,D&&window.clearTimeout(D),this.off("res-@".concat(r,"_ack"),w),this.off(ZE.ABORT,N),W==="success"?g(Z):S(new ct(M.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let x=!1;i||(this.once("res-@".concat(r),k),Hi(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{x||T.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(p))}))});try{return await m}catch(g){if(g.code===M.TIMEOUT)return await this.send(e,n,i,r,a);throw g}}onMessage(e){var n;const{_uid:i}=e;let r,a=this.userMap.get(i);if(a)r=a.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==ei.CHECK)return;const{token:h}=e;r=new Map,a={uid:i,isStart:!0,token:h,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,a),this.signal.emit(Pe.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var c;const{id:h,total:p}=e,m=(c=r.get(h))!==null&&c!==void 0?c:[];if(m.push(e),r.has(h)||r.set(h,m),m.length!==p)return;{const g=wS(m).call(m,(S,D)=>S.index-D.index).map(S=>S.payload).join("");r.delete(h),(e=JSON.parse(g))._uid=i}}const{_type:l,token:u}=e;if(At(n=[ei.ACK,ei.CHECK]).call(n,l))return l===ei.CHECK&&this.handleCheckToken(a,u),void this.receiveMessage(e);u==="".concat(a.token,"_").concat(this.token)?this.handleReceivedMessage(e):T.debug('Receive unexpected message", '.concat(u,", cur_token: ").concat(a.token,"_").concat(this.token),e)}check(){const e={_id:En(6,""),token:this.token,_type:ei.CHECK};B("SHOW_P2P_LOG")&&T.debug("send message",e),this.signal.request(ue.DATA_STREAM,{payload:Ku(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:ei.ACK,token:this.token};B("SHOW_P2P_LOG")&&T.debug("send message",n),this.signal.request(ue.DATA_STREAM,{payload:Ku(this.encoder.encode(JSON.stringify(n)))})}response(e,n,i){this.send(ei.RESPONSE,JSON.stringify({success:!i,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(h=>{const{receivedMessagesMap:p,nextExpectedSequenceNumber:m}=h;for(;p.has(m);){const g=p.get(m);p.delete(m),this.receiveMessage(g),h.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:i,_seq:r}=e,a=this.userMap.get(i),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:u}=a;if(r<u)return this.ack(e._id),void T.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));c.set(r,e),l&&r===u&&(this.receiveMessage(e),c.delete(u),a.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:i,_message:r,_uid:a}=e;if(B("SHOW_P2P_LOG")&&T.debug("receive message",e),n){let c;switch(e._type!==ei.ACK&&(r&&(c=JSON.parse(r)),this.ack(e._id)),e._type){case ei.CANDIDATE:case ei.CONTROL:this.signal.emit(i,c,a);break;case ei.PUBLISH:case ei.UNPUBLISH:case ei.RESTART_ICE:case ei.CALL:c.uid=a,er(this.signal,i,c).then(l=>{this.response(e._id,l)}).catch(()=>{this.response(e._id,void 0,!0)});break;case ei.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case ei.RESPONSE:{const{success:l,message:u}=c;this.emit("res-@".concat(n),l?"success":"failed",u);break}}}}splitMessage(e){if(e.length<bf.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:i}=JSON.parse(e),r=En(6,"");let a=0,c=800;const l=Math.ceil(e.length/c);for(;e.length>0;){a++;const u={id:r,index:a,total:l,payload:e.slice(0,c),token:"".concat(this.token,"_").concat(i)};JSON.stringify(u).length>bf.MAX_MESSAGE_SIZE?c-=50:(n.push(u),e=e.slice(c))}return n.map(u=>JSON.stringify(u))}handleCheckToken(e,n){return e.token!==n?(T.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{T.debug("token timeout, ".concat(n)),this.reset(e.uid)},B("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await er(this.signal,ei.CALL,void 0),n=await this.send(ei.CALL,e);this.signal.emit(pe.P2P_CONNECTION,n,!0)}async reset(e,n){const i=this.userMap.get(e);i&&(this.emit(ZE.ABORT),this.signal.emit(Pe.ON_USER_OFFLINE,{uid:i.uid,reason:bH.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(T.debug("change local token from ".concat(n," to ").concat(n)),this.token=En(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(ZE.ABORT)}}P(bf,"MAX_SIZE",1),P(bf,"MAX_MESSAGE_SIZE",1024);class sK extends Mn{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===yn.CONNECTED?this.emit(pe.WS_CONNECTED):e===yn.RECONNECTING?this.emit(pe.WS_RECONNECTING,this._websocketReconnectReason):e===yn.CLOSED&&this.emit(pe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),P(this,"_disconnectedReason",void 0),P(this,"_websocketReconnectReason",void 0),P(this,"_connectionState",yn.CLOSED),P(this,"reconnectToken",void 0),P(this,"p2pToken",void 0),P(this,"websocket",void 0),P(this,"openConnectionTime",void 0),P(this,"clientId",void 0),P(this,"lastMsgTime",Date.now()),P(this,"uploadCache",[]),P(this,"uploadCacheInterval",void 0),P(this,"rttRolling",new sk(5)),P(this,"pingpongTimer",void 0),P(this,"pingpongTimeoutCount",0),P(this,"joinResponse",void 0),P(this,"multiIpOption",void 0),P(this,"initError",void 0),P(this,"spec",void 0),P(this,"store",void 0),P(this,"_external_signal",void 0),P(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(pe.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const a="res-@".concat(r._id);this.emit(a,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case Pe.ON_DATA_STREAM:return void this.handleDataStream(r._message);case Pe.MUTE_AUDIO:case Pe.MUTE_VIDEO:case Pe.ON_P2P_LOST:case Pe.ON_USER_ONLINE:return;case Pe.ON_USER_OFFLINE:const{uid:a}=r._message;return T.debug("[".concat(this.clientId,"] user-offline uid: ").concat(a)),void this._external_signal.reset(a)}if(this.emit(r._type,r._message),r._type===Pe.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Pe.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Ze.UID_BANNED);break;case 15:this.close(Ze.IP_BANNED);break;case 16:this.close(Ze.CHANNEL_BANNED)}if(r._type===Pe.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case ae.ERR_LICENSE_MISSING:this.close(Ze.LICENSE_MISSING);break;case ae.ERR_LICENSE_EXPIRED:this.close(Ze.LICENSE_EXPIRED);break;case ae.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ze.LICENSE_MINUTES_EXCEEDED);break;case ae.ERR_LICENSE_PERIOD_INVALID:this.close(Ze.LICENSE_PERIOD_INVALID);break;case ae.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ze.LICENSE_MULTIPLE_SDK_SERVICE);break;case ae.ERR_LICENSE_ILLEGAL:this.close(Ze.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new Nw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===yn.CONNECTED&&this.reconnect("retry",tr.OFFLINE)}),this.p2pToken=En(6,""),this._external_signal=new bf(this,this.p2pToken)}async request(e,n,i,r){const a=En(6,""),c={_id:a,_type:e,_message:n},l=this.websocket.connectionID,u=()=>new wt((D,w)=>{if(this.connectionState===yn.CONNECTED)return D();const N=()=>{this.off(pe.WS_CLOSED,k),D()},k=()=>{this.off(pe.WS_CONNECTED,N),w(new ct(M.WS_ABORT))};this.once(pe.WS_CONNECTED,N),this.once(pe.WS_CLOSED,k)});if(this.connectionState!==yn.CONNECTING&&this.connectionState!==yn.RECONNECTING||e===ue.JOIN||e===ue.REJOIN||await u(),this.websocket.sendMessage(c,!0),r)return;const h=new wt((D,w)=>{let N=!1;const k=(W,Z)=>{N=!0,D({isSuccess:W==="success",message:Z||{}}),this.off(pe.WS_CLOSED,x),this.off(pe.WS_RECONNECTING,x),this.emit(pe.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(a),k);const x=()=>{w(new ct(M.WS_ABORT,"type: ".concat(e))),this.off(pe.WS_CLOSED,x),this.off(pe.WS_RECONNECTING,x),this.off("res-@".concat(a),k)};this.once(pe.WS_CLOSED,x),this.once(pe.WS_RECONNECTING,x),Hi(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||N||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(pe.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(D){if(this.connectionState===yn.CLOSED||e===ue.LEAVE)throw new ct(M.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?D.throw():e===ue.JOIN||e===ue.REJOIN?null:(await u(),await this.request(e,n))}if(p.isSuccess)return p.message;const m=Number(p.message.error_code||p.message.code),g=$S(m),S=new ct(M.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(p.message.error_str),{code:m,data:p.message,desc:g.desc});return g.action==="success"?p.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(m,", message: ").concat(g.desc,", action: ").concat(g.action)),m===ae.ERR_TOO_MANY_BROADCASTERS?((e===ue.JOIN||e===ue.REJOIN)&&(this.initError=S,this.close()),S.throw()):g.action==="failed"?S.throw():g.action==="quit"?(this.initError=S,this.close(),S.throw()):(m===ae.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",tr.MULTI_IP)):this.reconnect(g.action,tr.SERVER_ERROR),e===ue.JOIN||e===ue.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new wt(i=>{const r=a=>{(!n||n(a))&&(this.off(e,r),i(a))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(QS.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const a=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==yn.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(e,n,i){return await this._external_signal.send(e,n,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new wt((n,i)=>{this.once(pe.WS_CONNECTED,()=>n(this.joinResponse)),this.once(pe.WS_CLOSED,()=>i(this.initError||new ct(M.WS_ABORT))),this.connectionState=yn.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Ze.LEAVE,this.connectionState=yn.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=En(6,""),this._external_signal.clear(),this._external_signal=new bf(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(pe.ABORT_P2P_EXECUTION);const e=await er(this,pe.REQUEST_JOIN_INFO),n=await this.request(ue.JOIN,e);if(!n)return this.emit(pe.REPORT_JOIN_GATEWAY,M.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(pe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const i=Zp(e.payload),r=new TextDecoder().decode(i),a=JSON.parse(r);"total"in a&&"id"in a||At(n=Object.values(ei)).call(n,a._type)?(a._uid=e.uid,this._external_signal.onMessage(a)):this.emit(Pe.ON_DATA_STREAM,e)}catch{this.emit(Pe.ON_DATA_STREAM,e)}}handleNotification(e){T.debug("[".concat(this.clientId,"] receive notification: "),e);const n=$S(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ze.UID_BANNED),void this.close()):void this.reconnect(n.action,tr.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=B("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(T.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",tr.TIMEOUT):this.request(ue.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),B("REPORT_STATS")&&this.send(ue.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(Se.RECONNECT_CREATE_CONNECTION,e=>{this.emit(pe.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Se.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Se.CLOSED,()=>{this.connectionState=yn.CLOSED}),this.websocket.on(Se.FAILED,()=>{this._disconnectedReason=Ze.NETWORK_ERROR,this.connectionState=yn.CLOSED}),this.websocket.on(Se.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===yn.CONNECTED?this.connectionState=yn.RECONNECTING:this.connectionState=yn.CONNECTING}),this.websocket.on(Se.WILL_RECONNECT,(e,n,i)=>{e!=="retry"?(T.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):T.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(Se.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(pe.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof ct&&e.code===M.UNEXPECTED_RESPONSE&&e.data.code===ae.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",tr.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",tr.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Se.REQUEST_NEW_URLS,(e,n)=>{er(this,pe.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(Se.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const aK={name:"P2PChannel",create:function(t){let{store:e,statsCollector:n}=t;return new rK(e,n)},createSubmodule:function(t){let{store:e,spec:n}=t;return new sK(n,e)}};function Nj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Dj(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Nj(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Nj(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class oK{constructor(e){P(this,"sessionDesc",void 0),P(this,"localCapabilities",void 0),P(this,"rtpCapabilities",void 0),P(this,"candidates",void 0),P(this,"_originCandidates",void 0),P(this,"iceParameters",void 0),P(this,"dtlsParameters",void 0),P(this,"setup",void 0),P(this,"currentMidIndex",void 0),P(this,"cname",void 0),e=Gn(e);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:a,setup:c,localCapabilities:l,sdkCodec:u,cname:h}=e,p=ys(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a,this.candidates=r,this._originCandidates=Gn(r),this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=l,this.cname=h;for(let m=0;m<p.mediaDescriptions.length;m++){const g=p.mediaDescriptions[m];if(g.attributes.iceUfrag=n.iceUfrag,g.attributes.icePwd=n.icePwd,g.attributes.fingerprints=i.fingerprints,g.attributes.candidates=r,g.attributes.setup=c,g.media.mediaType==="video"){g.media.fmts=a.videoCodecs.map(D=>D.payloadType.toString(10));let S=a.videoCodecs.filter(D=>{var w,N;return(w=D.rtpMap)===null||w===void 0?void 0:At(N=w.encodingName.toLowerCase()).call(N,u)});S.length===0&&(S=a.videoCodecs),g.attributes.payloads=S,g.attributes.extmaps=a.videoExtensions}g.media.mediaType==="audio"&&(g.media.fmts=a.audioCodecs.map(S=>S.payloadType.toString(10)),g.attributes.payloads=a.audioCodecs,g.attributes.extmaps=a.audioExtensions),p.mediaDescriptions[m]=this.mungMediaDesc(g)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return zu(this.sessionDesc)}send(e,n,i){const{ssrcs:r,ssrcGroups:a}=lf(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(h=>e===Bt.VIDEO?h.media.mediaType==="video":h.media.mediaType==="audio"),l=r[0].attributes.label,u=r[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(r),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(a),{id:l,mslabel:u}}batchSend(e){return e.map(n=>{let{kind:i,ssrcMsg:r}=n;return this.send(i,r,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],r=[],a=[];n.attributes.ssrcs.forEach(c=>{At(e).call(e,c.attributes.label||"")?a.push(c):i.push(c)}),n.attributes.ssrcGroups.forEach(c=>{var l;At(l=a.map(u=>u.ssrcId)).call(l,c.ssrcIds[0])||r.push(c)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=r})}mute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(e,n,i){e.forEach((r,a)=>{const c=r._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===c.kind),u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],r);this.sessionDesc.mediaDescriptions[l]=u})}stopReceiving(e){}updateCandidates(e){const n=this._originCandidates.filter(r=>r.transport==="udp"),i=[];if(n.forEach(r=>{i.push(Dj(Dj({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),n.length!==0){switch(e){case ur.TCP_RELAY:this.candidates=i;break;case ur.UDP_TCP_RELAY:case ur.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=Gn(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(e,n){const i=Gn(e);return e_(i,n),kw(i,n),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,n,i){const r=this.sessionDesc.mediaDescriptions.find(c=>e===Bt.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(r){const c=r.attributes.ssrcs.find(l=>l.attributes.label===n);var a;c&&(c.attributes.label=i,(a=c.attributes.msid)===null||a===void 0||a.replace(n,i))}}mungMediaDesc(e){const n=Gn(e);return Pw(n),function(i){const r=i.attributes.extmaps.find(a=>cR(a.extensionName));r&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(r),1),i.attributes.payloads.forEach(a=>{const c=a.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&a.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(e){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===e)return[i]}}var un;function Lj(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function YR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Lj(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Lj(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let cK=(un=class Uy extends Fx{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return At(n=Object.keys(Ub)).call(n,e)}))]}constructor(e,n){super(e,n),P(this,"store",void 0),P(this,"peerConnection",void 0),P(this,"remoteSDP",void 0),P(this,"initialOffer",void 0),P(this,"statsFilter",void 0),P(this,"useRTX",!1),P(this,"localCapabilities",void 0),P(this,"localCandidateCount",0),P(this,"allCandidatesReceived",!1),P(this,"establishPromise",void 0),P(this,"mutex",void 0),this.store=n,this.mutex=new lr("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Uy.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=YA(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,Vn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Qu(e.sdp),i=ny(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,YR(YR({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new ct(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new oK(YR(YR({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new ct(M.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var i=this;return Da(function*(){const r=yield Fe(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=e.map(g=>i.peerConnection.addTrack(g._mediaStreamTrack)),c=yield Fe(i.peerConnection.createOffer()),l=ys(c.sdp),u=e.map(g=>{const S=g._mediaStreamTrack,D=l.mediaDescriptions.find(w=>w.attributes.mid===S.kind);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return function(w,N,k){const x=w.attributes.ssrcs.filter(Z=>Z.attributes.label===N),W=w.attributes.ssrcGroups;if(x.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(W&&x.length>1){const Z=W.find($=>$.ssrcIds.indexOf(x[0].ssrcId)!==-1);return Z?[{ssrcId:Z.ssrcIds[0],rtx:k?Z.ssrcIds[1]:void 0}]:[{ssrcId:x[0].ssrcId}]}return[{ssrcId:x[0].ssrcId}]}(D,S.id,i.useRTX)});let h;try{h=yield u}catch(g){throw a.forEach(S=>{$i()&&S.replaceTrack(null),i.peerConnection.removeTrack(S)}),g}const p=i.mungSendOfferSDP(c.sdp,e);i.remoteSDP.receive(e,n,h);const m=i.remoteSDP.toString();return yield Fe(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Fe(i.applySendEncodings(a,e)),yield Fe(i.peerConnection.setRemoteDescription({type:"answer",sdp:m})),e.map((g,S)=>{const D=g._mediaStreamTrack.id;return{localSSRC:u[S],id:D}})}catch(a){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{r()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(a=>{var c;return e.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(a=>{$i()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:a,mslabel:c}=this.remoteSDP.send(e,n,r),l=new wt((p,m)=>{const g=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(a)))},1e4),S=D=>{const w=Ge();if((w.name==="Safari"&&Number(w.version)===11||Yr())&&D.track.id!==a&&D.streams[0].id===c){var N;const k=D.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(e,a,D.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(g),void p(k)}if(D.track.id===a)return this.peerConnection.removeEventListener("track",S),clearTimeout(g),void p(D.track)};this.peerConnection.addEventListener("track",S)}),u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await l,id:a}}catch(a){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var r;return e.indexOf(((r=i.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if($i()&&i.track)i.track.enabled=!1;else{const r=i.getParameters();r.encodings.forEach(a=>a.active=!1),i.setParameters(r)}})}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(a=>{var c;return e.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async a=>{if($i()&&a.track)a.track.enabled=!0;else{const c=a.getParameters();c.encodings.forEach(l=>l.active=!0),await a.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Da(function*(){const i=yield Fe(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Ke().supportPCSetConfiguration;if(e===ur.RELAY&&!r)return;if(r){const h=n.peerConnection.getConfiguration(),p=e===ur.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,n.peerConnection.setConfiguration(h))}e!==ur.RELAY&&n.remoteSDP.updateCandidates(e);const a=yield Fe(n.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=Qu(a.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const u=n.remoteSDP.toString();yield Fe(n.peerConnection.setLocalDescription(a)),yield Fe(n.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(r){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new ct(M.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getSenders().filter(r=>{var a;return((a=r.track)===null||a===void 0?void 0:a.id)===e});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getSenders().find(r=>{var a;return((a=r.track)===null||a===void 0?void 0:a.id)===n});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new ct(M.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new ct(M.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(HS(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...Uy.turnServerConfigToIceServers(e.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...Uy.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===e._mediaStreamTrack.id})),!n)return T.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!Ke().supportSetRtpSenderParameters)return T.warn("Browser not support set rtp-sender parameters");const r={},a={};if(e instanceof wn)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(B("DSCP_TYPE")&&Ed()){var c;const h=B("DSCP_TYPE");At(c=["very-low","low","medium","high"]).call(c,h)&&(a.networkPriority=h)}const l=n.getParameters(),u=(i=l.encodings)===null||i===void 0?void 0:i[0];u&&Object.assign(u,a),Object.assign(l,r),T.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(e,n){try{if(!Ke().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],a=n[i];r&&a&&await this.updateRtpSenderEncodings(a,r)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const i=ys(e);return n.forEach((r,a)=>{const c=r._mediaStreamTrack,l=i.mediaDescriptions.find(u=>u.attributes.mid===c.kind);l&&e_(l,r)}),zu(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((a,c)=>{let{id:l,mslabel:u}=a;const{kind:h}=e[c];return new wt((p,m)=>{const g=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(l)))},1e4),S=D=>{const w=Ge();if(w.name==="Safari"&&Number(w.version)===11&&D.track.id!==l&&D.streams[0].id===u){var N;const k=D.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(h,l,D.track.id),this.peerConnection.removeEventListener("track",S),clearTimeout(g),void p({track:k,id:l})}if(D.track.id===l)return this.peerConnection.removeEventListener("track",S),clearTimeout(g),void p({track:D.track,id:l})};this.peerConnection.addEventListener("track",S)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await wt.all(n)}catch(n){throw new ct(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(Ke().supportPCSetConfiguration){const n=Uy.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Yt(un.prototype,"connect",[Va],Object.getOwnPropertyDescriptor(un.prototype,"connect"),un.prototype),Yt(un.prototype,"stopSending",[Va],Object.getOwnPropertyDescriptor(un.prototype,"stopSending"),un.prototype),Yt(un.prototype,"receive",[Va],Object.getOwnPropertyDescriptor(un.prototype,"receive"),un.prototype),Yt(un.prototype,"stopReceiving",[Va],Object.getOwnPropertyDescriptor(un.prototype,"stopReceiving"),un.prototype),Yt(un.prototype,"muteRemote",[Va],Object.getOwnPropertyDescriptor(un.prototype,"muteRemote"),un.prototype),Yt(un.prototype,"unmuteRemote",[Va],Object.getOwnPropertyDescriptor(un.prototype,"unmuteRemote"),un.prototype),Yt(un.prototype,"muteLocal",[Va],Object.getOwnPropertyDescriptor(un.prototype,"muteLocal"),un.prototype),Yt(un.prototype,"unmuteLocal",[Va],Object.getOwnPropertyDescriptor(un.prototype,"unmuteLocal"),un.prototype),Yt(un.prototype,"close",[Va],Object.getOwnPropertyDescriptor(un.prototype,"close"),un.prototype),Yt(un.prototype,"updateEncoderConfig",[Va],Object.getOwnPropertyDescriptor(un.prototype,"updateEncoderConfig"),un.prototype),Yt(un.prototype,"updateSendParameters",[Va],Object.getOwnPropertyDescriptor(un.prototype,"updateSendParameters"),un.prototype),Yt(un.prototype,"replaceTrack",[Va],Object.getOwnPropertyDescriptor(un.prototype,"replaceTrack"),un.prototype),Yt(un.prototype,"getRemoteSSRC",[Va],Object.getOwnPropertyDescriptor(un.prototype,"getRemoteSSRC"),un.prototype),un);function Va(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,a=await r.lock("Locking from P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}const lK={name:"PlanBConnection",create:function(t){let{store:e,spec:n}=t;return new cK(n,e)}},dK={interceptLocalAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ke().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(zb.has(t)||!t.track)return;const n={track:t.track};if(md()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void T.error("create audio-encoded-streams error",c&&c.message)}const a=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const u=e.metadata&&e.metadata();u?function(h,p){const{chunk:m,controller:g}=p,S=B("ENABLE_AUDIO_PTS_METADATA")?yd.AUDIO_64_BIT_PTS:yd.METADATA;m.data=function(D,w,N){const k=N.byteLength,x=k+_w+Cx,W=mw+Ew+x,Z=new ArrayBuffer(D.byteLength+W),$=new DataView(Z);$.setUint8(0,Rx),$.setUint16(1,x),$.setUint8(3,w),$.setUint16(4,k);for(let ot=0;ot<k;ot++)$.setUint8(6+ot,N[ot]);const q=new Uint8Array($.buffer);return q.set(new Uint8Array(D),W),q.buffer}(m.data,S,h),g.enqueue(m)}(u,{chunk:c,controller:l}):l.enqueue(c)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else if($i()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=Kb(),a=new MessageChannel;await new wt(l=>r.onmessage=u=>{u.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-tx",port:a.port2},[a.port2]);t.transform=c,await new wt(l=>r.onmessage=u=>{u.data==="started"&&l(void 0)}),a.port1.onmessage=l=>{var u;if(l.data.transformed&&t.track&&((u=t.track)===null||u===void 0?void 0:u.id)!==n.track.id)T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i);else if(l.data.getMetadata){const h=e.metadata&&e.metadata();h&&a.port1.postMessage({metadata:h})}},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=zb.get(t);if(r){zb.delete(t);try{var a,c;(a=r.controller)===null||a===void 0||a.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){T.warning(l&&l.message)}}}zb.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ke().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(Zb.has(t))return;const n={track:t.track,onMetadata:e.onMetadata};if(md()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");OA(Ye.CHROME,87,116)||(e.enableTopn=!1);let r=null;try{r=t.createEncodedStreams()}catch(c){return void T.error("create audio-encoded-streams error",c&&c.message)}const a=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)),e.enableTopn?function(u,h,p){var m;const g=Ax(new DataView(h.data));if(!g)return p.enqueue(h);const S=u.track.id;WG.set(S,u.track);const D=(m=g.tlv.find(Z=>Z.tag===yd.AUDIO_LEVEL))===null||m===void 0?void 0:m.value;let w=0;typeof D=="number"&&(w=127-D);const N=Math.round(Math.pow(10,w/60)-1),{selected:k,speaker:x}=function(Z,$){let q=qE.get(Z);if(q||(q=function(ot){const _t=new Ix;return qE.set(ot,_t),Ec||(Ec=new GG(B("TOPN_SILENCE_THRESHOLD")||500),Ec.on("ActiveSpeakerChanged",Nt=>{Nt!=null&&(Xb=Nt)})),Ec.addSpeakers([_t]),_t}(Z)),qE.size<=Ox)return{selected:!0,speaker:q};if(!Ec)throw new Error("no active speaker detector");return Ec.levelChanged(q.id,$),af=Ec.loudest.map(ot=>ot.id),Xb&&!At(af).call(af,Xb)&&af.length>=Ox&&af.pop(),{selected:At(af).call(af,q.id)||q.id===Xb,speaker:q}}(u,N),W=function(Z,$,q){const ot=_c.get(Z)||new HG(Z,$);return ot.score=q,_c.set(Z,ot),function(_t){if(Jb.set(_t,!0),!Qb)return void(Qb=Date.now());const Nt=Date.now();Nt-Qb>1e3&&(Jb.get(_t)?Jb.set(_t,!1):(Nx(_t),Jb.delete(_t)),Qb=Nt)}(Z),ot}(S,u.track,x.energyScore);W.addSample(k),W.active&&(h.data=g.frame.buffer,p.enqueue(h))}(t,c,l):e.enableMetadata?function(u,h,p){const m=Ax(new DataView(u.data));if(!m)return h.enqueue(u);const g=m.tlv.find(S=>S.tag===yd.METADATA||S.tag===yd.AUDIO_64_BIT_PTS);g&&p&&g.value instanceof Uint8Array&&p(g.value),u.data=m.frame.buffer,h.enqueue(u)}(c,l,e.onMetadata):l.enqueue(c)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else if($i()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=Kb(),a=new MessageChannel;await new wt(l=>r.onmessage=u=>{u.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-rx",port:a.port2},[a.port2]);t.transform=c,await new wt(l=>r.onmessage=u=>{u.data==="started"&&l(void 0)}),a.port1.onmessage=l=>{var u;l.data.transformed&&t.track&&((u=t.track)===null||u===void 0?void 0:u.id)!==n.track.id?(T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.metadata&&n.onMetadata&&n.onMetadata(l.data.metadata)},n.worker=r}function i(){t.track.removeEventListener("ended",i),function(r){const a=Zb.get(r);if(a){(function(u){const h=qE.get(u);h&&(qE.delete(u),Ec&&(Ec.removeSpeakers([h]),qE.size===0&&(Ec.destroy(),Ec=null)))})(r),Nx(r.track.id),Zb.delete(r);try{var c,l;(c=a.controller)===null||c===void 0||c.terminate(),(l=a.worker)===null||l===void 0||l.terminate()}catch(u){T.warning(u&&u.message)}}}(t)}Zb.set(t,n),t.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(t,e){if(!Ke().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if($b.has(t)||!t.track)return;const n={track:t.track};if(md()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(l){return void T.error("create video-encoded-streams error",l&&l.message)}const a=[];e.on("sei-to-send",l=>{a.push(l)});const c=new TransformStream({transform(l,u){n.controller||(n.controller=u),t.track&&t.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const h=a.shift();h&&(l.data=function(p,m){const g=function(x){const W=x.length;let Z=[],$=0;for(;$<W;)$+2<W&&x[$]===0&&x[$+1]===0&&(x[$+2]===0||x[$+2]===1||x[$+2]===2||x[$+2]===3)?(Z.push(x[$],x[$+1],3,x[$+2]),$+=3):(Z.push(x[$]),$++);return new Uint8Array(Z)}(m),S=g.length,D=Math.floor(S/255),w=S%255,N=new Uint8Array(6+D+1+S+p.byteLength);N[0]=0,N[1]=0,N[2]=0,N[3]=1,N[4]=6,N[5]=101;let k=0;for(;k<D;)N[6+k]=255,k++;return N[6+k]=w,k++,N.set(g,6+k),N.set(new Uint8Array(p),6+k+S),N.buffer}(l.data,h)),u.enqueue(l)}});r.readable.pipeThrough(c).pipeTo(r.writable)}else{if(!$i())return;{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=Kb(),a=new MessageChannel;await new wt(l=>r.onmessage=u=>{u.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-tx",port:a.port2},[a.port2]);t.transform=c,await new wt(l=>r.onmessage=u=>{u.data==="started"&&l(void 0)}),e.on("sei-to-send",l=>{a.port1.postMessage({sei:l})}),a.port1.onmessage=l=>{var u;l.data.transformed&&t.track&&((u=t.track)===null||u===void 0?void 0:u.id)!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=$b.get(t);if(r){$b.delete(t);try{var a,c;(a=r.controller)===null||a===void 0||a.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){T.warning(l&&l.message)}}}$b.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ke().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(!t.track)return;if(JS.has(t)){const r=JS.get(t);return void(r&&(r.onSei=e.onSei))}const n={track:t.track,onSei:e.onSei};if(md()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void T.error("create video-encoded-streams error",c&&c.message)}const a=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const u=function(h){const p=new DataView(h.data);let m=0;for(;m+4<h.data.byteLength;){if(p.getUint8(m+0)===0&&p.getUint8(m+1)===0&&p.getUint8(m+2)===0&&p.getUint8(m+3)===1&&p.getUint8(m+4)===6){let g=m+6,S=0,D=0;for(;(D=p.getUint8(g++))===255;)S+=255;S+=D;const w=KG(h.data,g,S);return new Uint8Array(w)}m++}return null}(c);u&&n.onSei&&n.onSei(u),l.enqueue(c)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else if($i()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=Kb(),a=new MessageChannel;await new wt(l=>r.onmessage=u=>{u.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-rx",port:a.port2},[a.port2]);t.transform=c,await new wt(l=>r.onmessage=u=>{u.data==="started"&&l(void 0)}),a.port1.onmessage=l=>{var u;l.data.transformed&&t.track&&((u=t.track)===null||u===void 0?void 0:u.id)!==n.track.id?(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.sei&&n.onSei&&n.onSei(l.data.sei)},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}(function(r){const a=JS.get(r);if(a){JS.delete(r);try{var c,l;(c=a.controller)===null||c===void 0||c.terminate(),(l=a.worker)===null||l===void 0||l.terminate()}catch(u){T.warning(u&&u.message)}}})(t)}JS.set(t,n),t.track.addEventListener("ended",i)}},uK={name:"InterceptFrame",create:()=>dK};qA(),sn("PROCESS_ID","process-".concat(En(8,""),"-").concat(En(4,""),"-").concat(En(4,""),"-").concat(En(4,""),"-").concat(En(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void T.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();T.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(An,i)){const{value:r,expires:a}=e[i];if(a&&a<=n)return;mc[i]=r,An[i]=r}})}catch(e){T.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(mc.AREAS)&&mc.AREAS.length>0&&Vw(mc.AREAS,!0);const Pj=(t,e,n)=>{T.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),sn(t,e,n)};Zu(kW,!1),Zu(UW,!1),Zu(E8,!1),Zu(qW,!1),Zu(DW,!1),Zu(aK,!1),Zu(lK,!1),Zu(uK,!1);const pi=function(t){const e=new Mn,n=t,i={getListeners:e.getListeners.bind(e),on:(r,a)=>(function(c,l){c===ml.SECURITY_POLICY_VIOLATION&&pU(l,!0)}(r,a),e.on.bind(e)(r,a)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return hU(hU({},n),i)}({__TRACK_LIST__:jE,VERSION:La,BUILD:QA,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Pj,getParameter:B,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(i){let r;return Ke().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),r=(await i.createOffer()).sdp):r=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r}(e);if(!n)return t;e.close(),e=null,t=function(i){const r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ H265/i)&&r.video.push("H265"),i.match(/ opus/i)&&r.audio.push("OPUS"),i.match(/ PCMU/i)&&r.audio.push("PCMU"),i.match(/ PCMA/i)&&r.audio.push("PCMA"),i.match(/ G722/i)&&r.audio.push("G722"),r}(n)}catch(e){throw new nt(M.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=Jt.reportApiInvoke(null,{name:ui.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Fn.TRACER});let e=!1;try{const a=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;e=!!(a&&c&&l),e&&PA()&&kP(75)&&new a().close()}catch(a){return T.error("check system requirement failed: ",a),!1}let n=!1;const i=Ge();i.name===Ye.CHROME&&Number(i.version)>=58&&(pc.engine.name!=="WebKit"||function(){const a=Ge();if(Ib()){if(a.os===Ai.MAC_OS)return!0;if(a.os===Ai.IOS){const c=pc.os.version&&pc.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(n=!0),(i.name===Ye.FIREFOX&&Number(i.version)>=56||i.name===Ye.OPERA&&Number(i.version)>=45||i.name===Ye.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(Yr()||yo())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||BP()||Ge().name===Ye.QQ)&&(n=!0),T.debug("checkSystemRequirements, api:",e,"browser",n);const r=e&&n;return t.onSuccess(r),r},getDevices:function(t){return ha.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return ha.getRecordingDevices(t)},getCameras:function(t){return ha.getCamerasDevices(t)},getElectronScreenSources:kk,getPlaybackDevices:function(t){return ha.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=En(5,"client-"),i=Jt.reportApiInvoke(null,{id:n,name:ui.CREATE_CLIENT,options:[e],tag:Fn.TRACER});try{(function(r){bi(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),bi(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&bi(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Gi(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&qP(r.turnServer),r.httpRetryConfig!==void 0&&YP(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&YP(r.websocketRetryConfig)})(e)}catch(r){throw i.onError(r),r}return(MP(16,0)||UP(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",T.debug("browser not support vp9, force use vp8")),sn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),i.onSuccess(),new _8(Io(Io({forceWaitGatewayResponse:!0},e),{},{role:At(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}),n)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=B("CAMERA_CAPTURE_CONFIG"),n=En(8,"track-cam-"),i=Jt.reportApiInvoke(null,{id:n,tag:Fn.TRACER,name:ui.CREATE_CAM_VIDEO_TRACK,options:[Ln({},t),e]});e&&(t.encoderConfig=e);const r=Hb(t);let a=null;T.info("start create camera video track with config",JSON.stringify(t),"trackId",n);try{a=(await ua({video:r},n)).getVideoTracks()[0]||null}catch(l){throw i.onError(l),l}if(!a){const l=new ct(M.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(l),l.throw(T)}t.optimizationMode&&fw(n,a,t,hl(t.encoderConfig));const c=new pw(a,t,r,t.scalabiltyMode?Vb(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return i.onSuccess(c.getTrackId()),T.info("create camera video success, trackId:",n),c},createCustomVideoTrack:function(t){const e=En(8,"track-cus-"),n=Jt.reportApiInvoke(null,{id:e,tag:Fn.TRACER,name:ui.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),i=new wn(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?Vb(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,e,[_n.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),T.info("create custom video track success with config",t,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof e=="object"?function(g){return Wk(g)}(e):void 0;n&&(e="auto");const i=En(8,"track-scr-v-"),r=Jt.reportApiInvoke(null,{id:i,tag:Fn.TRACER,name:ui.CREATE_SCREEN_VIDEO_TRACK,options:[Ln({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const a=function(g){const S={};g.screenSourceType&&(S.mediaSource=g.screenSourceType),g.extensionId&&md()&&(S.extensionId=g.extensionId);const{displaySurface:D,selfBrowserSurface:w,surfaceSwitching:N,systemAudio:k,preferCurrentTab:x}=g;(VS(107)||NA(107)||DA(93))&&(D&&(bi(D,"displaySurface",["browser","window","monitor"]),S.displaySurface=D),w?(bi(w,"selfBrowserSurface",["exclude","include"]),S.selfBrowserSurface=w):S.selfBrowserSurface="include",N&&(bi(N,"surfaceSwitching",["exclude","include"]),S.surfaceSwitching=N)),(VS(105)||NA(105)||DA(91))&&k&&(bi(k,"systemAudio",["exclude","include"]),S.systemAudio=k),(VS(94)||NA(94)||DA(80))&&x&&(S.preferCurrentTab=!0),g.electronScreenSourceId&&(S.sourceId=g.electronScreenSourceId);const W=g.encoderConfig?nw(g.encoderConfig):null;return S.mandatory={chromeMediaSource:"desktop",maxWidth:W?W.width:void 0,maxHeight:W?W.height:void 0},W&&(W.frameRate&&(typeof W.frameRate=="number"?(S.mandatory.maxFrameRate=W.frameRate,S.mandatory.minFrameRate=W.frameRate):(S.mandatory.maxFrameRate=W.frameRate.max||W.frameRate.ideal||W.frameRate.exact||void 0,S.mandatory.minFrameRate=W.frameRate.min||W.frameRate.ideal||W.frameRate.exact||void 0),S.frameRate=W.frameRate),W.width&&(S.width=W.width),W.height&&(S.height=W.height)),S}(t);let c=null,l=null;const u=Ke();if(!u.supportShareAudio&&e==="enable"){const g=new ct(M.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(g),g.throw(T)}T.info("start create screen video track with config",t,"withAudio",e,"trackId",i);const h=u.supportShareAudio&&e!=="disable";try{const g=await ua({screen:a,screenAudio:h?n||!0:void 0},i);c=g.getVideoTracks()[0]||null,l=g.getAudioTracks()[0]||null}catch(g){throw r.onError(g),g}if(!c){const g=new ct(M.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(g),g.throw(T)}if(!l&&e==="enable"){c&&c.stop();const g=new ct(M.SHARE_AUDIO_NOT_ALLOWED);return r.onError(g),g.throw(T)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(fw(i,c,t,t.encoderConfig&&nw(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const p=new wn(c,t.encoderConfig?nw(t.encoderConfig):{},t.scalabiltyMode?Vb(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[_n.SCREEN_TRACK]);if(!l)return r.onSuccess(p.getTrackId()),T.info("create screen video track success","video:",p.getTrackId()),p;const m=new Wn(l,void 0,En(8,"track-scr-a-"),!1);return r.onSuccess([p.getTrackId(),m.getTrackId()]),T.info("create screen video track success","video:",p.getTrackId(),"audio:",m.getTrackId()),[p,m]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=B("CAMERA_CAPTURE_CONFIG"),i=En(8,"track-mic-"),r=En(8,"track-cam-"),a=Jt.reportApiInvoke(null,{id:"".concat(i,"-").concat(r),tag:Fn.TRACER,name:ui.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const c=Hb(e),l=Kk(t);let u=null,h=null;T.info("start create camera video track(".concat(r,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const g=await ua({audio:l,video:c},"".concat(i,"-").concat(r));u=g.getAudioTracks()[0],h=g.getVideoTracks()[0]}catch(g){throw a.onError(g),g}if(!u||!h){const g=new ct(M.UNEXPECTED_ERROR,"can not find tracks in media stream");return a.onError(g),g.throw(T)}e.optimizationMode&&fw(r,h,e,hl(e.encoderConfig));const p=new Wb(u,t,l,i),m=new pw(h,e,c,e.scalabiltyMode?Vb(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return a.onSuccess([p.getTrackId(),m.getTrackId()]),T.info("create camera video track(".concat(r,") and microphone audio track(").concat(i,") success")),[p,m]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=En(8,"track-mic-"),n=Jt.reportApiInvoke(null,{id:e,tag:Fn.TRACER,name:ui.CREATE_MIC_AUDIO_TRACK,options:[t]}),i=Kk(t);let r=null;T.info("start create microphone audio track with config",JSON.stringify(t),"trackId",e);try{r=(await ua({audio:i},e)).getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}if(!r){const c=new ct(M.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(T)}const a=new Wb(r,t,i,e);return n.onSuccess(a.getTrackId()),T.info("create microphone audio track success, trackId:",e),a},createCustomAudioTrack:function(t){const e=En(8,"track-cus-"),n=Jt.reportApiInvoke(null,{id:e,tag:Fn.TRACER,name:ui.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),i=new Wn(t.mediaStreamTrack,t.encoderConfig?Bb(t.encoderConfig):{},e,!1);return T.info("create custom audio track success with config",t,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:i}=t;let{source:r}=t;const a={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":r,cacheOnlineFile:n,encoderConfig:i},c=En(8,"track-buf-"),l=Jt.reportApiInvoke(null,{id:c,tag:Fn.TRACER,name:ui.CREATE_BUFFER_AUDIO_TRACK,options:[a]});if(B("DISABLE_WEBAUDIO"))throw new ct(M.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");T.info("start create buffer source audio track with config",JSON.stringify(a),"trackId",c);const u=r;if(!(r instanceof AudioBuffer))try{r=await async function(m,g){let S=null;if(typeof m=="string"){const w=D1.get(m);if(w)return T.debug("use cached audio resource: ",m),w;try{S=(await fc(()=>ss.get(m,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(N){throw new ct(M.FETCH_AUDIO_FILE_FAILED,N.toString())}}else S=await new wt((N,k)=>{const x=new FileReader;x.onload=W=>{W.target?N(W.target.result):k(new ct(M.READ_LOCAL_AUDIO_FILE_ERROR))},x.onerror=()=>{k(new ct(M.READ_LOCAL_AUDIO_FILE_ERROR))},x.readAsArrayBuffer(m)});const D=await function(w){const N=WE();return new wt((k,x)=>{N.decodeAudioData(w,W=>{k(W)},W=>{x(new ct(M.DECODE_AUDIO_FILE_FAILED,W.toString()))})})}(S);return typeof m=="string"&&g&&D1.set(m,D),D}(r,n)}catch(m){return l.onError(m),m.throw(T)}const h=new UG(r),p=new MG(u,h,i?Bb(i):{},c);return T.info("create buffer source audio track success, trackId:",c),l.onSuccess(p.getTrackId()),p},setAppType:function(t){if(T.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw T.debug("Invalid appType"),new nt(M.INVALID_PARAMS,"invalid app type",t);sn("APP_TYPE",Math.floor(t))},setLogLevel:function(t){T.setLogLevel(t)},enableLogUpload:function(){B("USE_NEW_LOG")?sn("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){B("USE_NEW_LOG")?sn("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new DM},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Jt.reportApiInvoke(null,{tag:Fn.TRACER,name:ui.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof Wn||t instanceof YE)){const u=new nt(M.INVALID_TRACK,"the parameter is not a audio track");return n.onError(u),u.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof Wn?t.getTrackLabel():"remote_track",r=t.getVolumeLevel();let a=r,c=r;const l=Date.now();return new wt(u=>{const h=setInterval(()=>{const p=t.getVolumeLevel();a=p>a?p:a,c=p<c?p:c;const m=a-c>1e-4,g=Date.now()-l;if(m||g>e){clearInterval(h);const S=m,D={duration:g,deviceLabel:i,maxVolumeLevel:a,result:S};T.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(D))),n.onSuccess(D),u(S)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Jt.reportApiInvoke(null,{tag:Fn.TRACER,name:ui.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof wn||t instanceof zE)){const m=new nt(M.INVALID_TRACK,"the parameter is not a video track");return n.onError(m),m.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof wn?t.getTrackLabel():"remote_track",r=t.getMediaStreamTrack(!0),a=document.createElement("video");a.style.width="1px",a.style.height="1px",a.setAttribute("muted",""),a.muted=!0,a.setAttribute("playsinline",""),a.controls=!1,($i()||Ib())&&(a.style.opacity="0.01",a.style.position="fixed",a.style.left="0",a.style.top="0",document.body.appendChild(a)),a.srcObject=new MediaStream([r]),a.play();const c=document.createElement("canvas");c.width=160,c.height=120;let l=0,u=0;try{const m=Date.now();l=await function(g,S,D,w){let N,k=0,x=null;return new wt((W,Z)=>{function $(){k>w&&N&&(N(),W(k));const q=D.getContext("2d");if(!q){const Nt=new nt(M.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(Nt.toString()),void Z(Nt)}q.drawImage(g,0,0,160,120);const ot=q.getImageData(0,0,D.width,D.height),_t=Math.floor(ot.data.length/3);if(x){for(let Nt=0;Nt<_t;Nt+=3)if(ot.data[Nt]!==x[Nt])return k+=1,void(x=ot.data);x=ot.data}else x=ot.data}setTimeout(()=>{N&&(N(),W(k))},S),N=ow(()=>{$()},30)})}(a,e,c,4),u=Date.now()-m}catch(m){throw n.onError(m),m}n8===Ye.SAFARI&&(a.pause(),a.remove()),a.srcObject=null;const h=l>4,p={duration:u,changedPicNum:l,deviceLabel:i,result:h};return T.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),n.onSuccess(p),h},setArea:Vw,audioElementPlayCenter:as,resumeAudioContext:function(){as.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){S8.processExternalMediaAEC(t)},registerExtensions:function(t){const e=B("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!At(e).call(e,n.name)&&e.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=T.extLog,i.reporter.hookApiInvoke=Jt.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=B(r)})}),Pj("PLUGIN_INFO",e)},ChannelMediaRelayError:JE,ChannelMediaRelayEvent:vd,ChannelMediaRelayState:Ts,RemoteStreamFallbackType:OG,RemoteStreamType:IG,ConnectionDisconnectedReason:Ze,AudienceLatencyLevelType:sG,AREAS:qe,preload:async function(t,e,n,i){return r2(t,e,n,i)}});return Object.defineProperties(pi,{onAudioAutoplayFailed:{get:()=>pa.onAudioAutoplayFailed,set:t=>{pa.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>pa.onAutoplayFailed,set:t=>{pa.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>pi._onSecurityPolicyViolation,set(t){pi._onSecurityPolicyViolation=t,pU(t)}},__CLIENT_LIST__:{get:()=>B("SHOW_GLOBAL_CLIENT_LIST")?of:[]}}),ha.on(nf.CAMERA_DEVICE_CHANGED,t=>{T.info("camera device changed",JSON.stringify(t)),pi.onCameraChanged&&pi.onCameraChanged(t),pi.safeEmit(ml.CAMERA_CHANGED,t)}),ha.on(nf.RECORDING_DEVICE_CHANGED,t=>{T.info("microphone device changed",JSON.stringify(t)),pi.onMicrophoneChanged&&pi.onMicrophoneChanged(t),pi.safeEmit(ml.MICROPHONE_CHANGED,t)}),ha.on(nf.PLAYOUT_DEVICE_CHANGED,t=>{T.debug("playout device changed",JSON.stringify(t)),pi.onPlaybackDeviceChanged&&pi.onPlaybackDeviceChanged(t),pi.safeEmit(ml.PLAYBACK_DEVICE_CHANGED,t)}),as.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),pa.onAudioAutoplayFailed&&pa.onAudioAutoplayFailed()},an.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),pa.onAudioAutoplayFailed&&pa.onAudioAutoplayFailed(),pi.safeEmit(ml.AUTOPLAY_FAILED)}),an.on(Ki.STATE_CHANGE,(t,e)=>{T.info("audio context state changed: ".concat(e," => ").concat(t)),pi.onAudioContextStateChanged&&pi.onAudioContextStateChanged(t,e),pi.safeEmit(ml.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),si.on(LE.NETWORK_STATE_CHANGE,(t,e)=>{T.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=pi),pi})}(i0)),i0.exports}var A7=C7();const EV=iO(A7),w7="/assets/startsession-CbHxBiR0.webp",My="https://demoapi.deveraa.com/v1/call";function I7(){const[E,b]=it.useState(!1),[O,A]=it.useState(!1),[L,U]=it.useState([]),[K,J]=it.useState("Team Meeting"),[G,H]=it.useState(null),[rt,lt]=it.useState(""),[dt,X]=it.useState(!1),[st,Ct]=it.useState(""),[yt,It]=it.useState(localStorage.getItem("admin_name")||"Admin"),[Wt,Rt]=it.useState(localStorage.getItem("admin_id")||""),[ye,ne]=it.useState(null),[_e,Ne]=it.useState(""),[Ie,Xt]=it.useState("");it.useEffect(()=>{const Lt=sessionStorage.getItem("channel_name")||"",Kt=sessionStorage.getItem("app_certificate")||"",Re=sessionStorage.getItem("app_id");H(Re),Re||(console.error("App ID is missing in sessionStorage"),Ct("Agora App ID is missing. Please check your configuration."));const te=localStorage.getItem("admin_id")||"",ce=localStorage.getItem("admin_name")||"Admin";It(ce),Rt(te),Ne(Lt),Xt(Kt)},[]);const Qt=it.useRef(null),Ae=it.useRef(null),In=it.useRef(null),re=it.useRef({}),Gt=it.useRef({});it.useEffect(()=>(Qt.current=EV.createClient({mode:"rtc",codec:"vp8"}),Qt.current.on("user-published",Ut),Qt.current.on("user-left",se),Qt.current.on("user-info-updated",me),()=>{Ft(),Qt.current.off("user-published",Ut),Qt.current.off("user-left",se),Qt.current.off("user-info-updated",me)}),[]),it.useEffect(()=>{if(E)return Qt.current.enableAudioVolumeIndicator(),console.log("Audio volume indicator enabled."),Qt.current.on("volume-indicator",Lt=>{console.log("Volume indicator event:",Lt);const Kt=50;Lt.forEach(({uid:Re,level:te})=>{console.log(`User ${Re} level: ${te} - speaking: ${te>Kt}`),U(ce=>ce.map(ie=>ie.uid===Re?{...ie,isSpeaking:te>Kt}:ie))})}),()=>{Qt.current.off("volume-indicator")}},[E]),it.useEffect(()=>{if(!E)return;const Lt=setInterval(async()=>{try{(await Si.get(`${My}/meetings/check-participant-status/${_e}/${In.current}`)).data.kicked&&(alert("You have been removed from the meeting by the admin."),Ft())}catch(Kt){console.error("Error checking participant status:",Kt)}},4e3);return()=>clearInterval(Lt)},[E,_e]);const me=(Lt,Kt)=>{console.log("User info updated:",Lt,Kt),Kt.userName&&(Gt.current[Lt]=Kt.userName,U(Re=>Re.map(te=>te.uid===Lt?{...te,name:Kt.userName}:te)))},Ut=async(Lt,Kt)=>{if(console.log("User published:",Lt),await Qt.current.subscribe(Lt,Kt),Kt==="audio"){Lt.audioTrack.play(),re.current[Lt.uid]={audioTrack:Lt.audioTrack,enabled:!0};const Re=Gt.current[Lt.uid]||`User ${Lt.uid}`;U(te=>te.some(ce=>ce.uid===Lt.uid)?te:[...te,{uid:Lt.uid,name:Re,isSpeaking:!1,isMuted:!1}]),Ee(Lt.uid)}},Ee=async Lt=>{try{const Kt=await Si.get(`${My}/meetings/user-info${_e}/${Lt}`);Kt.data&&Kt.data.userName&&(Gt.current[Lt]=Kt.data.userName,U(Re=>Re.map(te=>te.uid===Lt?{...te,name:Kt.data.userName}:te)))}catch(Kt){console.error("Error fetching user metadata:",Kt)}},se=Lt=>{console.log("User left:",Lt),re.current[Lt.uid]&&delete re.current[Lt.uid],U(Kt=>Kt.filter(Re=>Re.uid!==Lt.uid))},be=async()=>{var Lt,Kt;if(X(!0),Ct(""),!G){Ct("Agora App ID is missing. Please check your configuration."),X(!1);return}try{const Re=await Si.post(`${My}/meetings/create`,{meetingName:K,adminName:`${yt}`,id:sessionStorage.getItem("adminid")||Wt}),{channelName:te,token:ce,adminUid:ie}=Re.data;lt(_e||te),In.current=ie,await Qt.current.join(G,te||_e,ce,ie),Gt.current[ie]=yt,Ae.current=await EV.createMicrophoneAudioTrack(),await Qt.current.publish([Ae.current]),U([{uid:ie,name:`${yt}`,isLocal:!0,isAdmin:!0,isSpeaking:!1,isMuted:!1}]),ne(new Date),b(!0),console.log("Session started successfully")}catch(Re){console.error("Error starting session:",Re),Ct(((Kt=(Lt=Re.response)==null?void 0:Lt.data)==null?void 0:Kt.error)||Re.message||"Failed to start session")}finally{X(!1)}},at=async Lt=>{try{const Re=new Date().toISOString().split("T")[0],te={name:yt||"Unknown User",date:Re,calltime:Lt,userid:Wt};console.log("Saving call history:",te),await Si.post("https://demoapi.deveraa.com/v1/superadmin/savehistory",te),console.log("Call history saved successfully")}catch(Kt){console.error("Error saving call history:",Kt)}},Ft=async()=>{console.log("Cleaning up session...");try{if(E&&ye){const Re=(new Date-ye)/(1e3*60);await at(Re)}await Si.post(`${My}/meetings/update`,{isActive:!1,channelName:_e}),console.log("Meeting ended on server."),Ae.current&&(Ae.current.stop(),Ae.current.close(),Ae.current=null),Qt.current&&E&&await Qt.current.leave(),b(!1),U([]),re.current={},Gt.current={}}catch(Lt){console.error("Error ending meeting:",Lt)}},he=async()=>{Ae.current&&(await Ae.current.setMuted(!O),A(!O),U(Lt=>Lt.map(Kt=>Kt.isLocal?{...Kt,isMuted:!O}:Kt)))},jt=Lt=>{var ce;const Kt=L.find(ie=>ie.uid===Lt);if(!Kt)return;const Re=!Kt.isMuted;U(ie=>ie.map(vn=>vn.uid===Lt?{...vn,isMuted:Re}:vn));const te=(ce=re.current[Lt])==null?void 0:ce.audioTrack;te&&(Re?te.stop():te.play(),re.current[Lt].enabled=!Re)},Zt=async Lt=>{var Kt;try{if(!(((Kt=L.find(te=>te.isLocal))==null?void 0:Kt.isAdmin)===!0)){console.error("Only admin can kick participants");return}await Si.post(`${My}/meetings/kick-participant`,{channelName:_e,participantUid:Lt,adminUid:In.current,app_certificateis:Ie}),U(te=>te.filter(ce=>ce.uid!==Lt)),re.current[Lt]&&delete re.current[Lt],Gt.current[Lt]&&delete Gt.current[Lt],console.log(`Participant ${Lt} has been kicked`)}catch(Re){console.error("Error kicking participant:",Re)}};return R.jsxs(R.Fragment,{children:[!E&&R.jsx(EO,{}),E&&R.jsx("div",{className:"px-10 flex space-x-4 w-full justify-end mt-5",children:R.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg font-bold transform transition-all duration-300 hover:scale-105 shadow-md",onClick:()=>{console.log("Ending session..."),Ft()},children:"End Session"})}),R.jsxs("div",{className:"w-full md:w-[95%] h-[80vh] mx-auto mt-2 mb-2 bg-white rounded-xl overflow-hidden transition-all duration-300 shadow-2xl flex flex-col",children:[E?R.jsx(R.Fragment,{children:R.jsxs("div",{className:"flex-1 flex flex-col p-8 bg-blue-300",children:[R.jsx("div",{className:"mb-4 text-center"}),R.jsx("div",{className:"grid grid-cols-5  overflow-x-auto gap-5 justify-center",children:L.filter(Lt=>!Lt.isLocal).map(Lt=>{var Kt;return R.jsx("div",{className:`bg-white rounded-3xl shadow-lg p-6 w-50 transition-all duration-300 hover:shadow-xl border border-blue-100 ${Lt.isSpeaking?"blink":""}`,children:R.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[R.jsx("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center",children:R.jsx("span",{className:"text-3xl font-bold text-blue-500",children:(Lt==null?void 0:Lt.name)||"?"})}),R.jsx("div",{className:"text-center",children:R.jsxs("div",{className:"flex items-center space-x-4 mt-4",children:[R.jsx("button",{onClick:()=>jt(Lt.uid),className:`text-white py-2 px-4 rounded ${Lt.isMuted?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"}`,children:Lt.isMuted?R.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-mic-off",children:[R.jsx("line",{x1:"2",x2:"22",y1:"2",y2:"22"}),R.jsx("path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2"}),R.jsx("path",{d:"M5 10v2a7 7 0 0 0 12 5"}),R.jsx("path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33"}),R.jsx("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12"}),R.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]}):R.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-mic",children:[R.jsx("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),R.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),R.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})}),((Kt=L.find(Re=>Re.isLocal))==null?void 0:Kt.isAdmin)&&R.jsx("button",{onClick:()=>Zt(Lt.uid),className:"bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded",title:"Kick participant from the session",children:R.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-x-icon lucide-x",children:[R.jsx("path",{d:"M18 6 6 18"}),R.jsx("path",{d:"m6 6 12 12"})]})})]})}),R.jsxs("div",{className:"flex items-center space-x-2 w-full justify-center",children:[R.jsx("div",{className:`w-4 h-4 rounded-full ${Lt.isMuted?"bg-red-500":"bg-green-500"}`}),R.jsx("span",{className:"text-sm text-gray-500",children:Lt.isMuted?"Muted":"Active"})]})]})},Lt.uid)})})]})}):R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:R.jsx("div",{className:"relative w-full h-64 overflow-hidden",children:R.jsx("img",{src:w7,alt:"Session",className:"w-full h-full object-contain animate-zoomInOut"})})}),R.jsxs("div",{className:"p-6 text-center border-t border-blue-50",children:[R.jsx("button",{onClick:be,className:"bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg font-bold transform transition-all duration-300 hover:scale-105 shadow-md",disabled:dt,children:dt?"Starting...":"Start Session"}),st&&R.jsx("p",{className:"text-red-500 mt-2",children:st})]})]}),R.jsx("style",{jsx:!0,children:`
          @keyframes zoomInOut {
            0%,
            100% {
              transform: scale(1);
            }
            50% {
              transform: scale(1.1);
            }
          }
          .animate-zoomInOut {
            animation: zoomInOut 8s ease-in-out infinite;
          }
.blink {
  position: relative;
  border: 4px solid #006400; /* Dark green */
  border-radius: 24px;
  padding: 20px;
  background: white;
  animation: borderBlink 1.5s infinite ease-in-out;
  transition: all 0.3s ease;
}

@keyframes borderBlink {
  0% {
    box-shadow: 0 0 0px #006400;
  }
  50% {
    box-shadow: 0 0 10px 4px #228B22; /* subtle glow */
  }
  100% {
    box-shadow: 0 0 0px #006400;
  }
}



        `})]}),E&&R.jsx("div",{className:"flex space-x-4 w-full justify-center",children:R.jsx("button",{onClick:he,className:`p-3 rounded-full ${O?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600"} transition-colors duration-200`,children:O?R.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-mic-off",children:[R.jsx("line",{x1:"2",x2:"22",y1:"2",y2:"22"}),R.jsx("path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2"}),R.jsx("path",{d:"M5 10v2a7 7 0 0 0 12 5"}),R.jsx("path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33"}),R.jsx("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12"}),R.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]}):R.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-mic",children:[R.jsx("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),R.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),R.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})})})]})}function O7(){const[E,b]=it.useState(!1);return console.log("modalOpen",E),R.jsx(R.Fragment,{children:R.jsx(I7,{})})}function N7(){S_();const{listTeamUsers:E,deleteuser:b,updateTeamUser:O}=mO(),[A,L]=it.useState(!1),[U,K]=it.useState(!1),[J,G]=it.useState(""),[H,rt]=it.useState(1),lt=10,[dt,X]=it.useState(0),[st,Ct]=it.useState(!1),[yt,It]=it.useState(!1),[Wt,Rt]=it.useState(!1),[ye,ne]=it.useState([]),[_e,Ne]=it.useState(),[Ie,Xt]=it.useState(""),[Qt,Ae]=it.useState(),[In,re]=it.useState(!1);console.log(ye,"user"),it.useEffect(()=>{Xt(localStorage.getItem("admin_id"))},[H]),it.useEffect(()=>{Gt()},[H,Ie]);const Gt=async()=>{console.log("Logadminid",Ie);try{const te=lt,ce=(H-1)*lt,ie=await E(Ie,te,ce);ne(ie),console.log("response",ie.length),localStorage.setItem("totaluser",ie.length),ie.totalCount&&X(ie.totalCount),console.log(ie)}catch(te){console.log(te)}},me=ye.filter(te=>te.name.toLowerCase().includes(J.toLowerCase())||te.username.toLowerCase().includes(J.toLowerCase())),Ut=Math.ceil(me.length/lt),Ee=H*lt,se=Ee-lt,be=me.slice(se,Ee),[at,Ft]=it.useState({name:"",mobilenumber:"",username:"",tokenid:"",Channelid:"",password:"",confirmPassword:""}),he=te=>{Ft({...at,[te.target.name]:te.target.value})};it.useEffect(()=>{_e&&Ft({name:_e.name||"",mobilenumber:_e.mobilenumber||"",username:_e.username||"",tokenid:_e.tokenid,Channelid:_e.Channelid,password:_e.password,confirmPassword:_e.password})},[_e]);const jt=async()=>{const te=await b(_e.id);console.log("Delete response:",te),Gt(),Ct(!1)};console.log("selecteduser",_e);const Zt=async te=>{if(te.preventDefault(),console.log("selecteduser",_e),console.log("formData",at.password),(at==null?void 0:at.password)!==(at==null?void 0:at.confirmPassword)){ws.fire({icon:"error",title:"Oops...",text:"Password Does Not Match"});return}const ce=await O(_e.id,at);console.log("UPdate response:",ce),Gt(),K(!1)},[Lt,Kt]=it.useState(!1);it.useEffect(()=>{console.log("userModalOpen changed:",Lt),Gt()},[A]);const Re=async(te,ce)=>{console.log("userToToggle",Qt),console.log(te,Qt.status);try{const ie={status:Qt!=null&&Qt.status?0:1};console.log("updateData",ie),await O(te,ie),Gt()}catch(ie){console.error("Error updating lock status:",ie)}};return console.log("usercreated",A),R.jsxs(R.Fragment,{children:[R.jsx(EO,{setusercreated:L}),R.jsxs("div",{className:"container mx-auto p-3 md:w-4/5 w-full",children:[R.jsx("div",{className:"flex items-center justify-between mb-4",children:R.jsxs("div",{className:"relative md:w-1/3 w-full",children:[R.jsx("input",{type:"text",placeholder:"Search...",className:"w-full p-2 pl-10 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200",value:J,onChange:te=>G(te.target.value)}),R.jsx(qy,{className:"absolute left-3 top-2.5 text-gray-400",size:20})]})}),R.jsx("div",{className:"overflow-x-auto shadow-lg rounded-lg",children:R.jsx("div",{className:"min-w-full inline-block align-middle",children:R.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:R.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[R.jsx("thead",{className:"bg-blue-600 text-white",children:R.jsxs("tr",{children:[R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Name"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Status"}),R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Username"}),R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Mobile Number"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Lock/Unlock"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Update"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Delete"})]})}),R.jsx("tbody",{className:"divide-y divide-gray-300 bg-white",children:be.map((te,ce)=>R.jsxs("tr",{className:"hover:bg-gray-100 transition",children:[R.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800",children:te.name}),R.jsx("td",{className:"px-6 py-4 text-center",children:te.status?R.jsx("span",{children:"Active"}):R.jsx("span",{children:"Inactive"})}),R.jsx("td",{className:"px-6 py-4 text-sm text-gray-800",children:te.username}),R.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800",children:te.mobilenumber}),R.jsx("td",{className:"px-6 py-4 text-center",children:R.jsx("button",{onClick:()=>{Ae(te),re(!0)},className:"cursor-pointer text-gray-600 hover:text-gray-800 transition",children:te.status?R.jsx(dB,{size:20}):R.jsx(uB,{size:20})})}),R.jsx("td",{className:"px-6 py-4 text-center",children:R.jsx("button",{onClick:()=>{Ne(te),K(!0)},className:"cursor-pointer text-yellow-500 hover:text-yellow-700 transition",children:R.jsx(hB,{size:20})})}),R.jsx("td",{className:"px-6 py-4 text-center",children:R.jsx("button",{onClick:()=>{Ne(te),Ct(!0)},className:"cursor-pointer text-red-500 hover:text-red-700 transition",children:R.jsx(E_,{size:20})})})]},ce))})]})})})}),R.jsxs("div",{className:"flex justify-between mt-4",children:[R.jsx("button",{disabled:H===1,onClick:()=>rt(H-1),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-200 transition disabled:opacity-50",children:"Previous"}),R.jsxs("span",{className:"text-gray-700 hidden md:inline-block",children:["Page ",H," of ",Ut]}),R.jsx("button",{disabled:H===Ut,onClick:()=>rt(H+1),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-200 transition disabled:opacity-50",children:"Next"})]})]}),U&&R.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/30 backdrop-blur-sm z-50 animate-fadeIn",children:R.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-2xl w-[500px] max-w-[95%] border border-gray-100 animate-scaleIn",children:[R.jsxs("div",{className:"flex justify-between items-center pb-4 mb-4 border-b border-gray-200",children:[R.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Update User"}),R.jsx("button",{onClick:()=>K(!1),className:"text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),R.jsxs("form",{className:"space-y-4",onSubmit:Zt,children:[R.jsx("div",{className:"grid grid-cols-1 gap-4",children:R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),R.jsx("input",{type:"text",name:"name",value:at.name,placeholder:"Enter full name",onChange:he,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})}),R.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[R.jsxs("div",{className:"relative",children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),R.jsx("input",{type:yt?"text":"password",name:"password",value:at.password,placeholder:"Create password",onChange:he,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),R.jsx("button",{type:"button",onClick:()=>It(!yt),className:"absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:yt?R.jsx(Ol,{className:"h-5 w-5"}):R.jsx(Cc,{className:"h-5 w-5"})})]}),R.jsxs("div",{className:"relative",children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),R.jsx("input",{type:Wt?"text":"password",name:"confirmPassword",value:at.confirmPassword!==void 0?at.confirmPassword:at.password,placeholder:"Confirm password",onChange:he,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),R.jsx("button",{type:"button",onClick:()=>Rt(!Wt),className:"absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:Wt?R.jsx(Ol,{className:"h-5 w-5"}):R.jsx(Cc,{className:"h-5 w-5"})})]})]}),R.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),R.jsx("input",{type:"text",value:at.username,name:"username",placeholder:"Username",onChange:he,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Channel Name"}),R.jsx("input",{type:"text",readOnly:!0,value:sessionStorage.getItem("channel_name"),name:"Channelid",placeholder:"Channel ID",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),R.jsx("div",{className:"grid grid-cols-1 gap-4",children:R.jsxs("div",{children:[R.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),R.jsx("input",{type:"number",value:at.mobilenumber,name:"mobilenumber",placeholder:"Phone number",onChange:he,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})}),R.jsx("button",{type:"submit",className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-medium hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg active:scale-95 transform mt-4",children:"Update User"})]})]})}),st&&R.jsx("div",{id:"popup-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:R.jsx("div",{className:"relative p-4 w-full max-w-md",children:R.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[R.jsx("button",{type:"button",className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>Ct(!1),children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),R.jsxs("div",{className:"p-6 text-center",children:[R.jsx("svg",{className:"mx-auto mb-4 text-red-600 w-14 h-14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),R.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Confirm Permanent Deletion"}),R.jsx("p",{className:"mb-6 text-gray-600",children:"This will permanently delete the item and cannot be recovered. Are you sure you want to continue?"}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsx("button",{onClick:jt,className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"Delete Permanently"}),R.jsx("button",{onClick:()=>Ct(!1),className:"px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})}),In&&R.jsx("div",{id:"lock-unlock-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:R.jsx("div",{className:"relative p-4 w-full max-w-md",children:R.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[R.jsx("button",{type:"button",className:"cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>re(!1),children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),R.jsxs("div",{className:"p-6 text-center",children:[R.jsx("svg",{className:` mx-auto mb-4 ${Qt!=null&&Qt.status?"text-red-600":"text-green-600"} w-14 h-14`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:Qt!=null&&Qt.status?"M6 18L18 6M6 6l12 12":"M5 12h14M12 5v14M9 9l6 6M9 15l6-6"})}),R.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:Qt!=null&&Qt.status?"Lock User Access":"Unlock User Access"}),R.jsxs("p",{className:"mb-6 text-gray-600",children:["Are you sure you want to"," ",Qt!=null&&Qt.status?"lock":"unlock"," the User"," ",R.jsx("span",{className:"font-semibold",children:!(Qt!=null&&Qt.status)}),"?"]}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsx("button",{className:`cursor-pointer px-6 py-2 text-white rounded-md transition-colors ${Qt!=null&&Qt.status?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"}`,onClick:()=>{Re(Qt.id,!Qt.locked),re(!1)},children:Qt!=null&&Qt.status?"Lock":"Unlock"}),R.jsx("button",{onClick:()=>re(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})})]})}function D7(){return R.jsx(R.Fragment,{children:R.jsx(N7,{})})}function L7(){const[E,b]=it.useState(null),[O,A]=it.useState([]),[L,U]=it.useState([]),[K,J]=it.useState(null),[G,H]=it.useState(""),[rt,lt]=it.useState([]),[dt,X]=it.useState(1),st=7,[Ct,yt]=it.useState(!1),[It,Wt]=it.useState(null),[Rt,ye]=it.useState(!1);it.useEffect(()=>{const re=localStorage.getItem("admin_id");console.log("id",re),fetch(`https://demoapi.deveraa.com/v1/add/recordings/recordings/admin/${re}`).then(Gt=>Gt.json()).then(Gt=>{var Ee;const me=[],Ut=new Set;(Ee=Gt.recordings)==null||Ee.forEach(se=>{se.teamName&&!Ut.has(se.teamId)&&(Ut.add(se.teamId),me.push({id:se.teamId,name:se.teamName}))}),lt(me)}).catch(Gt=>console.error("Error fetching team names:",Gt))},[]),it.useEffect(()=>{if(E){const re=localStorage.getItem("admin_id");console.log("id",re),fetch(`https://demoapi.deveraa.com/v1/add/recordings/recordings/admin/${re}`).then(Gt=>Gt.json()).then(Gt=>{var Ut;const me=(Ut=Gt.recordings)==null?void 0:Ut.filter(Ee=>Ee.teamId===E.id);A(me||[]),U([])}).catch(Gt=>console.error("Error fetching recordings:",Gt))}},[E]);const ne=re=>{J(K===re?null:re)},_e=async()=>{let re=[];Rt?re=L:It&&(re=[It]);try{const me=await(await fetch("https://demoapi.deveraa.com/v1/add/recordings/recordings/delete-from-url",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({superadminname:"admin@123",files:re.map(Ut=>({url:Ut.url,teamId:Ut.teamId,filename:Ut.filename}))})})).json();me.success?(A(Ut=>Ut.filter(Ee=>!re.some(se=>se.filename===Ee.filename))),U([]),yt(!1),ye(!1)):console.error("Delete failed:",me.message)}catch(Gt){console.error("Error deleting files:",Gt)}},Ne=re=>{U(Gt=>Gt.some(me=>me.filename===re.filename)?Gt.filter(me=>me.filename!==re.filename):[...Gt,re])},Ie=()=>{const re=Qt;if(re.every(me=>L.some(Ut=>Ut.filename===me.filename)))U(me=>me.filter(Ut=>!re.some(Ee=>Ee.filename===Ut.filename)));else{const me=re.filter(Ut=>!L.some(Ee=>Ee.filename===Ut.filename));U(Ut=>[...Ut,...me])}},Xt=rt.filter(re=>re.name.toLowerCase().includes(G.toLowerCase())),Qt=E?O.slice((dt-1)*st,dt*st):Xt.slice((dt-1)*st,dt*st),Ae=Math.ceil(E?O.length/st:Xt.length/st),In=re=>{b(re),X(1)};return R.jsxs(R.Fragment,{children:[R.jsx(EO,{}),R.jsxs("div",{className:"container mx-auto p-3 md:w-4/5 w-full",children:[R.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mb-4",children:[E&&R.jsx("button",{onClick:()=>{b(null),A([]),X(1)},className:"mt-4 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Back to All Teams"}),R.jsx("h1",{className:"text-xl font-semibold py-2",children:E?`Team: ${E.name}`:"All Teams"}),R.jsxs("div",{className:"relative md:w-1/3 w-full",children:[R.jsx("input",{type:"text",placeholder:"Search teams...",className:"w-full p-2 pl-10 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200",value:G,onChange:re=>{H(re.target.value),X(1)}}),R.jsx(qy,{className:"absolute left-3 top-2.5 text-gray-400",size:20})]})]}),E&&L.length>0&&R.jsx("div",{className:"mb-4",children:R.jsxs("button",{onClick:()=>{ye(!0),yt(!0)},className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition",children:[R.jsx(E_,{size:18})," Delete Selected (",L.length,")"]})}),R.jsx("div",{className:"overflow-x-auto shadow-lg rounded-lg",children:R.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[R.jsx("thead",{className:"bg-blue-600 text-white",children:R.jsxs("tr",{children:[E&&R.jsx("th",{className:"px-4 py-3",children:R.jsx("input",{type:"checkbox",checked:Qt.every(re=>L.some(Gt=>Gt.filename===re.filename)),onChange:Ie})}),R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:E?" File Name":"Team Name"}),R.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:E?"Recording":"Actions"}),R.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold mx-auto flex justify-center",children:E&&"Delete"})]})}),R.jsx("tbody",{className:"divide-y divide-gray-300 bg-white",children:E?Qt.map((re,Gt)=>R.jsxs("tr",{className:"hover:bg-gray-100 transition",children:[R.jsx("td",{className:"px-4 py-4 text-center",children:R.jsx("input",{type:"checkbox",checked:L.some(me=>me.filename===re.filename),onChange:()=>Ne(re)})}),R.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800",children:re.filename||"Not Available"}),R.jsxs("td",{className:"px-6 py-4 text-center flex items-center justify-center gap-4",children:[R.jsx("button",{className:"text-blue-500 hover:text-blue-700 transition",onClick:()=>ne(Gt),children:"Play"}),K===Gt&&R.jsxs("audio",{controls:!0,autoPlay:!0,className:"mt-2",children:[R.jsx("source",{src:re.url,type:"audio/mp3"}),"Your browser does not support the audio element."]})]}),R.jsx("td",{children:R.jsx("button",{className:"text-red-500 hover:text-red-700 transition flex justify-center mx-auto",onClick:()=>{Wt(re),ye(!1),yt(!0)},children:R.jsx(E_,{size:18})})})]},Gt)):Qt.map(re=>R.jsxs("tr",{className:"hover:bg-gray-100 transition cursor-pointer",onClick:()=>In(re),children:[R.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800",children:re.name}),R.jsx("td",{className:"px-6 py-4 text-center",children:R.jsx("button",{className:"text-blue-500 hover:text-blue-700 transition",children:"View Recordings"})})]},re.id))})]})}),Ae>1&&R.jsx("div",{className:"flex justify-center mt-4 gap-2 flex-wrap",children:[...Array(Ae)].map((re,Gt)=>R.jsx("button",{className:`px-3 py-1 rounded ${dt===Gt+1?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>X(Gt+1),children:Gt+1},Gt))})]}),Ct&&R.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:R.jsx("div",{className:"relative p-4 w-full max-w-md",children:R.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[R.jsx("button",{type:"button",className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>{yt(!1),ye(!1)},children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),R.jsxs("div",{className:"p-6 text-center",children:[R.jsx("svg",{className:"mx-auto mb-4 text-red-600 w-14 h-14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),R.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Confirm Deletion"}),R.jsx("p",{className:"mb-6 text-gray-600",children:Rt?`You are about to delete ${L.length} recordings. This action cannot be undone.`:"This will permanently delete the selected recording. Are you sure?"}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsx("button",{onClick:_e,className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"Confirm Delete"}),R.jsx("button",{onClick:()=>{yt(!1),ye(!1)},className:"px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})})]})}function P7(){return R.jsx(R.Fragment,{children:R.jsx(kz,{children:R.jsxs(uz,{children:[R.jsx(Il,{path:"/",element:R.jsx(t7,{})}),R.jsx(Il,{path:"/superadmindashboard",element:R.jsx(hV,{})}),R.jsx(Il,{path:"/adminhistory",element:R.jsx(h7,{})}),R.jsx(Il,{path:"/dashboard",element:R.jsx(hV,{})}),R.jsx(Il,{path:"/callhistory",element:R.jsx(p7,{})}),R.jsx(Il,{path:"/adminlogin",element:R.jsx(f7,{})}),R.jsx(Il,{path:"/admindashboard",element:R.jsx(O7,{})}),R.jsx(Il,{path:"/user",element:R.jsx(D7,{})}),R.jsx(Il,{path:"/calllog",element:R.jsx(L7,{})})]})})})}function k7(){return R.jsx(R.Fragment,{children:R.jsx(P7,{})})}TK.createRoot(document.getElementById("root")).render(R.jsx(it.StrictMode,{children:R.jsx(k7,{})}));
