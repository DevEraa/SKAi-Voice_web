(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function r(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function o(d){if(d.ep)return;d.ep=!0;const p=r(d);fetch(d.href,p)}})();var GD=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tL(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var HD={exports:{}},qy={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i3;function f9(){if(i3)return qy;i3=1;var h=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function r(o,d,p){var g=null;if(p!==void 0&&(g=""+p),d.key!==void 0&&(g=""+d.key),"key"in d){p={};for(var y in d)y!=="key"&&(p[y]=d[y])}else p=d;return d=p.ref,{$$typeof:h,type:o,key:g,ref:d!==void 0?d:null,props:p}}return qy.Fragment=i,qy.jsx=r,qy.jsxs=r,qy}var s3;function p9(){return s3||(s3=1,HD.exports=f9()),HD.exports}var M=p9(),KD={exports:{}},On={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r3;function m9(){if(r3)return On;r3=1;var h=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.consumer"),g=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),T=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),I=Symbol.iterator;function L(se){return se===null||typeof se!="object"?null:(se=I&&se[I]||se["@@iterator"],typeof se=="function"?se:null)}var N={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,K={};function H(se,we,He){this.props=se,this.context=we,this.refs=K,this.updater=He||N}H.prototype.isReactComponent={},H.prototype.setState=function(se,we){if(typeof se!="object"&&typeof se!="function"&&se!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,se,we,"setState")},H.prototype.forceUpdate=function(se){this.updater.enqueueForceUpdate(this,se,"forceUpdate")};function Q(){}Q.prototype=H.prototype;function ne(se,we,He){this.props=se,this.context=we,this.refs=K,this.updater=He||N}var ee=ne.prototype=new Q;ee.constructor=ne,x(ee,H.prototype),ee.isPureReactComponent=!0;var pe=Array.isArray,de={H:null,A:null,T:null,S:null},be=Object.prototype.hasOwnProperty;function Se(se,we,He,ct,Be,Et){return He=Et.ref,{$$typeof:h,type:se,key:we,ref:He!==void 0?He:null,props:Et}}function Te(se,we){return Se(se.type,we,void 0,void 0,void 0,se.props)}function _e(se){return typeof se=="object"&&se!==null&&se.$$typeof===h}function he(se){var we={"=":"=0",":":"=2"};return"$"+se.replace(/[=:]/g,function(He){return we[He]})}var Ge=/\/+/g;function st(se,we){return typeof se=="object"&&se!==null&&se.key!=null?he(""+se.key):we.toString(36)}function It(){}function qe(se){switch(se.status){case"fulfilled":return se.value;case"rejected":throw se.reason;default:switch(typeof se.status=="string"?se.then(It,It):(se.status="pending",se.then(function(we){se.status==="pending"&&(se.status="fulfilled",se.value=we)},function(we){se.status==="pending"&&(se.status="rejected",se.reason=we)})),se.status){case"fulfilled":return se.value;case"rejected":throw se.reason}}throw se}function ut(se,we,He,ct,Be){var Et=typeof se;(Et==="undefined"||Et==="boolean")&&(se=null);var St=!1;if(se===null)St=!0;else switch(Et){case"bigint":case"string":case"number":St=!0;break;case"object":switch(se.$$typeof){case h:case i:St=!0;break;case C:return St=se._init,ut(St(se._payload),we,He,ct,Be)}}if(St)return Be=Be(se),St=ct===""?"."+st(se,0):ct,pe(Be)?(He="",St!=null&&(He=St.replace(Ge,"$&/")+"/"),ut(Be,we,He,"",function(mt){return mt})):Be!=null&&(_e(Be)&&(Be=Te(Be,He+(Be.key==null||se&&se.key===Be.key?"":(""+Be.key).replace(Ge,"$&/")+"/")+St)),we.push(Be)),1;St=0;var it=ct===""?".":ct+":";if(pe(se))for(var Ze=0;Ze<se.length;Ze++)ct=se[Ze],Et=it+st(ct,Ze),St+=ut(ct,we,He,Et,Be);else if(Ze=L(se),typeof Ze=="function")for(se=Ze.call(se),Ze=0;!(ct=se.next()).done;)ct=ct.value,Et=it+st(ct,Ze++),St+=ut(ct,we,He,Et,Be);else if(Et==="object"){if(typeof se.then=="function")return ut(qe(se),we,He,ct,Be);throw we=String(se),Error("Objects are not valid as a React child (found: "+(we==="[object Object]"?"object with keys {"+Object.keys(se).join(", ")+"}":we)+"). If you meant to render a collection of children, use an array instead.")}return St}function Oe(se,we,He){if(se==null)return se;var ct=[],Be=0;return ut(se,ct,"","",function(Et){return we.call(He,Et,Be++)}),ct}function Qe(se){if(se._status===-1){var we=se._result;we=we(),we.then(function(He){(se._status===0||se._status===-1)&&(se._status=1,se._result=He)},function(He){(se._status===0||se._status===-1)&&(se._status=2,se._result=He)}),se._status===-1&&(se._status=0,se._result=we)}if(se._status===1)return se._result.default;throw se._result}var Ke=typeof reportError=="function"?reportError:function(se){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var we=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof se=="object"&&se!==null&&typeof se.message=="string"?String(se.message):String(se),error:se});if(!window.dispatchEvent(we))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",se);return}console.error(se)};function Re(){}return On.Children={map:Oe,forEach:function(se,we,He){Oe(se,function(){we.apply(this,arguments)},He)},count:function(se){var we=0;return Oe(se,function(){we++}),we},toArray:function(se){return Oe(se,function(we){return we})||[]},only:function(se){if(!_e(se))throw Error("React.Children.only expected to receive a single React element child.");return se}},On.Component=H,On.Fragment=r,On.Profiler=d,On.PureComponent=ne,On.StrictMode=o,On.Suspense=v,On.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=de,On.act=function(){throw Error("act(...) is not supported in production builds of React.")},On.cache=function(se){return function(){return se.apply(null,arguments)}},On.cloneElement=function(se,we,He){if(se==null)throw Error("The argument must be a React element, but you passed "+se+".");var ct=x({},se.props),Be=se.key,Et=void 0;if(we!=null)for(St in we.ref!==void 0&&(Et=void 0),we.key!==void 0&&(Be=""+we.key),we)!be.call(we,St)||St==="key"||St==="__self"||St==="__source"||St==="ref"&&we.ref===void 0||(ct[St]=we[St]);var St=arguments.length-2;if(St===1)ct.children=He;else if(1<St){for(var it=Array(St),Ze=0;Ze<St;Ze++)it[Ze]=arguments[Ze+2];ct.children=it}return Se(se.type,Be,void 0,void 0,Et,ct)},On.createContext=function(se){return se={$$typeof:g,_currentValue:se,_currentValue2:se,_threadCount:0,Provider:null,Consumer:null},se.Provider=se,se.Consumer={$$typeof:p,_context:se},se},On.createElement=function(se,we,He){var ct,Be={},Et=null;if(we!=null)for(ct in we.key!==void 0&&(Et=""+we.key),we)be.call(we,ct)&&ct!=="key"&&ct!=="__self"&&ct!=="__source"&&(Be[ct]=we[ct]);var St=arguments.length-2;if(St===1)Be.children=He;else if(1<St){for(var it=Array(St),Ze=0;Ze<St;Ze++)it[Ze]=arguments[Ze+2];Be.children=it}if(se&&se.defaultProps)for(ct in St=se.defaultProps,St)Be[ct]===void 0&&(Be[ct]=St[ct]);return Se(se,Et,void 0,void 0,null,Be)},On.createRef=function(){return{current:null}},On.forwardRef=function(se){return{$$typeof:y,render:se}},On.isValidElement=_e,On.lazy=function(se){return{$$typeof:C,_payload:{_status:-1,_result:se},_init:Qe}},On.memo=function(se,we){return{$$typeof:T,type:se,compare:we===void 0?null:we}},On.startTransition=function(se){var we=de.T,He={};de.T=He;try{var ct=se(),Be=de.S;Be!==null&&Be(He,ct),typeof ct=="object"&&ct!==null&&typeof ct.then=="function"&&ct.then(Re,Ke)}catch(Et){Ke(Et)}finally{de.T=we}},On.unstable_useCacheRefresh=function(){return de.H.useCacheRefresh()},On.use=function(se){return de.H.use(se)},On.useActionState=function(se,we,He){return de.H.useActionState(se,we,He)},On.useCallback=function(se,we){return de.H.useCallback(se,we)},On.useContext=function(se){return de.H.useContext(se)},On.useDebugValue=function(){},On.useDeferredValue=function(se,we){return de.H.useDeferredValue(se,we)},On.useEffect=function(se,we){return de.H.useEffect(se,we)},On.useId=function(){return de.H.useId()},On.useImperativeHandle=function(se,we,He){return de.H.useImperativeHandle(se,we,He)},On.useInsertionEffect=function(se,we){return de.H.useInsertionEffect(se,we)},On.useLayoutEffect=function(se,we){return de.H.useLayoutEffect(se,we)},On.useMemo=function(se,we){return de.H.useMemo(se,we)},On.useOptimistic=function(se,we){return de.H.useOptimistic(se,we)},On.useReducer=function(se,we,He){return de.H.useReducer(se,we,He)},On.useRef=function(se){return de.H.useRef(se)},On.useState=function(se){return de.H.useState(se)},On.useSyncExternalStore=function(se,we,He){return de.H.useSyncExternalStore(se,we,He)},On.useTransition=function(){return de.H.useTransition()},On.version="19.0.0",On}var a3;function nL(){return a3||(a3=1,KD.exports=m9()),KD.exports}var fe=nL();const Sd=tL(fe);var WD={exports:{}},$y={},YD={exports:{}},qD={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o3;function g9(){return o3||(o3=1,function(h){function i(Oe,Qe){var Ke=Oe.length;Oe.push(Qe);e:for(;0<Ke;){var Re=Ke-1>>>1,se=Oe[Re];if(0<d(se,Qe))Oe[Re]=Qe,Oe[Ke]=se,Ke=Re;else break e}}function r(Oe){return Oe.length===0?null:Oe[0]}function o(Oe){if(Oe.length===0)return null;var Qe=Oe[0],Ke=Oe.pop();if(Ke!==Qe){Oe[0]=Ke;e:for(var Re=0,se=Oe.length,we=se>>>1;Re<we;){var He=2*(Re+1)-1,ct=Oe[He],Be=He+1,Et=Oe[Be];if(0>d(ct,Ke))Be<se&&0>d(Et,ct)?(Oe[Re]=Et,Oe[Be]=Ke,Re=Be):(Oe[Re]=ct,Oe[He]=Ke,Re=He);else if(Be<se&&0>d(Et,Ke))Oe[Re]=Et,Oe[Be]=Ke,Re=Be;else break e}}return Qe}function d(Oe,Qe){var Ke=Oe.sortIndex-Qe.sortIndex;return Ke!==0?Ke:Oe.id-Qe.id}if(h.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var p=performance;h.unstable_now=function(){return p.now()}}else{var g=Date,y=g.now();h.unstable_now=function(){return g.now()-y}}var v=[],T=[],C=1,I=null,L=3,N=!1,x=!1,K=!1,H=typeof setTimeout=="function"?setTimeout:null,Q=typeof clearTimeout=="function"?clearTimeout:null,ne=typeof setImmediate<"u"?setImmediate:null;function ee(Oe){for(var Qe=r(T);Qe!==null;){if(Qe.callback===null)o(T);else if(Qe.startTime<=Oe)o(T),Qe.sortIndex=Qe.expirationTime,i(v,Qe);else break;Qe=r(T)}}function pe(Oe){if(K=!1,ee(Oe),!x)if(r(v)!==null)x=!0,qe();else{var Qe=r(T);Qe!==null&&ut(pe,Qe.startTime-Oe)}}var de=!1,be=-1,Se=5,Te=-1;function _e(){return!(h.unstable_now()-Te<Se)}function he(){if(de){var Oe=h.unstable_now();Te=Oe;var Qe=!0;try{e:{x=!1,K&&(K=!1,Q(be),be=-1),N=!0;var Ke=L;try{t:{for(ee(Oe),I=r(v);I!==null&&!(I.expirationTime>Oe&&_e());){var Re=I.callback;if(typeof Re=="function"){I.callback=null,L=I.priorityLevel;var se=Re(I.expirationTime<=Oe);if(Oe=h.unstable_now(),typeof se=="function"){I.callback=se,ee(Oe),Qe=!0;break t}I===r(v)&&o(v),ee(Oe)}else o(v);I=r(v)}if(I!==null)Qe=!0;else{var we=r(T);we!==null&&ut(pe,we.startTime-Oe),Qe=!1}}break e}finally{I=null,L=Ke,N=!1}Qe=void 0}}finally{Qe?Ge():de=!1}}}var Ge;if(typeof ne=="function")Ge=function(){ne(he)};else if(typeof MessageChannel<"u"){var st=new MessageChannel,It=st.port2;st.port1.onmessage=he,Ge=function(){It.postMessage(null)}}else Ge=function(){H(he,0)};function qe(){de||(de=!0,Ge())}function ut(Oe,Qe){be=H(function(){Oe(h.unstable_now())},Qe)}h.unstable_IdlePriority=5,h.unstable_ImmediatePriority=1,h.unstable_LowPriority=4,h.unstable_NormalPriority=3,h.unstable_Profiling=null,h.unstable_UserBlockingPriority=2,h.unstable_cancelCallback=function(Oe){Oe.callback=null},h.unstable_continueExecution=function(){x||N||(x=!0,qe())},h.unstable_forceFrameRate=function(Oe){0>Oe||125<Oe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Se=0<Oe?Math.floor(1e3/Oe):5},h.unstable_getCurrentPriorityLevel=function(){return L},h.unstable_getFirstCallbackNode=function(){return r(v)},h.unstable_next=function(Oe){switch(L){case 1:case 2:case 3:var Qe=3;break;default:Qe=L}var Ke=L;L=Qe;try{return Oe()}finally{L=Ke}},h.unstable_pauseExecution=function(){},h.unstable_requestPaint=function(){},h.unstable_runWithPriority=function(Oe,Qe){switch(Oe){case 1:case 2:case 3:case 4:case 5:break;default:Oe=3}var Ke=L;L=Oe;try{return Qe()}finally{L=Ke}},h.unstable_scheduleCallback=function(Oe,Qe,Ke){var Re=h.unstable_now();switch(typeof Ke=="object"&&Ke!==null?(Ke=Ke.delay,Ke=typeof Ke=="number"&&0<Ke?Re+Ke:Re):Ke=Re,Oe){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=Ke+se,Oe={id:C++,callback:Qe,priorityLevel:Oe,startTime:Ke,expirationTime:se,sortIndex:-1},Ke>Re?(Oe.sortIndex=Ke,i(T,Oe),r(v)===null&&Oe===r(T)&&(K?(Q(be),be=-1):K=!0,ut(pe,Ke-Re))):(Oe.sortIndex=se,i(v,Oe),x||N||(x=!0,qe())),Oe},h.unstable_shouldYield=_e,h.unstable_wrapCallback=function(Oe){var Qe=L;return function(){var Ke=L;L=Qe;try{return Oe.apply(this,arguments)}finally{L=Ke}}}}(qD)),qD}var c3;function E9(){return c3||(c3=1,YD.exports=g9()),YD.exports}var $D={exports:{}},Qr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l3;function _9(){if(l3)return Qr;l3=1;var h=nL();function i(v){var T="https://react.dev/errors/"+v;if(1<arguments.length){T+="?args[]="+encodeURIComponent(arguments[1]);for(var C=2;C<arguments.length;C++)T+="&args[]="+encodeURIComponent(arguments[C])}return"Minified React error #"+v+"; visit "+T+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var o={d:{f:r,r:function(){throw Error(i(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},d=Symbol.for("react.portal");function p(v,T,C){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:d,key:I==null?null:""+I,children:v,containerInfo:T,implementation:C}}var g=h.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function y(v,T){if(v==="font")return"";if(typeof T=="string")return T==="use-credentials"?T:""}return Qr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,Qr.createPortal=function(v,T){var C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!T||T.nodeType!==1&&T.nodeType!==9&&T.nodeType!==11)throw Error(i(299));return p(v,T,null,C)},Qr.flushSync=function(v){var T=g.T,C=o.p;try{if(g.T=null,o.p=2,v)return v()}finally{g.T=T,o.p=C,o.d.f()}},Qr.preconnect=function(v,T){typeof v=="string"&&(T?(T=T.crossOrigin,T=typeof T=="string"?T==="use-credentials"?T:"":void 0):T=null,o.d.C(v,T))},Qr.prefetchDNS=function(v){typeof v=="string"&&o.d.D(v)},Qr.preinit=function(v,T){if(typeof v=="string"&&T&&typeof T.as=="string"){var C=T.as,I=y(C,T.crossOrigin),L=typeof T.integrity=="string"?T.integrity:void 0,N=typeof T.fetchPriority=="string"?T.fetchPriority:void 0;C==="style"?o.d.S(v,typeof T.precedence=="string"?T.precedence:void 0,{crossOrigin:I,integrity:L,fetchPriority:N}):C==="script"&&o.d.X(v,{crossOrigin:I,integrity:L,fetchPriority:N,nonce:typeof T.nonce=="string"?T.nonce:void 0})}},Qr.preinitModule=function(v,T){if(typeof v=="string")if(typeof T=="object"&&T!==null){if(T.as==null||T.as==="script"){var C=y(T.as,T.crossOrigin);o.d.M(v,{crossOrigin:C,integrity:typeof T.integrity=="string"?T.integrity:void 0,nonce:typeof T.nonce=="string"?T.nonce:void 0})}}else T==null&&o.d.M(v)},Qr.preload=function(v,T){if(typeof v=="string"&&typeof T=="object"&&T!==null&&typeof T.as=="string"){var C=T.as,I=y(C,T.crossOrigin);o.d.L(v,C,{crossOrigin:I,integrity:typeof T.integrity=="string"?T.integrity:void 0,nonce:typeof T.nonce=="string"?T.nonce:void 0,type:typeof T.type=="string"?T.type:void 0,fetchPriority:typeof T.fetchPriority=="string"?T.fetchPriority:void 0,referrerPolicy:typeof T.referrerPolicy=="string"?T.referrerPolicy:void 0,imageSrcSet:typeof T.imageSrcSet=="string"?T.imageSrcSet:void 0,imageSizes:typeof T.imageSizes=="string"?T.imageSizes:void 0,media:typeof T.media=="string"?T.media:void 0})}},Qr.preloadModule=function(v,T){if(typeof v=="string")if(T){var C=y(T.as,T.crossOrigin);o.d.m(v,{as:typeof T.as=="string"&&T.as!=="script"?T.as:void 0,crossOrigin:C,integrity:typeof T.integrity=="string"?T.integrity:void 0})}else o.d.m(v)},Qr.requestFormReset=function(v){o.d.r(v)},Qr.unstable_batchedUpdates=function(v,T){return v(T)},Qr.useFormState=function(v,T,C){return g.H.useFormState(v,T,C)},Qr.useFormStatus=function(){return g.H.useHostTransitionStatus()},Qr.version="19.0.0",Qr}var d3;function S9(){if(d3)return $D.exports;d3=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(i){console.error(i)}}return h(),$D.exports=_9(),$D.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u3;function y9(){if(u3)return $y;u3=1;var h=E9(),i=nL(),r=S9();function o(c){var u="https://react.dev/errors/"+c;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var E=2;E<arguments.length;E++)u+="&args[]="+encodeURIComponent(arguments[E])}return"Minified React error #"+c+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}var p=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),L=Symbol.for("react.consumer"),N=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),K=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),Q=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),ee=Symbol.for("react.offscreen"),pe=Symbol.for("react.memo_cache_sentinel"),de=Symbol.iterator;function be(c){return c===null||typeof c!="object"?null:(c=de&&c[de]||c["@@iterator"],typeof c=="function"?c:null)}var Se=Symbol.for("react.client.reference");function Te(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===Se?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case v:return"Fragment";case y:return"Portal";case C:return"Profiler";case T:return"StrictMode";case K:return"Suspense";case H:return"SuspenseList"}if(typeof c=="object")switch(c.$$typeof){case N:return(c.displayName||"Context")+".Provider";case L:return(c._context.displayName||"Context")+".Consumer";case x:var u=c.render;return c=c.displayName,c||(c=u.displayName||u.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case Q:return u=c.displayName||null,u!==null?u:Te(c.type)||"Memo";case ne:u=c._payload,c=c._init;try{return Te(c(u))}catch{}}return null}var _e=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,he=Object.assign,Ge,st;function It(c){if(Ge===void 0)try{throw Error()}catch(E){var u=E.stack.trim().match(/\n( *(at )?)/);Ge=u&&u[1]||"",st=-1<E.stack.indexOf(`
    at`)?" (<anonymous>)":-1<E.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ge+c+st}var qe=!1;function ut(c,u){if(!c||qe)return"";qe=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var R={DetermineComponentFrameRoot:function(){try{if(u){var _t=function(){throw Error()};if(Object.defineProperty(_t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_t,[])}catch(Je){var Ve=Je}Reflect.construct(c,[],_t)}else{try{_t.call()}catch(Je){Ve=Je}c.call(_t.prototype)}}else{try{throw Error()}catch(Je){Ve=Je}(_t=c())&&typeof _t.catch=="function"&&_t.catch(function(){})}}catch(Je){if(Je&&Ve&&typeof Je.stack=="string")return[Je.stack,Ve.stack]}return[null,null]}};R.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(R.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(R.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var U=R.DetermineComponentFrameRoot(),J=U[0],ae=U[1];if(J&&ae){var me=J.split(`
`),Ce=ae.split(`
`);for(w=R=0;R<me.length&&!me[R].includes("DetermineComponentFrameRoot");)R++;for(;w<Ce.length&&!Ce[w].includes("DetermineComponentFrameRoot");)w++;if(R===me.length||w===Ce.length)for(R=me.length-1,w=Ce.length-1;1<=R&&0<=w&&me[R]!==Ce[w];)w--;for(;1<=R&&0<=w;R--,w--)if(me[R]!==Ce[w]){if(R!==1||w!==1)do if(R--,w--,0>w||me[R]!==Ce[w]){var tt=`
`+me[R].replace(" at new "," at ");return c.displayName&&tt.includes("<anonymous>")&&(tt=tt.replace("<anonymous>",c.displayName)),tt}while(1<=R&&0<=w);break}}}finally{qe=!1,Error.prepareStackTrace=E}return(E=c?c.displayName||c.name:"")?It(E):""}function Oe(c){switch(c.tag){case 26:case 27:case 5:return It(c.type);case 16:return It("Lazy");case 13:return It("Suspense");case 19:return It("SuspenseList");case 0:case 15:return c=ut(c.type,!1),c;case 11:return c=ut(c.type.render,!1),c;case 1:return c=ut(c.type,!0),c;default:return""}}function Qe(c){try{var u="";do u+=Oe(c),c=c.return;while(c);return u}catch(E){return`
Error generating stack: `+E.message+`
`+E.stack}}function Ke(c){var u=c,E=c;if(c.alternate)for(;u.return;)u=u.return;else{c=u;do u=c,(u.flags&4098)!==0&&(E=u.return),c=u.return;while(c)}return u.tag===3?E:null}function Re(c){if(c.tag===13){var u=c.memoizedState;if(u===null&&(c=c.alternate,c!==null&&(u=c.memoizedState)),u!==null)return u.dehydrated}return null}function se(c){if(Ke(c)!==c)throw Error(o(188))}function we(c){var u=c.alternate;if(!u){if(u=Ke(c),u===null)throw Error(o(188));return u!==c?null:c}for(var E=c,R=u;;){var w=E.return;if(w===null)break;var U=w.alternate;if(U===null){if(R=w.return,R!==null){E=R;continue}break}if(w.child===U.child){for(U=w.child;U;){if(U===E)return se(w),c;if(U===R)return se(w),u;U=U.sibling}throw Error(o(188))}if(E.return!==R.return)E=w,R=U;else{for(var J=!1,ae=w.child;ae;){if(ae===E){J=!0,E=w,R=U;break}if(ae===R){J=!0,R=w,E=U;break}ae=ae.sibling}if(!J){for(ae=U.child;ae;){if(ae===E){J=!0,E=U,R=w;break}if(ae===R){J=!0,R=U,E=w;break}ae=ae.sibling}if(!J)throw Error(o(189))}}if(E.alternate!==R)throw Error(o(190))}if(E.tag!==3)throw Error(o(188));return E.stateNode.current===E?c:u}function He(c){var u=c.tag;if(u===5||u===26||u===27||u===6)return c;for(c=c.child;c!==null;){if(u=He(c),u!==null)return u;c=c.sibling}return null}var ct=Array.isArray,Be=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Et={pending:!1,data:null,method:null,action:null},St=[],it=-1;function Ze(c){return{current:c}}function mt(c){0>it||(c.current=St[it],St[it]=null,it--)}function bt(c,u){it++,St[it]=c.current,c.current=u}var gn=Ze(null),Ft=Ze(null),ei=Ze(null),ri=Ze(null);function Ws(c,u){switch(bt(ei,u),bt(Ft,c),bt(gn,null),c=u.nodeType,c){case 9:case 11:u=(u=u.documentElement)&&(u=u.namespaceURI)?Bv(u):0;break;default:if(c=c===8?u.parentNode:u,u=c.tagName,c=c.namespaceURI)c=Bv(c),u=Vv(c,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}mt(gn),bt(gn,u)}function jt(){mt(gn),mt(Ft),mt(ei)}function $n(c){c.memoizedState!==null&&bt(ri,c);var u=gn.current,E=Vv(u,c.type);u!==E&&(bt(Ft,c),bt(gn,E))}function Wn(c){Ft.current===c&&(mt(gn),mt(Ft)),ri.current===c&&(mt(ri),Mp._currentValue=Et)}var yi=Object.prototype.hasOwnProperty,lt=h.unstable_scheduleCallback,yt=h.unstable_cancelCallback,Ot=h.unstable_shouldYield,Tt=h.unstable_requestPaint,Xt=h.unstable_now,zn=h.unstable_getCurrentPriorityLevel,hs=h.unstable_ImmediatePriority,Nn=h.unstable_UserBlockingPriority,hi=h.unstable_NormalPriority,uc=h.unstable_LowPriority,yo=h.unstable_IdlePriority,Br=h.log,Ys=h.unstable_setDisableYieldValue,ul=null,qs=null;function To(c){if(qs&&typeof qs.onCommitFiberRoot=="function")try{qs.onCommitFiberRoot(ul,c,void 0,(c.current.flags&128)===128)}catch{}}function na(c){if(typeof Br=="function"&&Ys(c),qs&&typeof qs.setStrictMode=="function")try{qs.setStrictMode(ul,c)}catch{}}var Cr=Math.clz32?Math.clz32:Mm,F_=Math.log,hl=Math.LN2;function Mm(c){return c>>>=0,c===0?32:31-(F_(c)/hl|0)|0}var ya=128,Du=4194304;function hc(c){var u=c&42;if(u!==0)return u;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function Nu(c,u){var E=c.pendingLanes;if(E===0)return 0;var R=0,w=c.suspendedLanes,U=c.pingedLanes,J=c.warmLanes;c=c.finishedLanes!==0;var ae=E&134217727;return ae!==0?(E=ae&~w,E!==0?R=hc(E):(U&=ae,U!==0?R=hc(U):c||(J=ae&~J,J!==0&&(R=hc(J))))):(ae=E&~w,ae!==0?R=hc(ae):U!==0?R=hc(U):c||(J=E&~J,J!==0&&(R=hc(J)))),R===0?0:u!==0&&u!==R&&(u&w)===0&&(w=R&-R,J=u&-u,w>=J||w===32&&(J&4194176)!==0)?u:R}function Ya(c,u){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&u)===0}function B_(c,u){switch(c){case 1:case 2:case 4:case 8:return u+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qa(){var c=ya;return ya<<=1,(ya&4194176)===0&&(ya=128),c}function Um(){var c=Du;return Du<<=1,(Du&62914560)===0&&(Du=4194304),c}function mf(c){for(var u=[],E=0;31>E;E++)u.push(c);return u}function vd(c,u){c.pendingLanes|=u,u!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function Ir(c,u,E,R,w,U){var J=c.pendingLanes;c.pendingLanes=E,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=E,c.entangledLanes&=E,c.errorRecoveryDisabledLanes&=E,c.shellSuspendCounter=0;var ae=c.entanglements,me=c.expirationTimes,Ce=c.hiddenUpdates;for(E=J&~E;0<E;){var tt=31-Cr(E),_t=1<<tt;ae[tt]=0,me[tt]=-1;var Ve=Ce[tt];if(Ve!==null)for(Ce[tt]=null,tt=0;tt<Ve.length;tt++){var Je=Ve[tt];Je!==null&&(Je.lane&=-536870913)}E&=~_t}R!==0&&Fm(c,R,0),U!==0&&w===0&&c.tag!==0&&(c.suspendedLanes|=U&~(J&~u))}function Fm(c,u,E){c.pendingLanes|=u,c.suspendedLanes&=~u;var R=31-Cr(u);c.entangledLanes|=u,c.entanglements[R]=c.entanglements[R]|1073741824|E&4194218}function Lu(c,u){var E=c.entangledLanes|=u;for(c=c.entanglements;E;){var R=31-Cr(E),w=1<<R;w&u|c[R]&u&&(c[R]|=u),E&=~w}}function bd(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function gf(){var c=Be.p;return c!==0?c:(c=window.event,c===void 0?32:sb(c.type))}function Bm(c,u){var E=Be.p;try{return Be.p=c,u()}finally{Be.p=E}}var $a=Math.random().toString(36).slice(2),Fs="__reactFiber$"+$a,_n="__reactProps$"+$a,fc="__reactContainer$"+$a,Ef="__reactEvents$"+$a,V_="__reactListeners$"+$a,Vm="__reactHandles$"+$a,xu="__reactResources$"+$a,fl="__reactMarker$"+$a;function Ta(c){delete c[Fs],delete c[_n],delete c[Ef],delete c[V_],delete c[Vm]}function ia(c){var u=c[Fs];if(u)return u;for(var E=c.parentNode;E;){if(u=E[fc]||E[Fs]){if(E=u.alternate,u.child!==null||E!==null&&E.child!==null)for(c=Hv(c);c!==null;){if(E=c[Fs])return E;c=Hv(c)}return u}c=E,E=c.parentNode}return null}function pc(c){if(c=c[Fs]||c[fc]){var u=c.tag;if(u===5||u===6||u===13||u===26||u===27||u===3)return c}return null}function Ns(c){var u=c.tag;if(u===5||u===26||u===27||u===6)return c.stateNode;throw Error(o(33))}function Ti(c){var u=c[xu];return u||(u=c[xu]={hoistableStyles:new Map,hoistableScripts:new Map}),u}function ys(c){c[fl]=!0}var Yi=new Set,jm={};function vo(c,u){mc(c,u),mc(c+"Capture",u)}function mc(c,u){for(jm[c]=u,c=0;c<u.length;c++)Yi.add(u[c])}var za=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_f=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Sf={},yf={};function Gm(c){return yi.call(yf,c)?!0:yi.call(Sf,c)?!1:_f.test(c)?yf[c]=!0:(Sf[c]=!0,!1)}function Pu(c,u,E){if(Gm(u))if(E===null)c.removeAttribute(u);else{switch(typeof E){case"undefined":case"function":case"symbol":c.removeAttribute(u);return;case"boolean":var R=u.toLowerCase().slice(0,5);if(R!=="data-"&&R!=="aria-"){c.removeAttribute(u);return}}c.setAttribute(u,""+E)}}function pl(c,u,E){if(E===null)c.removeAttribute(u);else{switch(typeof E){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(u);return}c.setAttribute(u,""+E)}}function $s(c,u,E,R){if(R===null)c.removeAttribute(E);else{switch(typeof R){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(E);return}c.setAttributeNS(u,E,""+R)}}function zs(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function Tf(c){var u=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function ti(c){var u=Tf(c)?"checked":"value",E=Object.getOwnPropertyDescriptor(c.constructor.prototype,u),R=""+c[u];if(!c.hasOwnProperty(u)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var w=E.get,U=E.set;return Object.defineProperty(c,u,{configurable:!0,get:function(){return w.call(this)},set:function(J){R=""+J,U.call(this,J)}}),Object.defineProperty(c,u,{enumerable:E.enumerable}),{getValue:function(){return R},setValue:function(J){R=""+J},stopTracking:function(){c._valueTracker=null,delete c[u]}}}}function ku(c){c._valueTracker||(c._valueTracker=ti(c))}function vf(c){if(!c)return!1;var u=c._valueTracker;if(!u)return!0;var E=u.getValue(),R="";return c&&(R=Tf(c)?c.checked?"true":"false":c.value),c=R,c!==E?(u.setValue(c),!0):!1}function bo(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var Mu=/[\n"\\]/g;function Xs(c){return c.replace(Mu,function(u){return"\\"+u.charCodeAt(0).toString(16)+" "})}function Uu(c,u,E,R,w,U,J,ae){c.name="",J!=null&&typeof J!="function"&&typeof J!="symbol"&&typeof J!="boolean"?c.type=J:c.removeAttribute("type"),u!=null?J==="number"?(u===0&&c.value===""||c.value!=u)&&(c.value=""+zs(u)):c.value!==""+zs(u)&&(c.value=""+zs(u)):J!=="submit"&&J!=="reset"||c.removeAttribute("value"),u!=null?bf(c,J,zs(u)):E!=null?bf(c,J,zs(E)):R!=null&&c.removeAttribute("value"),w==null&&U!=null&&(c.defaultChecked=!!U),w!=null&&(c.checked=w&&typeof w!="function"&&typeof w!="symbol"),ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"?c.name=""+zs(ae):c.removeAttribute("name")}function Hm(c,u,E,R,w,U,J,ae){if(U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"&&(c.type=U),u!=null||E!=null){if(!(U!=="submit"&&U!=="reset"||u!=null))return;E=E!=null?""+zs(E):"",u=u!=null?""+zs(u):E,ae||u===c.value||(c.value=u),c.defaultValue=u}R=R??w,R=typeof R!="function"&&typeof R!="symbol"&&!!R,c.checked=ae?c.checked:!!R,c.defaultChecked=!!R,J!=null&&typeof J!="function"&&typeof J!="symbol"&&typeof J!="boolean"&&(c.name=J)}function bf(c,u,E){u==="number"&&bo(c.ownerDocument)===c||c.defaultValue===""+E||(c.defaultValue=""+E)}function ml(c,u,E,R){if(c=c.options,u){u={};for(var w=0;w<E.length;w++)u["$"+E[w]]=!0;for(E=0;E<c.length;E++)w=u.hasOwnProperty("$"+c[E].value),c[E].selected!==w&&(c[E].selected=w),w&&R&&(c[E].defaultSelected=!0)}else{for(E=""+zs(E),u=null,w=0;w<c.length;w++){if(c[w].value===E){c[w].selected=!0,R&&(c[w].defaultSelected=!0);return}u!==null||c[w].disabled||(u=c[w])}u!==null&&(u.selected=!0)}}function Rd(c,u,E){if(u!=null&&(u=""+zs(u),u!==c.value&&(c.value=u),E==null)){c.defaultValue!==u&&(c.defaultValue=u);return}c.defaultValue=E!=null?""+zs(E):""}function Rf(c,u,E,R){if(u==null){if(R!=null){if(E!=null)throw Error(o(92));if(ct(R)){if(1<R.length)throw Error(o(93));R=R[0]}E=R}E==null&&(E=""),u=E}E=zs(u),c.defaultValue=E,R=c.textContent,R===E&&R!==""&&R!==null&&(c.value=R)}function Ro(c,u){if(u){var E=c.firstChild;if(E&&E===c.lastChild&&E.nodeType===3){E.nodeValue=u;return}}c.textContent=u}var Km=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Fu(c,u,E){var R=u.indexOf("--")===0;E==null||typeof E=="boolean"||E===""?R?c.setProperty(u,""):u==="float"?c.cssFloat="":c[u]="":R?c.setProperty(u,E):typeof E!="number"||E===0||Km.has(u)?u==="float"?c.cssFloat=E:c[u]=(""+E).trim():c[u]=E+"px"}function Af(c,u,E){if(u!=null&&typeof u!="object")throw Error(o(62));if(c=c.style,E!=null){for(var R in E)!E.hasOwnProperty(R)||u!=null&&u.hasOwnProperty(R)||(R.indexOf("--")===0?c.setProperty(R,""):R==="float"?c.cssFloat="":c[R]="");for(var w in u)R=u[w],u.hasOwnProperty(w)&&E[w]!==R&&Fu(c,w,R)}else for(var U in u)u.hasOwnProperty(U)&&Fu(c,U,u[U])}function Bu(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var j_=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),gl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ad(c){return gl.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}var Cf=null;function Cd(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var gc=null,El=null;function Wm(c){var u=pc(c);if(u&&(c=u.stateNode)){var E=c[_n]||null;e:switch(c=u.stateNode,u.type){case"input":if(Uu(c,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name),u=E.name,E.type==="radio"&&u!=null){for(E=c;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll('input[name="'+Xs(""+u)+'"][type="radio"]'),u=0;u<E.length;u++){var R=E[u];if(R!==c&&R.form===c.form){var w=R[_n]||null;if(!w)throw Error(o(90));Uu(R,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name)}}for(u=0;u<E.length;u++)R=E[u],R.form===c.form&&vf(R)}break e;case"textarea":Rd(c,E.value,E.defaultValue);break e;case"select":u=E.value,u!=null&&ml(c,!!E.multiple,u,!1)}}}var Vu=!1;function Ym(c,u,E){if(Vu)return c(u,E);Vu=!0;try{var R=c(u);return R}finally{if(Vu=!1,(gc!==null||El!==null)&&(Zg(),gc&&(u=gc,c=El,El=gc=null,Wm(u),c)))for(u=0;u<c.length;u++)Wm(c[u])}}function Id(c,u){var E=c.stateNode;if(E===null)return null;var R=E[_n]||null;if(R===null)return null;E=R[u];e:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(c=c.type,R=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!R;break e;default:c=!1}if(c)return null;if(E&&typeof E!="function")throw Error(o(231,u,typeof E));return E}var If=!1;if(za)try{var lr={};Object.defineProperty(lr,"passive",{get:function(){If=!0}}),window.addEventListener("test",lr,lr),window.removeEventListener("test",lr,lr)}catch{If=!1}var Ao=null,ju=null,wd=null;function qm(){if(wd)return wd;var c,u=ju,E=u.length,R,w="value"in Ao?Ao.value:Ao.textContent,U=w.length;for(c=0;c<E&&u[c]===w[c];c++);var J=E-c;for(R=1;R<=J&&u[E-R]===w[U-R];R++);return wd=w.slice(c,1<R?1-R:void 0)}function Od(c){var u=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&u===13&&(c=13)):c=u,c===10&&(c=13),32<=c||c===13?c:0}function Gu(){return!0}function $m(){return!1}function dr(c){function u(E,R,w,U,J){this._reactName=E,this._targetInst=w,this.type=R,this.nativeEvent=U,this.target=J,this.currentTarget=null;for(var ae in c)c.hasOwnProperty(ae)&&(E=c[ae],this[ae]=E?E(U):U[ae]);return this.isDefaultPrevented=(U.defaultPrevented!=null?U.defaultPrevented:U.returnValue===!1)?Gu:$m,this.isPropagationStopped=$m,this}return he(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=Gu)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=Gu)},persist:function(){},isPersistent:Gu}),u}var ur={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Js=dr(ur),sa=he({},ur,{view:0,detail:0}),G_=dr(sa),wf,Hu,is,ra=he({},sa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xf,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==is&&(is&&c.type==="mousemove"?(wf=c.screenX-is.screenX,Hu=c.screenY-is.screenY):Hu=wf=0,is=c),wf)},movementY:function(c){return"movementY"in c?c.movementY:Hu}}),zm=dr(ra),Xm=he({},ra,{dataTransfer:0}),Co=dr(Xm),Jm=he({},sa,{relatedTarget:0}),Of=dr(Jm),Df=he({},ur,{animationName:0,elapsedTime:0,pseudoElement:0}),Qm=dr(Df),Io=he({},ur,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),Nf=dr(Io),Lf=he({},ur,{data:0}),Zm=dr(Lf),H_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ku={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function K_(c){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(c):(c=Ku[c])?!!u[c]:!1}function xf(){return K_}var W_=he({},sa,{key:function(c){if(c.key){var u=H_[c.key]||c.key;if(u!=="Unidentified")return u}return c.type==="keypress"?(c=Od(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?wo[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xf,charCode:function(c){return c.type==="keypress"?Od(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?Od(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),Y_=dr(W_),Wu=he({},ra,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Oo=dr(Wu),q_=he({},sa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xf}),_l=dr(q_),eg=he({},ur,{propertyName:0,elapsedTime:0,pseudoElement:0}),tg=dr(eg),fn=he({},ra,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),Pf=dr(fn),ng=he({},ur,{newState:0,oldState:0}),ig=dr(ng),kf=[9,13,27,32],Do=za&&"CompositionEvent"in window,Dd=null;za&&"documentMode"in document&&(Dd=document.documentMode);var sg=za&&"TextEvent"in window&&!Dd,Mf=za&&(!Do||Dd&&8<Dd&&11>=Dd),Nd=" ",Uf=!1;function Ff(c,u){switch(c){case"keyup":return kf.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yu(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var Ec=!1;function va(c,u){switch(c){case"compositionend":return Yu(u);case"keypress":return u.which!==32?null:(Uf=!0,Nd);case"textInput":return c=u.data,c===Nd&&Uf?null:c;default:return null}}function rg(c,u){if(Ec)return c==="compositionend"||!Do&&Ff(c,u)?(c=qm(),wd=ju=Ao=null,Ec=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return Mf&&u.locale!=="ko"?null:u.data;default:return null}}var Sl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ag(c){var u=c&&c.nodeName&&c.nodeName.toLowerCase();return u==="input"?!!Sl[c.type]:u==="textarea"}function Bf(c,u,E,R){gc?El?El.push(R):El=[R]:gc=R,u=Lp(u,"onChange"),0<u.length&&(E=new Js("onChange","change",null,E,R),c.push({event:E,listeners:u}))}var _c=null,yl=null;function og(c){Fv(c,0)}function Bs(c){var u=Ns(c);if(vf(u))return c}function cg(c,u){if(c==="change")return u}var lg=!1;if(za){var Vf;if(za){var qu="oninput"in document;if(!qu){var $u=document.createElement("div");$u.setAttribute("oninput","return;"),qu=typeof $u.oninput=="function"}Vf=qu}else Vf=!1;lg=Vf&&(!document.documentMode||9<document.documentMode)}function dg(){_c&&(_c.detachEvent("onpropertychange",jf),yl=_c=null)}function jf(c){if(c.propertyName==="value"&&Bs(yl)){var u=[];Bf(u,yl,c,Cd(c)),Ym(og,u)}}function ug(c,u,E){c==="focusin"?(dg(),_c=u,yl=E,_c.attachEvent("onpropertychange",jf)):c==="focusout"&&dg()}function zu(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return Bs(yl)}function Gf(c,u){if(c==="click")return Bs(u)}function $_(c,u){if(c==="input"||c==="change")return Bs(u)}function Xu(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var wr=typeof Object.is=="function"?Object.is:Xu;function Ld(c,u){if(wr(c,u))return!0;if(typeof c!="object"||c===null||typeof u!="object"||u===null)return!1;var E=Object.keys(c),R=Object.keys(u);if(E.length!==R.length)return!1;for(R=0;R<E.length;R++){var w=E[R];if(!yi.call(u,w)||!wr(c[w],u[w]))return!1}return!0}function xd(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function aa(c,u){var E=xd(c);c=0;for(var R;E;){if(E.nodeType===3){if(R=c+E.textContent.length,c<=u&&R>=u)return{node:E,offset:u-c};c=R}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=xd(E)}}function hg(c,u){return c&&u?c===u?!0:c&&c.nodeType===3?!1:u&&u.nodeType===3?hg(c,u.parentNode):"contains"in c?c.contains(u):c.compareDocumentPosition?!!(c.compareDocumentPosition(u)&16):!1:!1}function fg(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var u=bo(c.document);u instanceof c.HTMLIFrameElement;){try{var E=typeof u.contentWindow.location.href=="string"}catch{E=!1}if(E)c=u.contentWindow;else break;u=bo(c.document)}return u}function Qs(c){var u=c&&c.nodeName&&c.nodeName.toLowerCase();return u&&(u==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||u==="textarea"||c.contentEditable==="true")}function pg(c,u){var E=fg(u);u=c.focusedElem;var R=c.selectionRange;if(E!==u&&u&&u.ownerDocument&&hg(u.ownerDocument.documentElement,u)){if(R!==null&&Qs(u)){if(c=R.start,E=R.end,E===void 0&&(E=c),"selectionStart"in u)u.selectionStart=c,u.selectionEnd=Math.min(E,u.value.length);else if(E=(c=u.ownerDocument||document)&&c.defaultView||window,E.getSelection){E=E.getSelection();var w=u.textContent.length,U=Math.min(R.start,w);R=R.end===void 0?U:Math.min(R.end,w),!E.extend&&U>R&&(w=R,R=U,U=w),w=aa(u,U);var J=aa(u,R);w&&J&&(E.rangeCount!==1||E.anchorNode!==w.node||E.anchorOffset!==w.offset||E.focusNode!==J.node||E.focusOffset!==J.offset)&&(c=c.createRange(),c.setStart(w.node,w.offset),E.removeAllRanges(),U>R?(E.addRange(c),E.extend(J.node,J.offset)):(c.setEnd(J.node,J.offset),E.addRange(c)))}}for(c=[],E=u;E=E.parentNode;)E.nodeType===1&&c.push({element:E,left:E.scrollLeft,top:E.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<c.length;u++)E=c[u],E.element.scrollLeft=E.left,E.element.scrollTop=E.top}}var z_=za&&"documentMode"in document&&11>=document.documentMode,Tl=null,Hf=null,vl=null,Ju=!1;function Kf(c,u,E){var R=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;Ju||Tl==null||Tl!==bo(R)||(R=Tl,"selectionStart"in R&&Qs(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),vl&&Ld(vl,R)||(vl=R,R=Lp(Hf,"onSelect"),0<R.length&&(u=new Js("onSelect","select",null,u,E),c.push({event:u,listeners:R}),u.target=Tl)))}function Sc(c,u){var E={};return E[c.toLowerCase()]=u.toLowerCase(),E["Webkit"+c]="webkit"+u,E["Moz"+c]="moz"+u,E}var yc={animationend:Sc("Animation","AnimationEnd"),animationiteration:Sc("Animation","AnimationIteration"),animationstart:Sc("Animation","AnimationStart"),transitionrun:Sc("Transition","TransitionRun"),transitionstart:Sc("Transition","TransitionStart"),transitioncancel:Sc("Transition","TransitionCancel"),transitionend:Sc("Transition","TransitionEnd")},Wf={},Yf={};za&&(Yf=document.createElement("div").style,"AnimationEvent"in window||(delete yc.animationend.animation,delete yc.animationiteration.animation,delete yc.animationstart.animation),"TransitionEvent"in window||delete yc.transitionend.transition);function oa(c){if(Wf[c])return Wf[c];if(!yc[c])return c;var u=yc[c],E;for(E in u)if(u.hasOwnProperty(E)&&E in Yf)return Wf[c]=u[E];return c}var Qu=oa("animationend"),mg=oa("animationiteration"),We=oa("animationstart"),bT=oa("transitionrun"),RT=oa("transitionstart"),AT=oa("transitioncancel"),gg=oa("transitionend"),Eg=new Map,qf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function ca(c,u){Eg.set(c,u),vo(u,[c])}var Vr=[],Xa=0,No=0;function Zu(){for(var c=Xa,u=No=Xa=0;u<c;){var E=Vr[u];Vr[u++]=null;var R=Vr[u];Vr[u++]=null;var w=Vr[u];Vr[u++]=null;var U=Vr[u];if(Vr[u++]=null,R!==null&&w!==null){var J=R.pending;J===null?w.next=w:(w.next=J.next,J.next=w),R.pending=w}U!==0&&th(E,w,U)}}function eh(c,u,E,R){Vr[Xa++]=c,Vr[Xa++]=u,Vr[Xa++]=E,Vr[Xa++]=R,No|=R,c.lanes|=R,c=c.alternate,c!==null&&(c.lanes|=R)}function $f(c,u,E,R){return eh(c,u,E,R),ba(c)}function Lo(c,u){return eh(c,null,null,u),ba(c)}function th(c,u,E){c.lanes|=E;var R=c.alternate;R!==null&&(R.lanes|=E);for(var w=!1,U=c.return;U!==null;)U.childLanes|=E,R=U.alternate,R!==null&&(R.childLanes|=E),U.tag===22&&(c=U.stateNode,c===null||c._visibility&1||(w=!0)),c=U,U=U.return;w&&u!==null&&c.tag===3&&(U=c.stateNode,w=31-Cr(E),U=U.hiddenUpdates,c=U[w],c===null?U[w]=[u]:c.push(u),u.lane=E|536870912)}function ba(c){if(50<Yd)throw Yd=0,Sh=null,Error(o(185));for(var u=c.return;u!==null;)c=u,u=c.return;return c.tag===3?c.stateNode:null}var xo={},jr=new WeakMap;function Zs(c,u){if(typeof c=="object"&&c!==null){var E=jr.get(c);return E!==void 0?E:(u={value:c,source:u,stack:Qe(u)},jr.set(c,u),u)}return{value:c,source:u,stack:Qe(u)}}var Ra=[],bl=0,nh=null,Pd=0,Or=[],Gr=0,Tc=null,Ts=1,hr="";function mi(c,u){Ra[bl++]=Pd,Ra[bl++]=nh,nh=c,Pd=u}function zf(c,u,E){Or[Gr++]=Ts,Or[Gr++]=hr,Or[Gr++]=Tc,Tc=c;var R=Ts;c=hr;var w=32-Cr(R)-1;R&=~(1<<w),E+=1;var U=32-Cr(u)+w;if(30<U){var J=w-w%5;U=(R&(1<<J)-1).toString(32),R>>=J,w-=J,Ts=1<<32-Cr(u)+w|E<<w|R,hr=U+c}else Ts=1<<U|E<<w|R,hr=c}function ih(c){c.return!==null&&(mi(c,1),zf(c,1,0))}function Xf(c){for(;c===nh;)nh=Ra[--bl],Ra[bl]=null,Pd=Ra[--bl],Ra[bl]=null;for(;c===Tc;)Tc=Or[--Gr],Or[Gr]=null,hr=Or[--Gr],Or[Gr]=null,Ts=Or[--Gr],Or[Gr]=null}var Vs=null,ss=null,Yn=!1,la=null,Aa=!1,Rl=Error(o(519));function P(c){var u=Error(o(418,""));throw At(Zs(u,c)),Rl}function V(c){var u=c.stateNode,E=c.type,R=c.memoizedProps;switch(u[Fs]=c,u[_n]=R,E){case"dialog":Gn("cancel",u),Gn("close",u);break;case"iframe":case"object":case"embed":Gn("load",u);break;case"video":case"audio":for(E=0;E<Xd.length;E++)Gn(Xd[E],u);break;case"source":Gn("error",u);break;case"img":case"image":case"link":Gn("error",u),Gn("load",u);break;case"details":Gn("toggle",u);break;case"input":Gn("invalid",u),Hm(u,R.value,R.defaultValue,R.checked,R.defaultChecked,R.type,R.name,!0),ku(u);break;case"select":Gn("invalid",u);break;case"textarea":Gn("invalid",u),Rf(u,R.value,R.defaultValue,R.children),ku(u)}E=R.children,typeof E!="string"&&typeof E!="number"&&typeof E!="bigint"||u.textContent===""+E||R.suppressHydrationWarning===!0||ES(u.textContent,E)?(R.popover!=null&&(Gn("beforetoggle",u),Gn("toggle",u)),R.onScroll!=null&&Gn("scroll",u),R.onScrollEnd!=null&&Gn("scrollend",u),R.onClick!=null&&(u.onclick=lE),u=!0):u=!1,u||P(c)}function X(c){for(Vs=c.return;Vs;)switch(Vs.tag){case 3:case 27:Aa=!0;return;case 5:case 13:Aa=!1;return;default:Vs=Vs.return}}function ce(c){if(c!==Vs)return!1;if(!Yn)return X(c),Yn=!0,!1;var u=!1,E;if((E=c.tag!==3&&c.tag!==27)&&((E=c.tag===5)&&(E=c.type,E=!(E!=="form"&&E!=="button")||TS(c.type,c.memoizedProps)),E=!E),E&&(u=!0),u&&ss&&P(c),X(c),c.tag===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(o(317));e:{for(c=c.nextSibling,u=0;c;){if(c.nodeType===8)if(E=c.data,E==="/$"){if(u===0){ss=Oa(c.nextSibling);break e}u--}else E!=="$"&&E!=="$!"&&E!=="$?"||u++;c=c.nextSibling}ss=null}}else ss=Vs?Oa(c.stateNode.nextSibling):null;return!0}function Fe(){ss=Vs=null,Yn=!1}function At(c){la===null?la=[c]:la.push(c)}var cn=Error(o(460)),Un=Error(o(474)),Oi={then:function(){}};function vc(c){return c=c.status,c==="fulfilled"||c==="rejected"}function Al(){}function CT(c,u,E){switch(E=c[E],E===void 0?c.push(u):E!==u&&(u.then(Al,Al),u=E),u.status){case"fulfilled":return u.value;case"rejected":throw c=u.reason,c===cn?Error(o(483)):c;default:if(typeof u.status=="string")u.then(Al,Al);else{if(c=vi,c!==null&&100<c.shellSuspendCounter)throw Error(o(482));c=u,c.status="pending",c.then(function(R){if(u.status==="pending"){var w=u;w.status="fulfilled",w.value=R}},function(R){if(u.status==="pending"){var w=u;w.status="rejected",w.reason=R}})}switch(u.status){case"fulfilled":return u.value;case"rejected":throw c=u.reason,c===cn?Error(o(483)):c}throw Jf=u,cn}}var Jf=null;function IT(){if(Jf===null)throw Error(o(459));var c=Jf;return Jf=null,c}var bc=null,Cl=0;function sh(c){var u=Cl;return Cl+=1,bc===null&&(bc=[]),CT(bc,c,u)}function Qf(c,u){u=u.props.ref,c.ref=u!==void 0?u:null}function _g(c,u){throw u.$$typeof===p?Error(o(525)):(c=Object.prototype.toString.call(u),Error(o(31,c==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":c)))}function wT(c){var u=c._init;return u(c._payload)}function X_(c){function u(Ne,Ae){if(c){var ke=Ne.deletions;ke===null?(Ne.deletions=[Ae],Ne.flags|=16):ke.push(Ae)}}function E(Ne,Ae){if(!c)return null;for(;Ae!==null;)u(Ne,Ae),Ae=Ae.sibling;return null}function R(Ne){for(var Ae=new Map;Ne!==null;)Ne.key!==null?Ae.set(Ne.key,Ne):Ae.set(Ne.index,Ne),Ne=Ne.sibling;return Ae}function w(Ne,Ae){return Ne=Uc(Ne,Ae),Ne.index=0,Ne.sibling=null,Ne}function U(Ne,Ae,ke){return Ne.index=ke,c?(ke=Ne.alternate,ke!==null?(ke=ke.index,ke<Ae?(Ne.flags|=33554434,Ae):ke):(Ne.flags|=33554434,Ae)):(Ne.flags|=1048576,Ae)}function J(Ne){return c&&Ne.alternate===null&&(Ne.flags|=33554434),Ne}function ae(Ne,Ae,ke,ht){return Ae===null||Ae.tag!==6?(Ae=Q0(ke,Ne.mode,ht),Ae.return=Ne,Ae):(Ae=w(Ae,ke),Ae.return=Ne,Ae)}function me(Ne,Ae,ke,ht){var Mt=ke.type;return Mt===v?tt(Ne,Ae,ke.props.children,ht,ke.key):Ae!==null&&(Ae.elementType===Mt||typeof Mt=="object"&&Mt!==null&&Mt.$$typeof===ne&&wT(Mt)===Ae.type)?(Ae=w(Ae,ke.props),Qf(Ae,ke),Ae.return=Ne,Ae):(Ae=Wg(ke.type,ke.key,ke.props,null,Ne.mode,ht),Qf(Ae,ke),Ae.return=Ne,Ae)}function Ce(Ne,Ae,ke,ht){return Ae===null||Ae.tag!==4||Ae.stateNode.containerInfo!==ke.containerInfo||Ae.stateNode.implementation!==ke.implementation?(Ae=Z0(ke,Ne.mode,ht),Ae.return=Ne,Ae):(Ae=w(Ae,ke.children||[]),Ae.return=Ne,Ae)}function tt(Ne,Ae,ke,ht,Mt){return Ae===null||Ae.tag!==7?(Ae=Ul(ke,Ne.mode,ht,Mt),Ae.return=Ne,Ae):(Ae=w(Ae,ke),Ae.return=Ne,Ae)}function _t(Ne,Ae,ke){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return Ae=Q0(""+Ae,Ne.mode,ke),Ae.return=Ne,Ae;if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case g:return ke=Wg(Ae.type,Ae.key,Ae.props,null,Ne.mode,ke),Qf(ke,Ae),ke.return=Ne,ke;case y:return Ae=Z0(Ae,Ne.mode,ke),Ae.return=Ne,Ae;case ne:var ht=Ae._init;return Ae=ht(Ae._payload),_t(Ne,Ae,ke)}if(ct(Ae)||be(Ae))return Ae=Ul(Ae,Ne.mode,ke,null),Ae.return=Ne,Ae;if(typeof Ae.then=="function")return _t(Ne,sh(Ae),ke);if(Ae.$$typeof===N)return _t(Ne,mp(Ne,Ae),ke);_g(Ne,Ae)}return null}function Ve(Ne,Ae,ke,ht){var Mt=Ae!==null?Ae.key:null;if(typeof ke=="string"&&ke!==""||typeof ke=="number"||typeof ke=="bigint")return Mt!==null?null:ae(Ne,Ae,""+ke,ht);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case g:return ke.key===Mt?me(Ne,Ae,ke,ht):null;case y:return ke.key===Mt?Ce(Ne,Ae,ke,ht):null;case ne:return Mt=ke._init,ke=Mt(ke._payload),Ve(Ne,Ae,ke,ht)}if(ct(ke)||be(ke))return Mt!==null?null:tt(Ne,Ae,ke,ht,null);if(typeof ke.then=="function")return Ve(Ne,Ae,sh(ke),ht);if(ke.$$typeof===N)return Ve(Ne,Ae,mp(Ne,ke),ht);_g(Ne,ke)}return null}function Je(Ne,Ae,ke,ht,Mt){if(typeof ht=="string"&&ht!==""||typeof ht=="number"||typeof ht=="bigint")return Ne=Ne.get(ke)||null,ae(Ae,Ne,""+ht,Mt);if(typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case g:return Ne=Ne.get(ht.key===null?ke:ht.key)||null,me(Ae,Ne,ht,Mt);case y:return Ne=Ne.get(ht.key===null?ke:ht.key)||null,Ce(Ae,Ne,ht,Mt);case ne:var Jt=ht._init;return ht=Jt(ht._payload),Je(Ne,Ae,ke,ht,Mt)}if(ct(ht)||be(ht))return Ne=Ne.get(ke)||null,tt(Ae,Ne,ht,Mt,null);if(typeof ht.then=="function")return Je(Ne,Ae,ke,sh(ht),Mt);if(ht.$$typeof===N)return Je(Ne,Ae,ke,mp(Ae,ht),Mt);_g(Ae,ht)}return null}function Bt(Ne,Ae,ke,ht){for(var Mt=null,Jt=null,Kt=Ae,Qt=Ae=0,Rs=null;Kt!==null&&Qt<ke.length;Qt++){Kt.index>Qt?(Rs=Kt,Kt=null):Rs=Kt.sibling;var ni=Ve(Ne,Kt,ke[Qt],ht);if(ni===null){Kt===null&&(Kt=Rs);break}c&&Kt&&ni.alternate===null&&u(Ne,Kt),Ae=U(ni,Ae,Qt),Jt===null?Mt=ni:Jt.sibling=ni,Jt=ni,Kt=Rs}if(Qt===ke.length)return E(Ne,Kt),Yn&&mi(Ne,Qt),Mt;if(Kt===null){for(;Qt<ke.length;Qt++)Kt=_t(Ne,ke[Qt],ht),Kt!==null&&(Ae=U(Kt,Ae,Qt),Jt===null?Mt=Kt:Jt.sibling=Kt,Jt=Kt);return Yn&&mi(Ne,Qt),Mt}for(Kt=R(Kt);Qt<ke.length;Qt++)Rs=Je(Kt,Ne,Qt,ke[Qt],ht),Rs!==null&&(c&&Rs.alternate!==null&&Kt.delete(Rs.key===null?Qt:Rs.key),Ae=U(Rs,Ae,Qt),Jt===null?Mt=Rs:Jt.sibling=Rs,Jt=Rs);return c&&Kt.forEach(function(pa){return u(Ne,pa)}),Yn&&mi(Ne,Qt),Mt}function hn(Ne,Ae,ke,ht){if(ke==null)throw Error(o(151));for(var Mt=null,Jt=null,Kt=Ae,Qt=Ae=0,Rs=null,ni=ke.next();Kt!==null&&!ni.done;Qt++,ni=ke.next()){Kt.index>Qt?(Rs=Kt,Kt=null):Rs=Kt.sibling;var pa=Ve(Ne,Kt,ni.value,ht);if(pa===null){Kt===null&&(Kt=Rs);break}c&&Kt&&pa.alternate===null&&u(Ne,Kt),Ae=U(pa,Ae,Qt),Jt===null?Mt=pa:Jt.sibling=pa,Jt=pa,Kt=Rs}if(ni.done)return E(Ne,Kt),Yn&&mi(Ne,Qt),Mt;if(Kt===null){for(;!ni.done;Qt++,ni=ke.next())ni=_t(Ne,ni.value,ht),ni!==null&&(Ae=U(ni,Ae,Qt),Jt===null?Mt=ni:Jt.sibling=ni,Jt=ni);return Yn&&mi(Ne,Qt),Mt}for(Kt=R(Kt);!ni.done;Qt++,ni=ke.next())ni=Je(Kt,Ne,Qt,ni.value,ht),ni!==null&&(c&&ni.alternate!==null&&Kt.delete(ni.key===null?Qt:ni.key),Ae=U(ni,Ae,Qt),Jt===null?Mt=ni:Jt.sibling=ni,Jt=ni);return c&&Kt.forEach(function(hI){return u(Ne,hI)}),Yn&&mi(Ne,Qt),Mt}function $i(Ne,Ae,ke,ht){if(typeof ke=="object"&&ke!==null&&ke.type===v&&ke.key===null&&(ke=ke.props.children),typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case g:e:{for(var Mt=ke.key;Ae!==null;){if(Ae.key===Mt){if(Mt=ke.type,Mt===v){if(Ae.tag===7){E(Ne,Ae.sibling),ht=w(Ae,ke.props.children),ht.return=Ne,Ne=ht;break e}}else if(Ae.elementType===Mt||typeof Mt=="object"&&Mt!==null&&Mt.$$typeof===ne&&wT(Mt)===Ae.type){E(Ne,Ae.sibling),ht=w(Ae,ke.props),Qf(ht,ke),ht.return=Ne,Ne=ht;break e}E(Ne,Ae);break}else u(Ne,Ae);Ae=Ae.sibling}ke.type===v?(ht=Ul(ke.props.children,Ne.mode,ht,ke.key),ht.return=Ne,Ne=ht):(ht=Wg(ke.type,ke.key,ke.props,null,Ne.mode,ht),Qf(ht,ke),ht.return=Ne,Ne=ht)}return J(Ne);case y:e:{for(Mt=ke.key;Ae!==null;){if(Ae.key===Mt)if(Ae.tag===4&&Ae.stateNode.containerInfo===ke.containerInfo&&Ae.stateNode.implementation===ke.implementation){E(Ne,Ae.sibling),ht=w(Ae,ke.children||[]),ht.return=Ne,Ne=ht;break e}else{E(Ne,Ae);break}else u(Ne,Ae);Ae=Ae.sibling}ht=Z0(ke,Ne.mode,ht),ht.return=Ne,Ne=ht}return J(Ne);case ne:return Mt=ke._init,ke=Mt(ke._payload),$i(Ne,Ae,ke,ht)}if(ct(ke))return Bt(Ne,Ae,ke,ht);if(be(ke)){if(Mt=be(ke),typeof Mt!="function")throw Error(o(150));return ke=Mt.call(ke),hn(Ne,Ae,ke,ht)}if(typeof ke.then=="function")return $i(Ne,Ae,sh(ke),ht);if(ke.$$typeof===N)return $i(Ne,Ae,mp(Ne,ke),ht);_g(Ne,ke)}return typeof ke=="string"&&ke!==""||typeof ke=="number"||typeof ke=="bigint"?(ke=""+ke,Ae!==null&&Ae.tag===6?(E(Ne,Ae.sibling),ht=w(Ae,ke),ht.return=Ne,Ne=ht):(E(Ne,Ae),ht=Q0(ke,Ne.mode,ht),ht.return=Ne,Ne=ht),J(Ne)):E(Ne,Ae)}return function(Ne,Ae,ke,ht){try{Cl=0;var Mt=$i(Ne,Ae,ke,ht);return bc=null,Mt}catch(Kt){if(Kt===cn)throw Kt;var Jt=ha(29,Kt,null,Ne.mode);return Jt.lanes=ht,Jt.return=Ne,Jt}finally{}}}var Il=X_(!0),Sg=X_(!1),rh=Ze(null),yg=Ze(0);function ah(c,u){c=no,bt(yg,c),bt(rh,u),no=c|u.baseLanes}function J_(){bt(yg,no),bt(rh,rh.current)}function Q_(){no=yg.current,mt(rh),mt(yg)}var Ca=Ze(null),Po=null;function wl(c){var u=c.alternate;bt(Ls,Ls.current&1),bt(Ca,c),Po===null&&(u===null||rh.current!==null||u.memoizedState!==null)&&(Po=c)}function OT(c){if(c.tag===22){if(bt(Ls,Ls.current),bt(Ca,c),Po===null){var u=c.alternate;u!==null&&u.memoizedState!==null&&(Po=c)}}else Rc()}function Rc(){bt(Ls,Ls.current),bt(Ca,Ca.current)}function Ac(c){mt(Ca),Po===c&&(Po=null),mt(Ls)}var Ls=Ze(0);function Tg(c){for(var u=c;u!==null;){if(u.tag===13){var E=u.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if((u.flags&128)!==0)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===c)break;for(;u.sibling===null;){if(u.return===null||u.return===c)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}var Z_=typeof AbortController<"u"?AbortController:function(){var c=[],u=this.signal={aborted:!1,addEventListener:function(E,R){c.push(R)}};this.abort=function(){u.aborted=!0,c.forEach(function(E){return E()})}},IC=h.unstable_scheduleCallback,wC=h.unstable_NormalPriority,rs={$$typeof:N,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function e0(){return{controller:new Z_,data:new Map,refCount:0}}function Zf(c){c.refCount--,c.refCount===0&&IC(wC,function(){c.controller.abort()})}var ep=null,t0=0,oh=0,ch=null;function vg(c,u){if(ep===null){var E=ep=[];t0=0,oh=uS(),ch={status:"pending",value:void 0,then:function(R){E.push(R)}}}return t0++,u.then(n0,n0),u}function n0(){if(--t0===0&&ep!==null){ch!==null&&(ch.status="fulfilled");var c=ep;ep=null,oh=0,ch=null;for(var u=0;u<c.length;u++)(0,c[u])()}}function OC(c,u){var E=[],R={status:"pending",value:null,reason:null,then:function(w){E.push(w)}};return c.then(function(){R.status="fulfilled",R.value=u;for(var w=0;w<E.length;w++)(0,E[w])(u)},function(w){for(R.status="rejected",R.reason=w,w=0;w<E.length;w++)(0,E[w])(void 0)}),R}var DT=_e.S;_e.S=function(c,u){typeof u=="object"&&u!==null&&typeof u.then=="function"&&vg(c,u),DT!==null&&DT(c,u)};var Ol=Ze(null);function i0(){var c=Ol.current;return c!==null?c:vi.pooledCache}function bg(c,u){u===null?bt(Ol,Ol.current):bt(Ol,u.pool)}function NT(){var c=i0();return c===null?null:{parent:rs._currentValue,pool:c}}var ko=0,Tn=null,gi=null,as=null,tp=!1,kd=!1,Mo=!1,Dl=0,np=0,lh=null,LT=0;function fs(){throw Error(o(321))}function s0(c,u){if(u===null)return!1;for(var E=0;E<u.length&&E<c.length;E++)if(!wr(c[E],u[E]))return!1;return!0}function Rg(c,u,E,R,w,U){return ko=U,Tn=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,_e.H=c===null||c.memoizedState===null?Md:Nl,Mo=!1,U=E(R,w),Mo=!1,kd&&(U=PT(u,E,R,w)),xT(c),U}function xT(c){_e.H=Ja;var u=gi!==null&&gi.next!==null;if(ko=0,as=gi=Tn=null,tp=!1,np=0,lh=null,u)throw Error(o(300));c===null||xs||(c=c.dependencies,c!==null&&Vg(c)&&(xs=!0))}function PT(c,u,E,R){Tn=c;var w=0;do{if(kd&&(lh=null),np=0,kd=!1,25<=w)throw Error(o(301));if(w+=1,as=gi=null,c.updateQueue!=null){var U=c.updateQueue;U.lastEffect=null,U.events=null,U.stores=null,U.memoCache!=null&&(U.memoCache.index=0)}_e.H=wc,U=u(E,R)}while(kd);return U}function DC(){var c=_e.H,u=c.useState()[0];return u=typeof u.then=="function"?ip(u):u,c=c.useState()[0],(gi!==null?gi.memoizedState:null)!==c&&(Tn.flags|=1024),u}function r0(){var c=Dl!==0;return Dl=0,c}function a0(c,u,E){u.updateQueue=c.updateQueue,u.flags&=-2053,c.lanes&=~E}function o0(c){if(tp){for(c=c.memoizedState;c!==null;){var u=c.queue;u!==null&&(u.pending=null),c=c.next}tp=!1}ko=0,as=gi=Tn=null,kd=!1,np=Dl=0,lh=null}function Dr(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return as===null?Tn.memoizedState=as=c:as=as.next=c,as}function Ui(){if(gi===null){var c=Tn.alternate;c=c!==null?c.memoizedState:null}else c=gi.next;var u=as===null?Tn.memoizedState:as.next;if(u!==null)as=u,gi=c;else{if(c===null)throw Tn.alternate===null?Error(o(467)):Error(o(310));gi=c,c={memoizedState:gi.memoizedState,baseState:gi.baseState,baseQueue:gi.baseQueue,queue:gi.queue,next:null},as===null?Tn.memoizedState=as=c:as=as.next=c}return as}var Ag;Ag=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function ip(c){var u=np;return np+=1,lh===null&&(lh=[]),c=CT(lh,c,u),u=Tn,(as===null?u.memoizedState:as.next)===null&&(u=u.alternate,_e.H=u===null||u.memoizedState===null?Md:Nl),c}function Cg(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return ip(c);if(c.$$typeof===N)return er(c)}throw Error(o(438,String(c)))}function Ig(c){var u=null,E=Tn.updateQueue;if(E!==null&&(u=E.memoCache),u==null){var R=Tn.alternate;R!==null&&(R=R.updateQueue,R!==null&&(R=R.memoCache,R!=null&&(u={data:R.data.map(function(w){return w.slice()}),index:0})))}if(u==null&&(u={data:[],index:0}),E===null&&(E=Ag(),Tn.updateQueue=E),E.memoCache=u,E=u.data[u.index],E===void 0)for(E=u.data[u.index]=Array(c),R=0;R<c;R++)E[R]=pe;return u.index++,E}function Cc(c,u){return typeof u=="function"?u(c):u}function sp(c){var u=Ui();return c0(u,gi,c)}function c0(c,u,E){var R=c.queue;if(R===null)throw Error(o(311));R.lastRenderedReducer=E;var w=c.baseQueue,U=R.pending;if(U!==null){if(w!==null){var J=w.next;w.next=U.next,U.next=J}u.baseQueue=w=U,R.pending=null}if(U=c.baseState,w===null)c.memoizedState=U;else{u=w.next;var ae=J=null,me=null,Ce=u,tt=!1;do{var _t=Ce.lane&-536870913;if(_t!==Ce.lane?(jn&_t)===_t:(ko&_t)===_t){var Ve=Ce.revertLane;if(Ve===0)me!==null&&(me=me.next={lane:0,revertLane:0,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null}),_t===oh&&(tt=!0);else if((ko&Ve)===Ve){Ce=Ce.next,Ve===oh&&(tt=!0);continue}else _t={lane:0,revertLane:Ce.revertLane,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null},me===null?(ae=me=_t,J=U):me=me.next=_t,Tn.lanes|=Ve,Fc|=Ve;_t=Ce.action,Mo&&E(U,_t),U=Ce.hasEagerState?Ce.eagerState:E(U,_t)}else Ve={lane:_t,revertLane:Ce.revertLane,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null},me===null?(ae=me=Ve,J=U):me=me.next=Ve,Tn.lanes|=_t,Fc|=_t;Ce=Ce.next}while(Ce!==null&&Ce!==u);if(me===null?J=U:me.next=ae,!wr(U,c.memoizedState)&&(xs=!0,tt&&(E=ch,E!==null)))throw E;c.memoizedState=U,c.baseState=J,c.baseQueue=me,R.lastRenderedState=U}return w===null&&(R.lanes=0),[c.memoizedState,R.dispatch]}function l0(c){var u=Ui(),E=u.queue;if(E===null)throw Error(o(311));E.lastRenderedReducer=c;var R=E.dispatch,w=E.pending,U=u.memoizedState;if(w!==null){E.pending=null;var J=w=w.next;do U=c(U,J.action),J=J.next;while(J!==w);wr(U,u.memoizedState)||(xs=!0),u.memoizedState=U,u.baseQueue===null&&(u.baseState=U),E.lastRenderedState=U}return[U,R]}function kT(c,u,E){var R=Tn,w=Ui(),U=Yn;if(U){if(E===void 0)throw Error(o(407));E=E()}else E=u();var J=!wr((gi||w).memoizedState,E);if(J&&(w.memoizedState=E,xs=!0),w=w.queue,Dg(UT.bind(null,R,w,c),[c]),w.getSnapshot!==u||J||as!==null&&as.memoizedState.tag&1){if(R.flags|=2048,dh(9,MT.bind(null,R,w,E,u),{destroy:void 0},null),vi===null)throw Error(o(349));U||(ko&60)!==0||rp(R,u,E)}return E}function rp(c,u,E){c.flags|=16384,c={getSnapshot:u,value:E},u=Tn.updateQueue,u===null?(u=Ag(),Tn.updateQueue=u,u.stores=[c]):(E=u.stores,E===null?u.stores=[c]:E.push(c))}function MT(c,u,E,R){u.value=E,u.getSnapshot=R,FT(u)&&BT(c)}function UT(c,u,E){return E(function(){FT(u)&&BT(c)})}function FT(c){var u=c.getSnapshot;c=c.value;try{var E=u();return!wr(c,E)}catch{return!0}}function BT(c){var u=Lo(c,2);u!==null&&bs(u,c,2)}function d0(c){var u=Dr();if(typeof c=="function"){var E=c;if(c=E(),Mo){na(!0);try{E()}finally{na(!1)}}}return u.memoizedState=u.baseState=c,u.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Cc,lastRenderedState:c},u}function VT(c,u,E,R){return c.baseState=E,c0(c,gi,typeof R=="function"?R:Cc)}function u0(c,u,E,R,w){if(Pg(c))throw Error(o(485));if(c=u.action,c!==null){var U={payload:w,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(J){U.listeners.push(J)}};_e.T!==null?E(!0):U.isTransition=!1,R(U),E=u.pending,E===null?(U.next=u.pending=U,jT(u,U)):(U.next=E.next,u.pending=E.next=U)}}function jT(c,u){var E=u.action,R=u.payload,w=c.state;if(u.isTransition){var U=_e.T,J={};_e.T=J;try{var ae=E(w,R),me=_e.S;me!==null&&me(J,ae),h0(c,u,ae)}catch(Ce){wg(c,u,Ce)}finally{_e.T=U}}else try{U=E(w,R),h0(c,u,U)}catch(Ce){wg(c,u,Ce)}}function h0(c,u,E){E!==null&&typeof E=="object"&&typeof E.then=="function"?E.then(function(R){GT(c,u,R)},function(R){return wg(c,u,R)}):GT(c,u,E)}function GT(c,u,E){u.status="fulfilled",u.value=E,HT(u),c.state=E,u=c.pending,u!==null&&(E=u.next,E===u?c.pending=null:(E=E.next,u.next=E,jT(c,E)))}function wg(c,u,E){var R=c.pending;if(c.pending=null,R!==null){R=R.next;do u.status="rejected",u.reason=E,HT(u),u=u.next;while(u!==R)}c.action=null}function HT(c){c=c.listeners;for(var u=0;u<c.length;u++)(0,c[u])()}function KT(c,u){return u}function WT(c,u){if(Yn){var E=vi.formState;if(E!==null){e:{var R=Tn;if(Yn){if(ss){t:{for(var w=ss,U=Aa;w.nodeType!==8;){if(!U){w=null;break t}if(w=Oa(w.nextSibling),w===null){w=null;break t}}U=w.data,w=U==="F!"||U==="F"?w:null}if(w){ss=Oa(w.nextSibling),R=w.data==="F!";break e}}P(R)}R=!1}R&&(u=E[0])}}return E=Dr(),E.memoizedState=E.baseState=u,R={pending:null,lanes:0,dispatch:null,lastRenderedReducer:KT,lastRenderedState:u},E.queue=R,E=dp.bind(null,Tn,R),R.dispatch=E,R=d0(!1),U=fh.bind(null,Tn,!1,R.queue),R=Dr(),w={state:u,dispatch:null,action:c,pending:null},R.queue=w,E=u0.bind(null,Tn,w,U,E),w.dispatch=E,R.memoizedState=c,[u,E,!1]}function YT(c){var u=Ui();return qT(u,gi,c)}function qT(c,u,E){u=c0(c,u,KT)[0],c=sp(Cc)[0],u=typeof u=="object"&&u!==null&&typeof u.then=="function"?ip(u):u;var R=Ui(),w=R.queue,U=w.dispatch;return E!==R.memoizedState&&(Tn.flags|=2048,dh(9,NC.bind(null,w,E),{destroy:void 0},null)),[u,U,c]}function NC(c,u){c.action=u}function f0(c){var u=Ui(),E=gi;if(E!==null)return qT(u,E,c);Ui(),u=u.memoizedState,E=Ui();var R=E.queue.dispatch;return E.memoizedState=c,[u,R,!1]}function dh(c,u,E,R){return c={tag:c,create:u,inst:E,deps:R,next:null},u=Tn.updateQueue,u===null&&(u=Ag(),Tn.updateQueue=u),E=u.lastEffect,E===null?u.lastEffect=c.next=c:(R=E.next,E.next=c,c.next=R,u.lastEffect=c),c}function $T(){return Ui().memoizedState}function ap(c,u,E,R){var w=Dr();Tn.flags|=c,w.memoizedState=dh(1|u,E,{destroy:void 0},R===void 0?null:R)}function Og(c,u,E,R){var w=Ui();R=R===void 0?null:R;var U=w.memoizedState.inst;gi!==null&&R!==null&&s0(R,gi.memoizedState.deps)?w.memoizedState=dh(u,E,U,R):(Tn.flags|=c,w.memoizedState=dh(1|u,E,U,R))}function op(c,u){ap(8390656,8,c,u)}function Dg(c,u){Og(2048,8,c,u)}function uh(c,u){return Og(4,2,c,u)}function zT(c,u){return Og(4,4,c,u)}function XT(c,u){if(typeof u=="function"){c=c();var E=u(c);return function(){typeof E=="function"?E():u(null)}}if(u!=null)return c=c(),u.current=c,function(){u.current=null}}function JT(c,u,E){E=E!=null?E.concat([c]):null,Og(4,4,XT.bind(null,u,c),E)}function p0(){}function cp(c,u){var E=Ui();u=u===void 0?null:u;var R=E.memoizedState;return u!==null&&s0(u,R[1])?R[0]:(E.memoizedState=[c,u],c)}function QT(c,u){var E=Ui();u=u===void 0?null:u;var R=E.memoizedState;if(u!==null&&s0(u,R[1]))return R[0];if(R=c(),Mo){na(!0);try{c()}finally{na(!1)}}return E.memoizedState=[R,u],R}function Ng(c,u,E){return E===void 0||(ko&1073741824)!==0?c.memoizedState=u:(c.memoizedState=E,c=iS(),Tn.lanes|=c,Fc|=c,E)}function Lg(c,u,E,R){return wr(E,u)?E:rh.current!==null?(c=Ng(c,E,R),wr(c,u)||(xs=!0),c):(ko&42)===0?(xs=!0,c.memoizedState=E):(c=iS(),Tn.lanes|=c,Fc|=c,u)}function xg(c,u,E,R,w){var U=Be.p;Be.p=U!==0&&8>U?U:8;var J=_e.T,ae={};_e.T=ae,fh(c,!1,u,E);try{var me=w(),Ce=_e.S;if(Ce!==null&&Ce(ae,me),me!==null&&typeof me=="object"&&typeof me.then=="function"){var tt=OC(me,R);Ic(c,u,tt,gr(c))}else Ic(c,u,R,gr(c))}catch(_t){Ic(c,u,{then:function(){},status:"rejected",reason:_t},gr())}finally{Be.p=U,_e.T=J}}function LC(){}function m0(c,u,E,R){if(c.tag!==5)throw Error(o(476));var w=ZT(c).queue;xg(c,w,u,Et,E===null?LC:function(){return ev(c),E(R)})}function ZT(c){var u=c.memoizedState;if(u!==null)return u;u={memoizedState:Et,baseState:Et,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Cc,lastRenderedState:Et},next:null};var E={};return u.next={memoizedState:E,baseState:E,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Cc,lastRenderedState:E},next:null},c.memoizedState=u,c=c.alternate,c!==null&&(c.memoizedState=u),u}function ev(c){var u=ZT(c).next.queue;Ic(c,u,{},gr())}function g0(){return er(Mp)}function lp(){return Ui().memoizedState}function tv(){return Ui().memoizedState}function hh(c){for(var u=c.return;u!==null;){switch(u.tag){case 24:case 3:var E=gr();c=Pc(E);var R=Za(u,c,E);R!==null&&(bs(R,u,E),mh(R,u,E)),u={cache:e0()},c.payload=u;return}u=u.return}}function E0(c,u,E){var R=gr();E={lane:R,revertLane:0,action:E,hasEagerState:!1,eagerState:null,next:null},Pg(c)?_0(u,E):(E=$f(c,u,E,R),E!==null&&(bs(E,c,R),nv(E,u,R)))}function dp(c,u,E){var R=gr();Ic(c,u,E,R)}function Ic(c,u,E,R){var w={lane:R,revertLane:0,action:E,hasEagerState:!1,eagerState:null,next:null};if(Pg(c))_0(u,w);else{var U=c.alternate;if(c.lanes===0&&(U===null||U.lanes===0)&&(U=u.lastRenderedReducer,U!==null))try{var J=u.lastRenderedState,ae=U(J,E);if(w.hasEagerState=!0,w.eagerState=ae,wr(ae,J))return eh(c,u,w,0),vi===null&&Zu(),!1}catch{}finally{}if(E=$f(c,u,w,R),E!==null)return bs(E,c,R),nv(E,u,R),!0}return!1}function fh(c,u,E,R){if(R={lane:2,revertLane:uS(),action:R,hasEagerState:!1,eagerState:null,next:null},Pg(c)){if(u)throw Error(o(479))}else u=$f(c,E,R,2),u!==null&&bs(u,c,2)}function Pg(c){var u=c.alternate;return c===Tn||u!==null&&u===Tn}function _0(c,u){kd=tp=!0;var E=c.pending;E===null?u.next=u:(u.next=E.next,E.next=u),c.pending=u}function nv(c,u,E){if((E&4194176)!==0){var R=u.lanes;R&=c.pendingLanes,E|=R,u.lanes=E,Lu(c,E)}}var Ja={readContext:er,use:Cg,useCallback:fs,useContext:fs,useEffect:fs,useImperativeHandle:fs,useLayoutEffect:fs,useInsertionEffect:fs,useMemo:fs,useReducer:fs,useRef:fs,useState:fs,useDebugValue:fs,useDeferredValue:fs,useTransition:fs,useSyncExternalStore:fs,useId:fs};Ja.useCacheRefresh=fs,Ja.useMemoCache=fs,Ja.useHostTransitionStatus=fs,Ja.useFormState=fs,Ja.useActionState=fs,Ja.useOptimistic=fs;var Md={readContext:er,use:Cg,useCallback:function(c,u){return Dr().memoizedState=[c,u===void 0?null:u],c},useContext:er,useEffect:op,useImperativeHandle:function(c,u,E){E=E!=null?E.concat([c]):null,ap(4194308,4,XT.bind(null,u,c),E)},useLayoutEffect:function(c,u){return ap(4194308,4,c,u)},useInsertionEffect:function(c,u){ap(4,2,c,u)},useMemo:function(c,u){var E=Dr();u=u===void 0?null:u;var R=c();if(Mo){na(!0);try{c()}finally{na(!1)}}return E.memoizedState=[R,u],R},useReducer:function(c,u,E){var R=Dr();if(E!==void 0){var w=E(u);if(Mo){na(!0);try{E(u)}finally{na(!1)}}}else w=u;return R.memoizedState=R.baseState=w,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:w},R.queue=c,c=c.dispatch=E0.bind(null,Tn,c),[R.memoizedState,c]},useRef:function(c){var u=Dr();return c={current:c},u.memoizedState=c},useState:function(c){c=d0(c);var u=c.queue,E=dp.bind(null,Tn,u);return u.dispatch=E,[c.memoizedState,E]},useDebugValue:p0,useDeferredValue:function(c,u){var E=Dr();return Ng(E,c,u)},useTransition:function(){var c=d0(!1);return c=xg.bind(null,Tn,c.queue,!0,!1),Dr().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,u,E){var R=Tn,w=Dr();if(Yn){if(E===void 0)throw Error(o(407));E=E()}else{if(E=u(),vi===null)throw Error(o(349));(jn&60)!==0||rp(R,u,E)}w.memoizedState=E;var U={value:E,getSnapshot:u};return w.queue=U,op(UT.bind(null,R,U,c),[c]),R.flags|=2048,dh(9,MT.bind(null,R,U,E,u),{destroy:void 0},null),E},useId:function(){var c=Dr(),u=vi.identifierPrefix;if(Yn){var E=hr,R=Ts;E=(R&~(1<<32-Cr(R)-1)).toString(32)+E,u=":"+u+"R"+E,E=Dl++,0<E&&(u+="H"+E.toString(32)),u+=":"}else E=LT++,u=":"+u+"r"+E.toString(32)+":";return c.memoizedState=u},useCacheRefresh:function(){return Dr().memoizedState=hh.bind(null,Tn)}};Md.useMemoCache=Ig,Md.useHostTransitionStatus=g0,Md.useFormState=WT,Md.useActionState=WT,Md.useOptimistic=function(c){var u=Dr();u.memoizedState=u.baseState=c;var E={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return u.queue=E,u=fh.bind(null,Tn,!0,E),E.dispatch=u,[c,u]};var Nl={readContext:er,use:Cg,useCallback:cp,useContext:er,useEffect:Dg,useImperativeHandle:JT,useInsertionEffect:uh,useLayoutEffect:zT,useMemo:QT,useReducer:sp,useRef:$T,useState:function(){return sp(Cc)},useDebugValue:p0,useDeferredValue:function(c,u){var E=Ui();return Lg(E,gi.memoizedState,c,u)},useTransition:function(){var c=sp(Cc)[0],u=Ui().memoizedState;return[typeof c=="boolean"?c:ip(c),u]},useSyncExternalStore:kT,useId:lp};Nl.useCacheRefresh=tv,Nl.useMemoCache=Ig,Nl.useHostTransitionStatus=g0,Nl.useFormState=YT,Nl.useActionState=YT,Nl.useOptimistic=function(c,u){var E=Ui();return VT(E,gi,c,u)};var wc={readContext:er,use:Cg,useCallback:cp,useContext:er,useEffect:Dg,useImperativeHandle:JT,useInsertionEffect:uh,useLayoutEffect:zT,useMemo:QT,useReducer:l0,useRef:$T,useState:function(){return l0(Cc)},useDebugValue:p0,useDeferredValue:function(c,u){var E=Ui();return gi===null?Ng(E,c,u):Lg(E,gi.memoizedState,c,u)},useTransition:function(){var c=l0(Cc)[0],u=Ui().memoizedState;return[typeof c=="boolean"?c:ip(c),u]},useSyncExternalStore:kT,useId:lp};wc.useCacheRefresh=tv,wc.useMemoCache=Ig,wc.useHostTransitionStatus=g0,wc.useFormState=f0,wc.useActionState=f0,wc.useOptimistic=function(c,u){var E=Ui();return gi!==null?VT(E,gi,c,u):(E.baseState=c,[c,E.queue.dispatch])};function up(c,u,E,R){u=c.memoizedState,E=E(R,u),E=E==null?u:he({},u,E),c.memoizedState=E,c.lanes===0&&(c.updateQueue.baseState=E)}var S0={isMounted:function(c){return(c=c._reactInternals)?Ke(c)===c:!1},enqueueSetState:function(c,u,E){c=c._reactInternals;var R=gr(),w=Pc(R);w.payload=u,E!=null&&(w.callback=E),u=Za(c,w,R),u!==null&&(bs(u,c,R),mh(u,c,R))},enqueueReplaceState:function(c,u,E){c=c._reactInternals;var R=gr(),w=Pc(R);w.tag=1,w.payload=u,E!=null&&(w.callback=E),u=Za(c,w,R),u!==null&&(bs(u,c,R),mh(u,c,R))},enqueueForceUpdate:function(c,u){c=c._reactInternals;var E=gr(),R=Pc(E);R.tag=2,u!=null&&(R.callback=u),u=Za(c,R,E),u!==null&&(bs(u,c,E),mh(u,c,E))}};function iv(c,u,E,R,w,U,J){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(R,U,J):u.prototype&&u.prototype.isPureReactComponent?!Ld(E,R)||!Ld(w,U):!0}function y0(c,u,E,R){c=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(E,R),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(E,R),u.state!==c&&S0.enqueueReplaceState(u,u.state,null)}function Oc(c,u){var E=u;if("ref"in u){E={};for(var R in u)R!=="ref"&&(E[R]=u[R])}if(c=c.defaultProps){E===u&&(E=he({},E));for(var w in c)E[w]===void 0&&(E[w]=c[w])}return E}var kg=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var u=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(u))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)};function Qa(c){kg(c)}function Ud(c){console.error(c)}function Ll(c){kg(c)}function hp(c,u){try{var E=c.onUncaughtError;E(u.value,{componentStack:u.stack})}catch(R){setTimeout(function(){throw R})}}function T0(c,u,E){try{var R=c.onCaughtError;R(E.value,{componentStack:E.stack,errorBoundary:u.tag===1?u.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function Dc(c,u,E){return E=Pc(E),E.tag=3,E.payload={element:null},E.callback=function(){hp(c,u)},E}function Mg(c){return c=Pc(c),c.tag=3,c}function sv(c,u,E,R){var w=E.type.getDerivedStateFromError;if(typeof w=="function"){var U=R.value;c.payload=function(){return w(U)},c.callback=function(){T0(u,E,R)}}var J=E.stateNode;J!==null&&typeof J.componentDidCatch=="function"&&(c.callback=function(){T0(u,E,R),typeof w!="function"&&(jo===null?jo=new Set([this]):jo.add(this));var ae=R.stack;this.componentDidCatch(R.value,{componentStack:ae!==null?ae:""})})}function rv(c,u,E,R,w){if(E.flags|=32768,R!==null&&typeof R=="object"&&typeof R.then=="function"){if(u=E.alternate,u!==null&&pp(u,E,w,!0),E=Ca.current,E!==null){switch(E.tag){case 13:return Po===null?Ip():E.alternate===null&&Ji===0&&(Ji=3),E.flags&=-257,E.flags|=65536,E.lanes=w,R===Oi?E.flags|=16384:(u=E.updateQueue,u===null?E.updateQueue=new Set([R]):u.add(R),rS(c,R,w)),!1;case 22:return E.flags|=65536,R===Oi?E.flags|=16384:(u=E.updateQueue,u===null?(u={transitions:null,markerInstances:null,retryQueue:new Set([R])},E.updateQueue=u):(E=u.retryQueue,E===null?u.retryQueue=new Set([R]):E.add(R)),rS(c,R,w)),!1}throw Error(o(435,E.tag))}return rS(c,R,w),Ip(),!1}if(Yn)return u=Ca.current,u!==null?((u.flags&65536)===0&&(u.flags|=256),u.flags|=65536,u.lanes=w,R!==Rl&&(c=Error(o(422),{cause:R}),At(Zs(c,E)))):(R!==Rl&&(u=Error(o(423),{cause:R}),At(Zs(u,E))),c=c.current.alternate,c.flags|=65536,w&=-w,c.lanes|=w,R=Zs(R,E),w=Dc(c.stateNode,R,w),P0(c,w),Ji!==4&&(Ji=2)),!1;var U=Error(o(520),{cause:R});if(U=Zs(U,E),Ap===null?Ap=[U]:Ap.push(U),Ji!==4&&(Ji=2),u===null)return!0;R=Zs(R,E),E=u;do{switch(E.tag){case 3:return E.flags|=65536,c=w&-w,E.lanes|=c,c=Dc(E.stateNode,R,c),P0(E,c),!1;case 1:if(u=E.type,U=E.stateNode,(E.flags&128)===0&&(typeof u.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(jo===null||!jo.has(U))))return E.flags|=65536,w&=-w,E.lanes|=w,w=Mg(w),sv(w,c,E,R),P0(E,w),!1}E=E.return}while(E!==null);return!1}var av=Error(o(461)),xs=!1;function js(c,u,E,R){u.child=c===null?Sg(u,null,E,R):Il(u,c.child,E,R)}function ov(c,u,E,R,w){E=E.render;var U=u.ref;if("ref"in R){var J={};for(var ae in R)ae!=="ref"&&(J[ae]=R[ae])}else J=R;return Bd(u),R=Rg(c,u,E,J,U,w),ae=r0(),c!==null&&!xs?(a0(c,u,w),fr(c,u,w)):(Yn&&ae&&ih(u),u.flags|=1,js(c,u,R,w),u.child)}function Nc(c,u,E,R,w){if(c===null){var U=E.type;return typeof U=="function"&&!X0(U)&&U.defaultProps===void 0&&E.compare===null?(u.tag=15,u.type=U,cv(c,u,U,R,w)):(c=Wg(E.type,null,R,u,u.mode,w),c.ref=u.ref,c.return=u,u.child=c)}if(U=c.child,!D0(c,w)){var J=U.memoizedProps;if(E=E.compare,E=E!==null?E:Ld,E(J,R)&&c.ref===u.ref)return fr(c,u,w)}return u.flags|=1,c=Uc(U,R),c.ref=u.ref,c.return=u,u.child=c}function cv(c,u,E,R,w){if(c!==null){var U=c.memoizedProps;if(Ld(U,R)&&c.ref===u.ref)if(xs=!1,u.pendingProps=R=U,D0(c,w))(c.flags&131072)!==0&&(xs=!0);else return u.lanes=c.lanes,fr(c,u,w)}return Ug(c,u,E,R,w)}function lv(c,u,E){var R=u.pendingProps,w=R.children,U=(u.stateNode._pendingVisibility&2)!==0,J=c!==null?c.memoizedState:null;if(fp(c,u),R.mode==="hidden"||U){if((u.flags&128)!==0){if(R=J!==null?J.baseLanes|E:E,c!==null){for(w=u.child=c.child,U=0;w!==null;)U=U|w.lanes|w.childLanes,w=w.sibling;u.childLanes=U&~R}else u.childLanes=0,u.child=null;return dv(c,u,R,E)}if((E&536870912)!==0)u.memoizedState={baseLanes:0,cachePool:null},c!==null&&bg(u,J!==null?J.cachePool:null),J!==null?ah(u,J):J_(),OT(u);else return u.lanes=u.childLanes=536870912,dv(c,u,J!==null?J.baseLanes|E:E,E)}else J!==null?(bg(u,J.cachePool),ah(u,J),Rc(),u.memoizedState=null):(c!==null&&bg(u,null),J_(),Rc());return js(c,u,w,E),u.child}function dv(c,u,E,R){var w=i0();return w=w===null?null:{parent:rs._currentValue,pool:w},u.memoizedState={baseLanes:E,cachePool:w},c!==null&&bg(u,null),J_(),OT(u),c!==null&&pp(c,u,R,!0),null}function fp(c,u){var E=u.ref;if(E===null)c!==null&&c.ref!==null&&(u.flags|=2097664);else{if(typeof E!="function"&&typeof E!="object")throw Error(o(284));(c===null||c.ref!==E)&&(u.flags|=2097664)}}function Ug(c,u,E,R,w){return Bd(u),E=Rg(c,u,E,R,void 0,w),R=r0(),c!==null&&!xs?(a0(c,u,w),fr(c,u,w)):(Yn&&R&&ih(u),u.flags|=1,js(c,u,E,w),u.child)}function uv(c,u,E,R,w,U){return Bd(u),u.updateQueue=null,E=PT(u,R,E,w),xT(c),R=r0(),c!==null&&!xs?(a0(c,u,U),fr(c,u,U)):(Yn&&R&&ih(u),u.flags|=1,js(c,u,E,U),u.child)}function Fg(c,u,E,R,w){if(Bd(u),u.stateNode===null){var U=xo,J=E.contextType;typeof J=="object"&&J!==null&&(U=er(J)),U=new E(R,U),u.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,U.updater=S0,u.stateNode=U,U._reactInternals=u,U=u.stateNode,U.props=R,U.state=u.memoizedState,U.refs={},ph(u),J=E.contextType,U.context=typeof J=="object"&&J!==null?er(J):xo,U.state=u.memoizedState,J=E.getDerivedStateFromProps,typeof J=="function"&&(up(u,E,J,R),U.state=u.memoizedState),typeof E.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(J=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),J!==U.state&&S0.enqueueReplaceState(U,U.state,null),Ep(u,R,U,w),Vd(),U.state=u.memoizedState),typeof U.componentDidMount=="function"&&(u.flags|=4194308),R=!0}else if(c===null){U=u.stateNode;var ae=u.memoizedProps,me=Oc(E,ae);U.props=me;var Ce=U.context,tt=E.contextType;J=xo,typeof tt=="object"&&tt!==null&&(J=er(tt));var _t=E.getDerivedStateFromProps;tt=typeof _t=="function"||typeof U.getSnapshotBeforeUpdate=="function",ae=u.pendingProps!==ae,tt||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(ae||Ce!==J)&&y0(u,U,R,J),xl=!1;var Ve=u.memoizedState;U.state=Ve,Ep(u,R,U,w),Vd(),Ce=u.memoizedState,ae||Ve!==Ce||xl?(typeof _t=="function"&&(up(u,E,_t,R),Ce=u.memoizedState),(me=xl||iv(u,E,me,R,Ve,Ce,J))?(tt||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount()),typeof U.componentDidMount=="function"&&(u.flags|=4194308)):(typeof U.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=R,u.memoizedState=Ce),U.props=R,U.state=Ce,U.context=J,R=me):(typeof U.componentDidMount=="function"&&(u.flags|=4194308),R=!1)}else{U=u.stateNode,gp(c,u),J=u.memoizedProps,tt=Oc(E,J),U.props=tt,_t=u.pendingProps,Ve=U.context,Ce=E.contextType,me=xo,typeof Ce=="object"&&Ce!==null&&(me=er(Ce)),ae=E.getDerivedStateFromProps,(Ce=typeof ae=="function"||typeof U.getSnapshotBeforeUpdate=="function")||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(J!==_t||Ve!==me)&&y0(u,U,R,me),xl=!1,Ve=u.memoizedState,U.state=Ve,Ep(u,R,U,w),Vd();var Je=u.memoizedState;J!==_t||Ve!==Je||xl||c!==null&&c.dependencies!==null&&Vg(c.dependencies)?(typeof ae=="function"&&(up(u,E,ae,R),Je=u.memoizedState),(tt=xl||iv(u,E,tt,R,Ve,Je,me)||c!==null&&c.dependencies!==null&&Vg(c.dependencies))?(Ce||typeof U.UNSAFE_componentWillUpdate!="function"&&typeof U.componentWillUpdate!="function"||(typeof U.componentWillUpdate=="function"&&U.componentWillUpdate(R,Je,me),typeof U.UNSAFE_componentWillUpdate=="function"&&U.UNSAFE_componentWillUpdate(R,Je,me)),typeof U.componentDidUpdate=="function"&&(u.flags|=4),typeof U.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof U.componentDidUpdate!="function"||J===c.memoizedProps&&Ve===c.memoizedState||(u.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||J===c.memoizedProps&&Ve===c.memoizedState||(u.flags|=1024),u.memoizedProps=R,u.memoizedState=Je),U.props=R,U.state=Je,U.context=me,R=tt):(typeof U.componentDidUpdate!="function"||J===c.memoizedProps&&Ve===c.memoizedState||(u.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||J===c.memoizedProps&&Ve===c.memoizedState||(u.flags|=1024),R=!1)}return U=R,fp(c,u),R=(u.flags&128)!==0,U||R?(U=u.stateNode,E=R&&typeof E.getDerivedStateFromError!="function"?null:U.render(),u.flags|=1,c!==null&&R?(u.child=Il(u,c.child,null,w),u.child=Il(u,null,E,w)):js(c,u,E,w),u.memoizedState=U.state,c=u.child):c=fr(c,u,w),c}function v0(c,u,E,R){return Fe(),u.flags|=256,js(c,u,E,R),u.child}var b0={dehydrated:null,treeContext:null,retryLane:0};function Bg(c){return{baseLanes:c,cachePool:NT()}}function R0(c,u,E){return c=c!==null?c.childLanes&~E:0,u&&(c|=Hs),c}function hv(c,u,E){var R=u.pendingProps,w=!1,U=(u.flags&128)!==0,J;if((J=U)||(J=c!==null&&c.memoizedState===null?!1:(Ls.current&2)!==0),J&&(w=!0,u.flags&=-129),J=(u.flags&32)!==0,u.flags&=-33,c===null){if(Yn){if(w?wl(u):Rc(),Yn){var ae=ss,me;if(me=ae){e:{for(me=ae,ae=Aa;me.nodeType!==8;){if(!ae){ae=null;break e}if(me=Oa(me.nextSibling),me===null){ae=null;break e}}ae=me}ae!==null?(u.memoizedState={dehydrated:ae,treeContext:Tc!==null?{id:Ts,overflow:hr}:null,retryLane:536870912},me=ha(18,null,null,0),me.stateNode=ae,me.return=u,u.child=me,Vs=u,ss=null,me=!0):me=!1}me||P(u)}if(ae=u.memoizedState,ae!==null&&(ae=ae.dehydrated,ae!==null))return ae.data==="$!"?u.lanes=16:u.lanes=536870912,null;Ac(u)}return ae=R.children,R=R.fallback,w?(Rc(),w=u.mode,ae=C0({mode:"hidden",children:ae},w),R=Ul(R,w,E,null),ae.return=u,R.return=u,ae.sibling=R,u.child=ae,w=u.child,w.memoizedState=Bg(E),w.childLanes=R0(c,J,E),u.memoizedState=b0,R):(wl(u),A0(u,ae))}if(me=c.memoizedState,me!==null&&(ae=me.dehydrated,ae!==null)){if(U)u.flags&256?(wl(u),u.flags&=-257,u=I0(c,u,E)):u.memoizedState!==null?(Rc(),u.child=c.child,u.flags|=128,u=null):(Rc(),w=R.fallback,ae=u.mode,R=C0({mode:"visible",children:R.children},ae),w=Ul(w,ae,E,null),w.flags|=2,R.return=u,w.return=u,R.sibling=w,u.child=R,Il(u,c.child,null,E),R=u.child,R.memoizedState=Bg(E),R.childLanes=R0(c,J,E),u.memoizedState=b0,u=w);else if(wl(u),ae.data==="$!"){if(J=ae.nextSibling&&ae.nextSibling.dataset,J)var Ce=J.dgst;J=Ce,R=Error(o(419)),R.stack="",R.digest=J,At({value:R,source:null,stack:null}),u=I0(c,u,E)}else if(xs||pp(c,u,E,!1),J=(E&c.childLanes)!==0,xs||J){if(J=vi,J!==null){if(R=E&-E,(R&42)!==0)R=1;else switch(R){case 2:R=1;break;case 8:R=4;break;case 32:R=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:R=64;break;case 268435456:R=134217728;break;default:R=0}if(R=(R&(J.suspendedLanes|E))!==0?0:R,R!==0&&R!==me.retryLane)throw me.retryLane=R,Lo(c,R),bs(J,c,R),av}ae.data==="$?"||Ip(),u=I0(c,u,E)}else ae.data==="$?"?(u.flags|=128,u.child=c.child,u=jC.bind(null,c),ae._reactRetry=u,u=null):(c=me.treeContext,ss=Oa(ae.nextSibling),Vs=u,Yn=!0,la=null,Aa=!1,c!==null&&(Or[Gr++]=Ts,Or[Gr++]=hr,Or[Gr++]=Tc,Ts=c.id,hr=c.overflow,Tc=u),u=A0(u,R.children),u.flags|=4096);return u}return w?(Rc(),w=R.fallback,ae=u.mode,me=c.child,Ce=me.sibling,R=Uc(me,{mode:"hidden",children:R.children}),R.subtreeFlags=me.subtreeFlags&31457280,Ce!==null?w=Uc(Ce,w):(w=Ul(w,ae,E,null),w.flags|=2),w.return=u,R.return=u,R.sibling=w,u.child=R,R=w,w=u.child,ae=c.child.memoizedState,ae===null?ae=Bg(E):(me=ae.cachePool,me!==null?(Ce=rs._currentValue,me=me.parent!==Ce?{parent:Ce,pool:Ce}:me):me=NT(),ae={baseLanes:ae.baseLanes|E,cachePool:me}),w.memoizedState=ae,w.childLanes=R0(c,J,E),u.memoizedState=b0,R):(wl(u),E=c.child,c=E.sibling,E=Uc(E,{mode:"visible",children:R.children}),E.return=u,E.sibling=null,c!==null&&(J=u.deletions,J===null?(u.deletions=[c],u.flags|=16):J.push(c)),u.child=E,u.memoizedState=null,E)}function A0(c,u){return u=C0({mode:"visible",children:u},c.mode),u.return=c,c.child=u}function C0(c,u){return bv(c,u,0,null)}function I0(c,u,E){return Il(u,c.child,null,E),c=A0(u,u.pendingProps.children),c.flags|=2,u.memoizedState=null,c}function fv(c,u,E){c.lanes|=u;var R=c.alternate;R!==null&&(R.lanes|=u),L0(c.return,u,E)}function w0(c,u,E,R,w){var U=c.memoizedState;U===null?c.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:R,tail:E,tailMode:w}:(U.isBackwards=u,U.rendering=null,U.renderingStartTime=0,U.last=R,U.tail=E,U.tailMode=w)}function O0(c,u,E){var R=u.pendingProps,w=R.revealOrder,U=R.tail;if(js(c,u,R.children,E),R=Ls.current,(R&2)!==0)R=R&1|2,u.flags|=128;else{if(c!==null&&(c.flags&128)!==0)e:for(c=u.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&fv(c,E,u);else if(c.tag===19)fv(c,E,u);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===u)break e;for(;c.sibling===null;){if(c.return===null||c.return===u)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}R&=1}switch(bt(Ls,R),w){case"forwards":for(E=u.child,w=null;E!==null;)c=E.alternate,c!==null&&Tg(c)===null&&(w=E),E=E.sibling;E=w,E===null?(w=u.child,u.child=null):(w=E.sibling,E.sibling=null),w0(u,!1,w,E,U);break;case"backwards":for(E=null,w=u.child,u.child=null;w!==null;){if(c=w.alternate,c!==null&&Tg(c)===null){u.child=w;break}c=w.sibling,w.sibling=E,E=w,w=c}w0(u,!0,E,null,U);break;case"together":w0(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function fr(c,u,E){if(c!==null&&(u.dependencies=c.dependencies),Fc|=u.lanes,(E&u.childLanes)===0)if(c!==null){if(pp(c,u,E,!1),(E&u.childLanes)===0)return null}else return null;if(c!==null&&u.child!==c.child)throw Error(o(153));if(u.child!==null){for(c=u.child,E=Uc(c,c.pendingProps),u.child=E,E.return=u;c.sibling!==null;)c=c.sibling,E=E.sibling=Uc(c,c.pendingProps),E.return=u;E.sibling=null}return u.child}function D0(c,u){return(c.lanes&u)!==0?!0:(c=c.dependencies,!!(c!==null&&Vg(c)))}function xC(c,u,E){switch(u.tag){case 3:Ws(u,u.stateNode.containerInfo),Uo(u,rs,c.memoizedState.cache),Fe();break;case 27:case 5:$n(u);break;case 4:Ws(u,u.stateNode.containerInfo);break;case 10:Uo(u,u.type,u.memoizedProps.value);break;case 13:var R=u.memoizedState;if(R!==null)return R.dehydrated!==null?(wl(u),u.flags|=128,null):(E&u.child.childLanes)!==0?hv(c,u,E):(wl(u),c=fr(c,u,E),c!==null?c.sibling:null);wl(u);break;case 19:var w=(c.flags&128)!==0;if(R=(E&u.childLanes)!==0,R||(pp(c,u,E,!1),R=(E&u.childLanes)!==0),w){if(R)return O0(c,u,E);u.flags|=128}if(w=u.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),bt(Ls,Ls.current),R)break;return null;case 22:case 23:return u.lanes=0,lv(c,u,E);case 24:Uo(u,rs,c.memoizedState.cache)}return fr(c,u,E)}function pv(c,u,E){if(c!==null)if(c.memoizedProps!==u.pendingProps)xs=!0;else{if(!D0(c,E)&&(u.flags&128)===0)return xs=!1,xC(c,u,E);xs=(c.flags&131072)!==0}else xs=!1,Yn&&(u.flags&1048576)!==0&&zf(u,Pd,u.index);switch(u.lanes=0,u.tag){case 16:e:{c=u.pendingProps;var R=u.elementType,w=R._init;if(R=w(R._payload),u.type=R,typeof R=="function")X0(R)?(c=Oc(R,c),u.tag=1,u=Fg(null,u,R,c,E)):(u.tag=0,u=Ug(null,u,R,c,E));else{if(R!=null){if(w=R.$$typeof,w===x){u.tag=11,u=ov(null,u,R,c,E);break e}else if(w===Q){u.tag=14,u=Nc(null,u,R,c,E);break e}}throw u=Te(R)||R,Error(o(306,u,""))}}return u;case 0:return Ug(c,u,u.type,u.pendingProps,E);case 1:return R=u.type,w=Oc(R,u.pendingProps),Fg(c,u,R,w,E);case 3:e:{if(Ws(u,u.stateNode.containerInfo),c===null)throw Error(o(387));var U=u.pendingProps;w=u.memoizedState,R=w.element,gp(c,u),Ep(u,U,null,E);var J=u.memoizedState;if(U=J.cache,Uo(u,rs,U),U!==w.cache&&x0(u,[rs],E,!0),Vd(),U=J.element,w.isDehydrated)if(w={element:U,isDehydrated:!1,cache:J.cache},u.updateQueue.baseState=w,u.memoizedState=w,u.flags&256){u=v0(c,u,U,E);break e}else if(U!==R){R=Zs(Error(o(424)),u),At(R),u=v0(c,u,U,E);break e}else for(ss=Oa(u.stateNode.containerInfo.firstChild),Vs=u,Yn=!0,la=null,Aa=!0,E=Sg(u,null,U,E),u.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(Fe(),U===R){u=fr(c,u,E);break e}js(c,u,U,E)}u=u.child}return u;case 26:return fp(c,u),c===null?(E=AS(u.type,null,u.pendingProps,null))?u.memoizedState=E:Yn||(E=u.type,c=u.pendingProps,R=uE(ei.current).createElement(E),R[Fs]=u,R[_n]=c,tr(R,E,c),ys(R),u.stateNode=R):u.memoizedState=AS(u.type,c.memoizedProps,u.pendingProps,c.memoizedState),null;case 27:return $n(u),c===null&&Yn&&(R=u.stateNode=Kv(u.type,u.pendingProps,ei.current),Vs=u,Aa=!0,ss=Oa(R.firstChild)),R=u.pendingProps.children,c!==null||Yn?js(c,u,R,E):u.child=Il(u,null,R,E),fp(c,u),u.child;case 5:return c===null&&Yn&&((w=R=ss)&&(R=$C(R,u.type,u.pendingProps,Aa),R!==null?(u.stateNode=R,Vs=u,ss=Oa(R.firstChild),Aa=!1,w=!0):w=!1),w||P(u)),$n(u),w=u.type,U=u.pendingProps,J=c!==null?c.memoizedProps:null,R=U.children,TS(w,U)?R=null:J!==null&&TS(w,J)&&(u.flags|=32),u.memoizedState!==null&&(w=Rg(c,u,DC,null,null,E),Mp._currentValue=w),fp(c,u),js(c,u,R,E),u.child;case 6:return c===null&&Yn&&((c=E=ss)&&(E=zC(E,u.pendingProps,Aa),E!==null?(u.stateNode=E,Vs=u,ss=null,c=!0):c=!1),c||P(u)),null;case 13:return hv(c,u,E);case 4:return Ws(u,u.stateNode.containerInfo),R=u.pendingProps,c===null?u.child=Il(u,null,R,E):js(c,u,R,E),u.child;case 11:return ov(c,u,u.type,u.pendingProps,E);case 7:return js(c,u,u.pendingProps,E),u.child;case 8:return js(c,u,u.pendingProps.children,E),u.child;case 12:return js(c,u,u.pendingProps.children,E),u.child;case 10:return R=u.pendingProps,Uo(u,u.type,R.value),js(c,u,R.children,E),u.child;case 9:return w=u.type._context,R=u.pendingProps.children,Bd(u),w=er(w),R=R(w),u.flags|=1,js(c,u,R,E),u.child;case 14:return Nc(c,u,u.type,u.pendingProps,E);case 15:return cv(c,u,u.type,u.pendingProps,E);case 19:return O0(c,u,E);case 22:return lv(c,u,E);case 24:return Bd(u),R=er(rs),c===null?(w=i0(),w===null&&(w=vi,U=e0(),w.pooledCache=U,U.refCount++,U!==null&&(w.pooledCacheLanes|=E),w=U),u.memoizedState={parent:R,cache:w},ph(u),Uo(u,rs,w)):((c.lanes&E)!==0&&(gp(c,u),Ep(u,null,null,E),Vd()),w=c.memoizedState,U=u.memoizedState,w.parent!==R?(w={parent:R,cache:R},u.memoizedState=w,u.lanes===0&&(u.memoizedState=u.updateQueue.baseState=w),Uo(u,rs,R)):(R=U.cache,Uo(u,rs,R),R!==w.cache&&x0(u,[rs],E,!0))),js(c,u,u.pendingProps.children,E),u.child;case 29:throw u.pendingProps}throw Error(o(156,u.tag))}var N0=Ze(null),Fd=null,Lc=null;function Uo(c,u,E){bt(N0,u._currentValue),u._currentValue=E}function xc(c){c._currentValue=N0.current,mt(N0)}function L0(c,u,E){for(;c!==null;){var R=c.alternate;if((c.childLanes&u)!==u?(c.childLanes|=u,R!==null&&(R.childLanes|=u)):R!==null&&(R.childLanes&u)!==u&&(R.childLanes|=u),c===E)break;c=c.return}}function x0(c,u,E,R){var w=c.child;for(w!==null&&(w.return=c);w!==null;){var U=w.dependencies;if(U!==null){var J=w.child;U=U.firstContext;e:for(;U!==null;){var ae=U;U=w;for(var me=0;me<u.length;me++)if(ae.context===u[me]){U.lanes|=E,ae=U.alternate,ae!==null&&(ae.lanes|=E),L0(U.return,E,c),R||(J=null);break e}U=ae.next}}else if(w.tag===18){if(J=w.return,J===null)throw Error(o(341));J.lanes|=E,U=J.alternate,U!==null&&(U.lanes|=E),L0(J,E,c),J=null}else J=w.child;if(J!==null)J.return=w;else for(J=w;J!==null;){if(J===c){J=null;break}if(w=J.sibling,w!==null){w.return=J.return,J=w;break}J=J.return}w=J}}function pp(c,u,E,R){c=null;for(var w=u,U=!1;w!==null;){if(!U){if((w.flags&524288)!==0)U=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var J=w.alternate;if(J===null)throw Error(o(387));if(J=J.memoizedProps,J!==null){var ae=w.type;wr(w.pendingProps.value,J.value)||(c!==null?c.push(ae):c=[ae])}}else if(w===ri.current){if(J=w.alternate,J===null)throw Error(o(387));J.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(c!==null?c.push(Mp):c=[Mp])}w=w.return}c!==null&&x0(u,c,E,R),u.flags|=262144}function Vg(c){for(c=c.firstContext;c!==null;){if(!wr(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function Bd(c){Fd=c,Lc=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function er(c){return mv(Fd,c)}function mp(c,u){return Fd===null&&Bd(c),mv(c,u)}function mv(c,u){var E=u._currentValue;if(u={context:u,memoizedValue:E,next:null},Lc===null){if(c===null)throw Error(o(308));Lc=u,c.dependencies={lanes:0,firstContext:u},c.flags|=524288}else Lc=Lc.next=u;return E}var xl=!1;function ph(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function gp(c,u){c=c.updateQueue,u.updateQueue===c&&(u.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function Pc(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function Za(c,u,E){var R=c.updateQueue;if(R===null)return null;if(R=R.shared,(Gi&2)!==0){var w=R.pending;return w===null?u.next=u:(u.next=w.next,w.next=u),R.pending=u,u=ba(c),th(c,null,E),u}return eh(c,R,u,E),ba(c)}function mh(c,u,E){if(u=u.updateQueue,u!==null&&(u=u.shared,(E&4194176)!==0)){var R=u.lanes;R&=c.pendingLanes,E|=R,u.lanes=E,Lu(c,E)}}function P0(c,u){var E=c.updateQueue,R=c.alternate;if(R!==null&&(R=R.updateQueue,E===R)){var w=null,U=null;if(E=E.firstBaseUpdate,E!==null){do{var J={lane:E.lane,tag:E.tag,payload:E.payload,callback:null,next:null};U===null?w=U=J:U=U.next=J,E=E.next}while(E!==null);U===null?w=U=u:U=U.next=u}else w=U=u;E={baseState:R.baseState,firstBaseUpdate:w,lastBaseUpdate:U,shared:R.shared,callbacks:R.callbacks},c.updateQueue=E;return}c=E.lastBaseUpdate,c===null?E.firstBaseUpdate=u:c.next=u,E.lastBaseUpdate=u}var jg=!1;function Vd(){if(jg){var c=ch;if(c!==null)throw c}}function Ep(c,u,E,R){jg=!1;var w=c.updateQueue;xl=!1;var U=w.firstBaseUpdate,J=w.lastBaseUpdate,ae=w.shared.pending;if(ae!==null){w.shared.pending=null;var me=ae,Ce=me.next;me.next=null,J===null?U=Ce:J.next=Ce,J=me;var tt=c.alternate;tt!==null&&(tt=tt.updateQueue,ae=tt.lastBaseUpdate,ae!==J&&(ae===null?tt.firstBaseUpdate=Ce:ae.next=Ce,tt.lastBaseUpdate=me))}if(U!==null){var _t=w.baseState;J=0,tt=Ce=me=null,ae=U;do{var Ve=ae.lane&-536870913,Je=Ve!==ae.lane;if(Je?(jn&Ve)===Ve:(R&Ve)===Ve){Ve!==0&&Ve===oh&&(jg=!0),tt!==null&&(tt=tt.next={lane:0,tag:ae.tag,payload:ae.payload,callback:null,next:null});e:{var Bt=c,hn=ae;Ve=u;var $i=E;switch(hn.tag){case 1:if(Bt=hn.payload,typeof Bt=="function"){_t=Bt.call($i,_t,Ve);break e}_t=Bt;break e;case 3:Bt.flags=Bt.flags&-65537|128;case 0:if(Bt=hn.payload,Ve=typeof Bt=="function"?Bt.call($i,_t,Ve):Bt,Ve==null)break e;_t=he({},_t,Ve);break e;case 2:xl=!0}}Ve=ae.callback,Ve!==null&&(c.flags|=64,Je&&(c.flags|=8192),Je=w.callbacks,Je===null?w.callbacks=[Ve]:Je.push(Ve))}else Je={lane:Ve,tag:ae.tag,payload:ae.payload,callback:ae.callback,next:null},tt===null?(Ce=tt=Je,me=_t):tt=tt.next=Je,J|=Ve;if(ae=ae.next,ae===null){if(ae=w.shared.pending,ae===null)break;Je=ae,ae=Je.next,Je.next=null,w.lastBaseUpdate=Je,w.shared.pending=null}}while(!0);tt===null&&(me=_t),w.baseState=me,w.firstBaseUpdate=Ce,w.lastBaseUpdate=tt,U===null&&(w.shared.lanes=0),Fc|=J,c.lanes=J,c.memoizedState=_t}}function k0(c,u){if(typeof c!="function")throw Error(o(191,c));c.call(u)}function M0(c,u){var E=c.callbacks;if(E!==null)for(c.callbacks=null,c=0;c<E.length;c++)k0(E[c],u)}function _p(c,u){try{var E=u.updateQueue,R=E!==null?E.lastEffect:null;if(R!==null){var w=R.next;E=w;do{if((E.tag&c)===c){R=void 0;var U=E.create,J=E.inst;R=U(),J.destroy=R}E=E.next}while(E!==w)}}catch(ae){ai(u,u.return,ae)}}function kc(c,u,E){try{var R=u.updateQueue,w=R!==null?R.lastEffect:null;if(w!==null){var U=w.next;R=U;do{if((R.tag&c)===c){var J=R.inst,ae=J.destroy;if(ae!==void 0){J.destroy=void 0,w=u;var me=E;try{ae()}catch(Ce){ai(w,me,Ce)}}}R=R.next}while(R!==U)}}catch(Ce){ai(u,u.return,Ce)}}function U0(c){var u=c.updateQueue;if(u!==null){var E=c.stateNode;try{M0(u,E)}catch(R){ai(c,c.return,R)}}}function gv(c,u,E){E.props=Oc(c.type,c.memoizedProps),E.state=c.memoizedState;try{E.componentWillUnmount()}catch(R){ai(c,u,R)}}function jd(c,u){try{var E=c.ref;if(E!==null){var R=c.stateNode;switch(c.tag){case 26:case 27:case 5:var w=R;break;default:w=R}typeof E=="function"?c.refCleanup=E(w):E.current=w}}catch(U){ai(c,u,U)}}function da(c,u){var E=c.ref,R=c.refCleanup;if(E!==null)if(typeof R=="function")try{R()}catch(w){ai(c,u,w)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof E=="function")try{E(null)}catch(w){ai(c,u,w)}else E.current=null}function Sp(c){var u=c.type,E=c.memoizedProps,R=c.stateNode;try{e:switch(u){case"button":case"input":case"select":case"textarea":E.autoFocus&&R.focus();break e;case"img":E.src?R.src=E.src:E.srcSet&&(R.srcset=E.srcSet)}}catch(w){ai(c,c.return,w)}}function Ev(c,u,E){try{var R=c.stateNode;dE(R,c.type,E,u),R[_n]=u}catch(w){ai(c,c.return,w)}}function _v(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27||c.tag===4}function F0(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||_v(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==27&&c.tag!==18;){if(c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function Gg(c,u,E){var R=c.tag;if(R===5||R===6)c=c.stateNode,u?E.nodeType===8?E.parentNode.insertBefore(c,u):E.insertBefore(c,u):(E.nodeType===8?(u=E.parentNode,u.insertBefore(c,E)):(u=E,u.appendChild(c)),E=E._reactRootContainer,E!=null||u.onclick!==null||(u.onclick=lE));else if(R!==4&&R!==27&&(c=c.child,c!==null))for(Gg(c,u,E),c=c.sibling;c!==null;)Gg(c,u,E),c=c.sibling}function Hg(c,u,E){var R=c.tag;if(R===5||R===6)c=c.stateNode,u?E.insertBefore(c,u):E.appendChild(c);else if(R!==4&&R!==27&&(c=c.child,c!==null))for(Hg(c,u,E),c=c.sibling;c!==null;)Hg(c,u,E),c=c.sibling}var Mc=!1,qi=!1,B0=!1,Kg=typeof WeakSet=="function"?WeakSet:Set,Gs=null,V0=!1;function PC(c,u){if(c=c.containerInfo,SS=Up,c=fg(c),Qs(c)){if("selectionStart"in c)var E={start:c.selectionStart,end:c.selectionEnd};else e:{E=(E=c.ownerDocument)&&E.defaultView||window;var R=E.getSelection&&E.getSelection();if(R&&R.rangeCount!==0){E=R.anchorNode;var w=R.anchorOffset,U=R.focusNode;R=R.focusOffset;try{E.nodeType,U.nodeType}catch{E=null;break e}var J=0,ae=-1,me=-1,Ce=0,tt=0,_t=c,Ve=null;t:for(;;){for(var Je;_t!==E||w!==0&&_t.nodeType!==3||(ae=J+w),_t!==U||R!==0&&_t.nodeType!==3||(me=J+R),_t.nodeType===3&&(J+=_t.nodeValue.length),(Je=_t.firstChild)!==null;)Ve=_t,_t=Je;for(;;){if(_t===c)break t;if(Ve===E&&++Ce===w&&(ae=J),Ve===U&&++tt===R&&(me=J),(Je=_t.nextSibling)!==null)break;_t=Ve,Ve=_t.parentNode}_t=Je}E=ae===-1||me===-1?null:{start:ae,end:me}}else E=null}E=E||{start:0,end:0}}else E=null;for(yS={focusedElem:c,selectionRange:E},Up=!1,Gs=u;Gs!==null;)if(u=Gs,c=u.child,(u.subtreeFlags&1028)!==0&&c!==null)c.return=u,Gs=c;else for(;Gs!==null;){switch(u=Gs,U=u.alternate,c=u.flags,u.tag){case 0:break;case 11:case 15:break;case 1:if((c&1024)!==0&&U!==null){c=void 0,E=u,w=U.memoizedProps,U=U.memoizedState,R=E.stateNode;try{var Bt=Oc(E.type,w,E.elementType===E.type);c=R.getSnapshotBeforeUpdate(Bt,U),R.__reactInternalSnapshotBeforeUpdate=c}catch(hn){ai(E,E.return,hn)}}break;case 3:if((c&1024)!==0){if(c=u.stateNode.containerInfo,E=c.nodeType,E===9)RS(c);else if(E===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":RS(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(o(163))}if(c=u.sibling,c!==null){c.return=u.return,Gs=c;break}Gs=u.return}return Bt=V0,V0=!1,Bt}function Sv(c,u,E){var R=E.flags;switch(E.tag){case 0:case 11:case 15:Bo(c,E),R&4&&_p(5,E);break;case 1:if(Bo(c,E),R&4)if(c=E.stateNode,u===null)try{c.componentDidMount()}catch(ae){ai(E,E.return,ae)}else{var w=Oc(E.type,u.memoizedProps);u=u.memoizedState;try{c.componentDidUpdate(w,u,c.__reactInternalSnapshotBeforeUpdate)}catch(ae){ai(E,E.return,ae)}}R&64&&U0(E),R&512&&jd(E,E.return);break;case 3:if(Bo(c,E),R&64&&(R=E.updateQueue,R!==null)){if(c=null,E.child!==null)switch(E.child.tag){case 27:case 5:c=E.child.stateNode;break;case 1:c=E.child.stateNode}try{M0(R,c)}catch(ae){ai(E,E.return,ae)}}break;case 26:Bo(c,E),R&512&&jd(E,E.return);break;case 27:case 5:Bo(c,E),u===null&&R&4&&Sp(E),R&512&&jd(E,E.return);break;case 12:Bo(c,E);break;case 13:Bo(c,E),R&4&&G0(c,E);break;case 22:if(w=E.memoizedState!==null||Mc,!w){u=u!==null&&u.memoizedState!==null||qi;var U=Mc,J=qi;Mc=w,(qi=u)&&!J?eo(c,E,(E.subtreeFlags&8772)!==0):Bo(c,E),Mc=U,qi=J}R&512&&(E.memoizedProps.mode==="manual"?jd(E,E.return):da(E,E.return));break;default:Bo(c,E)}}function j0(c){var u=c.alternate;u!==null&&(c.alternate=null,j0(u)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(u=c.stateNode,u!==null&&Ta(u)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var vs=null,ua=!1;function Fo(c,u,E){for(E=E.child;E!==null;)yv(c,u,E),E=E.sibling}function yv(c,u,E){if(qs&&typeof qs.onCommitFiberUnmount=="function")try{qs.onCommitFiberUnmount(ul,E)}catch{}switch(E.tag){case 26:qi||da(E,u),Fo(c,u,E),E.memoizedState?E.memoizedState.count--:E.stateNode&&(E=E.stateNode,E.parentNode.removeChild(E));break;case 27:qi||da(E,u);var R=vs,w=ua;for(vs=E.stateNode,Fo(c,u,E),E=E.stateNode,u=E.attributes;u.length;)E.removeAttributeNode(u[0]);Ta(E),vs=R,ua=w;break;case 5:qi||da(E,u);case 6:w=vs;var U=ua;if(vs=null,Fo(c,u,E),vs=w,ua=U,vs!==null)if(ua)try{c=vs,R=E.stateNode,c.nodeType===8?c.parentNode.removeChild(R):c.removeChild(R)}catch(J){ai(E,u,J)}else try{vs.removeChild(E.stateNode)}catch(J){ai(E,u,J)}break;case 18:vs!==null&&(ua?(u=vs,E=E.stateNode,u.nodeType===8?bS(u.parentNode,E):u.nodeType===1&&bS(u,E),Gp(u)):bS(vs,E.stateNode));break;case 4:R=vs,w=ua,vs=E.stateNode.containerInfo,ua=!0,Fo(c,u,E),vs=R,ua=w;break;case 0:case 11:case 14:case 15:qi||kc(2,E,u),qi||kc(4,E,u),Fo(c,u,E);break;case 1:qi||(da(E,u),R=E.stateNode,typeof R.componentWillUnmount=="function"&&gv(E,u,R)),Fo(c,u,E);break;case 21:Fo(c,u,E);break;case 22:qi||da(E,u),qi=(R=qi)||E.memoizedState!==null,Fo(c,u,E),qi=R;break;default:Fo(c,u,E)}}function G0(c,u){if(u.memoizedState===null&&(c=u.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{Gp(c)}catch(E){ai(u,u.return,E)}}function H0(c){switch(c.tag){case 13:case 19:var u=c.stateNode;return u===null&&(u=c.stateNode=new Kg),u;case 22:return c=c.stateNode,u=c._retryCache,u===null&&(u=c._retryCache=new Kg),u;default:throw Error(o(435,c.tag))}}function K0(c,u){var E=H0(c);u.forEach(function(R){var w=aS.bind(null,c,R);E.has(R)||(E.add(R),R.then(w,w))})}function Ia(c,u){var E=u.deletions;if(E!==null)for(var R=0;R<E.length;R++){var w=E[R],U=c,J=u,ae=J;e:for(;ae!==null;){switch(ae.tag){case 27:case 5:vs=ae.stateNode,ua=!1;break e;case 3:vs=ae.stateNode.containerInfo,ua=!0;break e;case 4:vs=ae.stateNode.containerInfo,ua=!0;break e}ae=ae.return}if(vs===null)throw Error(o(160));yv(U,J,w),vs=null,ua=!1,U=w.alternate,U!==null&&(U.return=null),w.return=null}if(u.subtreeFlags&13878)for(u=u.child;u!==null;)W0(u,c),u=u.sibling}var Nr=null;function W0(c,u){var E=c.alternate,R=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:Ia(u,c),pr(c),R&4&&(kc(3,c,c.return),_p(3,c),kc(5,c,c.return));break;case 1:Ia(u,c),pr(c),R&512&&(qi||E===null||da(E,E.return)),R&64&&Mc&&(c=c.updateQueue,c!==null&&(R=c.callbacks,R!==null&&(E=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=E===null?R:E.concat(R))));break;case 26:var w=Nr;if(Ia(u,c),pr(c),R&512&&(qi||E===null||da(E,E.return)),R&4){var U=E!==null?E.memoizedState:null;if(R=c.memoizedState,E===null)if(R===null)if(c.stateNode===null){e:{R=c.type,E=c.memoizedProps,w=w.ownerDocument||w;t:switch(R){case"title":U=w.getElementsByTagName("title")[0],(!U||U[fl]||U[Fs]||U.namespaceURI==="http://www.w3.org/2000/svg"||U.hasAttribute("itemprop"))&&(U=w.createElement(R),w.head.insertBefore(U,w.querySelector("head > title"))),tr(U,R,E),U[Fs]=c,ys(U),R=U;break e;case"link":var J=$v("link","href",w).get(R+(E.href||""));if(J){for(var ae=0;ae<J.length;ae++)if(U=J[ae],U.getAttribute("href")===(E.href==null?null:E.href)&&U.getAttribute("rel")===(E.rel==null?null:E.rel)&&U.getAttribute("title")===(E.title==null?null:E.title)&&U.getAttribute("crossorigin")===(E.crossOrigin==null?null:E.crossOrigin)){J.splice(ae,1);break t}}U=w.createElement(R),tr(U,R,E),w.head.appendChild(U);break;case"meta":if(J=$v("meta","content",w).get(R+(E.content||""))){for(ae=0;ae<J.length;ae++)if(U=J[ae],U.getAttribute("content")===(E.content==null?null:""+E.content)&&U.getAttribute("name")===(E.name==null?null:E.name)&&U.getAttribute("property")===(E.property==null?null:E.property)&&U.getAttribute("http-equiv")===(E.httpEquiv==null?null:E.httpEquiv)&&U.getAttribute("charset")===(E.charSet==null?null:E.charSet)){J.splice(ae,1);break t}}U=w.createElement(R),tr(U,R,E),w.head.appendChild(U);break;default:throw Error(o(468,R))}U[Fs]=c,ys(U),R=U}c.stateNode=R}else zv(w,c.type,c.stateNode);else c.stateNode=CS(w,R,c.memoizedProps);else U!==R?(U===null?E.stateNode!==null&&(E=E.stateNode,E.parentNode.removeChild(E)):U.count--,R===null?zv(w,c.type,c.stateNode):CS(w,R,c.memoizedProps)):R===null&&c.stateNode!==null&&Ev(c,c.memoizedProps,E.memoizedProps)}break;case 27:if(R&4&&c.alternate===null){w=c.stateNode,U=c.memoizedProps;try{for(var me=w.firstChild;me;){var Ce=me.nextSibling,tt=me.nodeName;me[fl]||tt==="HEAD"||tt==="BODY"||tt==="SCRIPT"||tt==="STYLE"||tt==="LINK"&&me.rel.toLowerCase()==="stylesheet"||w.removeChild(me),me=Ce}for(var _t=c.type,Ve=w.attributes;Ve.length;)w.removeAttributeNode(Ve[0]);tr(w,_t,U),w[Fs]=c,w[_n]=U}catch(Bt){ai(c,c.return,Bt)}}case 5:if(Ia(u,c),pr(c),R&512&&(qi||E===null||da(E,E.return)),c.flags&32){w=c.stateNode;try{Ro(w,"")}catch(Bt){ai(c,c.return,Bt)}}R&4&&c.stateNode!=null&&(w=c.memoizedProps,Ev(c,w,E!==null?E.memoizedProps:w)),R&1024&&(B0=!0);break;case 6:if(Ia(u,c),pr(c),R&4){if(c.stateNode===null)throw Error(o(162));R=c.memoizedProps,E=c.stateNode;try{E.nodeValue=R}catch(Bt){ai(c,c.return,Bt)}}break;case 3:if(pE=null,w=Nr,Nr=hE(u.containerInfo),Ia(u,c),Nr=w,pr(c),R&4&&E!==null&&E.memoizedState.isDehydrated)try{Gp(u.containerInfo)}catch(Bt){ai(c,c.return,Bt)}B0&&(B0=!1,Gd(c));break;case 4:R=Nr,Nr=hE(c.stateNode.containerInfo),Ia(u,c),pr(c),Nr=R;break;case 12:Ia(u,c),pr(c);break;case 13:Ia(u,c),pr(c),c.child.flags&8192&&c.memoizedState!==null!=(E!==null&&E.memoizedState!==null)&&(nS=Xt()),R&4&&(R=c.updateQueue,R!==null&&(c.updateQueue=null,K0(c,R)));break;case 22:if(R&512&&(qi||E===null||da(E,E.return)),me=c.memoizedState!==null,Ce=E!==null&&E.memoizedState!==null,tt=Mc,_t=qi,Mc=tt||me,qi=_t||Ce,Ia(u,c),qi=_t,Mc=tt,pr(c),u=c.stateNode,u._current=c,u._visibility&=-3,u._visibility|=u._pendingVisibility&2,R&8192&&(u._visibility=me?u._visibility&-2:u._visibility|1,me&&(u=Mc||qi,E===null||Ce||u||Pl(c)),c.memoizedProps===null||c.memoizedProps.mode!=="manual"))e:for(E=null,u=c;;){if(u.tag===5||u.tag===26||u.tag===27){if(E===null){Ce=E=u;try{if(w=Ce.stateNode,me)U=w.style,typeof U.setProperty=="function"?U.setProperty("display","none","important"):U.display="none";else{J=Ce.stateNode,ae=Ce.memoizedProps.style;var Je=ae!=null&&ae.hasOwnProperty("display")?ae.display:null;J.style.display=Je==null||typeof Je=="boolean"?"":(""+Je).trim()}}catch(Bt){ai(Ce,Ce.return,Bt)}}}else if(u.tag===6){if(E===null){Ce=u;try{Ce.stateNode.nodeValue=me?"":Ce.memoizedProps}catch(Bt){ai(Ce,Ce.return,Bt)}}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===c)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===c)break e;for(;u.sibling===null;){if(u.return===null||u.return===c)break e;E===u&&(E=null),u=u.return}E===u&&(E=null),u.sibling.return=u.return,u=u.sibling}R&4&&(R=c.updateQueue,R!==null&&(E=R.retryQueue,E!==null&&(R.retryQueue=null,K0(c,E))));break;case 19:Ia(u,c),pr(c),R&4&&(R=c.updateQueue,R!==null&&(c.updateQueue=null,K0(c,R)));break;case 21:break;default:Ia(u,c),pr(c)}}function pr(c){var u=c.flags;if(u&2){try{if(c.tag!==27){e:{for(var E=c.return;E!==null;){if(_v(E)){var R=E;break e}E=E.return}throw Error(o(160))}switch(R.tag){case 27:var w=R.stateNode,U=F0(c);Hg(c,U,w);break;case 5:var J=R.stateNode;R.flags&32&&(Ro(J,""),R.flags&=-33);var ae=F0(c);Hg(c,ae,J);break;case 3:case 4:var me=R.stateNode.containerInfo,Ce=F0(c);Gg(c,Ce,me);break;default:throw Error(o(161))}}}catch(tt){ai(c,c.return,tt)}c.flags&=-3}u&4096&&(c.flags&=-4097)}function Gd(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var u=c;Gd(u),u.tag===5&&u.flags&1024&&u.stateNode.reset(),c=c.sibling}}function Bo(c,u){if(u.subtreeFlags&8772)for(u=u.child;u!==null;)Sv(c,u.alternate,u),u=u.sibling}function Pl(c){for(c=c.child;c!==null;){var u=c;switch(u.tag){case 0:case 11:case 14:case 15:kc(4,u,u.return),Pl(u);break;case 1:da(u,u.return);var E=u.stateNode;typeof E.componentWillUnmount=="function"&&gv(u,u.return,E),Pl(u);break;case 26:case 27:case 5:da(u,u.return),Pl(u);break;case 22:da(u,u.return),u.memoizedState===null&&Pl(u);break;default:Pl(u)}c=c.sibling}}function eo(c,u,E){for(E=E&&(u.subtreeFlags&8772)!==0,u=u.child;u!==null;){var R=u.alternate,w=c,U=u,J=U.flags;switch(U.tag){case 0:case 11:case 15:eo(w,U,E),_p(4,U);break;case 1:if(eo(w,U,E),R=U,w=R.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(Ce){ai(R,R.return,Ce)}if(R=U,w=R.updateQueue,w!==null){var ae=R.stateNode;try{var me=w.shared.hiddenCallbacks;if(me!==null)for(w.shared.hiddenCallbacks=null,w=0;w<me.length;w++)k0(me[w],ae)}catch(Ce){ai(R,R.return,Ce)}}E&&J&64&&U0(U),jd(U,U.return);break;case 26:case 27:case 5:eo(w,U,E),E&&R===null&&J&4&&Sp(U),jd(U,U.return);break;case 12:eo(w,U,E);break;case 13:eo(w,U,E),E&&J&4&&G0(w,U);break;case 22:U.memoizedState===null&&eo(w,U,E),jd(U,U.return);break;default:eo(w,U,E)}u=u.sibling}}function Y0(c,u){var E=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(E=c.memoizedState.cachePool.pool),c=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(c=u.memoizedState.cachePool.pool),c!==E&&(c!=null&&c.refCount++,E!=null&&Zf(E))}function q0(c,u){c=null,u.alternate!==null&&(c=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==c&&(u.refCount++,c!=null&&Zf(c))}function kl(c,u,E,R){if(u.subtreeFlags&10256)for(u=u.child;u!==null;)$0(c,u,E,R),u=u.sibling}function $0(c,u,E,R){var w=u.flags;switch(u.tag){case 0:case 11:case 15:kl(c,u,E,R),w&2048&&_p(9,u);break;case 3:kl(c,u,E,R),w&2048&&(c=null,u.alternate!==null&&(c=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==c&&(u.refCount++,c!=null&&Zf(c)));break;case 12:if(w&2048){kl(c,u,E,R),c=u.stateNode;try{var U=u.memoizedProps,J=U.id,ae=U.onPostCommit;typeof ae=="function"&&ae(J,u.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(me){ai(u,u.return,me)}}else kl(c,u,E,R);break;case 23:break;case 22:U=u.stateNode,u.memoizedState!==null?U._visibility&4?kl(c,u,E,R):yp(c,u):U._visibility&4?kl(c,u,E,R):(U._visibility|=4,gh(c,u,E,R,(u.subtreeFlags&10256)!==0)),w&2048&&Y0(u.alternate,u);break;case 24:kl(c,u,E,R),w&2048&&q0(u.alternate,u);break;default:kl(c,u,E,R)}}function gh(c,u,E,R,w){for(w=w&&(u.subtreeFlags&10256)!==0,u=u.child;u!==null;){var U=c,J=u,ae=E,me=R,Ce=J.flags;switch(J.tag){case 0:case 11:case 15:gh(U,J,ae,me,w),_p(8,J);break;case 23:break;case 22:var tt=J.stateNode;J.memoizedState!==null?tt._visibility&4?gh(U,J,ae,me,w):yp(U,J):(tt._visibility|=4,gh(U,J,ae,me,w)),w&&Ce&2048&&Y0(J.alternate,J);break;case 24:gh(U,J,ae,me,w),w&&Ce&2048&&q0(J.alternate,J);break;default:gh(U,J,ae,me,w)}u=u.sibling}}function yp(c,u){if(u.subtreeFlags&10256)for(u=u.child;u!==null;){var E=c,R=u,w=R.flags;switch(R.tag){case 22:yp(E,R),w&2048&&Y0(R.alternate,R);break;case 24:yp(E,R),w&2048&&q0(R.alternate,R);break;default:yp(E,R)}u=u.sibling}}var Tp=8192;function Ml(c){if(c.subtreeFlags&Tp)for(c=c.child;c!==null;)vp(c),c=c.sibling}function vp(c){switch(c.tag){case 26:Ml(c),c.flags&Tp&&c.memoizedState!==null&&aI(Nr,c.memoizedState,c.memoizedProps);break;case 5:Ml(c);break;case 3:case 4:var u=Nr;Nr=hE(c.stateNode.containerInfo),Ml(c),Nr=u;break;case 22:c.memoizedState===null&&(u=c.alternate,u!==null&&u.memoizedState!==null?(u=Tp,Tp=16777216,Ml(c),Tp=u):Ml(c));break;default:Ml(c)}}function Tv(c){var u=c.alternate;if(u!==null&&(c=u.child,c!==null)){u.child=null;do u=c.sibling,c.sibling=null,c=u;while(c!==null)}}function Vo(c){var u=c.deletions;if((c.flags&16)!==0){if(u!==null)for(var E=0;E<u.length;E++){var R=u[E];Gs=R,vv(R,c)}Tv(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)z0(c),c=c.sibling}function z0(c){switch(c.tag){case 0:case 11:case 15:Vo(c),c.flags&2048&&kc(9,c,c.return);break;case 3:Vo(c);break;case 12:Vo(c);break;case 22:var u=c.stateNode;c.memoizedState!==null&&u._visibility&4&&(c.return===null||c.return.tag!==13)?(u._visibility&=-5,mr(c)):Vo(c);break;default:Vo(c)}}function mr(c){var u=c.deletions;if((c.flags&16)!==0){if(u!==null)for(var E=0;E<u.length;E++){var R=u[E];Gs=R,vv(R,c)}Tv(c)}for(c=c.child;c!==null;){switch(u=c,u.tag){case 0:case 11:case 15:kc(8,u,u.return),mr(u);break;case 22:E=u.stateNode,E._visibility&4&&(E._visibility&=-5,mr(u));break;default:mr(u)}c=c.sibling}}function vv(c,u){for(;Gs!==null;){var E=Gs;switch(E.tag){case 0:case 11:case 15:kc(8,E,u);break;case 23:case 22:if(E.memoizedState!==null&&E.memoizedState.cachePool!==null){var R=E.memoizedState.cachePool.pool;R!=null&&R.refCount++}break;case 24:Zf(E.memoizedState.cache)}if(R=E.child,R!==null)R.return=E,Gs=R;else e:for(E=c;Gs!==null;){R=Gs;var w=R.sibling,U=R.return;if(j0(R),R===E){Gs=null;break e}if(w!==null){w.return=U,Gs=w;break e}Gs=U}}}function kC(c,u,E,R){this.tag=c,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ha(c,u,E,R){return new kC(c,u,E,R)}function X0(c){return c=c.prototype,!(!c||!c.isReactComponent)}function Uc(c,u){var E=c.alternate;return E===null?(E=ha(c.tag,u,c.key,c.mode),E.elementType=c.elementType,E.type=c.type,E.stateNode=c.stateNode,E.alternate=c,c.alternate=E):(E.pendingProps=u,E.type=c.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=c.flags&31457280,E.childLanes=c.childLanes,E.lanes=c.lanes,E.child=c.child,E.memoizedProps=c.memoizedProps,E.memoizedState=c.memoizedState,E.updateQueue=c.updateQueue,u=c.dependencies,E.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},E.sibling=c.sibling,E.index=c.index,E.ref=c.ref,E.refCleanup=c.refCleanup,E}function J0(c,u){c.flags&=31457282;var E=c.alternate;return E===null?(c.childLanes=0,c.lanes=u,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=E.childLanes,c.lanes=E.lanes,c.child=E.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=E.memoizedProps,c.memoizedState=E.memoizedState,c.updateQueue=E.updateQueue,c.type=E.type,u=E.dependencies,c.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),c}function Wg(c,u,E,R,w,U){var J=0;if(R=c,typeof c=="function")X0(c)&&(J=1);else if(typeof c=="string")J=Xv(c,E,gn.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case v:return Ul(E.children,w,U,u);case T:J=8,w|=24;break;case C:return c=ha(12,E,u,w|2),c.elementType=C,c.lanes=U,c;case K:return c=ha(13,E,u,w),c.elementType=K,c.lanes=U,c;case H:return c=ha(19,E,u,w),c.elementType=H,c.lanes=U,c;case ee:return bv(E,w,U,u);default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case I:case N:J=10;break e;case L:J=9;break e;case x:J=11;break e;case Q:J=14;break e;case ne:J=16,R=null;break e}J=29,E=Error(o(130,c===null?"null":typeof c,"")),R=null}return u=ha(J,E,u,w),u.elementType=c,u.type=R,u.lanes=U,u}function Ul(c,u,E,R){return c=ha(7,c,R,u),c.lanes=E,c}function bv(c,u,E,R){c=ha(22,c,R,u),c.elementType=ee,c.lanes=E;var w={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var U=w._current;if(U===null)throw Error(o(456));if((w._pendingVisibility&2)===0){var J=Lo(U,2);J!==null&&(w._pendingVisibility|=2,bs(J,U,2))}},attach:function(){var U=w._current;if(U===null)throw Error(o(456));if((w._pendingVisibility&2)!==0){var J=Lo(U,2);J!==null&&(w._pendingVisibility&=-3,bs(J,U,2))}}};return c.stateNode=w,c}function Q0(c,u,E){return c=ha(6,c,null,u),c.lanes=E,c}function Z0(c,u,E){return u=ha(4,c.children!==null?c.children:[],c.key,u),u.lanes=E,u.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},u}function to(c){c.flags|=4}function Yg(c,u){if(u.type!=="stylesheet"||(u.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!Jv(u)){if(u=Ca.current,u!==null&&((jn&4194176)===jn?Po!==null:(jn&62914560)!==jn&&(jn&536870912)===0||u!==Po))throw Jf=Oi,Un;c.flags|=8192}}function qg(c,u){u!==null&&(c.flags|=4),c.flags&16384&&(u=c.tag!==22?Um():536870912,c.lanes|=u,Wd|=u)}function Hd(c,u){if(!Yn)switch(c.tailMode){case"hidden":u=c.tail;for(var E=null;u!==null;)u.alternate!==null&&(E=u),u=u.sibling;E===null?c.tail=null:E.sibling=null;break;case"collapsed":E=c.tail;for(var R=null;E!==null;)E.alternate!==null&&(R=E),E=E.sibling;R===null?u||c.tail===null?c.tail=null:c.tail.sibling=null:R.sibling=null}}function Xi(c){var u=c.alternate!==null&&c.alternate.child===c.child,E=0,R=0;if(u)for(var w=c.child;w!==null;)E|=w.lanes|w.childLanes,R|=w.subtreeFlags&31457280,R|=w.flags&31457280,w.return=c,w=w.sibling;else for(w=c.child;w!==null;)E|=w.lanes|w.childLanes,R|=w.subtreeFlags,R|=w.flags,w.return=c,w=w.sibling;return c.subtreeFlags|=R,c.childLanes=E,u}function Rv(c,u,E){var R=u.pendingProps;switch(Xf(u),u.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xi(u),null;case 1:return Xi(u),null;case 3:return E=u.stateNode,R=null,c!==null&&(R=c.memoizedState.cache),u.memoizedState.cache!==R&&(u.flags|=2048),xc(rs),jt(),E.pendingContext&&(E.context=E.pendingContext,E.pendingContext=null),(c===null||c.child===null)&&(ce(u)?to(u):c===null||c.memoizedState.isDehydrated&&(u.flags&256)===0||(u.flags|=1024,la!==null&&(Qg(la),la=null))),Xi(u),null;case 26:return E=u.memoizedState,c===null?(to(u),E!==null?(Xi(u),Yg(u,E)):(Xi(u),u.flags&=-16777217)):E?E!==c.memoizedState?(to(u),Xi(u),Yg(u,E)):(Xi(u),u.flags&=-16777217):(c.memoizedProps!==R&&to(u),Xi(u),u.flags&=-16777217),null;case 27:Wn(u),E=ei.current;var w=u.type;if(c!==null&&u.stateNode!=null)c.memoizedProps!==R&&to(u);else{if(!R){if(u.stateNode===null)throw Error(o(166));return Xi(u),null}c=gn.current,ce(u)?V(u):(c=Kv(w,R,E),u.stateNode=c,to(u))}return Xi(u),null;case 5:if(Wn(u),E=u.type,c!==null&&u.stateNode!=null)c.memoizedProps!==R&&to(u);else{if(!R){if(u.stateNode===null)throw Error(o(166));return Xi(u),null}if(c=gn.current,ce(u))V(u);else{switch(w=uE(ei.current),c){case 1:c=w.createElementNS("http://www.w3.org/2000/svg",E);break;case 2:c=w.createElementNS("http://www.w3.org/1998/Math/MathML",E);break;default:switch(E){case"svg":c=w.createElementNS("http://www.w3.org/2000/svg",E);break;case"math":c=w.createElementNS("http://www.w3.org/1998/Math/MathML",E);break;case"script":c=w.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild);break;case"select":c=typeof R.is=="string"?w.createElement("select",{is:R.is}):w.createElement("select"),R.multiple?c.multiple=!0:R.size&&(c.size=R.size);break;default:c=typeof R.is=="string"?w.createElement(E,{is:R.is}):w.createElement(E)}}c[Fs]=u,c[_n]=R;e:for(w=u.child;w!==null;){if(w.tag===5||w.tag===6)c.appendChild(w.stateNode);else if(w.tag!==4&&w.tag!==27&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===u)break e;for(;w.sibling===null;){if(w.return===null||w.return===u)break e;w=w.return}w.sibling.return=w.return,w=w.sibling}u.stateNode=c;e:switch(tr(c,E,R),E){case"button":case"input":case"select":case"textarea":c=!!R.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&to(u)}}return Xi(u),u.flags&=-16777217,null;case 6:if(c&&u.stateNode!=null)c.memoizedProps!==R&&to(u);else{if(typeof R!="string"&&u.stateNode===null)throw Error(o(166));if(c=ei.current,ce(u)){if(c=u.stateNode,E=u.memoizedProps,R=null,w=Vs,w!==null)switch(w.tag){case 27:case 5:R=w.memoizedProps}c[Fs]=u,c=!!(c.nodeValue===E||R!==null&&R.suppressHydrationWarning===!0||ES(c.nodeValue,E)),c||P(u)}else c=uE(c).createTextNode(R),c[Fs]=u,u.stateNode=c}return Xi(u),null;case 13:if(R=u.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(w=ce(u),R!==null&&R.dehydrated!==null){if(c===null){if(!w)throw Error(o(318));if(w=u.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(o(317));w[Fs]=u}else Fe(),(u.flags&128)===0&&(u.memoizedState=null),u.flags|=4;Xi(u),w=!1}else la!==null&&(Qg(la),la=null),w=!0;if(!w)return u.flags&256?(Ac(u),u):(Ac(u),null)}if(Ac(u),(u.flags&128)!==0)return u.lanes=E,u;if(E=R!==null,c=c!==null&&c.memoizedState!==null,E){R=u.child,w=null,R.alternate!==null&&R.alternate.memoizedState!==null&&R.alternate.memoizedState.cachePool!==null&&(w=R.alternate.memoizedState.cachePool.pool);var U=null;R.memoizedState!==null&&R.memoizedState.cachePool!==null&&(U=R.memoizedState.cachePool.pool),U!==w&&(R.flags|=2048)}return E!==c&&E&&(u.child.flags|=8192),qg(u,u.updateQueue),Xi(u),null;case 4:return jt(),c===null&&oE(u.stateNode.containerInfo),Xi(u),null;case 10:return xc(u.type),Xi(u),null;case 19:if(mt(Ls),w=u.memoizedState,w===null)return Xi(u),null;if(R=(u.flags&128)!==0,U=w.rendering,U===null)if(R)Hd(w,!1);else{if(Ji!==0||c!==null&&(c.flags&128)!==0)for(c=u.child;c!==null;){if(U=Tg(c),U!==null){for(u.flags|=128,Hd(w,!1),c=U.updateQueue,u.updateQueue=c,qg(u,c),u.subtreeFlags=0,c=E,E=u.child;E!==null;)J0(E,c),E=E.sibling;return bt(Ls,Ls.current&1|2),u.child}c=c.sibling}w.tail!==null&&Xt()>zg&&(u.flags|=128,R=!0,Hd(w,!1),u.lanes=4194304)}else{if(!R)if(c=Tg(U),c!==null){if(u.flags|=128,R=!0,c=c.updateQueue,u.updateQueue=c,qg(u,c),Hd(w,!0),w.tail===null&&w.tailMode==="hidden"&&!U.alternate&&!Yn)return Xi(u),null}else 2*Xt()-w.renderingStartTime>zg&&E!==536870912&&(u.flags|=128,R=!0,Hd(w,!1),u.lanes=4194304);w.isBackwards?(U.sibling=u.child,u.child=U):(c=w.last,c!==null?c.sibling=U:u.child=U,w.last=U)}return w.tail!==null?(u=w.tail,w.rendering=u,w.tail=u.sibling,w.renderingStartTime=Xt(),u.sibling=null,c=Ls.current,bt(Ls,R?c&1|2:c&1),u):(Xi(u),null);case 22:case 23:return Ac(u),Q_(),R=u.memoizedState!==null,c!==null?c.memoizedState!==null!==R&&(u.flags|=8192):R&&(u.flags|=8192),R?(E&536870912)!==0&&(u.flags&128)===0&&(Xi(u),u.subtreeFlags&6&&(u.flags|=8192)):Xi(u),E=u.updateQueue,E!==null&&qg(u,E.retryQueue),E=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(E=c.memoizedState.cachePool.pool),R=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(R=u.memoizedState.cachePool.pool),R!==E&&(u.flags|=2048),c!==null&&mt(Ol),null;case 24:return E=null,c!==null&&(E=c.memoizedState.cache),u.memoizedState.cache!==E&&(u.flags|=2048),xc(rs),Xi(u),null;case 25:return null}throw Error(o(156,u.tag))}function MC(c,u){switch(Xf(u),u.tag){case 1:return c=u.flags,c&65536?(u.flags=c&-65537|128,u):null;case 3:return xc(rs),jt(),c=u.flags,(c&65536)!==0&&(c&128)===0?(u.flags=c&-65537|128,u):null;case 26:case 27:case 5:return Wn(u),null;case 13:if(Ac(u),c=u.memoizedState,c!==null&&c.dehydrated!==null){if(u.alternate===null)throw Error(o(340));Fe()}return c=u.flags,c&65536?(u.flags=c&-65537|128,u):null;case 19:return mt(Ls),null;case 4:return jt(),null;case 10:return xc(u.type),null;case 22:case 23:return Ac(u),Q_(),c!==null&&mt(Ol),c=u.flags,c&65536?(u.flags=c&-65537|128,u):null;case 24:return xc(rs),null;case 25:return null;default:return null}}function $g(c,u){switch(Xf(u),u.tag){case 3:xc(rs),jt();break;case 26:case 27:case 5:Wn(u);break;case 4:jt();break;case 13:Ac(u);break;case 19:mt(Ls);break;case 10:xc(u.type);break;case 22:case 23:Ac(u),Q_(),c!==null&&mt(Ol);break;case 24:xc(rs)}}var bp={getCacheForType:function(c){var u=er(rs),E=u.data.get(c);return E===void 0&&(E=c(),u.data.set(c,E)),E}},Av=typeof WeakMap=="function"?WeakMap:Map,Gi=0,vi=null,Ln=null,jn=0,Ei=0,Hr=null,Kr=!1,Fl=!1,Rp=!1,no=0,Ji=0,Fc=0,Kd=0,eS=0,Hs=0,Wd=0,Ap=null,wa=null,tS=!1,nS=0,zg=1/0,Xg=null,jo=null,Cp=!1,Bl=null,Eh=0,_h=0,Jg=null,Yd=0,Sh=null;function gr(){if((Gi&2)!==0&&jn!==0)return jn&-jn;if(_e.T!==null){var c=oh;return c!==0?c:uS()}return gf()}function iS(){Hs===0&&(Hs=(jn&536870912)===0||Yn?qa():536870912);var c=Ca.current;return c!==null&&(c.flags|=32),Hs}function bs(c,u,E){(c===vi&&Ei===2||c.cancelPendingCommit!==null)&&(yh(c,0),fa(c,jn,Hs,!1)),vd(c,E),((Gi&2)===0||c!==vi)&&(c===vi&&((Gi&2)===0&&(Kd|=E),Ji===4&&fa(c,jn,Hs,!1)),Go(c))}function Vl(c,u,E){if((Gi&6)!==0)throw Error(o(327));var R=!E&&(u&60)===0&&(u&c.expiredLanes)===0||Ya(c,u),w=R?Dv(c,u):eE(c,u,!0),U=R;do{if(w===0){Fl&&!R&&fa(c,u,0,!1);break}else if(w===6)fa(c,u,0,!Kr);else{if(E=c.current.alternate,U&&!UC(E)){w=eE(c,u,!1),U=!1;continue}if(w===2){if(U=u,c.errorRecoveryDisabledLanes&U)var J=0;else J=c.pendingLanes&-536870913,J=J!==0?J:J&536870912?536870912:0;if(J!==0){u=J;e:{var ae=c;w=Ap;var me=ae.current.memoizedState.isDehydrated;if(me&&(yh(ae,J).flags|=256),J=eE(ae,J,!1),J!==2){if(Rp&&!me){ae.errorRecoveryDisabledLanes|=U,Kd|=U,w=4;break e}U=wa,wa=w,U!==null&&Qg(U)}w=J}if(U=!1,w!==2)continue}}if(w===1){yh(c,0),fa(c,u,0,!0);break}e:{switch(R=c,w){case 0:case 1:throw Error(o(345));case 4:if((u&4194176)===u){fa(R,u,Hs,!Kr);break e}break;case 2:wa=null;break;case 3:case 5:break;default:throw Error(o(329))}if(R.finishedWork=E,R.finishedLanes=u,(u&62914560)===u&&(U=nS+300-Xt(),10<U)){if(fa(R,u,Hs,!Kr),Nu(R,0)!==0)break e;R.timeoutHandle=jv(Cv.bind(null,R,E,wa,Xg,tS,u,Hs,Kd,Wd,Kr,2,-0,0),U);break e}Cv(R,E,wa,Xg,tS,u,Hs,Kd,Wd,Kr,0,-0,0)}}break}while(!0);Go(c)}function Qg(c){wa===null?wa=c:wa.push.apply(wa,c)}function Cv(c,u,E,R,w,U,J,ae,me,Ce,tt,_t,Ve){var Je=u.subtreeFlags;if((Je&8192||(Je&16785408)===16785408)&&(Dh={stylesheets:null,count:0,unsuspend:wS},vp(u),u=oI(),u!==null)){c.cancelPendingCommit=u(nE.bind(null,c,E,R,w,J,ae,me,1,_t,Ve)),fa(c,U,J,!Ce);return}nE(c,E,R,w,J,ae,me,tt,_t,Ve)}function UC(c){for(var u=c;;){var E=u.tag;if((E===0||E===11||E===15)&&u.flags&16384&&(E=u.updateQueue,E!==null&&(E=E.stores,E!==null)))for(var R=0;R<E.length;R++){var w=E[R],U=w.getSnapshot;w=w.value;try{if(!wr(U(),w))return!1}catch{return!1}}if(E=u.child,u.subtreeFlags&16384&&E!==null)E.return=u,u=E;else{if(u===c)break;for(;u.sibling===null;){if(u.return===null||u.return===c)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function fa(c,u,E,R){u&=~eS,u&=~Kd,c.suspendedLanes|=u,c.pingedLanes&=~u,R&&(c.warmLanes|=u),R=c.expirationTimes;for(var w=u;0<w;){var U=31-Cr(w),J=1<<U;R[U]=-1,w&=~J}E!==0&&Fm(c,E,u)}function Zg(){return(Gi&6)===0?(Rh(0),!1):!0}function sS(){if(Ln!==null){if(Ei===0)var c=Ln.return;else c=Ln,Lc=Fd=null,o0(c),bc=null,Cl=0,c=Ln;for(;c!==null;)$g(c.alternate,c),c=c.return;Ln=null}}function yh(c,u){c.finishedWork=null,c.finishedLanes=0;var E=c.timeoutHandle;E!==-1&&(c.timeoutHandle=-1,WC(E)),E=c.cancelPendingCommit,E!==null&&(c.cancelPendingCommit=null,E()),sS(),vi=c,Ln=E=Uc(c.current,null),jn=u,Ei=0,Hr=null,Kr=!1,Fl=Ya(c,u),Rp=!1,Wd=Hs=eS=Kd=Fc=Ji=0,wa=Ap=null,tS=!1,(u&8)!==0&&(u|=u&32);var R=c.entangledLanes;if(R!==0)for(c=c.entanglements,R&=u;0<R;){var w=31-Cr(R),U=1<<w;u|=c[w],R&=~U}return no=u,Zu(),E}function Iv(c,u){Tn=null,_e.H=Ja,u===cn?(u=IT(),Ei=3):u===Un?(u=IT(),Ei=4):Ei=u===av?8:u!==null&&typeof u=="object"&&typeof u.then=="function"?6:1,Hr=u,Ln===null&&(Ji=1,hp(c,Zs(u,c.current)))}function wv(){var c=_e.H;return _e.H=Ja,c===null?Ja:c}function Ov(){var c=_e.A;return _e.A=bp,c}function Ip(){Ji=4,Kr||(jn&4194176)!==jn&&Ca.current!==null||(Fl=!0),(Fc&134217727)===0&&(Kd&134217727)===0||vi===null||fa(vi,jn,Hs,!1)}function eE(c,u,E){var R=Gi;Gi|=2;var w=wv(),U=Ov();(vi!==c||jn!==u)&&(Xg=null,yh(c,u)),u=!1;var J=Ji;e:do try{if(Ei!==0&&Ln!==null){var ae=Ln,me=Hr;switch(Ei){case 8:sS(),J=6;break e;case 3:case 2:case 6:Ca.current===null&&(u=!0);var Ce=Ei;if(Ei=0,Hr=null,qd(c,ae,me,Ce),E&&Fl){J=0;break e}break;default:Ce=Ei,Ei=0,Hr=null,qd(c,ae,me,Ce)}}FC(),J=Ji;break}catch(tt){Iv(c,tt)}while(!0);return u&&c.shellSuspendCounter++,Lc=Fd=null,Gi=R,_e.H=w,_e.A=U,Ln===null&&(vi=null,jn=0,Zu()),J}function FC(){for(;Ln!==null;)Th(Ln)}function Dv(c,u){var E=Gi;Gi|=2;var R=wv(),w=Ov();vi!==c||jn!==u?(Xg=null,zg=Xt()+500,yh(c,u)):Fl=Ya(c,u);e:do try{if(Ei!==0&&Ln!==null){u=Ln;var U=Hr;t:switch(Ei){case 1:Ei=0,Hr=null,qd(c,u,U,1);break;case 2:if(vc(U)){Ei=0,Hr=null,io(u);break}u=function(){Ei===2&&vi===c&&(Ei=7),Go(c)},U.then(u,u);break e;case 3:Ei=7;break e;case 4:Ei=5;break e;case 7:vc(U)?(Ei=0,Hr=null,io(u)):(Ei=0,Hr=null,qd(c,u,U,7));break;case 5:var J=null;switch(Ln.tag){case 26:J=Ln.memoizedState;case 5:case 27:var ae=Ln;if(!J||Jv(J)){Ei=0,Hr=null;var me=ae.sibling;if(me!==null)Ln=me;else{var Ce=ae.return;Ce!==null?(Ln=Ce,tE(Ce)):Ln=null}break t}}Ei=0,Hr=null,qd(c,u,U,5);break;case 6:Ei=0,Hr=null,qd(c,u,U,6);break;case 8:sS(),Ji=6;break e;default:throw Error(o(462))}}BC();break}catch(tt){Iv(c,tt)}while(!0);return Lc=Fd=null,_e.H=R,_e.A=w,Gi=E,Ln!==null?0:(vi=null,jn=0,Zu(),Ji)}function BC(){for(;Ln!==null&&!Ot();)Th(Ln)}function Th(c){var u=pv(c.alternate,c,no);c.memoizedProps=c.pendingProps,u===null?tE(c):Ln=u}function io(c){var u=c,E=u.alternate;switch(u.tag){case 15:case 0:u=uv(E,u,u.pendingProps,u.type,void 0,jn);break;case 11:u=uv(E,u,u.pendingProps,u.type.render,u.ref,jn);break;case 5:o0(u);default:$g(E,u),u=Ln=J0(u,no),u=pv(E,u,no)}c.memoizedProps=c.pendingProps,u===null?tE(c):Ln=u}function qd(c,u,E,R){Lc=Fd=null,o0(u),bc=null,Cl=0;var w=u.return;try{if(rv(c,w,u,E,jn)){Ji=1,hp(c,Zs(E,c.current)),Ln=null;return}}catch(U){if(w!==null)throw Ln=w,U;Ji=1,hp(c,Zs(E,c.current)),Ln=null;return}u.flags&32768?(Yn||R===1?c=!0:Fl||(jn&536870912)!==0?c=!1:(Kr=c=!0,(R===2||R===3||R===6)&&(R=Ca.current,R!==null&&R.tag===13&&(R.flags|=16384))),Nv(u,c)):tE(u)}function tE(c){var u=c;do{if((u.flags&32768)!==0){Nv(u,Kr);return}c=u.return;var E=Rv(u.alternate,u,no);if(E!==null){Ln=E;return}if(u=u.sibling,u!==null){Ln=u;return}Ln=u=c}while(u!==null);Ji===0&&(Ji=5)}function Nv(c,u){do{var E=MC(c.alternate,c);if(E!==null){E.flags&=32767,Ln=E;return}if(E=c.return,E!==null&&(E.flags|=32768,E.subtreeFlags=0,E.deletions=null),!u&&(c=c.sibling,c!==null)){Ln=c;return}Ln=c=E}while(c!==null);Ji=6,Ln=null}function nE(c,u,E,R,w,U,J,ae,me,Ce){var tt=_e.T,_t=Be.p;try{Be.p=2,_e.T=null,Lv(c,u,E,R,_t,w,U,J,ae,me,Ce)}finally{_e.T=tt,Be.p=_t}}function Lv(c,u,E,R,w,U,J,ae){do Bc();while(Bl!==null);if((Gi&6)!==0)throw Error(o(327));var me=c.finishedWork;if(R=c.finishedLanes,me===null)return null;if(c.finishedWork=null,c.finishedLanes=0,me===c.current)throw Error(o(177));c.callbackNode=null,c.callbackPriority=0,c.cancelPendingCommit=null;var Ce=me.lanes|me.childLanes;if(Ce|=No,Ir(c,R,Ce,U,J,ae),c===vi&&(Ln=vi=null,jn=0),(me.subtreeFlags&10256)===0&&(me.flags&10256)===0||Cp||(Cp=!0,_h=Ce,Jg=E,GC(hi,function(){return Bc(),null})),E=(me.flags&15990)!==0,(me.subtreeFlags&15990)!==0||E?(E=_e.T,_e.T=null,U=Be.p,Be.p=2,J=Gi,Gi|=4,PC(c,me),W0(me,c),pg(yS,c.containerInfo),Up=!!SS,yS=SS=null,c.current=me,Sv(c,me.alternate,me),Tt(),Gi=J,Be.p=U,_e.T=E):c.current=me,Cp?(Cp=!1,Bl=c,Eh=R):xv(c,Ce),Ce=c.pendingLanes,Ce===0&&(jo=null),To(me.stateNode),Go(c),u!==null)for(w=c.onRecoverableError,me=0;me<u.length;me++)Ce=u[me],w(Ce.value,{componentStack:Ce.stack});return(Eh&3)!==0&&Bc(),Ce=c.pendingLanes,(R&4194218)!==0&&(Ce&42)!==0?c===Sh?Yd++:(Yd=0,Sh=c):Yd=0,Rh(0),null}function xv(c,u){(c.pooledCacheLanes&=u)===0&&(u=c.pooledCache,u!=null&&(c.pooledCache=null,Zf(u)))}function Bc(){if(Bl!==null){var c=Bl,u=_h;_h=0;var E=bd(Eh),R=_e.T,w=Be.p;try{if(Be.p=32>E?32:E,_e.T=null,Bl===null)var U=!1;else{E=Jg,Jg=null;var J=Bl,ae=Eh;if(Bl=null,Eh=0,(Gi&6)!==0)throw Error(o(331));var me=Gi;if(Gi|=4,z0(J.current),$0(J,J.current,ae,E),Gi=me,Rh(0,!1),qs&&typeof qs.onPostCommitFiberRoot=="function")try{qs.onPostCommitFiberRoot(ul,J)}catch{}U=!0}return U}finally{Be.p=w,_e.T=R,xv(c,u)}}return!1}function Vc(c,u,E){u=Zs(E,u),u=Dc(c.stateNode,u,2),c=Za(c,u,2),c!==null&&(vd(c,2),Go(c))}function ai(c,u,E){if(c.tag===3)Vc(c,c,E);else for(;u!==null;){if(u.tag===3){Vc(u,c,E);break}else if(u.tag===1){var R=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(jo===null||!jo.has(R))){c=Zs(E,c),E=Mg(2),R=Za(u,E,2),R!==null&&(sv(E,R,u,c),vd(R,2),Go(R));break}}u=u.return}}function rS(c,u,E){var R=c.pingCache;if(R===null){R=c.pingCache=new Av;var w=new Set;R.set(u,w)}else w=R.get(u),w===void 0&&(w=new Set,R.set(u,w));w.has(E)||(Rp=!0,w.add(E),c=VC.bind(null,c,u,E),u.then(c,c))}function VC(c,u,E){var R=c.pingCache;R!==null&&R.delete(u),c.pingedLanes|=c.suspendedLanes&E,c.warmLanes&=~E,vi===c&&(jn&E)===E&&(Ji===4||Ji===3&&(jn&62914560)===jn&&300>Xt()-nS?(Gi&2)===0&&yh(c,0):eS|=E,Wd===jn&&(Wd=0)),Go(c)}function Pv(c,u){u===0&&(u=Um()),c=Lo(c,u),c!==null&&(vd(c,u),Go(c))}function jC(c){var u=c.memoizedState,E=0;u!==null&&(E=u.retryLane),Pv(c,E)}function aS(c,u){var E=0;switch(c.tag){case 13:var R=c.stateNode,w=c.memoizedState;w!==null&&(E=w.retryLane);break;case 19:R=c.stateNode;break;case 22:R=c.stateNode._retryCache;break;default:throw Error(o(314))}R!==null&&R.delete(u),Pv(c,E)}function GC(c,u){return lt(c,u)}var iE=null,vh=null,sE=!1,bh=!1,oS=!1,$d=0;function Go(c){c!==vh&&c.next===null&&(vh===null?iE=vh=c:vh=vh.next=c),bh=!0,sE||(sE=!0,kv(cS))}function Rh(c,u){if(!oS&&bh){oS=!0;do for(var E=!1,R=iE;R!==null;){if(c!==0){var w=R.pendingLanes;if(w===0)var U=0;else{var J=R.suspendedLanes,ae=R.pingedLanes;U=(1<<31-Cr(42|c)+1)-1,U&=w&~(J&~ae),U=U&201326677?U&201326677|1:U?U|2:0}U!==0&&(E=!0,wp(R,U))}else U=jn,U=Nu(R,R===vi?U:0),(U&3)===0||Ya(R,U)||(E=!0,wp(R,U));R=R.next}while(E);oS=!1}}function cS(){bh=sE=!1;var c=0;$d!==0&&(KC()&&(c=$d),$d=0);for(var u=Xt(),E=null,R=iE;R!==null;){var w=R.next,U=lS(R,u);U===0?(R.next=null,E===null?iE=w:E.next=w,w===null&&(vh=E)):(E=R,(c!==0||(U&3)!==0)&&(bh=!0)),R=w}Rh(c)}function lS(c,u){for(var E=c.suspendedLanes,R=c.pingedLanes,w=c.expirationTimes,U=c.pendingLanes&-62914561;0<U;){var J=31-Cr(U),ae=1<<J,me=w[J];me===-1?((ae&E)===0||(ae&R)!==0)&&(w[J]=B_(ae,u)):me<=u&&(c.expiredLanes|=ae),U&=~ae}if(u=vi,E=jn,E=Nu(c,c===u?E:0),R=c.callbackNode,E===0||c===u&&Ei===2||c.cancelPendingCommit!==null)return R!==null&&R!==null&&yt(R),c.callbackNode=null,c.callbackPriority=0;if((E&3)===0||Ya(c,E)){if(u=E&-E,u===c.callbackPriority)return u;switch(R!==null&&yt(R),bd(E)){case 2:case 8:E=Nn;break;case 32:E=hi;break;case 268435456:E=yo;break;default:E=hi}return R=dS.bind(null,c),E=lt(E,R),c.callbackPriority=u,c.callbackNode=E,u}return R!==null&&R!==null&&yt(R),c.callbackPriority=2,c.callbackNode=null,2}function dS(c,u){var E=c.callbackNode;if(Bc()&&c.callbackNode!==E)return null;var R=jn;return R=Nu(c,c===vi?R:0),R===0?null:(Vl(c,R,u),lS(c,Xt()),c.callbackNode!=null&&c.callbackNode===E?dS.bind(null,c):null)}function wp(c,u){if(Bc())return null;Vl(c,u,!0)}function kv(c){YC(function(){(Gi&6)!==0?lt(hs,c):c()})}function uS(){return $d===0&&($d=qa()),$d}function rE(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:Ad(""+c)}function Mv(c,u){var E=u.ownerDocument.createElement("input");return E.name=u.name,E.value=u.value,c.id&&E.setAttribute("form",c.id),u.parentNode.insertBefore(E,u),c=new FormData(c),E.parentNode.removeChild(E),c}function HC(c,u,E,R,w){if(u==="submit"&&E&&E.stateNode===w){var U=rE((w[_n]||null).action),J=R.submitter;J&&(u=(u=J[_n]||null)?rE(u.formAction):J.getAttribute("formAction"),u!==null&&(U=u,J=null));var ae=new Js("action","action",null,R,w);c.push({event:ae,listeners:[{instance:null,listener:function(){if(R.defaultPrevented){if($d!==0){var me=J?Mv(w,J):new FormData(w);m0(E,{pending:!0,data:me,method:w.method,action:U},null,me)}}else typeof U=="function"&&(ae.preventDefault(),me=J?Mv(w,J):new FormData(w),m0(E,{pending:!0,data:me,method:w.method,action:U},U,me))},currentTarget:w}]})}}for(var zd=0;zd<qf.length;zd++){var Op=qf[zd],Uv=Op.toLowerCase(),hS=Op[0].toUpperCase()+Op.slice(1);ca(Uv,"on"+hS)}ca(Qu,"onAnimationEnd"),ca(mg,"onAnimationIteration"),ca(We,"onAnimationStart"),ca("dblclick","onDoubleClick"),ca("focusin","onFocus"),ca("focusout","onBlur"),ca(bT,"onTransitionRun"),ca(RT,"onTransitionStart"),ca(AT,"onTransitionCancel"),ca(gg,"onTransitionEnd"),mc("onMouseEnter",["mouseout","mouseover"]),mc("onMouseLeave",["mouseout","mouseover"]),mc("onPointerEnter",["pointerout","pointerover"]),mc("onPointerLeave",["pointerout","pointerover"]),vo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vo("onBeforeInput",["compositionend","keypress","textInput","paste"]),vo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Xd));function Fv(c,u){u=(u&4)!==0;for(var E=0;E<c.length;E++){var R=c[E],w=R.event;R=R.listeners;e:{var U=void 0;if(u)for(var J=R.length-1;0<=J;J--){var ae=R[J],me=ae.instance,Ce=ae.currentTarget;if(ae=ae.listener,me!==U&&w.isPropagationStopped())break e;U=ae,w.currentTarget=Ce;try{U(w)}catch(tt){kg(tt)}w.currentTarget=null,U=me}else for(J=0;J<R.length;J++){if(ae=R[J],me=ae.instance,Ce=ae.currentTarget,ae=ae.listener,me!==U&&w.isPropagationStopped())break e;U=ae,w.currentTarget=Ce;try{U(w)}catch(tt){kg(tt)}w.currentTarget=null,U=me}}}}function Gn(c,u){var E=u[Ef];E===void 0&&(E=u[Ef]=new Set);var R=c+"__bubble";E.has(R)||(pS(u,c,2,!1),E.add(R))}function aE(c,u,E){var R=0;u&&(R|=4),pS(E,c,R,u)}var Dp="_reactListening"+Math.random().toString(36).slice(2);function oE(c){if(!c[Dp]){c[Dp]=!0,Yi.forEach(function(E){E!=="selectionchange"&&(fS.has(E)||aE(E,!1,c),aE(E,!0,c))});var u=c.nodeType===9?c:c.ownerDocument;u===null||u[Dp]||(u[Dp]=!0,aE("selectionchange",!1,u))}}function pS(c,u,E,R){switch(sb(u)){case 2:var w=NS;break;case 8:w=ib;break;default:w=Fp}E=w.bind(null,u,E,c),w=void 0,!If||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(w=!0),R?w!==void 0?c.addEventListener(u,E,{capture:!0,passive:w}):c.addEventListener(u,E,!0):w!==void 0?c.addEventListener(u,E,{passive:w}):c.addEventListener(u,E,!1)}function cE(c,u,E,R,w){var U=R;if((u&1)===0&&(u&2)===0&&R!==null)e:for(;;){if(R===null)return;var J=R.tag;if(J===3||J===4){var ae=R.stateNode.containerInfo;if(ae===w||ae.nodeType===8&&ae.parentNode===w)break;if(J===4)for(J=R.return;J!==null;){var me=J.tag;if((me===3||me===4)&&(me=J.stateNode.containerInfo,me===w||me.nodeType===8&&me.parentNode===w))return;J=J.return}for(;ae!==null;){if(J=ia(ae),J===null)return;if(me=J.tag,me===5||me===6||me===26||me===27){R=U=J;continue e}ae=ae.parentNode}}R=R.return}Ym(function(){var Ce=U,tt=Cd(E),_t=[];e:{var Ve=Eg.get(c);if(Ve!==void 0){var Je=Js,Bt=c;switch(c){case"keypress":if(Od(E)===0)break e;case"keydown":case"keyup":Je=Y_;break;case"focusin":Bt="focus",Je=Of;break;case"focusout":Bt="blur",Je=Of;break;case"beforeblur":case"afterblur":Je=Of;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Je=zm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Je=Co;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Je=_l;break;case Qu:case mg:case We:Je=Qm;break;case gg:Je=tg;break;case"scroll":case"scrollend":Je=G_;break;case"wheel":Je=Pf;break;case"copy":case"cut":case"paste":Je=Nf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Je=Oo;break;case"toggle":case"beforetoggle":Je=ig}var hn=(u&4)!==0,$i=!hn&&(c==="scroll"||c==="scrollend"),Ne=hn?Ve!==null?Ve+"Capture":null:Ve;hn=[];for(var Ae=Ce,ke;Ae!==null;){var ht=Ae;if(ke=ht.stateNode,ht=ht.tag,ht!==5&&ht!==26&&ht!==27||ke===null||Ne===null||(ht=Id(Ae,Ne),ht!=null&&hn.push(Np(Ae,ht,ke))),$i)break;Ae=Ae.return}0<hn.length&&(Ve=new Je(Ve,Bt,null,E,tt),_t.push({event:Ve,listeners:hn}))}}if((u&7)===0){e:{if(Ve=c==="mouseover"||c==="pointerover",Je=c==="mouseout"||c==="pointerout",Ve&&E!==Cf&&(Bt=E.relatedTarget||E.fromElement)&&(ia(Bt)||Bt[fc]))break e;if((Je||Ve)&&(Ve=tt.window===tt?tt:(Ve=tt.ownerDocument)?Ve.defaultView||Ve.parentWindow:window,Je?(Bt=E.relatedTarget||E.toElement,Je=Ce,Bt=Bt?ia(Bt):null,Bt!==null&&($i=Ke(Bt),hn=Bt.tag,Bt!==$i||hn!==5&&hn!==27&&hn!==6)&&(Bt=null)):(Je=null,Bt=Ce),Je!==Bt)){if(hn=zm,ht="onMouseLeave",Ne="onMouseEnter",Ae="mouse",(c==="pointerout"||c==="pointerover")&&(hn=Oo,ht="onPointerLeave",Ne="onPointerEnter",Ae="pointer"),$i=Je==null?Ve:Ns(Je),ke=Bt==null?Ve:Ns(Bt),Ve=new hn(ht,Ae+"leave",Je,E,tt),Ve.target=$i,Ve.relatedTarget=ke,ht=null,ia(tt)===Ce&&(hn=new hn(Ne,Ae+"enter",Bt,E,tt),hn.target=ke,hn.relatedTarget=$i,ht=hn),$i=ht,Je&&Bt)t:{for(hn=Je,Ne=Bt,Ae=0,ke=hn;ke;ke=Ah(ke))Ae++;for(ke=0,ht=Ne;ht;ht=Ah(ht))ke++;for(;0<Ae-ke;)hn=Ah(hn),Ae--;for(;0<ke-Ae;)Ne=Ah(Ne),ke--;for(;Ae--;){if(hn===Ne||Ne!==null&&hn===Ne.alternate)break t;hn=Ah(hn),Ne=Ah(Ne)}hn=null}else hn=null;Je!==null&&Jd(_t,Ve,Je,hn,!1),Bt!==null&&$i!==null&&Jd(_t,$i,Bt,hn,!0)}}e:{if(Ve=Ce?Ns(Ce):window,Je=Ve.nodeName&&Ve.nodeName.toLowerCase(),Je==="select"||Je==="input"&&Ve.type==="file")var Mt=cg;else if(ag(Ve))if(lg)Mt=$_;else{Mt=zu;var Jt=ug}else Je=Ve.nodeName,!Je||Je.toLowerCase()!=="input"||Ve.type!=="checkbox"&&Ve.type!=="radio"?Ce&&Bu(Ce.elementType)&&(Mt=cg):Mt=Gf;if(Mt&&(Mt=Mt(c,Ce))){Bf(_t,Mt,E,tt);break e}Jt&&Jt(c,Ve,Ce),c==="focusout"&&Ce&&Ve.type==="number"&&Ce.memoizedProps.value!=null&&bf(Ve,"number",Ve.value)}switch(Jt=Ce?Ns(Ce):window,c){case"focusin":(ag(Jt)||Jt.contentEditable==="true")&&(Tl=Jt,Hf=Ce,vl=null);break;case"focusout":vl=Hf=Tl=null;break;case"mousedown":Ju=!0;break;case"contextmenu":case"mouseup":case"dragend":Ju=!1,Kf(_t,E,tt);break;case"selectionchange":if(z_)break;case"keydown":case"keyup":Kf(_t,E,tt)}var Kt;if(Do)e:{switch(c){case"compositionstart":var Qt="onCompositionStart";break e;case"compositionend":Qt="onCompositionEnd";break e;case"compositionupdate":Qt="onCompositionUpdate";break e}Qt=void 0}else Ec?Ff(c,E)&&(Qt="onCompositionEnd"):c==="keydown"&&E.keyCode===229&&(Qt="onCompositionStart");Qt&&(Mf&&E.locale!=="ko"&&(Ec||Qt!=="onCompositionStart"?Qt==="onCompositionEnd"&&Ec&&(Kt=qm()):(Ao=tt,ju="value"in Ao?Ao.value:Ao.textContent,Ec=!0)),Jt=Lp(Ce,Qt),0<Jt.length&&(Qt=new Zm(Qt,c,null,E,tt),_t.push({event:Qt,listeners:Jt}),Kt?Qt.data=Kt:(Kt=Yu(E),Kt!==null&&(Qt.data=Kt)))),(Kt=sg?va(c,E):rg(c,E))&&(Qt=Lp(Ce,"onBeforeInput"),0<Qt.length&&(Jt=new Zm("onBeforeInput","beforeinput",null,E,tt),_t.push({event:Jt,listeners:Qt}),Jt.data=Kt)),HC(_t,c,Ce,E,tt)}Fv(_t,u)})}function Np(c,u,E){return{instance:c,listener:u,currentTarget:E}}function Lp(c,u){for(var E=u+"Capture",R=[];c!==null;){var w=c,U=w.stateNode;w=w.tag,w!==5&&w!==26&&w!==27||U===null||(w=Id(c,E),w!=null&&R.unshift(Np(c,w,U)),w=Id(c,u),w!=null&&R.push(Np(c,w,U))),c=c.return}return R}function Ah(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function Jd(c,u,E,R,w){for(var U=u._reactName,J=[];E!==null&&E!==R;){var ae=E,me=ae.alternate,Ce=ae.stateNode;if(ae=ae.tag,me!==null&&me===R)break;ae!==5&&ae!==26&&ae!==27||Ce===null||(me=Ce,w?(Ce=Id(E,U),Ce!=null&&J.unshift(Np(E,Ce,me))):w||(Ce=Id(E,U),Ce!=null&&J.push(Np(E,Ce,me)))),E=E.return}J.length!==0&&c.push({event:u,listeners:J})}var Ch=/\r\n?/g,mS=/\u0000|\uFFFD/g;function gS(c){return(typeof c=="string"?c:""+c).replace(Ch,`
`).replace(mS,"")}function ES(c,u){return u=gS(u),gS(c)===u}function lE(){}function _i(c,u,E,R,w,U){switch(E){case"children":typeof R=="string"?u==="body"||u==="textarea"&&R===""||Ro(c,R):(typeof R=="number"||typeof R=="bigint")&&u!=="body"&&Ro(c,""+R);break;case"className":pl(c,"class",R);break;case"tabIndex":pl(c,"tabindex",R);break;case"dir":case"role":case"viewBox":case"width":case"height":pl(c,E,R);break;case"style":Af(c,R,U);break;case"data":if(u!=="object"){pl(c,"data",R);break}case"src":case"href":if(R===""&&(u!=="a"||E!=="href")){c.removeAttribute(E);break}if(R==null||typeof R=="function"||typeof R=="symbol"||typeof R=="boolean"){c.removeAttribute(E);break}R=Ad(""+R),c.setAttribute(E,R);break;case"action":case"formAction":if(typeof R=="function"){c.setAttribute(E,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof U=="function"&&(E==="formAction"?(u!=="input"&&_i(c,u,"name",w.name,w,null),_i(c,u,"formEncType",w.formEncType,w,null),_i(c,u,"formMethod",w.formMethod,w,null),_i(c,u,"formTarget",w.formTarget,w,null)):(_i(c,u,"encType",w.encType,w,null),_i(c,u,"method",w.method,w,null),_i(c,u,"target",w.target,w,null)));if(R==null||typeof R=="symbol"||typeof R=="boolean"){c.removeAttribute(E);break}R=Ad(""+R),c.setAttribute(E,R);break;case"onClick":R!=null&&(c.onclick=lE);break;case"onScroll":R!=null&&Gn("scroll",c);break;case"onScrollEnd":R!=null&&Gn("scrollend",c);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(o(61));if(E=R.__html,E!=null){if(w.children!=null)throw Error(o(60));c.innerHTML=E}}break;case"multiple":c.multiple=R&&typeof R!="function"&&typeof R!="symbol";break;case"muted":c.muted=R&&typeof R!="function"&&typeof R!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(R==null||typeof R=="function"||typeof R=="boolean"||typeof R=="symbol"){c.removeAttribute("xlink:href");break}E=Ad(""+R),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",E);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":R!=null&&typeof R!="function"&&typeof R!="symbol"?c.setAttribute(E,""+R):c.removeAttribute(E);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":R&&typeof R!="function"&&typeof R!="symbol"?c.setAttribute(E,""):c.removeAttribute(E);break;case"capture":case"download":R===!0?c.setAttribute(E,""):R!==!1&&R!=null&&typeof R!="function"&&typeof R!="symbol"?c.setAttribute(E,R):c.removeAttribute(E);break;case"cols":case"rows":case"size":case"span":R!=null&&typeof R!="function"&&typeof R!="symbol"&&!isNaN(R)&&1<=R?c.setAttribute(E,R):c.removeAttribute(E);break;case"rowSpan":case"start":R==null||typeof R=="function"||typeof R=="symbol"||isNaN(R)?c.removeAttribute(E):c.setAttribute(E,R);break;case"popover":Gn("beforetoggle",c),Gn("toggle",c),Pu(c,"popover",R);break;case"xlinkActuate":$s(c,"http://www.w3.org/1999/xlink","xlink:actuate",R);break;case"xlinkArcrole":$s(c,"http://www.w3.org/1999/xlink","xlink:arcrole",R);break;case"xlinkRole":$s(c,"http://www.w3.org/1999/xlink","xlink:role",R);break;case"xlinkShow":$s(c,"http://www.w3.org/1999/xlink","xlink:show",R);break;case"xlinkTitle":$s(c,"http://www.w3.org/1999/xlink","xlink:title",R);break;case"xlinkType":$s(c,"http://www.w3.org/1999/xlink","xlink:type",R);break;case"xmlBase":$s(c,"http://www.w3.org/XML/1998/namespace","xml:base",R);break;case"xmlLang":$s(c,"http://www.w3.org/XML/1998/namespace","xml:lang",R);break;case"xmlSpace":$s(c,"http://www.w3.org/XML/1998/namespace","xml:space",R);break;case"is":Pu(c,"is",R);break;case"innerText":case"textContent":break;default:(!(2<E.length)||E[0]!=="o"&&E[0]!=="O"||E[1]!=="n"&&E[1]!=="N")&&(E=j_.get(E)||E,Pu(c,E,R))}}function _S(c,u,E,R,w,U){switch(E){case"style":Af(c,R,U);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(o(61));if(E=R.__html,E!=null){if(w.children!=null)throw Error(o(60));c.innerHTML=E}}break;case"children":typeof R=="string"?Ro(c,R):(typeof R=="number"||typeof R=="bigint")&&Ro(c,""+R);break;case"onScroll":R!=null&&Gn("scroll",c);break;case"onScrollEnd":R!=null&&Gn("scrollend",c);break;case"onClick":R!=null&&(c.onclick=lE);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!jm.hasOwnProperty(E))e:{if(E[0]==="o"&&E[1]==="n"&&(w=E.endsWith("Capture"),u=E.slice(2,w?E.length-7:void 0),U=c[_n]||null,U=U!=null?U[E]:null,typeof U=="function"&&c.removeEventListener(u,U,w),typeof R=="function")){typeof U!="function"&&U!==null&&(E in c?c[E]=null:c.hasAttribute(E)&&c.removeAttribute(E)),c.addEventListener(u,R,w);break e}E in c?c[E]=R:R===!0?c.setAttribute(E,""):Pu(c,E,R)}}}function tr(c,u,E){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Gn("error",c),Gn("load",c);var R=!1,w=!1,U;for(U in E)if(E.hasOwnProperty(U)){var J=E[U];if(J!=null)switch(U){case"src":R=!0;break;case"srcSet":w=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,u));default:_i(c,u,U,J,E,null)}}w&&_i(c,u,"srcSet",E.srcSet,E,null),R&&_i(c,u,"src",E.src,E,null);return;case"input":Gn("invalid",c);var ae=U=J=w=null,me=null,Ce=null;for(R in E)if(E.hasOwnProperty(R)){var tt=E[R];if(tt!=null)switch(R){case"name":w=tt;break;case"type":J=tt;break;case"checked":me=tt;break;case"defaultChecked":Ce=tt;break;case"value":U=tt;break;case"defaultValue":ae=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(o(137,u));break;default:_i(c,u,R,tt,E,null)}}Hm(c,U,ae,me,Ce,J,w,!1),ku(c);return;case"select":Gn("invalid",c),R=J=U=null;for(w in E)if(E.hasOwnProperty(w)&&(ae=E[w],ae!=null))switch(w){case"value":U=ae;break;case"defaultValue":J=ae;break;case"multiple":R=ae;default:_i(c,u,w,ae,E,null)}u=U,E=J,c.multiple=!!R,u!=null?ml(c,!!R,u,!1):E!=null&&ml(c,!!R,E,!0);return;case"textarea":Gn("invalid",c),U=w=R=null;for(J in E)if(E.hasOwnProperty(J)&&(ae=E[J],ae!=null))switch(J){case"value":R=ae;break;case"defaultValue":w=ae;break;case"children":U=ae;break;case"dangerouslySetInnerHTML":if(ae!=null)throw Error(o(91));break;default:_i(c,u,J,ae,E,null)}Rf(c,R,w,U),ku(c);return;case"option":for(me in E)if(E.hasOwnProperty(me)&&(R=E[me],R!=null))switch(me){case"selected":c.selected=R&&typeof R!="function"&&typeof R!="symbol";break;default:_i(c,u,me,R,E,null)}return;case"dialog":Gn("cancel",c),Gn("close",c);break;case"iframe":case"object":Gn("load",c);break;case"video":case"audio":for(R=0;R<Xd.length;R++)Gn(Xd[R],c);break;case"image":Gn("error",c),Gn("load",c);break;case"details":Gn("toggle",c);break;case"embed":case"source":case"link":Gn("error",c),Gn("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ce in E)if(E.hasOwnProperty(Ce)&&(R=E[Ce],R!=null))switch(Ce){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,u));default:_i(c,u,Ce,R,E,null)}return;default:if(Bu(u)){for(tt in E)E.hasOwnProperty(tt)&&(R=E[tt],R!==void 0&&_S(c,u,tt,R,E,void 0));return}}for(ae in E)E.hasOwnProperty(ae)&&(R=E[ae],R!=null&&_i(c,u,ae,R,E,null))}function dE(c,u,E,R){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var w=null,U=null,J=null,ae=null,me=null,Ce=null,tt=null;for(Je in E){var _t=E[Je];if(E.hasOwnProperty(Je)&&_t!=null)switch(Je){case"checked":break;case"value":break;case"defaultValue":me=_t;default:R.hasOwnProperty(Je)||_i(c,u,Je,null,R,_t)}}for(var Ve in R){var Je=R[Ve];if(_t=E[Ve],R.hasOwnProperty(Ve)&&(Je!=null||_t!=null))switch(Ve){case"type":U=Je;break;case"name":w=Je;break;case"checked":Ce=Je;break;case"defaultChecked":tt=Je;break;case"value":J=Je;break;case"defaultValue":ae=Je;break;case"children":case"dangerouslySetInnerHTML":if(Je!=null)throw Error(o(137,u));break;default:Je!==_t&&_i(c,u,Ve,Je,R,_t)}}Uu(c,J,ae,me,Ce,tt,U,w);return;case"select":Je=J=ae=Ve=null;for(U in E)if(me=E[U],E.hasOwnProperty(U)&&me!=null)switch(U){case"value":break;case"multiple":Je=me;default:R.hasOwnProperty(U)||_i(c,u,U,null,R,me)}for(w in R)if(U=R[w],me=E[w],R.hasOwnProperty(w)&&(U!=null||me!=null))switch(w){case"value":Ve=U;break;case"defaultValue":ae=U;break;case"multiple":J=U;default:U!==me&&_i(c,u,w,U,R,me)}u=ae,E=J,R=Je,Ve!=null?ml(c,!!E,Ve,!1):!!R!=!!E&&(u!=null?ml(c,!!E,u,!0):ml(c,!!E,E?[]:"",!1));return;case"textarea":Je=Ve=null;for(ae in E)if(w=E[ae],E.hasOwnProperty(ae)&&w!=null&&!R.hasOwnProperty(ae))switch(ae){case"value":break;case"children":break;default:_i(c,u,ae,null,R,w)}for(J in R)if(w=R[J],U=E[J],R.hasOwnProperty(J)&&(w!=null||U!=null))switch(J){case"value":Ve=w;break;case"defaultValue":Je=w;break;case"children":break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(o(91));break;default:w!==U&&_i(c,u,J,w,R,U)}Rd(c,Ve,Je);return;case"option":for(var Bt in E)if(Ve=E[Bt],E.hasOwnProperty(Bt)&&Ve!=null&&!R.hasOwnProperty(Bt))switch(Bt){case"selected":c.selected=!1;break;default:_i(c,u,Bt,null,R,Ve)}for(me in R)if(Ve=R[me],Je=E[me],R.hasOwnProperty(me)&&Ve!==Je&&(Ve!=null||Je!=null))switch(me){case"selected":c.selected=Ve&&typeof Ve!="function"&&typeof Ve!="symbol";break;default:_i(c,u,me,Ve,R,Je)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var hn in E)Ve=E[hn],E.hasOwnProperty(hn)&&Ve!=null&&!R.hasOwnProperty(hn)&&_i(c,u,hn,null,R,Ve);for(Ce in R)if(Ve=R[Ce],Je=E[Ce],R.hasOwnProperty(Ce)&&Ve!==Je&&(Ve!=null||Je!=null))switch(Ce){case"children":case"dangerouslySetInnerHTML":if(Ve!=null)throw Error(o(137,u));break;default:_i(c,u,Ce,Ve,R,Je)}return;default:if(Bu(u)){for(var $i in E)Ve=E[$i],E.hasOwnProperty($i)&&Ve!==void 0&&!R.hasOwnProperty($i)&&_S(c,u,$i,void 0,R,Ve);for(tt in R)Ve=R[tt],Je=E[tt],!R.hasOwnProperty(tt)||Ve===Je||Ve===void 0&&Je===void 0||_S(c,u,tt,Ve,R,Je);return}}for(var Ne in E)Ve=E[Ne],E.hasOwnProperty(Ne)&&Ve!=null&&!R.hasOwnProperty(Ne)&&_i(c,u,Ne,null,R,Ve);for(_t in R)Ve=R[_t],Je=E[_t],!R.hasOwnProperty(_t)||Ve===Je||Ve==null&&Je==null||_i(c,u,_t,Ve,R,Je)}var SS=null,yS=null;function uE(c){return c.nodeType===9?c:c.ownerDocument}function Bv(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Vv(c,u){if(c===0)switch(u){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&u==="foreignObject"?0:c}function TS(c,u){return c==="textarea"||c==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.children=="bigint"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var vS=null;function KC(){var c=window.event;return c&&c.type==="popstate"?c===vS?!1:(vS=c,!0):(vS=null,!1)}var jv=typeof setTimeout=="function"?setTimeout:void 0,WC=typeof clearTimeout=="function"?clearTimeout:void 0,Gv=typeof Promise=="function"?Promise:void 0,YC=typeof queueMicrotask=="function"?queueMicrotask:typeof Gv<"u"?function(c){return Gv.resolve(null).then(c).catch(qC)}:jv;function qC(c){setTimeout(function(){throw c})}function bS(c,u){var E=u,R=0;do{var w=E.nextSibling;if(c.removeChild(E),w&&w.nodeType===8)if(E=w.data,E==="/$"){if(R===0){c.removeChild(w),Gp(u);return}R--}else E!=="$"&&E!=="$?"&&E!=="$!"||R++;E=w}while(E);Gp(u)}function RS(c){var u=c.firstChild;for(u&&u.nodeType===10&&(u=u.nextSibling);u;){var E=u;switch(u=u.nextSibling,E.nodeName){case"HTML":case"HEAD":case"BODY":RS(E),Ta(E);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(E.rel.toLowerCase()==="stylesheet")continue}c.removeChild(E)}}function $C(c,u,E,R){for(;c.nodeType===1;){var w=E;if(c.nodeName.toLowerCase()!==u.toLowerCase()){if(!R&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(R){if(!c[fl])switch(u){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(U=c.getAttribute("rel"),U==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(U!==w.rel||c.getAttribute("href")!==(w.href==null?null:w.href)||c.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin)||c.getAttribute("title")!==(w.title==null?null:w.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(U=c.getAttribute("src"),(U!==(w.src==null?null:w.src)||c.getAttribute("type")!==(w.type==null?null:w.type)||c.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin))&&U&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(u==="input"&&c.type==="hidden"){var U=w.name==null?null:""+w.name;if(w.type==="hidden"&&c.getAttribute("name")===U)return c}else return c;if(c=Oa(c.nextSibling),c===null)break}return null}function zC(c,u,E){if(u==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!E||(c=Oa(c.nextSibling),c===null))return null;return c}function Oa(c){for(;c!=null;c=c.nextSibling){var u=c.nodeType;if(u===1||u===3)break;if(u===8){if(u=c.data,u==="$"||u==="$!"||u==="$?"||u==="F!"||u==="F")break;if(u==="/$")return null}}return c}function Hv(c){c=c.previousSibling;for(var u=0;c;){if(c.nodeType===8){var E=c.data;if(E==="$"||E==="$!"||E==="$?"){if(u===0)return c;u--}else E==="/$"&&u++}c=c.previousSibling}return null}function Kv(c,u,E){switch(u=uE(E),c){case"html":if(c=u.documentElement,!c)throw Error(o(452));return c;case"head":if(c=u.head,!c)throw Error(o(453));return c;case"body":if(c=u.body,!c)throw Error(o(454));return c;default:throw Error(o(451))}}var Da=new Map,Wv=new Set;function hE(c){return typeof c.getRootNode=="function"?c.getRootNode():c.ownerDocument}var jc=Be.d;Be.d={f:XC,r:JC,D:QC,C:ZC,L:eI,m:tI,X:iI,S:nI,M:sI};function XC(){var c=jc.f(),u=Zg();return c||u}function JC(c){var u=pc(c);u!==null&&u.tag===5&&u.type==="form"?ev(u):jc.r(c)}var Ih=typeof document>"u"?null:document;function Yv(c,u,E){var R=Ih;if(R&&typeof u=="string"&&u){var w=Xs(u);w='link[rel="'+c+'"][href="'+w+'"]',typeof E=="string"&&(w+='[crossorigin="'+E+'"]'),Wv.has(w)||(Wv.add(w),c={rel:c,crossOrigin:E,href:u},R.querySelector(w)===null&&(u=R.createElement("link"),tr(u,"link",c),ys(u),R.head.appendChild(u)))}}function QC(c){jc.D(c),Yv("dns-prefetch",c,null)}function ZC(c,u){jc.C(c,u),Yv("preconnect",c,u)}function eI(c,u,E){jc.L(c,u,E);var R=Ih;if(R&&c&&u){var w='link[rel="preload"][as="'+Xs(u)+'"]';u==="image"&&E&&E.imageSrcSet?(w+='[imagesrcset="'+Xs(E.imageSrcSet)+'"]',typeof E.imageSizes=="string"&&(w+='[imagesizes="'+Xs(E.imageSizes)+'"]')):w+='[href="'+Xs(c)+'"]';var U=w;switch(u){case"style":U=wh(c);break;case"script":U=Oh(c)}Da.has(U)||(c=he({rel:"preload",href:u==="image"&&E&&E.imageSrcSet?void 0:c,as:u},E),Da.set(U,c),R.querySelector(w)!==null||u==="style"&&R.querySelector(Qd(U))||u==="script"&&R.querySelector(xp(U))||(u=R.createElement("link"),tr(u,"link",c),ys(u),R.head.appendChild(u)))}}function tI(c,u){jc.m(c,u);var E=Ih;if(E&&c){var R=u&&typeof u.as=="string"?u.as:"script",w='link[rel="modulepreload"][as="'+Xs(R)+'"][href="'+Xs(c)+'"]',U=w;switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":U=Oh(c)}if(!Da.has(U)&&(c=he({rel:"modulepreload",href:c},u),Da.set(U,c),E.querySelector(w)===null)){switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(E.querySelector(xp(U)))return}R=E.createElement("link"),tr(R,"link",c),ys(R),E.head.appendChild(R)}}}function nI(c,u,E){jc.S(c,u,E);var R=Ih;if(R&&c){var w=Ti(R).hoistableStyles,U=wh(c);u=u||"default";var J=w.get(U);if(!J){var ae={loading:0,preload:null};if(J=R.querySelector(Qd(U)))ae.loading=5;else{c=he({rel:"stylesheet",href:c,"data-precedence":u},E),(E=Da.get(U))&&Pp(c,E);var me=J=R.createElement("link");ys(me),tr(me,"link",c),me._p=new Promise(function(Ce,tt){me.onload=Ce,me.onerror=tt}),me.addEventListener("load",function(){ae.loading|=1}),me.addEventListener("error",function(){ae.loading|=2}),ae.loading|=4,fE(J,u,R)}J={type:"stylesheet",instance:J,count:1,state:ae},w.set(U,J)}}}function iI(c,u){jc.X(c,u);var E=Ih;if(E&&c){var R=Ti(E).hoistableScripts,w=Oh(c),U=R.get(w);U||(U=E.querySelector(xp(w)),U||(c=he({src:c,async:!0},u),(u=Da.get(w))&&IS(c,u),U=E.createElement("script"),ys(U),tr(U,"link",c),E.head.appendChild(U)),U={type:"script",instance:U,count:1,state:null},R.set(w,U))}}function sI(c,u){jc.M(c,u);var E=Ih;if(E&&c){var R=Ti(E).hoistableScripts,w=Oh(c),U=R.get(w);U||(U=E.querySelector(xp(w)),U||(c=he({src:c,async:!0,type:"module"},u),(u=Da.get(w))&&IS(c,u),U=E.createElement("script"),ys(U),tr(U,"link",c),E.head.appendChild(U)),U={type:"script",instance:U,count:1,state:null},R.set(w,U))}}function AS(c,u,E,R){var w=(w=ei.current)?hE(w):null;if(!w)throw Error(o(446));switch(c){case"meta":case"title":return null;case"style":return typeof E.precedence=="string"&&typeof E.href=="string"?(u=wh(E.href),E=Ti(w).hoistableStyles,R=E.get(u),R||(R={type:"style",instance:null,count:0,state:null},E.set(u,R)),R):{type:"void",instance:null,count:0,state:null};case"link":if(E.rel==="stylesheet"&&typeof E.href=="string"&&typeof E.precedence=="string"){c=wh(E.href);var U=Ti(w).hoistableStyles,J=U.get(c);if(J||(w=w.ownerDocument||w,J={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},U.set(c,J),(U=w.querySelector(Qd(c)))&&!U._p&&(J.instance=U,J.state.loading=5),Da.has(c)||(E={rel:"preload",as:"style",href:E.href,crossOrigin:E.crossOrigin,integrity:E.integrity,media:E.media,hrefLang:E.hrefLang,referrerPolicy:E.referrerPolicy},Da.set(c,E),U||rI(w,c,E,J.state))),u&&R===null)throw Error(o(528,""));return J}if(u&&R!==null)throw Error(o(529,""));return null;case"script":return u=E.async,E=E.src,typeof E=="string"&&u&&typeof u!="function"&&typeof u!="symbol"?(u=Oh(E),E=Ti(w).hoistableScripts,R=E.get(u),R||(R={type:"script",instance:null,count:0,state:null},E.set(u,R)),R):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,c))}}function wh(c){return'href="'+Xs(c)+'"'}function Qd(c){return'link[rel="stylesheet"]['+c+"]"}function qv(c){return he({},c,{"data-precedence":c.precedence,precedence:null})}function rI(c,u,E,R){c.querySelector('link[rel="preload"][as="style"]['+u+"]")?R.loading=1:(u=c.createElement("link"),R.preload=u,u.addEventListener("load",function(){return R.loading|=1}),u.addEventListener("error",function(){return R.loading|=2}),tr(u,"link",E),ys(u),c.head.appendChild(u))}function Oh(c){return'[src="'+Xs(c)+'"]'}function xp(c){return"script[async]"+c}function CS(c,u,E){if(u.count++,u.instance===null)switch(u.type){case"style":var R=c.querySelector('style[data-href~="'+Xs(E.href)+'"]');if(R)return u.instance=R,ys(R),R;var w=he({},E,{"data-href":E.href,"data-precedence":E.precedence,href:null,precedence:null});return R=(c.ownerDocument||c).createElement("style"),ys(R),tr(R,"style",w),fE(R,E.precedence,c),u.instance=R;case"stylesheet":w=wh(E.href);var U=c.querySelector(Qd(w));if(U)return u.state.loading|=4,u.instance=U,ys(U),U;R=qv(E),(w=Da.get(w))&&Pp(R,w),U=(c.ownerDocument||c).createElement("link"),ys(U);var J=U;return J._p=new Promise(function(ae,me){J.onload=ae,J.onerror=me}),tr(U,"link",R),u.state.loading|=4,fE(U,E.precedence,c),u.instance=U;case"script":return U=Oh(E.src),(w=c.querySelector(xp(U)))?(u.instance=w,ys(w),w):(R=E,(w=Da.get(U))&&(R=he({},E),IS(R,w)),c=c.ownerDocument||c,w=c.createElement("script"),ys(w),tr(w,"link",R),c.head.appendChild(w),u.instance=w);case"void":return null;default:throw Error(o(443,u.type))}else u.type==="stylesheet"&&(u.state.loading&4)===0&&(R=u.instance,u.state.loading|=4,fE(R,E.precedence,c));return u.instance}function fE(c,u,E){for(var R=E.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),w=R.length?R[R.length-1]:null,U=w,J=0;J<R.length;J++){var ae=R[J];if(ae.dataset.precedence===u)U=ae;else if(U!==w)break}U?U.parentNode.insertBefore(c,U.nextSibling):(u=E.nodeType===9?E.head:E,u.insertBefore(c,u.firstChild))}function Pp(c,u){c.crossOrigin==null&&(c.crossOrigin=u.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=u.referrerPolicy),c.title==null&&(c.title=u.title)}function IS(c,u){c.crossOrigin==null&&(c.crossOrigin=u.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=u.referrerPolicy),c.integrity==null&&(c.integrity=u.integrity)}var pE=null;function $v(c,u,E){if(pE===null){var R=new Map,w=pE=new Map;w.set(E,R)}else w=pE,R=w.get(E),R||(R=new Map,w.set(E,R));if(R.has(c))return R;for(R.set(c,null),E=E.getElementsByTagName(c),w=0;w<E.length;w++){var U=E[w];if(!(U[fl]||U[Fs]||c==="link"&&U.getAttribute("rel")==="stylesheet")&&U.namespaceURI!=="http://www.w3.org/2000/svg"){var J=U.getAttribute(u)||"";J=c+J;var ae=R.get(J);ae?ae.push(U):R.set(J,[U])}}return R}function zv(c,u,E){c=c.ownerDocument||c,c.head.insertBefore(E,u==="title"?c.querySelector("head > title"):null)}function Xv(c,u,E){if(E===1||u.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof u.precedence!="string"||typeof u.href!="string"||u.href==="")break;return!0;case"link":if(typeof u.rel!="string"||typeof u.href!="string"||u.href===""||u.onLoad||u.onError)break;switch(u.rel){case"stylesheet":return c=u.disabled,typeof u.precedence=="string"&&c==null;default:return!0}case"script":if(u.async&&typeof u.async!="function"&&typeof u.async!="symbol"&&!u.onLoad&&!u.onError&&u.src&&typeof u.src=="string")return!0}return!1}function Jv(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}var Dh=null;function wS(){}function aI(c,u,E){if(Dh===null)throw Error(o(475));var R=Dh;if(u.type==="stylesheet"&&(typeof E.media!="string"||matchMedia(E.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var w=wh(E.href),U=c.querySelector(Qd(w));if(U){c=U._p,c!==null&&typeof c=="object"&&typeof c.then=="function"&&(R.count++,R=kp.bind(R),c.then(R,R)),u.state.loading|=4,u.instance=U,ys(U);return}U=c.ownerDocument||c,E=qv(E),(w=Da.get(w))&&Pp(E,w),U=U.createElement("link"),ys(U);var J=U;J._p=new Promise(function(ae,me){J.onload=ae,J.onerror=me}),tr(U,"link",E),u.instance=U}R.stylesheets===null&&(R.stylesheets=new Map),R.stylesheets.set(u,c),(c=u.state.preload)&&(u.state.loading&3)===0&&(R.count++,u=kp.bind(R),c.addEventListener("load",u),c.addEventListener("error",u))}}function oI(){if(Dh===null)throw Error(o(475));var c=Dh;return c.stylesheets&&c.count===0&&gE(c,c.stylesheets),0<c.count?function(u){var E=setTimeout(function(){if(c.stylesheets&&gE(c,c.stylesheets),c.unsuspend){var R=c.unsuspend;c.unsuspend=null,R()}},6e4);return c.unsuspend=u,function(){c.unsuspend=null,clearTimeout(E)}}:null}function kp(){if(this.count--,this.count===0){if(this.stylesheets)gE(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var mE=null;function gE(c,u){c.stylesheets=null,c.unsuspend!==null&&(c.count++,mE=new Map,u.forEach(Qv,c),mE=null,kp.call(c))}function Qv(c,u){if(!(u.state.loading&4)){var E=mE.get(c);if(E)var R=E.get(null);else{E=new Map,mE.set(c,E);for(var w=c.querySelectorAll("link[data-precedence],style[data-precedence]"),U=0;U<w.length;U++){var J=w[U];(J.nodeName==="LINK"||J.getAttribute("media")!=="not all")&&(E.set(J.dataset.precedence,J),R=J)}R&&E.set(null,R)}w=u.instance,J=w.getAttribute("data-precedence"),U=E.get(J)||R,U===R&&E.set(null,w),E.set(J,w),this.count++,R=kp.bind(this),w.addEventListener("load",R),w.addEventListener("error",R),U?U.parentNode.insertBefore(w,U.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(w,c.firstChild)),u.state.loading|=4}}var Mp={$$typeof:N,Provider:null,Consumer:null,_currentValue:Et,_currentValue2:Et,_threadCount:0};function cI(c,u,E,R,w,U,J,ae){this.tag=1,this.containerInfo=c,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=mf(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mf(0),this.hiddenUpdates=mf(null),this.identifierPrefix=R,this.onUncaughtError=w,this.onCaughtError=U,this.onRecoverableError=J,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ae,this.incompleteTransitions=new Map}function Zv(c,u,E,R,w,U,J,ae,me,Ce,tt,_t){return c=new cI(c,u,E,J,ae,me,Ce,_t),u=1,U===!0&&(u|=24),U=ha(3,null,null,u),c.current=U,U.stateNode=c,u=e0(),u.refCount++,c.pooledCache=u,u.refCount++,U.memoizedState={element:R,isDehydrated:E,cache:u},ph(U),c}function eb(c){return c?(c=xo,c):xo}function tb(c,u,E,R,w,U){w=eb(w),R.context===null?R.context=w:R.pendingContext=w,R=Pc(u),R.payload={element:E},U=U===void 0?null:U,U!==null&&(R.callback=U),E=Za(c,R,u),E!==null&&(bs(E,c,u),mh(E,c,u))}function nb(c,u){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var E=c.retryLane;c.retryLane=E!==0&&E<u?E:u}}function OS(c,u){nb(c,u),(c=c.alternate)&&nb(c,u)}function DS(c){if(c.tag===13){var u=Lo(c,67108864);u!==null&&bs(u,c,67108864),OS(c,67108864)}}var Up=!0;function NS(c,u,E,R){var w=_e.T;_e.T=null;var U=Be.p;try{Be.p=2,Fp(c,u,E,R)}finally{Be.p=U,_e.T=w}}function ib(c,u,E,R){var w=_e.T;_e.T=null;var U=Be.p;try{Be.p=8,Fp(c,u,E,R)}finally{Be.p=U,_e.T=w}}function Fp(c,u,E,R){if(Up){var w=EE(R);if(w===null)cE(c,u,R,Ye,E),rb(c,R);else if(dI(w,c,u,E,R))R.stopPropagation();else if(rb(c,R),u&4&&-1<lI.indexOf(c)){for(;w!==null;){var U=pc(w);if(U!==null)switch(U.tag){case 3:if(U=U.stateNode,U.current.memoizedState.isDehydrated){var J=hc(U.pendingLanes);if(J!==0){var ae=U;for(ae.pendingLanes|=2,ae.entangledLanes|=2;J;){var me=1<<31-Cr(J);ae.entanglements[1]|=me,J&=~me}Go(U),(Gi&6)===0&&(zg=Xt()+500,Rh(0))}}break;case 13:ae=Lo(U,2),ae!==null&&bs(ae,U,2),Zg(),OS(U,2)}if(U=EE(R),U===null&&cE(c,u,R,Ye,E),U===w)break;w=U}w!==null&&R.stopPropagation()}else cE(c,u,R,null,E)}}function EE(c){return c=Cd(c),LS(c)}var Ye=null;function LS(c){if(Ye=null,c=ia(c),c!==null){var u=Ke(c);if(u===null)c=null;else{var E=u.tag;if(E===13){if(c=Re(u),c!==null)return c;c=null}else if(E===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;c=null}else u!==c&&(c=null)}}return Ye=c,null}function sb(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(zn()){case hs:return 2;case Nn:return 8;case hi:case uc:return 32;case yo:return 268435456;default:return 32}default:return 32}}var xS=!1,jl=null,Gl=null,Ho=null,Bp=new Map,Vp=new Map,ps=[],lI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function rb(c,u){switch(c){case"focusin":case"focusout":jl=null;break;case"dragenter":case"dragleave":Gl=null;break;case"mouseover":case"mouseout":Ho=null;break;case"pointerover":case"pointerout":Bp.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vp.delete(u.pointerId)}}function Zd(c,u,E,R,w,U){return c===null||c.nativeEvent!==U?(c={blockedOn:u,domEventName:E,eventSystemFlags:R,nativeEvent:U,targetContainers:[w]},u!==null&&(u=pc(u),u!==null&&DS(u)),c):(c.eventSystemFlags|=R,u=c.targetContainers,w!==null&&u.indexOf(w)===-1&&u.push(w),c)}function dI(c,u,E,R,w){switch(u){case"focusin":return jl=Zd(jl,c,u,E,R,w),!0;case"dragenter":return Gl=Zd(Gl,c,u,E,R,w),!0;case"mouseover":return Ho=Zd(Ho,c,u,E,R,w),!0;case"pointerover":var U=w.pointerId;return Bp.set(U,Zd(Bp.get(U)||null,c,u,E,R,w)),!0;case"gotpointercapture":return U=w.pointerId,Vp.set(U,Zd(Vp.get(U)||null,c,u,E,R,w)),!0}return!1}function ab(c){var u=ia(c.target);if(u!==null){var E=Ke(u);if(E!==null){if(u=E.tag,u===13){if(u=Re(E),u!==null){c.blockedOn=u,Bm(c.priority,function(){if(E.tag===13){var R=gr(),w=Lo(E,R);w!==null&&bs(w,E,R),OS(E,R)}});return}}else if(u===3&&E.stateNode.current.memoizedState.isDehydrated){c.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}c.blockedOn=null}function _E(c){if(c.blockedOn!==null)return!1;for(var u=c.targetContainers;0<u.length;){var E=EE(c.nativeEvent);if(E===null){E=c.nativeEvent;var R=new E.constructor(E.type,E);Cf=R,E.target.dispatchEvent(R),Cf=null}else return u=pc(E),u!==null&&DS(u),c.blockedOn=E,!1;u.shift()}return!0}function ob(c,u,E){_E(c)&&E.delete(u)}function SE(){xS=!1,jl!==null&&_E(jl)&&(jl=null),Gl!==null&&_E(Gl)&&(Gl=null),Ho!==null&&_E(Ho)&&(Ho=null),Bp.forEach(ob),Vp.forEach(ob)}function jp(c,u){c.blockedOn===u&&(c.blockedOn=null,xS||(xS=!0,h.unstable_scheduleCallback(h.unstable_NormalPriority,SE)))}var yE=null;function cb(c){yE!==c&&(yE=c,h.unstable_scheduleCallback(h.unstable_NormalPriority,function(){yE===c&&(yE=null);for(var u=0;u<c.length;u+=3){var E=c[u],R=c[u+1],w=c[u+2];if(typeof R!="function"){if(LS(R||E)===null)continue;break}var U=pc(E);U!==null&&(c.splice(u,3),u-=3,m0(U,{pending:!0,data:w,method:E.method,action:R},R,w))}}))}function Gp(c){function u(me){return jp(me,c)}jl!==null&&jp(jl,c),Gl!==null&&jp(Gl,c),Ho!==null&&jp(Ho,c),Bp.forEach(u),Vp.forEach(u);for(var E=0;E<ps.length;E++){var R=ps[E];R.blockedOn===c&&(R.blockedOn=null)}for(;0<ps.length&&(E=ps[0],E.blockedOn===null);)ab(E),E.blockedOn===null&&ps.shift();if(E=(c.ownerDocument||c).$$reactFormReplay,E!=null)for(R=0;R<E.length;R+=3){var w=E[R],U=E[R+1],J=w[_n]||null;if(typeof U=="function")J||cb(E);else if(J){var ae=null;if(U&&U.hasAttribute("formAction")){if(w=U,J=U[_n]||null)ae=J.formAction;else if(LS(w)!==null)continue}else ae=J.action;typeof ae=="function"?E[R+1]=ae:(E.splice(R,3),R-=3),cb(E)}}}function PS(c){this._internalRoot=c}Nh.prototype.render=PS.prototype.render=function(c){var u=this._internalRoot;if(u===null)throw Error(o(409));var E=u.current,R=gr();tb(E,R,c,u,null,null)},Nh.prototype.unmount=PS.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var u=c.containerInfo;c.tag===0&&Bc(),tb(c.current,2,null,c,null,null),Zg(),u[fc]=null}};function Nh(c){this._internalRoot=c}Nh.prototype.unstable_scheduleHydration=function(c){if(c){var u=gf();c={blockedOn:null,target:c,priority:u};for(var E=0;E<ps.length&&u!==0&&u<ps[E].priority;E++);ps.splice(E,0,c),E===0&&ab(c)}};var kS=i.version;if(kS!=="19.0.0")throw Error(o(527,kS,"19.0.0"));Be.findDOMNode=function(c){var u=c._reactInternals;if(u===void 0)throw typeof c.render=="function"?Error(o(188)):(c=Object.keys(c).join(","),Error(o(268,c)));return c=we(u),c=c!==null?He(c):null,c=c===null?null:c.stateNode,c};var uI={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:_e,findFiberByHostInstance:ia,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lh.isDisabled&&Lh.supportsFiber)try{ul=Lh.inject(uI),qs=Lh}catch{}}return $y.createRoot=function(c,u){if(!d(c))throw Error(o(299));var E=!1,R="",w=Qa,U=Ud,J=Ll,ae=null;return u!=null&&(u.unstable_strictMode===!0&&(E=!0),u.identifierPrefix!==void 0&&(R=u.identifierPrefix),u.onUncaughtError!==void 0&&(w=u.onUncaughtError),u.onCaughtError!==void 0&&(U=u.onCaughtError),u.onRecoverableError!==void 0&&(J=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(ae=u.unstable_transitionCallbacks)),u=Zv(c,1,!1,null,null,E,R,w,U,J,ae,null),c[fc]=u.current,oE(c.nodeType===8?c.parentNode:c),new PS(u)},$y.hydrateRoot=function(c,u,E){if(!d(c))throw Error(o(299));var R=!1,w="",U=Qa,J=Ud,ae=Ll,me=null,Ce=null;return E!=null&&(E.unstable_strictMode===!0&&(R=!0),E.identifierPrefix!==void 0&&(w=E.identifierPrefix),E.onUncaughtError!==void 0&&(U=E.onUncaughtError),E.onCaughtError!==void 0&&(J=E.onCaughtError),E.onRecoverableError!==void 0&&(ae=E.onRecoverableError),E.unstable_transitionCallbacks!==void 0&&(me=E.unstable_transitionCallbacks),E.formState!==void 0&&(Ce=E.formState)),u=Zv(c,1,!0,u,E??null,R,w,U,J,ae,me,Ce),u.context=eb(null),E=u.current,R=gr(),w=Pc(R),w.callback=null,Za(E,w,R),u.current.lanes=R,vd(u,R),Go(u),c[fc]=u.current,oE(c),new Nh(u)},$y.version="19.0.0",$y}var h3;function T9(){if(h3)return WD.exports;h3=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(i){console.error(i)}}return h(),WD.exports=y9(),WD.exports}var v9=T9(),zy={},f3;function b9(){if(f3)return zy;f3=1,Object.defineProperty(zy,"__esModule",{value:!0}),zy.parse=g,zy.serialize=T;const h=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,i=/^[\u0021-\u003A\u003C-\u007E]*$/,r=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,o=/^[\u0020-\u003A\u003D-\u007E]*$/,d=Object.prototype.toString,p=(()=>{const L=function(){};return L.prototype=Object.create(null),L})();function g(L,N){const x=new p,K=L.length;if(K<2)return x;const H=(N==null?void 0:N.decode)||C;let Q=0;do{const ne=L.indexOf("=",Q);if(ne===-1)break;const ee=L.indexOf(";",Q),pe=ee===-1?K:ee;if(ne>pe){Q=L.lastIndexOf(";",ne-1)+1;continue}const de=y(L,Q,ne),be=v(L,ne,de),Se=L.slice(de,be);if(x[Se]===void 0){let Te=y(L,ne+1,pe),_e=v(L,pe,Te);const he=H(L.slice(Te,_e));x[Se]=he}Q=pe+1}while(Q<K);return x}function y(L,N,x){do{const K=L.charCodeAt(N);if(K!==32&&K!==9)return N}while(++N<x);return x}function v(L,N,x){for(;N>x;){const K=L.charCodeAt(--N);if(K!==32&&K!==9)return N+1}return x}function T(L,N,x){const K=(x==null?void 0:x.encode)||encodeURIComponent;if(!h.test(L))throw new TypeError(`argument name is invalid: ${L}`);const H=K(N);if(!i.test(H))throw new TypeError(`argument val is invalid: ${N}`);let Q=L+"="+H;if(!x)return Q;if(x.maxAge!==void 0){if(!Number.isInteger(x.maxAge))throw new TypeError(`option maxAge is invalid: ${x.maxAge}`);Q+="; Max-Age="+x.maxAge}if(x.domain){if(!r.test(x.domain))throw new TypeError(`option domain is invalid: ${x.domain}`);Q+="; Domain="+x.domain}if(x.path){if(!o.test(x.path))throw new TypeError(`option path is invalid: ${x.path}`);Q+="; Path="+x.path}if(x.expires){if(!I(x.expires)||!Number.isFinite(x.expires.valueOf()))throw new TypeError(`option expires is invalid: ${x.expires}`);Q+="; Expires="+x.expires.toUTCString()}if(x.httpOnly&&(Q+="; HttpOnly"),x.secure&&(Q+="; Secure"),x.partitioned&&(Q+="; Partitioned"),x.priority)switch(typeof x.priority=="string"?x.priority.toLowerCase():void 0){case"low":Q+="; Priority=Low";break;case"medium":Q+="; Priority=Medium";break;case"high":Q+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${x.priority}`)}if(x.sameSite)switch(typeof x.sameSite=="string"?x.sameSite.toLowerCase():x.sameSite){case!0:case"strict":Q+="; SameSite=Strict";break;case"lax":Q+="; SameSite=Lax";break;case"none":Q+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${x.sameSite}`)}return Q}function C(L){if(L.indexOf("%")===-1)return L;try{return decodeURIComponent(L)}catch{return L}}function I(L){return d.call(L)==="[object Date]"}return zy}b9();/**
 * react-router v7.4.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var p3="popstate";function R9(h={}){function i(o,d){let{pathname:p,search:g,hash:y}=o.location;return CN("",{pathname:p,search:g,hash:y},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function r(o,d){return typeof d=="string"?d:rT(d)}return C9(i,r,null,h)}function us(h,i){if(h===!1||h===null||typeof h>"u")throw new Error(i)}function cl(h,i){if(!h){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function A9(){return Math.random().toString(36).substring(2,10)}function m3(h,i){return{usr:h.state,key:h.key,idx:i}}function CN(h,i,r=null,o){return{pathname:typeof h=="string"?h:h.pathname,search:"",hash:"",...typeof i=="string"?x_(i):i,state:r,key:i&&i.key||o||A9()}}function rT({pathname:h="/",search:i="",hash:r=""}){return i&&i!=="?"&&(h+=i.charAt(0)==="?"?i:"?"+i),r&&r!=="#"&&(h+=r.charAt(0)==="#"?r:"#"+r),h}function x_(h){let i={};if(h){let r=h.indexOf("#");r>=0&&(i.hash=h.substring(r),h=h.substring(0,r));let o=h.indexOf("?");o>=0&&(i.search=h.substring(o),h=h.substring(0,o)),h&&(i.pathname=h)}return i}function C9(h,i,r,o={}){let{window:d=document.defaultView,v5Compat:p=!1}=o,g=d.history,y="POP",v=null,T=C();T==null&&(T=0,g.replaceState({...g.state,idx:T},""));function C(){return(g.state||{idx:null}).idx}function I(){y="POP";let H=C(),Q=H==null?null:H-T;T=H,v&&v({action:y,location:K.location,delta:Q})}function L(H,Q){y="PUSH";let ne=CN(K.location,H,Q);T=C()+1;let ee=m3(ne,T),pe=K.createHref(ne);try{g.pushState(ee,"",pe)}catch(de){if(de instanceof DOMException&&de.name==="DataCloneError")throw de;d.location.assign(pe)}p&&v&&v({action:y,location:K.location,delta:1})}function N(H,Q){y="REPLACE";let ne=CN(K.location,H,Q);T=C();let ee=m3(ne,T),pe=K.createHref(ne);g.replaceState(ee,"",pe),p&&v&&v({action:y,location:K.location,delta:0})}function x(H){let Q=d.location.origin!=="null"?d.location.origin:d.location.href,ne=typeof H=="string"?H:rT(H);return ne=ne.replace(/ $/,"%20"),us(Q,`No window.location.(origin|href) available to create URL for href: ${ne}`),new URL(ne,Q)}let K={get action(){return y},get location(){return h(d,g)},listen(H){if(v)throw new Error("A history only accepts one active listener");return d.addEventListener(p3,I),v=H,()=>{d.removeEventListener(p3,I),v=null}},createHref(H){return i(d,H)},createURL:x,encodeLocation(H){let Q=x(H);return{pathname:Q.pathname,search:Q.search,hash:Q.hash}},push:L,replace:N,go(H){return g.go(H)}};return K}function Q4(h,i,r="/"){return I9(h,i,r,!1)}function I9(h,i,r,o){let d=typeof i=="string"?x_(i):i,p=Iu(d.pathname||"/",r);if(p==null)return null;let g=Z4(h);w9(g);let y=null;for(let v=0;y==null&&v<g.length;++v){let T=B9(p);y=U9(g[v],T,o)}return y}function Z4(h,i=[],r=[],o=""){let d=(p,g,y)=>{let v={relativePath:y===void 0?p.path||"":y,caseSensitive:p.caseSensitive===!0,childrenIndex:g,route:p};v.relativePath.startsWith("/")&&(us(v.relativePath.startsWith(o),`Absolute route path "${v.relativePath}" nested under path "${o}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),v.relativePath=v.relativePath.slice(o.length));let T=Cu([o,v.relativePath]),C=r.concat(v);p.children&&p.children.length>0&&(us(p.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${T}".`),Z4(p.children,i,C,T)),!(p.path==null&&!p.index)&&i.push({path:T,score:k9(T,p.index),routesMeta:C})};return h.forEach((p,g)=>{var y;if(p.path===""||!((y=p.path)!=null&&y.includes("?")))d(p,g);else for(let v of eG(p.path))d(p,g,v)}),i}function eG(h){let i=h.split("/");if(i.length===0)return[];let[r,...o]=i,d=r.endsWith("?"),p=r.replace(/\?$/,"");if(o.length===0)return d?[p,""]:[p];let g=eG(o.join("/")),y=[];return y.push(...g.map(v=>v===""?p:[p,v].join("/"))),d&&y.push(...g),y.map(v=>h.startsWith("/")&&v===""?"/":v)}function w9(h){h.sort((i,r)=>i.score!==r.score?r.score-i.score:M9(i.routesMeta.map(o=>o.childrenIndex),r.routesMeta.map(o=>o.childrenIndex)))}var O9=/^:[\w-]+$/,D9=3,N9=2,L9=1,x9=10,P9=-2,g3=h=>h==="*";function k9(h,i){let r=h.split("/"),o=r.length;return r.some(g3)&&(o+=P9),i&&(o+=N9),r.filter(d=>!g3(d)).reduce((d,p)=>d+(O9.test(p)?D9:p===""?L9:x9),o)}function M9(h,i){return h.length===i.length&&h.slice(0,-1).every((o,d)=>o===i[d])?h[h.length-1]-i[i.length-1]:0}function U9(h,i,r=!1){let{routesMeta:o}=h,d={},p="/",g=[];for(let y=0;y<o.length;++y){let v=o[y],T=y===o.length-1,C=p==="/"?i:i.slice(p.length)||"/",I=eC({path:v.relativePath,caseSensitive:v.caseSensitive,end:T},C),L=v.route;if(!I&&T&&r&&!o[o.length-1].route.index&&(I=eC({path:v.relativePath,caseSensitive:v.caseSensitive,end:!1},C)),!I)return null;Object.assign(d,I.params),g.push({params:d,pathname:Cu([p,I.pathname]),pathnameBase:H9(Cu([p,I.pathnameBase])),route:L}),I.pathnameBase!=="/"&&(p=Cu([p,I.pathnameBase]))}return g}function eC(h,i){typeof h=="string"&&(h={path:h,caseSensitive:!1,end:!0});let[r,o]=F9(h.path,h.caseSensitive,h.end),d=i.match(r);if(!d)return null;let p=d[0],g=p.replace(/(.)\/+$/,"$1"),y=d.slice(1);return{params:o.reduce((T,{paramName:C,isOptional:I},L)=>{if(C==="*"){let x=y[L]||"";g=p.slice(0,p.length-x.length).replace(/(.)\/+$/,"$1")}const N=y[L];return I&&!N?T[C]=void 0:T[C]=(N||"").replace(/%2F/g,"/"),T},{}),pathname:p,pathnameBase:g,pattern:h}}function F9(h,i=!1,r=!0){cl(h==="*"||!h.endsWith("*")||h.endsWith("/*"),`Route path "${h}" will be treated as if it were "${h.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${h.replace(/\*$/,"/*")}".`);let o=[],d="^"+h.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,y,v)=>(o.push({paramName:y,isOptional:v!=null}),v?"/?([^\\/]+)?":"/([^\\/]+)"));return h.endsWith("*")?(o.push({paramName:"*"}),d+=h==="*"||h==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?d+="\\/*$":h!==""&&h!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,i?void 0:"i"),o]}function B9(h){try{return h.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return cl(!1,`The URL path "${h}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${i}).`),h}}function Iu(h,i){if(i==="/")return h;if(!h.toLowerCase().startsWith(i.toLowerCase()))return null;let r=i.endsWith("/")?i.length-1:i.length,o=h.charAt(r);return o&&o!=="/"?null:h.slice(r)||"/"}function V9(h,i="/"){let{pathname:r,search:o="",hash:d=""}=typeof h=="string"?x_(h):h;return{pathname:r?r.startsWith("/")?r:j9(r,i):i,search:K9(o),hash:W9(d)}}function j9(h,i){let r=i.replace(/\/+$/,"").split("/");return h.split("/").forEach(d=>{d===".."?r.length>1&&r.pop():d!=="."&&r.push(d)}),r.length>1?r.join("/"):"/"}function zD(h,i,r,o){return`Cannot include a '${h}' character in a manually specified \`to.${i}\` field [${JSON.stringify(o)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function G9(h){return h.filter((i,r)=>r===0||i.route.path&&i.route.path.length>0)}function iL(h){let i=G9(h);return i.map((r,o)=>o===i.length-1?r.pathname:r.pathnameBase)}function sL(h,i,r,o=!1){let d;typeof h=="string"?d=x_(h):(d={...h},us(!d.pathname||!d.pathname.includes("?"),zD("?","pathname","search",d)),us(!d.pathname||!d.pathname.includes("#"),zD("#","pathname","hash",d)),us(!d.search||!d.search.includes("#"),zD("#","search","hash",d)));let p=h===""||d.pathname==="",g=p?"/":d.pathname,y;if(g==null)y=r;else{let I=i.length-1;if(!o&&g.startsWith("..")){let L=g.split("/");for(;L[0]==="..";)L.shift(),I-=1;d.pathname=L.join("/")}y=I>=0?i[I]:"/"}let v=V9(d,y),T=g&&g!=="/"&&g.endsWith("/"),C=(p||g===".")&&r.endsWith("/");return!v.pathname.endsWith("/")&&(T||C)&&(v.pathname+="/"),v}var Cu=h=>h.join("/").replace(/\/\/+/g,"/"),H9=h=>h.replace(/\/+$/,"").replace(/^\/*/,"/"),K9=h=>!h||h==="?"?"":h.startsWith("?")?h:"?"+h,W9=h=>!h||h==="#"?"":h.startsWith("#")?h:"#"+h;function Y9(h){return h!=null&&typeof h.status=="number"&&typeof h.statusText=="string"&&typeof h.internal=="boolean"&&"data"in h}var tG=["POST","PUT","PATCH","DELETE"];new Set(tG);var q9=["GET",...tG];new Set(q9);var P_=fe.createContext(null);P_.displayName="DataRouter";var gC=fe.createContext(null);gC.displayName="DataRouterState";var nG=fe.createContext({isTransitioning:!1});nG.displayName="ViewTransition";var $9=fe.createContext(new Map);$9.displayName="Fetchers";var z9=fe.createContext(null);z9.displayName="Await";var ll=fe.createContext(null);ll.displayName="Navigation";var gT=fe.createContext(null);gT.displayName="Location";var Td=fe.createContext({outlet:null,matches:[],isDataRoute:!1});Td.displayName="Route";var rL=fe.createContext(null);rL.displayName="RouteError";function X9(h,{relative:i}={}){us(k_(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:o}=fe.useContext(ll),{hash:d,pathname:p,search:g}=ET(h,{relative:i}),y=p;return r!=="/"&&(y=p==="/"?r:Cu([r,p])),o.createHref({pathname:y,search:g,hash:d})}function k_(){return fe.useContext(gT)!=null}function ff(){return us(k_(),"useLocation() may be used only in the context of a <Router> component."),fe.useContext(gT).location}var iG="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function sG(h){fe.useContext(ll).static||fe.useLayoutEffect(h)}function Pm(){let{isDataRoute:h}=fe.useContext(Td);return h?lX():J9()}function J9(){us(k_(),"useNavigate() may be used only in the context of a <Router> component.");let h=fe.useContext(P_),{basename:i,navigator:r}=fe.useContext(ll),{matches:o}=fe.useContext(Td),{pathname:d}=ff(),p=JSON.stringify(iL(o)),g=fe.useRef(!1);return sG(()=>{g.current=!0}),fe.useCallback((v,T={})=>{if(cl(g.current,iG),!g.current)return;if(typeof v=="number"){r.go(v);return}let C=sL(v,JSON.parse(p),d,T.relative==="path");h==null&&i!=="/"&&(C.pathname=C.pathname==="/"?i:Cu([i,C.pathname])),(T.replace?r.replace:r.push)(C,T.state,T)},[i,r,p,d,h])}fe.createContext(null);function ET(h,{relative:i}={}){let{matches:r}=fe.useContext(Td),{pathname:o}=ff(),d=JSON.stringify(iL(r));return fe.useMemo(()=>sL(h,JSON.parse(d),o,i==="path"),[h,d,o,i])}function Q9(h,i){return rG(h,i)}function rG(h,i,r,o){var ne;us(k_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:d,static:p}=fe.useContext(ll),{matches:g}=fe.useContext(Td),y=g[g.length-1],v=y?y.params:{},T=y?y.pathname:"/",C=y?y.pathnameBase:"/",I=y&&y.route;{let ee=I&&I.path||"";aG(T,!I||ee.endsWith("*")||ee.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${T}" (under <Route path="${ee}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ee}"> to <Route path="${ee==="/"?"*":`${ee}/*`}">.`)}let L=ff(),N;if(i){let ee=typeof i=="string"?x_(i):i;us(C==="/"||((ne=ee.pathname)==null?void 0:ne.startsWith(C)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${C}" but pathname "${ee.pathname}" was given in the \`location\` prop.`),N=ee}else N=L;let x=N.pathname||"/",K=x;if(C!=="/"){let ee=C.replace(/^\//,"").split("/");K="/"+x.replace(/^\//,"").split("/").slice(ee.length).join("/")}let H=!p&&r&&r.matches&&r.matches.length>0?r.matches:Q4(h,{pathname:K});cl(I||H!=null,`No routes matched location "${N.pathname}${N.search}${N.hash}" `),cl(H==null||H[H.length-1].route.element!==void 0||H[H.length-1].route.Component!==void 0||H[H.length-1].route.lazy!==void 0,`Matched leaf route at location "${N.pathname}${N.search}${N.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Q=iX(H&&H.map(ee=>Object.assign({},ee,{params:Object.assign({},v,ee.params),pathname:Cu([C,d.encodeLocation?d.encodeLocation(ee.pathname).pathname:ee.pathname]),pathnameBase:ee.pathnameBase==="/"?C:Cu([C,d.encodeLocation?d.encodeLocation(ee.pathnameBase).pathname:ee.pathnameBase])})),g,r,o);return i&&Q?fe.createElement(gT.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...N},navigationType:"POP"}},Q):Q}function Z9(){let h=cX(),i=Y9(h)?`${h.status} ${h.statusText}`:h instanceof Error?h.message:JSON.stringify(h),r=h instanceof Error?h.stack:null,o="rgba(200,200,200, 0.5)",d={padding:"0.5rem",backgroundColor:o},p={padding:"2px 4px",backgroundColor:o},g=null;return console.error("Error handled by React Router default ErrorBoundary:",h),g=fe.createElement(fe.Fragment,null,fe.createElement("p",null," Hey developer "),fe.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",fe.createElement("code",{style:p},"ErrorBoundary")," or"," ",fe.createElement("code",{style:p},"errorElement")," prop on your route.")),fe.createElement(fe.Fragment,null,fe.createElement("h2",null,"Unexpected Application Error!"),fe.createElement("h3",{style:{fontStyle:"italic"}},i),r?fe.createElement("pre",{style:d},r):null,g)}var eX=fe.createElement(Z9,null),tX=class extends fe.Component{constructor(h){super(h),this.state={location:h.location,revalidation:h.revalidation,error:h.error}}static getDerivedStateFromError(h){return{error:h}}static getDerivedStateFromProps(h,i){return i.location!==h.location||i.revalidation!=="idle"&&h.revalidation==="idle"?{error:h.error,location:h.location,revalidation:h.revalidation}:{error:h.error!==void 0?h.error:i.error,location:i.location,revalidation:h.revalidation||i.revalidation}}componentDidCatch(h,i){console.error("React Router caught the following error during render",h,i)}render(){return this.state.error!==void 0?fe.createElement(Td.Provider,{value:this.props.routeContext},fe.createElement(rL.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function nX({routeContext:h,match:i,children:r}){let o=fe.useContext(P_);return o&&o.static&&o.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=i.route.id),fe.createElement(Td.Provider,{value:h},r)}function iX(h,i=[],r=null,o=null){if(h==null){if(!r)return null;if(r.errors)h=r.matches;else if(i.length===0&&!r.initialized&&r.matches.length>0)h=r.matches;else return null}let d=h,p=r==null?void 0:r.errors;if(p!=null){let v=d.findIndex(T=>T.route.id&&(p==null?void 0:p[T.route.id])!==void 0);us(v>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(p).join(",")}`),d=d.slice(0,Math.min(d.length,v+1))}let g=!1,y=-1;if(r)for(let v=0;v<d.length;v++){let T=d[v];if((T.route.HydrateFallback||T.route.hydrateFallbackElement)&&(y=v),T.route.id){let{loaderData:C,errors:I}=r,L=T.route.loader&&!C.hasOwnProperty(T.route.id)&&(!I||I[T.route.id]===void 0);if(T.route.lazy||L){g=!0,y>=0?d=d.slice(0,y+1):d=[d[0]];break}}}return d.reduceRight((v,T,C)=>{let I,L=!1,N=null,x=null;r&&(I=p&&T.route.id?p[T.route.id]:void 0,N=T.route.errorElement||eX,g&&(y<0&&C===0?(aG("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),L=!0,x=null):y===C&&(L=!0,x=T.route.hydrateFallbackElement||null)));let K=i.concat(d.slice(0,C+1)),H=()=>{let Q;return I?Q=N:L?Q=x:T.route.Component?Q=fe.createElement(T.route.Component,null):T.route.element?Q=T.route.element:Q=v,fe.createElement(nX,{match:T,routeContext:{outlet:v,matches:K,isDataRoute:r!=null},children:Q})};return r&&(T.route.ErrorBoundary||T.route.errorElement||C===0)?fe.createElement(tX,{location:r.location,revalidation:r.revalidation,component:N,error:I,children:H(),routeContext:{outlet:null,matches:K,isDataRoute:!0}}):H()},null)}function aL(h){return`${h} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function sX(h){let i=fe.useContext(P_);return us(i,aL(h)),i}function rX(h){let i=fe.useContext(gC);return us(i,aL(h)),i}function aX(h){let i=fe.useContext(Td);return us(i,aL(h)),i}function oL(h){let i=aX(h),r=i.matches[i.matches.length-1];return us(r.route.id,`${h} can only be used on routes that contain a unique "id"`),r.route.id}function oX(){return oL("useRouteId")}function cX(){var o;let h=fe.useContext(rL),i=rX("useRouteError"),r=oL("useRouteError");return h!==void 0?h:(o=i.errors)==null?void 0:o[r]}function lX(){let{router:h}=sX("useNavigate"),i=oL("useNavigate"),r=fe.useRef(!1);return sG(()=>{r.current=!0}),fe.useCallback(async(d,p={})=>{cl(r.current,iG),r.current&&(typeof d=="number"?h.navigate(d):await h.navigate(d,{fromRouteId:i,...p}))},[h,i])}var E3={};function aG(h,i,r){!i&&!E3[h]&&(E3[h]=!0,cl(!1,r))}fe.memo(dX);function dX({routes:h,future:i,state:r}){return rG(h,void 0,r,i)}function oG({to:h,replace:i,state:r,relative:o}){us(k_(),"<Navigate> may be used only in the context of a <Router> component.");let{static:d}=fe.useContext(ll);cl(!d,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:p}=fe.useContext(Td),{pathname:g}=ff(),y=Pm(),v=sL(h,iL(p),g,o==="path"),T=JSON.stringify(v);return fe.useEffect(()=>{y(JSON.parse(T),{replace:i,state:r,relative:o})},[y,T,o,i,r]),null}function ud(h){us(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function uX({basename:h="/",children:i=null,location:r,navigationType:o="POP",navigator:d,static:p=!1}){us(!k_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let g=h.replace(/^\/*/,"/"),y=fe.useMemo(()=>({basename:g,navigator:d,static:p,future:{}}),[g,d,p]);typeof r=="string"&&(r=x_(r));let{pathname:v="/",search:T="",hash:C="",state:I=null,key:L="default"}=r,N=fe.useMemo(()=>{let x=Iu(v,g);return x==null?null:{location:{pathname:x,search:T,hash:C,state:I,key:L},navigationType:o}},[g,v,T,C,I,L,o]);return cl(N!=null,`<Router basename="${g}"> is not able to match the URL "${v}${T}${C}" because it does not start with the basename, so the <Router> won't render anything.`),N==null?null:fe.createElement(ll.Provider,{value:y},fe.createElement(gT.Provider,{children:i,value:N}))}function hX({children:h,location:i}){return Q9(IN(h),i)}function IN(h,i=[]){let r=[];return fe.Children.forEach(h,(o,d)=>{if(!fe.isValidElement(o))return;let p=[...i,d];if(o.type===fe.Fragment){r.push.apply(r,IN(o.props.children,p));return}us(o.type===ud,`[${typeof o.type=="string"?o.type:o.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),us(!o.props.index||!o.props.children,"An index route cannot have child routes.");let g={id:o.props.id||p.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,hydrateFallbackElement:o.props.hydrateFallbackElement,HydrateFallback:o.props.HydrateFallback,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.hasErrorBoundary===!0||o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(g.children=IN(o.props.children,p)),r.push(g)}),r}var VA="get",jA="application/x-www-form-urlencoded";function EC(h){return h!=null&&typeof h.tagName=="string"}function fX(h){return EC(h)&&h.tagName.toLowerCase()==="button"}function pX(h){return EC(h)&&h.tagName.toLowerCase()==="form"}function mX(h){return EC(h)&&h.tagName.toLowerCase()==="input"}function gX(h){return!!(h.metaKey||h.altKey||h.ctrlKey||h.shiftKey)}function EX(h,i){return h.button===0&&(!i||i==="_self")&&!gX(h)}var RA=null;function _X(){if(RA===null)try{new FormData(document.createElement("form"),0),RA=!1}catch{RA=!0}return RA}var SX=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function XD(h){return h!=null&&!SX.has(h)?(cl(!1,`"${h}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${jA}"`),null):h}function yX(h,i){let r,o,d,p,g;if(pX(h)){let y=h.getAttribute("action");o=y?Iu(y,i):null,r=h.getAttribute("method")||VA,d=XD(h.getAttribute("enctype"))||jA,p=new FormData(h)}else if(fX(h)||mX(h)&&(h.type==="submit"||h.type==="image")){let y=h.form;if(y==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let v=h.getAttribute("formaction")||y.getAttribute("action");if(o=v?Iu(v,i):null,r=h.getAttribute("formmethod")||y.getAttribute("method")||VA,d=XD(h.getAttribute("formenctype"))||XD(y.getAttribute("enctype"))||jA,p=new FormData(y,h),!_X()){let{name:T,type:C,value:I}=h;if(C==="image"){let L=T?`${T}.`:"";p.append(`${L}x`,"0"),p.append(`${L}y`,"0")}else T&&p.append(T,I)}}else{if(EC(h))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=VA,o=null,d=jA,g=h}return p&&d==="text/plain"&&(g=p,p=void 0),{action:o,method:r.toLowerCase(),encType:d,formData:p,body:g}}function cL(h,i){if(h===!1||h===null||typeof h>"u")throw new Error(i)}async function TX(h,i){if(h.id in i)return i[h.id];try{let r=await import(h.module);return i[h.id]=r,r}catch(r){return console.error(`Error loading route module \`${h.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function vX(h){return h==null?!1:h.href==null?h.rel==="preload"&&typeof h.imageSrcSet=="string"&&typeof h.imageSizes=="string":typeof h.rel=="string"&&typeof h.href=="string"}async function bX(h,i,r){let o=await Promise.all(h.map(async d=>{let p=i.routes[d.route.id];if(p){let g=await TX(p,r);return g.links?g.links():[]}return[]}));return IX(o.flat(1).filter(vX).filter(d=>d.rel==="stylesheet"||d.rel==="preload").map(d=>d.rel==="stylesheet"?{...d,rel:"prefetch",as:"style"}:{...d,rel:"prefetch"}))}function _3(h,i,r,o,d,p){let g=(v,T)=>r[T]?v.route.id!==r[T].route.id:!0,y=(v,T)=>{var C;return r[T].pathname!==v.pathname||((C=r[T].route.path)==null?void 0:C.endsWith("*"))&&r[T].params["*"]!==v.params["*"]};return p==="assets"?i.filter((v,T)=>g(v,T)||y(v,T)):p==="data"?i.filter((v,T)=>{var I;let C=o.routes[v.route.id];if(!C||!C.hasLoader)return!1;if(g(v,T)||y(v,T))return!0;if(v.route.shouldRevalidate){let L=v.route.shouldRevalidate({currentUrl:new URL(d.pathname+d.search+d.hash,window.origin),currentParams:((I=r[0])==null?void 0:I.params)||{},nextUrl:new URL(h,window.origin),nextParams:v.params,defaultShouldRevalidate:!0});if(typeof L=="boolean")return L}return!0}):[]}function RX(h,i,{includeHydrateFallback:r}={}){return AX(h.map(o=>{let d=i.routes[o.route.id];if(!d)return[];let p=[d.module];return d.clientActionModule&&(p=p.concat(d.clientActionModule)),d.clientLoaderModule&&(p=p.concat(d.clientLoaderModule)),r&&d.hydrateFallbackModule&&(p=p.concat(d.hydrateFallbackModule)),d.imports&&(p=p.concat(d.imports)),p}).flat(1))}function AX(h){return[...new Set(h)]}function CX(h){let i={},r=Object.keys(h).sort();for(let o of r)i[o]=h[o];return i}function IX(h,i){let r=new Set;return new Set(i),h.reduce((o,d)=>{let p=JSON.stringify(CX(d));return r.has(p)||(r.add(p),o.push({key:p,link:d})),o},[])}function wX(h,i){let r=typeof h=="string"?new URL(h,typeof window>"u"?"server://singlefetch/":window.location.origin):h;return r.pathname==="/"?r.pathname="_root.data":i&&Iu(r.pathname,i)==="/"?r.pathname=`${i.replace(/\/$/,"")}/_root.data`:r.pathname=`${r.pathname.replace(/\/$/,"")}.data`,r}function cG(){let h=fe.useContext(P_);return cL(h,"You must render this element inside a <DataRouterContext.Provider> element"),h}function OX(){let h=fe.useContext(gC);return cL(h,"You must render this element inside a <DataRouterStateContext.Provider> element"),h}var lL=fe.createContext(void 0);lL.displayName="FrameworkContext";function lG(){let h=fe.useContext(lL);return cL(h,"You must render this element inside a <HydratedRouter> element"),h}function DX(h,i){let r=fe.useContext(lL),[o,d]=fe.useState(!1),[p,g]=fe.useState(!1),{onFocus:y,onBlur:v,onMouseEnter:T,onMouseLeave:C,onTouchStart:I}=i,L=fe.useRef(null);fe.useEffect(()=>{if(h==="render"&&g(!0),h==="viewport"){let K=Q=>{Q.forEach(ne=>{g(ne.isIntersecting)})},H=new IntersectionObserver(K,{threshold:.5});return L.current&&H.observe(L.current),()=>{H.disconnect()}}},[h]),fe.useEffect(()=>{if(o){let K=setTimeout(()=>{g(!0)},100);return()=>{clearTimeout(K)}}},[o]);let N=()=>{d(!0)},x=()=>{d(!1),g(!1)};return r?h!=="intent"?[p,L,{}]:[p,L,{onFocus:Xy(y,N),onBlur:Xy(v,x),onMouseEnter:Xy(T,N),onMouseLeave:Xy(C,x),onTouchStart:Xy(I,N)}]:[!1,L,{}]}function Xy(h,i){return r=>{h&&h(r),r.defaultPrevented||i(r)}}function NX({page:h,...i}){let{router:r}=cG(),o=fe.useMemo(()=>Q4(r.routes,h,r.basename),[r.routes,h,r.basename]);return o?fe.createElement(xX,{page:h,matches:o,...i}):null}function LX(h){let{manifest:i,routeModules:r}=lG(),[o,d]=fe.useState([]);return fe.useEffect(()=>{let p=!1;return bX(h,i,r).then(g=>{p||d(g)}),()=>{p=!0}},[h,i,r]),o}function xX({page:h,matches:i,...r}){let o=ff(),{manifest:d,routeModules:p}=lG(),{basename:g}=cG(),{loaderData:y,matches:v}=OX(),T=fe.useMemo(()=>_3(h,i,v,d,o,"data"),[h,i,v,d,o]),C=fe.useMemo(()=>_3(h,i,v,d,o,"assets"),[h,i,v,d,o]),I=fe.useMemo(()=>{if(h===o.pathname+o.search+o.hash)return[];let x=new Set,K=!1;if(i.forEach(Q=>{var ee;let ne=d.routes[Q.route.id];!ne||!ne.hasLoader||(!T.some(pe=>pe.route.id===Q.route.id)&&Q.route.id in y&&((ee=p[Q.route.id])!=null&&ee.shouldRevalidate)||ne.hasClientLoader?K=!0:x.add(Q.route.id))}),x.size===0)return[];let H=wX(h,g);return K&&x.size>0&&H.searchParams.set("_routes",i.filter(Q=>x.has(Q.route.id)).map(Q=>Q.route.id).join(",")),[H.pathname+H.search]},[g,y,o,d,T,i,h,p]),L=fe.useMemo(()=>RX(C,d),[C,d]),N=LX(C);return fe.createElement(fe.Fragment,null,I.map(x=>fe.createElement("link",{key:x,rel:"prefetch",as:"fetch",href:x,...r})),L.map(x=>fe.createElement("link",{key:x,rel:"modulepreload",href:x,...r})),N.map(({key:x,link:K})=>fe.createElement("link",{key:x,...K})))}function PX(...h){return i=>{h.forEach(r=>{typeof r=="function"?r(i):r!=null&&(r.current=i)})}}var dG=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{dG&&(window.__reactRouterVersion="7.4.0")}catch{}function kX({basename:h,children:i,window:r}){let o=fe.useRef();o.current==null&&(o.current=R9({window:r,v5Compat:!0}));let d=o.current,[p,g]=fe.useState({action:d.action,location:d.location}),y=fe.useCallback(v=>{fe.startTransition(()=>g(v))},[g]);return fe.useLayoutEffect(()=>d.listen(y),[d,y]),fe.createElement(uX,{basename:h,children:i,location:p.location,navigationType:p.action,navigator:d})}var uG=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,hG=fe.forwardRef(function({onClick:i,discover:r="render",prefetch:o="none",relative:d,reloadDocument:p,replace:g,state:y,target:v,to:T,preventScrollReset:C,viewTransition:I,...L},N){let{basename:x}=fe.useContext(ll),K=typeof T=="string"&&uG.test(T),H,Q=!1;if(typeof T=="string"&&K&&(H=T,dG))try{let _e=new URL(window.location.href),he=T.startsWith("//")?new URL(_e.protocol+T):new URL(T),Ge=Iu(he.pathname,x);he.origin===_e.origin&&Ge!=null?T=Ge+he.search+he.hash:Q=!0}catch{cl(!1,`<Link to="${T}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ne=X9(T,{relative:d}),[ee,pe,de]=DX(o,L),be=FX(T,{replace:g,state:y,target:v,preventScrollReset:C,relative:d,viewTransition:I});function Se(_e){i&&i(_e),_e.defaultPrevented||be(_e)}let Te=fe.createElement("a",{...L,...de,href:H||ne,onClick:Q||p?i:Se,ref:PX(N,pe),target:v,"data-discover":!K&&r==="render"?"true":void 0});return ee&&!K?fe.createElement(fe.Fragment,null,Te,fe.createElement(NX,{page:ne})):Te});hG.displayName="Link";var al=fe.forwardRef(function({"aria-current":i="page",caseSensitive:r=!1,className:o="",end:d=!1,style:p,to:g,viewTransition:y,children:v,...T},C){let I=ET(g,{relative:T.relative}),L=ff(),N=fe.useContext(gC),{navigator:x,basename:K}=fe.useContext(ll),H=N!=null&&HX(I)&&y===!0,Q=x.encodeLocation?x.encodeLocation(I).pathname:I.pathname,ne=L.pathname,ee=N&&N.navigation&&N.navigation.location?N.navigation.location.pathname:null;r||(ne=ne.toLowerCase(),ee=ee?ee.toLowerCase():null,Q=Q.toLowerCase()),ee&&K&&(ee=Iu(ee,K)||ee);const pe=Q!=="/"&&Q.endsWith("/")?Q.length-1:Q.length;let de=ne===Q||!d&&ne.startsWith(Q)&&ne.charAt(pe)==="/",be=ee!=null&&(ee===Q||!d&&ee.startsWith(Q)&&ee.charAt(Q.length)==="/"),Se={isActive:de,isPending:be,isTransitioning:H},Te=de?i:void 0,_e;typeof o=="function"?_e=o(Se):_e=[o,de?"active":null,be?"pending":null,H?"transitioning":null].filter(Boolean).join(" ");let he=typeof p=="function"?p(Se):p;return fe.createElement(hG,{...T,"aria-current":Te,className:_e,ref:C,style:he,to:g,viewTransition:y},typeof v=="function"?v(Se):v)});al.displayName="NavLink";var MX=fe.forwardRef(({discover:h="render",fetcherKey:i,navigate:r,reloadDocument:o,replace:d,state:p,method:g=VA,action:y,onSubmit:v,relative:T,preventScrollReset:C,viewTransition:I,...L},N)=>{let x=jX(),K=GX(y,{relative:T}),H=g.toLowerCase()==="get"?"get":"post",Q=typeof y=="string"&&uG.test(y),ne=ee=>{if(v&&v(ee),ee.defaultPrevented)return;ee.preventDefault();let pe=ee.nativeEvent.submitter,de=(pe==null?void 0:pe.getAttribute("formmethod"))||g;x(pe||ee.currentTarget,{fetcherKey:i,method:de,navigate:r,replace:d,state:p,relative:T,preventScrollReset:C,viewTransition:I})};return fe.createElement("form",{ref:N,method:H,action:K,onSubmit:o?v:ne,...L,"data-discover":!Q&&h==="render"?"true":void 0})});MX.displayName="Form";function UX(h){return`${h} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function fG(h){let i=fe.useContext(P_);return us(i,UX(h)),i}function FX(h,{target:i,replace:r,state:o,preventScrollReset:d,relative:p,viewTransition:g}={}){let y=Pm(),v=ff(),T=ET(h,{relative:p});return fe.useCallback(C=>{if(EX(C,i)){C.preventDefault();let I=r!==void 0?r:rT(v)===rT(T);y(h,{replace:I,state:o,preventScrollReset:d,relative:p,viewTransition:g})}},[v,y,T,r,o,i,h,d,p,g])}var BX=0,VX=()=>`__${String(++BX)}__`;function jX(){let{router:h}=fG("useSubmit"),{basename:i}=fe.useContext(ll),r=oX();return fe.useCallback(async(o,d={})=>{let{action:p,method:g,encType:y,formData:v,body:T}=yX(o,i);if(d.navigate===!1){let C=d.fetcherKey||VX();await h.fetch(C,r,d.action||p,{preventScrollReset:d.preventScrollReset,formData:v,body:T,formMethod:d.method||g,formEncType:d.encType||y,flushSync:d.flushSync})}else await h.navigate(d.action||p,{preventScrollReset:d.preventScrollReset,formData:v,body:T,formMethod:d.method||g,formEncType:d.encType||y,replace:d.replace,state:d.state,fromRouteId:r,flushSync:d.flushSync,viewTransition:d.viewTransition})},[h,i,r])}function GX(h,{relative:i}={}){let{basename:r}=fe.useContext(ll),o=fe.useContext(Td);us(o,"useFormAction must be used inside a RouteContext");let[d]=o.matches.slice(-1),p={...ET(h||".",{relative:i})},g=ff();if(h==null){p.search=g.search;let y=new URLSearchParams(p.search),v=y.getAll("index");if(v.some(C=>C==="")){y.delete("index"),v.filter(I=>I).forEach(I=>y.append("index",I));let C=y.toString();p.search=C?`?${C}`:""}}return(!h||h===".")&&d.route.index&&(p.search=p.search?p.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(p.pathname=p.pathname==="/"?r:Cu([r,p.pathname])),rT(p)}function HX(h,i={}){let r=fe.useContext(nG);us(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:o}=fG("useViewTransitionState"),d=ET(h,{relative:i.relative});if(!r.isTransitioning)return!1;let p=Iu(r.currentLocation.pathname,o)||r.currentLocation.pathname,g=Iu(r.nextLocation.pathname,o)||r.nextLocation.pathname;return eC(d.pathname,g)!=null||eC(d.pathname,p)!=null}new TextEncoder;const pG="/assets/login-BUa6NnKd.svg",aT="/assets/logo-CZHZ9zkA.jpg";function mG(h,i){return function(){return h.apply(i,arguments)}}const{toString:KX}=Object.prototype,{getPrototypeOf:dL}=Object,_C=(h=>i=>{const r=KX.call(i);return h[r]||(h[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),dl=h=>(h=h.toLowerCase(),i=>_C(i)===h),SC=h=>i=>typeof i===h,{isArray:M_}=Array,oT=SC("undefined");function WX(h){return h!==null&&!oT(h)&&h.constructor!==null&&!oT(h.constructor)&&_o(h.constructor.isBuffer)&&h.constructor.isBuffer(h)}const gG=dl("ArrayBuffer");function YX(h){let i;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?i=ArrayBuffer.isView(h):i=h&&h.buffer&&gG(h.buffer),i}const qX=SC("string"),_o=SC("function"),EG=SC("number"),yC=h=>h!==null&&typeof h=="object",$X=h=>h===!0||h===!1,GA=h=>{if(_C(h)!=="object")return!1;const i=dL(h);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in h)&&!(Symbol.iterator in h)},zX=dl("Date"),XX=dl("File"),JX=dl("Blob"),QX=dl("FileList"),ZX=h=>yC(h)&&_o(h.pipe),eJ=h=>{let i;return h&&(typeof FormData=="function"&&h instanceof FormData||_o(h.append)&&((i=_C(h))==="formdata"||i==="object"&&_o(h.toString)&&h.toString()==="[object FormData]"))},tJ=dl("URLSearchParams"),[nJ,iJ,sJ,rJ]=["ReadableStream","Request","Response","Headers"].map(dl),aJ=h=>h.trim?h.trim():h.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function _T(h,i,{allOwnKeys:r=!1}={}){if(h===null||typeof h>"u")return;let o,d;if(typeof h!="object"&&(h=[h]),M_(h))for(o=0,d=h.length;o<d;o++)i.call(null,h[o],o,h);else{const p=r?Object.getOwnPropertyNames(h):Object.keys(h),g=p.length;let y;for(o=0;o<g;o++)y=p[o],i.call(null,h[y],y,h)}}function _G(h,i){i=i.toLowerCase();const r=Object.keys(h);let o=r.length,d;for(;o-- >0;)if(d=r[o],i===d.toLowerCase())return d;return null}const Om=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,SG=h=>!oT(h)&&h!==Om;function wN(){const{caseless:h}=SG(this)&&this||{},i={},r=(o,d)=>{const p=h&&_G(i,d)||d;GA(i[p])&&GA(o)?i[p]=wN(i[p],o):GA(o)?i[p]=wN({},o):M_(o)?i[p]=o.slice():i[p]=o};for(let o=0,d=arguments.length;o<d;o++)arguments[o]&&_T(arguments[o],r);return i}const oJ=(h,i,r,{allOwnKeys:o}={})=>(_T(i,(d,p)=>{r&&_o(d)?h[p]=mG(d,r):h[p]=d},{allOwnKeys:o}),h),cJ=h=>(h.charCodeAt(0)===65279&&(h=h.slice(1)),h),lJ=(h,i,r,o)=>{h.prototype=Object.create(i.prototype,o),h.prototype.constructor=h,Object.defineProperty(h,"super",{value:i.prototype}),r&&Object.assign(h.prototype,r)},dJ=(h,i,r,o)=>{let d,p,g;const y={};if(i=i||{},h==null)return i;do{for(d=Object.getOwnPropertyNames(h),p=d.length;p-- >0;)g=d[p],(!o||o(g,h,i))&&!y[g]&&(i[g]=h[g],y[g]=!0);h=r!==!1&&dL(h)}while(h&&(!r||r(h,i))&&h!==Object.prototype);return i},uJ=(h,i,r)=>{h=String(h),(r===void 0||r>h.length)&&(r=h.length),r-=i.length;const o=h.indexOf(i,r);return o!==-1&&o===r},hJ=h=>{if(!h)return null;if(M_(h))return h;let i=h.length;if(!EG(i))return null;const r=new Array(i);for(;i-- >0;)r[i]=h[i];return r},fJ=(h=>i=>h&&i instanceof h)(typeof Uint8Array<"u"&&dL(Uint8Array)),pJ=(h,i)=>{const o=(h&&h[Symbol.iterator]).call(h);let d;for(;(d=o.next())&&!d.done;){const p=d.value;i.call(h,p[0],p[1])}},mJ=(h,i)=>{let r;const o=[];for(;(r=h.exec(i))!==null;)o.push(r);return o},gJ=dl("HTMLFormElement"),EJ=h=>h.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,o,d){return o.toUpperCase()+d}),S3=(({hasOwnProperty:h})=>(i,r)=>h.call(i,r))(Object.prototype),_J=dl("RegExp"),yG=(h,i)=>{const r=Object.getOwnPropertyDescriptors(h),o={};_T(r,(d,p)=>{let g;(g=i(d,p,h))!==!1&&(o[p]=g||d)}),Object.defineProperties(h,o)},SJ=h=>{yG(h,(i,r)=>{if(_o(h)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const o=h[r];if(_o(o)){if(i.enumerable=!1,"writable"in i){i.writable=!1;return}i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},yJ=(h,i)=>{const r={},o=d=>{d.forEach(p=>{r[p]=!0})};return M_(h)?o(h):o(String(h).split(i)),r},TJ=()=>{},vJ=(h,i)=>h!=null&&Number.isFinite(h=+h)?h:i;function bJ(h){return!!(h&&_o(h.append)&&h[Symbol.toStringTag]==="FormData"&&h[Symbol.iterator])}const RJ=h=>{const i=new Array(10),r=(o,d)=>{if(yC(o)){if(i.indexOf(o)>=0)return;if(!("toJSON"in o)){i[d]=o;const p=M_(o)?[]:{};return _T(o,(g,y)=>{const v=r(g,d+1);!oT(v)&&(p[y]=v)}),i[d]=void 0,p}}return o};return r(h,0)},AJ=dl("AsyncFunction"),CJ=h=>h&&(yC(h)||_o(h))&&_o(h.then)&&_o(h.catch),TG=((h,i)=>h?setImmediate:i?((r,o)=>(Om.addEventListener("message",({source:d,data:p})=>{d===Om&&p===r&&o.length&&o.shift()()},!1),d=>{o.push(d),Om.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",_o(Om.postMessage)),IJ=typeof queueMicrotask<"u"?queueMicrotask.bind(Om):typeof process<"u"&&process.nextTick||TG,Xe={isArray:M_,isArrayBuffer:gG,isBuffer:WX,isFormData:eJ,isArrayBufferView:YX,isString:qX,isNumber:EG,isBoolean:$X,isObject:yC,isPlainObject:GA,isReadableStream:nJ,isRequest:iJ,isResponse:sJ,isHeaders:rJ,isUndefined:oT,isDate:zX,isFile:XX,isBlob:JX,isRegExp:_J,isFunction:_o,isStream:ZX,isURLSearchParams:tJ,isTypedArray:fJ,isFileList:QX,forEach:_T,merge:wN,extend:oJ,trim:aJ,stripBOM:cJ,inherits:lJ,toFlatObject:dJ,kindOf:_C,kindOfTest:dl,endsWith:uJ,toArray:hJ,forEachEntry:pJ,matchAll:mJ,isHTMLForm:gJ,hasOwnProperty:S3,hasOwnProp:S3,reduceDescriptors:yG,freezeMethods:SJ,toObjectSet:yJ,toCamelCase:EJ,noop:TJ,toFiniteNumber:vJ,findKey:_G,global:Om,isContextDefined:SG,isSpecCompliantForm:bJ,toJSONObject:RJ,isAsyncFn:AJ,isThenable:CJ,setImmediate:TG,asap:IJ};function In(h,i,r,o,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=h,this.name="AxiosError",i&&(this.code=i),r&&(this.config=r),o&&(this.request=o),d&&(this.response=d,this.status=d.status?d.status:null)}Xe.inherits(In,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Xe.toJSONObject(this.config),code:this.code,status:this.status}}});const vG=In.prototype,bG={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(h=>{bG[h]={value:h}});Object.defineProperties(In,bG);Object.defineProperty(vG,"isAxiosError",{value:!0});In.from=(h,i,r,o,d,p)=>{const g=Object.create(vG);return Xe.toFlatObject(h,g,function(v){return v!==Error.prototype},y=>y!=="isAxiosError"),In.call(g,h.message,i,r,o,d),g.cause=h,g.name=h.name,p&&Object.assign(g,p),g};const wJ=null;function ON(h){return Xe.isPlainObject(h)||Xe.isArray(h)}function RG(h){return Xe.endsWith(h,"[]")?h.slice(0,-2):h}function y3(h,i,r){return h?h.concat(i).map(function(d,p){return d=RG(d),!r&&p?"["+d+"]":d}).join(r?".":""):i}function OJ(h){return Xe.isArray(h)&&!h.some(ON)}const DJ=Xe.toFlatObject(Xe,{},null,function(i){return/^is[A-Z]/.test(i)});function TC(h,i,r){if(!Xe.isObject(h))throw new TypeError("target must be an object");i=i||new FormData,r=Xe.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(K,H){return!Xe.isUndefined(H[K])});const o=r.metaTokens,d=r.visitor||C,p=r.dots,g=r.indexes,v=(r.Blob||typeof Blob<"u"&&Blob)&&Xe.isSpecCompliantForm(i);if(!Xe.isFunction(d))throw new TypeError("visitor must be a function");function T(x){if(x===null)return"";if(Xe.isDate(x))return x.toISOString();if(!v&&Xe.isBlob(x))throw new In("Blob is not supported. Use a Buffer instead.");return Xe.isArrayBuffer(x)||Xe.isTypedArray(x)?v&&typeof Blob=="function"?new Blob([x]):Buffer.from(x):x}function C(x,K,H){let Q=x;if(x&&!H&&typeof x=="object"){if(Xe.endsWith(K,"{}"))K=o?K:K.slice(0,-2),x=JSON.stringify(x);else if(Xe.isArray(x)&&OJ(x)||(Xe.isFileList(x)||Xe.endsWith(K,"[]"))&&(Q=Xe.toArray(x)))return K=RG(K),Q.forEach(function(ee,pe){!(Xe.isUndefined(ee)||ee===null)&&i.append(g===!0?y3([K],pe,p):g===null?K:K+"[]",T(ee))}),!1}return ON(x)?!0:(i.append(y3(H,K,p),T(x)),!1)}const I=[],L=Object.assign(DJ,{defaultVisitor:C,convertValue:T,isVisitable:ON});function N(x,K){if(!Xe.isUndefined(x)){if(I.indexOf(x)!==-1)throw Error("Circular reference detected in "+K.join("."));I.push(x),Xe.forEach(x,function(Q,ne){(!(Xe.isUndefined(Q)||Q===null)&&d.call(i,Q,Xe.isString(ne)?ne.trim():ne,K,L))===!0&&N(Q,K?K.concat(ne):[ne])}),I.pop()}}if(!Xe.isObject(h))throw new TypeError("data must be an object");return N(h),i}function T3(h){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(h).replace(/[!'()~]|%20|%00/g,function(o){return i[o]})}function uL(h,i){this._pairs=[],h&&TC(h,this,i)}const AG=uL.prototype;AG.append=function(i,r){this._pairs.push([i,r])};AG.toString=function(i){const r=i?function(o){return i.call(this,o,T3)}:T3;return this._pairs.map(function(d){return r(d[0])+"="+r(d[1])},"").join("&")};function NJ(h){return encodeURIComponent(h).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function CG(h,i,r){if(!i)return h;const o=r&&r.encode||NJ;Xe.isFunction(r)&&(r={serialize:r});const d=r&&r.serialize;let p;if(d?p=d(i,r):p=Xe.isURLSearchParams(i)?i.toString():new uL(i,r).toString(o),p){const g=h.indexOf("#");g!==-1&&(h=h.slice(0,g)),h+=(h.indexOf("?")===-1?"?":"&")+p}return h}class v3{constructor(){this.handlers=[]}use(i,r,o){return this.handlers.push({fulfilled:i,rejected:r,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(i){this.handlers[i]&&(this.handlers[i]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(i){Xe.forEach(this.handlers,function(o){o!==null&&i(o)})}}const IG={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},LJ=typeof URLSearchParams<"u"?URLSearchParams:uL,xJ=typeof FormData<"u"?FormData:null,PJ=typeof Blob<"u"?Blob:null,kJ={isBrowser:!0,classes:{URLSearchParams:LJ,FormData:xJ,Blob:PJ},protocols:["http","https","file","blob","url","data"]},hL=typeof window<"u"&&typeof document<"u",DN=typeof navigator=="object"&&navigator||void 0,MJ=hL&&(!DN||["ReactNative","NativeScript","NS"].indexOf(DN.product)<0),UJ=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",FJ=hL&&window.location.href||"http://localhost",BJ=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:hL,hasStandardBrowserEnv:MJ,hasStandardBrowserWebWorkerEnv:UJ,navigator:DN,origin:FJ},Symbol.toStringTag,{value:"Module"})),ta={...BJ,...kJ};function VJ(h,i){return TC(h,new ta.classes.URLSearchParams,Object.assign({visitor:function(r,o,d,p){return ta.isNode&&Xe.isBuffer(r)?(this.append(o,r.toString("base64")),!1):p.defaultVisitor.apply(this,arguments)}},i))}function jJ(h){return Xe.matchAll(/\w+|\[(\w*)]/g,h).map(i=>i[0]==="[]"?"":i[1]||i[0])}function GJ(h){const i={},r=Object.keys(h);let o;const d=r.length;let p;for(o=0;o<d;o++)p=r[o],i[p]=h[p];return i}function wG(h){function i(r,o,d,p){let g=r[p++];if(g==="__proto__")return!0;const y=Number.isFinite(+g),v=p>=r.length;return g=!g&&Xe.isArray(d)?d.length:g,v?(Xe.hasOwnProp(d,g)?d[g]=[d[g],o]:d[g]=o,!y):((!d[g]||!Xe.isObject(d[g]))&&(d[g]=[]),i(r,o,d[g],p)&&Xe.isArray(d[g])&&(d[g]=GJ(d[g])),!y)}if(Xe.isFormData(h)&&Xe.isFunction(h.entries)){const r={};return Xe.forEachEntry(h,(o,d)=>{i(jJ(o),d,r,0)}),r}return null}function HJ(h,i,r){if(Xe.isString(h))try{return(i||JSON.parse)(h),Xe.trim(h)}catch(o){if(o.name!=="SyntaxError")throw o}return(r||JSON.stringify)(h)}const ST={transitional:IG,adapter:["xhr","http","fetch"],transformRequest:[function(i,r){const o=r.getContentType()||"",d=o.indexOf("application/json")>-1,p=Xe.isObject(i);if(p&&Xe.isHTMLForm(i)&&(i=new FormData(i)),Xe.isFormData(i))return d?JSON.stringify(wG(i)):i;if(Xe.isArrayBuffer(i)||Xe.isBuffer(i)||Xe.isStream(i)||Xe.isFile(i)||Xe.isBlob(i)||Xe.isReadableStream(i))return i;if(Xe.isArrayBufferView(i))return i.buffer;if(Xe.isURLSearchParams(i))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let y;if(p){if(o.indexOf("application/x-www-form-urlencoded")>-1)return VJ(i,this.formSerializer).toString();if((y=Xe.isFileList(i))||o.indexOf("multipart/form-data")>-1){const v=this.env&&this.env.FormData;return TC(y?{"files[]":i}:i,v&&new v,this.formSerializer)}}return p||d?(r.setContentType("application/json",!1),HJ(i)):i}],transformResponse:[function(i){const r=this.transitional||ST.transitional,o=r&&r.forcedJSONParsing,d=this.responseType==="json";if(Xe.isResponse(i)||Xe.isReadableStream(i))return i;if(i&&Xe.isString(i)&&(o&&!this.responseType||d)){const g=!(r&&r.silentJSONParsing)&&d;try{return JSON.parse(i)}catch(y){if(g)throw y.name==="SyntaxError"?In.from(y,In.ERR_BAD_RESPONSE,this,null,this.response):y}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ta.classes.FormData,Blob:ta.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Xe.forEach(["delete","get","head","post","put","patch"],h=>{ST.headers[h]={}});const KJ=Xe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),WJ=h=>{const i={};let r,o,d;return h&&h.split(`
`).forEach(function(g){d=g.indexOf(":"),r=g.substring(0,d).trim().toLowerCase(),o=g.substring(d+1).trim(),!(!r||i[r]&&KJ[r])&&(r==="set-cookie"?i[r]?i[r].push(o):i[r]=[o]:i[r]=i[r]?i[r]+", "+o:o)}),i},b3=Symbol("internals");function Jy(h){return h&&String(h).trim().toLowerCase()}function HA(h){return h===!1||h==null?h:Xe.isArray(h)?h.map(HA):String(h)}function YJ(h){const i=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=r.exec(h);)i[o[1]]=o[2];return i}const qJ=h=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(h.trim());function JD(h,i,r,o,d){if(Xe.isFunction(o))return o.call(this,i,r);if(d&&(i=r),!!Xe.isString(i)){if(Xe.isString(o))return i.indexOf(o)!==-1;if(Xe.isRegExp(o))return o.test(i)}}function $J(h){return h.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,r,o)=>r.toUpperCase()+o)}function zJ(h,i){const r=Xe.toCamelCase(" "+i);["get","set","has"].forEach(o=>{Object.defineProperty(h,o+r,{value:function(d,p,g){return this[o].call(this,i,d,p,g)},configurable:!0})})}let Wa=class{constructor(i){i&&this.set(i)}set(i,r,o){const d=this;function p(y,v,T){const C=Jy(v);if(!C)throw new Error("header name must be a non-empty string");const I=Xe.findKey(d,C);(!I||d[I]===void 0||T===!0||T===void 0&&d[I]!==!1)&&(d[I||v]=HA(y))}const g=(y,v)=>Xe.forEach(y,(T,C)=>p(T,C,v));if(Xe.isPlainObject(i)||i instanceof this.constructor)g(i,r);else if(Xe.isString(i)&&(i=i.trim())&&!qJ(i))g(WJ(i),r);else if(Xe.isHeaders(i))for(const[y,v]of i.entries())p(v,y,o);else i!=null&&p(r,i,o);return this}get(i,r){if(i=Jy(i),i){const o=Xe.findKey(this,i);if(o){const d=this[o];if(!r)return d;if(r===!0)return YJ(d);if(Xe.isFunction(r))return r.call(this,d,o);if(Xe.isRegExp(r))return r.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,r){if(i=Jy(i),i){const o=Xe.findKey(this,i);return!!(o&&this[o]!==void 0&&(!r||JD(this,this[o],o,r)))}return!1}delete(i,r){const o=this;let d=!1;function p(g){if(g=Jy(g),g){const y=Xe.findKey(o,g);y&&(!r||JD(o,o[y],y,r))&&(delete o[y],d=!0)}}return Xe.isArray(i)?i.forEach(p):p(i),d}clear(i){const r=Object.keys(this);let o=r.length,d=!1;for(;o--;){const p=r[o];(!i||JD(this,this[p],p,i,!0))&&(delete this[p],d=!0)}return d}normalize(i){const r=this,o={};return Xe.forEach(this,(d,p)=>{const g=Xe.findKey(o,p);if(g){r[g]=HA(d),delete r[p];return}const y=i?$J(p):String(p).trim();y!==p&&delete r[p],r[y]=HA(d),o[y]=!0}),this}concat(...i){return this.constructor.concat(this,...i)}toJSON(i){const r=Object.create(null);return Xe.forEach(this,(o,d)=>{o!=null&&o!==!1&&(r[d]=i&&Xe.isArray(o)?o.join(", "):o)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([i,r])=>i+": "+r).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i,...r){const o=new this(i);return r.forEach(d=>o.set(d)),o}static accessor(i){const o=(this[b3]=this[b3]={accessors:{}}).accessors,d=this.prototype;function p(g){const y=Jy(g);o[y]||(zJ(d,g),o[y]=!0)}return Xe.isArray(i)?i.forEach(p):p(i),this}};Wa.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Xe.reduceDescriptors(Wa.prototype,({value:h},i)=>{let r=i[0].toUpperCase()+i.slice(1);return{get:()=>h,set(o){this[r]=o}}});Xe.freezeMethods(Wa);function QD(h,i){const r=this||ST,o=i||r,d=Wa.from(o.headers);let p=o.data;return Xe.forEach(h,function(y){p=y.call(r,p,d.normalize(),i?i.status:void 0)}),d.normalize(),p}function OG(h){return!!(h&&h.__CANCEL__)}function U_(h,i,r){In.call(this,h??"canceled",In.ERR_CANCELED,i,r),this.name="CanceledError"}Xe.inherits(U_,In,{__CANCEL__:!0});function DG(h,i,r){const o=r.config.validateStatus;!r.status||!o||o(r.status)?h(r):i(new In("Request failed with status code "+r.status,[In.ERR_BAD_REQUEST,In.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function XJ(h){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(h);return i&&i[1]||""}function JJ(h,i){h=h||10;const r=new Array(h),o=new Array(h);let d=0,p=0,g;return i=i!==void 0?i:1e3,function(v){const T=Date.now(),C=o[p];g||(g=T),r[d]=v,o[d]=T;let I=p,L=0;for(;I!==d;)L+=r[I++],I=I%h;if(d=(d+1)%h,d===p&&(p=(p+1)%h),T-g<i)return;const N=C&&T-C;return N?Math.round(L*1e3/N):void 0}}function QJ(h,i){let r=0,o=1e3/i,d,p;const g=(T,C=Date.now())=>{r=C,d=null,p&&(clearTimeout(p),p=null),h.apply(null,T)};return[(...T)=>{const C=Date.now(),I=C-r;I>=o?g(T,C):(d=T,p||(p=setTimeout(()=>{p=null,g(d)},o-I)))},()=>d&&g(d)]}const tC=(h,i,r=3)=>{let o=0;const d=JJ(50,250);return QJ(p=>{const g=p.loaded,y=p.lengthComputable?p.total:void 0,v=g-o,T=d(v),C=g<=y;o=g;const I={loaded:g,total:y,progress:y?g/y:void 0,bytes:v,rate:T||void 0,estimated:T&&y&&C?(y-g)/T:void 0,event:p,lengthComputable:y!=null,[i?"download":"upload"]:!0};h(I)},r)},R3=(h,i)=>{const r=h!=null;return[o=>i[0]({lengthComputable:r,total:h,loaded:o}),i[1]]},A3=h=>(...i)=>Xe.asap(()=>h(...i)),ZJ=ta.hasStandardBrowserEnv?((h,i)=>r=>(r=new URL(r,ta.origin),h.protocol===r.protocol&&h.host===r.host&&(i||h.port===r.port)))(new URL(ta.origin),ta.navigator&&/(msie|trident)/i.test(ta.navigator.userAgent)):()=>!0,eQ=ta.hasStandardBrowserEnv?{write(h,i,r,o,d,p){const g=[h+"="+encodeURIComponent(i)];Xe.isNumber(r)&&g.push("expires="+new Date(r).toGMTString()),Xe.isString(o)&&g.push("path="+o),Xe.isString(d)&&g.push("domain="+d),p===!0&&g.push("secure"),document.cookie=g.join("; ")},read(h){const i=document.cookie.match(new RegExp("(^|;\\s*)("+h+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove(h){this.write(h,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function tQ(h){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(h)}function nQ(h,i){return i?h.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):h}function NG(h,i,r){let o=!tQ(i);return h&&(o||r==!1)?nQ(h,i):i}const C3=h=>h instanceof Wa?{...h}:h;function Lm(h,i){i=i||{};const r={};function o(T,C,I,L){return Xe.isPlainObject(T)&&Xe.isPlainObject(C)?Xe.merge.call({caseless:L},T,C):Xe.isPlainObject(C)?Xe.merge({},C):Xe.isArray(C)?C.slice():C}function d(T,C,I,L){if(Xe.isUndefined(C)){if(!Xe.isUndefined(T))return o(void 0,T,I,L)}else return o(T,C,I,L)}function p(T,C){if(!Xe.isUndefined(C))return o(void 0,C)}function g(T,C){if(Xe.isUndefined(C)){if(!Xe.isUndefined(T))return o(void 0,T)}else return o(void 0,C)}function y(T,C,I){if(I in i)return o(T,C);if(I in h)return o(void 0,T)}const v={url:p,method:p,data:p,baseURL:g,transformRequest:g,transformResponse:g,paramsSerializer:g,timeout:g,timeoutMessage:g,withCredentials:g,withXSRFToken:g,adapter:g,responseType:g,xsrfCookieName:g,xsrfHeaderName:g,onUploadProgress:g,onDownloadProgress:g,decompress:g,maxContentLength:g,maxBodyLength:g,beforeRedirect:g,transport:g,httpAgent:g,httpsAgent:g,cancelToken:g,socketPath:g,responseEncoding:g,validateStatus:y,headers:(T,C,I)=>d(C3(T),C3(C),I,!0)};return Xe.forEach(Object.keys(Object.assign({},h,i)),function(C){const I=v[C]||d,L=I(h[C],i[C],C);Xe.isUndefined(L)&&I!==y||(r[C]=L)}),r}const LG=h=>{const i=Lm({},h);let{data:r,withXSRFToken:o,xsrfHeaderName:d,xsrfCookieName:p,headers:g,auth:y}=i;i.headers=g=Wa.from(g),i.url=CG(NG(i.baseURL,i.url,i.allowAbsoluteUrls),h.params,h.paramsSerializer),y&&g.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):"")));let v;if(Xe.isFormData(r)){if(ta.hasStandardBrowserEnv||ta.hasStandardBrowserWebWorkerEnv)g.setContentType(void 0);else if((v=g.getContentType())!==!1){const[T,...C]=v?v.split(";").map(I=>I.trim()).filter(Boolean):[];g.setContentType([T||"multipart/form-data",...C].join("; "))}}if(ta.hasStandardBrowserEnv&&(o&&Xe.isFunction(o)&&(o=o(i)),o||o!==!1&&ZJ(i.url))){const T=d&&p&&eQ.read(p);T&&g.set(d,T)}return i},iQ=typeof XMLHttpRequest<"u",sQ=iQ&&function(h){return new Promise(function(r,o){const d=LG(h);let p=d.data;const g=Wa.from(d.headers).normalize();let{responseType:y,onUploadProgress:v,onDownloadProgress:T}=d,C,I,L,N,x;function K(){N&&N(),x&&x(),d.cancelToken&&d.cancelToken.unsubscribe(C),d.signal&&d.signal.removeEventListener("abort",C)}let H=new XMLHttpRequest;H.open(d.method.toUpperCase(),d.url,!0),H.timeout=d.timeout;function Q(){if(!H)return;const ee=Wa.from("getAllResponseHeaders"in H&&H.getAllResponseHeaders()),de={data:!y||y==="text"||y==="json"?H.responseText:H.response,status:H.status,statusText:H.statusText,headers:ee,config:h,request:H};DG(function(Se){r(Se),K()},function(Se){o(Se),K()},de),H=null}"onloadend"in H?H.onloadend=Q:H.onreadystatechange=function(){!H||H.readyState!==4||H.status===0&&!(H.responseURL&&H.responseURL.indexOf("file:")===0)||setTimeout(Q)},H.onabort=function(){H&&(o(new In("Request aborted",In.ECONNABORTED,h,H)),H=null)},H.onerror=function(){o(new In("Network Error",In.ERR_NETWORK,h,H)),H=null},H.ontimeout=function(){let pe=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded";const de=d.transitional||IG;d.timeoutErrorMessage&&(pe=d.timeoutErrorMessage),o(new In(pe,de.clarifyTimeoutError?In.ETIMEDOUT:In.ECONNABORTED,h,H)),H=null},p===void 0&&g.setContentType(null),"setRequestHeader"in H&&Xe.forEach(g.toJSON(),function(pe,de){H.setRequestHeader(de,pe)}),Xe.isUndefined(d.withCredentials)||(H.withCredentials=!!d.withCredentials),y&&y!=="json"&&(H.responseType=d.responseType),T&&([L,x]=tC(T,!0),H.addEventListener("progress",L)),v&&H.upload&&([I,N]=tC(v),H.upload.addEventListener("progress",I),H.upload.addEventListener("loadend",N)),(d.cancelToken||d.signal)&&(C=ee=>{H&&(o(!ee||ee.type?new U_(null,h,H):ee),H.abort(),H=null)},d.cancelToken&&d.cancelToken.subscribe(C),d.signal&&(d.signal.aborted?C():d.signal.addEventListener("abort",C)));const ne=XJ(d.url);if(ne&&ta.protocols.indexOf(ne)===-1){o(new In("Unsupported protocol "+ne+":",In.ERR_BAD_REQUEST,h));return}H.send(p||null)})},rQ=(h,i)=>{const{length:r}=h=h?h.filter(Boolean):[];if(i||r){let o=new AbortController,d;const p=function(T){if(!d){d=!0,y();const C=T instanceof Error?T:this.reason;o.abort(C instanceof In?C:new U_(C instanceof Error?C.message:C))}};let g=i&&setTimeout(()=>{g=null,p(new In(`timeout ${i} of ms exceeded`,In.ETIMEDOUT))},i);const y=()=>{h&&(g&&clearTimeout(g),g=null,h.forEach(T=>{T.unsubscribe?T.unsubscribe(p):T.removeEventListener("abort",p)}),h=null)};h.forEach(T=>T.addEventListener("abort",p));const{signal:v}=o;return v.unsubscribe=()=>Xe.asap(y),v}},aQ=function*(h,i){let r=h.byteLength;if(r<i){yield h;return}let o=0,d;for(;o<r;)d=o+i,yield h.slice(o,d),o=d},oQ=async function*(h,i){for await(const r of cQ(h))yield*aQ(r,i)},cQ=async function*(h){if(h[Symbol.asyncIterator]){yield*h;return}const i=h.getReader();try{for(;;){const{done:r,value:o}=await i.read();if(r)break;yield o}}finally{await i.cancel()}},I3=(h,i,r,o)=>{const d=oQ(h,i);let p=0,g,y=v=>{g||(g=!0,o&&o(v))};return new ReadableStream({async pull(v){try{const{done:T,value:C}=await d.next();if(T){y(),v.close();return}let I=C.byteLength;if(r){let L=p+=I;r(L)}v.enqueue(new Uint8Array(C))}catch(T){throw y(T),T}},cancel(v){return y(v),d.return()}},{highWaterMark:2})},vC=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",xG=vC&&typeof ReadableStream=="function",lQ=vC&&(typeof TextEncoder=="function"?(h=>i=>h.encode(i))(new TextEncoder):async h=>new Uint8Array(await new Response(h).arrayBuffer())),PG=(h,...i)=>{try{return!!h(...i)}catch{return!1}},dQ=xG&&PG(()=>{let h=!1;const i=new Request(ta.origin,{body:new ReadableStream,method:"POST",get duplex(){return h=!0,"half"}}).headers.has("Content-Type");return h&&!i}),w3=64*1024,NN=xG&&PG(()=>Xe.isReadableStream(new Response("").body)),nC={stream:NN&&(h=>h.body)};vC&&(h=>{["text","arrayBuffer","blob","formData","stream"].forEach(i=>{!nC[i]&&(nC[i]=Xe.isFunction(h[i])?r=>r[i]():(r,o)=>{throw new In(`Response type '${i}' is not supported`,In.ERR_NOT_SUPPORT,o)})})})(new Response);const uQ=async h=>{if(h==null)return 0;if(Xe.isBlob(h))return h.size;if(Xe.isSpecCompliantForm(h))return(await new Request(ta.origin,{method:"POST",body:h}).arrayBuffer()).byteLength;if(Xe.isArrayBufferView(h)||Xe.isArrayBuffer(h))return h.byteLength;if(Xe.isURLSearchParams(h)&&(h=h+""),Xe.isString(h))return(await lQ(h)).byteLength},hQ=async(h,i)=>{const r=Xe.toFiniteNumber(h.getContentLength());return r??uQ(i)},fQ=vC&&(async h=>{let{url:i,method:r,data:o,signal:d,cancelToken:p,timeout:g,onDownloadProgress:y,onUploadProgress:v,responseType:T,headers:C,withCredentials:I="same-origin",fetchOptions:L}=LG(h);T=T?(T+"").toLowerCase():"text";let N=rQ([d,p&&p.toAbortSignal()],g),x;const K=N&&N.unsubscribe&&(()=>{N.unsubscribe()});let H;try{if(v&&dQ&&r!=="get"&&r!=="head"&&(H=await hQ(C,o))!==0){let de=new Request(i,{method:"POST",body:o,duplex:"half"}),be;if(Xe.isFormData(o)&&(be=de.headers.get("content-type"))&&C.setContentType(be),de.body){const[Se,Te]=R3(H,tC(A3(v)));o=I3(de.body,w3,Se,Te)}}Xe.isString(I)||(I=I?"include":"omit");const Q="credentials"in Request.prototype;x=new Request(i,{...L,signal:N,method:r.toUpperCase(),headers:C.normalize().toJSON(),body:o,duplex:"half",credentials:Q?I:void 0});let ne=await fetch(x);const ee=NN&&(T==="stream"||T==="response");if(NN&&(y||ee&&K)){const de={};["status","statusText","headers"].forEach(_e=>{de[_e]=ne[_e]});const be=Xe.toFiniteNumber(ne.headers.get("content-length")),[Se,Te]=y&&R3(be,tC(A3(y),!0))||[];ne=new Response(I3(ne.body,w3,Se,()=>{Te&&Te(),K&&K()}),de)}T=T||"text";let pe=await nC[Xe.findKey(nC,T)||"text"](ne,h);return!ee&&K&&K(),await new Promise((de,be)=>{DG(de,be,{data:pe,headers:Wa.from(ne.headers),status:ne.status,statusText:ne.statusText,config:h,request:x})})}catch(Q){throw K&&K(),Q&&Q.name==="TypeError"&&/fetch/i.test(Q.message)?Object.assign(new In("Network Error",In.ERR_NETWORK,h,x),{cause:Q.cause||Q}):In.from(Q,Q&&Q.code,h,x)}}),LN={http:wJ,xhr:sQ,fetch:fQ};Xe.forEach(LN,(h,i)=>{if(h){try{Object.defineProperty(h,"name",{value:i})}catch{}Object.defineProperty(h,"adapterName",{value:i})}});const O3=h=>`- ${h}`,pQ=h=>Xe.isFunction(h)||h===null||h===!1,kG={getAdapter:h=>{h=Xe.isArray(h)?h:[h];const{length:i}=h;let r,o;const d={};for(let p=0;p<i;p++){r=h[p];let g;if(o=r,!pQ(r)&&(o=LN[(g=String(r)).toLowerCase()],o===void 0))throw new In(`Unknown adapter '${g}'`);if(o)break;d[g||"#"+p]=o}if(!o){const p=Object.entries(d).map(([y,v])=>`adapter ${y} `+(v===!1?"is not supported by the environment":"is not available in the build"));let g=i?p.length>1?`since :
`+p.map(O3).join(`
`):" "+O3(p[0]):"as no adapter specified";throw new In("There is no suitable adapter to dispatch the request "+g,"ERR_NOT_SUPPORT")}return o},adapters:LN};function ZD(h){if(h.cancelToken&&h.cancelToken.throwIfRequested(),h.signal&&h.signal.aborted)throw new U_(null,h)}function D3(h){return ZD(h),h.headers=Wa.from(h.headers),h.data=QD.call(h,h.transformRequest),["post","put","patch"].indexOf(h.method)!==-1&&h.headers.setContentType("application/x-www-form-urlencoded",!1),kG.getAdapter(h.adapter||ST.adapter)(h).then(function(o){return ZD(h),o.data=QD.call(h,h.transformResponse,o),o.headers=Wa.from(o.headers),o},function(o){return OG(o)||(ZD(h),o&&o.response&&(o.response.data=QD.call(h,h.transformResponse,o.response),o.response.headers=Wa.from(o.response.headers))),Promise.reject(o)})}const MG="1.8.4",bC={};["object","boolean","number","function","string","symbol"].forEach((h,i)=>{bC[h]=function(o){return typeof o===h||"a"+(i<1?"n ":" ")+h}});const N3={};bC.transitional=function(i,r,o){function d(p,g){return"[Axios v"+MG+"] Transitional option '"+p+"'"+g+(o?". "+o:"")}return(p,g,y)=>{if(i===!1)throw new In(d(g," has been removed"+(r?" in "+r:"")),In.ERR_DEPRECATED);return r&&!N3[g]&&(N3[g]=!0,console.warn(d(g," has been deprecated since v"+r+" and will be removed in the near future"))),i?i(p,g,y):!0}};bC.spelling=function(i){return(r,o)=>(console.warn(`${o} is likely a misspelling of ${i}`),!0)};function mQ(h,i,r){if(typeof h!="object")throw new In("options must be an object",In.ERR_BAD_OPTION_VALUE);const o=Object.keys(h);let d=o.length;for(;d-- >0;){const p=o[d],g=i[p];if(g){const y=h[p],v=y===void 0||g(y,p,h);if(v!==!0)throw new In("option "+p+" must be "+v,In.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new In("Unknown option "+p,In.ERR_BAD_OPTION)}}const KA={assertOptions:mQ,validators:bC},ld=KA.validators;let Dm=class{constructor(i){this.defaults=i,this.interceptors={request:new v3,response:new v3}}async request(i,r){try{return await this._request(i,r)}catch(o){if(o instanceof Error){let d={};Error.captureStackTrace?Error.captureStackTrace(d):d=new Error;const p=d.stack?d.stack.replace(/^.+\n/,""):"";try{o.stack?p&&!String(o.stack).endsWith(p.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+p):o.stack=p}catch{}}throw o}}_request(i,r){typeof i=="string"?(r=r||{},r.url=i):r=i||{},r=Lm(this.defaults,r);const{transitional:o,paramsSerializer:d,headers:p}=r;o!==void 0&&KA.assertOptions(o,{silentJSONParsing:ld.transitional(ld.boolean),forcedJSONParsing:ld.transitional(ld.boolean),clarifyTimeoutError:ld.transitional(ld.boolean)},!1),d!=null&&(Xe.isFunction(d)?r.paramsSerializer={serialize:d}:KA.assertOptions(d,{encode:ld.function,serialize:ld.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),KA.assertOptions(r,{baseUrl:ld.spelling("baseURL"),withXsrfToken:ld.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let g=p&&Xe.merge(p.common,p[r.method]);p&&Xe.forEach(["delete","get","head","post","put","patch","common"],x=>{delete p[x]}),r.headers=Wa.concat(g,p);const y=[];let v=!0;this.interceptors.request.forEach(function(K){typeof K.runWhen=="function"&&K.runWhen(r)===!1||(v=v&&K.synchronous,y.unshift(K.fulfilled,K.rejected))});const T=[];this.interceptors.response.forEach(function(K){T.push(K.fulfilled,K.rejected)});let C,I=0,L;if(!v){const x=[D3.bind(this),void 0];for(x.unshift.apply(x,y),x.push.apply(x,T),L=x.length,C=Promise.resolve(r);I<L;)C=C.then(x[I++],x[I++]);return C}L=y.length;let N=r;for(I=0;I<L;){const x=y[I++],K=y[I++];try{N=x(N)}catch(H){K.call(this,H);break}}try{C=D3.call(this,N)}catch(x){return Promise.reject(x)}for(I=0,L=T.length;I<L;)C=C.then(T[I++],T[I++]);return C}getUri(i){i=Lm(this.defaults,i);const r=NG(i.baseURL,i.url,i.allowAbsoluteUrls);return CG(r,i.params,i.paramsSerializer)}};Xe.forEach(["delete","get","head","options"],function(i){Dm.prototype[i]=function(r,o){return this.request(Lm(o||{},{method:i,url:r,data:(o||{}).data}))}});Xe.forEach(["post","put","patch"],function(i){function r(o){return function(p,g,y){return this.request(Lm(y||{},{method:i,headers:o?{"Content-Type":"multipart/form-data"}:{},url:p,data:g}))}}Dm.prototype[i]=r(),Dm.prototype[i+"Form"]=r(!0)});let gQ=class UG{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(p){r=p});const o=this;this.promise.then(d=>{if(!o._listeners)return;let p=o._listeners.length;for(;p-- >0;)o._listeners[p](d);o._listeners=null}),this.promise.then=d=>{let p;const g=new Promise(y=>{o.subscribe(y),p=y}).then(d);return g.cancel=function(){o.unsubscribe(p)},g},i(function(p,g,y){o.reason||(o.reason=new U_(p,g,y),r(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const r=this._listeners.indexOf(i);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const i=new AbortController,r=o=>{i.abort(o)};return this.subscribe(r),i.signal.unsubscribe=()=>this.unsubscribe(r),i.signal}static source(){let i;return{token:new UG(function(d){i=d}),cancel:i}}};function EQ(h){return function(r){return h.apply(null,r)}}function _Q(h){return Xe.isObject(h)&&h.isAxiosError===!0}const xN={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(xN).forEach(([h,i])=>{xN[i]=h});function FG(h){const i=new Dm(h),r=mG(Dm.prototype.request,i);return Xe.extend(r,Dm.prototype,i,{allOwnKeys:!0}),Xe.extend(r,i,null,{allOwnKeys:!0}),r.create=function(d){return FG(Lm(h,d))},r}const Wi=FG(ST);Wi.Axios=Dm;Wi.CanceledError=U_;Wi.CancelToken=gQ;Wi.isCancel=OG;Wi.VERSION=MG;Wi.toFormData=TC;Wi.AxiosError=In;Wi.Cancel=Wi.CanceledError;Wi.all=function(i){return Promise.all(i)};Wi.spread=EQ;Wi.isAxiosError=_Q;Wi.mergeConfig=Lm;Wi.AxiosHeaders=Wa;Wi.formToJSON=h=>wG(Xe.isHTMLForm(h)?new FormData(h):h);Wi.getAdapter=kG.getAdapter;Wi.HttpStatusCode=xN;Wi.default=Wi;const{Axios:Ose,AxiosError:Dse,CanceledError:Nse,isCancel:Lse,CancelToken:xse,VERSION:Pse,all:kse,Cancel:Mse,isAxiosError:Use,spread:Fse,toFormData:Bse,AxiosHeaders:Vse,HttpStatusCode:jse,formToJSON:Gse,getAdapter:Hse,mergeConfig:Kse}=Wi;console.log("https://api.skaivoice.live/v1","import.meta.env.REACT_APP_API_URL");const BG=()=>{const h=localStorage.getItem("token")||"{}",i=Wi.create({baseURL:"https://api.skaivoice.live/v1"});return i.interceptors.request.use(r=>(r.headers.Authorization=h.token?`Bearer ${h.token}`:"",r.headers.domainName="skyvoice",r)),i.interceptors.response.use(r=>r.data,r=>{var d,p;const o=((p=(d=r.response)==null?void 0:d.data)==null?void 0:p.message)||r.message;throw console.error("API Error:",o),new Error(o)}),i};let SQ={data:""},yQ=h=>typeof window=="object"?((h?h.querySelector("#_goober"):window._goober)||Object.assign((h||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:h||SQ,TQ=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,vQ=/\/\*[^]*?\*\/|  +/g,L3=/\n+/g,df=(h,i)=>{let r="",o="",d="";for(let p in h){let g=h[p];p[0]=="@"?p[1]=="i"?r=p+" "+g+";":o+=p[1]=="f"?df(g,p):p+"{"+df(g,p[1]=="k"?"":i)+"}":typeof g=="object"?o+=df(g,i?i.replace(/([^,])+/g,y=>p.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,v=>/&/.test(v)?v.replace(/&/g,y):y?y+" "+v:v)):p):g!=null&&(p=/^--/.test(p)?p:p.replace(/[A-Z]/g,"-$&").toLowerCase(),d+=df.p?df.p(p,g):p+":"+g+";")}return r+(i&&d?i+"{"+d+"}":d)+o},Su={},VG=h=>{if(typeof h=="object"){let i="";for(let r in h)i+=r+VG(h[r]);return i}return h},bQ=(h,i,r,o,d)=>{let p=VG(h),g=Su[p]||(Su[p]=(v=>{let T=0,C=11;for(;T<v.length;)C=101*C+v.charCodeAt(T++)>>>0;return"go"+C})(p));if(!Su[g]){let v=p!==h?h:(T=>{let C,I,L=[{}];for(;C=TQ.exec(T.replace(vQ,""));)C[4]?L.shift():C[3]?(I=C[3].replace(L3," ").trim(),L.unshift(L[0][I]=L[0][I]||{})):L[0][C[1]]=C[2].replace(L3," ").trim();return L[0]})(h);Su[g]=df(d?{["@keyframes "+g]:v}:v,r?"":"."+g)}let y=r&&Su.g?Su.g:null;return r&&(Su.g=Su[g]),((v,T,C,I)=>{I?T.data=T.data.replace(I,v):T.data.indexOf(v)===-1&&(T.data=C?v+T.data:T.data+v)})(Su[g],i,o,y),g},RQ=(h,i,r)=>h.reduce((o,d,p)=>{let g=i[p];if(g&&g.call){let y=g(r),v=y&&y.props&&y.props.className||/^go/.test(y)&&y;g=v?"."+v:y&&typeof y=="object"?y.props?"":df(y,""):y===!1?"":y}return o+d+(g??"")},"");function RC(h){let i=this||{},r=h.call?h(i.p):h;return bQ(r.unshift?r.raw?RQ(r,[].slice.call(arguments,1),i.p):r.reduce((o,d)=>Object.assign(o,d&&d.call?d(i.p):d),{}):r,yQ(i.target),i.g,i.o,i.k)}let jG,PN,kN;RC.bind({g:1});let wu=RC.bind({k:1});function AQ(h,i,r,o){df.p=i,jG=h,PN=r,kN=o}function pf(h,i){let r=this||{};return function(){let o=arguments;function d(p,g){let y=Object.assign({},p),v=y.className||d.className;r.p=Object.assign({theme:PN&&PN()},y),r.o=/ *go\d+/.test(v),y.className=RC.apply(r,o)+(v?" "+v:"");let T=h;return h[0]&&(T=y.as||h,delete y.as),kN&&T[0]&&kN(y),jG(T,y)}return d}}var CQ=h=>typeof h=="function",MN=(h,i)=>CQ(h)?h(i):h,IQ=(()=>{let h=0;return()=>(++h).toString()})(),wQ=(()=>{let h;return()=>{if(h===void 0&&typeof window<"u"){let i=matchMedia("(prefers-reduced-motion: reduce)");h=!i||i.matches}return h}})(),OQ=20,GG=(h,i)=>{switch(i.type){case 0:return{...h,toasts:[i.toast,...h.toasts].slice(0,OQ)};case 1:return{...h,toasts:h.toasts.map(p=>p.id===i.toast.id?{...p,...i.toast}:p)};case 2:let{toast:r}=i;return GG(h,{type:h.toasts.find(p=>p.id===r.id)?1:0,toast:r});case 3:let{toastId:o}=i;return{...h,toasts:h.toasts.map(p=>p.id===o||o===void 0?{...p,dismissed:!0,visible:!1}:p)};case 4:return i.toastId===void 0?{...h,toasts:[]}:{...h,toasts:h.toasts.filter(p=>p.id!==i.toastId)};case 5:return{...h,pausedAt:i.time};case 6:let d=i.time-(h.pausedAt||0);return{...h,pausedAt:void 0,toasts:h.toasts.map(p=>({...p,pauseDuration:p.pauseDuration+d}))}}},DQ=[],eN={toasts:[],pausedAt:void 0},fL=h=>{eN=GG(eN,h),DQ.forEach(i=>{i(eN)})},NQ=(h,i="blank",r)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:i,ariaProps:{role:"status","aria-live":"polite"},message:h,pauseDuration:0,...r,id:(r==null?void 0:r.id)||IQ()}),yT=h=>(i,r)=>{let o=NQ(i,h,r);return fL({type:2,toast:o}),o.id},go=(h,i)=>yT("blank")(h,i);go.error=yT("error");go.success=yT("success");go.loading=yT("loading");go.custom=yT("custom");go.dismiss=h=>{fL({type:3,toastId:h})};go.remove=h=>fL({type:4,toastId:h});go.promise=(h,i,r)=>{let o=go.loading(i.loading,{...r,...r==null?void 0:r.loading});return typeof h=="function"&&(h=h()),h.then(d=>{let p=i.success?MN(i.success,d):void 0;return p?go.success(p,{id:o,...r,...r==null?void 0:r.success}):go.dismiss(o),d}).catch(d=>{let p=i.error?MN(i.error,d):void 0;p?go.error(p,{id:o,...r,...r==null?void 0:r.error}):go.dismiss(o)}),h};var LQ=wu`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,xQ=wu`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,PQ=wu`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,kQ=pf("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${h=>h.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${LQ} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${xQ} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${h=>h.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${PQ} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,MQ=wu`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,UQ=pf("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${h=>h.secondary||"#e0e0e0"};
  border-right-color: ${h=>h.primary||"#616161"};
  animation: ${MQ} 1s linear infinite;
`,FQ=wu`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,BQ=wu`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,VQ=pf("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${h=>h.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${FQ} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${BQ} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${h=>h.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,jQ=pf("div")`
  position: absolute;
`,GQ=pf("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,HQ=wu`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,KQ=pf("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${HQ} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,WQ=({toast:h})=>{let{icon:i,type:r,iconTheme:o}=h;return i!==void 0?typeof i=="string"?fe.createElement(KQ,null,i):i:r==="blank"?null:fe.createElement(GQ,null,fe.createElement(UQ,{...o}),r!=="loading"&&fe.createElement(jQ,null,r==="error"?fe.createElement(kQ,{...o}):fe.createElement(VQ,{...o})))},YQ=h=>`
0% {transform: translate3d(0,${h*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,qQ=h=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${h*-150}%,-1px) scale(.6); opacity:0;}
`,$Q="0%{opacity:0;} 100%{opacity:1;}",zQ="0%{opacity:1;} 100%{opacity:0;}",XQ=pf("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,JQ=pf("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,QQ=(h,i)=>{let r=h.includes("top")?1:-1,[o,d]=wQ()?[$Q,zQ]:[YQ(r),qQ(r)];return{animation:i?`${wu(o)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${wu(d)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}};fe.memo(({toast:h,position:i,style:r,children:o})=>{let d=h.height?QQ(h.position||i||"top-center",h.visible):{opacity:0},p=fe.createElement(WQ,{toast:h}),g=fe.createElement(JQ,{...h.ariaProps},MN(h.message,h));return fe.createElement(XQ,{className:h.className,style:{...d,...r,...h.style}},typeof o=="function"?o({icon:p,message:g}):fe.createElement(fe.Fragment,null,p,g))});AQ(fe.createElement);RC`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`;var Sa=go;const TT=()=>{const h=BG(),i=async N=>{try{const x=await h.post("/superadmin/login",N);return localStorage.setItem("superadminToken",x.token),x}catch(x){throw console.error(x),Sa.error("Login failed"),new Error(x)}},r=async N=>{try{const x=await h.post("/admin/create",N);return console.log(x,"response in create new admin"),x.message===" Admin created successfully!"&&(console.log("Admin created successfully"),Sa.success("Admin created successfully"),o()),x}catch(x){throw console.error(x),Sa.error("Failed to create admin"),new Error(x)}},o=async(N=10,x=0,K="")=>{try{return await h.get(`/admin/list?pagesize=${N}&offset=${x}&search=${K}`)}catch(H){throw console.error(H),Sa.error("Failed to fetch admin list"),new Error(H)}};return{superadminlogin:i,createNewAdmin:r,deleteAllRecordings:async N=>{try{const x={...N};return console.log("all data history",x),await h.delete("/agora-recording/superuser",{data:x})}catch(x){throw console.error(x),Sa.error("Failed to delete all recordings"),new Error(x)}},listAdmin:o,getAdminById:async N=>{try{return await h.get(`/admin/get/${N}`)}catch(x){throw console.error(x),Sa.error("Failed to fetch admin details"),new Error(x)}},adminDropdown:async()=>{try{return await h.get("/admin/dropdown")}catch(N){throw console.error(N),Sa.error("Failed to fetch admin dropdown"),new Error(N)}},updateAdmin:async(N,x)=>{try{const K=await h.put(`/admin/update/${N}`,x);return K.message===" Admin updated successfully"&&Sa.success("Admin updated successfully"),K}catch(K){throw console.error(K),Sa.error("Failed to update admin"),new Error(K)}},deleteAdmin:async N=>{console.log("userToDelete",N);try{const x=await h.delete(`/admin/delete/${N}`);return x.message===" Admin deleted successfully"&&Sa.success("Admin deleted successfully"),x}catch(x){throw console.error(x),Sa.error("Failed to delete admin"),new Error(x)}},adminhistory:async()=>{try{return await h.get("/superadmin/gethistory")}catch(N){throw console.error(N),Sa.error("Failed to fetch admin history"),new Error(N)}},deleteadminhistory:async N=>{try{return await h.delete(`/superadmin/deletehistory/${N}`)}catch(x){throw console.error(x),Sa.error("Failed to delete admin history"),new Error(x)}},saveprice:async N=>{try{return await h.post("/superadmin/saveprice",N)}catch(x){throw console.error(x),Sa.error("Failed to create price"),new Error(x)}},getprice:async()=>{try{return await h.get("/superadmin/getprice")}catch(N){throw console.error(N),Sa.error("Failed to fetch price "),new Error(N)}}}};var WA={exports:{}};/*!
* sweetalert2 v11.17.2
* Released under the MIT License.
*/var rf=WA.exports,x3;function ZQ(){return x3||(x3=1,function(h,i){(function(r,o){h.exports=o()})(rf,function(){function r(P,V,X){if(typeof P=="function"?P===V:P.has(V))return arguments.length<3?V:X;throw new TypeError("Private element is not present on this object")}function o(P,V){if(V.has(P))throw new TypeError("Cannot initialize the same private elements twice on an object")}function d(P,V){return P.get(r(P,V))}function p(P,V,X){o(P,V),V.set(P,X)}function g(P,V,X){return P.set(r(P,V),X),X}const y=100,v={},T=()=>{v.previousActiveElement instanceof HTMLElement?(v.previousActiveElement.focus(),v.previousActiveElement=null):document.body&&document.body.focus()},C=P=>new Promise(V=>{if(!P)return V();const X=window.scrollX,ce=window.scrollY;v.restoreFocusTimeout=setTimeout(()=>{T(),V()},y),window.scrollTo(X,ce)}),I="swal2-",N=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"].reduce((P,V)=>(P[V]=I+V,P),{}),K=["success","warning","info","question","error"].reduce((P,V)=>(P[V]=I+V,P),{}),H="SweetAlert2:",Q=P=>P.charAt(0).toUpperCase()+P.slice(1),ne=P=>{console.warn(`${H} ${typeof P=="object"?P.join(" "):P}`)},ee=P=>{console.error(`${H} ${P}`)},pe=[],de=P=>{pe.includes(P)||(pe.push(P),ne(P))},be=function(P){let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;de(`"${P}" is deprecated and will be removed in the next major release.${V?` Use "${V}" instead.`:""}`)},Se=P=>typeof P=="function"?P():P,Te=P=>P&&typeof P.toPromise=="function",_e=P=>Te(P)?P.toPromise():Promise.resolve(P),he=P=>P&&Promise.resolve(P)===P,Ge=()=>document.body.querySelector(`.${N.container}`),st=P=>{const V=Ge();return V?V.querySelector(P):null},It=P=>st(`.${P}`),qe=()=>It(N.popup),ut=()=>It(N.icon),Oe=()=>It(N["icon-content"]),Qe=()=>It(N.title),Ke=()=>It(N["html-container"]),Re=()=>It(N.image),se=()=>It(N["progress-steps"]),we=()=>It(N["validation-message"]),He=()=>st(`.${N.actions} .${N.confirm}`),ct=()=>st(`.${N.actions} .${N.cancel}`),Be=()=>st(`.${N.actions} .${N.deny}`),Et=()=>It(N["input-label"]),St=()=>st(`.${N.loader}`),it=()=>It(N.actions),Ze=()=>It(N.footer),mt=()=>It(N["timer-progress-bar"]),bt=()=>It(N.close),gn=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,Ft=()=>{const P=qe();if(!P)return[];const V=P.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),X=Array.from(V).sort((At,cn)=>{const Un=parseInt(At.getAttribute("tabindex")||"0"),Oi=parseInt(cn.getAttribute("tabindex")||"0");return Un>Oi?1:Un<Oi?-1:0}),ce=P.querySelectorAll(gn),Fe=Array.from(ce).filter(At=>At.getAttribute("tabindex")!=="-1");return[...new Set(X.concat(Fe))].filter(At=>Ys(At))},ei=()=>$n(document.body,N.shown)&&!$n(document.body,N["toast-shown"])&&!$n(document.body,N["no-backdrop"]),ri=()=>{const P=qe();return P?$n(P,N.toast):!1},Ws=()=>{const P=qe();return P?P.hasAttribute("data-loading"):!1},jt=(P,V)=>{if(P.textContent="",V){const ce=new DOMParser().parseFromString(V,"text/html"),Fe=ce.querySelector("head");Fe&&Array.from(Fe.childNodes).forEach(cn=>{P.appendChild(cn)});const At=ce.querySelector("body");At&&Array.from(At.childNodes).forEach(cn=>{cn instanceof HTMLVideoElement||cn instanceof HTMLAudioElement?P.appendChild(cn.cloneNode(!0)):P.appendChild(cn)})}},$n=(P,V)=>{if(!V)return!1;const X=V.split(/\s+/);for(let ce=0;ce<X.length;ce++)if(!P.classList.contains(X[ce]))return!1;return!0},Wn=(P,V)=>{Array.from(P.classList).forEach(X=>{!Object.values(N).includes(X)&&!Object.values(K).includes(X)&&!Object.values(V.showClass||{}).includes(X)&&P.classList.remove(X)})},yi=(P,V,X)=>{if(Wn(P,V),!V.customClass)return;const ce=V.customClass[X];if(ce){if(typeof ce!="string"&&!ce.forEach){ne(`Invalid type of customClass.${X}! Expected string or iterable object, got "${typeof ce}"`);return}Tt(P,ce)}},lt=(P,V)=>{if(!V)return null;switch(V){case"select":case"textarea":case"file":return P.querySelector(`.${N.popup} > .${N[V]}`);case"checkbox":return P.querySelector(`.${N.popup} > .${N.checkbox} input`);case"radio":return P.querySelector(`.${N.popup} > .${N.radio} input:checked`)||P.querySelector(`.${N.popup} > .${N.radio} input:first-child`);case"range":return P.querySelector(`.${N.popup} > .${N.range} input`);default:return P.querySelector(`.${N.popup} > .${N.input}`)}},yt=P=>{if(P.focus(),P.type!=="file"){const V=P.value;P.value="",P.value=V}},Ot=(P,V,X)=>{!P||!V||(typeof V=="string"&&(V=V.split(/\s+/).filter(Boolean)),V.forEach(ce=>{Array.isArray(P)?P.forEach(Fe=>{X?Fe.classList.add(ce):Fe.classList.remove(ce)}):X?P.classList.add(ce):P.classList.remove(ce)}))},Tt=(P,V)=>{Ot(P,V,!0)},Xt=(P,V)=>{Ot(P,V,!1)},zn=(P,V)=>{const X=Array.from(P.children);for(let ce=0;ce<X.length;ce++){const Fe=X[ce];if(Fe instanceof HTMLElement&&$n(Fe,V))return Fe}},hs=(P,V,X)=>{X===`${parseInt(X)}`&&(X=parseInt(X)),X||parseInt(X)===0?P.style.setProperty(V,typeof X=="number"?`${X}px`:X):P.style.removeProperty(V)},Nn=function(P){let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"flex";P&&(P.style.display=V)},hi=P=>{P&&(P.style.display="none")},uc=function(P){let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"block";P&&new MutationObserver(()=>{Br(P,P.innerHTML,V)}).observe(P,{childList:!0,subtree:!0})},yo=(P,V,X,ce)=>{const Fe=P.querySelector(V);Fe&&Fe.style.setProperty(X,ce)},Br=function(P,V){let X=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"flex";V?Nn(P,X):hi(P)},Ys=P=>!!(P&&(P.offsetWidth||P.offsetHeight||P.getClientRects().length)),ul=()=>!Ys(He())&&!Ys(Be())&&!Ys(ct()),qs=P=>P.scrollHeight>P.clientHeight,To=P=>{const V=window.getComputedStyle(P),X=parseFloat(V.getPropertyValue("animation-duration")||"0"),ce=parseFloat(V.getPropertyValue("transition-duration")||"0");return X>0||ce>0},na=function(P){let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const X=mt();X&&Ys(X)&&(V&&(X.style.transition="none",X.style.width="100%"),setTimeout(()=>{X.style.transition=`width ${P/1e3}s linear`,X.style.width="0%"},10))},Cr=()=>{const P=mt();if(!P)return;const V=parseInt(window.getComputedStyle(P).width);P.style.removeProperty("transition"),P.style.width="100%";const X=parseInt(window.getComputedStyle(P).width),ce=V/X*100;P.style.width=`${ce}%`},F_=()=>typeof window>"u"||typeof document>"u",hl=`
 <div aria-labelledby="${N.title}" aria-describedby="${N["html-container"]}" class="${N.popup}" tabindex="-1">
   <button type="button" class="${N.close}"></button>
   <ul class="${N["progress-steps"]}"></ul>
   <div class="${N.icon}"></div>
   <img class="${N.image}" />
   <h2 class="${N.title}" id="${N.title}"></h2>
   <div class="${N["html-container"]}" id="${N["html-container"]}"></div>
   <input class="${N.input}" id="${N.input}" />
   <input type="file" class="${N.file}" />
   <div class="${N.range}">
     <input type="range" />
     <output></output>
   </div>
   <select class="${N.select}" id="${N.select}"></select>
   <div class="${N.radio}"></div>
   <label class="${N.checkbox}">
     <input type="checkbox" id="${N.checkbox}" />
     <span class="${N.label}"></span>
   </label>
   <textarea class="${N.textarea}" id="${N.textarea}"></textarea>
   <div class="${N["validation-message"]}" id="${N["validation-message"]}"></div>
   <div class="${N.actions}">
     <div class="${N.loader}"></div>
     <button type="button" class="${N.confirm}"></button>
     <button type="button" class="${N.deny}"></button>
     <button type="button" class="${N.cancel}"></button>
   </div>
   <div class="${N.footer}"></div>
   <div class="${N["timer-progress-bar-container"]}">
     <div class="${N["timer-progress-bar"]}"></div>
   </div>
 </div>
`.replace(/(^|\n)\s*/g,""),Mm=()=>{const P=Ge();return P?(P.remove(),Xt([document.documentElement,document.body],[N["no-backdrop"],N["toast-shown"],N["has-column"]]),!0):!1},ya=()=>{v.currentInstance.resetValidationMessage()},Du=()=>{const P=qe(),V=zn(P,N.input),X=zn(P,N.file),ce=P.querySelector(`.${N.range} input`),Fe=P.querySelector(`.${N.range} output`),At=zn(P,N.select),cn=P.querySelector(`.${N.checkbox} input`),Un=zn(P,N.textarea);V.oninput=ya,X.onchange=ya,At.onchange=ya,cn.onchange=ya,Un.oninput=ya,ce.oninput=()=>{ya(),Fe.value=ce.value},ce.onchange=()=>{ya(),Fe.value=ce.value}},hc=P=>typeof P=="string"?document.querySelector(P):P,Nu=P=>{const V=qe();V.setAttribute("role",P.toast?"alert":"dialog"),V.setAttribute("aria-live",P.toast?"polite":"assertive"),P.toast||V.setAttribute("aria-modal","true")},Ya=P=>{window.getComputedStyle(P).direction==="rtl"&&Tt(Ge(),N.rtl)},B_=P=>{const V=Mm();if(F_()){ee("SweetAlert2 requires document to initialize");return}const X=document.createElement("div");X.className=N.container,V&&Tt(X,N["no-transition"]),jt(X,hl),X.dataset.swal2Theme=P.theme;const ce=hc(P.target);ce.appendChild(X),Nu(P),Ya(ce),Du()},qa=(P,V)=>{P instanceof HTMLElement?V.appendChild(P):typeof P=="object"?Um(P,V):P&&jt(V,P)},Um=(P,V)=>{P.jquery?mf(V,P):jt(V,P.toString())},mf=(P,V)=>{if(P.textContent="",0 in V)for(let X=0;X in V;X++)P.appendChild(V[X].cloneNode(!0));else P.appendChild(V.cloneNode(!0))},vd=(P,V)=>{const X=it(),ce=St();!X||!ce||(!V.showConfirmButton&&!V.showDenyButton&&!V.showCancelButton?hi(X):Nn(X),yi(X,V,"actions"),Ir(X,ce,V),jt(ce,V.loaderHtml||""),yi(ce,V,"loader"))};function Ir(P,V,X){const ce=He(),Fe=Be(),At=ct();!ce||!Fe||!At||(Lu(ce,"confirm",X),Lu(Fe,"deny",X),Lu(At,"cancel",X),Fm(ce,Fe,At,X),X.reverseButtons&&(X.toast?(P.insertBefore(At,ce),P.insertBefore(Fe,ce)):(P.insertBefore(At,V),P.insertBefore(Fe,V),P.insertBefore(ce,V))))}function Fm(P,V,X,ce){if(!ce.buttonsStyling){Xt([P,V,X],N.styled);return}Tt([P,V,X],N.styled),ce.confirmButtonColor&&(P.style.backgroundColor=ce.confirmButtonColor,Tt(P,N["default-outline"])),ce.denyButtonColor&&(V.style.backgroundColor=ce.denyButtonColor,Tt(V,N["default-outline"])),ce.cancelButtonColor&&(X.style.backgroundColor=ce.cancelButtonColor,Tt(X,N["default-outline"]))}function Lu(P,V,X){const ce=Q(V);Br(P,X[`show${ce}Button`],"inline-block"),jt(P,X[`${V}ButtonText`]||""),P.setAttribute("aria-label",X[`${V}ButtonAriaLabel`]||""),P.className=N[V],yi(P,X,`${V}Button`)}const bd=(P,V)=>{const X=bt();X&&(jt(X,V.closeButtonHtml||""),yi(X,V,"closeButton"),Br(X,V.showCloseButton),X.setAttribute("aria-label",V.closeButtonAriaLabel||""))},gf=(P,V)=>{const X=Ge();X&&(Bm(X,V.backdrop),$a(X,V.position),Fs(X,V.grow),yi(X,V,"container"))};function Bm(P,V){typeof V=="string"?P.style.background=V:V||Tt([document.documentElement,document.body],N["no-backdrop"])}function $a(P,V){V&&(V in N?Tt(P,N[V]):(ne('The "position" parameter is not valid, defaulting to "center"'),Tt(P,N.center)))}function Fs(P,V){V&&Tt(P,N[`grow-${V}`])}var _n={innerParams:new WeakMap,domCache:new WeakMap};const fc=["input","file","range","select","radio","checkbox","textarea"],Ef=(P,V)=>{const X=qe();if(!X)return;const ce=_n.innerParams.get(P),Fe=!ce||V.input!==ce.input;fc.forEach(At=>{const cn=zn(X,N[At]);cn&&(xu(At,V.inputAttributes),cn.className=N[At],Fe&&hi(cn))}),V.input&&(Fe&&V_(V),fl(V))},V_=P=>{if(!P.input)return;if(!Ti[P.input]){ee(`Unexpected type of input! Expected ${Object.keys(Ti).join(" | ")}, got "${P.input}"`);return}const V=pc(P.input);if(!V)return;const X=Ti[P.input](V,P);Nn(V),P.inputAutoFocus&&setTimeout(()=>{yt(X)})},Vm=P=>{for(let V=0;V<P.attributes.length;V++){const X=P.attributes[V].name;["id","type","value","style"].includes(X)||P.removeAttribute(X)}},xu=(P,V)=>{const X=qe();if(!X)return;const ce=lt(X,P);if(ce){Vm(ce);for(const Fe in V)ce.setAttribute(Fe,V[Fe])}},fl=P=>{if(!P.input)return;const V=pc(P.input);V&&yi(V,P,"input")},Ta=(P,V)=>{!P.placeholder&&V.inputPlaceholder&&(P.placeholder=V.inputPlaceholder)},ia=(P,V,X)=>{if(X.inputLabel){const ce=document.createElement("label"),Fe=N["input-label"];ce.setAttribute("for",P.id),ce.className=Fe,typeof X.customClass=="object"&&Tt(ce,X.customClass.inputLabel),ce.innerText=X.inputLabel,V.insertAdjacentElement("beforebegin",ce)}},pc=P=>{const V=qe();if(V)return zn(V,N[P]||N.input)},Ns=(P,V)=>{["string","number"].includes(typeof V)?P.value=`${V}`:he(V)||ne(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof V}"`)},Ti={};Ti.text=Ti.email=Ti.password=Ti.number=Ti.tel=Ti.url=Ti.search=Ti.date=Ti["datetime-local"]=Ti.time=Ti.week=Ti.month=(P,V)=>(Ns(P,V.inputValue),ia(P,P,V),Ta(P,V),P.type=V.input,P),Ti.file=(P,V)=>(ia(P,P,V),Ta(P,V),P),Ti.range=(P,V)=>{const X=P.querySelector("input"),ce=P.querySelector("output");return Ns(X,V.inputValue),X.type=V.input,Ns(ce,V.inputValue),ia(X,P,V),P},Ti.select=(P,V)=>{if(P.textContent="",V.inputPlaceholder){const X=document.createElement("option");jt(X,V.inputPlaceholder),X.value="",X.disabled=!0,X.selected=!0,P.appendChild(X)}return ia(P,P,V),P},Ti.radio=P=>(P.textContent="",P),Ti.checkbox=(P,V)=>{const X=lt(qe(),"checkbox");X.value="1",X.checked=!!V.inputValue;const ce=P.querySelector("span");return jt(ce,V.inputPlaceholder||V.inputLabel),X},Ti.textarea=(P,V)=>{Ns(P,V.inputValue),Ta(P,V),ia(P,P,V);const X=ce=>parseInt(window.getComputedStyle(ce).marginLeft)+parseInt(window.getComputedStyle(ce).marginRight);return setTimeout(()=>{if("MutationObserver"in window){const ce=parseInt(window.getComputedStyle(qe()).width),Fe=()=>{if(!document.body.contains(P))return;const At=P.offsetWidth+X(P);At>ce?qe().style.width=`${At}px`:hs(qe(),"width",V.width)};new MutationObserver(Fe).observe(P,{attributes:!0,attributeFilter:["style"]})}}),P};const ys=(P,V)=>{const X=Ke();X&&(uc(X),yi(X,V,"htmlContainer"),V.html?(qa(V.html,X),Nn(X,"block")):V.text?(X.textContent=V.text,Nn(X,"block")):hi(X),Ef(P,V))},Yi=(P,V)=>{const X=Ze();X&&(uc(X),Br(X,V.footer,"block"),V.footer&&qa(V.footer,X),yi(X,V,"footer"))},jm=(P,V)=>{const X=_n.innerParams.get(P),ce=ut();if(!ce)return;if(X&&V.icon===X.icon){Sf(ce,V),vo(ce,V);return}if(!V.icon&&!V.iconHtml){hi(ce);return}if(V.icon&&Object.keys(K).indexOf(V.icon)===-1){ee(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${V.icon}"`),hi(ce);return}Nn(ce),Sf(ce,V),vo(ce,V),Tt(ce,V.showClass&&V.showClass.icon),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",mc)},vo=(P,V)=>{for(const[X,ce]of Object.entries(K))V.icon!==X&&Xt(P,ce);Tt(P,V.icon&&K[V.icon]),yf(P,V),mc(),yi(P,V,"icon")},mc=()=>{const P=qe();if(!P)return;const V=window.getComputedStyle(P).getPropertyValue("background-color"),X=P.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let ce=0;ce<X.length;ce++)X[ce].style.backgroundColor=V},za=`
  <div class="swal2-success-circular-line-left"></div>
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>
  <div class="swal2-success-circular-line-right"></div>
`,_f=`
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`,Sf=(P,V)=>{if(!V.icon&&!V.iconHtml)return;let X=P.innerHTML,ce="";V.iconHtml?ce=Gm(V.iconHtml):V.icon==="success"?(ce=za,X=X.replace(/ style=".*?"/g,"")):V.icon==="error"?ce=_f:V.icon&&(ce=Gm({question:"?",warning:"!",info:"i"}[V.icon])),X.trim()!==ce.trim()&&jt(P,ce)},yf=(P,V)=>{if(V.iconColor){P.style.color=V.iconColor,P.style.borderColor=V.iconColor;for(const X of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])yo(P,X,"background-color",V.iconColor);yo(P,".swal2-success-ring","border-color",V.iconColor)}},Gm=P=>`<div class="${N["icon-content"]}">${P}</div>`,Pu=(P,V)=>{const X=Re();if(X){if(!V.imageUrl){hi(X);return}Nn(X,""),X.setAttribute("src",V.imageUrl),X.setAttribute("alt",V.imageAlt||""),hs(X,"width",V.imageWidth),hs(X,"height",V.imageHeight),X.className=N.image,yi(X,V,"image")}};let pl=!1,$s=0,zs=0,Tf=0,ti=0;const ku=P=>{P.addEventListener("mousedown",bo),document.body.addEventListener("mousemove",Mu),P.addEventListener("mouseup",Xs),P.addEventListener("touchstart",bo),document.body.addEventListener("touchmove",Mu),P.addEventListener("touchend",Xs)},vf=P=>{P.removeEventListener("mousedown",bo),document.body.removeEventListener("mousemove",Mu),P.removeEventListener("mouseup",Xs),P.removeEventListener("touchstart",bo),document.body.removeEventListener("touchmove",Mu),P.removeEventListener("touchend",Xs)},bo=P=>{const V=qe();if(P.target===V||ut().contains(P.target)){pl=!0;const X=Uu(P);$s=X.clientX,zs=X.clientY,Tf=parseInt(V.style.insetInlineStart)||0,ti=parseInt(V.style.insetBlockStart)||0,Tt(V,"swal2-dragging")}},Mu=P=>{const V=qe();if(pl){let{clientX:X,clientY:ce}=Uu(P);V.style.insetInlineStart=`${Tf+(X-$s)}px`,V.style.insetBlockStart=`${ti+(ce-zs)}px`}},Xs=()=>{const P=qe();pl=!1,Xt(P,"swal2-dragging")},Uu=P=>{let V=0,X=0;return P.type.startsWith("mouse")?(V=P.clientX,X=P.clientY):P.type.startsWith("touch")&&(V=P.touches[0].clientX,X=P.touches[0].clientY),{clientX:V,clientY:X}},Hm=(P,V)=>{const X=Ge(),ce=qe();if(!(!X||!ce)){if(V.toast){hs(X,"width",V.width),ce.style.width="100%";const Fe=St();Fe&&ce.insertBefore(Fe,ut())}else hs(ce,"width",V.width);hs(ce,"padding",V.padding),V.color&&(ce.style.color=V.color),V.background&&(ce.style.background=V.background),hi(we()),bf(ce,V),V.draggable&&!V.toast?(Tt(ce,N.draggable),ku(ce)):(Xt(ce,N.draggable),vf(ce))}},bf=(P,V)=>{const X=V.showClass||{};P.className=`${N.popup} ${Ys(P)?X.popup:""}`,V.toast?(Tt([document.documentElement,document.body],N["toast-shown"]),Tt(P,N.toast)):Tt(P,N.modal),yi(P,V,"popup"),typeof V.customClass=="string"&&Tt(P,V.customClass),V.icon&&Tt(P,N[`icon-${V.icon}`])},ml=(P,V)=>{const X=se();if(!X)return;const{progressSteps:ce,currentProgressStep:Fe}=V;if(!ce||ce.length===0||Fe===void 0){hi(X);return}Nn(X),X.textContent="",Fe>=ce.length&&ne("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),ce.forEach((At,cn)=>{const Un=Rd(At);if(X.appendChild(Un),cn===Fe&&Tt(Un,N["active-progress-step"]),cn!==ce.length-1){const Oi=Rf(V);X.appendChild(Oi)}})},Rd=P=>{const V=document.createElement("li");return Tt(V,N["progress-step"]),jt(V,P),V},Rf=P=>{const V=document.createElement("li");return Tt(V,N["progress-step-line"]),P.progressStepsDistance&&hs(V,"width",P.progressStepsDistance),V},Ro=(P,V)=>{const X=Qe();X&&(uc(X),Br(X,V.title||V.titleText,"block"),V.title&&qa(V.title,X),V.titleText&&(X.innerText=V.titleText),yi(X,V,"title"))},Km=(P,V)=>{Hm(P,V),gf(P,V),ml(P,V),jm(P,V),Pu(P,V),Ro(P,V),bd(P,V),ys(P,V),vd(P,V),Yi(P,V);const X=qe();typeof V.didRender=="function"&&X&&V.didRender(X),v.eventEmitter.emit("didRender",X)},Fu=()=>Ys(qe()),Af=()=>{var P;return(P=He())===null||P===void 0?void 0:P.click()},Bu=()=>{var P;return(P=Be())===null||P===void 0?void 0:P.click()},j_=()=>{var P;return(P=ct())===null||P===void 0?void 0:P.click()},gl=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Ad=P=>{P.keydownTarget&&P.keydownHandlerAdded&&(P.keydownTarget.removeEventListener("keydown",P.keydownHandler,{capture:P.keydownListenerCapture}),P.keydownHandlerAdded=!1)},Cf=(P,V,X)=>{Ad(P),V.toast||(P.keydownHandler=ce=>Wm(V,ce,X),P.keydownTarget=V.keydownListenerCapture?window:qe(),P.keydownListenerCapture=V.keydownListenerCapture,P.keydownTarget.addEventListener("keydown",P.keydownHandler,{capture:P.keydownListenerCapture}),P.keydownHandlerAdded=!0)},Cd=(P,V)=>{var X;const ce=Ft();if(ce.length){P=P+V,P===ce.length?P=0:P===-1&&(P=ce.length-1),ce[P].focus();return}(X=qe())===null||X===void 0||X.focus()},gc=["ArrowRight","ArrowDown"],El=["ArrowLeft","ArrowUp"],Wm=(P,V,X)=>{P&&(V.isComposing||V.keyCode===229||(P.stopKeydownPropagation&&V.stopPropagation(),V.key==="Enter"?Vu(V,P):V.key==="Tab"?Ym(V):[...gc,...El].includes(V.key)?Id(V.key):V.key==="Escape"&&If(V,P,X)))},Vu=(P,V)=>{if(!Se(V.allowEnterKey))return;const X=lt(qe(),V.input);if(P.target&&X&&P.target instanceof HTMLElement&&P.target.outerHTML===X.outerHTML){if(["textarea","file"].includes(V.input))return;Af(),P.preventDefault()}},Ym=P=>{const V=P.target,X=Ft();let ce=-1;for(let Fe=0;Fe<X.length;Fe++)if(V===X[Fe]){ce=Fe;break}P.shiftKey?Cd(ce,-1):Cd(ce,1),P.stopPropagation(),P.preventDefault()},Id=P=>{const V=it(),X=He(),ce=Be(),Fe=ct();if(!V||!X||!ce||!Fe)return;const At=[X,ce,Fe];if(document.activeElement instanceof HTMLElement&&!At.includes(document.activeElement))return;const cn=gc.includes(P)?"nextElementSibling":"previousElementSibling";let Un=document.activeElement;if(Un){for(let Oi=0;Oi<V.children.length;Oi++){if(Un=Un[cn],!Un)return;if(Un instanceof HTMLButtonElement&&Ys(Un))break}Un instanceof HTMLButtonElement&&Un.focus()}},If=(P,V,X)=>{Se(V.allowEscapeKey)&&(P.preventDefault(),X(gl.esc))};var lr={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const Ao=()=>{const P=Ge();Array.from(document.body.children).forEach(X=>{X.contains(P)||(X.hasAttribute("aria-hidden")&&X.setAttribute("data-previous-aria-hidden",X.getAttribute("aria-hidden")||""),X.setAttribute("aria-hidden","true"))})},ju=()=>{Array.from(document.body.children).forEach(V=>{V.hasAttribute("data-previous-aria-hidden")?(V.setAttribute("aria-hidden",V.getAttribute("data-previous-aria-hidden")||""),V.removeAttribute("data-previous-aria-hidden")):V.removeAttribute("aria-hidden")})},wd=typeof window<"u"&&!!window.GestureEvent,qm=()=>{if(wd&&!$n(document.body,N.iosfix)){const P=document.body.scrollTop;document.body.style.top=`${P*-1}px`,Tt(document.body,N.iosfix),Od()}},Od=()=>{const P=Ge();if(!P)return;let V;P.ontouchstart=X=>{V=Gu(X)},P.ontouchmove=X=>{V&&(X.preventDefault(),X.stopPropagation())}},Gu=P=>{const V=P.target,X=Ge(),ce=Ke();return!X||!ce||$m(P)||dr(P)?!1:V===X||!qs(X)&&V instanceof HTMLElement&&V.tagName!=="INPUT"&&V.tagName!=="TEXTAREA"&&!(qs(ce)&&ce.contains(V))},$m=P=>P.touches&&P.touches.length&&P.touches[0].touchType==="stylus",dr=P=>P.touches&&P.touches.length>1,ur=()=>{if($n(document.body,N.iosfix)){const P=parseInt(document.body.style.top,10);Xt(document.body,N.iosfix),document.body.style.top="",document.body.scrollTop=P*-1}},Js=()=>{const P=document.createElement("div");P.className=N["scrollbar-measure"],document.body.appendChild(P);const V=P.getBoundingClientRect().width-P.clientWidth;return document.body.removeChild(P),V};let sa=null;const G_=P=>{sa===null&&(document.body.scrollHeight>window.innerHeight||P==="scroll")&&(sa=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${sa+Js()}px`)},wf=()=>{sa!==null&&(document.body.style.paddingRight=`${sa}px`,sa=null)};function Hu(P,V,X,ce){ri()?Qm(P,ce):(C(X).then(()=>Qm(P,ce)),Ad(v)),wd?(V.setAttribute("style","display:none !important"),V.removeAttribute("class"),V.innerHTML=""):V.remove(),ei()&&(wf(),ur(),ju()),is()}function is(){Xt([document.documentElement,document.body],[N.shown,N["height-auto"],N["no-backdrop"],N["toast-shown"]])}function ra(P){P=Jm(P);const V=lr.swalPromiseResolve.get(this),X=zm(this);this.isAwaitingPromise?P.isDismissed||(Co(this),V(P)):X&&V(P)}const zm=P=>{const V=qe();if(!V)return!1;const X=_n.innerParams.get(P);if(!X||$n(V,X.hideClass.popup))return!1;Xt(V,X.showClass.popup),Tt(V,X.hideClass.popup);const ce=Ge();return Xt(ce,X.showClass.backdrop),Tt(ce,X.hideClass.backdrop),Of(P,V,X),!0};function Xm(P){const V=lr.swalPromiseReject.get(this);Co(this),V&&V(P)}const Co=P=>{P.isAwaitingPromise&&(delete P.isAwaitingPromise,_n.innerParams.get(P)||P._destroy())},Jm=P=>typeof P>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},P),Of=(P,V,X)=>{var ce;const Fe=Ge(),At=To(V);typeof X.willClose=="function"&&X.willClose(V),(ce=v.eventEmitter)===null||ce===void 0||ce.emit("willClose",V),At?Df(P,V,Fe,X.returnFocus,X.didClose):Hu(P,Fe,X.returnFocus,X.didClose)},Df=(P,V,X,ce,Fe)=>{v.swalCloseEventFinishedCallback=Hu.bind(null,P,X,ce,Fe);const At=function(cn){if(cn.target===V){var Un;(Un=v.swalCloseEventFinishedCallback)===null||Un===void 0||Un.call(v),delete v.swalCloseEventFinishedCallback,V.removeEventListener("animationend",At),V.removeEventListener("transitionend",At)}};V.addEventListener("animationend",At),V.addEventListener("transitionend",At)},Qm=(P,V)=>{setTimeout(()=>{var X;typeof V=="function"&&V.bind(P.params)(),(X=v.eventEmitter)===null||X===void 0||X.emit("didClose"),P._destroy&&P._destroy()})},Io=P=>{let V=qe();if(V||new Rl,V=qe(),!V)return;const X=St();ri()?hi(ut()):Nf(V,P),Nn(X),V.setAttribute("data-loading","true"),V.setAttribute("aria-busy","true"),V.focus()},Nf=(P,V)=>{const X=it(),ce=St();!X||!ce||(!V&&Ys(He())&&(V=He()),Nn(X),V&&(hi(V),ce.setAttribute("data-button-to-replace",V.className),X.insertBefore(ce,V)),Tt([P,X],N.loading))},Lf=(P,V)=>{V.input==="select"||V.input==="radio"?K_(P,V):["text","email","number","tel","textarea"].some(X=>X===V.input)&&(Te(V.inputValue)||he(V.inputValue))&&(Io(He()),xf(P,V))},Zm=(P,V)=>{const X=P.getInput();if(!X)return null;switch(V.input){case"checkbox":return H_(X);case"radio":return wo(X);case"file":return Ku(X);default:return V.inputAutoTrim?X.value.trim():X.value}},H_=P=>P.checked?1:0,wo=P=>P.checked?P.value:null,Ku=P=>P.files&&P.files.length?P.getAttribute("multiple")!==null?P.files:P.files[0]:null,K_=(P,V)=>{const X=qe();if(!X)return;const ce=Fe=>{V.input==="select"?W_(X,Wu(Fe),V):V.input==="radio"&&Y_(X,Wu(Fe),V)};Te(V.inputOptions)||he(V.inputOptions)?(Io(He()),_e(V.inputOptions).then(Fe=>{P.hideLoading(),ce(Fe)})):typeof V.inputOptions=="object"?ce(V.inputOptions):ee(`Unexpected type of inputOptions! Expected object, Map or Promise, got ${typeof V.inputOptions}`)},xf=(P,V)=>{const X=P.getInput();X&&(hi(X),_e(V.inputValue).then(ce=>{X.value=V.input==="number"?`${parseFloat(ce)||0}`:`${ce}`,Nn(X),X.focus(),P.hideLoading()}).catch(ce=>{ee(`Error in inputValue promise: ${ce}`),X.value="",Nn(X),X.focus(),P.hideLoading()}))};function W_(P,V,X){const ce=zn(P,N.select);if(!ce)return;const Fe=(At,cn,Un)=>{const Oi=document.createElement("option");Oi.value=Un,jt(Oi,cn),Oi.selected=Oo(Un,X.inputValue),At.appendChild(Oi)};V.forEach(At=>{const cn=At[0],Un=At[1];if(Array.isArray(Un)){const Oi=document.createElement("optgroup");Oi.label=cn,Oi.disabled=!1,ce.appendChild(Oi),Un.forEach(vc=>Fe(Oi,vc[1],vc[0]))}else Fe(ce,Un,cn)}),ce.focus()}function Y_(P,V,X){const ce=zn(P,N.radio);if(!ce)return;V.forEach(At=>{const cn=At[0],Un=At[1],Oi=document.createElement("input"),vc=document.createElement("label");Oi.type="radio",Oi.name=N.radio,Oi.value=cn,Oo(cn,X.inputValue)&&(Oi.checked=!0);const Al=document.createElement("span");jt(Al,Un),Al.className=N.label,vc.appendChild(Oi),vc.appendChild(Al),ce.appendChild(vc)});const Fe=ce.querySelectorAll("input");Fe.length&&Fe[0].focus()}const Wu=P=>{const V=[];return P instanceof Map?P.forEach((X,ce)=>{let Fe=X;typeof Fe=="object"&&(Fe=Wu(Fe)),V.push([ce,Fe])}):Object.keys(P).forEach(X=>{let ce=P[X];typeof ce=="object"&&(ce=Wu(ce)),V.push([X,ce])}),V},Oo=(P,V)=>!!V&&V.toString()===P.toString(),q_=P=>{const V=_n.innerParams.get(P);P.disableButtons(),V.input?tg(P,"confirm"):kf(P,!0)},_l=P=>{const V=_n.innerParams.get(P);P.disableButtons(),V.returnInputValueOnDeny?tg(P,"deny"):Pf(P,!1)},eg=(P,V)=>{P.disableButtons(),V(gl.cancel)},tg=(P,V)=>{const X=_n.innerParams.get(P);if(!X.input){ee(`The "input" parameter is needed to be set when using returnInputValueOn${Q(V)}`);return}const ce=P.getInput(),Fe=Zm(P,X);X.inputValidator?fn(P,Fe,V):ce&&!ce.checkValidity()?(P.enableButtons(),P.showValidationMessage(X.validationMessage||ce.validationMessage)):V==="deny"?Pf(P,Fe):kf(P,Fe)},fn=(P,V,X)=>{const ce=_n.innerParams.get(P);P.disableInput(),Promise.resolve().then(()=>_e(ce.inputValidator(V,ce.validationMessage))).then(At=>{P.enableButtons(),P.enableInput(),At?P.showValidationMessage(At):X==="deny"?Pf(P,V):kf(P,V)})},Pf=(P,V)=>{const X=_n.innerParams.get(P||void 0);X.showLoaderOnDeny&&Io(Be()),X.preDeny?(P.isAwaitingPromise=!0,Promise.resolve().then(()=>_e(X.preDeny(V,X.validationMessage))).then(Fe=>{Fe===!1?(P.hideLoading(),Co(P)):P.close({isDenied:!0,value:typeof Fe>"u"?V:Fe})}).catch(Fe=>ig(P||void 0,Fe))):P.close({isDenied:!0,value:V})},ng=(P,V)=>{P.close({isConfirmed:!0,value:V})},ig=(P,V)=>{P.rejectPromise(V)},kf=(P,V)=>{const X=_n.innerParams.get(P||void 0);X.showLoaderOnConfirm&&Io(),X.preConfirm?(P.resetValidationMessage(),P.isAwaitingPromise=!0,Promise.resolve().then(()=>_e(X.preConfirm(V,X.validationMessage))).then(Fe=>{Ys(we())||Fe===!1?(P.hideLoading(),Co(P)):ng(P,typeof Fe>"u"?V:Fe)}).catch(Fe=>ig(P||void 0,Fe))):ng(P,V)};function Do(){const P=_n.innerParams.get(this);if(!P)return;const V=_n.domCache.get(this);hi(V.loader),ri()?P.icon&&Nn(ut()):Dd(V),Xt([V.popup,V.actions],N.loading),V.popup.removeAttribute("aria-busy"),V.popup.removeAttribute("data-loading"),V.confirmButton.disabled=!1,V.denyButton.disabled=!1,V.cancelButton.disabled=!1}const Dd=P=>{const V=P.popup.getElementsByClassName(P.loader.getAttribute("data-button-to-replace"));V.length?Nn(V[0],"inline-block"):ul()&&hi(P.actions)};function sg(){const P=_n.innerParams.get(this),V=_n.domCache.get(this);return V?lt(V.popup,P.input):null}function Mf(P,V,X){const ce=_n.domCache.get(P);V.forEach(Fe=>{ce[Fe].disabled=X})}function Nd(P,V){const X=qe();if(!(!X||!P))if(P.type==="radio"){const ce=X.querySelectorAll(`[name="${N.radio}"]`);for(let Fe=0;Fe<ce.length;Fe++)ce[Fe].disabled=V}else P.disabled=V}function Uf(){Mf(this,["confirmButton","denyButton","cancelButton"],!1)}function Ff(){Mf(this,["confirmButton","denyButton","cancelButton"],!0)}function Yu(){Nd(this.getInput(),!1)}function Ec(){Nd(this.getInput(),!0)}function va(P){const V=_n.domCache.get(this),X=_n.innerParams.get(this);jt(V.validationMessage,P),V.validationMessage.className=N["validation-message"],X.customClass&&X.customClass.validationMessage&&Tt(V.validationMessage,X.customClass.validationMessage),Nn(V.validationMessage);const ce=this.getInput();ce&&(ce.setAttribute("aria-invalid","true"),ce.setAttribute("aria-describedby",N["validation-message"]),yt(ce),Tt(ce,N.inputerror))}function rg(){const P=_n.domCache.get(this);P.validationMessage&&hi(P.validationMessage);const V=this.getInput();V&&(V.removeAttribute("aria-invalid"),V.removeAttribute("aria-describedby"),Xt(V,N.inputerror))}const Sl={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},ag=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],Bf={allowEnterKey:void 0},_c=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],yl=P=>Object.prototype.hasOwnProperty.call(Sl,P),og=P=>ag.indexOf(P)!==-1,Bs=P=>Bf[P],cg=P=>{yl(P)||ne(`Unknown parameter "${P}"`)},lg=P=>{_c.includes(P)&&ne(`The parameter "${P}" is incompatible with toasts`)},Vf=P=>{const V=Bs(P);V&&be(P,V)},qu=P=>{P.backdrop===!1&&P.allowOutsideClick&&ne('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),P.theme&&!["light","dark","auto","borderless"].includes(P.theme)&&ne(`Invalid theme "${P.theme}". Expected "light", "dark", "auto", or "borderless"`);for(const V in P)cg(V),P.toast&&lg(V),Vf(V)};function $u(P){const V=Ge(),X=qe(),ce=_n.innerParams.get(this);if(!X||$n(X,ce.hideClass.popup)){ne("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");return}const Fe=dg(P),At=Object.assign({},ce,Fe);qu(At),V.dataset.swal2Theme=At.theme,Km(this,At),_n.innerParams.set(this,At),Object.defineProperties(this,{params:{value:Object.assign({},this.params,P),writable:!1,enumerable:!0}})}const dg=P=>{const V={};return Object.keys(P).forEach(X=>{og(X)?V[X]=P[X]:ne(`Invalid parameter to update: ${X}`)}),V};function jf(){const P=_n.domCache.get(this),V=_n.innerParams.get(this);if(!V){zu(this);return}P.popup&&v.swalCloseEventFinishedCallback&&(v.swalCloseEventFinishedCallback(),delete v.swalCloseEventFinishedCallback),typeof V.didDestroy=="function"&&V.didDestroy(),v.eventEmitter.emit("didDestroy"),ug(this)}const ug=P=>{zu(P),delete P.params,delete v.keydownHandler,delete v.keydownTarget,delete v.currentInstance},zu=P=>{P.isAwaitingPromise?(Gf(_n,P),P.isAwaitingPromise=!0):(Gf(lr,P),Gf(_n,P),delete P.isAwaitingPromise,delete P.disableButtons,delete P.enableButtons,delete P.getInput,delete P.disableInput,delete P.enableInput,delete P.hideLoading,delete P.disableLoading,delete P.showValidationMessage,delete P.resetValidationMessage,delete P.close,delete P.closePopup,delete P.closeModal,delete P.closeToast,delete P.rejectPromise,delete P.update,delete P._destroy)},Gf=(P,V)=>{for(const X in P)P[X].delete(V)};var $_=Object.freeze({__proto__:null,_destroy:jf,close:ra,closeModal:ra,closePopup:ra,closeToast:ra,disableButtons:Ff,disableInput:Ec,disableLoading:Do,enableButtons:Uf,enableInput:Yu,getInput:sg,handleAwaitingPromise:Co,hideLoading:Do,rejectPromise:Xm,resetValidationMessage:rg,showValidationMessage:va,update:$u});const Xu=(P,V,X)=>{P.toast?wr(P,V,X):(aa(V),hg(V),fg(P,V,X))},wr=(P,V,X)=>{V.popup.onclick=()=>{P&&(Ld(P)||P.timer||P.input)||X(gl.close)}},Ld=P=>!!(P.showConfirmButton||P.showDenyButton||P.showCancelButton||P.showCloseButton);let xd=!1;const aa=P=>{P.popup.onmousedown=()=>{P.container.onmouseup=function(V){P.container.onmouseup=()=>{},V.target===P.container&&(xd=!0)}}},hg=P=>{P.container.onmousedown=V=>{V.target===P.container&&V.preventDefault(),P.popup.onmouseup=function(X){P.popup.onmouseup=()=>{},(X.target===P.popup||X.target instanceof HTMLElement&&P.popup.contains(X.target))&&(xd=!0)}}},fg=(P,V,X)=>{V.container.onclick=ce=>{if(xd){xd=!1;return}ce.target===V.container&&Se(P.allowOutsideClick)&&X(gl.backdrop)}},Qs=P=>typeof P=="object"&&P.jquery,pg=P=>P instanceof Element||Qs(P),z_=P=>{const V={};return typeof P[0]=="object"&&!pg(P[0])?Object.assign(V,P[0]):["title","html","icon"].forEach((X,ce)=>{const Fe=P[ce];typeof Fe=="string"||pg(Fe)?V[X]=Fe:Fe!==void 0&&ee(`Unexpected type of ${X}! Expected "string" or "Element", got ${typeof Fe}`)}),V};function Tl(){for(var P=arguments.length,V=new Array(P),X=0;X<P;X++)V[X]=arguments[X];return new this(...V)}function Hf(P){class V extends this{_main(ce,Fe){return super._main(ce,Object.assign({},P,Fe))}}return V}const vl=()=>v.timeout&&v.timeout.getTimerLeft(),Ju=()=>{if(v.timeout)return Cr(),v.timeout.stop()},Kf=()=>{if(v.timeout){const P=v.timeout.start();return na(P),P}},Sc=()=>{const P=v.timeout;return P&&(P.running?Ju():Kf())},yc=P=>{if(v.timeout){const V=v.timeout.increase(P);return na(V,!0),V}},Wf=()=>!!(v.timeout&&v.timeout.isRunning());let Yf=!1;const oa={};function Qu(){let P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"data-swal-template";oa[P]=this,Yf||(document.body.addEventListener("click",mg),Yf=!0)}const mg=P=>{for(let V=P.target;V&&V!==document;V=V.parentNode)for(const X in oa){const ce=V.getAttribute(X);if(ce){oa[X].fire({template:ce});return}}};class We{constructor(){this.events={}}_getHandlersByEventName(V){return typeof this.events[V]>"u"&&(this.events[V]=[]),this.events[V]}on(V,X){const ce=this._getHandlersByEventName(V);ce.includes(X)||ce.push(X)}once(V,X){var ce=this;const Fe=function(){ce.removeListener(V,Fe);for(var At=arguments.length,cn=new Array(At),Un=0;Un<At;Un++)cn[Un]=arguments[Un];X.apply(ce,cn)};this.on(V,Fe)}emit(V){for(var X=arguments.length,ce=new Array(X>1?X-1:0),Fe=1;Fe<X;Fe++)ce[Fe-1]=arguments[Fe];this._getHandlersByEventName(V).forEach(At=>{try{At.apply(this,ce)}catch(cn){console.error(cn)}})}removeListener(V,X){const ce=this._getHandlersByEventName(V),Fe=ce.indexOf(X);Fe>-1&&ce.splice(Fe,1)}removeAllListeners(V){this.events[V]!==void 0&&(this.events[V].length=0)}reset(){this.events={}}}v.eventEmitter=new We;var gg=Object.freeze({__proto__:null,argsToParams:z_,bindClickHandler:Qu,clickCancel:j_,clickConfirm:Af,clickDeny:Bu,enableLoading:Io,fire:Tl,getActions:it,getCancelButton:ct,getCloseButton:bt,getConfirmButton:He,getContainer:Ge,getDenyButton:Be,getFocusableElements:Ft,getFooter:Ze,getHtmlContainer:Ke,getIcon:ut,getIconContent:Oe,getImage:Re,getInputLabel:Et,getLoader:St,getPopup:qe,getProgressSteps:se,getTimerLeft:vl,getTimerProgressBar:mt,getTitle:Qe,getValidationMessage:we,increaseTimer:yc,isDeprecatedParameter:Bs,isLoading:Ws,isTimerRunning:Wf,isUpdatableParameter:og,isValidParameter:yl,isVisible:Fu,mixin:Hf,off:(P,V)=>{if(!P){v.eventEmitter.reset();return}V?v.eventEmitter.removeListener(P,V):v.eventEmitter.removeAllListeners(P)},on:(P,V)=>{v.eventEmitter.on(P,V)},once:(P,V)=>{v.eventEmitter.once(P,V)},resumeTimer:Kf,showLoading:Io,stopTimer:Ju,toggleTimer:Sc});class Eg{constructor(V,X){this.callback=V,this.remaining=X,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}increase(V){const X=this.running;return X&&this.stop(),this.remaining+=V,X&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const qf=["swal-title","swal-html","swal-footer"],ca=P=>{const V=typeof P.template=="string"?document.querySelector(P.template):P.template;if(!V)return{};const X=V.content;return th(X),Object.assign(Vr(X),Xa(X),No(X),Zu(X),eh(X),$f(X),Lo(X,qf))},Vr=P=>{const V={};return Array.from(P.querySelectorAll("swal-param")).forEach(ce=>{ba(ce,["name","value"]);const Fe=ce.getAttribute("name"),At=ce.getAttribute("value");!Fe||!At||(typeof Sl[Fe]=="boolean"?V[Fe]=At!=="false":typeof Sl[Fe]=="object"?V[Fe]=JSON.parse(At):V[Fe]=At)}),V},Xa=P=>{const V={};return Array.from(P.querySelectorAll("swal-function-param")).forEach(ce=>{const Fe=ce.getAttribute("name"),At=ce.getAttribute("value");!Fe||!At||(V[Fe]=new Function(`return ${At}`)())}),V},No=P=>{const V={};return Array.from(P.querySelectorAll("swal-button")).forEach(ce=>{ba(ce,["type","color","aria-label"]);const Fe=ce.getAttribute("type");!Fe||!["confirm","cancel","deny"].includes(Fe)||(V[`${Fe}ButtonText`]=ce.innerHTML,V[`show${Q(Fe)}Button`]=!0,ce.hasAttribute("color")&&(V[`${Fe}ButtonColor`]=ce.getAttribute("color")),ce.hasAttribute("aria-label")&&(V[`${Fe}ButtonAriaLabel`]=ce.getAttribute("aria-label")))}),V},Zu=P=>{const V={},X=P.querySelector("swal-image");return X&&(ba(X,["src","width","height","alt"]),X.hasAttribute("src")&&(V.imageUrl=X.getAttribute("src")||void 0),X.hasAttribute("width")&&(V.imageWidth=X.getAttribute("width")||void 0),X.hasAttribute("height")&&(V.imageHeight=X.getAttribute("height")||void 0),X.hasAttribute("alt")&&(V.imageAlt=X.getAttribute("alt")||void 0)),V},eh=P=>{const V={},X=P.querySelector("swal-icon");return X&&(ba(X,["type","color"]),X.hasAttribute("type")&&(V.icon=X.getAttribute("type")),X.hasAttribute("color")&&(V.iconColor=X.getAttribute("color")),V.iconHtml=X.innerHTML),V},$f=P=>{const V={},X=P.querySelector("swal-input");X&&(ba(X,["type","label","placeholder","value"]),V.input=X.getAttribute("type")||"text",X.hasAttribute("label")&&(V.inputLabel=X.getAttribute("label")),X.hasAttribute("placeholder")&&(V.inputPlaceholder=X.getAttribute("placeholder")),X.hasAttribute("value")&&(V.inputValue=X.getAttribute("value")));const ce=Array.from(P.querySelectorAll("swal-input-option"));return ce.length&&(V.inputOptions={},ce.forEach(Fe=>{ba(Fe,["value"]);const At=Fe.getAttribute("value");if(!At)return;const cn=Fe.innerHTML;V.inputOptions[At]=cn})),V},Lo=(P,V)=>{const X={};for(const ce in V){const Fe=V[ce],At=P.querySelector(Fe);At&&(ba(At,[]),X[Fe.replace(/^swal-/,"")]=At.innerHTML.trim())}return X},th=P=>{const V=qf.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(P.children).forEach(X=>{const ce=X.tagName.toLowerCase();V.includes(ce)||ne(`Unrecognized element <${ce}>`)})},ba=(P,V)=>{Array.from(P.attributes).forEach(X=>{V.indexOf(X.name)===-1&&ne([`Unrecognized attribute "${X.name}" on <${P.tagName.toLowerCase()}>.`,`${V.length?`Allowed attributes are: ${V.join(", ")}`:"To set the value, use HTML within the element."}`])})},xo=10,jr=P=>{const V=Ge(),X=qe();typeof P.willOpen=="function"&&P.willOpen(X),v.eventEmitter.emit("willOpen",X);const Fe=window.getComputedStyle(document.body).overflowY;nh(V,X,P),setTimeout(()=>{Ra(V,X)},xo),ei()&&(bl(V,P.scrollbarPadding,Fe),Ao()),!ri()&&!v.previousActiveElement&&(v.previousActiveElement=document.activeElement),typeof P.didOpen=="function"&&setTimeout(()=>P.didOpen(X)),v.eventEmitter.emit("didOpen",X),Xt(V,N["no-transition"])},Zs=P=>{const V=qe();if(P.target!==V)return;const X=Ge();V.removeEventListener("animationend",Zs),V.removeEventListener("transitionend",Zs),X.style.overflowY="auto"},Ra=(P,V)=>{To(V)?(P.style.overflowY="hidden",V.addEventListener("animationend",Zs),V.addEventListener("transitionend",Zs)):P.style.overflowY="auto"},bl=(P,V,X)=>{qm(),V&&X!=="hidden"&&G_(X),setTimeout(()=>{P.scrollTop=0})},nh=(P,V,X)=>{Tt(P,X.showClass.backdrop),X.animation?(V.style.setProperty("opacity","0","important"),Nn(V,"grid"),setTimeout(()=>{Tt(V,X.showClass.popup),V.style.removeProperty("opacity")},xo)):Nn(V,"grid"),Tt([document.documentElement,document.body],N.shown),X.heightAuto&&X.backdrop&&!X.toast&&Tt([document.documentElement,document.body],N["height-auto"])};var Pd={email:(P,V)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(P)?Promise.resolve():Promise.resolve(V||"Invalid email address"),url:(P,V)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(P)?Promise.resolve():Promise.resolve(V||"Invalid URL")};function Or(P){P.inputValidator||(P.input==="email"&&(P.inputValidator=Pd.email),P.input==="url"&&(P.inputValidator=Pd.url))}function Gr(P){(!P.target||typeof P.target=="string"&&!document.querySelector(P.target)||typeof P.target!="string"&&!P.target.appendChild)&&(ne('Target parameter is not valid, defaulting to "body"'),P.target="body")}function Tc(P){Or(P),P.showLoaderOnConfirm&&!P.preConfirm&&ne(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),Gr(P),typeof P.title=="string"&&(P.title=P.title.split(`
`).join("<br />")),B_(P)}let Ts;var hr=new WeakMap;class mi{constructor(){if(p(this,hr,void 0),typeof window>"u")return;Ts=this;for(var V=arguments.length,X=new Array(V),ce=0;ce<V;ce++)X[ce]=arguments[ce];const Fe=Object.freeze(this.constructor.argsToParams(X));this.params=Fe,this.isAwaitingPromise=!1,g(hr,this,this._main(Ts.params))}_main(V){let X=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(qu(Object.assign({},X,V)),v.currentInstance){const At=lr.swalPromiseResolve.get(v.currentInstance),{isAwaitingPromise:cn}=v.currentInstance;v.currentInstance._destroy(),cn||At({isDismissed:!0}),ei()&&ju()}v.currentInstance=Ts;const ce=ih(V,X);Tc(ce),Object.freeze(ce),v.timeout&&(v.timeout.stop(),delete v.timeout),clearTimeout(v.restoreFocusTimeout);const Fe=Xf(Ts);return Km(Ts,ce),_n.innerParams.set(Ts,ce),zf(Ts,Fe,ce)}then(V){return d(hr,this).then(V)}finally(V){return d(hr,this).finally(V)}}const zf=(P,V,X)=>new Promise((ce,Fe)=>{const At=cn=>{P.close({isDismissed:!0,dismiss:cn})};lr.swalPromiseResolve.set(P,ce),lr.swalPromiseReject.set(P,Fe),V.confirmButton.onclick=()=>{q_(P)},V.denyButton.onclick=()=>{_l(P)},V.cancelButton.onclick=()=>{eg(P,At)},V.closeButton.onclick=()=>{At(gl.close)},Xu(X,V,At),Cf(v,X,At),Lf(P,X),jr(X),Vs(v,X,At),ss(V,X),setTimeout(()=>{V.container.scrollTop=0})}),ih=(P,V)=>{const X=ca(P),ce=Object.assign({},Sl,V,X,P);return ce.showClass=Object.assign({},Sl.showClass,ce.showClass),ce.hideClass=Object.assign({},Sl.hideClass,ce.hideClass),ce.animation===!1&&(ce.showClass={backdrop:"swal2-noanimation"},ce.hideClass={}),ce},Xf=P=>{const V={popup:qe(),container:Ge(),actions:it(),confirmButton:He(),denyButton:Be(),cancelButton:ct(),loader:St(),closeButton:bt(),validationMessage:we(),progressSteps:se()};return _n.domCache.set(P,V),V},Vs=(P,V,X)=>{const ce=mt();hi(ce),V.timer&&(P.timeout=new Eg(()=>{X("timer"),delete P.timeout},V.timer),V.timerProgressBar&&(Nn(ce),yi(ce,V,"timerProgressBar"),setTimeout(()=>{P.timeout&&P.timeout.running&&na(V.timer)})))},ss=(P,V)=>{if(!V.toast){if(!Se(V.allowEnterKey)){be("allowEnterKey"),Aa();return}Yn(P)||la(P,V)||Cd(-1,1)}},Yn=P=>{const V=Array.from(P.popup.querySelectorAll("[autofocus]"));for(const X of V)if(X instanceof HTMLElement&&Ys(X))return X.focus(),!0;return!1},la=(P,V)=>V.focusDeny&&Ys(P.denyButton)?(P.denyButton.focus(),!0):V.focusCancel&&Ys(P.cancelButton)?(P.cancelButton.focus(),!0):V.focusConfirm&&Ys(P.confirmButton)?(P.confirmButton.focus(),!0):!1,Aa=()=>{document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){const P=new Date,V=localStorage.getItem("swal-initiation");V?(P.getTime()-Date.parse(V))/(1e3*60*60*24)>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const X=document.createElement("audio");X.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",X.loop=!0,document.body.appendChild(X),setTimeout(()=>{X.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${P}`)}mi.prototype.disableButtons=Ff,mi.prototype.enableButtons=Uf,mi.prototype.getInput=sg,mi.prototype.disableInput=Ec,mi.prototype.enableInput=Yu,mi.prototype.hideLoading=Do,mi.prototype.disableLoading=Do,mi.prototype.showValidationMessage=va,mi.prototype.resetValidationMessage=rg,mi.prototype.close=ra,mi.prototype.closePopup=ra,mi.prototype.closeModal=ra,mi.prototype.closeToast=ra,mi.prototype.rejectPromise=Xm,mi.prototype.update=$u,mi.prototype._destroy=jf,Object.assign(mi,gg),Object.keys($_).forEach(P=>{mi[P]=function(){return Ts&&Ts[P]?Ts[P](...arguments):null}}),mi.DismissReason=gl,mi.version="11.17.2";const Rl=mi;return Rl.default=Rl,Rl}),typeof rf<"u"&&rf.Sweetalert2&&(rf.swal=rf.sweetAlert=rf.Swal=rf.SweetAlert=rf.Sweetalert2)}(WA)),WA.exports}var eZ=ZQ();const ea=tL(eZ);function tZ(){const h=Pm(),[i,r]=Sd.useState({username:"",password:""}),{superadminlogin:o}=TT(),d=async()=>{try{const p=await o(i);console.log(p.message),p.message==" Login successful!"?(localStorage.setItem("token",p.token),h("/superadmindashboard")):ea.fire({icon:"error",title:"Sorry",text:p.data.message})}catch(p){console.log(p),ea.fire({icon:"error",title:"Sorry",text:"Invalid Credentials !"})}};return M.jsxs("div",{className:"flex flex-col md:flex-row h-screen bg-gradient-to-r from-blue-500 to-blue-700",children:[M.jsxs("div",{className:"w-full md:w-1/2 flex flex-col justify-center items-center bg-white text-blue-600 p-10 shadow-xl rounded-lg",children:[M.jsx("img",{src:aT,alt:"Logo",className:"w-24 h-24 mb-4 animate-pulse"}),M.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Welcome Back"}),M.jsx("p",{className:"mb-6 text-lg text-gray-600",children:"Login to your Super Admin account"}),M.jsxs("div",{className:"w-full max-w-sm bg-gray-50 p-6 rounded-lg shadow-2xl transform transition hover:scale-105",children:[M.jsxs("div",{className:"mb-4",children:[M.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"username"}),M.jsx("input",{type:"email",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 shadow-sm",placeholder:"Enter your username",onChange:p=>r({...i,username:p.target.value})})]}),M.jsxs("div",{className:"mb-4",children:[M.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Password"}),M.jsx("input",{type:"password",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 shadow-sm",placeholder:"Enter your password",onChange:p=>r({...i,password:p.target.value})})]}),M.jsx("button",{onClick:d,className:"w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition transform hover:scale-105 shadow-md hover:shadow-lg",children:"Login"})]})]}),M.jsx("div",{className:"hidden md:flex w-1/2 items-center justify-center p-10 animate-slide-in",children:M.jsx("img",{src:pG,alt:"Illustration",className:"max-w-full h-auto drop-shadow-xl rounded-lg"})})]})}/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nZ=h=>h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),HG=(...h)=>h.filter((i,r,o)=>!!i&&i.trim()!==""&&o.indexOf(i)===r).join(" ").trim();/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var iZ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sZ=fe.forwardRef(({color:h="currentColor",size:i=24,strokeWidth:r=2,absoluteStrokeWidth:o,className:d="",children:p,iconNode:g,...y},v)=>fe.createElement("svg",{ref:v,...iZ,width:i,height:i,stroke:h,strokeWidth:o?Number(r)*24/Number(i):r,className:HG("lucide",d),...y},[...g.map(([T,C])=>fe.createElement(T,C)),...Array.isArray(p)?p:[p]]));/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const km=(h,i)=>{const r=fe.forwardRef(({className:o,...d},p)=>fe.createElement(sZ,{ref:p,iconNode:i,className:HG(`lucide-${nZ(h)}`,o),...d}));return r.displayName=`${h}`,r};/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rZ=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],md=km("EyeOff",rZ);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aZ=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ol=km("Eye",aZ);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oZ=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],KG=km("LockOpen",oZ);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cZ=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],WG=km("Lock",cZ);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lZ=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],vT=km("Search",lZ);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dZ=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],YG=km("SquarePen",dZ);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uZ=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],O_=km("Trash2",uZ);function pL({setUserAdded:h}){const i=Pm(),[r,o]=fe.useState(!1),{createNewAdmin:d,saveprice:p,getprice:g}=TT(),[y,v]=fe.useState(!1),[T,C]=fe.useState(!1),[I,L]=fe.useState(!1),[N,x]=fe.useState();fe.useEffect(()=>{(async()=>{try{const _e=await g();console.log("Full Response:",_e),_e!=null&&_e.Price&&Array.isArray(_e.Price)&&_e.Price.length>0?(console.log("Price:",_e.Price[0].price),x(_e.Price[0].price)):console.log("No price data found")}catch(_e){console.log(" Error fetching price:",_e)}})()},[y,T]);const[K,H]=fe.useState({name:"",adminlimits:"",password:"",confirmPassword:"",app_id:"",token_id:"",channel_name:"",phoneNumber:"",username:"",customerId:"",customerSecret:""}),[Q,ne]=fe.useState(!1),[ee,pe]=fe.useState(!1),de=Te=>{H({...K,[Te.target.name]:Te.target.value})},be=async Te=>{if(Te.preventDefault(),console.log(K),K.password!==K.confirmPassword){ea.fire({icon:"error",title:"Sorry",text:"Password Not Match!"});return}try{(await d(K)).message===" Admin created successfully!"?(ea.fire({title:"Successfull !",text:"Admin created successfully",icon:"success"}),v(!1),h(!0)):ea.fire({icon:"error",title:"Sorry",text:"Something went wrong!"})}catch(_e){console.log(_e),ea.fire({icon:"error",title:"Sorry",text:_e.message})}},Se=async()=>{const Te={price:N};try{const _e=await p(Te);console.log(_e),C(!1)}catch(_e){console.log(_e)}};return M.jsxs(M.Fragment,{children:[M.jsxs("nav",{className:"sticky top-0 px-4 py-4 flex justify-between shadow-md items-center bg-white z-50",children:[M.jsx("a",{className:"text-3xl font-bold leading-none",href:"#",children:M.jsx("img",{src:aT,alt:"",width:70})}),M.jsx("div",{className:"lg:hidden",children:M.jsx("button",{onClick:()=>o(!r),className:"navbar-burger flex items-center text-blue-600 p-3",children:M.jsxs("svg",{className:"block h-4 w-4 fill-current",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:[M.jsx("title",{children:"Mobile menu"}),M.jsx("path",{d:"M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"})]})})}),M.jsxs("ul",{className:"hidden absolute top-1/2 left-1/2 transform -translate-y-1/2 -translate-x-1/2 lg:flex lg:mx-auto  lg:items-center lg:w-auto lg:space-x-6",children:[M.jsx("li",{children:M.jsx(al,{to:"/superadmindashboard",className:({isActive:Te})=>Te?"text-sm text-blue-600 font-bold ":" text-sm text-gray-400 hover:text-gray-500",children:"Home"})}),M.jsx("li",{className:"text-gray-300",children:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",className:"w-4 h-4 current-fill",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),M.jsx("li",{onClick:()=>v(!0),children:M.jsx("a",{className:y?"text-sm text-blue-600 font-bold cursor-pointer":"text-sm text-gray-400 hover:text-gray-500 cursor-pointer",children:"Add Admin"})}),M.jsx("li",{className:"text-gray-300",children:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",className:"w-4 h-4 current-fill",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),M.jsx("li",{onClick:()=>C(!0),children:M.jsx("a",{className:y?"text-sm text-blue-600 font-bold cursor-pointer":"text-sm text-gray-400 hover:text-gray-500 cursor-pointer",children:"Add Price"})}),M.jsx("li",{className:"text-gray-300",children:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",className:"w-4 h-4 current-fill",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),M.jsx("li",{children:M.jsx(al,{to:"/callhistory",className:({isActive:Te})=>Te?"text-sm text-blue-600 font-bold ":" text-sm text-gray-400 hover:text-gray-500",children:"Call History"})})]}),M.jsx("a",{className:"hidden lg:inline-block py-2 px-6 bg-blue-500 hover:bg-blue-600 text-sm text-white font-bold rounded-xl transition duration-200",onClick:()=>L(!0),children:"Log out"})]}),M.jsxs("div",{className:`navbar-menu relative z-50 ${r?"":"hidden"}`,children:[M.jsx("div",{className:"navbar-backdrop fixed inset-0 bg-gray-800 opacity-25",onClick:()=>o(!1)}),M.jsxs("nav",{className:"fixed top-0 left-0 bottom-0 flex flex-col w-5/6 max-w-sm py-6 px-6 bg-white border-r overflow-y-auto",children:[M.jsxs("div",{className:"flex items-center mb-8",children:[M.jsx("a",{className:"mr-auto text-3xl font-bold leading-none",href:"#",children:M.jsx("img",{src:aT,alt:"",width:100})}),M.jsx("button",{className:"navbar-close",onClick:()=>o(!1),children:M.jsx("svg",{className:"h-6 w-6 text-gray-400 cursor-pointer hover:text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),M.jsx("div",{children:M.jsxs("ul",{children:[M.jsx("li",{className:"mb-1",children:M.jsx(al,{to:"/superadmindashboard",className:({isActive:Te})=>Te?"text-sm text-blue-600 font-bold ":" text-sm text-gray-400 hover:text-gray-500",children:"Home"})}),M.jsx("li",{className:"mb-1",onClick:()=>v(!0),children:M.jsx("a",{className:"block py-4 text-sm font-semibold text-gray-400 hover:bg-blue-50 hover:text-blue-600 rounded",href:"#",children:"Add Admin"})}),M.jsx("li",{onClick:()=>C(!0),children:M.jsx("a",{className:y?"text-sm text-blue-600 font-bold cursor-pointer":"text-sm text-gray-400 hover:text-gray-500 cursor-pointer",children:"Add Price"})}),M.jsx("li",{className:"text-gray-300",children:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",className:"w-4 h-4 current-fill",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),M.jsx("li",{className:"mb-1",children:M.jsx(al,{to:"/callhistory",className:({isActive:Te})=>Te?"text-sm text-blue-600 font-bold ":" text-sm text-gray-400 hover:text-gray-500",children:"Call History"})})]})}),M.jsxs("div",{className:"mt-auto",children:[M.jsx("div",{className:"pt-6",onClick:()=>L(!0),children:M.jsx("a",{className:"block px-4 py-3 mb-2 leading-loose text-xs text-center text-white font-semibold bg-blue-600 hover:bg-blue-700  rounded-xl",children:"Log Out"})}),M.jsx("p",{className:"my-4 text-xs text-center text-gray-400"})]})]})]}),y&&M.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/30 backdrop-blur-sm z-50 animate-fadeIn",children:M.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-2xl w-[500px] max-w-[95%] border border-gray-100 animate-scaleIn",children:[M.jsxs("div",{className:"flex justify-between items-center pb-4 mb-4 border-b border-gray-200",children:[M.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Add New Admin"}),M.jsx("button",{onClick:()=>v(!1),className:"text-gray-400 hover:text-gray-600 transition-colors p-1 cursor-pointer rounded-full hover:bg-gray-100",children:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),M.jsxs("form",{className:"space-y-4",onSubmit:be,children:[M.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),M.jsx("input",{required:!0,type:"text",name:"name",placeholder:"Enter full name",onChange:de,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Limit"}),M.jsx("input",{type:"number",required:!0,name:"adminlimits",placeholder:"Set admin limit",onChange:de,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),M.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[M.jsxs("div",{className:"relative",children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),M.jsx("input",{required:!0,type:Q?"text":"password",name:"password",placeholder:"Create password",onChange:de,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),M.jsx("button",{type:"button",onClick:()=>ne(!Q),className:"cursor-pointer absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:Q?M.jsx(md,{className:"h-5 w-5"}):M.jsx(ol,{className:"h-5 w-5"})})]}),M.jsxs("div",{className:"relative",children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),M.jsx("input",{required:!0,type:ee?"text":"password",name:"confirmPassword",placeholder:"Confirm your password",onChange:de,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),M.jsx("button",{type:"button",onClick:()=>pe(!ee),className:"cursor-pointer absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:ee?M.jsx(md,{className:"h-5 w-5"}):M.jsx(ol,{className:"h-5 w-5"})})]})]}),M.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"App ID"}),M.jsx("input",{required:!0,type:"text",name:"app_id",placeholder:"Enter app ID",onChange:de,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"App Certificate"}),M.jsx("input",{required:!0,type:"text",name:"token_id",placeholder:"Enter app certificate",onChange:de,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),M.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Channel ID"}),M.jsx("input",{required:!0,type:"text",name:"channel_name",placeholder:"Channel ID",onChange:de,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),M.jsx("input",{type:"text",required:!0,pattern:"[0-9]*",inputMode:"numeric",name:"phoneNumber",placeholder:"Phone number",onChange:de,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),M.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Id"}),M.jsx("input",{required:!0,type:"text",name:"customerId",placeholder:"Customer ID",onChange:de,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Secret"}),M.jsx("input",{required:!0,type:"text",name:"customerSecret",placeholder:"Customer Secret",onChange:de,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),M.jsx("input",{required:!0,type:"text",name:"username",placeholder:"Username",onChange:de,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsx("button",{type:"submit",className:"cursor-pointer w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-medium hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg active:scale-95 transform mt-4",children:"Add Admin"})]})]})}),I&&M.jsx("div",{id:"logout-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:M.jsx("div",{className:"relative p-4 w-full max-w-md",children:M.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[M.jsx("button",{type:"button",className:"cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>L(!1),children:M.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),M.jsxs("div",{className:"p-6 text-center",children:[M.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Do you want to logout?"}),M.jsxs("div",{className:"flex justify-center space-x-4",children:[M.jsx("button",{className:"cursor-pointer px-6 py-2 text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",onClick:()=>i("/"),children:"Yes"}),M.jsx("button",{onClick:()=>L(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})}),T&&M.jsx("div",{id:"logout-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:M.jsx("div",{className:"relative p-4 w-full max-w-md",children:M.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[M.jsx("button",{type:"button",className:"cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>C(!1),children:M.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),M.jsxs("div",{className:"p-6 text-center",children:[M.jsxs("div",{children:[M.jsx("label",{className:"text-left block text-sm font-medium text-gray-700 mb-1",children:"Price"}),M.jsx("input",{required:!0,type:"text",name:"name",value:N,placeholder:"Enter Price",onChange:Te=>x(Te.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsx("br",{}),M.jsxs("div",{className:"flex justify-center space-x-4",children:[M.jsx("button",{className:"cursor-pointer px-6 py-2 text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",onClick:()=>Se(),children:"Save"}),M.jsx("button",{onClick:()=>C(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})})]})}function hZ(){const{listAdmin:h,deleteAdmin:i,getAdminById:r,updateAdmin:o}=TT(),[d,p]=fe.useState(!1),[g,y]=fe.useState(""),[v,T]=fe.useState(1),C=10,[I,L]=fe.useState(0),[N,x]=fe.useState(!1),[K,H]=fe.useState(!1),[Q,ne]=fe.useState(!1),[ee,pe]=fe.useState(),[de,be]=fe.useState([]),[Se,Te]=fe.useState(!1);fe.useEffect(()=>{_e()},[v]);const _e=async()=>{try{const mt=C,bt=(v-1)*C,gn=await h(mt,bt);be(gn),console.log("response",gn),gn.totalCount&&L(gn.totalCount),console.log(gn)}catch(mt){console.log(mt)}},he=de==null?void 0:de.filter(mt=>{var bt,gn,Ft;return((bt=mt.username)==null?void 0:bt.toLowerCase().includes(g.toLowerCase()))||((gn=mt.email)==null?void 0:gn.toLowerCase().includes(g.toLowerCase()))||((Ft=mt.name)==null?void 0:Ft.toLowerCase().includes(g.toLowerCase()))}),Ge=Math.ceil(I?I/C:he.length/C),st=v*C,It=st-C,qe=he.slice(It,st),[ut,Oe]=fe.useState({id:null,email:"",adminlimits:"",name:"",confirmPassword:"",app_id:"",token_id:"",channel_name:"",username:"",customerId:"",customerSecret:""}),Qe=async mt=>{const bt=await r(mt.id);console.log(bt,"fullUserDetails"),Oe({id:bt.id,email:bt.email||"",adminlimits:bt.adminlimits||"",name:bt.name,password:bt.password||"",confirmPassword:bt.password||"",app_id:bt.app_id||"",token_id:bt.token_id||"",channel_name:bt.channel_name||"",username:bt.username||"",customerId:bt.customerId||"",customerSecret:bt.customerSecret||""}),p(!0)},Ke=mt=>{Oe({...ut,[mt.target.name]:mt.target.value})},[Re,se]=fe.useState(!1),[we,He]=fe.useState(null),ct=async mt=>{mt.preventDefault();try{const bt={...ut};console.log(bt),bt.password||(delete bt.password,delete bt.confirmPassword),delete bt.confirmPassword,await o(bt.id,bt),_e(),p(!1)}catch(bt){console.error("Update failed",bt)}},Be=mt=>{He(mt),se(!0)},Et=async mt=>{console.log(mt),await i(mt),_e()},St=()=>{v>1&&T(v-1)},it=()=>{v<Ge&&T(v+1)},Ze=async(mt,bt)=>{console.log(mt,ee.lcokstatus);try{const gn={lcokstatus:ee!=null&&ee.lcokstatus?0:1};console.log("updateData",gn),await o(mt,gn),_e(),h(C,(v-1)*C)}catch(gn){console.error("Error updating lock status:",gn)}};return console.log("currentRecords",qe),fe.useEffect(()=>{console.log("Dashboard - useradded changed:",Se),_e()},[Se]),M.jsxs(M.Fragment,{children:[M.jsx(pL,{setUserAdded:Te,modalOpen:d}),M.jsxs("div",{className:"container mx-auto p-6 w-4/5",children:[M.jsx("div",{className:"flex items-center justify-between mb-4",children:M.jsxs("div",{className:"relative w-1/3",children:[M.jsx("input",{type:"text",placeholder:"Search...",className:"w-full p-2 pl-10 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200",value:g,onChange:mt=>y(mt.target.value)}),M.jsx(vT,{className:"absolute left-3 top-2.5 text-gray-400",size:20})]})}),M.jsx("div",{className:"overflow-x-auto shadow-lg rounded-lg",children:M.jsx("div",{className:"min-w-full inline-block align-middle",children:M.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:M.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[M.jsx("thead",{className:"bg-blue-600 text-white",children:M.jsxs("tr",{children:[M.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Name"}),M.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Username"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Admin Limits"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Lock/Unlock"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Update"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Delete"})]})}),M.jsx("tbody",{className:"divide-y divide-gray-300 bg-white",children:qe.map((mt,bt)=>M.jsxs("tr",{className:"hover:bg-gray-100 transition",children:[M.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800",children:mt.name}),M.jsx("td",{className:"px-6 py-4 text-sm text-gray-800",children:mt.username}),M.jsx("td",{className:"px-6 py-4 text-center text-sm text-gray-800",children:mt.adminlimits}),M.jsx("td",{className:"px-6 py-4 text-center",children:M.jsx("button",{onClick:()=>{pe(mt),ne(!0)},className:"cursor-pointer text-gray-600 hover:text-gray-800 transition",children:mt.lcokstatus?M.jsx(KG,{size:20}):M.jsx(WG,{size:20})})}),M.jsx("td",{className:"cursor-pointer px-6 py-4 text-center",children:M.jsx("button",{onClick:()=>Qe(mt),className:"cursor-pointer text-yellow-500 hover:text-yellow-700 transition",children:M.jsx(YG,{size:20})})}),M.jsx("td",{className:"cursor-pointer px-6 py-4 text-center",children:M.jsx("button",{onClick:()=>Be(mt),className:"cursor-pointer text-red-500 hover:text-red-700 transition",children:M.jsx(O_,{size:20})})})]},bt))})]})})})}),M.jsxs("div",{className:"flex justify-between mt-4",children:[M.jsx("button",{disabled:v===1,onClick:St,className:"px-4 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-200 transition disabled:opacity-50",children:"Previous"}),M.jsxs("span",{className:"text-gray-700",children:["Page ",v," of ",Ge||1]}),M.jsx("button",{disabled:v===Ge||Ge===0,onClick:it,className:"px-4 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-200 transition disabled:opacity-50",children:"Next"})]})]}),d&&M.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/30 backdrop-blur-sm z-50 animate-fadeIn",children:M.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-2xl w-[500px] max-w-[95%] border border-gray-100 animate-scaleIn",children:[M.jsxs("div",{className:"flex justify-between items-center pb-4 mb-4 border-b border-gray-200",children:[M.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Update Admin"}),M.jsx("button",{onClick:()=>p(!1),className:"cursor-pointer text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100",children:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),M.jsxs("form",{onSubmit:ct,className:"space-y-4",children:[M.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),M.jsx("input",{type:"text",name:"username",value:ut.username,placeholder:"Username",onChange:Ke,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"App ID"}),M.jsx("input",{type:"text",name:"app_id",value:ut.app_id,placeholder:"Enter app ID",onChange:Ke,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"App Certificate"}),M.jsx("input",{type:"text",name:"token_id",value:ut.token_id,placeholder:"Enter app certificate",onChange:Ke,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Limit"}),M.jsx("input",{type:"number",name:"adminlimits",value:ut.adminlimits,placeholder:"Set admin limit",onChange:Ke,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Channel Name"}),M.jsx("input",{type:"text",name:"channel_name",value:ut.channel_name,placeholder:"Channel Name",onChange:Ke,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{className:"relative",children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),M.jsx("input",{name:"name",value:ut.name,placeholder:"Enter Name",onChange:Ke,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Id"}),M.jsx("input",{required:!0,type:"text",value:ut.customerId,name:"customerId",placeholder:"Custome ID",onChange:Ke,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Secret"}),M.jsx("input",{required:!0,type:"text",value:ut.customerSecret,name:"customerSecret",placeholder:"Customer Secret",onChange:Ke,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{className:"relative",children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),M.jsx("input",{type:N?"text":"password",value:ut.password,name:"password",placeholder:"Create password",onChange:Ke,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),M.jsx("button",{type:"button",onClick:()=>x(!N),className:"absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:N?M.jsx(md,{className:"h-5 w-5"}):M.jsx(ol,{className:"h-5 w-5"})})]}),M.jsxs("div",{className:"relative",children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),M.jsx("input",{type:K?"text":"password",name:"confirmPassword",value:ut.confirmPassword!==void 0?ut.confirmPassword:ut.password,placeholder:"Confirm password",onChange:Ke,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),M.jsx("button",{type:"button",onClick:()=>H(!K),className:"absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:K?M.jsx(md,{className:"h-5 w-5"}):M.jsx(ol,{className:"h-5 w-5"})})]}),M.jsx("div",{className:"grid grid-cols-1 gap-4"})]}),M.jsx("button",{type:"submit",className:"cursor-pointer w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600",children:"Update Admin"})]})]})}),Re&&M.jsx("div",{id:"popup-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:M.jsx("div",{className:"relative p-4 w-full max-w-md",children:M.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[M.jsx("button",{type:"button",className:" cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>se(!1),children:M.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),M.jsxs("div",{className:"cursor-pointer p-6 text-center",children:[M.jsx("svg",{className:"cursor-pointer mx-auto mb-4 text-red-600 w-14 h-14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),M.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Confirm Permanent Deletion"}),M.jsxs("p",{className:"mb-6 text-gray-600",children:["This will permanently delete the admin"," ",M.jsx("span",{className:"font-semibold",children:we==null?void 0:we.username})," ","and cannot be recovered. Are you sure you want to continue?"]}),M.jsxs("div",{className:"flex justify-center space-x-4",children:[M.jsx("button",{className:"cursor-pointer px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",onClick:()=>{Et(we.id),se(!1),h(C,(v-1)*C)},children:"Delete Permanently"}),M.jsx("button",{onClick:()=>se(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})}),Q&&M.jsx("div",{id:"lock-unlock-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:M.jsx("div",{className:"relative p-4 w-full max-w-md",children:M.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[M.jsx("button",{type:"button",className:"cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>ne(!1),children:M.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),M.jsxs("div",{className:"p-6 text-center",children:[M.jsx("svg",{className:` mx-auto mb-4 ${ee!=null&&ee.lcokstatus?"text-red-600":"text-green-600"} w-14 h-14`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:ee!=null&&ee.lcokstatus?"M6 18L18 6M6 6l12 12":"M5 12h14M12 5v14M9 9l6 6M9 15l6-6"})}),M.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:ee!=null&&ee.lcokstatus?"Lock Admin Access":"Unlock Admin Access"}),M.jsxs("p",{className:"mb-6 text-gray-600",children:["Are you sure you want to"," ",ee!=null&&ee.lcokstatus?"lock":"unlock"," the User"," ",M.jsx("span",{className:"font-semibold",children:!(ee!=null&&ee.lcokstatus)}),"?"]}),M.jsxs("div",{className:"flex justify-center space-x-4",children:[M.jsx("button",{className:`cursor-pointer px-6 py-2 text-white rounded-md transition-colors ${ee!=null&&ee.lcokstatus?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"}`,onClick:()=>{Ze(ee.id,!ee.locked),ne(!1),h(C,(v-1)*C)},children:ee!=null&&ee.lcokstatus?"Lock":"Unlock"}),M.jsx("button",{onClick:()=>ne(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})})]})}function P3(){return M.jsx(M.Fragment,{children:M.jsx(hZ,{})})}function fZ(){const[h,i]=fe.useState(""),[r,o]=fe.useState(1),d=8,[p,g]=fe.useState([{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"},{Date:"20 March 2025",Cost:"45",Time:"20 min"}]),y=p.filter(L=>L.Date.toLowerCase().includes(h.toLowerCase())||L.Cost.toLowerCase().includes(h.toLowerCase())||L.Time.toLowerCase().includes(h.toLowerCase())),v=Math.ceil(y.length/d),T=r*d,C=T-d,I=y.slice(C,T);return M.jsxs(M.Fragment,{children:[M.jsx(pL,{}),M.jsxs("div",{className:"container mx-auto p-6 w-4/5",children:[M.jsxs("div",{className:"flex items-center justify-between mb-4",children:[M.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4 border-b pb-2",children:"Nayan Karemore"}),M.jsxs("div",{className:"relative w-1/3",children:[M.jsx("input",{type:"text",placeholder:"Search...",className:"w-full p-2 pl-10 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200",value:h,onChange:L=>i(L.target.value)}),M.jsx(vT,{className:"absolute left-3 top-2.5 text-gray-400",size:20})]})]}),M.jsx("div",{className:"overflow-x-auto shadow-lg rounded-lg",children:M.jsx("div",{className:"min-w-full inline-block align-middle",children:M.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:M.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[M.jsx("thead",{className:"bg-blue-600 text-white",children:M.jsxs("tr",{children:[M.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Date"}),M.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Time"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Cost"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Delete"})]})}),M.jsx("tbody",{className:"divide-y divide-gray-300 bg-white",children:I.map((L,N)=>M.jsxs("tr",{className:"hover:bg-gray-100 transition",children:[M.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800",children:L.Date}),M.jsx("td",{className:"px-6 py-4 text-sm text-gray-800 ",children:L.Time}),M.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800 text-center",children:L.Cost}),M.jsx("td",{className:"px-6 py-4 text-center",children:M.jsx("button",{className:"text-red-500 hover:text-red-700 transition",children:M.jsx(O_,{size:20})})})]},N))})]})})})}),M.jsxs("div",{className:"flex justify-between mt-4",children:[M.jsx("button",{disabled:r===1,onClick:()=>o(r-1),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-200 transition disabled:opacity-50",children:"Previous"}),M.jsxs("span",{className:"text-gray-700",children:["Page ",r," of ",v]}),M.jsx("button",{disabled:r===v,onClick:()=>o(r+1),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-200 transition disabled:opacity-50",children:"Next"})]})]})]})}function pZ(){const{adminhistory:h,deleteadminhistory:i,deleteAllRecordings:r,adminDropdown:o}=TT(),[d,p]=fe.useState(""),[g,y]=fe.useState(1),[v,T]=fe.useState(!1),[C,I]=fe.useState(),[L,N]=fe.useState(),x=8,[K,H]=fe.useState(""),[Q,ne]=fe.useState(""),[ee,pe]=fe.useState([]),[de,be]=fe.useState(!1),[Se,Te]=fe.useState([]),[_e,he]=fe.useState([]),[Ge,st]=fe.useState([]);fe.useEffect(()=>{o().then(Ze=>{st(Ze)})},[]),console.log("adminValues",L);const It=it=>{const Ze=new Map;return it.forEach(mt=>{Ze.has(mt.name)||Ze.set(mt.name,{name:mt.name,totalTime:0,totalCost:0});const bt=Ze.get(mt.name);let gn=0;const Ft=mt.calltime.match(/min=(\d+),\s*sec=(\d+)/);if(Ft){const ei=parseInt(Ft[1],10),ri=parseInt(Ft[2],10);gn=ei*60+ri}else{const ei=parseInt(mt.calltime.replace(/\D/g,""),10);gn=isNaN(ei)?0:ei}bt.totalTime+=gn,bt.totalCost+=parseFloat(mt.cost)||0}),Array.from(Ze.values())},qe=L?Se.filter(it=>it.name===L):_e.filter(it=>it.name.toLowerCase().includes(d.toLowerCase())),ut=Math.ceil(qe.length/x),Oe=g*x,Qe=Oe-x,Ke=qe.slice(Qe,Oe),Re=async()=>{try{const it=await h();Te(it.Histoty),he(It(it.Histoty))}catch(it){console.log(it)}};fe.useEffect(()=>{Re()},[v]);const se=it=>{console.log("id",it),I(it),T(!0)},we=async()=>{console.log(C,"usertodelete");const Ze=await i(C);console.log(Ze),ea.fire({title:"Successfull !",text:"Delete successfully",icon:"success"}),Re()},He=it=>new Date(it).toISOString().split("T")[0],ct=async()=>{if(console.log("delete"),!K||!Q){alert("Please select both from and to dates.");return}const it=He(K),Ze=He(Q);console.log("first",{superadminname:"admin@123",fromDate:it,toDate:Ze,selectedUser:L||"all"});try{r({superadminname:"admin@123",fromDate:it,toDate:Ze,selectedUser:L||"all"}),Re(),ea.fire({title:"Successfull !",text:"Delete successfully",icon:"success"}),H(""),ne("")}catch(mt){console.log("data",data),console.error(mt),alert("Error deleting recordings.")}},Be=async()=>{try{await Promise.all(ee.map(it=>i(it))),Re(),ea.fire({title:"Successfull !",text:"Delete successfully",icon:"success"}),pe([])}catch(it){console.error(it),alert("Error deleting selected records.")}},Et=it=>{if(!it)return"0 sec";const Ze=it.match(/min=(\d+),\s*sec=(\d+)/);if(Ze){const Ft=parseInt(Ze[1],10),ei=parseInt(Ze[2],10);return`${Ft>0?`${Ft} min `:""}${ei} sec`}const mt=parseInt(it.replace(/\D/g,""),10),bt=Math.floor(mt/60),gn=mt%60;return`${bt>0?`${bt} min `:""}${gn} sec`},St=it=>{const Ze=Math.floor(it/60),mt=it%60;return`${Ze>0?`${Ze} min `:""}${mt} sec`};return M.jsxs(M.Fragment,{children:[M.jsx(pL,{}),M.jsxs("div",{className:"container mx-auto p-6 w-full md:w-4/5",children:[M.jsxs("div",{className:"flex items-center justify-between mb-6",children:[M.jsxs("div",{className:"flex gap-4 items-center",children:[M.jsxs("div",{children:[M.jsx("label",{className:"text-sm text-gray-700 block mb-1",children:"From Date"}),M.jsx("input",{type:"date",value:K,onChange:it=>H(it.target.value),className:"p-2 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200 text-sm"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"text-sm text-gray-700 block mb-1",children:"To Date"}),M.jsx("input",{type:"date",value:Q,onChange:it=>ne(it.target.value),className:"p-2 border text-sm border-gray-300 rounded-lg focus:ring focus:ring-blue-200"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"text-sm text-gray-700 block mb-1",children:"Select Admin"}),M.jsxs("select",{className:"p-2 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200 text-sm",onChange:it=>{N(it.target.value)},value:L,children:[M.jsx("option",{value:"all",children:"All"}),Ge.map(it=>M.jsx("option",{value:it.id,children:it.name},it.id))]})]})]}),M.jsx("button",{className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition",onClick:()=>be(!0),children:"Delete by Date"})]}),M.jsxs("div",{className:"flex items-center justify-between mb-4",children:[M.jsxs("div",{className:"relative w-1/3",children:[M.jsx("input",{type:"text",placeholder:"Search...",className:"w-full p-2 pl-10 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200",value:d,onChange:it=>p(it.target.value)}),M.jsx(vT,{className:"absolute left-3 top-2.5 text-gray-400",size:20})]}),L&&M.jsx("button",{onClick:()=>N(null),className:"ml-2 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Back to All Users"}),L&&ee.length>0&&M.jsx("div",{className:"mb-4",children:M.jsxs("button",{onClick:Be,className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition",children:["Delete Selected (",ee.length,")"]})})]}),M.jsx("div",{className:"overflow-x-auto shadow-lg rounded-lg",children:M.jsx("div",{className:"min-w-full inline-block align-middle",children:M.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:M.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[M.jsx("thead",{className:"bg-blue-600 text-white",children:M.jsxs("tr",{children:[M.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Name"}),L?M.jsxs(M.Fragment,{children:[M.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Date"}),M.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Time"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Cost"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Delete"}),L&&M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:M.jsx("input",{type:"checkbox",checked:Ke.length>0&&Ke.every(it=>ee.includes(it.id)),onChange:it=>{const Ze=it.target.checked?Ke.map(mt=>mt.id):[];pe(Ze)}})})]}):M.jsxs(M.Fragment,{children:[M.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Total Time"}),M.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Total Cost"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"View"})]})]})}),M.jsx("tbody",{className:"divide-y divide-gray-300 bg-white",children:Ke.map((it,Ze)=>M.jsxs("tr",{className:"hover:bg-gray-100 transition",onClick:()=>!L&&N(it.name),style:{cursor:L?"default":"pointer"},children:[M.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800 text-nowrap",children:it.name}),L?M.jsxs(M.Fragment,{children:[M.jsx("td",{className:"px-6 py-4 text-sm text-gray-800 text-nowrap",children:it.date?new Date(it.date).toLocaleDateString("en-GB"):"Not Available"}),M.jsx("td",{className:"px-6 py-4 text-sm text-gray-800 whitespace-nowrap",children:Et(it.calltime)}),M.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800 text-center text-nowrap",children:`$ ${parseFloat(it.cost).toFixed(4)}`}),M.jsx("td",{className:"px-6 py-4 text-center",children:M.jsx("button",{onClick:mt=>{mt.stopPropagation(),se(it.id)},className:"text-red-500 hover:text-red-700 transition",children:M.jsx(O_,{size:20})})}),L&&M.jsx("td",{className:"px-6 py-4 text-center",children:M.jsx("input",{type:"checkbox",checked:ee.includes(it.id),onChange:mt=>{mt.stopPropagation();const bt=mt.target.checked?[...ee,it.id]:ee.filter(gn=>gn!==it.id);pe(bt)}})})]}):M.jsxs(M.Fragment,{children:[M.jsx("td",{className:"px-6 py-4 text-sm text-gray-800 whitespace-nowrap",children:St(it.totalTime)}),M.jsx("td",{className:"px-6 py-4 text-sm text-gray-800 text-nowrap",children:`$ ${parseFloat(it.totalCost).toFixed(4)}`}),M.jsx("td",{className:"px-6 py-4 text-center",children:M.jsx("button",{onClick:mt=>{mt.stopPropagation(),N(it.name)},className:"text-blue-500 hover:text-blue-700 transition",children:M.jsx(ol,{size:20})})})]})]},Ze))})]})})})}),M.jsxs("div",{className:"flex justify-center items-center mt-4 space-x-2",children:[M.jsx("button",{onClick:()=>y(it=>Math.max(it-1,1)),disabled:g===1,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50",children:"Prev"}),M.jsx("button",{onClick:()=>y(it=>Math.min(it+1,ut)),disabled:g===ut,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50",children:"Next"})]})]}),v&&M.jsx("div",{id:"popup-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:M.jsx("div",{className:"relative p-4 w-full max-w-md",children:M.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[M.jsx("button",{type:"button",className:" cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>T(!1),children:M.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),M.jsxs("div",{className:"cursor-pointer p-6 text-center",children:[M.jsx("svg",{className:"cursor-pointer mx-auto mb-4 text-red-600 w-14 h-14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),M.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Confirm Permanent Deletion"}),M.jsxs("p",{className:"mb-6 text-gray-600",children:["This will permanently delete the admin"," ",M.jsx("span",{className:"font-semibold"})," ","and cannot be recovered. Are you sure you want to continue?"]}),M.jsxs("div",{className:"flex justify-center space-x-4",children:[M.jsx("button",{className:"cursor-pointer px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",onClick:()=>{we(),T(!1)},children:"Delete Permanently"}),M.jsx("button",{onClick:()=>T(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})}),de&&M.jsx("div",{id:"popup-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:M.jsx("div",{className:"relative p-4 w-full max-w-md",children:M.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[M.jsx("button",{type:"button",className:" cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>be(!1),children:M.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),M.jsxs("div",{className:"cursor-pointer p-6 text-center",children:[M.jsx("svg",{className:"cursor-pointer mx-auto mb-4 text-red-600 w-14 h-14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),M.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Confirm Permanent Deletion"}),M.jsx("p",{className:"mb-6 text-gray-600",children:"This will permanently delete the admin and whose user recording and cannot be recovered. Are you sure you want to continue?"}),M.jsxs("div",{className:"flex justify-center space-x-4",children:[M.jsx("button",{className:"cursor-pointer px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",onClick:()=>{ct(),be(!1)},children:"Delete Permanently"}),M.jsx("button",{onClick:()=>be(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})})]})}const mL=()=>{const h=BG();return{login:async y=>{try{const v=await h.post("/admin/login",y);return console.log(v,"response in login"),v.message===" Login successful!"?(console.log("Login successful"),localStorage.setItem("token",v),localStorage.setItem("channel_name",v.channel_name),localStorage.setItem("app_id",v.app_id),localStorage.setItem("app_certificate",v.token_id),localStorage.setItem("adminid",v.id)):console.log("Login failed"),v}catch(v){throw console.error(v),new Error(v)}},createTeamUser:async y=>{try{const v=localStorage.getItem("adminid"),T={...y,admin_id:v};return await h.post("/team/create",T)}catch(v){throw console.error(v),new Error(v)}},listTeamUsers:async(y,v,T,C="")=>{try{return await h.get(`team/getuser/${y}?pagesize=${v}&offset=${T}&search=${C}`)}catch(I){throw console.error(I),new Error(I)}},getTeamUserById:async y=>{try{return await h.get(`/team/get/${y}`)}catch(v){throw console.error(v),new Error(v)}},updateTeamUser:async(y,v)=>{try{return await h.put(`/team/update/${y}`,v)}catch(T){throw console.error(T),new Error(T)}},deleteuser:async y=>{try{return console.log("Deleting user with ID:",y),await h.delete(`/team/delete/${y}`)}catch(v){console.log("error in delete user",v)}}}};function mZ(){const h=Pm(),{login:i}=mL(),[r,o]=Sd.useState({username:"",password:""}),[d,p]=Sd.useState(""),g=v=>{const{name:T,value:C}=v.target;o(I=>({...I,[T]:C}))},y=async v=>{if(v.preventDefault(),p(""),!r.username||!r.password){p("Please fill in all fields");return}try{console.log("data",r);const T=await i(r);console.log(T==null?void 0:T.name),localStorage.setItem("admin_name",T==null?void 0:T.name),localStorage.setItem("admin_id",T==null?void 0:T.username),localStorage.setItem("admin_limit",T==null?void 0:T.adminlimits),localStorage.setItem("admin_email",T==null?void 0:T.email),localStorage.setItem("admin_id",T==null?void 0:T.id),T.message===" Login successful!"&&h("/admindashboard"),T.message==="Your are Lock, Contact your Superadmin"?p("Your are Lock, Contact your Superadmin"):p("Invalid credentials")}catch(T){let C=T.message||"Login failed. Please try again.";C=C==null?void 0:C.replace(/^Error:\s*/,""),p(C),console.error(T)}};return M.jsxs("div",{className:"flex flex-col md:flex-row h-screen bg-gradient-to-r from-blue-500 to-blue-700",children:[M.jsxs("div",{className:"w-full md:w-1/2 flex flex-col justify-center items-center bg-white text-blue-600 p-10 shadow-xl rounded-lg",children:[M.jsx("img",{src:aT,alt:"Logo",className:"w-24 h-24 mb-4 animate-pulse"}),M.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Welcome Back"}),M.jsx("p",{className:"mb-6 text-lg text-gray-600",children:"Login to your Admin account"}),M.jsxs("form",{onSubmit:y,className:"w-full max-w-sm bg-gray-50 p-6 rounded-lg shadow-2xl transform transition hover:scale-105",children:[d&&M.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:d}),M.jsxs("div",{className:"mb-4",children:[M.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"username"}),M.jsx("input",{type:"text",name:"username",value:r.username,onChange:g,className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 shadow-sm",placeholder:"Enter your email"})]}),M.jsxs("div",{className:"mb-4",children:[M.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Password"}),M.jsx("input",{type:"password",name:"password",value:r.password,onChange:g,className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600 shadow-sm",placeholder:"Enter your password"})]}),M.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition transform hover:scale-105 shadow-md hover:shadow-lg",children:"Login"})]})]}),M.jsx("div",{className:"hidden md:flex w-1/2 items-center justify-center p-10 animate-slide-in",children:M.jsx("img",{src:pG,alt:"Illustration",className:"max-w-full h-auto drop-shadow-xl rounded-lg"})})]})}var qG={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},k3=Sd.createContext&&Sd.createContext(qG),gZ=["attr","size","title"];function EZ(h,i){if(h==null)return{};var r=_Z(h,i),o,d;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(h);for(d=0;d<p.length;d++)o=p[d],!(i.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(h,o)&&(r[o]=h[o])}return r}function _Z(h,i){if(h==null)return{};var r={};for(var o in h)if(Object.prototype.hasOwnProperty.call(h,o)){if(i.indexOf(o)>=0)continue;r[o]=h[o]}return r}function iC(){return iC=Object.assign?Object.assign.bind():function(h){for(var i=1;i<arguments.length;i++){var r=arguments[i];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(h[o]=r[o])}return h},iC.apply(this,arguments)}function M3(h,i){var r=Object.keys(h);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(h);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(h,d).enumerable})),r.push.apply(r,o)}return r}function sC(h){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?M3(Object(r),!0).forEach(function(o){SZ(h,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(r)):M3(Object(r)).forEach(function(o){Object.defineProperty(h,o,Object.getOwnPropertyDescriptor(r,o))})}return h}function SZ(h,i,r){return i=yZ(i),i in h?Object.defineProperty(h,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):h[i]=r,h}function yZ(h){var i=TZ(h,"string");return typeof i=="symbol"?i:i+""}function TZ(h,i){if(typeof h!="object"||!h)return h;var r=h[Symbol.toPrimitive];if(r!==void 0){var o=r.call(h,i);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(h)}function $G(h){return h&&h.map((i,r)=>Sd.createElement(i.tag,sC({key:r},i.attr),$G(i.child)))}function vZ(h){return i=>Sd.createElement(bZ,iC({attr:sC({},h.attr)},i),$G(h.child))}function bZ(h){var i=r=>{var{attr:o,size:d,title:p}=h,g=EZ(h,gZ),y=d||r.size||"1em",v;return r.className&&(v=r.className),h.className&&(v=(v?v+" ":"")+h.className),Sd.createElement("svg",iC({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,o,g,{className:v,style:sC(sC({color:h.color||r.color},r.style),h.style),height:y,width:y,xmlns:"http://www.w3.org/2000/svg"}),p&&Sd.createElement("title",null,p),h.children)};return k3!==void 0?Sd.createElement(k3.Consumer,null,r=>i(r)):i(qG)}function RZ(h){return vZ({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4zm-132.9 88.7L299.3 420.7c-6.2 6.2-16.4 6.2-22.6 0L171.3 315.3c-10.1-10.1-2.9-27.3 11.3-27.3H248V176c0-8.8 7.2-16 16-16h48c8.8 0 16 7.2 16 16v112h65.4c14.2 0 21.4 17.2 11.3 27.3z"},child:[]}]})(h)}const gL=({setusercreated:h})=>{const i=fe.useRef(null),r=Pm(),[o,d]=fe.useState(!1),[p,g]=fe.useState(!1),{updateAdmin:y,getAdminById:v}=TT(),[T,C]=fe.useState(!1),[I,L]=fe.useState(!1),[N,x]=fe.useState(!1),[K,H]=fe.useState(!1),[Q,ne]=fe.useState(!1),[ee,pe]=fe.useState(!1),{createTeamUser:de}=mL(),[be,Se]=fe.useState(""),[Te,_e]=fe.useState(""),[he,Ge]=fe.useState(""),[st,It]=fe.useState(""),[qe,ut]=fe.useState(0),[Oe,Qe]=fe.useState(!1),[Ke,Re]=fe.useState(!1),[se,we]=fe.useState(!1),[He,ct]=fe.useState(),[Be,Et]=fe.useState({name:"",password:"",confirmPassword:"",mobilenumber:"",username:"",createdby:st,Channelid:"Channelid"});fe.useEffect(()=>{Se(localStorage.getItem("admin_name")),_e(localStorage.getItem("admin_email")),Ge(localStorage.getItem("admin_limit")),It(localStorage.getItem("admin_id")),ut(localStorage.getItem("totaluser")),ct(localStorage.getItem("admin_id")),Et({...Be,createdby:localStorage.getItem("admin_id")})},[]),fe.useEffect(()=>{const Ft=()=>{window.innerWidth>768&&C(!1)};return window.addEventListener("resize",Ft),()=>window.removeEventListener("resize",Ft)},[]);const St=Ft=>{Et({...Be,[Ft.target.name]:Ft.target.value})};fe.useEffect(()=>{(async()=>{const ei=localStorage.getItem("admin_id");try{const ri=await v(ei);Ge(ri==null?void 0:ri.adminlimits),It(ri==null?void 0:ri.username),console.log("response",ri)}catch(ri){console.log("error",ri)}})()},[]);const it=async Ft=>{Ft.preventDefault(),console.log("Form data submitted");const{name:ei,password:ri,confirmPassword:Ws,username:jt,mobilenumber:$n}=Be;if(ei&&ri&&Ws&&jt)if(ri===Ws){console.log("Form submitted:",Be);try{const Wn=await de(Be);console.log(Wn,"Response in create new user"),Wn.message===" Team created successfully!"&&(console.log("User created successfully"),ea.fire({title:"Success!",text:"User Added Successfully!",icon:"success"}),H(!1),h(!0))}catch(Wn){console.error(Wn.message),ea.fire({icon:"error",title:"Oops...",text:Wn.message})}}else ea.fire({icon:"error",title:"Oops...",text:"Password Does Not Match"});else ea.fire({icon:"error",title:"Oops...",text:"All Fields are Required"})},[Ze,mt]=fe.useState({password:"",conformpassword:""}),bt=async()=>{if(Ze.password!==Ze.conformpassword){ea.fire({title:"Error!",text:"Passwords do not match. Please try again.",icon:"error"});return}console.log("Adminid",He);const Ft={password:Ze.password};console.log("Passwordreset",Ft);const ei=await y(He,Ft);console.log(ei),we(!1),ea.fire({title:"Successfuly!",text:"Password Reset Successfuly!",icon:"success"})},gn=()=>{i.current&&i.current.click()};return M.jsxs(M.Fragment,{children:[M.jsx("nav",{className:"bg-white shadow-md",children:M.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[M.jsxs("div",{className:"flex justify-between items-center h-16",children:[M.jsxs("div",{className:"flex items-center space-x-8",children:[M.jsx("img",{src:aT,alt:"Logo",className:"h-8 w-auto"}),M.jsxs("div",{className:"hidden md:flex space-x-6",children:[M.jsx(al,{to:"/admindashboard",className:({isActive:Ft})=>Ft?"text-sm text-blue-600 px-3 py-2 font-bold ":" text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:"Home"}),M.jsx(al,{to:"/user",className:({isActive:Ft})=>Ft?"text-sm text-blue-600 px-3 py-2 font-bold ":" text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:"User"}),M.jsx(al,{to:"/calllog",className:({isActive:Ft})=>Ft?"text-sm text-blue-600 px-3 py-2 font-bold ":" text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:"Call Log"})]})]}),M.jsxs("div",{className:"flex items-center space-x-4",children:[M.jsx("button",{onClick:gn,className:"text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:M.jsxs("span",{className:"flex flex-col items-center space-x-1",children:[M.jsx(RZ,{className:"h-5 w-5"}),M.jsx("span",{className:"hidden md:inline",children:"Download App"})]})}),M.jsx("a",{ref:i,href:"https://api.skaivoice.live/v1/download/app",download:"app",style:{display:"none"}}),M.jsx("button",{onClick:()=>{H(!0),setuserModalOpen(Ft=>!Ft)},className:"cursor-pointer hidden md:inline-flex items-center bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors",children:"+ New User"}),M.jsxs("div",{className:"hidden md:flex items-center space-x-2 cursor-pointer",onClick:()=>x(!N),children:[M.jsx("img",{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSqf0Wx4wmsKfLYsiLdBx6H4D8bwQBurWhx5g&s",alt:"User profile",className:"h-8 w-8 rounded-full"}),M.jsx("span",{className:"text-gray-600 text-sm",children:be})]}),M.jsx("button",{onClick:()=>C(!T),className:"md:hidden text-gray-500 hover:text-gray-700 focus:outline-none",children:M.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]}),T&&M.jsxs("div",{className:"md:hidden pb-4 space-y-2",children:[M.jsx(al,{to:"/admindashboard",className:({isActive:Ft})=>Ft?"text-sm text-blue-600 px-3 py-2 font-bold ":" text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:"Home"}),M.jsx(al,{to:"/user",className:({isActive:Ft})=>Ft?"text-sm text-blue-600 px-3 py-2 font-bold ":" text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:"User"}),M.jsx(al,{to:"/calllog",className:({isActive:Ft})=>Ft?"text-sm text-blue-600 px-3 py-2 font-bold ":" text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium",children:"Call Log"}),M.jsx("button",{onClick:()=>{H(!0),setuserModalOpen(Ft=>!Ft)},className:"cursor-pointer w-full my-3 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md text-base font-medium transition-colors",children:"+ New User"}),M.jsxs("div",{className:"flex md:hidden items-center space-x-2 cursor-pointer",onClick:()=>x(!N),children:[M.jsx("img",{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSqf0Wx4wmsKfLYsiLdBx6H4D8bwQBurWhx5g&s",alt:"User profile",className:"h-8 w-8 rounded-full"}),M.jsx("span",{className:"text-gray-600 text-sm",children:be})]})]})]})}),N&&M.jsx("div",{className:"fixed right-4 md:right-8 top-16 z-50 transition-all duration-300 ease-out",children:M.jsx("div",{className:"w-80 max-w-[90vw] border border-gray-200 rounded-xl bg-white shadow-xl overflow-hidden transform hover:shadow-2xl transition-shadow duration-300",children:M.jsxs("div",{className:"px-6 py-4",children:[M.jsxs("div",{className:"flex flex-col items-start space-y-2",children:[M.jsx("h3",{className:"text-2xl font-bold text-blue-500",children:be}),M.jsx("span",{className:"px-3 py-1 rounded-full bg-white/20 text-sm text-blue-500 font-medium tracking-wide",children:"Admin"})]}),M.jsxs("div",{className:"space-y-4",children:[M.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg transition-colors",children:[M.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),M.jsx("span",{className:"text-gray-700 font-medium",children:st})]}),M.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg transition-colors",children:[M.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),M.jsxs("span",{className:"text-gray-700 font-medium",children:[he!=null?he+" ":"Not Added","Users Limit"]})]})]}),M.jsxs("div",{className:"mt-8 space-y-4",children:[M.jsxs("button",{onClick:()=>Re(!0),className:"w-full flex items-center justify-center space-x-2 py-3 px-6 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-all duration-300 shadow-md hover:shadow-lg",children:[M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[M.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),M.jsx("polyline",{points:"16 17 21 12 16 7"}),M.jsx("line",{x1:"21",x2:"9",y1:"12",y2:"12"})]}),M.jsx("span",{className:"font-semibold",children:"Log Out"})]}),M.jsx("div",{className:"text-center pt-2",children:M.jsx("a",{onClick:()=>we(!0),className:"text-blue-600 hover:text-blue-700 text-sm font-medium transition-colors duration-300 hover:underline",children:"Forgot Password?"})})]})]})})}),K&&M.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/30 backdrop-blur-sm z-50 animate-fadeIn",children:M.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-2xl w-[500px] max-w-[95%] border border-gray-100 animate-scaleIn",children:[M.jsxs("div",{className:"flex justify-between items-center pb-4 mb-4 border-b border-gray-200",children:[M.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Add New User"}),M.jsx("button",{onClick:()=>{H(!1),setuserModalOpen(Ft=>!Ft)},className:"cursor-pointer text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100",children:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),M.jsxs("form",{className:"space-y-4",onSubmit:it,children:[M.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),M.jsx("input",{type:"text",name:"name",required:!0,placeholder:"Enter full name",onChange:St,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),M.jsx("input",{type:"text",name:"mobilenumber",pattern:"\\d{10}",maxLength:"10",inputMode:"numeric",placeholder:"Phone number",onChange:St,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),M.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[M.jsxs("div",{className:"relative",children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),M.jsx("input",{type:Q?"text":"password",name:"password",required:!0,placeholder:"Create password",onChange:St,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),M.jsx("button",{type:"button",onClick:()=>ne(!Q),className:" cursor-pointer absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:Q?M.jsx(md,{className:"h-5 w-5"}):M.jsx(ol,{className:"h-5 w-5"})})]}),M.jsxs("div",{className:"relative",children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),M.jsx("input",{type:ee?"text":"password",name:"confirmPassword",required:!0,placeholder:"Confirm password",onChange:St,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),M.jsx("button",{type:"button",onClick:()=>pe(!ee),className:"cursor-pointer absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:ee?M.jsx(md,{className:"h-5 w-5"}):M.jsx(ol,{className:"h-5 w-5"})})]})]}),M.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),M.jsx("input",{type:"text",required:!0,name:"username",placeholder:"Username",onChange:St,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Channel Name"}),M.jsx("input",{type:"text",readOnly:!0,value:localStorage.getItem("channel_name"),name:"Channelid",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),M.jsx("div",{className:"grid grid-cols-2 gap-4"}),M.jsx("button",{type:"submit",className:"cursor-pointer w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-medium hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg active:scale-95 transform mt-4",children:"Add User"})]})]})}),Oe&&M.jsx("div",{id:"popup-modal",className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:M.jsx("div",{className:"relative p-4 w-full max-w-md",children:M.jsx("div",{className:"relative bg-white rounded-lg shadow-lg",children:M.jsxs("div",{onClick:()=>Qe(!1),className:"p-6 text-center",children:[M.jsx("svg",{className:"mx-auto mb-4 text-red-600 w-14 h-14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),M.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"User Limit Reached"}),M.jsx("p",{className:"mb-6 text-gray-600",children:"You have reached your limit to create a user. Please contact your SuperUser."}),M.jsx("button",{onClick:()=>Qe(!1),className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"OK"})]})})})}),Ke&&M.jsx("div",{id:"logout-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:M.jsx("div",{className:"relative p-4 w-full max-w-md",children:M.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[M.jsx("button",{type:"button",className:"cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>Re(!1),children:M.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),M.jsxs("div",{className:"p-6 text-center",children:[M.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Do you want to logout?"}),M.jsxs("div",{className:"flex justify-center space-x-4",children:[M.jsx("button",{className:"cursor-pointer px-6 py-2 text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors",onClick:()=>r("/adminlogin"),children:"Yes"}),M.jsx("button",{onClick:()=>Re(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})}),se&&M.jsx("div",{id:"password-reset-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:M.jsx("div",{className:"relative p-4 w-full max-w-md",children:M.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg p-6",children:[M.jsx("button",{type:"button",className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>we(!1),children:M.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),M.jsxs("div",{className:"text-center",children:[M.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Reset Password"}),M.jsxs("div",{className:"mb-4 relative",children:[M.jsx("input",{type:o?"text":"password",onChange:Ft=>mt({...Ze,password:Ft.target.value}),placeholder:"New Password",className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),M.jsx("button",{type:"button",className:"absolute inset-y-0 right-3 flex items-center text-gray-500 hover:text-gray-700",onClick:()=>d(!o),children:o?M.jsx(md,{className:"w-5 h-5"}):M.jsx(ol,{className:"w-5 h-5"})})]}),M.jsxs("div",{className:"mb-6 relative",children:[M.jsx("input",{type:p?"text":"password",onChange:Ft=>mt({...Ze,conformpassword:Ft.target.value}),placeholder:"Confirm New Password",className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),M.jsx("button",{type:"button",className:"absolute inset-y-0 right-3 flex items-center text-gray-500 hover:text-gray-700",onClick:()=>g(!p),children:p?M.jsx(md,{className:"w-5 h-5"}):M.jsx(ol,{className:"w-5 h-5"})})]}),M.jsxs("div",{className:"flex justify-center space-x-4",children:[M.jsx("button",{className:"px-6 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors",onClick:bt,children:"Reset Password"}),M.jsx("button",{onClick:()=>we(!1),className:"px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})})]})};var YA={exports:{}},AZ=YA.exports,U3;function CZ(){return U3||(U3=1,function(h,i){(function(r,o){h.exports=o()})(AZ,function(){function r(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(s){if(s!=="default"&&!(s in e)){var a=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(e,s,a.get?a:{enumerable:!0,get:function(){return n[s]}})}})}),Object.freeze(e)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof GD<"u"?GD:typeof self<"u"?self:{};function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p=function(e){try{return!!e()}catch{return!0}},g=!p(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),y=g,v=Function.prototype,T=v.call,C=y&&v.bind.bind(T,T),I=y?C:function(e){return function(){return T.apply(e,arguments)}},L=I({}.isPrototypeOf),N=function(e){return e&&e.Math==Math&&e},x=N(typeof globalThis=="object"&&globalThis)||N(typeof window=="object"&&window)||N(typeof self=="object"&&self)||N(typeof o=="object"&&o)||function(){return this}()||o||Function("return this")(),K=g,H=Function.prototype,Q=H.apply,ne=H.call,ee=typeof Reflect=="object"&&Reflect.apply||(K?ne.bind(Q):function(){return ne.apply(Q,arguments)}),pe=I,de=pe({}.toString),be=pe("".slice),Se=function(e){return be(de(e),8,-1)},Te=Se,_e=I,he=function(e){if(Te(e)==="Function")return _e(e)},Ge=typeof document=="object"&&document.all,st={all:Ge,IS_HTMLDDA:Ge===void 0&&Ge!==void 0},It=st.all,qe=st.IS_HTMLDDA?function(e){return typeof e=="function"||e===It}:function(e){return typeof e=="function"},ut={},Oe=!p(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Qe=g,Ke=Function.prototype.call,Re=Qe?Ke.bind(Ke):function(){return Ke.apply(Ke,arguments)},se={},we={}.propertyIsEnumerable,He=Object.getOwnPropertyDescriptor,ct=He&&!we.call({1:2},1);se.f=ct?function(e){var t=He(this,e);return!!t&&t.enumerable}:we;var Be,Et,St=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},it=p,Ze=Se,mt=Object,bt=I("".split),gn=it(function(){return!mt("z").propertyIsEnumerable(0)})?function(e){return Ze(e)=="String"?bt(e,""):mt(e)}:mt,Ft=function(e){return e==null},ei=Ft,ri=TypeError,Ws=function(e){if(ei(e))throw ri("Can't call method on "+e);return e},jt=gn,$n=Ws,Wn=function(e){return jt($n(e))},yi=qe,lt=st.all,yt=st.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:yi(e)||e===lt}:function(e){return typeof e=="object"?e!==null:yi(e)},Ot={},Tt=Ot,Xt=x,zn=qe,hs=function(e){return zn(e)?e:void 0},Nn=function(e,t){return arguments.length<2?hs(Tt[e])||hs(Xt[e]):Tt[e]&&Tt[e][t]||Xt[e]&&Xt[e][t]},hi=typeof navigator<"u"&&String(navigator.userAgent)||"",uc=x,yo=hi,Br=uc.process,Ys=uc.Deno,ul=Br&&Br.versions||Ys&&Ys.version,qs=ul&&ul.v8;qs&&(Et=(Be=qs.split("."))[0]>0&&Be[0]<4?1:+(Be[0]+Be[1])),!Et&&yo&&(!(Be=yo.match(/Edge\/(\d+)/))||Be[1]>=74)&&(Be=yo.match(/Chrome\/(\d+)/))&&(Et=+Be[1]);var To=Et,na=To,Cr=p,F_=x.String,hl=!!Object.getOwnPropertySymbols&&!Cr(function(){var e=Symbol();return!F_(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&na&&na<41}),Mm=hl&&!Symbol.sham&&typeof Symbol.iterator=="symbol",ya=Nn,Du=qe,hc=L,Nu=Object,Ya=Mm?function(e){return typeof e=="symbol"}:function(e){var t=ya("Symbol");return Du(t)&&hc(t.prototype,Nu(e))},B_=String,qa=function(e){try{return B_(e)}catch{return"Object"}},Um=qe,mf=qa,vd=TypeError,Ir=function(e){if(Um(e))return e;throw vd(mf(e)+" is not a function")},Fm=Ir,Lu=Ft,bd=function(e,t){var n=e[t];return Lu(n)?void 0:Fm(n)},gf=Re,Bm=qe,$a=yt,Fs=TypeError,_n={exports:{}},fc=x,Ef=Object.defineProperty,V_=function(e,t){try{Ef(fc,e,{value:t,configurable:!0,writable:!0})}catch{fc[e]=t}return t},Vm="__core-js_shared__",xu=x[Vm]||V_(Vm,{}),fl=xu;(_n.exports=function(e,t){return fl[e]||(fl[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ta=_n.exports,ia=Ws,pc=Object,Ns=function(e){return pc(ia(e))},Ti=Ns,ys=I({}.hasOwnProperty),Yi=Object.hasOwn||function(e,t){return ys(Ti(e),t)},jm=I,vo=0,mc=Math.random(),za=jm(1 .toString),_f=function(e){return"Symbol("+(e===void 0?"":e)+")_"+za(++vo+mc,36)},Sf=Ta,yf=Yi,Gm=_f,Pu=hl,pl=Mm,$s=x.Symbol,zs=Sf("wks"),Tf=pl?$s.for||$s:$s&&$s.withoutSetter||Gm,ti=function(e){return yf(zs,e)||(zs[e]=Pu&&yf($s,e)?$s[e]:Tf("Symbol."+e)),zs[e]},ku=Re,vf=yt,bo=Ya,Mu=bd,Xs=function(e,t){var n,s;if(Bm(n=e.toString)&&!$a(s=gf(n,e))||Bm(n=e.valueOf)&&!$a(s=gf(n,e)))return s;throw Fs("Can't convert object to primitive value")},Uu=TypeError,Hm=ti("toPrimitive"),bf=function(e,t){if(!vf(e)||bo(e))return e;var n,s=Mu(e,Hm);if(s){if(n=ku(s,e,t),!vf(n)||bo(n))return n;throw Uu("Can't convert object to primitive value")}return Xs(e)},ml=Ya,Rd=function(e){var t=bf(e,"string");return ml(t)?t:t+""},Rf=yt,Ro=x.document,Km=Rf(Ro)&&Rf(Ro.createElement),Fu=function(e){return Km?Ro.createElement(e):{}},Af=Fu,Bu=!Oe&&!p(function(){return Object.defineProperty(Af("div"),"a",{get:function(){return 7}}).a!=7}),j_=Oe,gl=Re,Ad=se,Cf=St,Cd=Wn,gc=Rd,El=Yi,Wm=Bu,Vu=Object.getOwnPropertyDescriptor;ut.f=j_?Vu:function(e,t){if(e=Cd(e),t=gc(t),Wm)try{return Vu(e,t)}catch{}if(El(e,t))return Cf(!gl(Ad.f,e,t),e[t])};var Ym=p,Id=qe,If=/#|\.prototype\./,lr=function(e,t){var n=ju[Ao(e)];return n==qm||n!=wd&&(Id(t)?Ym(t):!!t)},Ao=lr.normalize=function(e){return String(e).replace(If,".").toLowerCase()},ju=lr.data={},wd=lr.NATIVE="N",qm=lr.POLYFILL="P",Od=lr,Gu=Ir,$m=g,dr=he(he.bind),ur=function(e,t){return Gu(e),t===void 0?e:$m?dr(e,t):function(){return e.apply(t,arguments)}},Js={},sa=Oe&&p(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),G_=yt,wf=String,Hu=TypeError,is=function(e){if(G_(e))return e;throw Hu(wf(e)+" is not an object")},ra=Oe,zm=Bu,Xm=sa,Co=is,Jm=Rd,Of=TypeError,Df=Object.defineProperty,Qm=Object.getOwnPropertyDescriptor,Io="enumerable",Nf="configurable",Lf="writable";Js.f=ra?Xm?function(e,t,n){if(Co(e),t=Jm(t),Co(n),typeof e=="function"&&t==="prototype"&&"value"in n&&Lf in n&&!n[Lf]){var s=Qm(e,t);s&&s[Lf]&&(e[t]=n.value,n={configurable:Nf in n?n[Nf]:s[Nf],enumerable:Io in n?n[Io]:s[Io],writable:!1})}return Df(e,t,n)}:Df:function(e,t,n){if(Co(e),t=Jm(t),Co(n),zm)try{return Df(e,t,n)}catch{}if("get"in n||"set"in n)throw Of("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Zm=Js,H_=St,wo=Oe?function(e,t,n){return Zm.f(e,t,H_(1,n))}:function(e,t,n){return e[t]=n,e},Ku=x,K_=ee,xf=he,W_=qe,Y_=ut.f,Wu=Od,Oo=Ot,q_=ur,_l=wo,eg=Yi,tg=function(e){var t=function(n,s,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,s)}return new e(n,s,a)}return K_(e,this,arguments)};return t.prototype=e.prototype,t},fn=function(e,t){var n,s,a,l,f,m,_,S,b,A=e.target,O=e.global,D=e.stat,G=e.proto,B=O?Ku:D?Ku[A]:(Ku[A]||{}).prototype,j=O?Oo:Oo[A]||_l(Oo,A,{})[A],Y=j.prototype;for(l in t)s=!(n=Wu(O?l:A+(D?".":"#")+l,e.forced))&&B&&eg(B,l),m=j[l],s&&(_=e.dontCallGetSet?(b=Y_(B,l))&&b.value:B[l]),f=s&&_?_:t[l],s&&typeof m==typeof f||(S=e.bind&&s?q_(f,Ku):e.wrap&&s?tg(f):G&&W_(f)?xf(f):f,(e.sham||f&&f.sham||m&&m.sham)&&_l(S,"sham",!0),_l(j,l,S),G&&(eg(Oo,a=A+"Prototype")||_l(Oo,a,{}),_l(Oo[a],l,f),e.real&&Y&&(n||!Y[l])&&_l(Y,l,f)))},Pf=Math.ceil,ng=Math.floor,ig=Math.trunc||function(e){var t=+e;return(t>0?ng:Pf)(t)},kf=ig,Do=function(e){var t=+e;return t!=t||t===0?0:kf(t)},Dd=Do,sg=Math.max,Mf=Math.min,Nd=function(e,t){var n=Dd(e);return n<0?sg(n+t,0):Mf(n,t)},Uf=Do,Ff=Math.min,Yu=function(e){return e>0?Ff(Uf(e),9007199254740991):0},Ec=Yu,va=function(e){return Ec(e.length)},rg=Wn,Sl=Nd,ag=va,Bf=function(e){return function(t,n,s){var a,l=rg(t),f=ag(l),m=Sl(s,f);if(e&&n!=n){for(;f>m;)if((a=l[m++])!=a)return!0}else for(;f>m;m++)if((e||m in l)&&l[m]===n)return e||m||0;return!e&&-1}},_c={includes:Bf(!0),indexOf:Bf(!1)},yl=_c.includes;fn({target:"Array",proto:!0,forced:p(function(){return!Array(1).includes()})},{includes:function(e){return yl(this,e,arguments.length>1?arguments[1]:void 0)}});var og=Ot,Bs=function(e){return og[e+"Prototype"]},cg=Bs("Array").includes,lg=yt,Vf=Se,qu=ti("match"),$u=function(e){var t;return lg(e)&&((t=e[qu])!==void 0?!!t:Vf(e)=="RegExp")},dg=$u,jf=TypeError,ug={};ug[ti("toStringTag")]="z";var zu=String(ug)==="[object z]",Gf=zu,$_=qe,Xu=Se,wr=ti("toStringTag"),Ld=Object,xd=Xu(function(){return arguments}())=="Arguments",aa=Gf?Xu:function(e){var t,n,s;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(a,l){try{return a[l]}catch{}}(t=Ld(e),wr))=="string"?n:xd?Xu(t):(s=Xu(t))=="Object"&&$_(t.callee)?"Arguments":s},hg=aa,fg=String,Qs=function(e){if(hg(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return fg(e)},pg=ti("match"),z_=fn,Tl=function(e){if(dg(e))throw jf("The method doesn't accept regular expressions");return e},Hf=Ws,vl=Qs,Ju=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[pg]=!1,"/./"[e](t)}catch{}}return!1},Kf=I("".indexOf);z_({target:"String",proto:!0,forced:!Ju("includes")},{includes:function(e){return!!~Kf(vl(Hf(this)),vl(Tl(e)),arguments.length>1?arguments[1]:void 0)}});var Sc=Bs("String").includes,yc=L,Wf=cg,Yf=Sc,oa=Array.prototype,Qu=String.prototype,mg=function(e){var t=e.includes;return e===oa||yc(oa,e)&&t===oa.includes?Wf:typeof e=="string"||e===Qu||yc(Qu,e)&&t===Qu.includes?Yf:t},We=d(mg),bT=Ir,RT=Ns,AT=gn,gg=va,Eg=TypeError,qf=function(e){return function(t,n,s,a){bT(n);var l=RT(t),f=AT(l),m=gg(l),_=e?m-1:0,S=e?-1:1;if(s<2)for(;;){if(_ in f){a=f[_],_+=S;break}if(_+=S,e?_<0:m<=_)throw Eg("Reduce of empty array with no initial value")}for(;e?_>=0:m>_;_+=S)_ in f&&(a=n(a,f[_],_,l));return a}},ca={left:qf(!1)},Vr=p,Xa=function(e,t){var n=[][e];return!!n&&Vr(function(){n.call(null,t||function(){return 1},1)})},No=typeof process<"u"&&Se(process)=="process",Zu=ca.left;fn({target:"Array",proto:!0,forced:!No&&To>79&&To<83||!Xa("reduce")},{reduce:function(e){var t=arguments.length;return Zu(this,e,t,t>1?arguments[1]:void 0)}});var eh=Bs("Array").reduce,$f=L,Lo=eh,th=Array.prototype,ba=function(e){var t=e.reduce;return e===th||$f(th,e)&&t===th.reduce?Lo:t},xo=ba,jr=d(xo),Zs=Se,Ra=Array.isArray||function(e){return Zs(e)=="Array"},bl=fn,nh=Ra,Pd=I([].reverse),Or=[1,2];bl({target:"Array",proto:!0,forced:String(Or)===String(Or.reverse())},{reverse:function(){return nh(this)&&(this.length=this.length),Pd(this)}});var Gr=Bs("Array").reverse,Tc=L,Ts=Gr,hr=Array.prototype,mi=function(e){var t=e.reverse;return e===hr||Tc(hr,e)&&t===hr.reverse?Ts:t},zf=mi,ih=d(zf),Xf=_f,Vs=Ta("keys"),ss=function(e){return Vs[e]||(Vs[e]=Xf(e))},Yn=!p(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),la=Yi,Aa=qe,Rl=Ns,P=Yn,V=ss("IE_PROTO"),X=Object,ce=X.prototype,Fe=P?X.getPrototypeOf:function(e){var t=Rl(e);if(la(t,V))return t[V];var n=t.constructor;return Aa(n)&&t instanceof n?n.prototype:t instanceof X?ce:null},At=I,cn=Ir,Un=qe,Oi=String,vc=TypeError,Al=function(e,t,n){try{return At(cn(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},CT=is,Jf=function(e){if(typeof e=="object"||Un(e))return e;throw vc("Can't set "+Oi(e)+" as a prototype")},IT=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Al(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(s,a){return CT(s),Jf(a),t?e(s,a):s.__proto__=a,s}}():void 0),bc={},Cl={},sh=Yi,Qf=Wn,_g=_c.indexOf,wT=Cl,X_=I([].push),Il=function(e,t){var n,s=Qf(e),a=0,l=[];for(n in s)!sh(wT,n)&&sh(s,n)&&X_(l,n);for(;t.length>a;)sh(s,n=t[a++])&&(~_g(l,n)||X_(l,n));return l},Sg=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],rh=Il,yg=Sg.concat("length","prototype");bc.f=Object.getOwnPropertyNames||function(e){return rh(e,yg)};var ah={};ah.f=Object.getOwnPropertySymbols;var J_=Nn,Q_=bc,Ca=ah,Po=is,wl=I([].concat),OT=J_("Reflect","ownKeys")||function(e){var t=Q_.f(Po(e)),n=Ca.f;return n?wl(t,n(e)):t},Rc=Yi,Ac=OT,Ls=ut,Tg=Js,Z_={},IC=Il,wC=Sg,rs=Object.keys||function(e){return IC(e,wC)},e0=Oe,Zf=sa,ep=Js,t0=is,oh=Wn,ch=rs;Z_.f=e0&&!Zf?Object.defineProperties:function(e,t){t0(e);for(var n,s=oh(t),a=ch(t),l=a.length,f=0;l>f;)ep.f(e,n=a[f++],s[n]);return e};var vg,n0=Nn("document","documentElement"),OC=is,DT=Z_,Ol=Sg,i0=Cl,bg=n0,NT=Fu,ko="prototype",Tn="script",gi=ss("IE_PROTO"),as=function(){},tp=function(e){return"<"+Tn+">"+e+"</"+Tn+">"},kd=function(e){e.write(tp("")),e.close();var t=e.parentWindow.Object;return e=null,t},Mo=function(){try{vg=new ActiveXObject("htmlfile")}catch{}var e,t,n;Mo=typeof document<"u"?document.domain&&vg?kd(vg):(t=NT("iframe"),n="java"+Tn+":",t.style.display="none",bg.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(tp("document.F=Object")),e.close(),e.F):kd(vg);for(var s=Ol.length;s--;)delete Mo[ko][Ol[s]];return Mo()};i0[gi]=!0;var Dl=Object.create||function(e,t){var n;return e!==null?(as[ko]=OC(e),n=new as,as[ko]=null,n[gi]=e):n=Mo(),t===void 0?n:DT.f(n,t)},np=yt,lh=wo,LT=Error,fs=I("".replace),s0=String(LT("zxcasd").stack),Rg=/\n\s*at [^:]*:[^\n]*/,xT=Rg.test(s0),PT=St,DC=!p(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",PT(1,7)),e.stack!==7)}),r0=wo,a0=function(e,t){if(xT&&typeof e=="string"&&!LT.prepareStackTrace)for(;t--;)e=fs(e,Rg,"");return e},o0=DC,Dr=Error.captureStackTrace,Ui={},Ag=Ui,ip=ti("iterator"),Cg=Array.prototype,Ig=function(e){return e!==void 0&&(Ag.Array===e||Cg[ip]===e)},Cc=aa,sp=bd,c0=Ft,l0=Ui,kT=ti("iterator"),rp=function(e){if(!c0(e))return sp(e,kT)||sp(e,"@@iterator")||l0[Cc(e)]},MT=Re,UT=Ir,FT=is,BT=qa,d0=rp,VT=TypeError,u0=function(e,t){var n=arguments.length<2?d0(e):t;if(UT(n))return FT(MT(n,e));throw VT(BT(e)+" is not iterable")},jT=Re,h0=is,GT=bd,wg=function(e,t,n){var s,a;h0(e);try{if(!(s=GT(e,"return"))){if(t==="throw")throw n;return n}s=jT(s,e)}catch(l){a=!0,s=l}if(t==="throw")throw n;if(a)throw s;return h0(s),n},HT=ur,KT=Re,WT=is,YT=qa,qT=Ig,NC=va,f0=L,dh=u0,$T=rp,ap=wg,Og=TypeError,op=function(e,t){this.stopped=e,this.result=t},Dg=op.prototype,uh=function(e,t,n){var s,a,l,f,m,_,S,b=n&&n.that,A=!(!n||!n.AS_ENTRIES),O=!(!n||!n.IS_RECORD),D=!(!n||!n.IS_ITERATOR),G=!(!n||!n.INTERRUPTED),B=HT(t,b),j=function(q){return s&&ap(s,"normal",q),new op(!0,q)},Y=function(q){return A?(WT(q),G?B(q[0],q[1],j):B(q[0],q[1])):G?B(q,j):B(q)};if(O)s=e.iterator;else if(D)s=e;else{if(!(a=$T(e)))throw Og(YT(e)+" is not iterable");if(qT(a)){for(l=0,f=NC(e);f>l;l++)if((m=Y(e[l]))&&f0(Dg,m))return m;return new op(!1)}s=dh(e,a)}for(_=O?e.next:s.next;!(S=KT(_,s)).done;){try{m=Y(S.value)}catch(q){ap(s,"throw",q)}if(typeof m=="object"&&m&&f0(Dg,m))return m}return new op(!1)},zT=Qs,XT=fn,JT=L,p0=Fe,cp=IT,QT=function(e,t,n){for(var s=Ac(t),a=Tg.f,l=Ls.f,f=0;f<s.length;f++){var m=s[f];Rc(e,m)||n&&Rc(n,m)||a(e,m,l(t,m))}},Ng=Dl,Lg=wo,xg=St,LC=function(e,t){np(t)&&"cause"in t&&lh(e,"cause",t.cause)},m0=function(e,t,n,s){o0&&(Dr?Dr(e,t):r0(e,"stack",a0(n,s)))},ZT=uh,ev=function(e,t){return e===void 0?arguments.length<2?"":t:zT(e)},g0=ti("toStringTag"),lp=Error,tv=[].push,hh=function(e,t){var n,s=JT(E0,this);cp?n=cp(lp(),s?p0(this):E0):(n=s?this:Ng(E0),Lg(n,g0,"Error")),t!==void 0&&Lg(n,"message",ev(t)),m0(n,hh,n.stack,1),arguments.length>2&&LC(n,arguments[2]);var a=[];return ZT(e,tv,{that:a}),Lg(n,"errors",a),n};cp?cp(hh,lp):QT(hh,lp,{name:!0});var E0=hh.prototype=Ng(lp.prototype,{constructor:xg(1,hh),message:xg(1,""),name:xg(1,"AggregateError")});XT({global:!0},{AggregateError:hh});var dp,Ic,fh,Pg=qe,_0=x.WeakMap,nv=Pg(_0)&&/native code/.test(String(_0)),Ja=x,Md=yt,Nl=wo,wc=Yi,up=xu,S0=ss,iv=Cl,y0="Object already initialized",Oc=Ja.TypeError,kg=Ja.WeakMap;if(nv||up.state){var Qa=up.state||(up.state=new kg);Qa.get=Qa.get,Qa.has=Qa.has,Qa.set=Qa.set,dp=function(e,t){if(Qa.has(e))throw Oc(y0);return t.facade=e,Qa.set(e,t),t},Ic=function(e){return Qa.get(e)||{}},fh=function(e){return Qa.has(e)}}else{var Ud=S0("state");iv[Ud]=!0,dp=function(e,t){if(wc(e,Ud))throw Oc(y0);return t.facade=e,Nl(e,Ud,t),t},Ic=function(e){return wc(e,Ud)?e[Ud]:{}},fh=function(e){return wc(e,Ud)}}var Ll,hp,T0,Dc={set:dp,get:Ic,has:fh,enforce:function(e){return fh(e)?Ic(e):dp(e,{})},getterFor:function(e){return function(t){var n;if(!Md(t)||(n=Ic(t)).type!==e)throw Oc("Incompatible receiver, "+e+" required");return n}}},Mg=Oe,sv=Yi,rv=Function.prototype,av=Mg&&Object.getOwnPropertyDescriptor,xs=sv(rv,"name"),js={PROPER:xs&&(function(){}).name==="something",CONFIGURABLE:xs&&(!Mg||Mg&&av(rv,"name").configurable)},ov=wo,Nc=function(e,t,n,s){return s&&s.enumerable?e[t]=n:ov(e,t,n),e},cv=p,lv=qe,dv=yt,fp=Dl,Ug=Fe,uv=Nc,Fg=ti("iterator"),v0=!1;[].keys&&("next"in(T0=[].keys())?(hp=Ug(Ug(T0)))!==Object.prototype&&(Ll=hp):v0=!0);var b0=!dv(Ll)||cv(function(){var e={};return Ll[Fg].call(e)!==e});lv((Ll=b0?{}:fp(Ll))[Fg])||uv(Ll,Fg,function(){return this});var Bg={IteratorPrototype:Ll,BUGGY_SAFARI_ITERATORS:v0},R0=aa,hv=zu?{}.toString:function(){return"[object "+R0(this)+"]"},A0=zu,C0=Js.f,I0=wo,fv=Yi,w0=hv,O0=ti("toStringTag"),fr=function(e,t,n,s){if(e){var a=n?e:e.prototype;fv(a,O0)||C0(a,O0,{configurable:!0,value:t}),s&&!A0&&I0(a,"toString",w0)}},D0=Bg.IteratorPrototype,xC=Dl,pv=St,N0=fr,Fd=Ui,Lc=function(){return this},Uo=function(e,t,n,s){var a=t+" Iterator";return e.prototype=xC(D0,{next:pv(+!s,n)}),N0(e,a,!1,!0),Fd[a]=Lc,e},xc=fn,L0=Re,x0=js,pp=Uo,Vg=Fe,Bd=fr,er=Nc,mp=Ui,mv=Bg,xl=x0.PROPER,ph=mv.BUGGY_SAFARI_ITERATORS,gp=ti("iterator"),Pc="keys",Za="values",mh="entries",P0=function(){return this},jg=function(e,t,n,s,a,l,f){pp(n,t,s);var m,_,S,b=function(Y){if(Y===a&&B)return B;if(!ph&&Y in D)return D[Y];switch(Y){case Pc:case Za:case mh:return function(){return new n(this,Y)}}return function(){return new n(this)}},A=t+" Iterator",O=!1,D=e.prototype,G=D[gp]||D["@@iterator"]||a&&D[a],B=!ph&&G||b(a),j=t=="Array"&&D.entries||G;if(j&&(m=Vg(j.call(new e)))!==Object.prototype&&m.next&&(Bd(m,A,!0,!0),mp[A]=P0),xl&&a==Za&&G&&G.name!==Za&&(O=!0,B=function(){return L0(G,this)}),a)if(_={values:b(Za),keys:l?B:b(Pc),entries:b(mh)},f)for(S in _)(ph||O||!(S in D))&&er(D,S,_[S]);else xc({target:t,proto:!0,forced:ph||O},_);return f&&D[gp]!==B&&er(D,gp,B,{}),mp[t]=B,_},Vd=function(e,t){return{value:e,done:t}},Ep=Wn,k0=Ui,M0=Dc;Js.f;var _p=jg,kc=Vd,U0="Array Iterator",gv=M0.set,jd=M0.getterFor(U0);_p(Array,"Array",function(e,t){gv(this,{type:U0,target:Ep(e),index:0,kind:t})},function(){var e=jd(this),t=e.target,n=e.kind,s=e.index++;return!t||s>=t.length?(e.target=void 0,kc(void 0,!0)):kc(n=="keys"?s:n=="values"?t[s]:[s,t[s]],!1)},"values"),k0.Arguments=k0.Array;var da=Js,Sp=function(e,t,n){return da.f(e,t,n)},Ev=Nn,_v=Sp,F0=Oe,Gg=ti("species"),Hg=L,Mc=TypeError,qi=function(e,t){if(Hg(t,e))return e;throw Mc("Incorrect invocation")},B0=qe,Kg=xu,Gs=I(Function.toString);B0(Kg.inspectSource)||(Kg.inspectSource=function(e){return Gs(e)});var V0=Kg.inspectSource,PC=I,Sv=p,j0=qe,vs=aa,ua=V0,Fo=function(){},yv=[],G0=Nn("Reflect","construct"),H0=/^\s*(?:class|function)\b/,K0=PC(H0.exec),Ia=!H0.exec(Fo),Nr=function(e){if(!j0(e))return!1;try{return G0(Fo,yv,e),!0}catch{return!1}},W0=function(e){if(!j0(e))return!1;switch(vs(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ia||!!K0(H0,ua(e))}catch{return!0}};W0.sham=!0;var pr,Gd,Bo,Pl,eo=!G0||Sv(function(){var e;return Nr(Nr.call)||!Nr(Object)||!Nr(function(){e=!0})||e})?W0:Nr,Y0=eo,q0=qa,kl=TypeError,$0=is,gh=function(e){if(Y0(e))return e;throw kl(q0(e)+" is not a constructor")},yp=Ft,Tp=ti("species"),Ml=function(e,t){var n,s=$0(e).constructor;return s===void 0||yp(n=$0(s)[Tp])?t:gh(n)},vp=I([].slice),Tv=TypeError,Vo=function(e,t){if(e<t)throw Tv("Not enough arguments");return e},z0=/(?:ipad|iphone|ipod).*applewebkit/i.test(hi),mr=x,vv=ee,kC=ur,ha=qe,X0=Yi,Uc=p,J0=n0,Wg=vp,Ul=Fu,bv=Vo,Q0=z0,Z0=No,to=mr.setImmediate,Yg=mr.clearImmediate,qg=mr.process,Hd=mr.Dispatch,Xi=mr.Function,Rv=mr.MessageChannel,MC=mr.String,$g=0,bp={},Av="onreadystatechange";Uc(function(){pr=mr.location});var Gi=function(e){if(X0(bp,e)){var t=bp[e];delete bp[e],t()}},vi=function(e){return function(){Gi(e)}},Ln=function(e){Gi(e.data)},jn=function(e){mr.postMessage(MC(e),pr.protocol+"//"+pr.host)};to&&Yg||(to=function(e){bv(arguments.length,1);var t=ha(e)?e:Xi(e),n=Wg(arguments,1);return bp[++$g]=function(){vv(t,void 0,n)},Gd($g),$g},Yg=function(e){delete bp[e]},Z0?Gd=function(e){qg.nextTick(vi(e))}:Hd&&Hd.now?Gd=function(e){Hd.now(vi(e))}:Rv&&!Q0?(Pl=(Bo=new Rv).port2,Bo.port1.onmessage=Ln,Gd=kC(Pl.postMessage,Pl)):mr.addEventListener&&ha(mr.postMessage)&&!mr.importScripts&&pr&&pr.protocol!=="file:"&&!Uc(jn)?(Gd=jn,mr.addEventListener("message",Ln,!1)):Gd=Av in Ul("script")?function(e){J0.appendChild(Ul("script"))[Av]=function(){J0.removeChild(this),Gi(e)}}:function(e){setTimeout(vi(e),0)});var Ei={set:to,clear:Yg},Hr=function(){this.head=null,this.tail=null};Hr.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Kr,Fl,Rp,no,Ji,Fc=Hr,Kd=/ipad|iphone|ipod/i.test(hi)&&typeof Pebble<"u",eS=/web0s(?!.*chrome)/i.test(hi),Hs=x,Wd=ur,Ap=ut.f,wa=Ei.set,tS=Fc,nS=z0,zg=Kd,Xg=eS,jo=No,Cp=Hs.MutationObserver||Hs.WebKitMutationObserver,Bl=Hs.document,Eh=Hs.process,_h=Hs.Promise,Jg=Ap(Hs,"queueMicrotask"),Yd=Jg&&Jg.value;if(!Yd){var Sh=new tS,gr=function(){var e,t;for(jo&&(e=Eh.domain)&&e.exit();t=Sh.get();)try{t()}catch(n){throw Sh.head&&Kr(),n}e&&e.enter()};nS||jo||Xg||!Cp||!Bl?!zg&&_h&&_h.resolve?((no=_h.resolve(void 0)).constructor=_h,Ji=Wd(no.then,no),Kr=function(){Ji(gr)}):jo?Kr=function(){Eh.nextTick(gr)}:(wa=Wd(wa,Hs),Kr=function(){wa(gr)}):(Fl=!0,Rp=Bl.createTextNode(""),new Cp(gr).observe(Rp,{characterData:!0}),Kr=function(){Rp.data=Fl=!Fl}),Yd=function(e){Sh.head||Kr(),Sh.add(e)}}var iS=Yd,bs=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Vl=x.Promise,Qg=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Cv=!Qg&&!No&&typeof window=="object"&&typeof document=="object",UC=x,fa=Vl,Zg=qe,sS=Od,yh=V0,Iv=ti,wv=Cv,Ov=Qg,Ip=To,eE=fa&&fa.prototype,FC=Iv("species"),Dv=Zg(UC.PromiseRejectionEvent),BC=sS("Promise",function(){var e=yh(fa),t=e!==String(fa);if(!t&&Ip===66||!eE.catch||!eE.finally)return!0;if(!Ip||Ip<51||!/native code/.test(e)){var n=new fa(function(a){a(1)}),s=function(a){a(function(){},function(){})};if((n.constructor={})[FC]=s,!(n.then(function(){})instanceof s))return!0}return!t&&(wv||Ov)&&!Dv}),Th={CONSTRUCTOR:BC,REJECTION_EVENT:Dv},io={},qd=Ir,tE=TypeError,Nv=function(e){var t,n;this.promise=new e(function(s,a){if(t!==void 0||n!==void 0)throw tE("Bad Promise constructor");t=s,n=a}),this.resolve=qd(t),this.reject=qd(n)};io.f=function(e){return new Nv(e)};var nE,Lv,xv=fn,Bc=No,Vc=x,ai=Re,rS=Nc,VC=fr,Pv=function(e){var t=Ev(e);F0&&t&&!t[Gg]&&_v(t,Gg,{configurable:!0,get:function(){return this}})},jC=Ir,aS=qe,GC=yt,iE=qi,vh=Ml,sE=Ei.set,bh=iS,oS=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},$d=bs,Go=Fc,Rh=Dc,cS=Vl,lS=Th,dS=io,wp="Promise",kv=lS.CONSTRUCTOR,uS=lS.REJECTION_EVENT,rE=Rh.getterFor(wp),Mv=Rh.set,HC=cS&&cS.prototype,zd=cS,Op=HC,Uv=Vc.TypeError,hS=Vc.document,Xd=Vc.process,fS=dS.f,Fv=fS,Gn=!!(hS&&hS.createEvent&&Vc.dispatchEvent),aE="unhandledrejection",Dp=function(e){var t;return!(!GC(e)||!aS(t=e.then))&&t},oE=function(e,t){var n,s,a,l=t.value,f=t.state==1,m=f?e.ok:e.fail,_=e.resolve,S=e.reject,b=e.domain;try{m?(f||(t.rejection===2&&Ah(t),t.rejection=1),m===!0?n=l:(b&&b.enter(),n=m(l),b&&(b.exit(),a=!0)),n===e.promise?S(Uv("Promise-chain cycle")):(s=Dp(n))?ai(s,n,_,S):_(n)):S(l)}catch(A){b&&!a&&b.exit(),S(A)}},pS=function(e,t){e.notified||(e.notified=!0,bh(function(){for(var n,s=e.reactions;n=s.get();)oE(n,e);e.notified=!1,t&&!e.rejection&&Np(e)}))},cE=function(e,t,n){var s,a;Gn?((s=hS.createEvent("Event")).promise=t,s.reason=n,s.initEvent(e,!1,!0),Vc.dispatchEvent(s)):s={promise:t,reason:n},!uS&&(a=Vc["on"+e])?a(s):e===aE&&oS("Unhandled promise rejection",n)},Np=function(e){ai(sE,Vc,function(){var t,n=e.facade,s=e.value;if(Lp(e)&&(t=$d(function(){Bc?Xd.emit("unhandledRejection",s,n):cE(aE,n,s)}),e.rejection=Bc||Lp(e)?2:1,t.error))throw t.value})},Lp=function(e){return e.rejection!==1&&!e.parent},Ah=function(e){ai(sE,Vc,function(){var t=e.facade;Bc?Xd.emit("rejectionHandled",t):cE("rejectionhandled",t,e.value)})},Jd=function(e,t,n){return function(s){e(t,s,n)}},Ch=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,pS(e,!0))},mS=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Uv("Promise can't be resolved itself");var s=Dp(t);s?bh(function(){var a={done:!1};try{ai(s,t,Jd(mS,a,e),Jd(Ch,a,e))}catch(l){Ch(a,l,e)}}):(e.value=t,e.state=1,pS(e,!1))}catch(a){Ch({done:!1},a,e)}}};kv&&(Op=(zd=function(e){iE(this,Op),jC(e),ai(nE,this);var t=rE(this);try{e(Jd(mS,t),Jd(Ch,t))}catch(n){Ch(t,n)}}).prototype,(nE=function(e){Mv(this,{type:wp,done:!1,notified:!1,parent:!1,reactions:new Go,rejection:!1,state:0,value:void 0})}).prototype=rS(Op,"then",function(e,t){var n=rE(this),s=fS(vh(this,zd));return n.parent=!0,s.ok=!aS(e)||e,s.fail=aS(t)&&t,s.domain=Bc?Xd.domain:void 0,n.state==0?n.reactions.add(s):bh(function(){oE(s,n)}),s.promise}),Lv=function(){var e=new nE,t=rE(e);this.promise=e,this.resolve=Jd(mS,t),this.reject=Jd(Ch,t)},dS.f=fS=function(e){return e===zd||e===void 0?new Lv(e):Fv(e)}),xv({global:!0,wrap:!0,forced:kv},{Promise:zd}),VC(zd,wp,!1,!0),Pv(wp);var gS=ti("iterator"),ES=!1;try{var lE=0,_i={next:function(){return{done:!!lE++}},return:function(){ES=!0}};_i[gS]=function(){return this},Array.from(_i,function(){throw 2})}catch{}var _S=Vl,tr=function(e,t){if(!ES)return!1;var n=!1;try{var s={};s[gS]=function(){return{next:function(){return{done:n=!0}}}},e(s)}catch{}return n},dE=Th.CONSTRUCTOR||!tr(function(e){_S.all(e).then(void 0,function(){})}),SS=Re,yS=Ir,uE=io,Bv=bs,Vv=uh;fn({target:"Promise",stat:!0,forced:dE},{all:function(e){var t=this,n=uE.f(t),s=n.resolve,a=n.reject,l=Bv(function(){var f=yS(t.resolve),m=[],_=0,S=1;Vv(e,function(b){var A=_++,O=!1;S++,SS(f,t,b).then(function(D){O||(O=!0,m[A]=D,--S||s(m))},a)}),--S||s(m)});return l.error&&a(l.value),n.promise}});var TS=fn,vS=Th.CONSTRUCTOR;Vl&&Vl.prototype,TS({target:"Promise",proto:!0,forced:vS,real:!0},{catch:function(e){return this.then(void 0,e)}});var KC=Re,jv=Ir,WC=io,Gv=bs,YC=uh;fn({target:"Promise",stat:!0,forced:dE},{race:function(e){var t=this,n=WC.f(t),s=n.reject,a=Gv(function(){var l=jv(t.resolve);YC(e,function(f){KC(l,t,f).then(n.resolve,s)})});return a.error&&s(a.value),n.promise}});var qC=Re,bS=io;fn({target:"Promise",stat:!0,forced:Th.CONSTRUCTOR},{reject:function(e){var t=bS.f(this);return qC(t.reject,void 0,e),t.promise}});var RS=is,$C=yt,zC=io,Oa=function(e,t){if(RS(e),$C(t)&&t.constructor===e)return t;var n=zC.f(e);return(0,n.resolve)(t),n.promise},Hv=fn,Kv=Vl,Da=Th.CONSTRUCTOR,Wv=Oa,hE=Nn("Promise"),jc=!Da;Hv({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Wv(jc&&this===hE?Kv:this,e)}});var XC=Re,JC=Ir,Ih=io,Yv=bs,QC=uh;fn({target:"Promise",stat:!0,forced:dE},{allSettled:function(e){var t=this,n=Ih.f(t),s=n.resolve,a=n.reject,l=Yv(function(){var f=JC(t.resolve),m=[],_=0,S=1;QC(e,function(b){var A=_++,O=!1;S++,XC(f,t,b).then(function(D){O||(O=!0,m[A]={status:"fulfilled",value:D},--S||s(m))},function(D){O||(O=!0,m[A]={status:"rejected",reason:D},--S||s(m))})}),--S||s(m)});return l.error&&a(l.value),n.promise}});var ZC=Re,eI=Ir,tI=Nn,nI=io,iI=bs,sI=uh,AS="No one promise resolved";fn({target:"Promise",stat:!0,forced:dE},{any:function(e){var t=this,n=tI("AggregateError"),s=nI.f(t),a=s.resolve,l=s.reject,f=iI(function(){var m=eI(t.resolve),_=[],S=0,b=1,A=!1;sI(e,function(O){var D=S++,G=!1;b++,ZC(m,t,O).then(function(B){G||A||(A=!0,a(B))},function(B){G||A||(G=!0,_[D]=B,--b||l(new n(_,AS)))})}),--b||l(new n(_,AS))});return f.error&&l(f.value),s.promise}});var wh=fn,Qd=Vl,qv=p,rI=Nn,Oh=qe,xp=Ml,CS=Oa,fE=Qd&&Qd.prototype;wh({target:"Promise",proto:!0,real:!0,forced:!!Qd&&qv(function(){fE.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=xp(this,rI("Promise")),n=Oh(e);return this.then(n?function(s){return CS(t,e()).then(function(){return s})}:e,n?function(s){return CS(t,e()).then(function(){throw s})}:e)}});var Pp=I,IS=Do,pE=Qs,$v=Ws,zv=Pp("".charAt),Xv=Pp("".charCodeAt),Jv=Pp("".slice),Dh=function(e){return function(t,n){var s,a,l=pE($v(t)),f=IS(n),m=l.length;return f<0||f>=m?e?"":void 0:(s=Xv(l,f))<55296||s>56319||f+1===m||(a=Xv(l,f+1))<56320||a>57343?e?zv(l,f):s:e?Jv(l,f,f+2):a-56320+(s-55296<<10)+65536}},wS={codeAt:Dh(!1),charAt:Dh(!0)},aI=wS.charAt,oI=Qs,kp=Dc,mE=jg,gE=Vd,Qv="String Iterator",Mp=kp.set,cI=kp.getterFor(Qv);mE(String,"String",function(e){Mp(this,{type:Qv,string:oI(e),index:0})},function(){var e,t=cI(this),n=t.string,s=t.index;return s>=n.length?gE(void 0,!0):(e=aI(n,s),t.index+=e.length,gE(e,!1))});var Zv=Ot.Promise,eb={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},tb=x,nb=aa,OS=wo,DS=Ui,Up=ti("toStringTag");for(var NS in eb){var ib=tb[NS],Fp=ib&&ib.prototype;Fp&&nb(Fp)!==Up&&OS(Fp,Up,NS),DS[NS]=DS.Array}var EE=Zv,Ye=d(EE),LS=Bs("Array").values,sb=aa,xS=Yi,jl=L,Gl=LS,Ho=Array.prototype,Bp={DOMTokenList:!0,NodeList:!0},Vp=function(e){var t=e.values;return e===Ho||jl(Ho,e)&&t===Ho.values||xS(Bp,sb(e))?Gl:t},ps=d(Vp),lI=p,rb=ti("iterator"),Zd=!lI(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2"),s="";return e.pathname="c%20d",t.forEach(function(a,l){t.delete("b"),s+=l+a}),n.delete("a",2),!e.toJSON||!n.has("a",1)||n.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[rb]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||s!=="a1c3"||new URL("http://x",void 0).host!=="x"}),dI=Nc,ab=Rd,_E=Js,ob=St,SE=function(e,t,n){var s=ab(t);s in e?_E.f(e,s,ob(0,n)):e[s]=n},jp=Nd,yE=va,cb=SE,Gp=Array,PS=Math.max,Nh=function(e,t,n){for(var s=yE(e),a=jp(t,s),l=jp(n===void 0?s:n,s),f=Gp(PS(l-a,0)),m=0;a<l;a++,m++)cb(f,m,e[a]);return f.length=m,f},kS=Nh,uI=Math.floor,Lh=function(e,t){var n=e.length,s=uI(n/2);return n<8?c(e,t):u(e,Lh(kS(e,0,s),t),Lh(kS(e,s),t),t)},c=function(e,t){for(var n,s,a=e.length,l=1;l<a;){for(s=l,n=e[l];s&&t(e[s-1],n)>0;)e[s]=e[--s];s!==l++&&(e[s]=n)}return e},u=function(e,t,n,s){for(var a=t.length,l=n.length,f=0,m=0;f<a||m<l;)e[f+m]=f<a&&m<l?s(t[f],n[m])<=0?t[f++]:n[m++]:f<a?t[f++]:n[m++];return e},E=Lh,R=fn,w=x,U=Re,J=I,ae=Oe,me=Zd,Ce=Nc,tt=Sp,_t=function(e,t,n){for(var s in t)n&&n.unsafe&&e[s]?e[s]=t[s]:dI(e,s,t[s],n);return e},Ve=fr,Je=Uo,Bt=Dc,hn=qi,$i=qe,Ne=Yi,Ae=ur,ke=aa,ht=is,Mt=yt,Jt=Qs,Kt=Dl,Qt=St,Rs=u0,ni=rp,pa=Vo,hI=E,_6=ti("iterator"),MS="URLSearchParams",BL=MS+"Iterator",VL=Bt.set,Ko=Bt.getterFor(MS),S6=Bt.getterFor(BL),y6=Object.getOwnPropertyDescriptor,fI=function(e){if(!ae)return w[e];var t=y6(w,e);return t&&t.value},jL=fI("fetch"),lb=fI("Request"),US=fI("Headers"),pI=lb&&lb.prototype,GL=US&&US.prototype,T6=w.RegExp,v6=w.TypeError,HL=w.decodeURIComponent,b6=w.encodeURIComponent,R6=J("".charAt),KL=J([].join),Hp=J([].push),mI=J("".replace),A6=J([].shift),WL=J([].splice),YL=J("".split),C6=J("".slice),I6=/\+/g,qL=Array(4),w6=function(e){return qL[e-1]||(qL[e-1]=T6("((?:%[\\da-f]{2}){"+e+"})","gi"))},O6=function(e){try{return HL(e)}catch{return e}},$L=function(e){var t=mI(e,I6," "),n=4;try{return HL(t)}catch{for(;n;)t=mI(t,w6(n--),O6);return t}},D6=/[!'()~]|%20/g,N6={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},L6=function(e){return N6[e]},zL=function(e){return mI(b6(e),D6,L6)},gI=Je(function(e,t){VL(this,{type:BL,iterator:Rs(Ko(e).entries),kind:t})},"Iterator",function(){var e=S6(this),t=e.kind,n=e.iterator.next(),s=n.value;return n.done||(n.value=t==="keys"?s.key:t==="values"?s.value:[s.key,s.value]),n},!0),XL=function(e){this.entries=[],this.url=null,e!==void 0&&(Mt(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?R6(e,0)==="?"?C6(e,1):e:Jt(e)))};XL.prototype={type:MS,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,s,a,l,f,m,_=ni(e);if(_)for(n=(t=Rs(e,_)).next;!(s=U(n,t)).done;){if(l=(a=Rs(ht(s.value))).next,(f=U(l,a)).done||(m=U(l,a)).done||!U(l,a).done)throw v6("Expected sequence with length 2");Hp(this.entries,{key:Jt(f.value),value:Jt(m.value)})}else for(var S in e)Ne(e,S)&&Hp(this.entries,{key:S,value:Jt(e[S])})},parseQuery:function(e){if(e)for(var t,n,s=YL(e,"&"),a=0;a<s.length;)(t=s[a++]).length&&(n=YL(t,"="),Hp(this.entries,{key:$L(A6(n)),value:$L(KL(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],s=0;s<t.length;)e=t[s++],Hp(n,zL(e.key)+"="+zL(e.value));return KL(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var db=function(){hn(this,TE);var e=VL(this,new XL(arguments.length>0?arguments[0]:void 0));ae||(this.size=e.entries.length)},TE=db.prototype;if(_t(TE,{append:function(e,t){var n=Ko(this);pa(arguments.length,2),Hp(n.entries,{key:Jt(e),value:Jt(t)}),ae||this.length++,n.updateURL()},delete:function(e){for(var t=Ko(this),n=pa(arguments.length,1),s=t.entries,a=Jt(e),l=n<2?void 0:arguments[1],f=l===void 0?l:Jt(l),m=0;m<s.length;){var _=s[m];if(_.key!==a||f!==void 0&&_.value!==f)m++;else if(WL(s,m,1),f!==void 0)break}ae||(this.size=s.length),t.updateURL()},get:function(e){var t=Ko(this).entries;pa(arguments.length,1);for(var n=Jt(e),s=0;s<t.length;s++)if(t[s].key===n)return t[s].value;return null},getAll:function(e){var t=Ko(this).entries;pa(arguments.length,1);for(var n=Jt(e),s=[],a=0;a<t.length;a++)t[a].key===n&&Hp(s,t[a].value);return s},has:function(e){for(var t=Ko(this).entries,n=pa(arguments.length,1),s=Jt(e),a=n<2?void 0:arguments[1],l=a===void 0?a:Jt(a),f=0;f<t.length;){var m=t[f++];if(m.key===s&&(l===void 0||m.value===l))return!0}return!1},set:function(e,t){var n=Ko(this);pa(arguments.length,1);for(var s,a=n.entries,l=!1,f=Jt(e),m=Jt(t),_=0;_<a.length;_++)(s=a[_]).key===f&&(l?WL(a,_--,1):(l=!0,s.value=m));l||Hp(a,{key:f,value:m}),ae||(this.size=a.length),n.updateURL()},sort:function(){var e=Ko(this);hI(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Ko(this).entries,s=Ae(e,arguments.length>1?arguments[1]:void 0),a=0;a<n.length;)s((t=n[a++]).value,t.key,this)},keys:function(){return new gI(this,"keys")},values:function(){return new gI(this,"values")},entries:function(){return new gI(this,"entries")}},{enumerable:!0}),Ce(TE,_6,TE.entries,{}),Ce(TE,"toString",function(){return Ko(this).serialize()},{enumerable:!0}),ae&&tt(TE,"size",{get:function(){return Ko(this).entries.length},configurable:!0,enumerable:!0}),Ve(db,MS),R({global:!0,forced:!me},{URLSearchParams:db}),!me&&$i(US)){var x6=J(GL.has),P6=J(GL.set),JL=function(e){if(Mt(e)){var t,n=e.body;if(ke(n)===MS)return t=e.headers?new US(e.headers):new US,x6(t,"content-type")||P6(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Kt(e,{body:Qt(0,Jt(n)),headers:Qt(0,t)})}return e};if($i(jL)&&R({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return jL(e,arguments.length>1?JL(arguments[1]):{})}}),$i(lb)){var EI=function(e){return hn(this,pI),new lb(e,arguments.length>1?JL(arguments[1]):{})};pI.constructor=EI,EI.prototype=pI,R({global:!0,dontCallGetSet:!0,forced:!0},{Request:EI})}}var Wo,k6={URLSearchParams:db,getState:Ko},M6=Ot.URLSearchParams,QL=Oe,U6=I,F6=Re,B6=p,_I=rs,V6=ah,j6=se,G6=Ns,H6=gn,vE=Object.assign,ZL=Object.defineProperty,K6=U6([].concat),W6=!vE||B6(function(){if(QL&&vE({b:1},vE(ZL({},"a",{enumerable:!0,get:function(){ZL(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol(),s="abcdefghijklmnopqrst";return e[n]=7,s.split("").forEach(function(a){t[a]=a}),vE({},e)[n]!=7||_I(vE({},t)).join("")!=s})?function(e,t){for(var n=G6(e),s=arguments.length,a=1,l=V6.f,f=j6.f;s>a;)for(var m,_=H6(arguments[a++]),S=l?K6(_I(_),l(_)):_I(_),b=S.length,A=0;b>A;)m=S[A++],QL&&!F6(f,_,m)||(n[m]=_[m]);return n}:vE,Y6=is,q6=wg,$6=ur,z6=Re,X6=Ns,J6=function(e,t,n,s){try{return s?t(Y6(n)[0],n[1]):t(n)}catch(a){q6(e,"throw",a)}},Q6=Ig,Z6=eo,eH=va,ex=SE,tH=u0,nH=rp,tx=Array,Kp=I,SI=2147483647,iH=/[^\0-\u007E]/,nx=/[.\u3002\uFF0E\uFF61]/g,ix="Overflow: input needs wider integers to process",sx=RangeError,sH=Kp(nx.exec),bE=Math.floor,yI=String.fromCharCode,rx=Kp("".charCodeAt),ax=Kp([].join),xh=Kp([].push),rH=Kp("".replace),aH=Kp("".split),oH=Kp("".toLowerCase),ox=function(e){return e+22+75*(e<26)},cH=function(e,t,n){var s=0;for(e=n?bE(e/700):e>>1,e+=bE(e/t);e>455;)e=bE(e/35),s+=36;return bE(s+36*e/(e+38))},lH=function(e){var t=[];e=function(Y){for(var q=[],ie=0,le=Y.length;ie<le;){var ue=rx(Y,ie++);if(ue>=55296&&ue<=56319&&ie<le){var oe=rx(Y,ie++);(64512&oe)==56320?xh(q,((1023&ue)<<10)+(1023&oe)+65536):(xh(q,ue),ie--)}else xh(q,ue)}return q}(e);var n,s,a=e.length,l=128,f=0,m=72;for(n=0;n<e.length;n++)(s=e[n])<128&&xh(t,yI(s));var _=t.length,S=_;for(_&&xh(t,"-");S<a;){var b=SI;for(n=0;n<e.length;n++)(s=e[n])>=l&&s<b&&(b=s);var A=S+1;if(b-l>bE((SI-f)/A))throw sx(ix);for(f+=(b-l)*A,l=b,n=0;n<e.length;n++){if((s=e[n])<l&&++f>SI)throw sx(ix);if(s==l){for(var O=f,D=36;;){var G=D<=m?1:D>=m+26?26:D-m;if(O<G)break;var B=O-G,j=36-G;xh(t,yI(ox(G+B%j))),O=bE(B/j),D+=36}xh(t,yI(ox(O))),m=cH(f,A,S==_),f=0,S++}}f++,l++}return ax(t,"")},dH=fn,TI=Oe,uH=Zd,vI=x,cx=ur,Yo=I,ub=Nc,qo=Sp,hH=qi,bI=Yi,RI=W6,RE=function(e){var t=X6(e),n=Z6(this),s=arguments.length,a=s>1?arguments[1]:void 0,l=a!==void 0;l&&(a=$6(a,s>2?arguments[2]:void 0));var f,m,_,S,b,A,O=nH(t),D=0;if(!O||this===tx&&Q6(O))for(f=eH(t),m=n?new this(f):tx(f);f>D;D++)A=l?a(t[D],D):t[D],ex(m,D,A);else for(b=(S=tH(t,O)).next,m=n?new this:[];!(_=z6(b,S)).done;D++)A=l?J6(S,a,[_.value,D],!0):_.value,ex(m,D,A);return m.length=D,m},Gc=Nh,fH=wS.codeAt,pH=function(e){var t,n,s=[],a=aH(rH(oH(e),nx,"."),".");for(t=0;t<a.length;t++)n=a[t],xh(s,sH(iH,n)?"xn--"+lH(n):n);return ax(s,".")},eu=Qs,mH=fr,gH=Vo,lx=k6,dx=Dc,EH=dx.set,hb=dx.getterFor("URL"),_H=lx.URLSearchParams,SH=lx.getState,FS=vI.URL,AI=vI.TypeError,fb=vI.parseInt,yH=Math.floor,ux=Math.pow,$o=Yo("".charAt),Hc=Yo(/./.exec),BS=Yo([].join),TH=Yo(1 .toString),vH=Yo([].pop),AE=Yo([].push),CI=Yo("".replace),bH=Yo([].shift),RH=Yo("".split),VS=Yo("".slice),pb=Yo("".toLowerCase),AH=Yo([].unshift),II="Invalid scheme",Wp="Invalid host",hx="Invalid port",fx=/[a-z]/i,CH=/[\d+-.a-z]/i,wI=/\d/,IH=/^0x/i,wH=/^[0-7]+$/,OH=/^\d+$/,px=/^[\da-f]+$/i,DH=/[\0\t\n\r #%/:<>?@[\\\]^|]/,NH=/[\0\t\n\r #/:<>?@[\\\]^|]/,LH=/^[\u0000-\u0020]+/,xH=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,PH=/[\t\n\r]/g,jS=function(e){var t,n,s,a;if(typeof e=="number"){for(t=[],n=0;n<4;n++)AH(t,e%256),e=yH(e/256);return BS(t,".")}if(typeof e=="object"){for(t="",s=function(l){for(var f=null,m=1,_=null,S=0,b=0;b<8;b++)l[b]!==0?(S>m&&(f=_,m=S),_=null,S=0):(_===null&&(_=b),++S);return S>m&&(f=_,m=S),f}(e),n=0;n<8;n++)a&&e[n]===0||(a&&(a=!1),s===n?(t+=n?":":"::",a=!0):(t+=TH(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},mb={},mx=RI({},mb,{" ":1,'"':1,"<":1,">":1,"`":1}),gx=RI({},mx,{"#":1,"?":1,"{":1,"}":1}),OI=RI({},gx,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ph=function(e,t){var n=fH(e,0);return n>32&&n<127&&!bI(t,e)?e:encodeURIComponent(e)},gb={ftp:21,file:null,http:80,https:443,ws:80,wss:443},GS=function(e,t){var n;return e.length==2&&Hc(fx,$o(e,0))&&((n=$o(e,1))==":"||!t&&n=="|")},Ex=function(e){var t;return e.length>1&&GS(VS(e,0,2))&&(e.length==2||(t=$o(e,2))==="/"||t==="\\"||t==="?"||t==="#")},kH=function(e){return e==="."||pb(e)==="%2e"},DI={},_x={},NI={},Sx={},yx={},LI={},Tx={},vx={},Eb={},_b={},xI={},PI={},kI={},MI={},bx={},UI={},CE={},Hl={},Rx={},Yp={},tu={},FI=function(e,t,n){var s,a,l,f=eu(e);if(t){if(a=this.parse(f))throw AI(a);this.searchParams=null}else{if(n!==void 0&&(s=new FI(n,!0)),a=this.parse(f,null,s))throw AI(a);(l=SH(new _H)).bindURL(this),this.searchParams=l}};FI.prototype={type:"URL",parse:function(e,t,n){var s,a,l,f,m,_=this,S=t||DI,b=0,A="",O=!1,D=!1,G=!1;for(e=eu(e),t||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=CI(e,LH,""),e=CI(e,xH,"$1")),e=CI(e,PH,""),s=RE(e);b<=s.length;){switch(a=s[b],S){case DI:if(!a||!Hc(fx,a)){if(t)return II;S=NI;continue}A+=pb(a),S=_x;break;case _x:if(a&&(Hc(CH,a)||a=="+"||a=="-"||a=="."))A+=pb(a);else{if(a!=":"){if(t)return II;A="",S=NI,b=0;continue}if(t&&(_.isSpecial()!=bI(gb,A)||A=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=A,t)return void(_.isSpecial()&&gb[_.scheme]==_.port&&(_.port=null));A="",_.scheme=="file"?S=MI:_.isSpecial()&&n&&n.scheme==_.scheme?S=Sx:_.isSpecial()?S=vx:s[b+1]=="/"?(S=yx,b++):(_.cannotBeABaseURL=!0,AE(_.path,""),S=Rx)}break;case NI:if(!n||n.cannotBeABaseURL&&a!="#")return II;if(n.cannotBeABaseURL&&a=="#"){_.scheme=n.scheme,_.path=Gc(n.path),_.query=n.query,_.fragment="",_.cannotBeABaseURL=!0,S=tu;break}S=n.scheme=="file"?MI:LI;continue;case Sx:if(a!="/"||s[b+1]!="/"){S=LI;continue}S=Eb,b++;break;case yx:if(a=="/"){S=_b;break}S=Hl;continue;case LI:if(_.scheme=n.scheme,a==Wo)_.username=n.username,_.password=n.password,_.host=n.host,_.port=n.port,_.path=Gc(n.path),_.query=n.query;else if(a=="/"||a=="\\"&&_.isSpecial())S=Tx;else if(a=="?")_.username=n.username,_.password=n.password,_.host=n.host,_.port=n.port,_.path=Gc(n.path),_.query="",S=Yp;else{if(a!="#"){_.username=n.username,_.password=n.password,_.host=n.host,_.port=n.port,_.path=Gc(n.path),_.path.length--,S=Hl;continue}_.username=n.username,_.password=n.password,_.host=n.host,_.port=n.port,_.path=Gc(n.path),_.query=n.query,_.fragment="",S=tu}break;case Tx:if(!_.isSpecial()||a!="/"&&a!="\\"){if(a!="/"){_.username=n.username,_.password=n.password,_.host=n.host,_.port=n.port,S=Hl;continue}S=_b}else S=Eb;break;case vx:if(S=Eb,a!="/"||$o(A,b+1)!="/")continue;b++;break;case Eb:if(a!="/"&&a!="\\"){S=_b;continue}break;case _b:if(a=="@"){O&&(A="%40"+A),O=!0,l=RE(A);for(var B=0;B<l.length;B++){var j=l[B];if(j!=":"||G){var Y=Ph(j,OI);G?_.password+=Y:_.username+=Y}else G=!0}A=""}else if(a==Wo||a=="/"||a=="?"||a=="#"||a=="\\"&&_.isSpecial()){if(O&&A=="")return"Invalid authority";b-=RE(A).length+1,A="",S=xI}else A+=a;break;case xI:case PI:if(t&&_.scheme=="file"){S=UI;continue}if(a!=":"||D){if(a==Wo||a=="/"||a=="?"||a=="#"||a=="\\"&&_.isSpecial()){if(_.isSpecial()&&A=="")return Wp;if(t&&A==""&&(_.includesCredentials()||_.port!==null))return;if(f=_.parseHost(A))return f;if(A="",S=CE,t)return;continue}a=="["?D=!0:a=="]"&&(D=!1),A+=a}else{if(A=="")return Wp;if(f=_.parseHost(A))return f;if(A="",S=kI,t==PI)return}break;case kI:if(!Hc(wI,a)){if(a==Wo||a=="/"||a=="?"||a=="#"||a=="\\"&&_.isSpecial()||t){if(A!=""){var q=fb(A,10);if(q>65535)return hx;_.port=_.isSpecial()&&q===gb[_.scheme]?null:q,A=""}if(t)return;S=CE;continue}return hx}A+=a;break;case MI:if(_.scheme="file",a=="/"||a=="\\")S=bx;else{if(!n||n.scheme!="file"){S=Hl;continue}if(a==Wo)_.host=n.host,_.path=Gc(n.path),_.query=n.query;else if(a=="?")_.host=n.host,_.path=Gc(n.path),_.query="",S=Yp;else{if(a!="#"){Ex(BS(Gc(s,b),""))||(_.host=n.host,_.path=Gc(n.path),_.shortenPath()),S=Hl;continue}_.host=n.host,_.path=Gc(n.path),_.query=n.query,_.fragment="",S=tu}}break;case bx:if(a=="/"||a=="\\"){S=UI;break}n&&n.scheme=="file"&&!Ex(BS(Gc(s,b),""))&&(GS(n.path[0],!0)?AE(_.path,n.path[0]):_.host=n.host),S=Hl;continue;case UI:if(a==Wo||a=="/"||a=="\\"||a=="?"||a=="#"){if(!t&&GS(A))S=Hl;else if(A==""){if(_.host="",t)return;S=CE}else{if(f=_.parseHost(A))return f;if(_.host=="localhost"&&(_.host=""),t)return;A="",S=CE}continue}A+=a;break;case CE:if(_.isSpecial()){if(S=Hl,a!="/"&&a!="\\")continue}else if(t||a!="?")if(t||a!="#"){if(a!=Wo&&(S=Hl,a!="/"))continue}else _.fragment="",S=tu;else _.query="",S=Yp;break;case Hl:if(a==Wo||a=="/"||a=="\\"&&_.isSpecial()||!t&&(a=="?"||a=="#")){if((m=pb(m=A))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),a=="/"||a=="\\"&&_.isSpecial()||AE(_.path,"")):kH(A)?a=="/"||a=="\\"&&_.isSpecial()||AE(_.path,""):(_.scheme=="file"&&!_.path.length&&GS(A)&&(_.host&&(_.host=""),A=$o(A,0)+":"),AE(_.path,A)),A="",_.scheme=="file"&&(a==Wo||a=="?"||a=="#"))for(;_.path.length>1&&_.path[0]==="";)bH(_.path);a=="?"?(_.query="",S=Yp):a=="#"&&(_.fragment="",S=tu)}else A+=Ph(a,gx);break;case Rx:a=="?"?(_.query="",S=Yp):a=="#"?(_.fragment="",S=tu):a!=Wo&&(_.path[0]+=Ph(a,mb));break;case Yp:t||a!="#"?a!=Wo&&(a=="'"&&_.isSpecial()?_.query+="%27":_.query+=a=="#"?"%23":Ph(a,mb)):(_.fragment="",S=tu);break;case tu:a!=Wo&&(_.fragment+=Ph(a,mx))}b++}},parseHost:function(e){var t,n,s;if($o(e,0)=="["){if($o(e,e.length-1)!="]"||(t=function(a){var l,f,m,_,S,b,A,O=[0,0,0,0,0,0,0,0],D=0,G=null,B=0,j=function(){return $o(a,B)};if(j()==":"){if($o(a,1)!=":")return;B+=2,G=++D}for(;j();){if(D==8)return;if(j()!=":"){for(l=f=0;f<4&&Hc(px,j());)l=16*l+fb(j(),16),B++,f++;if(j()=="."){if(f==0||(B-=f,D>6))return;for(m=0;j();){if(_=null,m>0){if(!(j()=="."&&m<4))return;B++}if(!Hc(wI,j()))return;for(;Hc(wI,j());){if(S=fb(j(),10),_===null)_=S;else{if(_==0)return;_=10*_+S}if(_>255)return;B++}O[D]=256*O[D]+_,++m!=2&&m!=4||D++}if(m!=4)return;break}if(j()==":"){if(B++,!j())return}else if(j())return;O[D++]=l}else{if(G!==null)return;B++,G=++D}}if(G!==null)for(b=D-G,D=7;D!=0&&b>0;)A=O[D],O[D--]=O[G+b-1],O[G+--b]=A;else if(D!=8)return;return O}(VS(e,1,-1)),!t))return Wp;this.host=t}else if(this.isSpecial()){if(e=pH(e),Hc(DH,e)||(t=function(a){var l,f,m,_,S,b,A,O=RH(a,".");if(O.length&&O[O.length-1]==""&&O.length--,(l=O.length)>4)return a;for(f=[],m=0;m<l;m++){if((_=O[m])=="")return a;if(S=10,_.length>1&&$o(_,0)=="0"&&(S=Hc(IH,_)?16:8,_=VS(_,S==8?1:2)),_==="")b=0;else{if(!Hc(S==10?OH:S==8?wH:px,_))return a;b=fb(_,S)}AE(f,b)}for(m=0;m<l;m++)if(b=f[m],m==l-1){if(b>=ux(256,5-l))return null}else if(b>255)return null;for(A=vH(f),m=0;m<f.length;m++)A+=f[m]*ux(256,3-m);return A}(e),t===null))return Wp;this.host=t}else{if(Hc(NH,e))return Wp;for(t="",n=RE(e),s=0;s<n.length;s++)t+=Ph(n[s],mb);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return bI(gb,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&GS(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,s=e.password,a=e.host,l=e.port,f=e.path,m=e.query,_=e.fragment,S=t+":";return a!==null?(S+="//",e.includesCredentials()&&(S+=n+(s?":"+s:"")+"@"),S+=jS(a),l!==null&&(S+=":"+l)):t=="file"&&(S+="//"),S+=e.cannotBeABaseURL?f[0]:f.length?"/"+BS(f,"/"):"",m!==null&&(S+="?"+m),_!==null&&(S+="#"+_),S},setHref:function(e){var t=this.parse(e);if(t)throw AI(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new IE(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+jS(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(eu(e)+":",DI)},getUsername:function(){return this.username},setUsername:function(e){var t=RE(eu(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Ph(t[n],OI)}},getPassword:function(){return this.password},setPassword:function(e){var t=RE(eu(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Ph(t[n],OI)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?jS(e):jS(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,xI)},getHostname:function(){var e=this.host;return e===null?"":jS(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,PI)},getPort:function(){var e=this.port;return e===null?"":eu(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=eu(e))==""?this.port=null:this.parse(e,kI))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+BS(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,CE))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=eu(e))==""?this.query=null:($o(e,0)=="?"&&(e=VS(e,1)),this.query="",this.parse(e,Yp)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=eu(e))!=""?($o(e,0)=="#"&&(e=VS(e,1)),this.fragment="",this.parse(e,tu)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var IE=function(e){var t=hH(this,ma),n=gH(arguments.length,1)>1?arguments[1]:void 0,s=EH(t,new FI(e,!1,n));TI||(t.href=s.serialize(),t.origin=s.getOrigin(),t.protocol=s.getProtocol(),t.username=s.getUsername(),t.password=s.getPassword(),t.host=s.getHost(),t.hostname=s.getHostname(),t.port=s.getPort(),t.pathname=s.getPathname(),t.search=s.getSearch(),t.searchParams=s.getSearchParams(),t.hash=s.getHash())},ma=IE.prototype,zo=function(e,t){return{get:function(){return hb(this)[e]()},set:t&&function(n){return hb(this)[t](n)},configurable:!0,enumerable:!0}};if(TI&&(qo(ma,"href",zo("serialize","setHref")),qo(ma,"origin",zo("getOrigin")),qo(ma,"protocol",zo("getProtocol","setProtocol")),qo(ma,"username",zo("getUsername","setUsername")),qo(ma,"password",zo("getPassword","setPassword")),qo(ma,"host",zo("getHost","setHost")),qo(ma,"hostname",zo("getHostname","setHostname")),qo(ma,"port",zo("getPort","setPort")),qo(ma,"pathname",zo("getPathname","setPathname")),qo(ma,"search",zo("getSearch","setSearch")),qo(ma,"searchParams",zo("getSearchParams")),qo(ma,"hash",zo("getHash","setHash"))),ub(ma,"toJSON",function(){return hb(this).serialize()},{enumerable:!0}),ub(ma,"toString",function(){return hb(this).serialize()},{enumerable:!0}),FS){var Ax=FS.createObjectURL,Cx=FS.revokeObjectURL;Ax&&ub(IE,"createObjectURL",cx(Ax,FS)),Cx&&ub(IE,"revokeObjectURL",cx(Cx,FS))}mH(IE,"URL"),dH({global:!0,forced:!uH,sham:!TI},{URL:IE});var MH=fn,UH=p,FH=Vo,Ix=Qs,BH=Zd,wx=Nn("URL");MH({target:"URL",stat:!0,forced:!(BH&&UH(function(){wx.canParse()}))},{canParse:function(e){var t=FH(arguments.length,1),n=Ix(e),s=t<2||arguments[1]===void 0?void 0:Ix(arguments[1]);try{return!!new wx(n,s)}catch{return!1}}});var Sb=d(Ot.URL);let Ox=!0,Dx=!0;function yb(e,t,n){const s=e.match(t);return s&&s.length>=n&&parseInt(s[n],10)}function qp(e,t,n){if(!e.RTCPeerConnection)return;const s=e.RTCPeerConnection.prototype,a=s.addEventListener;s.addEventListener=function(f,m){if(f!==t)return a.apply(this,arguments);const _=S=>{const b=n(S);b&&(m.handleEvent?m.handleEvent(b):m(b))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(m,_),a.apply(this,[f,_])};const l=s.removeEventListener;s.removeEventListener=function(f,m){if(f!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(m))return l.apply(this,arguments);const _=this._eventMap[t].get(m);return this._eventMap[t].delete(m),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[f,_])},Object.defineProperty(s,"on"+t,{get(){return this["_on"+t]},set(f){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),f&&this.addEventListener(t,this["_on"+t]=f)},enumerable:!0,configurable:!0})}function VH(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Ox=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function jH(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Dx=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Nx(){if(typeof window=="object"){if(Ox)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function BI(e,t){Dx&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Lx(e){return Object.prototype.toString.call(e)==="[object Object]"}function xx(e){var t;return Lx(e)?jr(t=Object.keys(e)).call(t,function(n,s){const a=Lx(e[s]),l=a?xx(e[s]):e[s],f=a&&!Object.keys(l).length;return l===void 0||f?n:Object.assign(n,{[s]:l})},{}):e}function VI(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(s=>{s.endsWith("Id")?VI(e,e.get(t[s]),n):s.endsWith("Ids")&&t[s].forEach(a=>{VI(e,e.get(a),n)})}))}function Px(e,t,n){const s=n?"outbound-rtp":"inbound-rtp",a=new Map;if(t===null)return a;const l=[];return e.forEach(f=>{f.type==="track"&&f.trackIdentifier===t.id&&l.push(f)}),l.forEach(f=>{e.forEach(m=>{m.type===s&&m.trackId===f.id&&VI(e,m,a)})}),a}const kx=Nx;function Mx(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const s=function(f){if(typeof f!="object"||f.mandatory||f.optional)return f;const m={};return Object.keys(f).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const S=typeof f[_]=="object"?f[_]:{ideal:f[_]};S.exact!==void 0&&typeof S.exact=="number"&&(S.min=S.max=S.exact);const b=function(A,O){return A?A+O.charAt(0).toUpperCase()+O.slice(1):O==="deviceId"?"sourceId":O};if(S.ideal!==void 0){m.optional=m.optional||[];let A={};typeof S.ideal=="number"?(A[b("min",_)]=S.ideal,m.optional.push(A),A={},A[b("max",_)]=S.ideal,m.optional.push(A)):(A[b("",_)]=S.ideal,m.optional.push(A))}S.exact!==void 0&&typeof S.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[b("",_)]=S.exact):["min","max"].forEach(A=>{S[A]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[b(A,_)]=S[A])})}),f.advanced&&(m.optional=(m.optional||[]).concat(f.advanced)),m},a=function(f,m){if(t.version>=61)return m(f);if((f=JSON.parse(JSON.stringify(f)))&&typeof f.audio=="object"){const _=function(S,b,A){b in S&&!(A in S)&&(S[A]=S[b],delete S[b])};_((f=JSON.parse(JSON.stringify(f))).audio,"autoGainControl","googAutoGainControl"),_(f.audio,"noiseSuppression","googNoiseSuppression"),f.audio=s(f.audio)}if(f&&typeof f.video=="object"){let _=f.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const S=t.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||S)){let b;if(delete f.video.facingMode,_.exact==="environment"||_.ideal==="environment"?b=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(b=["front"]),b)return n.mediaDevices.enumerateDevices().then(A=>{let O=(A=A.filter(D=>D.kind==="videoinput")).find(D=>b.some(G=>{var B;return We(B=D.label.toLowerCase()).call(B,G)}));return!O&&A.length&&We(b).call(b,"back")&&(O=A[A.length-1]),O&&(f.video.deviceId=_.exact?{exact:O.deviceId}:{ideal:O.deviceId}),f.video=s(f.video),kx("chrome: "+JSON.stringify(f)),m(f)})}f.video=s(f.video)}return kx("chrome: "+JSON.stringify(f)),m(f)},l=function(f){return t.version>=64?f:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[f.name]||f.name,message:f.message,constraint:f.constraint||f.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(f,m,_){a(f,S=>{n.webkitGetUserMedia(S,m,b=>{_&&_(l(b))})})}).bind(n),n.mediaDevices.getUserMedia){const f=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(m){return a(m,_=>f(_).then(S=>{if(_.audio&&!S.getAudioTracks().length||_.video&&!S.getVideoTracks().length)throw S.getTracks().forEach(b=>{b.stop()}),new DOMException("","NotFoundError");return S},S=>Ye.reject(l(S))))}}}function Ux(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Fx(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",s=>{let a;a=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(f=>f.track&&f.track.id===s.track.id):{track:s.track};const l=new Event("track");l.track=s.track,l.receiver=a,l.transceiver={receiver:a},l.streams=[n.stream],this.dispatchEvent(l)}),n.stream.getTracks().forEach(s=>{let a;a=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(f=>f.track&&f.track.id===s.id):{track:s};const l=new Event("track");l.track=s,l.receiver=a,l.transceiver={receiver:a},l.streams=[n.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else qp(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Bx(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(a,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=a.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:a}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(f,m){let _=a.apply(this,arguments);return _||(_=t(this,f),this._senders.push(_)),_};const l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(f){l.apply(this,arguments);const m=this._senders.indexOf(f);m!==-1&&this._senders.splice(m,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],n.apply(this,[a]),a.getTracks().forEach(l=>{this._senders.push(t(this,l))})};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],s.apply(this,[a]),a.getTracks().forEach(l=>{const f=this._senders.find(m=>m.track===l);f&&this._senders.splice(this._senders.indexOf(f),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(s=>s._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Vx(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,s,a]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const l=function(m){const _={};return m.result().forEach(S=>{const b={id:S.id,timestamp:S.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[S.type]||S.type};S.names().forEach(A=>{b[A]=S.stat(A)}),_[b.id]=b}),_},f=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){s(f(l(_)))};return t.apply(this,[m,n])}return new Ye((m,_)=>{t.apply(this,[function(S){m(f(l(S)))},_])}).then(s,a)}}function jx(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const a=n.apply(this,[]);return a.forEach(l=>l._pc=this),a});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const a=s.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){const a=this;return this._pc.getStats().then(l=>Px(l,a.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(a=>a._pc=this),s}),qp(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>Px(a,s.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let s,a,l;return this.getSenders().forEach(f=>{f.track===n&&(s?l=!0:s=f)}),this.getReceivers().forEach(f=>(f.track===n&&(a?l=!0:a=f),f.track===n)),l||s&&a?Ye.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():a?a.getStats():Ye.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Gx(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,f){if(!f)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=t.apply(this,arguments);return this._shimmedLocalStreams[f.id]?this._shimmedLocalStreams[f.id].indexOf(m)===-1&&this._shimmedLocalStreams[f.id].push(m):this._shimmedLocalStreams[f.id]=[f,m],m};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(_=>{if(this.getSenders().find(b=>b.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const f=this.getSenders();n.apply(this,arguments);const m=this.getSenders().filter(_=>f.indexOf(_)===-1);this._shimmedLocalStreams[l.id]=[l].concat(m)};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],s.apply(this,arguments)};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(f=>{const m=this._shimmedLocalStreams[f].indexOf(l);m!==-1&&this._shimmedLocalStreams[f].splice(m,1),this._shimmedLocalStreams[f].length===1&&delete this._shimmedLocalStreams[f]}),a.apply(this,arguments)}}function Hx(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Gx(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=n.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(S=>this._reverseStreams[S.id])};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(S=>{if(this.getSenders().find(A=>A.track===S))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const S=new e.MediaStream(_.getTracks());this._streams[_.id]=S,this._reverseStreams[S.id]=_,_=S}s.apply(this,[_])};const a=e.RTCPeerConnection.prototype.removeStream;function l(_,S){let b=S.sdp;return Object.keys(_._reverseStreams||[]).forEach(A=>{const O=_._reverseStreams[A],D=_._streams[O.id];b=b.replace(new RegExp(D.id,"g"),O.id)}),new RTCSessionDescription({type:S.type,sdp:b})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,S){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(D=>D===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(D=>D.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const O=this._streams[S.id];if(O)O.addTrack(_),Ye.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const D=new e.MediaStream([_]);this._streams[S.id]=D,this._reverseStreams[D.id]=S,this.addStream(D)}return this.getSenders().find(D=>D.track===_)},["createOffer","createAnswer"].forEach(function(_){const S=e.RTCPeerConnection.prototype[_],b={[_](){const A=arguments;return arguments.length&&typeof arguments[0]=="function"?S.apply(this,[O=>{const D=l(this,O);A[0].apply(null,[D])},O=>{A[1]&&A[1].apply(null,O)},arguments[2]]):S.apply(this,arguments).then(O=>l(this,O))}};e.RTCPeerConnection.prototype[_]=b[_]});const f=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,S){let b=S.sdp;return Object.keys(_._reverseStreams||[]).forEach(A=>{const O=_._reverseStreams[A],D=_._streams[O.id];b=b.replace(new RegExp(O.id,"g"),D.id)}),new RTCSessionDescription({type:S.type,sdp:b})}(this,arguments[0]),f.apply(this,arguments)):f.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:l(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let S;this._streams=this._streams||{},Object.keys(this._streams).forEach(b=>{this._streams[b].getTracks().find(A=>_.track===A)&&(S=this._streams[b])}),S&&(S.getTracks().length===1?this.removeStream(this._reverseStreams[S.id]):S.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function jI(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const s=e.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=a[n]})}function Kx(e,t){qp(e,"negotiationneeded",n=>{const s=n.target;if(!(t.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")||s.signalingState==="stable")return n})}var Wx=Object.freeze({__proto__:null,fixNegotiationNeeded:Kx,shimAddTrackRemoveTrack:Hx,shimAddTrackRemoveTrackWithNative:Gx,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(s=>{const a=n.video&&n.video.width,l=n.video&&n.video.height,f=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:f||3}},a&&(n.video.mandatory.maxWidth=a),l&&(n.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Bx,shimGetStats:Vx,shimGetUserMedia:Mx,shimMediaStream:Ux,shimOnTrack:Fx,shimPeerConnection:jI,shimSenderReceiverGetStats:jx});function Yx(e,t){const n=e&&e.navigator,s=e&&e.MediaStreamTrack;if(n.getUserMedia=function(a,l,f){BI("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(a).then(l,f)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const a=function(f,m,_){m in f&&!(_ in f)&&(f[_]=f[m],delete f[m])},l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(f){return typeof f=="object"&&typeof f.audio=="object"&&(f=JSON.parse(JSON.stringify(f)),a(f.audio,"autoGainControl","mozAutoGainControl"),a(f.audio,"noiseSuppression","mozNoiseSuppression")),l(f)},s&&s.prototype.getSettings){const f=s.prototype.getSettings;s.prototype.getSettings=function(){const m=f.apply(this,arguments);return a(m,"mozAutoGainControl","autoGainControl"),a(m,"mozNoiseSuppression","noiseSuppression"),m}}if(s&&s.prototype.applyConstraints){const f=s.prototype.applyConstraints;s.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),a(m,"autoGainControl","mozAutoGainControl"),a(m,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[m])}}}}function qx(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function GI(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const l=e.RTCPeerConnection.prototype[a],f={[a](){return arguments[0]=new(a==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};e.RTCPeerConnection.prototype[a]=f[a]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[a,l,f]=arguments;return s.apply(this,[a||null]).then(m=>{if(t.version<53&&!l)try{m.forEach(_=>{_.type=n[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((S,b)=>{m.set(b,Object.assign({},S,{type:n[S.type]||S.type}))})}return m}).then(l,f)}}function $x(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(a=>a._pc=this),s});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Ye.resolve(new Map)}}function zx(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(s=>s._pc=this),n}),qp(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Xx(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){BI("removeStream","removeTrack"),this.getSenders().forEach(n=>{var s;n.track&&We(s=t.getTracks()).call(s,n.track)&&this.removeTrack(n)})})}function Jx(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Qx(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const s=n.length>0;s&&n.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const a=t.apply(this,arguments);if(s){const{sender:l}=a,f=l.getParameters();(!("encodings"in f)||f.encodings.length===1&&Object.keys(f.encodings[0]).length===0)&&(f.encodings=n,l.sendEncodings=n,this.setParametersPromises.push(l.setParameters(f).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return a})}function Zx(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function eP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ye.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function tP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ye.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var nP=Object.freeze({__proto__:null,shimAddTransceiver:Qx,shimCreateAnswer:tP,shimCreateOffer:eP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Ye.reject(s)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Zx,shimGetUserMedia:Yx,shimOnTrack:qx,shimPeerConnection:GI,shimRTCDataChannel:Jx,shimReceiverGetStats:zx,shimRemoveStream:Xx,shimSenderGetStats:$x});function iP(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var s;this._localStreams||(this._localStreams=[]),We(s=this._localStreams).call(s,n)||this._localStreams.push(n),n.getAudioTracks().forEach(a=>t.call(this,a,n)),n.getVideoTracks().forEach(a=>t.call(this,a,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var s=arguments.length,a=new Array(s>1?s-1:0),l=1;l<s;l++)a[l-1]=arguments[l];return a&&a.forEach(f=>{var m;this._localStreams?We(m=this._localStreams).call(m,f)||this._localStreams.push(f):this._localStreams=[f]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const s=t.getTracks();this.getSenders().forEach(a=>{We(s).call(s,a.track)&&this.removeTrack(a)})})}}function sP(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(a=>{var l;if(this._remoteStreams||(this._remoteStreams=[]),We(l=this._remoteStreams).call(l,a))return;this._remoteStreams.push(a);const f=new Event("addstream");f.stream=a,this.dispatchEvent(f)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(a=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(a)>=0)return;n._remoteStreams.push(a);const l=new Event("addstream");l.stream=a,n.dispatchEvent(l)})}),t.apply(n,arguments)}}}function rP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,s=t.createAnswer,a=t.setLocalDescription,l=t.setRemoteDescription,f=t.addIceCandidate;t.createOffer=function(_,S){const b=arguments.length>=2?arguments[2]:arguments[0],A=n.apply(this,[b]);return S?(A.then(_,S),Ye.resolve()):A},t.createAnswer=function(_,S){const b=arguments.length>=2?arguments[2]:arguments[0],A=s.apply(this,[b]);return S?(A.then(_,S),Ye.resolve()):A};let m=function(_,S,b){const A=a.apply(this,[_]);return b?(A.then(S,b),Ye.resolve()):A};t.setLocalDescription=m,m=function(_,S,b){const A=l.apply(this,[_]);return b?(A.then(S,b),Ye.resolve()):A},t.setRemoteDescription=m,m=function(_,S,b){const A=f.apply(this,[_]);return b?(A.then(S,b),Ye.resolve()):A},t.addIceCandidate=m}function aP(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,s=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=a=>s(oP(a))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,s,a){t.mediaDevices.getUserMedia(n).then(s,a)}).bind(t))}function oP(e){return e&&e.video!==void 0?Object.assign({},e,{video:xx(e.video)}):e}function cP(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,s){if(n&&n.iceServers){const a=[];for(let l=0;l<n.iceServers.length;l++){let f=n.iceServers[l];!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(BI("RTCIceServer.url","RTCIceServer.urls"),f=JSON.parse(JSON.stringify(f)),f.urls=f.url,delete f.url,a.push(f)):a.push(n.iceServers[l])}n.iceServers=a}return new t(n,s)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function lP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dP(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const s=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):n.offerToReceiveAudio!==!0||s||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const a=this.getTransceivers().find(l=>l.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveVideo!==!0||a||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function uP(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var hP=Object.freeze({__proto__:null,shimAudioContext:uP,shimCallbacksAPI:rP,shimConstraints:oP,shimCreateOfferLegacy:dP,shimGetUserMedia:aP,shimLocalStreamsAPI:iP,shimRTCIceServerUrls:cP,shimRemoteStreamsAPI:sP,shimTrackEventTransceiver:lP}),fP=`	
\v\f\r \u2028\u2029\uFEFF`,GH=Ws,HH=Qs,HI=fP,pP=I("".replace),KH=RegExp("^["+HI+"]+"),WH=RegExp("(^|[^"+HI+"])["+HI+"]+$"),YH=function(e){return function(t){var n=HH(GH(t));return 1&e&&(n=pP(n,KH,"")),2&e&&(n=pP(n,WH,"$1")),n}},qH={trim:YH(3)},$H=js.PROPER,zH=p,mP=fP,XH=qH.trim;fn({target:"String",proto:!0,forced:function(e){return zH(function(){return!!mP[e]()||""[e]()!==""||$H&&mP[e].name!==e})}("trim")},{trim:function(){return XH(this)}});var JH=Bs("String").trim,QH=L,ZH=JH,KI=String.prototype,e8=function(e){var t=e.trim;return typeof e=="string"||e===KI||QH(KI,e)&&t===KI.trim?ZH:t},nr=d(e8),gP={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(s=>s.trim())},t.splitSections=function(n){return n.split(`
m=`).map((s,a)=>(a>0?"m="+s:s).trim()+`\r
`)},t.getDescription=function(n){const s=t.splitSections(n);return s&&s[0]},t.getMediaSections=function(n){const s=t.splitSections(n);return s.shift(),s},t.matchPrefix=function(n,s){return t.splitLines(n).filter(a=>a.indexOf(s)===0)},t.parseCandidate=function(n){let s;s=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const a={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let l=8;l<s.length;l+=2)switch(s[l]){case"raddr":a.relatedAddress=s[l+1];break;case"rport":a.relatedPort=parseInt(s[l+1],10);break;case"tcptype":a.tcpType=s[l+1];break;case"ufrag":a.ufrag=s[l+1],a.usernameFragment=s[l+1];break;default:a[s[l]]===void 0&&(a[s[l]]=s[l+1])}return a},t.writeCandidate=function(n){const s=[];s.push(n.foundation);const a=n.component;a==="rtp"?s.push(1):a==="rtcp"?s.push(2):s.push(a),s.push(n.protocol.toUpperCase()),s.push(n.priority),s.push(n.address||n.ip),s.push(n.port);const l=n.type;return s.push("typ"),s.push(l),l!=="host"&&n.relatedAddress&&n.relatedPort&&(s.push("raddr"),s.push(n.relatedAddress),s.push("rport"),s.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(s.push("ufrag"),s.push(n.usernameFragment||n.ufrag)),"candidate:"+s.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let s=n.substring(9).split(" ");const a={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),a.name=s[0],a.clockRate=parseInt(s[1],10),a.channels=s.length===3?parseInt(s[2],10):1,a.numChannels=a.channels,a},t.writeRtpMap=function(n){let s=n.payloadType;n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType);const a=n.channels||n.numChannels||1;return"a=rtpmap:"+s+" "+n.name+"/"+n.clockRate+(a!==1?"/"+a:"")+`\r
`},t.parseExtmap=function(n){const s=n.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const s={};let a;const l=n.substring(n.indexOf(" ")+1).split(";");for(let f=0;f<l.length;f++)a=l[f].trim().split("="),s[a[0].trim()]=a[1];return s},t.writeFmtp=function(n){let s="",a=n.payloadType;if(n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const l=[];Object.keys(n.parameters).forEach(f=>{n.parameters[f]!==void 0?l.push(f+"="+n.parameters[f]):l.push(f)}),s+="a=fmtp:"+a+" "+l.join(";")+`\r
`}return s},t.parseRtcpFb=function(n){const s=n.substring(n.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},t.writeRtcpFb=function(n){let s="",a=n.payloadType;return n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(l=>{s+="a=rtcp-fb:"+a+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),s},t.parseSsrcMedia=function(n){const s=n.indexOf(" "),a={ssrc:parseInt(n.substring(7,s),10)},l=n.indexOf(":",s);return l>-1?(a.attribute=n.substring(s+1,l),a.value=n.substring(l+1)):a.attribute=n.substring(s+1),a},t.parseSsrcGroup=function(n){const s=n.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(a=>parseInt(a,10))}},t.getMid=function(n){const s=t.matchPrefix(n,"a=mid:")[0];if(s)return s.substring(6)},t.parseFingerprint=function(n){const s=n.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},t.getDtlsParameters=function(n,s){return{role:"auto",fingerprints:t.matchPrefix(n+s,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,s){let a="a=setup:"+s+`\r
`;return n.fingerprints.forEach(l=>{a+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),a},t.parseCryptoLine=function(n){const s=n.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const s=n.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,s){return t.matchPrefix(n+s,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,s){const a=t.matchPrefix(n+s,"a=ice-ufrag:")[0],l=t.matchPrefix(n+s,"a=ice-pwd:")[0];return a&&l?{usernameFragment:a.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(n){let s="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(s+=`a=ice-lite\r
`),s},t.parseRtpParameters=function(n){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=t.splitLines(n)[0].split(" ");s.profile=a[2];for(let f=3;f<a.length;f++){const m=a[f],_=t.matchPrefix(n,"a=rtpmap:"+m+" ")[0];if(_){const S=t.parseRtpMap(_),b=t.matchPrefix(n,"a=fmtp:"+m+" ");switch(S.parameters=b.length?t.parseFmtp(b[0]):{},S.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+m+" ").map(t.parseRtcpFb),s.codecs.push(S),S.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(S.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(f=>{s.headerExtensions.push(t.parseExtmap(f))});const l=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return s.codecs.forEach(f=>{l.forEach(m=>{f.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||f.rtcpFeedback.push(m)})}),s},t.writeRtpDescription=function(n,s){let a="";a+="m="+n+" ",a+=s.codecs.length>0?"9":"0",a+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=s.codecs.map(f=>f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(f=>{a+=t.writeRtpMap(f),a+=t.writeFmtp(f),a+=t.writeRtcpFb(f)});let l=0;return s.codecs.forEach(f=>{f.maxptime>l&&(l=f.maxptime)}),l>0&&(a+="a=maxptime:"+l+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(f=>{a+=t.writeExtmap(f)}),a},t.parseRtpEncodingParameters=function(n){const s=[],a=t.parseRtpParameters(n),l=a.fecMechanisms.indexOf("RED")!==-1,f=a.fecMechanisms.indexOf("ULPFEC")!==-1,m=t.matchPrefix(n,"a=ssrc:").map(O=>t.parseSsrcMedia(O)).filter(O=>O.attribute==="cname"),_=m.length>0&&m[0].ssrc;let S;const b=t.matchPrefix(n,"a=ssrc-group:FID").map(O=>O.substring(17).split(" ").map(D=>parseInt(D,10)));b.length>0&&b[0].length>1&&b[0][0]===_&&(S=b[0][1]),a.codecs.forEach(O=>{if(O.name.toUpperCase()==="RTX"&&O.parameters.apt){let D={ssrc:_,codecPayloadType:parseInt(O.parameters.apt,10)};_&&S&&(D.rtx={ssrc:S}),s.push(D),l&&(D=JSON.parse(JSON.stringify(D)),D.fec={ssrc:_,mechanism:f?"red+ulpfec":"red"},s.push(D))}}),s.length===0&&_&&s.push({ssrc:_});let A=t.matchPrefix(n,"b=");return A.length&&(A=A[0].indexOf("b=TIAS:")===0?parseInt(A[0].substring(7),10):A[0].indexOf("b=AS:")===0?1e3*parseInt(A[0].substring(5),10)*.95-16e3:void 0,s.forEach(O=>{O.maxBitrate=A})),s},t.parseRtcpParameters=function(n){const s={},a=t.matchPrefix(n,"a=ssrc:").map(m=>t.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];a&&(s.cname=a.value,s.ssrc=a.ssrc);const l=t.matchPrefix(n,"a=rtcp-rsize");s.reducedSize=l.length>0,s.compound=l.length===0;const f=t.matchPrefix(n,"a=rtcp-mux");return s.mux=f.length>0,s},t.writeRtcpParameters=function(n){let s="";return n.reducedSize&&(s+=`a=rtcp-rsize\r
`),n.mux&&(s+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(s+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),s},t.parseMsid=function(n){let s;const a=t.matchPrefix(n,"a=msid:");if(a.length===1)return s=a[0].substring(7).split(" "),{stream:s[0],track:s[1]};const l=t.matchPrefix(n,"a=ssrc:").map(f=>t.parseSsrcMedia(f)).filter(f=>f.attribute==="msid");return l.length>0?(s=l[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},t.parseSctpDescription=function(n){const s=t.parseMLine(n),a=t.matchPrefix(n,"a=max-message-size:");let l;a.length>0&&(l=parseInt(a[0].substring(19),10)),isNaN(l)&&(l=65536);const f=t.matchPrefix(n,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substring(12),10),protocol:s.fmt,maxMessageSize:l};const m=t.matchPrefix(n,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:l}}},t.writeSctpDescription=function(n,s){let a=[];return a=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&a.push("a=max-message-size:"+s.maxMessageSize+`\r
`),a.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,s,a){let l;const f=s!==void 0?s:2;return l=n||t.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+l+" "+f+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,s){const a=t.splitLines(n);for(let l=0;l<a.length;l++)switch(a[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[l].substring(2)}return s?t.getDirection(s):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const s=t.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},t.parseOLine=function(n){const s=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const s=t.splitLines(n);for(let a=0;a<s.length;a++)if(s[a].length<2||s[a].charAt(1)!=="=")return!1;return!0},e.exports=t})(gP);var EP=gP.exports,wE=d(EP),t8=r({__proto__:null,default:wE},[EP]);function Tb(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const s=new t(n),a=wE.parseCandidate(n.candidate),l=Object.assign(s,a);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,qp(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function WI(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||qp(e,"icecandidate",t=>{if(t.candidate){const n=wE.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function vb(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(m){if(!m||!m.sdp)return!1;const _=wE.splitSections(m.sdp);return _.shift(),_.some(S=>{const b=wE.parseMLine(S);return b&&b.kind==="application"&&b.protocol.indexOf("SCTP")!==-1})},s=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const S=parseInt(_[1],10);return S!=S?-1:S},a=function(m){let _=65536;return t.browser==="firefox"&&(_=t.version<57?m===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),_},l=function(m,_){let S=65536;t.browser==="firefox"&&t.version===57&&(S=65535);const b=wE.matchPrefix(m.sdp,"a=max-message-size:");return b.length>0?S=parseInt(b[0].substr(19),10):t.browser==="firefox"&&_!==-1&&(S=2147483637),S},f=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const m=s(arguments[0]),_=a(m),S=l(arguments[0],m);let b;b=_===0&&S===0?Number.POSITIVE_INFINITY:_===0||S===0?Math.max(_,S):Math.min(_,S);const A={};Object.defineProperty(A,"maxMessageSize",{get:()=>b}),this._sctp=A}return f.apply(this,arguments)}}function bb(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(s,a){const l=s.send;s.send=function(){const f=arguments[0],m=f.length||f.size||f.byteLength;if(s.readyState==="open"&&a.sctp&&m>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return l.apply(s,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return t(s,this),s},qp(e,"datachannel",s=>(t(s.channel,s.target),s))}function YI(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const s=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const l=a.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const f=new Event("connectionstatechange",a);l.dispatchEvent(f)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function qI(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const a=s.sdp.split(`
`).filter(l=>nr(l).call(l)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&s instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:s.type,sdp:a}):s.sdp=a}return n.apply(this,arguments)}}function Rb(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Ye.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ye.resolve())})}function Ab(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var n8=Object.freeze({__proto__:null,removeExtmapAllowMixed:qI,shimAddIceCandidateNullOrEmpty:Rb,shimConnectionState:YI,shimMaxMessageSize:vb,shimParameterlessSetLocalDescription:Ab,shimRTCIceCandidate:Tb,shimRTCIceCandidateRelayProtocol:WI,shimSendThrowTypeError:bb});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Nx,s=function(l){const f={browser:null,version:null};if(l===void 0||!l.navigator)return f.browser="Not a browser.",f;const{navigator:m}=l;if(m.mozGetUserMedia)f.browser="firefox",f.version=yb(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||l.isSecureContext===!1&&l.webkitRTCPeerConnection)f.browser="chrome",f.version=yb(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return f.browser="Not a supported browser.",f;f.browser="safari",f.version=yb(m.userAgent,/AppleWebKit\/(\d+)\./,1),f.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return f}(e),a={browserDetails:s,commonShim:n8,extractVersion:yb,disableLog:VH,disableWarnings:jH,sdp:t8};switch(s.browser){case"chrome":if(!Wx||!jI||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),a;if(s.version===null)return n("Chrome shim can not determine version, not shimming."),a;n("adapter.js shimming chrome."),a.browserShim=Wx,Rb(e,s),Ab(e),Mx(e,s),Ux(e),jI(e,s),Fx(e),Hx(e,s),Bx(e),Vx(e),jx(e),Kx(e,s),Tb(e),WI(e),YI(e),vb(e,s),bb(e),qI(e,s);break;case"firefox":if(!nP||!GI||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),a;n("adapter.js shimming firefox."),a.browserShim=nP,Rb(e,s),Ab(e),Yx(e,s),GI(e,s),qx(e),Xx(e),$x(e),zx(e),Jx(e),Qx(e),Zx(e),eP(e),tP(e),Tb(e),YI(e),vb(e,s),bb(e);break;case"safari":if(!hP||!t.shimSafari)return n("Safari shim is not included in this adapter release."),a;n("adapter.js shimming safari."),a.browserShim=hP,Rb(e,s),Ab(e),cP(e),dP(e),rP(e),iP(e),sP(e),lP(e),aP(e),uP(e),Tb(e),WI(e),vb(e,s),bb(e),qI(e,s);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var _P=qa,i8=TypeError,SP=hi.match(/firefox\/(\d+)/i),s8=!!SP&&+SP[1],r8=/MSIE|Trident/.test(hi),yP=hi.match(/AppleWebKit\/(\d+)\./),a8=!!yP&&+yP[1],o8=fn,TP=I,c8=Ir,l8=Ns,vP=va,d8=function(e,t){if(!delete e[t])throw i8("Cannot delete property "+_P(t)+" of "+_P(e))},bP=Qs,$I=p,u8=E,h8=Xa,RP=s8,f8=r8,AP=To,CP=a8,kh=[],IP=TP(kh.sort),p8=TP(kh.push),m8=$I(function(){kh.sort(void 0)}),g8=$I(function(){kh.sort(null)}),E8=h8("sort"),wP=!$I(function(){if(AP)return AP<70;if(!(RP&&RP>3)){if(f8)return!0;if(CP)return CP<603;var e,t,n,s,a="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(s=0;s<47;s++)kh.push({k:t+s,v:n})}for(kh.sort(function(l,f){return f.v-l.v}),s=0;s<kh.length;s++)t=kh[s].k.charAt(0),a.charAt(a.length-1)!==t&&(a+=t);return a!=="DGBEFHACIJK"}});o8({target:"Array",proto:!0,forced:m8||!g8||!E8||!wP},{sort:function(e){e!==void 0&&c8(e);var t=l8(this);if(wP)return e===void 0?IP(t):IP(t,e);var n,s,a=[],l=vP(t);for(s=0;s<l;s++)s in t&&p8(a,t[s]);for(u8(a,function(f){return function(m,_){return _===void 0?-1:m===void 0?1:f!==void 0?+f(m,_)||0:bP(m)>bP(_)?1:-1}}(e)),n=vP(a),s=0;s<n;)t[s]=a[s++];for(;s<l;)d8(t,s++);return t}});var _8=Bs("Array").sort,S8=L,y8=_8,zI=Array.prototype,T8=function(e){var t=e.sort;return e===zI||S8(zI,e)&&t===zI.sort?y8:t},HS=d(T8),XI=x;fn({global:!0,forced:XI.globalThis!==XI},{globalThis:XI});var OP=d(x),JI={exports:{}};(function(e,t){(function(n,s){var a="function",l="undefined",f="object",m="string",_="major",S="model",b="name",A="type",O="vendor",D="version",G="architecture",B="console",j="mobile",Y="tablet",q="smarttv",ie="wearable",le="embedded",ue="Amazon",oe="Apple",ye="ASUS",Pe="BlackBerry",ze="Browser",nt="Chrome",$t="Firefox",zt="Google",Mn="Huawei",Ai="LG",pi="Microsoft",Fr="Motorola",Ie="Opera",je="Samsung",pt="Sharp",De="Sony",F="Xiaomi",te="Zebra",re="Facebook",Me="Chromium OS",Pt="Mac OS",Cn=function(ji){for(var ns={},qn=0;qn<ji.length;qn++)ns[ji[qn].toUpperCase()]=ji[qn];return ns},ts=function(ji,ns){return typeof ji===m&&Xr(ns).indexOf(Xr(ji))!==-1},Xr=function(ji){return ji.toLowerCase()},_u=function(ji,ns){if(typeof ji===m)return ji=ji.replace(/^\s\s*/,""),typeof ns===l?ji:ji.substring(0,350)},Rm=function(ji,ns){for(var qn,_a,cd,Ci,un,Jr,sf=0;sf<ns.length&&!un;){var il=ns[sf],n3=ns[sf+1];for(qn=_a=0;qn<il.length&&!un&&il[qn];)if(un=il[qn++].exec(ji))for(cd=0;cd<n3.length;cd++)Jr=un[++_a],typeof(Ci=n3[cd])===f&&Ci.length>0?Ci.length===2?typeof Ci[1]==a?this[Ci[0]]=Ci[1].call(this,Jr):this[Ci[0]]=Ci[1]:Ci.length===3?typeof Ci[1]!==a||Ci[1].exec&&Ci[1].test?this[Ci[0]]=Jr?Jr.replace(Ci[1],Ci[2]):s:this[Ci[0]]=Jr?Ci[1].call(this,Jr,Ci[2]):s:Ci.length===4&&(this[Ci[0]]=Jr?Ci[3].call(this,Jr.replace(Ci[1],Ci[2])):s):this[Ci]=Jr||s;sf+=2}},Yy=function(ji,ns){for(var qn in ns)if(typeof ns[qn]===f&&ns[qn].length>0){for(var _a=0;_a<ns[qn].length;_a++)if(ts(ns[qn][_a],ji))return qn==="?"?s:qn}else if(ts(ns[qn],ji))return qn==="?"?s:qn;return ji},vA={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},bA={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[D,[b,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[D,[b,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[b,D],[/opios[\/ ]+([\w\.]+)/i],[D,[b,Ie+" Mini"]],[/\bopr\/([\w\.]+)/i],[D,[b,Ie]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[b,D],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[D,[b,"UC"+ze]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[D,[b,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[D,[b,"WeChat"]],[/konqueror\/([\w\.]+)/i],[D,[b,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[D,[b,"IE"]],[/yabrowser\/([\w\.]+)/i],[D,[b,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[b,/(.+)/,"$1 Secure "+ze],D],[/\bfocus\/([\w\.]+)/i],[D,[b,$t+" Focus"]],[/\bopt\/([\w\.]+)/i],[D,[b,Ie+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[D,[b,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[D,[b,"Dolphin"]],[/coast\/([\w\.]+)/i],[D,[b,Ie+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[D,[b,"MIUI "+ze]],[/fxios\/([-\w\.]+)/i],[D,[b,$t]],[/\bqihu|(qi?ho?o?|360)browser/i],[[b,"360 "+ze]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[b,/(.+)/,"$1 "+ze],D],[/(comodo_dragon)\/([\w\.]+)/i],[[b,/_/g," "],D],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[b,D],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[b],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[b,re],D],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[b,D],[/\bgsa\/([\w\.]+) .*safari\//i],[D,[b,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[D,[b,nt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[b,nt+" WebView"],D],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[D,[b,"Android "+ze]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[b,D],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[D,[b,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[D,b],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[b,[D,Yy,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[b,D],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[b,"Netscape"],D],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[D,[b,$t+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[b,D],[/(cobalt)\/([\w\.]+)/i],[b,[D,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,Xr]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",Xr]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,Xr]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[S,[O,je],[A,Y]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[S,[O,je],[A,j]],[/\((ip(?:hone|od)[\w ]*);/i],[S,[O,oe],[A,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[S,[O,oe],[A,Y]],[/(macintosh);/i],[S,[O,oe]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[S,[O,pt],[A,j]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[S,[O,Mn],[A,Y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[S,[O,Mn],[A,j]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[S,/_/g," "],[O,F],[A,j]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[S,/_/g," "],[O,F],[A,Y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[S,[O,"OPPO"],[A,j]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[S,[O,"Vivo"],[A,j]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[S,[O,"Realme"],[A,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[S,[O,Fr],[A,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[S,[O,Fr],[A,Y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[S,[O,Ai],[A,Y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[S,[O,Ai],[A,j]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[S,[O,"Lenovo"],[A,Y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[S,/_/g," "],[O,"Nokia"],[A,j]],[/(pixel c)\b/i],[S,[O,zt],[A,Y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[S,[O,zt],[A,j]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[S,[O,De],[A,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[S,"Xperia Tablet"],[O,De],[A,Y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[S,[O,"OnePlus"],[A,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[S,[O,ue],[A,Y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[S,/(.+)/g,"Fire Phone $1"],[O,ue],[A,j]],[/(playbook);[-\w\),; ]+(rim)/i],[S,O,[A,Y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[S,[O,Pe],[A,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[S,[O,ye],[A,Y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[S,[O,ye],[A,j]],[/(nexus 9)/i],[S,[O,"HTC"],[A,Y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[O,[S,/_/g," "],[A,j]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[S,[O,"Acer"],[A,Y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[S,[O,"Meizu"],[A,j]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[O,S,[A,j]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[O,S,[A,Y]],[/(surface duo)/i],[S,[O,pi],[A,Y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[S,[O,"Fairphone"],[A,j]],[/(u304aa)/i],[S,[O,"AT&T"],[A,j]],[/\bsie-(\w*)/i],[S,[O,"Siemens"],[A,j]],[/\b(rct\w+) b/i],[S,[O,"RCA"],[A,Y]],[/\b(venue[\d ]{2,7}) b/i],[S,[O,"Dell"],[A,Y]],[/\b(q(?:mv|ta)\w+) b/i],[S,[O,"Verizon"],[A,Y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[S,[O,"Barnes & Noble"],[A,Y]],[/\b(tm\d{3}\w+) b/i],[S,[O,"NuVision"],[A,Y]],[/\b(k88) b/i],[S,[O,"ZTE"],[A,Y]],[/\b(nx\d{3}j) b/i],[S,[O,"ZTE"],[A,j]],[/\b(gen\d{3}) b.+49h/i],[S,[O,"Swiss"],[A,j]],[/\b(zur\d{3}) b/i],[S,[O,"Swiss"],[A,Y]],[/\b((zeki)?tb.*\b) b/i],[S,[O,"Zeki"],[A,Y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[O,"Dragon Touch"],S,[A,Y]],[/\b(ns-?\w{0,9}) b/i],[S,[O,"Insignia"],[A,Y]],[/\b((nxa|next)-?\w{0,9}) b/i],[S,[O,"NextBook"],[A,Y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[O,"Voice"],S,[A,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[O,"LvTel"],S,[A,j]],[/\b(ph-1) /i],[S,[O,"Essential"],[A,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[S,[O,"Envizen"],[A,Y]],[/\b(trio[-\w\. ]+) b/i],[S,[O,"MachSpeed"],[A,Y]],[/\btu_(1491) b/i],[S,[O,"Rotor"],[A,Y]],[/(shield[\w ]+) b/i],[S,[O,"Nvidia"],[A,Y]],[/(sprint) (\w+)/i],[O,S,[A,j]],[/(kin\.[onetw]{3})/i],[[S,/\./g," "],[O,pi],[A,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[S,[O,te],[A,Y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[S,[O,te],[A,j]],[/smart-tv.+(samsung)/i],[O,[A,q]],[/hbbtv.+maple;(\d+)/i],[[S,/^/,"SmartTV"],[O,je],[A,q]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[O,Ai],[A,q]],[/(apple) ?tv/i],[O,[S,oe+" TV"],[A,q]],[/crkey/i],[[S,nt+"cast"],[O,zt],[A,q]],[/droid.+aft(\w)( bui|\))/i],[S,[O,ue],[A,q]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[S,[O,pt],[A,q]],[/(bravia[\w ]+)( bui|\))/i],[S,[O,De],[A,q]],[/(mitv-\w{5}) bui/i],[S,[O,F],[A,q]],[/Hbbtv.*(technisat) (.*);/i],[O,S,[A,q]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[O,_u],[S,_u],[A,q]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[A,q]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[O,S,[A,B]],[/droid.+; (shield) bui/i],[S,[O,"Nvidia"],[A,B]],[/(playstation [345portablevi]+)/i],[S,[O,De],[A,B]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[S,[O,pi],[A,B]],[/((pebble))app/i],[O,S,[A,ie]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[S,[O,oe],[A,ie]],[/droid.+; (glass) \d/i],[S,[O,zt],[A,ie]],[/droid.+; (wt63?0{2,3})\)/i],[S,[O,te],[A,ie]],[/(quest( 2| pro)?)/i],[S,[O,re],[A,ie]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[O,[A,le]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[S,[A,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[S,[A,Y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[A,Y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[A,j]],[/(android[-\w\. ]{0,9});.+buil/i],[S,[O,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[D,[b,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[D,[b,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[b,D],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[D,b]],os:[[/microsoft (windows) (vista|xp)/i],[b,D],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[b,[D,Yy,vA]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[b,"Windows"],[D,Yy,vA]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[D,/_/g,"."],[b,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[b,Pt],[D,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[D,b],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[b,D],[/\(bb(10);/i],[D,[b,Pe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[D,[b,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[D,[b,$t+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[D,[b,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[D,[b,"watchOS"]],[/crkey\/([\d\.]+)/i],[D,[b,nt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[b,Me],D],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[b,D],[/(sunos) ?([\w\.\d]*)/i],[[b,"Solaris"],D],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[b,D]]},mo=function(ji,ns){if(typeof ji===f&&(ns=ji,ji=s),!(this instanceof mo))return new mo(ji,ns).getResult();var qn=typeof n!==l&&n.navigator?n.navigator:s,_a=ji||(qn&&qn.userAgent?qn.userAgent:""),cd=qn&&qn.userAgentData?qn.userAgentData:s,Ci=ns?function(un,Jr){var sf={};for(var il in un)Jr[il]&&Jr[il].length%2==0?sf[il]=Jr[il].concat(un[il]):sf[il]=un[il];return sf}(bA,ns):bA;return this.getBrowser=function(){var un={};return un[b]=s,un[D]=s,Rm.call(un,_a,Ci.browser),un[_]=function(Jr){return typeof Jr===m?Jr.replace(/[^\d\.]/g,"").split(".")[0]:s}(un[D]),qn&&qn.brave&&typeof qn.brave.isBrave==a&&(un[b]="Brave"),un},this.getCPU=function(){var un={};return un[G]=s,Rm.call(un,_a,Ci.cpu),un},this.getDevice=function(){var un={};return un[O]=s,un[S]=s,un[A]=s,Rm.call(un,_a,Ci.device),!un[A]&&cd&&cd.mobile&&(un[A]=j),un[S]=="Macintosh"&&qn&&typeof qn.standalone!==l&&qn.maxTouchPoints&&qn.maxTouchPoints>2&&(un[S]="iPad",un[A]=Y),un},this.getEngine=function(){var un={};return un[b]=s,un[D]=s,Rm.call(un,_a,Ci.engine),un},this.getOS=function(){var un={};return un[b]=s,un[D]=s,Rm.call(un,_a,Ci.os),!un[b]&&cd&&cd.platform!="Unknown"&&(un[b]=cd.platform.replace(/chrome os/i,Me).replace(/macos/i,Pt)),un},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return _a},this.setUA=function(un){return _a=typeof un===m&&un.length>350?_u(un,350):un,this},this.setUA(_a),this};mo.VERSION="0.7.34",mo.BROWSER=Cn([b,D,_]),mo.CPU=Cn([G]),mo.DEVICE=Cn([S,O,A,B,j,q,Y,ie,le]),mo.ENGINE=mo.OS=Cn([b,D]),e.exports&&(t=e.exports=mo),t.UAParser=mo;var nf=typeof n!==l&&(n.jQuery||n.Zepto);if(nf&&!nf.ua){var Am=new mo;nf.ua=Am.getResult(),nf.ua.get=function(){return Am.getUA()},nf.ua.set=function(ji){Am.setUA(ji);var ns=Am.getResult();for(var qn in ns)nf.ua[qn]=ns[qn]}}})(typeof window=="object"?window:o)})(JI,JI.exports);var v8=d(JI.exports),b8=aa,R8=Yi,A8=Ft,C8=Ui,I8=ti("iterator"),w8=Object,O8=function(e){if(A8(e))return!1;var t=w8(e);return t[I8]!==void 0||"@@iterator"in t||R8(C8,b8(t))},D8=d(O8),DP=Ei.clear;fn({global:!0,bind:!0,forced:x.clearImmediate!==DP},{clearImmediate:DP});var N8=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",NP=x,L8=ee,x8=qe,P8=N8,k8=hi,M8=vp,U8=Vo,F8=NP.Function,B8=/MSIE .\./.test(k8)||P8&&function(){var e=NP.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),V8=fn,LP=x,xP=Ei.set,j8=function(e,t){var n=1;return B8?function(s,a){var l=U8(arguments.length,1)>n,f=x8(s)?s:F8(s),m=l?M8(arguments,n):[],_=l?function(){L8(f,this,m)}:f;return e(_)}:e},PP=LP.setImmediate?j8(xP):xP;V8({global:!0,bind:!0,forced:LP.setImmediate!==PP},{setImmediate:PP});var kP=d(Ot.setImmediate),G8=fn,H8=iS,K8=Ir,W8=Vo,Y8=No,q8=x.process;G8({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){W8(arguments.length,1),K8(e);var t=Y8&&q8.domain;H8(t?t.bind(e):e)}});var MP=d(Ot.queueMicrotask);function UP(e,t){return function(){return e.apply(t,arguments)}}const{toString:$8}=Object.prototype,{getPrototypeOf:QI}=Object,Cb=(ZI=Object.create(null),e=>{const t=$8.call(e);return ZI[t]||(ZI[t]=t.slice(8,-1).toLowerCase())});var ZI;const Kc=e=>(e=e.toLowerCase(),t=>Cb(t)===e),Ib=e=>t=>typeof t===e,{isArray:OE}=Array,KS=Ib("undefined"),FP=Kc("ArrayBuffer"),z8=Ib("string"),so=Ib("function"),BP=Ib("number"),wb=e=>e!==null&&typeof e=="object",Ob=e=>{if(Cb(e)!=="object")return!1;const t=QI(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||D8(e))},X8=Kc("Date"),J8=Kc("File"),Q8=Kc("Blob"),Z8=Kc("FileList"),eK=Kc("URLSearchParams"),[tK,nK,iK,sK]=["ReadableStream","Request","Response","Headers"].map(Kc);function WS(e,t){let n,s,{allOwnKeys:a=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),OE(e))for(n=0,s=e.length;n<s;n++)t.call(null,e[n],n,e);else{const l=a?Object.getOwnPropertyNames(e):Object.keys(e),f=l.length;let m;for(n=0;n<f;n++)m=l[n],t.call(null,e[m],m,e)}}function VP(e,t){t=t.toLowerCase();const n=Object.keys(e);let s,a=n.length;for(;a-- >0;)if(s=n[a],t===s.toLowerCase())return s;return null}const $p=OP!==void 0?OP:typeof self<"u"?self:typeof window<"u"?window:GD,jP=e=>!KS(e)&&e!==$p,rK=(ew=typeof Uint8Array<"u"&&QI(Uint8Array),e=>ew&&e instanceof ew);var ew;const aK=Kc("HTMLFormElement"),GP=(e=>{let{hasOwnProperty:t}=e;return(n,s)=>t.call(n,s)})(Object.prototype),oK=Kc("RegExp"),HP=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),s={};WS(n,(a,l)=>{let f;(f=t(a,l,e))!==!1&&(s[l]=f||a)}),Object.defineProperties(e,s)},tw="abcdefghijklmnopqrstuvwxyz",KP="0123456789",WP={DIGIT:KP,ALPHA:tw,ALPHA_DIGIT:tw+tw.toUpperCase()+KP},cK=Kc("AsyncFunction"),YP=(qP=typeof kP=="function",$P=so($p.postMessage),qP?kP:$P?(nw="axios@".concat(Math.random()),Db=[],$p.addEventListener("message",e=>{let{source:t,data:n}=e;t===$p&&n===nw&&Db.length&&Db.shift()()},!1),e=>{Db.push(e),$p.postMessage(nw,"*")}):e=>setTimeout(e));var qP,$P,nw,Db;const lK=MP!==void 0?MP.bind($p):typeof process<"u"&&process.nextTick||YP;var $e={isArray:OE,isArrayBuffer:FP,isBuffer:function(e){return e!==null&&!KS(e)&&e.constructor!==null&&!KS(e.constructor)&&so(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||so(e.append)&&((t=Cb(e))==="formdata"||t==="object"&&so(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&FP(e.buffer),t},isString:z8,isNumber:BP,isBoolean:e=>e===!0||e===!1,isObject:wb,isPlainObject:Ob,isReadableStream:tK,isRequest:nK,isResponse:iK,isHeaders:sK,isUndefined:KS,isDate:X8,isFile:J8,isBlob:Q8,isRegExp:oK,isFunction:so,isStream:e=>wb(e)&&so(e.pipe),isURLSearchParams:eK,isTypedArray:rK,isFileList:Z8,forEach:WS,merge:function e(){const{caseless:t}=jP(this)&&this||{},n={},s=(a,l)=>{const f=t&&VP(n,l)||l;Ob(n[f])&&Ob(a)?n[f]=e(n[f],a):Ob(a)?n[f]=e({},a):OE(a)?n[f]=a.slice():n[f]=a};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&WS(arguments[a],s);return n},extend:function(e,t,n){let{allOwnKeys:s}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return WS(t,(a,l)=>{n&&so(a)?e[l]=UP(a,n):e[l]=a},{allOwnKeys:s}),e},trim:e=>nr(e)?nr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,s)=>{e.prototype=Object.create(t.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,s)=>{let a,l,f;const m={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),l=a.length;l-- >0;)f=a[l],s&&!s(f,e,t)||m[f]||(t[f]=e[f],m[f]=!0);e=n!==!1&&QI(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Cb,kindOfTest:Kc,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const s=e.indexOf(t,n);return s!==-1&&s===n},toArray:e=>{if(!e)return null;if(OE(e))return e;let t=e.length;if(!BP(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let s;for(;(s=n.next())&&!s.done;){const a=s.value;t.call(e,a[0],a[1])}},matchAll:(e,t)=>{let n;const s=[];for(;(n=e.exec(t))!==null;)s.push(n);return s},isHTMLForm:aK,hasOwnProperty:GP,hasOwnProp:GP,reduceDescriptors:HP,freezeMethods:e=>{HP(e,(t,n)=>{if(so(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=e[n];so(s)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},s=a=>{a.forEach(l=>{n[l]=!0})};return OE(e)?s(e):s(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,s){return n.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:VP,global:$p,isContextDefined:jP,ALPHABET:WP,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:WP.ALPHA_DIGIT,n="";const{length:s}=t;for(;e--;)n+=t[Math.random()*s|0];return n},isSpecCompliantForm:function(e){return!!(e&&so(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(s,a)=>{if(wb(s)){if(t.indexOf(s)>=0)return;if(!("toJSON"in s)){t[a]=s;const l=OE(s)?[]:{};return WS(s,(f,m)=>{const _=n(f,a+1);!KS(_)&&(l[m]=_)}),t[a]=void 0,l}}return s};return n(e,0)},isAsyncFn:cK,isThenable:e=>e&&(wb(e)||so(e))&&so(e.then)&&so(e.catch),setImmediate:YP,asap:lK};function Rn(e,t,n,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}$e.inherits(Rn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:$e.toJSONObject(this.config),code:this.code,status:this.status}}});const zP=Rn.prototype,XP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{XP[e]={value:e}}),Object.defineProperties(Rn,XP),Object.defineProperty(zP,"isAxiosError",{value:!0}),Rn.from=(e,t,n,s,a,l)=>{const f=Object.create(zP);return $e.toFlatObject(e,f,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),Rn.call(f,e.message,t,n,s,a),f.cause=e,f.name=e.name,l&&Object.assign(f,l),f};function iw(e){return $e.isPlainObject(e)||$e.isArray(e)}function JP(e){return $e.endsWith(e,"[]")?e.slice(0,-2):e}function QP(e,t,n){return e?e.concat(t).map(function(s,a){return s=JP(s),!n&&a?"["+s+"]":s}).join(n?".":""):t}const dK=$e.toFlatObject($e,{},null,function(e){return/^is[A-Z]/.test(e)});function Nb(e,t,n){if(!$e.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const s=(n=$e.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(O,D){return!$e.isUndefined(D[O])})).metaTokens,a=n.visitor||S,l=n.dots,f=n.indexes,m=(n.Blob||typeof Blob<"u"&&Blob)&&$e.isSpecCompliantForm(t);if(!$e.isFunction(a))throw new TypeError("visitor must be a function");function _(O){if(O===null)return"";if($e.isDate(O))return O.toISOString();if(!m&&$e.isBlob(O))throw new Rn("Blob is not supported. Use a Buffer instead.");return $e.isArrayBuffer(O)||$e.isTypedArray(O)?m&&typeof Blob=="function"?new Blob([O]):Buffer.from(O):O}function S(O,D,G){let B=O;if(O&&!G&&typeof O=="object"){if($e.endsWith(D,"{}"))D=s?D:D.slice(0,-2),O=JSON.stringify(O);else if($e.isArray(O)&&function(j){return $e.isArray(j)&&!j.some(iw)}(O)||($e.isFileList(O)||$e.endsWith(D,"[]"))&&(B=$e.toArray(O)))return D=JP(D),B.forEach(function(j,Y){!$e.isUndefined(j)&&j!==null&&t.append(f===!0?QP([D],Y,l):f===null?D:D+"[]",_(j))}),!1}return!!iw(O)||(t.append(QP(G,D,l),_(O)),!1)}const b=[],A=Object.assign(dK,{defaultVisitor:S,convertValue:_,isVisitable:iw});if(!$e.isObject(e))throw new TypeError("data must be an object");return function O(D,G){if(!$e.isUndefined(D)){if(b.indexOf(D)!==-1)throw Error("Circular reference detected in "+G.join("."));b.push(D),$e.forEach(D,function(B,j){(!($e.isUndefined(B)||B===null)&&a.call(t,B,$e.isString(j)?nr(j).call(j):j,G,A))===!0&&O(B,G?G.concat(j):[j])}),b.pop()}}(e),t}function ZP(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function sw(e,t){this._pairs=[],e&&Nb(e,this,t)}const ek=sw.prototype;function uK(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function tk(e,t,n){if(!t)return e;const s=n&&n.encode||uK;$e.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let l;if(l=a?a(t,n):$e.isURLSearchParams(t)?t.toString():new sw(t,n).toString(s),l){const f=e.indexOf("#");f!==-1&&(e=e.slice(0,f)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}ek.append=function(e,t){this._pairs.push([e,t])},ek.toString=function(e){const t=e?function(n){return e.call(this,n,ZP)}:ZP;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var nk=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){$e.forEach(this.handlers,function(t){t!==null&&e(t)})}},ik={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},sk={exports:{}},hK=fn,fK=Oe,rk=Js.f;hK({target:"Object",stat:!0,forced:Object.defineProperty!==rk,sham:!fK},{defineProperty:rk});var ak=Ot.Object,pK=sk.exports=function(e,t,n){return ak.defineProperty(e,t,n)};ak.defineProperty.sham&&(pK.sham=!0);var ok=d(sk.exports),mK=TypeError,ck=Ra,gK=eo,EK=yt,_K=ti("species"),lk=Array,SK=function(e){var t;return ck(e)&&(t=e.constructor,(gK(t)&&(t===lk||ck(t.prototype))||EK(t)&&(t=t[_K])===null)&&(t=void 0)),t===void 0?lk:t},dk=function(e,t){return new(SK(e))(t===0?0:t)},yK=p,TK=To,vK=ti("species"),uk=function(e){return TK>=51||!yK(function(){var t=[];return(t.constructor={})[vK]=function(){return{foo:1}},t[e](Boolean).foo!==1})},bK=fn,RK=p,AK=Ra,CK=yt,IK=Ns,wK=va,hk=function(e){if(e>9007199254740991)throw mK("Maximum allowed index exceeded");return e},fk=SE,OK=dk,DK=uk,NK=To,pk=ti("isConcatSpreadable"),LK=NK>=51||!RK(function(){var e=[];return e[pk]=!1,e.concat()[0]!==e}),xK=function(e){if(!CK(e))return!1;var t=e[pk];return t!==void 0?!!t:AK(e)};bK({target:"Array",proto:!0,forced:!LK||!DK("concat")},{concat:function(e){var t,n,s,a,l,f=IK(this),m=OK(f,0),_=0;for(t=-1,s=arguments.length;t<s;t++)if(xK(l=t===-1?f:arguments[t]))for(a=wK(l),hk(_+a),n=0;n<a;n++,_++)n in l&&fk(m,_,l[n]);else hk(_+1),fk(m,_++,l);return m.length=_,m}});var mk={},PK=Se,kK=Wn,gk=bc.f,MK=Nh,Ek=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];mk.f=function(e){return Ek&&PK(e)=="Window"?function(t){try{return gk(t)}catch{return MK(Ek)}}(e):gk(kK(e))};var DE={},UK=ti;DE.f=UK;var _k=Ot,FK=Yi,BK=DE,VK=Js.f,As=function(e){var t=_k.Symbol||(_k.Symbol={});FK(t,e)||VK(t,e,{value:BK.f(e)})},jK=Re,GK=Nn,HK=ti,KK=Nc,Sk=function(){var e=GK("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,s=HK("toPrimitive");t&&!t[s]&&KK(t,s,function(a){return jK(n,this)},{})},WK=ur,YK=gn,qK=Ns,$K=va,zK=dk,yk=I([].push),XK=function(e){var t=e==1,n=e==2,s=e==3,a=e==4,l=e==6,f=e==7,m=e==5||l;return function(_,S,b,A){for(var O,D,G=qK(_),B=YK(G),j=WK(S,b),Y=$K(B),q=0,ie=A||zK,le=t?ie(_,Y):n||f?ie(_,0):void 0;Y>q;q++)if((m||q in B)&&(D=j(O=B[q],q,G),e))if(t)le[q]=D;else if(D)switch(e){case 3:return!0;case 5:return O;case 6:return q;case 2:yk(le,O)}else switch(e){case 4:return!1;case 7:yk(le,O)}return l?-1:s||a?a:le}},Tk={forEach:XK(0)},Lb=fn,rw=x,aw=Re,JK=I,NE=Oe,LE=hl,QK=p,Er=Yi,ZK=L,ow=is,xb=Wn,cw=Rd,eW=Qs,lw=St,YS=Dl,vk=rs,tW=bc,bk=mk,nW=ah,Rk=ut,Ak=Js,iW=Z_,Ck=se,Ik=Nc,sW=Sp,dw=Ta,wk=Cl,Ok=_f,rW=ti,aW=DE,oW=As,cW=Sk,lW=fr,Dk=Dc,Pb=Tk.forEach,Na=ss("hidden"),kb="Symbol",qS="prototype",dW=Dk.set,Nk=Dk.getterFor(kb),Wc=Object[qS],zp=rw.Symbol,Mb=zp&&zp[qS],uW=rw.TypeError,uw=rw.QObject,Lk=Rk.f,Xp=Ak.f,xk=bk.f,hW=Ck.f,Pk=JK([].push),nu=dw("symbols"),$S=dw("op-symbols"),fW=dw("wks"),hw=!uw||!uw[qS]||!uw[qS].findChild,fw=NE&&QK(function(){return YS(Xp({},"a",{get:function(){return Xp(this,"a",{value:7}).a}})).a!=7})?function(e,t,n){var s=Lk(Wc,t);s&&delete Wc[t],Xp(e,t,n),s&&e!==Wc&&Xp(Wc,t,s)}:Xp,pw=function(e,t){var n=nu[e]=YS(Mb);return dW(n,{type:kb,tag:e,description:t}),NE||(n.description=t),n},Ub=function(e,t,n){e===Wc&&Ub($S,t,n),ow(e);var s=cw(t);return ow(n),Er(nu,s)?(n.enumerable?(Er(e,Na)&&e[Na][s]&&(e[Na][s]=!1),n=YS(n,{enumerable:lw(0,!1)})):(Er(e,Na)||Xp(e,Na,lw(1,{})),e[Na][s]=!0),fw(e,s,n)):Xp(e,s,n)},mw=function(e,t){ow(e);var n=xb(t),s=vk(n).concat(Fk(n));return Pb(s,function(a){NE&&!aw(kk,n,a)||Ub(e,a,n[a])}),e},kk=function(e){var t=cw(e),n=aw(hW,this,t);return!(this===Wc&&Er(nu,t)&&!Er($S,t))&&(!(n||!Er(this,t)||!Er(nu,t)||Er(this,Na)&&this[Na][t])||n)},Mk=function(e,t){var n=xb(e),s=cw(t);if(n!==Wc||!Er(nu,s)||Er($S,s)){var a=Lk(n,s);return!a||!Er(nu,s)||Er(n,Na)&&n[Na][s]||(a.enumerable=!0),a}},Uk=function(e){var t=xk(xb(e)),n=[];return Pb(t,function(s){Er(nu,s)||Er(wk,s)||Pk(n,s)}),n},Fk=function(e){var t=e===Wc,n=xk(t?$S:xb(e)),s=[];return Pb(n,function(a){!Er(nu,a)||t&&!Er(Wc,a)||Pk(s,nu[a])}),s};LE||(zp=function(){if(ZK(Mb,this))throw uW("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?eW(arguments[0]):void 0,t=Ok(e),n=function(s){this===Wc&&aw(n,$S,s),Er(this,Na)&&Er(this[Na],t)&&(this[Na][t]=!1),fw(this,t,lw(1,s))};return NE&&hw&&fw(Wc,t,{configurable:!0,set:n}),pw(t,e)},Ik(Mb=zp[qS],"toString",function(){return Nk(this).tag}),Ik(zp,"withoutSetter",function(e){return pw(Ok(e),e)}),Ck.f=kk,Ak.f=Ub,iW.f=mw,Rk.f=Mk,tW.f=bk.f=Uk,nW.f=Fk,aW.f=function(e){return pw(rW(e),e)},NE&&sW(Mb,"description",{configurable:!0,get:function(){return Nk(this).description}})),Lb({global:!0,wrap:!0,forced:!LE,sham:!LE},{Symbol:zp}),Pb(vk(fW),function(e){oW(e)}),Lb({target:kb,stat:!0,forced:!LE},{useSetter:function(){hw=!0},useSimple:function(){hw=!1}}),Lb({target:"Object",stat:!0,forced:!LE,sham:!NE},{create:function(e,t){return t===void 0?YS(e):mw(YS(e),t)},defineProperty:Ub,defineProperties:mw,getOwnPropertyDescriptor:Mk}),Lb({target:"Object",stat:!0,forced:!LE},{getOwnPropertyNames:Uk}),cW(),lW(zp,kb),wk[Na]=!0;var Bk=hl&&!!Symbol.for&&!!Symbol.keyFor,pW=fn,mW=Nn,gW=Yi,EW=Qs,Vk=Ta,_W=Bk,gw=Vk("string-to-symbol-registry"),SW=Vk("symbol-to-string-registry");pW({target:"Symbol",stat:!0,forced:!_W},{for:function(e){var t=EW(e);if(gW(gw,t))return gw[t];var n=mW("Symbol")(t);return gw[t]=n,SW[n]=t,n}});var yW=fn,TW=Yi,vW=Ya,bW=qa,RW=Bk,jk=Ta("symbol-to-string-registry");yW({target:"Symbol",stat:!0,forced:!RW},{keyFor:function(e){if(!vW(e))throw TypeError(bW(e)+" is not a symbol");if(TW(jk,e))return jk[e]}});var Gk=Ra,AW=qe,Hk=Se,CW=Qs,Kk=I([].push),IW=fn,Wk=Nn,Yk=ee,wW=Re,zS=I,qk=p,$k=qe,zk=Ya,Xk=vp,OW=function(e){if(AW(e))return e;if(Gk(e)){for(var t=e.length,n=[],s=0;s<t;s++){var a=e[s];typeof a=="string"?Kk(n,a):typeof a!="number"&&Hk(a)!="Number"&&Hk(a)!="String"||Kk(n,CW(a))}var l=n.length,f=!0;return function(m,_){if(f)return f=!1,_;if(Gk(this))return _;for(var S=0;S<l;S++)if(n[S]===m)return _}}},DW=hl,NW=String,Mh=Wk("JSON","stringify"),Fb=zS(/./.exec),Jk=zS("".charAt),LW=zS("".charCodeAt),xW=zS("".replace),PW=zS(1 .toString),kW=/[\uD800-\uDFFF]/g,Qk=/^[\uD800-\uDBFF]$/,Zk=/^[\uDC00-\uDFFF]$/,e1=!DW||qk(function(){var e=Wk("Symbol")();return Mh([e])!="[null]"||Mh({a:e})!="{}"||Mh(Object(e))!="{}"}),t1=qk(function(){return Mh("\uDF06\uD834")!=='"\\udf06\\ud834"'||Mh("\uDEAD")!=='"\\udead"'}),MW=function(e,t){var n=Xk(arguments),s=OW(t);if($k(s)||e!==void 0&&!zk(e))return n[1]=function(a,l){if($k(s)&&(l=wW(s,this,NW(a),l)),!zk(l))return l},Yk(Mh,null,n)},UW=function(e,t,n){var s=Jk(n,t-1),a=Jk(n,t+1);return Fb(Qk,e)&&!Fb(Zk,a)||Fb(Zk,e)&&!Fb(Qk,s)?"\\u"+PW(LW(e,0),16):e};Mh&&IW({target:"JSON",stat:!0,forced:e1||t1},{stringify:function(e,t,n){var s=Xk(arguments),a=Yk(e1?MW:Mh,null,s);return t1&&typeof a=="string"?xW(a,kW,UW):a}});var n1=ah,FW=Ns;fn({target:"Object",stat:!0,forced:!hl||p(function(){n1.f(1)})},{getOwnPropertySymbols:function(e){var t=n1.f;return t?t(FW(e)):[]}}),As("asyncIterator"),As("hasInstance"),As("isConcatSpreadable"),As("iterator"),As("match"),As("matchAll"),As("replace"),As("search"),As("species"),As("split");var BW=Sk;As("toPrimitive"),BW();var VW=Nn,jW=fr;As("toStringTag"),jW(VW("Symbol"),"Symbol"),As("unscopables"),fr(x.JSON,"JSON",!0);var GW=Ot.Symbol,HW=ti,KW=Js.f,i1=HW("metadata"),s1=Function.prototype;s1[i1]===void 0&&KW(s1,i1,{value:null}),As("dispose"),As("metadata");var WW=GW;As("asyncDispose");var YW=I,Ew=Nn("Symbol"),qW=Ew.keyFor,$W=YW(Ew.prototype.valueOf),r1=Ew.isRegisteredSymbol||function(e){try{return qW($W(e))!==void 0}catch{return!1}};fn({target:"Symbol",stat:!0},{isRegisteredSymbol:r1});for(var zW=Ta,a1=Nn,XW=I,JW=Ya,QW=ti,Bb=a1("Symbol"),o1=Bb.isWellKnownSymbol,c1=a1("Object","getOwnPropertyNames"),ZW=XW(Bb.prototype.valueOf),l1=zW("wks"),_w=0,d1=c1(Bb),eY=d1.length;_w<eY;_w++)try{var u1=d1[_w];JW(Bb[u1])&&QW(u1)}catch{}var h1=function(e){if(o1&&o1(e))return!0;try{for(var t=ZW(e),n=0,s=c1(l1),a=s.length;n<a;n++)if(l1[s[n]]==t)return!0}catch{}return!1};fn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:h1}),As("matcher"),As("observable"),fn({target:"Symbol",stat:!0},{isRegistered:r1}),fn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:h1}),As("metadataKey"),As("patternMatch"),As("replaceAll");var xE=d(WW),f1=d(DE.f("iterator"));function XS(e){return XS=typeof xE=="function"&&typeof f1=="symbol"?function(t){return typeof t}:function(t){return t&&typeof xE=="function"&&t.constructor===xE&&t!==xE.prototype?"symbol":typeof t},XS(e)}var tY=d(DE.f("toPrimitive"));function nY(e){var t=function(n,s){if(XS(n)!=="object"||n===null)return n;var a=n[tY];if(a!==void 0){var l=a.call(n,s);if(XS(l)!=="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(n)}(e,"string");return XS(t)==="symbol"?t:String(t)}function W(e,t,n){return(t=nY(t))in e?ok(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p1=d(M6),iY={isBrowser:!0,classes:{URLSearchParams:p1!==void 0?p1:sw,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const Sw=typeof window<"u"&&typeof document<"u",yw=typeof navigator=="object"&&navigator||void 0,sY=Sw&&(!yw||["ReactNative","NativeScript","NS"].indexOf(yw.product)<0),rY=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",aY=Sw&&window.location.href||"http://localhost";function m1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function g1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?m1(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var Wr=g1(g1({},Object.freeze({__proto__:null,hasBrowserEnv:Sw,hasStandardBrowserEnv:sY,hasStandardBrowserWebWorkerEnv:rY,navigator:yw,origin:aY})),iY),oY=is,cY=Re,lY=Yi,dY=L,uY=function(){var e=oY(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},E1=RegExp.prototype,_1=function(e){var t=e.flags;return t!==void 0||"flags"in E1||lY(e,"flags")||!dY(E1,e)?t:cY(uY,e)},hY=wS.charAt,S1=Re,fY=is,pY=qe,mY=Se,gY=/./.exec,EY=TypeError,_Y=fn,y1=Re,T1=he,SY=Uo,Vb=Vd,v1=Ws,b1=Yu,JS=Qs,yY=is,TY=Ft,vY=Se,bY=$u,R1=_1,RY=bd,AY=p,CY=Ml,IY=function(e,t,n){return t+(n?hY(e,t).length:1)},wY=function(e,t){var n=e.exec;if(pY(n)){var s=S1(n,e,t);return s!==null&&fY(s),s}if(mY(e)==="RegExp")return S1(gY,e,t);throw EY("RegExp#exec called on incompatible receiver")},A1=Dc,OY=ti("matchAll"),C1="RegExp String",I1=C1+" Iterator",DY=A1.set,NY=A1.getterFor(I1),LY=TypeError,Tw=T1("".indexOf),jb=T1("".matchAll),vw=!!jb&&!AY(function(){jb("a",/./)}),xY=SY(function(e,t,n,s){DY(this,{type:I1,regexp:e,string:t,global:n,unicode:s,done:!1})},C1,function(){var e=NY(this);if(e.done)return Vb(void 0,!0);var t=e.regexp,n=e.string,s=wY(t,n);return s===null?(e.done=!0,Vb(void 0,!0)):e.global?(JS(s[0])===""&&(t.lastIndex=IY(n,b1(t.lastIndex),e.unicode)),Vb(s,!1)):(e.done=!0,Vb(s,!1))}),w1=function(e){var t,n,s,a=yY(this),l=JS(e),f=CY(a,RegExp),m=JS(R1(a));return t=new f(f===RegExp?a.source:a,m),n=!!~Tw(m,"g"),s=!!~Tw(m,"u"),t.lastIndex=b1(a.lastIndex),new xY(t,l,n,s)};_Y({target:"String",proto:!0,forced:vw},{matchAll:function(e){var t,n,s,a,l=v1(this);if(TY(e)){if(vw)return jb(l,e)}else{if(bY(e)&&(t=JS(v1(R1(e))),!~Tw(t,"g")))throw LY("`.matchAll` does not allow non-global regexes");if(vw)return jb(l,e);if((s=RY(e,OY))===void 0&&vY(e)=="RegExp"&&(s=w1),s)return y1(s,e,l)}return n=JS(l),a=new RegExp(e,"g"),y1(w1,a,n)}});var PY=Bs("String").matchAll,kY=L,MY=PY,bw=String.prototype,UY=function(e){var t=e.matchAll;return typeof e=="string"||e===bw||kY(bw,e)&&t===bw.matchAll?MY:t},FY=d(UY);function O1(e){function t(n,s,a,l){let f=n[l++];if(f==="__proto__")return!0;const m=Number.isFinite(+f),_=l>=n.length;return f=!f&&$e.isArray(a)?a.length:f,_?($e.hasOwnProp(a,f)?a[f]=[a[f],s]:a[f]=s,!m):(a[f]&&$e.isObject(a[f])||(a[f]=[]),t(n,s,a[f],l)&&$e.isArray(a[f])&&(a[f]=function(S){const b={},A=Object.keys(S);let O;const D=A.length;let G;for(O=0;O<D;O++)G=A[O],b[G]=S[G];return b}(a[f])),!m)}if($e.isFormData(e)&&$e.isFunction(e.entries)){const n={};return $e.forEachEntry(e,(s,a)=>{t(function(l){return FY($e).call($e,/\w+|\[(\w*)]/g,l).map(f=>f[0]==="[]"?"":f[1]||f[0])}(s),a,n,0)}),n}return null}const Rw={transitional:ik,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",s=n.indexOf("application/json")>-1,a=$e.isObject(e);if(a&&$e.isHTMLForm(e)&&(e=new FormData(e)),$e.isFormData(e))return s?JSON.stringify(O1(e)):e;if($e.isArrayBuffer(e)||$e.isBuffer(e)||$e.isStream(e)||$e.isFile(e)||$e.isBlob(e)||$e.isReadableStream(e))return e;if($e.isArrayBufferView(e))return e.buffer;if($e.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(f,m){return Nb(f,new Wr.classes.URLSearchParams,Object.assign({visitor:function(_,S,b,A){return Wr.isNode&&$e.isBuffer(_)?(this.append(S,_.toString("base64")),!1):A.defaultVisitor.apply(this,arguments)}},m))}(e,this.formSerializer).toString();if((l=$e.isFileList(e))||n.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return Nb(l?{"files[]":e}:e,f&&new f,this.formSerializer)}}return a||s?(t.setContentType("application/json",!1),function(f,m,_){if($e.isString(f))try{return(m||JSON.parse)(f),nr($e).call($e,f)}catch(S){if(S.name!=="SyntaxError")throw S}return(_||JSON.stringify)(f)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Rw.transitional,n=t&&t.forcedJSONParsing,s=this.responseType==="json";if($e.isResponse(e)||$e.isReadableStream(e))return e;if(e&&$e.isString(e)&&(n&&!this.responseType||s)){const a=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(l){if(a)throw l.name==="SyntaxError"?Rn.from(l,Rn.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Wr.classes.FormData,Blob:Wr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};$e.forEach(["delete","get","head","post","put","patch"],e=>{Rw.headers[e]={}});var Aw=Rw;const BY=$e.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),D1=Symbol("internals");function QS(e){var t;return e&&nr(t=String(e)).call(t).toLowerCase()}function Gb(e){return e===!1||e==null?e:$e.isArray(e)?e.map(Gb):String(e)}function Cw(e,t,n,s,a){return $e.isFunction(s)?s.call(this,t,n):(a&&(t=n),$e.isString(t)?$e.isString(s)?t.indexOf(s)!==-1:$e.isRegExp(s)?s.test(t):void 0:void 0)}class Hb{constructor(t){t&&this.set(t)}set(t,n,s){const a=this;function l(_,S,b){const A=QS(S);if(!A)throw new Error("header name must be a non-empty string");const O=$e.findKey(a,A);(!O||a[O]===void 0||b===!0||b===void 0&&a[O]!==!1)&&(a[O||S]=Gb(_))}const f=(_,S)=>$e.forEach(_,(b,A)=>l(b,A,S));if($e.isPlainObject(t)||t instanceof this.constructor)f(t,n);else if($e.isString(t)&&(t=nr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(nr(m=t).call(m)))f((_=>{const S={};let b,A,O;return _&&_.split(`
`).forEach(function(D){var G,B;O=D.indexOf(":"),b=nr(G=D.substring(0,O)).call(G).toLowerCase(),A=nr(B=D.substring(O+1)).call(B),!b||S[b]&&BY[b]||(b==="set-cookie"?S[b]?S[b].push(A):S[b]=[A]:S[b]=S[b]?S[b]+", "+A:A)}),S})(t),n);else if($e.isHeaders(t))for(const[_,S]of t.entries())l(S,_,s);else t!=null&&l(n,t,s);var m;return this}get(t,n){if(t=QS(t)){const s=$e.findKey(this,t);if(s){const a=this[s];if(!n)return a;if(n===!0)return function(l){const f=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(l);)f[_[1]]=_[2];return f}(a);if($e.isFunction(n))return n.call(this,a,s);if($e.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=QS(t)){const s=$e.findKey(this,t);return!(!s||this[s]===void 0||n&&!Cw(0,this[s],s,n))}return!1}delete(t,n){const s=this;let a=!1;function l(f){if(f=QS(f)){const m=$e.findKey(s,f);!m||n&&!Cw(0,s[m],m,n)||(delete s[m],a=!0)}}return $e.isArray(t)?t.forEach(l):l(t),a}clear(t){const n=Object.keys(this);let s=n.length,a=!1;for(;s--;){const l=n[s];t&&!Cw(0,this[l],l,t,!0)||(delete this[l],a=!0)}return a}normalize(t){const n=this,s={};return $e.forEach(this,(a,l)=>{var f;const m=$e.findKey(s,l);if(m)return n[m]=Gb(a),void delete n[l];const _=t?function(S){return nr(S).call(S).toLowerCase().replace(/([a-z\d])(\w*)/g,(b,A,O)=>A.toUpperCase()+O)}(l):nr(f=String(l)).call(f);_!==l&&delete n[l],n[_]=Gb(a),s[_]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return $e.forEach(this,(s,a)=>{s!=null&&s!==!1&&(n[a]=t&&$e.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,s]=t;return n+": "+s}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var s=arguments.length,a=new Array(s>1?s-1:0),l=1;l<s;l++)a[l-1]=arguments[l];return a.forEach(f=>n.set(f)),n}static accessor(t){const n=(this[D1]=this[D1]={accessors:{}}).accessors,s=this.prototype;function a(l){const f=QS(l);n[f]||(function(m,_){const S=$e.toCamelCase(" "+_);["get","set","has"].forEach(b=>{Object.defineProperty(m,b+S,{value:function(A,O,D){return this[b].call(this,_,A,O,D)},configurable:!0})})}(s,l),n[f]=!0)}return $e.isArray(t)?t.forEach(a):a(t),this}}Hb.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),$e.reduceDescriptors(Hb.prototype,(e,t)=>{let{value:n}=e,s=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(a){this[s]=a}}}),$e.freezeMethods(Hb);var Yc=Hb;function Iw(e,t){const n=this||Aw,s=t||n,a=Yc.from(s.headers);let l=s.data;return $e.forEach(e,function(f){l=f.call(n,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function N1(e){return!(!e||!e.__CANCEL__)}function PE(e,t,n){Rn.call(this,e??"canceled",Rn.ERR_CANCELED,t,n),this.name="CanceledError"}function L1(e,t,n){const s=n.config.validateStatus;n.status&&s&&!s(n.status)?t(new Rn("Request failed with status code "+n.status,[Rn.ERR_BAD_REQUEST,Rn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}$e.inherits(PE,Rn,{__CANCEL__:!0});const Kb=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=0;const a=function(l,f){l=l||10;const m=new Array(l),_=new Array(l);let S,b=0,A=0;return f=f!==void 0?f:1e3,function(O){const D=Date.now(),G=_[A];S||(S=D),m[b]=O,_[b]=D;let B=A,j=0;for(;B!==b;)j+=m[B++],B%=l;if(b=(b+1)%l,b===A&&(A=(A+1)%l),D-S<f)return;const Y=G&&D-G;return Y?Math.round(1e3*j/Y):void 0}}(50,250);return function(l,f){let m,_,S=0,b=1e3/f;const A=function(O){S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),l.apply(null,O)};return[function(){const O=Date.now(),D=O-S;for(var G=arguments.length,B=new Array(G),j=0;j<G;j++)B[j]=arguments[j];D>=b?A(B,O):(m=B,_||(_=setTimeout(()=>{_=null,A(m)},b-D)))},()=>m&&A(m)]}(l=>{const f=l.loaded,m=l.lengthComputable?l.total:void 0,_=f-s,S=a(_);s=f,e({loaded:f,total:m,progress:m?f/m:void 0,bytes:_,rate:S||void 0,estimated:S&&m&&f<=m?(m-f)/S:void 0,event:l,lengthComputable:m!=null,[t?"download":"upload"]:!0})},n)},x1=(e,t)=>{const n=e!=null;return[s=>t[0]({lengthComputable:n,total:e,loaded:s}),t[1]]},P1=e=>function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return $e.asap(()=>e(...n))};var VY=Wr.hasStandardBrowserEnv?((e,t)=>n=>(n=new Sb(n,Wr.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new Sb(Wr.origin),Wr.navigator&&/(msie|trident)/i.test(Wr.navigator.userAgent)):()=>!0,jY=Wr.hasStandardBrowserEnv?{write(e,t,n,s,a,l){const f=[e+"="+encodeURIComponent(t)];$e.isNumber(n)&&f.push("expires="+new Date(n).toGMTString()),$e.isString(s)&&f.push("path="+s),$e.isString(a)&&f.push("domain="+a),l===!0&&f.push("secure"),document.cookie=f.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function k1(e,t){return e&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(t)?function(n,s){return s?n.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):n}(e,t):t}function M1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}const U1=e=>e instanceof Yc?function(t){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?M1(Object(s),!0).forEach(function(a){W(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):M1(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}({},e):e;function Jp(e,t){t=t||{};const n={};function s(S,b,A,O){return $e.isPlainObject(S)&&$e.isPlainObject(b)?$e.merge.call({caseless:O},S,b):$e.isPlainObject(b)?$e.merge({},b):$e.isArray(b)?b.slice():b}function a(S,b,A,O){return $e.isUndefined(b)?$e.isUndefined(S)?void 0:s(void 0,S,0,O):s(S,b,0,O)}function l(S,b){if(!$e.isUndefined(b))return s(void 0,b)}function f(S,b){return $e.isUndefined(b)?$e.isUndefined(S)?void 0:s(void 0,S):s(void 0,b)}function m(S,b,A){return A in t?s(S,b):A in e?s(void 0,S):void 0}const _={url:l,method:l,data:l,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:m,headers:(S,b,A)=>a(U1(S),U1(b),0,!0)};return $e.forEach(Object.keys(Object.assign({},e,t)),function(S){const b=_[S]||a,A=b(e[S],t[S],S);$e.isUndefined(A)&&b!==m||(n[S]=A)}),n}var F1=e=>{const t=Jp({},e);let n,{data:s,withXSRFToken:a,xsrfHeaderName:l,xsrfCookieName:f,headers:m,auth:_}=t;if(t.headers=m=Yc.from(m),t.url=tk(k1(t.baseURL,t.url),e.params,e.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),$e.isFormData(s)){if(Wr.hasStandardBrowserEnv||Wr.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((n=m.getContentType())!==!1){const[S,...b]=n?n.split(";").map(A=>nr(A).call(A)).filter(Boolean):[];m.setContentType([S||"multipart/form-data",...b].join("; "))}}if(Wr.hasStandardBrowserEnv&&(a&&$e.isFunction(a)&&(a=a(t)),a||a!==!1&&VY(t.url))){const S=l&&f&&jY.read(f);S&&m.set(l,S)}return t},GY=typeof XMLHttpRequest<"u"&&function(e){return new Ye(function(t,n){const s=F1(e);let a=s.data;const l=Yc.from(s.headers).normalize();let f,m,_,S,b,{responseType:A,onUploadProgress:O,onDownloadProgress:D}=s;function G(){S&&S(),b&&b(),s.cancelToken&&s.cancelToken.unsubscribe(f),s.signal&&s.signal.removeEventListener("abort",f)}let B=new XMLHttpRequest;function j(){if(!B)return;const q=Yc.from("getAllResponseHeaders"in B&&B.getAllResponseHeaders());L1(function(ie){t(ie),G()},function(ie){n(ie),G()},{data:A&&A!=="text"&&A!=="json"?B.response:B.responseText,status:B.status,statusText:B.statusText,headers:q,config:e,request:B}),B=null}B.open(s.method.toUpperCase(),s.url,!0),B.timeout=s.timeout,"onloadend"in B?B.onloadend=j:B.onreadystatechange=function(){B&&B.readyState===4&&(B.status!==0||B.responseURL&&B.responseURL.indexOf("file:")===0)&&setTimeout(j)},B.onabort=function(){B&&(n(new Rn("Request aborted",Rn.ECONNABORTED,e,B)),B=null)},B.onerror=function(){n(new Rn("Network Error",Rn.ERR_NETWORK,e,B)),B=null},B.ontimeout=function(){let q=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const ie=s.transitional||ik;s.timeoutErrorMessage&&(q=s.timeoutErrorMessage),n(new Rn(q,ie.clarifyTimeoutError?Rn.ETIMEDOUT:Rn.ECONNABORTED,e,B)),B=null},a===void 0&&l.setContentType(null),"setRequestHeader"in B&&$e.forEach(l.toJSON(),function(q,ie){B.setRequestHeader(ie,q)}),$e.isUndefined(s.withCredentials)||(B.withCredentials=!!s.withCredentials),A&&A!=="json"&&(B.responseType=s.responseType),D&&([_,b]=Kb(D,!0),B.addEventListener("progress",_)),O&&B.upload&&([m,S]=Kb(O),B.upload.addEventListener("progress",m),B.upload.addEventListener("loadend",S)),(s.cancelToken||s.signal)&&(f=q=>{B&&(n(!q||q.type?new PE(null,e,B):q),B.abort(),B=null)},s.cancelToken&&s.cancelToken.subscribe(f),s.signal&&(s.signal.aborted?f():s.signal.addEventListener("abort",f)));const Y=function(q){const ie=/^([-+\w]{1,25})(:?\/\/|:)/.exec(q);return ie&&ie[1]||""}(s.url);Y&&Wr.protocols.indexOf(Y)===-1?n(new Rn("Unsupported protocol "+Y+":",Rn.ERR_BAD_REQUEST,e)):B.send(a||null)})},HY=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let s,a=new AbortController;const l=function(S){if(!s){s=!0,m();const b=S instanceof Error?S:this.reason;a.abort(b instanceof Rn?b:new PE(b instanceof Error?b.message:b))}};let f=t&&setTimeout(()=>{f=null,l(new Rn("timeout ".concat(t," of ms exceeded"),Rn.ETIMEDOUT))},t);const m=()=>{e&&(f&&clearTimeout(f),f=null,e.forEach(S=>{S.unsubscribe?S.unsubscribe(l):S.removeEventListener("abort",l)}),e=null)};e.forEach(S=>S.addEventListener("abort",l));const{signal:_}=a;return _.unsubscribe=()=>$e.asap(m),_}},KY=EE,WY=io;fn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=WY.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var YY=io,qY=bs;fn({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=YY.f(this),n=qY(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var ww=d(KY),B1=DE.f("asyncIterator"),$Y=d(B1);function Ow(e,t){this.v=e,this.k=t}function ZS(e){var t,n;function s(l,f){try{var m=e[l](f),_=m.value,S=_ instanceof Ow;ww.resolve(S?_.v:_).then(function(b){if(S){var A=l==="return"?"return":"next";if(!_.k||b.done)return s(A,b);b=e[A](b).value}a(m.done?"return":"normal",b)},function(b){s("throw",b)})}catch(b){a("throw",b)}}function a(l,f){switch(l){case"return":t.resolve({value:f,done:!0});break;case"throw":t.reject(f);break;default:t.resolve({value:f,done:!1})}(t=t.next)?s(t.key,t.arg):n=null}this._invoke=function(l,f){return new ww(function(m,_){var S={key:l,arg:f,resolve:m,reject:_,next:null};n?n=n.next=S:(t=n=S,s(l,f))})},typeof e.return!="function"&&(this.return=void 0)}function ro(e){return function(){return new ZS(e.apply(this,arguments))}}function tn(e){return new Ow(e,0)}function Wb(e){var t={},n=!1;function s(a,l){return n=!0,{done:!1,value:new Ow(l=new ww(function(f){f(e[a](l))}),1)}}return t[xE!==void 0&&f1||"@@iterator"]=function(){return this},t.next=function(a){return n?(n=!1,a):s("next",a)},typeof e.throw=="function"&&(t.throw=function(a){if(n)throw n=!1,a;return s("throw",a)}),typeof e.return=="function"&&(t.return=function(a){return n?(n=!1,a):s("return",a)}),t}ZS.prototype[typeof xE=="function"&&$Y||"@@asyncIterator"]=function(){return this},ZS.prototype.next=function(e){return this._invoke("next",e)},ZS.prototype.throw=function(e){return this._invoke("throw",e)},ZS.prototype.return=function(e){return this._invoke("return",e)};var Dw=d(B1);function Nw(e){var t,n,s,a=2;for(typeof Symbol<"u"&&(n=Dw,s=Symbol.iterator);a--;){if(n&&(t=e[n])!=null)return t.call(e);if(s&&(t=e[s])!=null)return new Yb(t.call(e));n="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function Yb(e){function t(n){if(Object(n)!==n)return Ye.reject(new TypeError(n+" is not an object."));var s=n.done;return Ye.resolve(n.value).then(function(a){return{value:a,done:s}})}return Yb=function(n){this.s=n,this.n=n.next},Yb.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var s=this.s.return;return s===void 0?Ye.resolve({value:n,done:!0}):t(s.apply(this.s,arguments))},throw:function(n){var s=this.s.return;return s===void 0?Ye.reject(n):t(s.apply(this.s,arguments))}},new Yb(e)}const zY=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let s,a=0;for(;a<n;)s=a+t,yield e.slice(a,s),a=s},XY=function(){var e=ro(function*(t,n){var s,a=!1,l=!1;try{for(var f,m=Nw(JY(t));a=!(f=yield tn(m.next())).done;a=!1){const _=f.value;yield*Wb(Nw(zY(_,n)))}}catch(_){l=!0,s=_}finally{try{a&&m.return!=null&&(yield tn(m.return()))}finally{if(l)throw s}}});return function(t,n){return e.apply(this,arguments)}}(),JY=function(){var e=ro(function*(t){if(t[Dw])return void(yield*Wb(Nw(t)));const n=t.getReader();try{for(;;){const{done:s,value:a}=yield tn(n.read());if(s)break;yield a}}finally{yield tn(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),V1=(e,t,n,s)=>{const a=XY(e,t);let l,f=0,m=_=>{l||(l=!0,s&&s(_))};return new ReadableStream({async pull(_){try{const{done:S,value:b}=await a.next();if(S)return m(),void _.close();let A=b.byteLength;if(n){let O=f+=A;n(O)}_.enqueue(new Uint8Array(b))}catch(S){throw m(S),S}},cancel:_=>(m(_),a.return())},{highWaterMark:2})};function j1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function G1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?j1(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}const qb=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",H1=qb&&typeof ReadableStream=="function",QY=qb&&(typeof TextEncoder=="function"?(K1=new TextEncoder,e=>K1.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var K1;const W1=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return!!e(...n)}catch{return!1}},ZY=H1&&W1(()=>{let e=!1;const t=new Request(Wr.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Lw=H1&&W1(()=>$e.isReadableStream(new Response("").body)),$b={stream:Lw&&(e=>e.body)};var Y1;qb&&(Y1=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!$b[e]&&($b[e]=$e.isFunction(Y1[e])?t=>t[e]():(t,n)=>{throw new Rn("Response type '".concat(e,"' is not supported"),Rn.ERR_NOT_SUPPORT,n)})}));const eq=async(e,t)=>{const n=$e.toFiniteNumber(e.getContentLength());return n??(async s=>s==null?0:$e.isBlob(s)?s.size:$e.isSpecCompliantForm(s)?(await new Request(Wr.origin,{method:"POST",body:s}).arrayBuffer()).byteLength:$e.isArrayBufferView(s)||$e.isArrayBuffer(s)?s.byteLength:($e.isURLSearchParams(s)&&(s+=""),$e.isString(s)?(await QY(s)).byteLength:void 0))(t)};var tq=qb&&(async e=>{let{url:t,method:n,data:s,signal:a,cancelToken:l,timeout:f,onDownloadProgress:m,onUploadProgress:_,responseType:S,headers:b,withCredentials:A="same-origin",fetchOptions:O}=F1(e);S=S?(S+"").toLowerCase():"text";let D,G=HY([a,l&&l.toAbortSignal()],f);const B=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let j;try{if(_&&ZY&&n!=="get"&&n!=="head"&&(j=await eq(b,s))!==0){let ue,oe=new Request(t,{method:"POST",body:s,duplex:"half"});if($e.isFormData(s)&&(ue=oe.headers.get("content-type"))&&b.setContentType(ue),oe.body){const[ye,Pe]=x1(j,Kb(P1(_)));s=V1(oe.body,65536,ye,Pe)}}$e.isString(A)||(A=A?"include":"omit");const Y="credentials"in Request.prototype;D=new Request(t,G1(G1({},O),{},{signal:G,method:n.toUpperCase(),headers:b.normalize().toJSON(),body:s,duplex:"half",credentials:Y?A:void 0}));let q=await fetch(D);const ie=Lw&&(S==="stream"||S==="response");if(Lw&&(m||ie&&B)){const ue={};["status","statusText","headers"].forEach(ze=>{ue[ze]=q[ze]});const oe=$e.toFiniteNumber(q.headers.get("content-length")),[ye,Pe]=m&&x1(oe,Kb(P1(m),!0))||[];q=new Response(V1(q.body,65536,ye,()=>{Pe&&Pe(),B&&B()}),ue)}S=S||"text";let le=await $b[$e.findKey($b,S)||"text"](q,e);return!ie&&B&&B(),await new Ye((ue,oe)=>{L1(ue,oe,{data:le,headers:Yc.from(q.headers),status:q.status,statusText:q.statusText,config:e,request:D})})}catch(Y){throw B&&B(),Y&&Y.name==="TypeError"&&/fetch/i.test(Y.message)?Object.assign(new Rn("Network Error",Rn.ERR_NETWORK,e,D),{cause:Y.cause||Y}):Rn.from(Y,Y&&Y.code,e,D)}});const xw={http:null,xhr:GY,fetch:tq};$e.forEach(xw,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const q1=e=>"- ".concat(e),nq=e=>$e.isFunction(e)||e===null||e===!1;var $1={getAdapter:e=>{e=$e.isArray(e)?e:[e];const{length:t}=e;let n,s;const a={};for(let l=0;l<t;l++){let f;if(n=e[l],s=n,!nq(n)&&(s=xw[(f=String(n)).toLowerCase()],s===void 0))throw new Rn("Unknown adapter '".concat(f,"'"));if(s)break;a[f||"#"+l]=s}if(!s){const l=Object.entries(a).map(f=>{let[m,_]=f;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new Rn("There is no suitable adapter to dispatch the request "+(t?l.length>1?`since :
`+l.map(q1).join(`
`):" "+q1(l[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return s},adapters:xw};function Pw(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new PE(null,e)}function z1(e){return Pw(e),e.headers=Yc.from(e.headers),e.data=Iw.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),$1.getAdapter(e.adapter||Aw.adapter)(e).then(function(t){return Pw(e),t.data=Iw.call(e,e.transformResponse,t),t.headers=Yc.from(t.headers),t},function(t){return N1(t)||(Pw(e),t&&t.response&&(t.response.data=Iw.call(e,e.transformResponse,t.response),t.response.headers=Yc.from(t.response.headers))),Ye.reject(t)})}const X1="1.7.9",zb={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{zb[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const J1={};zb.transitional=function(e,t,n){function s(a,l){return"[Axios v"+X1+"] Transitional option '"+a+"'"+l+(n?". "+n:"")}return(a,l,f)=>{if(e===!1)throw new Rn(s(l," has been removed"+(t?" in "+t:"")),Rn.ERR_DEPRECATED);return t&&!J1[l]&&(J1[l]=!0,console.warn(s(l," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(a,l,f)}},zb.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var Xb={assertOptions:function(e,t,n){if(typeof e!="object")throw new Rn("options must be an object",Rn.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let a=s.length;for(;a-- >0;){const l=s[a],f=t[l];if(f){const m=e[l],_=m===void 0||f(m,l,e);if(_!==!0)throw new Rn("option "+l+" must be "+_,Rn.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Rn("Unknown option "+l,Rn.ERR_BAD_OPTION)}},validators:zb};const Kl=Xb.validators;let Jb=class{constructor(e){this.defaults=e,this.interceptors={request:new nk,response:new nk}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const a=s.stack?s.stack.replace(/^.+\n/,""):"";try{n.stack?a&&!String(n.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+a):n.stack=a}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Jp(this.defaults,t);const{transitional:n,paramsSerializer:s,headers:a}=t;n!==void 0&&Xb.assertOptions(n,{silentJSONParsing:Kl.transitional(Kl.boolean),forcedJSONParsing:Kl.transitional(Kl.boolean),clarifyTimeoutError:Kl.transitional(Kl.boolean)},!1),s!=null&&($e.isFunction(s)?t.paramsSerializer={serialize:s}:Xb.assertOptions(s,{encode:Kl.function,serialize:Kl.function},!0)),Xb.assertOptions(t,{baseUrl:Kl.spelling("baseURL"),withXsrfToken:Kl.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=a&&$e.merge(a.common,a[t.method]);a&&$e.forEach(["delete","get","head","post","put","patch","common"],D=>{delete a[D]}),t.headers=Yc.concat(l,a);const f=[];let m=!0;this.interceptors.request.forEach(function(D){typeof D.runWhen=="function"&&D.runWhen(t)===!1||(m=m&&D.synchronous,f.unshift(D.fulfilled,D.rejected))});const _=[];let S;this.interceptors.response.forEach(function(D){_.push(D.fulfilled,D.rejected)});let b,A=0;if(!m){const D=[z1.bind(this),void 0];for(D.unshift.apply(D,f),D.push.apply(D,_),b=D.length,S=Ye.resolve(t);A<b;)S=S.then(D[A++],D[A++]);return S}b=f.length;let O=t;for(A=0;A<b;){const D=f[A++],G=f[A++];try{O=D(O)}catch(B){G.call(this,B);break}}try{S=z1.call(this,O)}catch(D){return Ye.reject(D)}for(A=0,b=_.length;A<b;)S=S.then(_[A++],_[A++]);return S}getUri(e){return tk(k1((e=Jp(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};$e.forEach(["delete","get","head","options"],function(e){Jb.prototype[e]=function(t,n){return this.request(Jp(n||{},{method:e,url:t,data:(n||{}).data}))}}),$e.forEach(["post","put","patch"],function(e){function t(n){return function(s,a,l){return this.request(Jp(l||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}Jb.prototype[e]=t(),Jb.prototype[e+"Form"]=t(!0)});var Qb=Jb;class kw{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Ye(function(a){n=a});const s=this;this.promise.then(a=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](a);s._listeners=null}),this.promise.then=a=>{let l;const f=new Ye(m=>{s.subscribe(m),l=m}).then(a);return f.cancel=function(){s.unsubscribe(l)},f},t(function(a,l,f){s.reason||(s.reason=new PE(a,l,f),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=s=>{t.abort(s)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new kw(function(s){t=s}),cancel:t}}}var iq=kw;const Mw={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Mw).forEach(e=>{let[t,n]=e;Mw[n]=t});var sq=Mw;const Ks=function e(t){const n=new Qb(t),s=UP(Qb.prototype.request,n);return $e.extend(s,Qb.prototype,n,{allOwnKeys:!0}),$e.extend(s,n,null,{allOwnKeys:!0}),s.create=function(a){return e(Jp(t,a))},s}(Aw);Ks.Axios=Qb,Ks.CanceledError=PE,Ks.CancelToken=iq,Ks.isCancel=N1,Ks.VERSION=X1,Ks.toFormData=Nb,Ks.AxiosError=Rn,Ks.Cancel=Ks.CanceledError,Ks.all=function(e){return Ye.all(e)},Ks.spread=function(e){return function(t){return e.apply(null,t)}},Ks.isAxiosError=function(e){return $e.isObject(e)&&e.isAxiosError===!0},Ks.mergeConfig=Jp,Ks.AxiosHeaders=Yc,Ks.formToJSON=e=>O1($e.isHTMLForm(e)?new FormData(e):e),Ks.getAdapter=$1.getAdapter,Ks.HttpStatusCode=sq,Ks.default=Ks;var Lr=Ks;const rq=()=>{};function ey(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:rq};return e.promise=new Ye((t,n)=>{e.resolve=s=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(s),e.value=s)},e.reject=s=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(s))}}),e}const Zb=new Map,eR=new Map,Wl=new Map;let Qi=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),ln=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const Q1=new v8;let qc=Q1.getResult(),Uw=null;function nn(e){if(!Uw){qc=Q1.getResult();const t=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return ln.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return ln.CHROME;case"Safari":case"Mobile Safari":return ln.SAFARI;case"Edge":return ln.EDGE;case"Firefox":return ln.FIREFOX;case"QQ":case"QQBrowser":return ln.QQ;case"Opera":return ln.OPERA;case"WeChat":return ln.WECHAT;default:return m.browser.name||""}}(qc),n=Z1(qc),s=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(qc),a=qc.os.version,l=Z1(qc,!1),f=qc.device.type;if(!(t&&n&&s&&a))return{name:t,version:n,os:s,osVersion:a,browserVersion:l,deviceType:f};Uw={name:t,version:n,os:s,osVersion:a,browserVersion:l,deviceType:f}}return Uw}function Z1(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function tR(){return nn().os}function eM(){const e=nn();return"".concat(e.os," ").concat(e.osVersion)}function nR(){const e=nn();return!!(qc.engine.name==="WebKit"&&e.os===Qi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==ln.SAFARI||_r()&&e.name!==ln.SAFARI)}function iu(){return nn().name===ln.CHROME}function Cs(){return nn().name===ln.SAFARI}function tM(){return nn().name===ln.EDGE}function oi(){return nn().name===ln.FIREFOX}function _r(){return nn().os===Qi.IOS}function ty(e){const t=nn();return!(t.name!==ln.CHROME||!t.osVersion)&&Number(t.version)>=e}function nM(e){const t=nn();return!(t.name!==ln.CHROME||!t.osVersion)&&Number(t.version)<e}function Fw(e,t,n){const s=nn();return!(s.name!==e||!s.osVersion)&&(n?Number(s.version)>=t&&Number(s.version)<=n:Number(s.version)===t)}function Bw(e){const t=nn();return!(t.name!==ln.EDGE||!t.osVersion)&&Number(t.version)>=e}function iM(e){const t=nn();return!(t.name!==ln.SAFARI||!t.osVersion)&&Number(t.version)>=e}function sM(e,t,n){const s=nn();if(s.os!==Qi.IOS||!s.osVersion)return!1;const a=s.osVersion.split(".");return t&&Number(a[0])===e&&Number(a[1])<t||Number(a[0])<e}function rM(e,t,n){const s=nn();if(s.name!==ln.SAFARI||!s.osVersion||!s.browserVersion)return!1;const a=s.browserVersion.split(".");return n?t&&Number(a[0])===e&&Number(a[1])<t||Number(a[0])<e:t?Number(a[0])===e&&Number(a[1])<=t||Number(a[0])<e:Number(a[0])<=e}function Vw(e){const t=nn();return!(t.name!==ln.OPERA||!t.osVersion)&&Number(t.version)>=e}function aM(){const e=nn();if(e.os!==Qi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function kE(){const e=nn();if(e.os!==Qi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function jw(){const e=nn();if(e.os!==Qi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function oM(){const e=nn();if(e.os!==Qi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Xo(){return Cs()&&navigator.maxTouchPoints>0}function cM(){return nn().name===ln.WECHAT}function lM(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Gw(){const e=tR();return function(){const{deviceType:t}=nn();return t==="mobile"||t==="tablet"}()||e===Qi.ANDROID||e===Qi.IOS||e===Qi.HARMONY_OS}function su(){const e=nn();return e.name!==ln.EDGE&&e.name!==ln.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function iR(){return tR()===Qi.ANDROID}function ny(){const e=nn();return iR()&&(e.name===ln.CHROME||e.name===ln.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function dM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dM(Object(n),!0).forEach(function(s){Lt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dM(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Lt(e,t,n){return(t=function(s){var a=function(l,f){if(typeof l!="object"||l===null)return l;var m=l[Symbol.toPrimitive];if(m!==void 0){var _=m.call(l,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(s);return typeof a=="symbol"?a:String(a)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let $=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),ve=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),Lt(this,"code",void 0),Lt(this,"message",void 0),Lt(this,"data",void 0),Lt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function ru(e,t){if(typeof e!="boolean")throw new ve($.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function zi(e,t,n){if(!We(n).call(n,e))throw new ve($.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function An(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>s||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(a){return typeof a=="number"&&a%1==0}(e))throw new ve($.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(s,"]. integer only"))}function Hw(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new ve($.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&An(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&An(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&An(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&An(e.ideal,"".concat(t,".ideal"),1,1/0)}else An(e,t,1,1/0)}function ms(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,a=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new ve($.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!uM(e,n,s,a))throw new ve($.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(s,"].").concat(a?" ASCII characters only.":""))}function au(e,t){if(!Array.isArray(e))throw new ve($.INVALID_PARAMS,"".concat(t," should be an array"))}function ci(e){return e==null}function uM(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!s||function(a){if(typeof a!="string")return!1;for(let l=0;l<a.length;l+=1){const f=a.charCodeAt(l);if(f<0||f>255)return!1}return!0}(e))}var iy=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(iy||{}),Kw=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(Kw||{});const hM=new class{constructor(){Lt(this,"_clientSize",null),Lt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Lt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Lt(this,"getStyle",e=>window.getComputedStyle(e,null)),Lt(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const s=this.getStyle(e),{display:a,visibility:l,opacity:f,filter:m}=s;return(a==="none"||We(t=["hidden","collapse"]).call(t,l)||Number(f)<.1)&&(n=!1),!!n&&(m&&m.split(" ").filter(_=>{var S;const b=_.split("(")[0];return We(S=["brightness","blur","opacity"]).call(S,b)}).map(_=>{const[S,b]=_.split(/\(|\)/);return[S,Number(b.match(/^[0-9\.]+/))]}).forEach(_=>{const[S,b]=_;switch(S){case"brightness":(b<.1||b>3)&&(n=!1);break;case"blur":b>3&&(n=!1);break;case"opacity":b<.1&&(n=!1)}}),n)}),Lt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,s=!0;const a=f=>t(f);let l=e;for(;l&&s;)a(l)||(n=!1,s=!1),l=l.parentElement,l||(s=!1);return n}),Lt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Lt(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:s,right:a,top:l,bottom:f}=e.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:t,height:n,left:s,right:a,top:l,bottom:f,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),Lt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),Lt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Lt(this,"checkCoverForAPoint",(e,t,n)=>{const s=this.elementFromPoint(e,t);return s!==null&&s!==n}),Lt(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:s}=this._clientSize,a=e/6,l=t/6,f=[],m=10**6;for(let _=0;_<5;_++)for(let S=0;S<5;S++){const b=(n*m+(_===0?.1:_===4?(a*_*m-1e5)/m:a*_)*m)/m,A=(s*m+(S===0?.1:S===4?(l*S*m-1e5)/m:l*S)*m)/m;f.push({x:b,y:A})}return[...f]}),Lt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Lt(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),Lt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:s,clientHeight:a,clientWidth:l,clientMin:f}=this._clientSize;let m,_,S,b;if(e<0)m=0;else{if(!(e<l))return!1;m=e}if(t<0)return!1;if(_=t<l?t:l,n<0)S=0;else{if(!(n<a))return!1;S=n}if(s<0)return!1;b=s<a?s:a;const A=_-m,O=b-S;return this.checkSizeIsVisible(A,O,f)}),Lt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Lt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(iy.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(iy.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(iy.SIZE)}}return this.returnHiddenResult(iy.STYLE)}return this.returnHiddenResult(Kw.UNMOUNTED)}return this.returnHiddenResult(Kw.INVALID_HTML_ELEMENT)}),Lt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function Ww(e){return new TextEncoder().encode(e)}const fM=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},Yw=async e=>function(t,n){let s="";return new Uint8Array(t).forEach(a=>{s+=a.toString(n).padStart(2,"0")}),s}(await crypto.subtle.digest("SHA-256",Ww(e)),16);let ii=class{constructor(){Lt(this,"_events",{}),Lt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],s=this._indexOfListener(n,t);s!==-1&&n.splice(s,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(l=>l);for(var n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];for(let l=0;l<t.length;l+=1){const f=t[l];f.once&&this.off(e,f.listener),f.listener.apply(this,s||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];[...this._events[e]||[]].forEach(a=>{a.once&&this.off(e,a.listener);try{a.listener.apply(this,n)}catch(l){console.error("safeEmit event:".concat(e," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},sy=null;function pM(){if(sy)return sy;if(window.electron)return sy=window.electron;if(!window.require)return null;try{return sy=window.require("electron"),sy}catch{return null}}let Fi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),li=function(e){return e.TRACER="tracer",e}({});function mM(e){return An(e.timeout,"config.timeout",0,1e5),An(e.timeoutFactor,"config.timeoutFactor",0,100,!1),An(e.maxRetryCount,"config.maxRetryConfig",0,1/0),An(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let aq=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),pn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function ry(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function gM(e){return ms(e.turnServerURL,"turnServerURL"),ms(e.username,"username"),ms(e.password,"password"),e.udpport&&An(e.udpport,"udpport",1,99999,!0),e.forceturn&&ru(e.forceturn,"forceturn"),e.security&&ru(e.security,"security"),e.tcpport&&An(e.tcpport,"tcpport",1,99999,!0),!0}function qw(e){return e.level!==void 0&&zi(e.level,"level",[1,2,3]),e.delay!==void 0&&An(e.delay,"delay",0,3e3,!0),!0}let Wt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Is=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),ga=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),ME=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ws(e,t){for(var n=arguments.length,s=new Array(n>2?n-2:0),a=2;a<n;a++)s[a-2]=arguments[a];return e.getListeners(t).length===0?Ye.reject(new ve($.UNEXPECTED_ERROR,"can not emit promise")):new Ye((l,f)=>{e.emit(t,...s,l,f)})}function xn(e,t){if(e.getListeners(t).length===0)return Ye.resolve();for(var n=arguments.length,s=new Array(n>2?n-2:0),a=2;a<n;a++)s[a-2]=arguments[a];return ws(e,t,...s)}function La(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,s=new Array(n>2?n-2:0),a=2;a<n;a++)s[a-2]=arguments[a];return ay(e,t,...s)}function ay(e,t){let n=null,s=null;for(var a=arguments.length,l=new Array(a>2?a-2:0),f=2;f<a;f++)l[f-2]=arguments[f];if(e.emit(t,...l,m=>{n=m},m=>{s=m}),s!==null)throw s;if(n===null)throw new ve($.UNEXPECTED_ERROR,"handler is not sync");return n}const Di=new class extends ii{set networkState(e){this.emit(ME.NETWORK_STATE_CHANGE,e,this._networkState),e===ga.ONLINE?this.emit(ME.ONLINE):e===ga.OFFLINE&&(this.onlineWaiter=new Ye(t=>{this.once(ME.ONLINE,()=>{this.onlineWaiter=void 0,t(ga.ONLINE)})}),this.emit(ME.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ga.ONLINE}constructor(){super(),Lt(this,"_moduleName","network-indicator"),Lt(this,"_networkState",ga.ONLINE),Lt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ga.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ga.OFFLINE})}};function sR(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function UE(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function rR(e){Ye!==void 0?Ye.resolve().then(e):setTimeout(e,0)}function di(e){return JSON.parse(JSON.stringify(e))}function Qp(e){try{return di(e)}catch{return e}}const EM={};function Uh(e,t){EM[t]||(EM[t]=!0,e())}function Zp(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let s=0;s<t.length;s+=1)n[s]=t.charCodeAt(s);return n}function Fh(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function _M(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const s=new Uint8Array(t);s.set(n),n=s}return n}function SM(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=jr(t).call(t,(f,m)=>f+m.length,0),a=new Uint8Array(new ArrayBuffer(s));let l=0;return t.forEach(f=>{a.set(f,l),l+=f.length}),a}function Yl(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function yM(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?Yl(n):n.size}),t+138}function oq(e){const t=new ve($.TIMEOUT,"timeout");return new Ye((n,s)=>{window.setTimeout(()=>s(t),e)})}function gs(e){return new Ye(t=>{window.setTimeout(t,e)})}function Pn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Pn(e-n.length,"")}function em(){return Pn(32,"").toUpperCase()}const aR=()=>{},TM=new class{constructor(){Lt(this,"fnMap",new Map)}throttleByKey(e,t,n,s){for(var a=arguments.length,l=new Array(a>4?a-4:0),f=4;f<a;f++)l[f-4]=arguments[f];if(this.fnMap.has(t)){const m=this.fnMap.get(t);if(m.threshold!==n){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const S=this.fnMap.get(t);S&&S.fn(...S.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:_,args:l,skipFn:s})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(t,rt(rt({},m),{},{fn:e,args:l,skipFn:s}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(t);_&&_.fn(..._.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:m,args:l,skipFn:s})}}},vM=TM.throttleByKey.bind(TM);function bM(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function $w(e,t){if(!bM(e)||!bM(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let s=0;s<t.length;s++)n[s]=$w(e[s],t[s]);return n}{const n=rt({},e);for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(Object.prototype.hasOwnProperty.call(e,s)?n[s]=$w(e[s],t[s]):n[s]=t[s]);return n}}function RM(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let s=0;for(;e>0&&(n[s]=255&e,e>>=8,s++,s!==t););return n}function zw(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function AM(e){const t="0123456789abcdef";function n(ie){let le,ue="";for(le=0;le<=3;le++)ue+=t.charAt(ie>>8*le+4&15)+t.charAt(ie>>8*le&15);return ue}function s(ie,le){const ue=(65535&ie)+(65535&le);return(ie>>16)+(le>>16)+(ue>>16)<<16|65535&ue}function a(ie,le,ue,oe,ye,Pe){return s(function(ze,nt){return ze<<nt|ze>>>32-nt}(s(s(le,ie),s(oe,Pe)),ye),ue)}function l(ie,le,ue,oe,ye,Pe,ze){return a(le&ue|~le&oe,ie,le,ye,Pe,ze)}function f(ie,le,ue,oe,ye,Pe,ze){return a(le&oe|ue&~oe,ie,le,ye,Pe,ze)}function m(ie,le,ue,oe,ye,Pe,ze){return a(le^ue^oe,ie,le,ye,Pe,ze)}function _(ie,le,ue,oe,ye,Pe,ze){return a(ue^(le|~oe),ie,le,ye,Pe,ze)}const S=function(ie){let le;const ue=1+(ie.length+8>>6),oe=new Array(16*ue);for(le=0;le<16*ue;le++)oe[le]=0;for(le=0;le<ie.length;le++)oe[le>>2]|=ie.charCodeAt(le)<<le%4*8;return oe[le>>2]|=128<<le%4*8,oe[16*ue-2]=8*ie.length,oe}(e);let b,A,O,D,G,B=1732584193,j=-271733879,Y=-1732584194,q=271733878;for(b=0;b<S.length;b+=16)A=B,O=j,D=Y,G=q,B=l(B,j,Y,q,S[b+0],7,-680876936),q=l(q,B,j,Y,S[b+1],12,-389564586),Y=l(Y,q,B,j,S[b+2],17,606105819),j=l(j,Y,q,B,S[b+3],22,-1044525330),B=l(B,j,Y,q,S[b+4],7,-176418897),q=l(q,B,j,Y,S[b+5],12,1200080426),Y=l(Y,q,B,j,S[b+6],17,-1473231341),j=l(j,Y,q,B,S[b+7],22,-45705983),B=l(B,j,Y,q,S[b+8],7,1770035416),q=l(q,B,j,Y,S[b+9],12,-1958414417),Y=l(Y,q,B,j,S[b+10],17,-42063),j=l(j,Y,q,B,S[b+11],22,-1990404162),B=l(B,j,Y,q,S[b+12],7,1804603682),q=l(q,B,j,Y,S[b+13],12,-40341101),Y=l(Y,q,B,j,S[b+14],17,-1502002290),j=l(j,Y,q,B,S[b+15],22,1236535329),B=f(B,j,Y,q,S[b+1],5,-165796510),q=f(q,B,j,Y,S[b+6],9,-1069501632),Y=f(Y,q,B,j,S[b+11],14,643717713),j=f(j,Y,q,B,S[b+0],20,-373897302),B=f(B,j,Y,q,S[b+5],5,-701558691),q=f(q,B,j,Y,S[b+10],9,38016083),Y=f(Y,q,B,j,S[b+15],14,-660478335),j=f(j,Y,q,B,S[b+4],20,-405537848),B=f(B,j,Y,q,S[b+9],5,568446438),q=f(q,B,j,Y,S[b+14],9,-1019803690),Y=f(Y,q,B,j,S[b+3],14,-187363961),j=f(j,Y,q,B,S[b+8],20,1163531501),B=f(B,j,Y,q,S[b+13],5,-1444681467),q=f(q,B,j,Y,S[b+2],9,-51403784),Y=f(Y,q,B,j,S[b+7],14,1735328473),j=f(j,Y,q,B,S[b+12],20,-1926607734),B=m(B,j,Y,q,S[b+5],4,-378558),q=m(q,B,j,Y,S[b+8],11,-2022574463),Y=m(Y,q,B,j,S[b+11],16,1839030562),j=m(j,Y,q,B,S[b+14],23,-35309556),B=m(B,j,Y,q,S[b+1],4,-1530992060),q=m(q,B,j,Y,S[b+4],11,1272893353),Y=m(Y,q,B,j,S[b+7],16,-155497632),j=m(j,Y,q,B,S[b+10],23,-1094730640),B=m(B,j,Y,q,S[b+13],4,681279174),q=m(q,B,j,Y,S[b+0],11,-358537222),Y=m(Y,q,B,j,S[b+3],16,-722521979),j=m(j,Y,q,B,S[b+6],23,76029189),B=m(B,j,Y,q,S[b+9],4,-640364487),q=m(q,B,j,Y,S[b+12],11,-421815835),Y=m(Y,q,B,j,S[b+15],16,530742520),j=m(j,Y,q,B,S[b+2],23,-995338651),B=_(B,j,Y,q,S[b+0],6,-198630844),q=_(q,B,j,Y,S[b+7],10,1126891415),Y=_(Y,q,B,j,S[b+14],15,-1416354905),j=_(j,Y,q,B,S[b+5],21,-57434055),B=_(B,j,Y,q,S[b+12],6,1700485571),q=_(q,B,j,Y,S[b+3],10,-1894986606),Y=_(Y,q,B,j,S[b+10],15,-1051523),j=_(j,Y,q,B,S[b+1],21,-2054922799),B=_(B,j,Y,q,S[b+8],6,1873313359),q=_(q,B,j,Y,S[b+15],10,-30611744),Y=_(Y,q,B,j,S[b+6],15,-1560198380),j=_(j,Y,q,B,S[b+13],21,1309151649),B=_(B,j,Y,q,S[b+4],6,-145523070),q=_(q,B,j,Y,S[b+11],10,-1120210379),Y=_(Y,q,B,j,S[b+2],15,718787259),j=_(j,Y,q,B,S[b+9],21,-343485551),B=s(B,A),j=s(j,O),Y=s(Y,D),q=s(q,G);return n(B)+n(j)+n(Y)+n(q)}let cq=1,CM=console,Ps=class{static setLogger(e){CM=e}constructor(e,t){Lt(this,"id",void 0),Lt(this,"lockingPromise",Ye.resolve()),Lt(this,"locks",0),Lt(this,"name",""),Lt(this,"lockId",void 0),this.lockId=cq++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),s=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");CM.debug("".concat(n," ").concat(s))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new Ye(a=>{t=()=>{this.locks-=1,this.logger("unlocked",e),a()}}),s=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),s}};function FE(e,t){return function(n,s,a){const l=a.value;if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){const f=this[t];if(!f)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const m=await f.lock("From ".concat(e,".").concat(s));try{for(var _=arguments.length,S=new Array(_),b=0;b<_;b++)S[b]=arguments[b];return await l.apply(this,S)}finally{m()}},a}}const Bi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Xw(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function $c(e,t,n,s){const a=Object.assign({},Bi,s);let l=a.timeout;const f=async()=>{await function(S){return new Ye(b=>{window.setTimeout(b,S)})}(l),l*=a.timeoutFactor,l=Math.min(a.maxRetryTimeout,l)};let m=!1;const _=new Ye(async(S,b)=>{t=t||(()=>!1),n=n||(()=>!0);for(let A=0;A<a.maxRetryCount;A+=1){if(m)return b(new ve($.OPERATION_ABORTED));try{const O=await e();if(!t(O,A)||A+1===a.maxRetryCount)return S(O);await f()}catch(O){if(!n(O,A)||A+1===a.maxRetryCount)return b(O);await f()}}});return _.cancel=()=>m=!0,_}let oR,IM=class{constructor(e){Lt(this,"input",[]),Lt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:jr(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},cR=0,Jw=0;function Qw(e,t,n,s){return new Ye((a,l)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),cR+=Yl(t.data)):n&&(t.data.size?cR+=t.data.size:t.data instanceof FormData?cR+=yM(t.data):cR+=Yl(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Lr.request(t).then(f=>{typeof f.data=="string"?Jw+=Yl(f.data):f.data instanceof ArrayBuffer||f.data instanceof Uint8Array?Jw+=f.data.byteLength:Jw+=Yl(JSON.stringify(f.data)),a(f.data)}).catch(f=>{Lr.isCancel(f)?l(new ve($.OPERATION_ABORTED,"cancel token canceled")):f.code==="ECONNABORTED"?l(new ve($.NETWORK_TIMEOUT,f.message)):f.response?l(new ve($.NETWORK_RESPONSE_ERROR,f.response.status)):l(new ve($.NETWORK_ERROR,f.message))})})}async function lq(e,t){const n=new Blob([t.data],{type:"buffer"});return await Qw(e,rt(rt({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const wM=()=>window.isSecureContext!==void 0;function Jo(e){if(Array.isArray(e))return e.map(n=>n);if(!OM(e))return e;const t={};for(const n in e){const s=e[n];OM(s)||Array.isArray(s)?t[n]=Jo(s):t[n]=s}return t}function OM(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let Zw=class{constructor(e){Lt(this,"input",[]),Lt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const ql={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},oy={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:ql,remoteCandidate:ql},updateInterval:0},DM={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},NM={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},LM={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},xM={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let eO=class{constructor(e,t){Lt(this,"onFirstVideoReceived",void 0),Lt(this,"onFirstVideoDecoded",void 0),Lt(this,"onFirstAudioReceived",void 0),Lt(this,"onFirstVideoDecodedTimeout",void 0),Lt(this,"onFirstAudioDecoded",void 0),Lt(this,"onSelectedLocalCandidateChanged",void 0),Lt(this,"onSelectedRemoteCandidateChanged",void 0),Lt(this,"videoIsReady",!1),Lt(this,"videoIsReady2",{}),Lt(this,"pc",void 0),Lt(this,"options",void 0),Lt(this,"intervalTimer",void 0),Lt(this,"stats",Jo(oy)),Lt(this,"isFirstVideoReceived",{}),Lt(this,"isFirstVideoDecoded",{}),Lt(this,"isFirstAudioReceived",{}),Lt(this,"isFirstAudioDecoded",{}),Lt(this,"isFirstVideoDecodedTimeout",{}),Lt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Ye(e=>{e({local:rt({},ql),remote:rt({},ql)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,a=0,l=0,f=0;for(const m of n)e[m].forEach((_,S)=>{if(!this.lossRateWindowStats[t-1][m][S]||!this.lossRateWindowStats[0][m][S])return;const b=this.lossRateWindowStats[t-1][m][S].packets-this.lossRateWindowStats[0][m][S].packets,A=this.lossRateWindowStats[t-1][m][S].packetsLost-this.lossRateWindowStats[0][m][S].packetsLost;m==="videoSend"||m==="audioSend"?(s+=b,l+=A):(a+=b,f+=A),Number.isNaN(b)||Number.isNaN(b)?_.packetLostRate=0:_.packetLostRate=b<=0||A<=0?0:A/(b+A)});e.sendPacketLossRate=s<=0||l<=0?0:l/(s+l),e.recvPacketLossRate=a<=0||f<=0?0:f/(a+f)}},dq=class extends eO{constructor(){super(...arguments),Lt(this,"_stats",oy),Lt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Jo(oy);const n=t.filter(a=>a.type==="ssrc");this.processSSRCStats(n);const s=t.find(a=>a.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const s=We(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const a=Jo(NM);a.codec=t.googCodecName,a.adaptionChangeReason="none",t.googCpuLimitedResolution&&(a.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(a.adaptionChangeReason="bandwidth"),a.avgEncodeMs=Number(t.googAvgEncodeMs),a.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.firsCount=Number(t.googFirReceived),a.nacksCount=Number(t.googNacksReceived),a.plisCount=Number(t.googPlisReceived),a.frameCount=Number(t.framesEncoded),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(a),this._stats.rtt=a.rttMs;break}case"video_recv":{const a=Jo(DM),l=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(a.codec=t.googCodecName,a.targetDelayMs=Number(t.googTargetDelayMs),a.renderDelayMs=Number(t.googRenderDelayMs),a.currentDelayMs=Number(t.googCurrentDelayMs),a.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),a.decodeMs=Number(t.googDecodeMs),a.maxDecodeMs=Number(t.googMaxDecodeMs),a.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},a.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},a.decodeFrameRate=Number(t.googFrameRateDecoded),a.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},a.jitterBufferMs=Number(t.googJitterBufferMs),a.firsCount=Number(t.googFirsSent),a.nacksCount=Number(t.googNacksSent),a.plisCount=Number(t.googPlisSent),a.framesDecodeCount=Number(t.framesDecoded),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.packets>0&&!this.isFirstVideoReceived[a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(a.ssrc),this.isFirstVideoReceived[a.ssrc]=!0),a.framesDecodeCount>0&&!this.isFirstVideoDecoded[a.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(a.ssrc,a.decodedFrame.width,a.decodedFrame.height),this.isFirstVideoDecoded[a.ssrc]=!0),l){const f=l.stats,m=Date.now()-l.lts;a.framesDecodeFreezeTime=f.framesDecodeFreezeTime,a.framesDecodeInterval=f.framesDecodeInterval,a.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[a.ssrc]?(l.lts=Date.now(),a.framesDecodeInterval=m,a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):a.framesDecodeCount<l.stats.framesDecodeCount&&(a.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:rt({},a),lts:Date.now()}),this._stats.videoRecv.push(a);break}case"audio_recv":{const a=Jo(xM);a.codec=t.googCodecName,a.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,a.decodingCNG=Number(t.googDecodingCNG),a.decodingCTN=Number(t.googDecodingCTN),a.decodingCTSG=Number(t.googDecodingCTSG),a.decodingNormal=Number(t.googDecodingNormal),a.decodingPLC=Number(t.googDecodingPLC),a.decodingPLCCNG=Number(t.googDecodingPLCCNG),a.expandRate=Number(t.googExpandRate),a.accelerateRate=Number(t.googAccelerateRate),a.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),a.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),a.speechExpandRate=Number(t.googSpeechExpandRate),a.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),a.jitterBufferMs=Number(t.googJitterBufferMs),a.jitterMs=Number(t.googJitterReceived),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),a.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),a.receivedFrames>0&&!this.isFirstAudioReceived[a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(a.ssrc),this.isFirstAudioReceived[a.ssrc]=!0),a.decodingNormal>0&&!this.isFirstAudioDecoded[a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(a.ssrc),this.isFirstAudioDecoded[a.ssrc]=!0),this._stats.audioRecv.push(a);break}case"audio_send":{const a=Jo(LM);a.codec=t.googCodecName,a.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,a.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),a.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),a.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),a.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.rtt=a.rttMs,this._stats.audioSend.push(a);break}}})}_getStats(){return new Ye((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const s={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(a=>{s[a]=n.stat(a)}),t.push(s)}),t}},cy=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),lR=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),tO=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),xa=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var BE=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(BE||{});function ly(e,t,n,s){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:BE.kNone;if(!t)return;const l=Number(t[n]);if(typeof l!="number")return;const f=Number(t[s]);if(typeof f!="number")return;if(!e)return f?l/f*a:void 0;const m=Number(e[n]);if(typeof m!="number")return;const _=Number(e[s]);if(typeof _!="number")return;const S=f-_;return S?(l-m)/S*a:void 0}let PM=class extends eO{constructor(){super(...arguments),Lt(this,"_stats",oy),Lt(this,"report",void 0),Lt(this,"lastDecodeVideoReceiverStats",new Map),Lt(this,"lastVideoFramesRecv",new Map),Lt(this,"lastVideoFramesSent",new Map),Lt(this,"lastVideoFramesDecode",new Map),Lt(this,"lastVideoFramesOutput",new Map),Lt(this,"lastVideoJBDelay",new Map),Lt(this,"lastAudioJBDelay",new Map),Lt(this,"mediaBytesSent",new Map),Lt(this,"mediaBytesRetransmit",new Map),Lt(this,"mediaBytesTargetEncode",new Map),Lt(this,"lastDecodeAudioReceiverStats",new Map),Lt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Jo(oy),this.report.forEach(e=>{switch(e.type){case xa.OUTBOUND:case xa.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,s=!t&&!("frameWidth"in e);e.type===xa.OUTBOUND?t==="audio"||s?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===xa.INBOUND&&(t==="audio"||s?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case xa.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case xa.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:rt({},ql),remote:rt({},ql)};return e.forEach(n=>{let s;if(n.type===xa.TRANSPORT&&(s=e.get(n.selectedCandidatePairId)),n.type===xa.CANDIDATE_PAIR&&n.selected&&(s=n),s){const a=(l,f)=>{l.type=f.type,l.id=f.id,f.address&&(l.address=f.address),f.candidateType&&(l.candidateType=f.candidateType),f.port&&(l.port=f.port),f.priority&&(l.priority=f.priority),f.protocol&&(l.protocol=f.protocol),f.relayProtocol&&(l.relayProtocol=f.relayProtocol)};if(s.localCandidateId){const l=e.get(s.localCandidateId);l&&a(t.local,l)}if(s.remoteCandidateId){const l=e.get(s.remoteCandidateId);l&&a(t.remote,l)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===xa.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===xa.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===xa.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(rt({},t),rt({},this.stats.selectedCandidatePair.localCandidate)),e.type===xa.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(rt({},t),rt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(s=>s.ssrc===e.ssrc);t||(t=Jo(xM),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=ly(n,t,"totalProcessingDelay","jitterBufferEmittedCount",BE.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,rt({},t))}processVideoInboundStats(e){let t=this._stats.videoRecv.find(f=>f.ssrc===e.ssrc);t||(t=Jo(DM),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),s=this.lastVideoFramesDecode.get(t.ssrc),a=this.lastVideoFramesOutput.get(t.ssrc),l=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const f=t.decodedFrame?t.decodedFrame.width:0,m=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,f,m),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const f=n.stats,m=l-n.lts;t.framesDecodeFreezeTime=f.framesDecodeFreezeTime,t.framesDecodeInterval=f.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=m,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<f.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=ly(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=ly(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",BE.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=ly(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",BE.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=ly(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",BE.kMillisecondsFromSeconds),s&&l-s.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-s.count)/((l-s.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:t.decodeFrameRate})):s?t.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:0}),t.framesDroppedCount&&e.framesReceived&&(a&&l-a.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-a.count)/((l-a.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:Math.max(t.outputFrameRate,0)})):a?t.outputFrameRate=a.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:rt({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(s=>s.ssrc===e.ssrc);t||(t=Jo(NM),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const s=new Zw(10);s.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,s)}if(e.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(e.ssrc);if(s)s.add(e.retransmittedBytesSent);else{const a=new Zw(10);a.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,a)}}if(e.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(e.ssrc);if(s)s.add(e.totalEncodedBytesTarget);else{const a=new Zw(10);a.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,a)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const s=this.lastEncoderMs.get(e.ssrc);if(!s||s.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const a=e.framesEncoded-s.lastFrameCount,l=e.totalEncodeTime-s.lastEncoderTime;t.avgEncodeMs=1e3*l/a}}if(e.framesEncoded&&e.qpSum){const s=this.lastEncoderMs.get(e.ssrc);!s||s.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-s.lastQpSum)/(e.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const s=this.findRemoteStatsId(e.ssrc,xa.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=Jo(LM),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,xa.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const s=Array.from(ps(n=this.report).call(n)).find(a=>a.type===t&&a.ssrc===e);return s?s.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var s,a,l,f;const m=t?this.report.get(t):void 0,_=(s=m==null?void 0:m.framesSent)!==null&&s!==void 0?s:e.framesSent;if(typeof _!="number")return;let S=(a=m==null?void 0:m.frameWidth)!==null&&a!==void 0?a:e.frameWidth,b=(l=m==null?void 0:m.frameHeight)!==null&&l!==void 0?l:e.frameHeight,A=(f=m==null?void 0:m.framesPerSecond)!==null&&f!==void 0?f:e.framesPerSecond;if(typeof S=="number"&&typeof b=="number"||(S=0,b=0),A==null){const O=Date.now(),D=this.lastVideoFramesSent.get(n.ssrc);D&&O-D.lts>=800?(A=Math.round((_-D.count)/((O-D.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:_,lts:O,rate:A})):D?A=D.rate:this.lastVideoFramesSent.set(n.ssrc,{count:_,lts:O,rate:0})}n.sentFrame={width:S,height:b,frameRate:Math.max(0,A)}}processVideoTrackReceiverStats(e,t,n){var s,a,l,f,m;const _=t?this.report.get(t):void 0,S=(s=_==null?void 0:_.framesReceived)!==null&&s!==void 0?s:e.framesReceived,b=(a=_==null?void 0:_.frameWidth)!==null&&a!==void 0?a:e.frameWidth,A=(l=_==null?void 0:_.frameHeight)!==null&&l!==void 0?l:e.frameHeight,O=(f=_==null?void 0:_.jitterBufferDelay)!==null&&f!==void 0?f:e.jitterBufferDelay,D=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof S=="number"){const G=this.lastVideoFramesRecv.get(n.ssrc),B=Date.now();n.framesReceivedCount=S;let j=0;G&&B-G.lts>=800?(j=Math.round((S-G.count)/((B-G.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:S,lts:B,rate:j})):G?j=G.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:S,lts:B,rate:0}),n.receivedFrame={width:b||0,height:A||0,frameRate:j||0},n.decodedFrame={width:b||0,height:A||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:b||0,height:A||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(O&&D){const G=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let B=G.jitterBufferMs;const j=D-G.jitterBufferEmittedCount;j>0&&(B=1e3*(O-G.jitterBufferDelay)/j),n.jitterBufferMs=B,n.currentDelayMs=Math.round(B),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:D,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var s,a,l,f;const m=t?this.report.get(t):void 0,_=(s=(a=m==null?void 0:m.echoReturnLoss)!==null&&a!==void 0?a:e.echoReturnLoss)!==null&&s!==void 0?s:0,S=(l=(f=m==null?void 0:m.echoReturnLossEnhancement)!==null&&f!==void 0?f:e.echoReturnLossEnhancement)!==null&&l!==void 0?l:0;n.aecReturnLoss=_,n.aecReturnLossEnhancement=S}processAudioTrackReceiverStats(e,t,n){var s,a,l,f,m,_,S;const b=t?this.report.get(t):void 0,A=(s=b==null?void 0:b.removedSamplesForAcceleration)!==null&&s!==void 0?s:e.removedSamplesForAcceleration,O=(a=b==null?void 0:b.totalSamplesReceived)!==null&&a!==void 0?a:e.totalSamplesReceived,D=(l=b==null?void 0:b.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,G=(f=b==null?void 0:b.jitterBufferEmittedCount)!==null&&f!==void 0?f:e.jitterBufferEmittedCount,B=(m=b==null?void 0:b.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,j=(_=b==null?void 0:b.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,Y=(S=b==null?void 0:b.concealedSamples)!==null&&S!==void 0?S:e.concealedSamples;if(typeof O=="number"&&(n.totalSamplesReceived=O),A&&O&&(n.accelerateRate=A/O),D&&G){const ie=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let le=ie.jitterBufferMs;const ue=G-ie.jitterBufferEmittedCount;ue>0&&(le=1e3*(D-ie.jitterBufferDelay)/ue),n.jitterBufferMs=Math.round(le),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:D,jitterBufferEmittedCount:G,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=B;let q=1920;j&&O&&(q=O/j/50,n.receivedFrames=Math.round(O/q)),Y&&(n.droppedFrames=Math.round(Y/q))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(a=>{e+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{t=t===null?a.diffMean():t+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{n=n===null?a.diffMean():n+a.diffMean()});const s=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},uq=class extends eO{updateStats(){return Ye.resolve()}};function nO(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const l=function(){const f=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return f&&f[0]?Number(f[0].split("/")[1]):null}();return l?l<76?new dq(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s,firstVideoDecodedTimeout:a}):new PM(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s,firstVideoDecodedTimeout:a}):function(f){if(!window.RTCStatsReport)return!1;const m=f.getStats();return!!(m instanceof Ye||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(e)?new PM(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s,firstVideoDecodedTimeout:a}):new uq(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s,firstVideoDecodedTimeout:a})}const kM="websdk_ng_install_id";function iO(){try{if(Z("INSTALL_ID"))return Z("INSTALL_ID");let e=window.localStorage.getItem(kM);return e||(e=em(),window.localStorage.setItem(kM,e)),vn("INSTALL_ID",e),e}catch{return}}const ao=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],s=t[2];return"".concat(n,".").concat(s)}return"4.0.0.999"}("4.23.2"),sO=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let tm=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const Os=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const s=n.join(""),a=[];for(let m=0;m<6;m++)a.push("1");const l=a.join(""),f={};return f[e]=s,f[t]=l,Object.assign(f,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Os;const dR={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},rO={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},aO="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",oO={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},Hn=rt(rt(rt({},oO),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:rO,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},dR),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function vn(e,t,n){var s,a,l;We(s=Object.keys(Hn)).call(s,e)&&(!n&&We(a=Object.keys(zc)).call(a,e)||(Hn[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||t!==!0||(Hn.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(Hn.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&t&&(l=!!t,Hn.USE_NEW_NETWORK_CONFIG=l,l&&(Hn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Hn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Hn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Hn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Hn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Hn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Hn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Hn.ENABLE_INSTANT_VIDEO=!0,Hn.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Hn.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Hn.NEW_TURN_MODE||(Hn.NEW_TURN_MODE=4))))}function Z(e){return Hn[e]}sO||(Hn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Hn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Hn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Hn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Hn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Hn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Hn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Hn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Hn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Hn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Hn.AREAS=["NORTH_AMERICA","OVERSEA"]);let MM=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const zc={};var Yt=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Yt||{});let uR=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const UM=128,hq=96,FM=1e3,VE=10;let fq=0;var BM=(()=>{var e={8:(s,a,l)=>{l.r(a),l.d(a,{Parser:()=>ze,Printer:()=>Ai,parse:()=>je,print:()=>pt});const f=`
`,m="".concat("\r").concat(f),_=" ";let S;function b(De){return De>="0"&&De<="9"}function A(De){return De>="!"&&De<="~"}function O(De){return A(De)||De>=""&&De<=""}function D(De){return De==="!"||De>="#"&&De<="'"||De>="*"&&De<="+"||De>="-"&&De<="."||De>="0"&&De<="9"||De>="A"&&De<="Z"||De>="^"&&De<="~"}function G(De){return De>="1"&&De<="9"}function B(De){return De>="A"&&De<="Z"||De>="a"&&De<="z"}function j(De){return De==="d"||De==="h"||De==="m"||De==="s"}function Y(De){return De>""&&De<"	"||De>"\v"&&De<"\f"||De>""&&De<""}function q(De){return B(De)||b(De)||De==="+"||De==="/"}function ie(De){return b(De)||B(De)||De==="+"||De==="/"||De==="-"||De==="_"}function le(De){return B(De)||b(De)||De==="+"||De==="/"}function ue(De,F){var te=Object.keys(De);if(Object.getOwnPropertySymbols){var re=Object.getOwnPropertySymbols(De);F&&(re=re.filter(function(Me){return Object.getOwnPropertyDescriptor(De,Me).enumerable})),te.push.apply(te,re)}return te}function oe(De){for(var F=1;F<arguments.length;F++){var te=arguments[F]!=null?arguments[F]:{};F%2?ue(Object(te),!0).forEach(function(re){ye(De,re,te[re])}):Object.getOwnPropertyDescriptors?Object.defineProperties(De,Object.getOwnPropertyDescriptors(te)):ue(Object(te)).forEach(function(re){Object.defineProperty(De,re,Object.getOwnPropertyDescriptor(te,re))})}return De}function ye(De,F,te){return F in De?Object.defineProperty(De,F,{value:te,enumerable:!0,configurable:!0,writable:!0}):De[F]=te,De}(function(De){De.VERSION="v",De.ORIGIN="o",De.SESSION_NAME="s",De.INFORMATION="i",De.URI="u",De.EMAIL="e",De.PHONE="p",De.CONNECTION="c",De.BANDWIDTH="b",De.TIME="t",De.REPEAT="r",De.ZONE_ADJUSTMENTS="z",De.KEY="k",De.ATTRIBUTE="a",De.MEDIA="m"})(S||(S={}));class Pe{consumeText(F,te){let re=te;for(;re<F.length;){const Me=F[re];if(Me==="\0"||Me==="\r"||Me===f)break;re+=1}if(re-te==0)throw new Error("Invalid text, at ".concat(F));return re}consumeUnicastAddress(F,te,re){return this.consumeTill(F,te,_)}consumeOneOrMore(F,te,re){let Me=te;for(;re(F[Me]);)Me++;if(Me-te==0)throw new Error("Invalid rule at ".concat(te,"."));return Me}consumeSpace(F,te){if(F[te]===_)return te+1;throw new Error("Invalid space at ".concat(te,"."))}consumeIP4Address(F,te){let re=te;for(let Me=0;Me<4;Me++)if(re=this.consumeDecimalUChar(F,re),Me!==3){if(F[re]!==".")throw new Error("Invalid IP4 address.");re++}return re}consumeDecimalUChar(F,te){let re=te;for(let Pt=0;Pt<3&&b(F[re]);Pt++,re++);if(re-te==0)throw new Error("Invalid decimal uchar.");const Me=parseInt(F.slice(te,re));if(Me>=0&&Me<=255)return re;throw new Error("Invalid decimal uchar")}consumeIP6Address(F,te){let re=this.consumeHexpart(F,te);return F[re]===":"&&(re+=1,re=this.consumeIP4Address(F,re)),re}consumeHexpart(F,te){let re=te;if(F[re]===":"&&F[re+1]===":"){re+=2;try{re=this.consumeHexseq(F,re)}catch{}return re}if(re=this.consumeHexseq(F,re),F[re]===":"&&F[re+1]===":"){re+=2;try{re=this.consumeHexseq(F,re)}catch{}return re}return re}consumeHexseq(F,te){let re=te;for(;re=this.consumeHex4(F,re),F[re]===":"&&F[re+1]!==":";)re+=1;return re}consumeHex4(F,te){let re=0;for(;re<4;re++)if(!((Me=F[te+re])>="0"&&Me<="9"||Me>="a"&&Me<="f"||Me>="A"&&Me<="F")){if(re===0)throw new Error("Invalid hex 4");break}var Me;return te+re}consumeFQDN(F,te){let re=te;for(;b(F[re])||B(F[re])||F[re]==="-"||F[re]===".";)re+=1;if(re-te<4)throw new Error("Invalid FQDN");return re}consumeExtnAddr(F,te){return this.consumeOneOrMore(F,te,O)}consumeMulticastAddress(F,te,re){switch(re){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(F,te);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(F,te);default:try{return this.consumeFQDN(F,te)}catch{return this.consumeExtnAddr(F,te)}}}consumeIP6MulticastAddress(F,te){const re=this.consumeHexpart(F,te);return F[re]==="/"?this.consumeInteger(F,re+1):re}consumeIP4MulticastAddress(F,te){let re=te+3;const Me=F.slice(te,re),Pt=parseInt(Me);if(Pt<224||Pt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Cn=0;Cn<3;Cn++){if(F[re]!==".")throw new Error("Invalid IP4 multicast address.");re+=1,re=this.consumeDecimalUChar(F,re)}return F[re]==="/"&&(re+=1),re=this.consumeTTL(F,re),F[re]==="/"&&(re=this.consumeInteger(F,re)),re}consumeInteger(F,te){if(!G(F[te]))throw new Error("Invalid integer.");for(te+=1;b(F[te]);)te+=1;return te}consumeTTL(F,te){if(F[te]==="0")return te+1;if(!G(F[te]))throw new Error("Invalid TTL.");te+=1;for(let re=0;re<2&&b(F[te]);re++)te+=1;return te}consumeToken(F,te){return this.consumeOneOrMore(F,te,D)}consumeTime(F,te){let re=te;if(F[re]==="0")return re+1;for(G(F[re])&&(re+=1);b(F[re]);)re++;if(re-te<10)throw new Error("Invalid time");return re}consumeAddress(F,te){return this.consumeTill(F,te,_)}consumeTypedTime(F,te){let re=te;return re=this.consumeOneOrMore(F,re,b),j(F[re])?re+1:re}consumeRepeatInterval(F,te){if(!G(F[te]))throw new Error("Invalid repeat interval");for(te+=1;b(F[te]);)te+=1;return j(F[te])&&(te+=1),te}consumePort(F,te){return this.consumeOneOrMore(F,te,b)}consume(F,te,re){for(let Me=0;Me<re.length;Me++){if(te+Me>=F.length)throw new Error("consume exceeding value length");if(F[te+Me]!==re[Me])throw new Error("consume ".concat(re," failed at ").concat(Me))}return te+re.length}consumeTill(F,te,re){let Me=te;for(;Me<F.length&&(typeof re!="string"||F[Me]!==re)&&(typeof re!="function"||!re(F[Me]));)Me++;return Me}}class ze extends Pe{constructor(){super(),ye(this,"records",[]),ye(this,"currentLine",0)}parse(F){const te=this.probeEOL(F);this.records=F.split(te).filter(Am=>!!nr(Am).call(Am)).map(this.parseLine),this.currentLine=0;const re=this.parseVersion(),Me=this.parseOrigin(),Pt=this.parseSessionName(),Cn=this.parseInformation(),ts=this.parseUri(),Xr=this.parseEmail(),_u=this.parsePhone(),Rm=this.parseConnection(),Yy=this.parseBandWidth(),vA=this.parseTimeFields(),bA=this.parseKey(),mo=this.parseSessionAttribute(),nf=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:re,origin:Me,sessionName:Pt,information:Cn,uri:ts,emails:Xr,phones:_u,connection:Rm,bandwidths:Yy,timeFields:vA,key:bA,attributes:mo,mediaDescriptions:nf}}getCurrentRecord(){const F=this.records[this.currentLine];if(!F)throw new Error("Record doesn't exit.");return F}probeEOL(F){for(let te=0;te<F.length;te++)if(F[te]===f)return F[te-1]==="\r"?m:f;throw new Error("Invalid newline character.")}parseLine(F,te){if(F.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const re=F[0];if(F[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:re,value:F.slice(2),line:te,cur:0}}parseSessionAttribute(){const F=new $t;for(;this.currentLine<this.records.length;){const te=this.getCurrentRecord();if(te.type!==S.ATTRIBUTE)break;const re={attField:this.extractOneOrMore(te,Me=>D(Me)&&Me!==":"),_cur:0};te.value[te.cur]===":"&&(te.cur+=1,re.attValue=this.extractOneOrMore(te,Y)),F.parse(re),this.currentLine++}return F.digest()}parseMediaAttributes(F){const te=new zt(F);for(;this.currentLine<this.records.length;){const re=this.getCurrentRecord();if(re.type!==S.ATTRIBUTE)break;const Me={attField:this.extractOneOrMore(re,Pt=>D(Pt)&&Pt!==":"),_cur:0};re.value[re.cur]===":"&&(re.cur+=1,Me.attValue=this.extractOneOrMore(re,Y)),te.parse(Me),this.currentLine++}return te.digest()}parseKey(){const F=this.getCurrentRecord();if(F.type===S.KEY){if(F.value==="prompt"||F.value==="clear:"||F.value==="base64:"||F.value==="uri:")return F.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const F=this.getCurrentRecord();if(F.type===S.ZONE_ADJUSTMENTS){const te=[];for(;;)try{const re=this.extract(F,this.consumeTime);this.consumeSpaceForRecord(F);let Me=!1;F.value[F.cur]==="-"&&(Me=!0,F.cur+=1);const Pt=this.extract(F,this.consumeTypedTime);te.push({time:re,typedTime:Pt,back:Me})}catch{break}if(te.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,te}return[]}parseRepeat(){const F=[];for(;;){const te=this.getCurrentRecord();if(te.type!==S.REPEAT)break;{const re=this.extract(te,this.consumeRepeatInterval),Me=this.parseTypedTime(te);F.push({repeatInterval:re,typedTimes:Me}),this.currentLine++}}return F}parseTypedTime(F){const te=[];for(;;)try{this.consumeSpaceForRecord(F),te.push(this.extract(F,this.consumeTypedTime))}catch{break}if(te.length===0)throw new Error("Invalid typed time.");return te}parseTime(){const F=this.getCurrentRecord(),te=this.extract(F,this.consumeTime);this.consumeSpaceForRecord(F);const re=this.extract(F,this.consumeTime);return this.currentLine++,{startTime:te,stopTime:re}}parseBandWidth(){const F=[];for(;this.currentLine<this.records.length;){const te=this.getCurrentRecord();if(te.type!==S.BANDWIDTH)break;{const re=this.extractOneOrMore(te,D);if(te.value[te.cur]!==":")throw new Error("Invalid bandwidth field.");te.cur++;const Me=this.extractOneOrMore(te,b);F.push({bwtype:re,bandwidth:Me}),this.currentLine++}}return F}parseVersion(){const F=this.getCurrentRecord();if(F.type!==S.VERSION)throw new Error("first sdp record must be version");const te=F.value.slice(0,this.consumeOneOrMore(F.value,0,b));if(te.length!==F.value.length)throw new Error('invalid proto version, "v='.concat(F.value,'"'));return this.currentLine++,te}parseOrigin(){const F=this.getCurrentRecord();if(F.type!==S.ORIGIN)throw new Error("second line of sdp must be origin");const te=this.extractOneOrMore(F,O);this.consumeSpaceForRecord(F);const re=this.extractOneOrMore(F,b);this.consumeSpaceForRecord(F);const Me=this.extractOneOrMore(F,b);this.consumeSpaceForRecord(F);const Pt=this.extractOneOrMore(F,D);this.consumeSpaceForRecord(F);const Cn=this.extractOneOrMore(F,D);this.consumeSpaceForRecord(F);const ts=this.extract(F,this.consumeUnicastAddress);return this.currentLine++,{username:te,sessId:re,sessVersion:Me,nettype:Pt,addrtype:Cn,unicastAddress:ts}}parseSessionName(){const F=this.getCurrentRecord();if(F.type===S.SESSION_NAME){const te=this.extract(F,this.consumeText);return this.currentLine++,te}}parseInformation(){const F=this.getCurrentRecord();if(F.type!==S.INFORMATION)return;const te=this.extract(F,this.consumeText);return this.currentLine++,te}parseUri(){const F=this.getCurrentRecord();if(F.type===S.URI)return this.currentLine++,F.value}parseEmail(){const F=[];for(;;){const te=this.getCurrentRecord();if(te.type!==S.EMAIL)break;F.push(te.value),this.currentLine++}return F}parsePhone(){const F=[];for(;;){const te=this.getCurrentRecord();if(te.type!==S.PHONE)break;F.push(te.value),this.currentLine++}return F}parseConnection(){const F=this.getCurrentRecord();if(F.type===S.CONNECTION){const te=this.extractOneOrMore(F,D);this.consumeSpaceForRecord(F);const re=this.extractOneOrMore(F,D);this.consumeSpaceForRecord(F);const Me=this.extract(F,this.consumeAddress);return this.currentLine++,{nettype:te,addrtype:re,address:Me}}}parseMedia(){const F=this.getCurrentRecord(),te=this.extract(F,this.consumeToken);this.consumeSpaceForRecord(F);let re=this.extract(F,this.consumePort);F.value[F.cur]==="/"&&(F.cur+=1,re+=this.extract(F,this.consumeInteger)),this.consumeSpaceForRecord(F);const Me=[];for(Me.push(this.extract(F,this.consumeToken));F.value[F.cur]==="/";)F.cur+=1,Me.push(this.extract(F,this.consumeToken));if(Me.length===0)throw new Error("Invalid proto");const Pt=this.parseFmt(F);return this.currentLine++,{mediaType:te,port:re,protos:Me,fmts:Pt}}parseTimeFields(){const F=[];for(;this.getCurrentRecord().type===S.TIME;){const te=this.parseTime(),re=this.parseRepeat(),Me=this.parseZone();F.push({time:te,repeats:re,zones:Me})}return F}parseMediaDescription(){const F=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===S.MEDIA;){const te=this.parseMedia(),re=this.parseInformation(),Me=this.parseConnections(),Pt=this.parseBandWidth(),Cn=this.parseKey(),ts=this.parseMediaAttributes(te);F.push({media:te,information:re,connections:Me,bandwidths:Pt,key:Cn,attributes:ts})}return F}parseConnections(){const F=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===S.CONNECTION;)F.push(this.parseConnection());return F}parseFmt(F){const te=[];for(;;)try{this.consumeSpaceForRecord(F),te.push(this.extract(F,this.consumeToken))}catch{break}if(te.length===0)throw new Error("Invalid fmts");return te}extract(F,te){for(var re=arguments.length,Me=new Array(re>2?re-2:0),Pt=2;Pt<re;Pt++)Me[Pt-2]=arguments[Pt];const Cn=te.call(this,F.value,F.cur,...Me),ts=F.value.slice(F.cur,Cn);return F.cur=Cn,ts}extractOneOrMore(F,te){const re=this.consumeOneOrMore(F.value,F.cur,te),Me=F.value.slice(F.cur,re);return F.cur=re,Me}consumeSpaceForRecord(F){if(F.value[F.cur]!==_)throw new Error("Invalid space at ".concat(F.cur,"."));F.cur+=1}}class nt extends Pe{constructor(){super(...arguments),ye(this,"attributes",void 0),ye(this,"digested",!1)}extractOneOrMore(F,te,re){const Me=this.consumeOneOrMore(F.attValue,F._cur,te),Pt=F.attValue.slice(F._cur,Me),[Cn,ts]=re||[];if(typeof Cn=="number"&&Pt.length<Cn)throw new Error("error in length, should be more or equal than ".concat(Cn," characters."));if(typeof ts=="number"&&Pt.length>ts)throw new Error("error in length, should be less or equal than ".concat(ts," characters."));return F._cur=Me,Pt}consumeAttributeSpace(F){if(F.attValue[F._cur]!==_)throw new Error("Invalid space at ".concat(F._cur,"."));F._cur+=1}extract(F,te){if(!F.attValue)throw new Error("Nothing to extract from attValue.");for(var re=arguments.length,Me=new Array(re>2?re-2:0),Pt=2;Pt<re;Pt++)Me[Pt-2]=arguments[Pt];const Cn=te.call(this,F.attValue,F._cur,...Me),ts=F.attValue.slice(F._cur,Cn);return F._cur=Cn,ts}atEnd(F){if(!F.attValue)throw new Error;return F._cur>=F.attValue.length}peekChar(F){if(!F.attValue)throw new Error;return F.attValue[F._cur]}peek(F,te){if(!F.attValue)throw new Error;for(let re=0;re<te.length;re++)if(te[re]!==F.attValue[F._cur+re])return!1;return!0}parseIceUfrag(F){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(F,q,[4,256])}parseIcePwd(F){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(F,q,[22,256])}parseIceOptions(F){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const te=[];for(;!this.atEnd(F);){te.push(this.extractOneOrMore(F,q));try{this.consumeAttributeSpace(F)}catch(re){if(this.atEnd(F))break;throw re}}this.attributes.iceOptions=te}parseFingerprint(F){const te=this.extract(F,this.consumeToken);this.consumeAttributeSpace(F);const re=this.extract(F,this.consumeTill);this.attributes.fingerprints.push({hashFunction:te,fingerprint:re})}parseExtmap(F){const te=this.extractOneOrMore(F,b);let re;this.peekChar(F)==="/"&&(this.extract(F,this.consume,"/"),re=this.extract(F,this.consumeToken)),this.consumeAttributeSpace(F);const Me=this.extract(F,this.consumeTill,_),Pt=oe(oe({entry:parseInt(te,10)},re&&{direction:re}),{},{extensionName:Me});this.peekChar(F)===_&&(this.consumeAttributeSpace(F),Pt.extensionAttributes=this.extract(F,this.consumeTill)),this.attributes.extmaps.push(Pt)}parseSetup(F){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const te=this.extract(F,this.consumeTill);if(te!=="active"&&te!=="passive"&&te!=="actpass"&&te!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=te}}class $t extends nt{constructor(){super(...arguments),ye(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(F){if(this.digested)throw new Error("already digested");try{switch(F.attField){case"group":this.parseGroup(F);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(F);break;case"ice-pwd":this.parseIcePwd(F);break;case"ice-options":this.parseIceOptions(F);break;case"fingerprint":this.parseFingerprint(F);break;case"setup":this.parseSetup(F);break;case"tls-id":this.parseTlsId(F);break;case"identity":this.parseIdentity(F);break;case"extmap":this.parseExtmap(F);break;case"msid-semantic":this.parseMsidSemantic(F);break;default:F.ignored=!0,this.attributes.unrecognized.push(F)}}catch(te){throw console.error("parsing session attribute ".concat(F.attField,' error, "a=').concat(F.attField,":").concat(F.attValue,'"')),te}if(!F.ignored&&F.attValue&&!this.atEnd(F))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(F){const te=this.extract(F,this.consumeToken),re=[];for(;!this.atEnd(F)&&this.peekChar(F)===_;)this.consumeAttributeSpace(F),re.push(this.extract(F,this.consumeToken));this.attributes.groups.push({semantic:te,identificationTag:re})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(F){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(F,ie)}parseIdentity(F){const te=this.extractOneOrMore(F,le),re=[];for(;!this.atEnd(F)&&this.peekChar(F)===_;){this.consumeAttributeSpace(F);const Me=this.extract(F,this.consumeToken);this.extract(F,this.consume,"=");const Pt=this.extractOneOrMore(F,Cn=>Cn!==_&&Y(Cn));re.push({name:Me,value:Pt})}this.attributes.identities.push({assertionValue:te,extensions:re})}parseMsidSemantic(F){this.peekChar(F)===_&&this.consumeAttributeSpace(F);const te={semantic:this.extract(F,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(F)}catch{break}if(this.peekChar(F)==="*"){this.extract(F,this.consume,"*"),te.applyForAll=!0;break}{const re=this.extract(F,this.consumeTill,_);te.identifierList.push(re)}}this.attributes.msidSemantic=te}}class zt extends nt{constructor(F){super(),ye(this,"attributes",void 0),F.protos.indexOf("RTP")!==-1||F.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(F){if(this.digested)throw new Error("already digested");try{switch(F.attField){case"extmap":this.parseExtmap(F);break;case"setup":this.parseSetup(F);break;case"ice-ufrag":this.parseIceUfrag(F);break;case"ice-pwd":this.parseIcePwd(F);break;case"ice-options":this.parseIceOptions(F);break;case"candidate":this.parseCandidate(F);break;case"remote-candidate":this.parseRemoteCandidate(F);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(F);break;case"rtpmap":this.parseRtpmap(F);break;case"ptime":this.parsePtime(F);break;case"maxptime":this.parseMaxPtime(F);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(F);break;case"ssrc":this.parseSSRC(F);break;case"fmtp":this.parseFmtp(F);break;case"rtcp-fb":this.parseRtcpFb(F);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(F);break;case"mid":this.parseMid(F);break;case"msid":this.parseMsid(F);break;case"imageattr":this.parseImageAttr(F);break;case"rid":this.parseRid(F);break;case"simulcast":this.parseSimulcast(F);break;case"sctp-port":this.parseSctpPort(F);break;case"max-message-size":this.parseMaxMessageSize(F);break;case"ssrc-group":this.parseSSRCGroup(F);break;default:F.ignored=!0,this.attributes.unrecognized.push(F)}}catch(te){throw console.error("parsing media attribute ".concat(F.attField,' error, "a=').concat(F.attField,":").concat(F.attValue,'"')),te}if(!F.ignored&&F.attValue&&!this.atEnd(F))throw new Error("attribute parsing error")}parseCandidate(F){const te=this.extractOneOrMore(F,q,[1,32]);this.consumeAttributeSpace(F);const re=this.extractOneOrMore(F,b,[1,5]);this.consumeAttributeSpace(F);const Me=this.extract(F,this.consumeToken);this.consumeAttributeSpace(F);const Pt=this.extractOneOrMore(F,b,[1,10]);this.consumeAttributeSpace(F);const Cn=this.extract(F,this.consumeAddress);this.consumeAttributeSpace(F);const ts=this.extract(F,this.consumePort);this.consumeAttributeSpace(F),this.extract(F,this.consume,"typ"),this.consumeAttributeSpace(F);const Xr={foundation:te,componentId:re,transport:Me,priority:Pt,connectionAddress:Cn,port:ts,type:this.extract(F,this.consumeToken),extension:{}};for(this.peek(F," raddr")&&(this.extract(F,this.consume," raddr"),this.consumeAttributeSpace(F),Xr.relAddr=this.extract(F,this.consumeAddress)),this.peek(F," rport")&&(this.extract(F,this.consume," rport"),this.consumeAttributeSpace(F),Xr.relPort=this.extract(F,this.consumePort));this.peekChar(F)===_;){this.consumeAttributeSpace(F);const _u=this.extract(F,this.consumeToken);this.consumeAttributeSpace(F),Xr.extension[_u]=this.extractOneOrMore(F,A)}this.attributes.candidates.push(Xr)}parseRemoteCandidate(F){const te=[];for(;;){const re=this.extractOneOrMore(F,b,[1,5]);this.consumeAttributeSpace(F);const Me=this.extract(F,this.consumeAddress);this.consumeAttributeSpace(F);const Pt=this.extract(F,this.consumePort);te.push({componentId:re,connectionAddress:Me,port:Pt});try{this.consumeAttributeSpace(F)}catch{break}}this.attributes.remoteCandidatesList.push(te)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(F){const te=this.extract(F,this.consumeToken);this.consumeAttributeSpace(F);const re=this.extract(F,this.consumeTill,"/");this.extract(F,this.consume,"/");const Me={encodingName:re,clockRate:this.extractOneOrMore(F,b)};this.atEnd(F)||this.peekChar(F)!=="/"||(this.extract(F,this.consume,"/"),Me.encodingParameters=parseInt(this.extract(F,this.consumeTill),10));const Pt=this.attributes.payloads.find(Cn=>Cn.payloadType===parseInt(te,10));Pt?Pt.rtpMap=Me:this.attributes.payloads.push({payloadType:parseInt(te,10),rtpMap:Me,rtcpFeedbacks:[]})}parsePtime(F){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(F,this.consumeTill)}parseMaxPtime(F){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(F,this.consumeTill)}parseDirection(F){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=F.attField}parseSSRC(F){const te=this.extractOneOrMore(F,b);this.consumeAttributeSpace(F);const re=this.extract(F,this.consumeTill,":");let Me;this.peekChar(F)===":"&&(this.extract(F,this.consume,":"),Me=this.extract(F,this.consumeTill));const Pt=this.attributes.ssrcs.find(Cn=>Cn.ssrcId===parseInt(te,10));Pt?Pt.attributes[re]=Me:this.attributes.ssrcs.push({ssrcId:parseInt(te,10),attributes:{[re]:Me}})}parseFmtp(F){const te=this.extract(F,this.consumeTill,_);this.consumeAttributeSpace(F);const re=this.extract(F,this.consumeTill),Me={};re.split(";").forEach(Cn=>{let[ts,Xr]=Cn.split("=");ts=nr(ts).call(ts);const _u=typeof Xr=="string"?nr(Xr).call(Xr):null;typeof ts=="string"&&ts.length>0&&(Me[ts]=_u)});const Pt=this.attributes.payloads.find(Cn=>Cn.payloadType===parseInt(te,10));Pt?Pt.fmtp={parameters:Me}:this.attributes.payloads.push({payloadType:parseInt(te,10),rtcpFeedbacks:[],fmtp:{parameters:Me}})}parseFmtParameters(F){const te={},re=this.extract(F,this.consumeTill,"=");F._cur++;const Me=this.extract(F,this.consumeTill,";");for(te[re]=Me;F.attValue[F._cur]===";";){const Pt=this.extract(F,this.consumeTill,"=");F._cur++;const Cn=this.extract(F,this.consumeTill,";");te[Pt]=Cn}return te}parseRtcpFb(F){let te="";te=this.peekChar(F)==="*"?this.extract(F,this.consume,"*"):this.extract(F,this.consumeTill,_),this.consumeAttributeSpace(F);const re=this.extract(F,this.consumeTill,_);let Me;if(re==="trr-int")Me={type:re,interval:this.extract(F,this.consumeTill)};else{const Pt={type:re};this.peekChar(F)===_&&(this.consumeAttributeSpace(F),Pt.parameter=this.extract(F,this.consumeToken),this.peekChar(F)===_&&(Pt.additional=this.extract(F,this.consumeTill))),Me=Pt}if(te==="*")this.attributes.rtcpFeedbackWildcards.push(Me);else{const Pt=this.attributes.payloads.find(Cn=>Cn.payloadType===parseInt(te,10));Pt?Pt.rtcpFeedbacks.push(Me):this.attributes.payloads.push({payloadType:parseInt(te,10),rtcpFeedbacks:[Me]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(F){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const te={port:this.extract(F,this.consumePort)};this.peekChar(F)===_&&(this.consumeAttributeSpace(F),te.netType=this.extractOneOrMore(F,D),this.consumeAttributeSpace(F),te.addressType=this.extractOneOrMore(F,D),this.consumeAttributeSpace(F),te.address=this.extract(F,this.consumeAddress)),this.attributes.rtcp=te}parseMsid(F){const te={id:this.extractOneOrMore(F,D,[1,64])};this.peekChar(F)===_&&(this.consumeAttributeSpace(F),te.appdata=this.extractOneOrMore(F,D,[1,64])),this.attributes.msids.push(te)}parseImageAttr(F){this.attributes.imageattr.push(F.attValue)}parseRid(F){const te=this.extractOneOrMore(F,Me=>B(Me)||b(Me)||Me==="_"||Me==="-");this.consumeAttributeSpace(F);const re={id:te,direction:this.extract(F,this.consumeToken),params:[]};if(this.peekChar(F)===_){if(this.consumeAttributeSpace(F),this.peek(F,"pt=")){this.extract(F,this.consume,"pt=");const Me=[];for(;;){const Pt=this.extract(F,this.consumeToken);Me.push(Pt);try{this.extract(F,this.consume,",")}catch{break}}re.payloads=Me,this.peekChar(F)===_&&this.extract(F,this.consume,_)}for(;;){const Me=this.extract(F,this.consumeToken);switch(Me){case"depend":{const Pt={type:Me,rids:this.extract(F,this.consume,"=").split(",")};re.params.push(Pt);break}default:{const Pt={type:Me};this.peekChar(F)==="="&&(this.extract(F,this.consume,"="),Pt.val=this.extract(F,this.consumeTill,";")),re.params.push(Pt)}}try{this.extract(F,this.consume,";")}catch{break}}}this.attributes.rids.push(re)}parseSimulcast(F){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=F.attValue,this.extract(F,this.consumeTill)}parseSctpPort(F){this.attributes.sctpPort=this.extractOneOrMore(F,b,[1,5])}parseMaxMessageSize(F){this.attributes.maxMessageSize=this.extractOneOrMore(F,b,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(F){this.attributes.mid=this.extract(F,this.consumeToken)}parseSSRCGroup(F){const te=this.extract(F,this.consumeToken),re=[];for(;;)try{this.consumeAttributeSpace(F);const Me=this.extract(F,this.consumeInteger);re.push(parseInt(Me,10))}catch{break}this.attributes.ssrcGroups.push({semantic:te,ssrcIds:re})}}function Mn(De,F,te){return F in De?Object.defineProperty(De,F,{value:te,enumerable:!0,configurable:!0,writable:!0}):De[F]=te,De}class Ai{constructor(){Mn(this,"eol",m)}print(F,te){let re="";return te&&(this.eol=te),re+=this.printVersion(F.version),re+=this.printOrigin(F.origin),re+=this.printSessionName(F.sessionName),re+=this.printInformation(F.information),re+=this.printUri(F.uri),re+=this.printEmail(F.emails),re+=this.printPhone(F.phones),re+=this.printConnection(F.connection),re+=this.printBandwidth(F.bandwidths),re+=this.printTimeFields(F.timeFields),re+=this.printKey(F.key),re+=this.printSessionAttributes(F.attributes),re+=this.printMediaDescription(F.mediaDescriptions),re}printVersion(F){return"v=".concat(F).concat(this.eol)}printOrigin(F){return"o=".concat(F.username," ").concat(F.sessId," ").concat(F.sessVersion," ").concat(F.nettype," ").concat(F.addrtype," ").concat(F.unicastAddress).concat(this.eol)}printSessionName(F){return F?"s=".concat(F).concat(this.eol):""}printInformation(F){return F?"i=".concat(F).concat(this.eol):""}printUri(F){return F?"u=".concat(F).concat(this.eol):""}printEmail(F){let te="";for(const re of F)te+="e=".concat(re).concat(this.eol);return te}printPhone(F){let te="";for(const re of F)te+="e=".concat(re).concat(this.eol);return te}printConnection(F){return F?"c=".concat(F.nettype," ").concat(F.addrtype," ").concat(F.address).concat(this.eol):""}printBandwidth(F){let te="";for(const re of F)te+="b=".concat(re.bwtype,":").concat(re.bandwidth).concat(this.eol);return te}printTimeFields(F){let te="";for(const re of F){te+="t=".concat(re.time.startTime," ").concat(re.time.startTime).concat(this.eol);for(const Me of re.repeats)te+="r=".concat(Me.repeatInterval," ").concat(Me.typedTimes.join(" ")).concat(this.eol);re.zoneAdjustments&&(te+="z=",te+="z=".concat(re.zoneAdjustments.map(Me=>"".concat(Me.time," ").concat(Me.back?"-":""," ").concat(Me.typedTime)).join(" ")).concat(this.eol),te+=this.eol)}return te}printKey(F){return F?"k=".concat(F).concat(this.eol):""}printAttributes(F){let te="";for(const re of F)te+="a=".concat(re.attField).concat(re.attValue?":".concat(re.attValue):"").concat(this.eol);return te}printMediaDescription(F){let te="";for(const re of F)te+=this.printMedia(re.media),te+=this.printInformation(re.information),te+=this.printConnections(re.connections),te+=this.printBandwidth(re.bandwidths),te+=this.printKey(re.key),te+=this.printMediaAttributes(re);return te}printConnections(F){let te="";for(const re of F)te+=this.printConnection(re);return te}printMedia(F){return"m=".concat(F.mediaType," ").concat(F.port," ").concat(F.protos.join("/")," ").concat(F.fmts.join(" ")).concat(this.eol)}printSessionAttributes(F){return new Fr(this.eol).print(F)}printMediaAttributes(F){return new Ie(this.eol).print(F)}}class pi{constructor(F){Mn(this,"eol",void 0),this.eol=F}printIceUfrag(F){return F===void 0?"":"a=ice-ufrag:".concat(F).concat(this.eol)}printIcePwd(F){return F===void 0?"":"a=ice-pwd:".concat(F).concat(this.eol)}printIceOptions(F){return F===void 0?"":"a=ice-options:".concat(F.join(_)).concat(this.eol)}printFingerprints(F){return F.length>0?F.map(te=>"a=fingerprint:".concat(te.hashFunction).concat(_).concat(te.fingerprint)).join(this.eol)+this.eol:""}printExtmap(F){return F.map(te=>"a=extmap:".concat(te.entry).concat(te.direction?"/".concat(te.direction):"").concat(_).concat(te.extensionName).concat(te.extensionAttributes?"".concat(_).concat(te.extensionAttributes):"").concat(this.eol)).join("")}printSetup(F){return F===void 0?"":"a=setup:".concat(F).concat(this.eol)}printUnrecognized(F){return F.map(te=>"a=".concat(te.attField).concat(te.attValue?":".concat(te.attValue):"").concat(this.eol)).join("")}}class Fr extends pi{print(F){let te="";return te+=this.printGroups(F.groups),te+=this.printMsidSemantic(F.msidSemantic),te+=this.printIceLite(F.iceLite),te+=this.printIceUfrag(F.iceUfrag),te+=this.printIcePwd(F.icePwd),te+=this.printIceOptions(F.iceOptions),te+=this.printFingerprints(F.fingerprints),te+=this.printSetup(F.setup),te+=this.printTlsId(F.tlsId),te+=this.printIdentity(F.identities),te+=this.printExtmap(F.extmaps),te+=this.printUnrecognized(F.unrecognized),te}printGroups(F){let te="";return F.length>0&&(te+=F.map(re=>"a=group:".concat(re.semantic).concat(re.identificationTag.map(Me=>"".concat(_).concat(Me)).join("")).concat(this.eol)).join("")),te}printIceLite(F){return F===void 0?"":"a=ice-lite"+this.eol}printTlsId(F){return F?"a=tls-id:".concat(F).concat(this.eol):""}printIdentity(F){return F.length===0?"":F.map(te=>"a=identity:".concat(te.assertionValue).concat(te.extensions.map(re=>"".concat(_).concat(re.name).concat(re.value?"=".concat(re.value):"")))).join(this.eol)+this.eol}printMsidSemantic(F){if(!F)return"";let te="a=msid-semantic:".concat(F.semantic);return F.applyForAll?te+="".concat(_,"*"):F.identifierList.length>0&&(te+=F.identifierList.map(re=>"".concat(_).concat(re))),te+this.eol}}class Ie extends pi{print(F){const te=F.attributes;let re="";return re+=this.printRTCP(te.rtcp),re+=this.printIceUfrag(te.iceUfrag),re+=this.printIcePwd(te.icePwd),re+=this.printIceOptions(te.iceOptions),re+=this.printCandidates(te.candidates),re+=this.printRemoteCandidatesList(te.remoteCandidatesList),re+=this.printEndOfCandidates(te.endOfCandidates),re+=this.printFingerprints(te.fingerprints),re+=this.printSetup(te.setup),re+=this.printMid(te.mid),re+=this.printExtmap(te.extmaps),re+=this.printRTPRelated(te),re+=this.printPtime(te.ptime),re+=this.printMaxPtime(te.maxPtime),re+=this.printDirection(te.direction),re+=this.printSSRCGroups(te.ssrcGroups),re+=this.printSSRC(te.ssrcs),re+=this.printRTCPMux(te.rtcpMux),re+=this.printRTCPMuxOnly(te.rtcpMuxOnly),re+=this.printRTCPRsize(te.rtcpRsize),re+=this.printMSId(te.msids),re+=this.printImageattr(te.imageattr),re+=this.printRid(te.rids),re+=this.printSimulcast(te.simulcast),re+=this.printSCTPPort(te.sctpPort),re+=this.printMaxMessageSize(te.maxMessageSize),re+=this.printUnrecognized(te.unrecognized),re}printCandidates(F){return F.map(te=>"a=candidate:".concat(te.foundation).concat(_).concat(te.componentId).concat(_).concat(te.transport).concat(_).concat(te.priority).concat(_).concat(te.connectionAddress).concat(_).concat(te.port).concat(_,"typ").concat(_).concat(te.type).concat(te.relAddr?"".concat(_,"raddr").concat(_).concat(te.relAddr):"").concat(te.relPort?"".concat(_,"rport").concat(_).concat(te.relPort):"").concat(Object.keys(te.extension).map(re=>"".concat(_).concat(re).concat(_).concat(te.extension[re])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(F){return F.map(te=>"a=remote-candidates:".concat(te.join(_)).concat(this.eol)).join("")}printEndOfCandidates(F){return F===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(F){if(!F.payloads)return"";const te=F.payloads;let re="";re+=F.rtcpFeedbackWildcards.map(Me=>this.printRTCPFeedback("*",Me)).join("");for(const Me of te)re+=this.printRtpMap(Me.payloadType,Me.rtpMap),re+=this.printFmtp(Me.payloadType,Me.fmtp),re+=Me.rtcpFeedbacks.map(Pt=>this.printRTCPFeedback(Me.payloadType,Pt)).join("");return re}printFmtp(F,te){if(!te)return"";const re=Object.keys(te.parameters);return re.length===1&&te.parameters[re[0]]===null?"a=fmtp:".concat(F).concat(_).concat(re[0]).concat(this.eol):"a=fmtp:".concat(F).concat(_).concat(Object.keys(te.parameters).map(Me=>"".concat(Me,"=").concat(te.parameters[Me])).join(";")).concat(this.eol)}printRtpMap(F,te){return te?"a=rtpmap:".concat(F).concat(_).concat(te.encodingName,"/").concat(te.clockRate).concat(te.encodingParameters?"/".concat(te.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(F,te){let re="a=rtcp-fb:".concat(F).concat(_),Me=te;return Me.type==="trr-int"?re+="ttr-int".concat(_).concat(Me.interval):(re+="".concat(Me.type),Me.parameter&&(re+="".concat(_).concat(Me.parameter),Me.additional&&(re+="".concat(_).concat(Me.additional)))),re+this.eol}printPtime(F){return F===void 0?"":"a=ptime:".concat(F).concat(this.eol)}printMaxPtime(F){return F===void 0?"":"a=maxptime:".concat(F).concat(this.eol)}printDirection(F){return F===void 0?"":"a=".concat(F).concat(this.eol)}printSSRC(F){return F.map(te=>Object.keys(te.attributes).map(re=>"a=ssrc:".concat(te.ssrcId.toString(10)).concat(_).concat(re).concat(te.attributes[re]?":".concat(te.attributes[re]):"").concat(this.eol)).join("")).join("")}printRTCPMux(F){return F===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(F){return F===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(F){return F===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(F){if(F===void 0)return"";let te="a=rtcp:".concat(F.port);return F.netType&&(te+="".concat(_).concat(F.netType)),F.addressType&&(te+="".concat(_).concat(F.addressType)),F.address&&(te+="".concat(_).concat(F.address)),te+this.eol}printMSId(F){return F.map(te=>"a=msid:".concat(te.id).concat(te.appdata?"".concat(_).concat(te.appdata):"").concat(this.eol)).join("")}printImageattr(F){return F.map(te=>"a=imageattr:".concat(te).concat(this.eol)).join("")}printRid(F){return F.map(te=>{let re="a=rid:".concat(te.id).concat(_).concat(te.direction);return te.payloads&&(re+="".concat(_,"pt=").concat(te.payloads.join(","))),te.params.length>0&&(re+="".concat(_).concat(te.params.map(Me=>Me.type==="depend"?"depend=".concat(Me.rids.join(",")):"".concat(Me.type,"=").concat(Me.val)).join(";"))),re+this.eol}).join("")}printSimulcast(F){return F===void 0?"":"a=simulcast:".concat(F).concat(this.eol)}printSCTPPort(F){return F===void 0?"":"a=sctp-port:".concat(F).concat(this.eol)}printMaxMessageSize(F){return F===void 0?"":"a=max-message-size:".concat(F).concat(this.eol)}printMid(F){return F===void 0?"":"a=mid:".concat(F).concat(this.eol)}printSSRCGroups(F){return F.map(te=>"a=ssrc-group:".concat(te.semantic).concat(te.ssrcIds.map(re=>"".concat(_).concat(re.toString(10))).join("")).concat(this.eol)).join("")}}function je(De){return new ze().parse(De)}function pt(De,F){return new Ai().print(De,F)}}},t={};function n(s){if(t[s])return t[s].exports;var a=t[s]={exports:{}};return e[s](a,a.exports,n),a.exports}return n.d=(s,a)=>{for(var l in a)n.o(a,l)&&!n.o(s,l)&&Object.defineProperty(s,l,{enumerable:!0,get:a[l]})},n.o=(s,a)=>Object.prototype.hasOwnProperty.call(s,a),n.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n(8)})();function Yr(e){return BM.parse(e)}function Bh(e,t){return BM.print(e,t)}var pq=Bs("Array").keys,mq=aa,gq=Yi,Eq=L,_q=pq,cO=Array.prototype,Sq={DOMTokenList:!0,NodeList:!0},yq=function(e){var t=e.keys;return e===cO||Eq(cO,e)&&t===cO.keys||gq(Sq,mq(e))?_q:t},Pa=d(yq);function VM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Ut(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VM(Object(n),!0).forEach(function(s){ui(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VM(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function ui(e,t,n){return(t=function(s){var a=function(l,f){if(typeof l!="object"||l===null)return l;var m=l[Symbol.toPrimitive];if(m!==void 0){var _=m.call(l,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(s);return typeof a=="symbol"?a:String(a)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const jM=new class extends ii{constructor(){super(...arguments),ui(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Tq{constructor(t){ui(this,"logger",void 0),ui(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function lO(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function GM(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const oo={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},hR=Date.now(),dy=e=>{for(const t in oo)if(Object.prototype.hasOwnProperty.call(oo,t)&&oo[t]===e)return t;return"DEFAULT"},k=new class{constructor(){ui(this,"proxyServerURL",void 0),ui(this,"logLevel",oo.DEBUG),ui(this,"uploadState","collecting"),ui(this,"uploadLogWaitingList",[]),ui(this,"uploadLogUploadingList",[]),ui(this,"uploadErrorCount",0),ui(this,"currentLogID",0),ui(this,"url",void 0),ui(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=[oo.DEBUG].concat(t);this.log.apply(this,s)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=[oo.INFO].concat(t);this.log.apply(this,s)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=[oo.WARNING].concat(t);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=[oo.ERROR].concat(t);this.log.apply(this,s)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=[oo.DEBUG].concat(t);this.uploadLog.apply(this,s)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){vn("UPLOAD_LOG",!0)}disableLogUpload(){vn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Tq(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-hR<100)return void setTimeout(()=>{this.log(...t)},Date.now()-hR);const s=Math.max(0,Math.min(4,t[0]));if(t[0]=lO()+" Agora-SDK [".concat(dy(s),"]:"),this.appendLogToWaitingList(s,...t),s<this.logLevel)return;const a=lO()+" %cAgora-SDK [".concat(dy(s),"]:");let l=[];if(!Z("USE_NEW_LOG"))switch(s){case oo.DEBUG:l=[a,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,l);break;case oo.INFO:l=[a,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,l);break;case oo.WARNING:l=[a,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,l);break;case oo.ERROR:l=[a,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-hR<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-hR);const s=Math.max(0,Math.min(4,t[0]));t[0]=lO()+" Agora-SDK [".concat(dy(s),"]:"),this.appendLogToWaitingList(s,...t)}appendLogToWaitingList(e){if(!Z("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];Array.isArray(n[0])?n[0][0]=GM()+" Agora-SDK [".concat(dy(e),"]:"):n[0]=GM()+" Agora-SDK [".concat(dy(e),"]:");let a="";n.forEach(l=>{typeof l=="object"&&(l=JSON.stringify(l)),a+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:a,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:ao,process_id:Z("PROCESS_ID"),payload:JSON.stringify(e)};return $c(async()=>{const n=await Lr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Z("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Z("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const s=new Error("unexpected upload log response");throw s.response=n,s}},()=>(this.uploadLogUploadingList=[],!1),n=>{const s={status:-1,message:n.message,errorRange:e.map(a=>a.log_item_id)};return n.response?(s.status=n.response.status,s.data=n.response.data,s.headers=n.response.headers):n.request&&(s.status=n.request.status),jM.reportLogUploadError(s),!0},{timeout:Z("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Z("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Z("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),Z("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),Z("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),Z("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var HM;function vq(e){return ms(e.reportId,"params.reportId",0,100,!1),ms(e.category,"params.category",0,100,!1),ms(e.event,"params.event",0,100,!1),ms(e.label,"params.label",0,100,!1),An(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(HM={}).FREE="free",HM.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const bq={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Zi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Xn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Rq=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Ct(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,s){const a=s.value;if(typeof a=="function"){const l=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);s.value=function(){for(var f,m=arguments.length,_=new Array(m),S=0;S<m;S++)_[S]=arguments[S];let b=_;if(e.argsMap)try{b=e.argsMap(this,..._)}catch(O){k.warning(O),b=[]}try{JSON.stringify(b)}catch{k.warning("arguments for method ".concat(l,".").concat(String(n)," not serializable for apiInvoke.")),b=[]}const A=(e.report||gt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((f=this.store)===null||f===void 0?void 0:f.clientId)||this._ID,name:"".concat(l,".").concat(String(n)),options:b,tag:li.TRACER,reportResult:e.reportResult},e.throttleTime);try{const O=a.apply(this,_);return O instanceof Ye?O.then(D=>(A.onSuccess(e.reportResult&&D),D)).catch(D=>{throw A.onError(D),D}):(A.onSuccess(e.reportResult&&O),O)}catch(O){throw A.onError(O),O}}}return s}}const gt=new class{constructor(){ui(this,"baseInfoMap",new Map),ui(this,"proxyServer",void 0),ui(this,"eventUploadTimer",void 0),ui(this,"setSessionIdTimer",void 0),ui(this,"url",void 0),ui(this,"sids",new Set),ui(this,"backupUrl",void 0),ui(this,"_appId",void 0),ui(this,"_aid",0),ui(this,"keyEventUploadPendingItems",[]),ui(this,"normalEventUploadPendingItems",[]),ui(this,"apiInvokeUploadPendingItems",[]),ui(this,"apiInvokeCount",0),ui(this,"apiInvokeLoggedCount",0),ui(this,"ltsList",[]),ui(this,"lastSendNormalEventTime",Date.now()),ui(this,"customReportCounterTimer",void 0),ui(this,"customReportCount",0),ui(this,"extApiInvoke",async e=>{for(const t of e){const n=Ut(Ut({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:li.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Z("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Z("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,s]=t;return n+s}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const s=Date.now();this.apiInvokeCount+=1;const a=this.apiInvokeCount,l=!!Z("SHOW_REPORT_INVOKER_LOG"),f=!!Z("SHOW_REPORT_USER_INVOKER_LOG"),m=l||f&&t.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function S(D,G){if(m){let B="[apiInvoke-".concat(_,"]");t.id&&(B+="[".concat(t.id,"]")),t.name&&(B+="[".concat(t.name,"]")),k.info("".concat(B," ").concat(D),D==="start"?t.options:G||"")}}const b=()=>({tag:t.tag,invokeId:a,sid:e,name:t.name,apiInvokeTime:s,options:t.options,states:t.states||null});S("start");let A=!1;gs(t.timeout).then(()=>{A||(this.sendApiInvoke(Ut(Ut({},b()),{},{error:$.API_INVOKE_TIMEOUT,success:!1})),S("timeout"))});const O=new ve($.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:D=>{const G=()=>{if(A)throw O;return A=!0,this.sendApiInvoke(Ut(Ut({},b()),{},{success:!0},t.reportResult&&{result:D})),S("onSuccess"),D};return n?vM(G,t.name+"Success",n,()=>A=!0):G()},onError:D=>{const G=()=>{if(A)throw D;A=!0,this.sendApiInvoke(Ut(Ut({},b()),{},{success:!1,error:D})),S("onFailure",D.toString())};return n?vM(G,t.name+"Error",n,()=>A=!0):G()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),s=this.createBaseInfo(e,n);s.cname=t.cname;const a=Object.assign({},{willUploadConsoleLog:Z("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:sO?"global":"oversea",areas:Z("AREAS")&&Z("AREAS").join(",")},t.extend),{stringUid:l,channelProfile:f,channelMode:m,isABTestSuccess:_,lsid:S,clientRole:b}=t,A=Date.now(),O=Ut(Ut({},s),{},{eventType:Zi.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:aO,lts:A,elapse:A-n,extend:JSON.stringify(a),mode:t.mode,process:Z("PROCESS_ID"),appType:Z("APP_TYPE"),success:!0,version:ao,stringUid:l,channelProfile:f,channelMode:m,isABTestSuccess:_,lsid:S,clientType:We(D=window.navigator.userAgent).call(D,"AgoraWebView")?42:20,clientRole:b,serviceId:Z("PROCESS_ID"),extensionID:Z("PLUGIN_INFO").join(",")||""});var D;this.send({type:Xn.SESSION,data:O},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut({},s),{},{role:t.role,eventType:Zi.JOIN_CHOOSE_SERVER,lts:a,eventElapse:t.elapse||a-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:a-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:Xn.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut({},s),{},{eventType:Zi.REQ_USER_ACCOUNT,lts:a,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||a-n.startTime,eventElapse:a-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Xn.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info;t.vid&&(s.vid=t.vid),s.uid=t.uid,s.cid=t.cid;const a=Date.now(),{firstSuccess:l,avoidJoinStartTime:f,addr:m,isProxy:_}=t,S=a-(l&&f?f:n.startTime),b=Ut(Ut({},s),{},{eventType:Zi.JOIN_GATEWAY,lts:a,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:S,eventElapse:a-t.lts,firstSuccess:l,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:iO(),isABTestSuccess:t.isABTestSuccess?1:0}),A=b.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=a),l)this.send({type:Xn.JOIN_GATEWAY,data:b},!0);else{let O;if(m)if(_){const G=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),B=m.match(/p=[0-9]{1,6}/g);O={isSuccess:A,gatewayIp:G&&G.length?G[0].split("=")[1].replace(/-/g,"."):"",port:B&&B.length?B[0].split("=")[1]:"",isProxy:_?1:0}}else{const G=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),B=m.match(/(:|p=)[0-9]{1,6}/g);O={isSuccess:A,gatewayIp:G&&G.length?G[0].split("//")[1].replace(/-/g,"."):"",port:B&&B.length?B[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else O={isSuccess:A,gatewayIp:"",port:"",isProxy:_?1:0};delete b.success,delete b.eventType,delete b.firstSuccess,b.vid=Number(b.vid);const D=Object.assign({},b,O,{eventType:Zi.REJOIN_GATEWAY});this.send({type:Xn.RE_JOIN_GATEWAY,data:D},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=Date.now(),a=Ut(Ut({},n.info),{},{lts:s,timeout:t,elapse:s-n.startTime});this.send({type:Xn.JOIN_CHANNEL_TIMEOUT,data:a},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut({},s),{},{eventType:Zi.PUBLISH,lts:a,eventElapse:t.eventElapse,elapse:a-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Xn.PUBLISH,data:l},!0)}subscribe(e,t,n){const s=this.baseInfoMap.get(e);if(!s)return;const a=s.info,l=Date.now(),f=Ut(Ut({},a),{},{eventType:Zi.SUBSCRIBE,lts:l,eventElapse:t.eventElapse,elapse:l-s.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?f.peerSuid=t.peerid:f.peer=t.peerid,this.send({type:Xn.SUBSCRIBE,data:f},!0)}wsCompressorInit(e){var t;const n=[...Pa(t=this.baseInfoMap).call(t)],s=n.length?n[0]:"UnableToGetSid",a=this.baseInfoMap.get(s);if(!a)return;const l=a.info,f=Date.now(),m=Ut(Ut({},l),{},{eventType:Zi.WS_COMPRESSOR_INIT,lts:f,eventElapse:e.eventElapse,elapse:f-a.startTime,status:e.status?1:2});this.send({type:Xn.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(e,t,n,s){const a=this.baseInfoMap.get(e);if(!a)return;const l=a.info,f=Date.now(),m=Ut(Ut(Ut({},l),s),{},{elapse:f-a.startTime,eventType:t,lts:f,firstDecodeFrame:Math.max((s.firstFrame||f)-a.startTime,0),apEnd:Math.max(s.apEnd-a.startTime,0),apStart:Math.max(s.apStart-a.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-a.startTime,0),joinGwStart:Math.max(s.joinGwStart-a.startTime,0),pcEnd:Math.max(s.pcEnd-a.startTime,0),pcStart:Math.max(s.pcStart-a.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-a.startTime,0),subscriberStart:Math.max(s.subscriberStart-a.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-a.startTime,0)});this.send({type:n,data:m},!0)}firstRemoteFrame(e,t,n,s){const a=this.baseInfoMap.get(e);if(!a)return;const l=a.info,f=Date.now(),m=Ut(Ut(Ut({},l),s),{},{elapse:f-a.startTime,eventType:t,lts:f});this.send({type:n,data:m},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut(Ut({},s),t),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:a-n.startTime,eventType:Zi.AB_TEST,lts:a});this.send({type:Xn.AB_TEST,data:l},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut(Ut({},s),t),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:a-n.startTime,eventType:Zi.PC_STATS,lts:a,preallocation:t.preallocation?1:0});this.send({type:Xn.PC_STATS,data:l},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut(Ut({},s),t),{},{vid:s.vid===void 0?0:Number(s.vid),eventType:Zi.UPDATE_REMOTE_RTPCAPABILITIES,lts:a});this.send({type:Xn.UPDATE_REMOTE_RTPCAPABILITIES,data:l},!0)}}onGatewayStream(e,t,n,s){const a=this.baseInfoMap.get(e);if(!a)return;const l=a.info,f=Date.now(),m=Ut(Ut(Ut({},l),s),{},{eventType:t,lts:f});this.send({type:n,data:m},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut({},s),{},{eventType:Zi.STREAM_SWITCH,lts:a,isDual:t.isdual,elapse:a-n.startTime,success:t.succ});this.send({type:Xn.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut({},s),{},{eventType:Zi.REQUEST_PROXY_APPCENTER,lts:a,eventElapse:a-t.lts,elapse:a-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Xn.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut({},s),{},{eventType:Zi.REQUEST_PROXY_WORKER_MANAGER,lts:a,eventElapse:a-t.lts,elapse:a-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Xn.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?k.debug("reportProxyServerurl: ".concat(e)):k.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut({},s),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:a,elapse:a-n.startTime,joinChannelSuccessElapse:a-(n.lastJoinSuccessTime||a),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Xn.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now();(function(l,f,m){const _=l[f];if(!_||typeof _!="string")return[l];l[f]="";const S=Yl(JSON.stringify(l));let b=0;const A=[];let O=0;for(let D=0;D<_.length;D++)O+=_.charCodeAt(D)<=127?1:3,O<=m-S||(A[A.length]=rt(rt({},l),{},{[f]:_.substring(b,D)}),b=D,O=_.charCodeAt(D)<=127?1:3);return b!==_.length-1&&(A[A.length]=rt(rt({},l),{},{[f]:_.substring(b)})),A})(Ut(Ut(Ut({},s),t),{},{elapse:a-n.startTime,lts:a,productType:"WebRTC"}),"payload",1300).forEach(l=>this.send({type:Xn.WORKER_EVENT,data:l},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut(Ut({},s),t),{},{elapse:a-n.startTime,lts:a});this.send({type:Xn.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut(Ut({},s),t),{},{elapse:a-n.startTime,lts:a,extend:t.extend||void 0});this.send({type:Xn.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const s=n.info,a=Date.now(),l=Ut(Ut(Ut({},s),t),{},{elapse:a-n.startTime,lts:a});this.send({type:Xn.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>Z("CUSTOM_REPORT_LIMIT"))throw new ve($.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),s=t.map(a=>({type:Xn.USER_ANALYTICS,data:Ut(Ut({sid:e},a),{},{lts:n})}));try{Z("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(a){throw k.error("send custom report message failed",a.toString()),new ve($.CUSTOM_REPORT_SEND_FAILED,a.message)}}sendApiInvoke(e){const t=Z("NOT_REPORT_EVENT");if(e.tag&&We(t)&&We(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:s,uid:a,cid:l}=n.info;let f;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ve){const{code:_,message:S}=e.error;f=_||S||e.error.toString()}else f=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:s,cid:l,uid:a,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?f:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Xn.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>Z("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],s=[];for(;e.length;){const l=e.shift();n.length<20?n.push(l):s.push(l)}e.push(...s);for(const l of[...n]){var a;this.ltsList.indexOf(l.data.lts)!==-1?(l.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(l.data.lts)):(this.ltsList.push(l.data.lts),HS(a=this.ltsList).call(a,(f,m)=>f-m))}return t||(this.lastSendNormalEventTime=Date.now()),Z("ENABLE_EVENT_REPORT")&&n.length&&(Z("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((l=>f=>{Z("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(l):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(l),this.normalEventUploadPendingItems.length>Z("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Z("NORMAL_EVENT_QUEUE_CAPACITY")),k.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Di.networkState===ga.OFFLINE&&await Ye.race([Di.onlineWaiter,gs(2*Bi.maxRetryTimeout)]);const t=a=>{let l=new Uint8Array;return a.forEach(f=>{const m=Ww(JSON.stringify(f.data)),_=new ArrayBuffer(5),S=(A=>{let O=0;return Object.entries(Xn).forEach(D=>{let[G,B]=D;B===A.type&&(O=Rq[G])}),O})(f),b=new DataView(_);b.setUint16(0,m.byteLength,!0),b.setUint8(2,255&S),b.setUint8(3,S>>>8&255),b.setUint8(4,S>>>16&255),l=fM(l,new Uint8Array(_)),l=fM(l,m)}),l},n="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(Z("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let a=0;a<2;a+=1){a===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(Z("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await Qw(s,{timeout:1e4,data:t(e),headers:Ut(Ut({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(l){if(a===1)throw l;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),s=n?void 0:this._aid,a={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:n,aid:s};Di.networkState===ga.OFFLINE&&await Ye.race([Di.onlineWaiter,gs(2*Bi.maxRetryTimeout)]);const l=t?"/events/proto-raws":"/events/messages";let f=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("EVENT_REPORT_DOMAIN"),"&p=").concat(Z("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(Z("EVENT_REPORT_DOMAIN"),":").concat(Z("STATS_COLLECTOR_PORT")).concat(l));for(let m=0;m<2;m+=1){m===1&&(f=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Z("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(Z("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Z("STATS_COLLECTOR_PORT")).concat(l)));try{t?await lq(f,{timeout:1e4,data:a}):await Qw(f,{timeout:1e4,data:a})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(e,t){const n=Object.assign({},bq);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),s=n[n.length-1];s&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:s,tag:li.TRACER}).onSuccess()}};jM.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Di.networkState,gt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:li.TRACER}).onSuccess("logUploadError")});class Ee extends ve{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),ui(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,k)}throw(){super.throw(k)}}const Es={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function on(){return Es}function KM(){return"setSinkId"in HTMLAudioElement.prototype&&(!Z("RESTRICTION_SET_PLAYBACK_DEVICE")||(iu()||tM())&&!Gw())}function WM(){return!Es.supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&su()}let _s=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function jE(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function sn(e,t,n,s,a){return{width:e,height:t,frameRate:n,bitrateMin:s,bitrateMax:a}}function Qo(e,t,n,s,a){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:s,bitrateMax:a}}function dO(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const Aq={"90p":sn(160,90),"90p_1":sn(160,90),"120p":sn(160,120,15,30,65),"120p_1":sn(160,120,15,30,65),"120p_3":sn(120,120,15,30,50),"120p_4":sn(212,120),"180p":sn(320,180,15,30,140),"180p_1":sn(320,180,15,30,140),"180p_3":sn(180,180,15,30,100),"180p_4":sn(240,180,15,30,120),"240p":sn(320,240,15,40,200),"240p_1":sn(320,240,15,40,200),"240p_3":sn(240,240,15,40,140),"240p_4":sn(424,240,15,40,220),"360p":sn(640,360,15,80,400),"360p_1":sn(640,360,15,80,400),"360p_3":sn(360,360,15,80,260),"360p_4":sn(640,360,30,80,600),"360p_6":sn(360,360,30,80,400),"360p_7":sn(480,360,15,80,320),"360p_8":sn(480,360,30,80,490),"360p_9":sn(640,360,15,80,800),"360p_10":sn(640,360,24,80,800),"360p_11":sn(640,360,24,80,1e3),"480p":sn(640,480,15,100,500),"480p_1":sn(640,480,15,100,500),"480p_2":sn(640,480,30,100,1e3),"480p_3":sn(480,480,15,100,400),"480p_4":sn(640,480,30,100,750),"480p_6":sn(480,480,30,100,600),"480p_8":sn(848,480,15,100,610),"480p_9":sn(848,480,30,100,930),"480p_10":sn(640,480,10,100,400),"720p":sn(1280,720,15,120,1130),"720p_auto":sn(1280,720,30,900,3e3),"720p_1":sn(1280,720,15,120,1130),"720p_2":sn(1280,720,30,120,2e3),"720p_3":sn(1280,720,30,120,1710),"720p_5":sn(960,720,15,120,910),"720p_6":sn(960,720,30,120,1380),"1080p":sn(1920,1080,15,120,2080),"1080p_1":sn(1920,1080,15,120,2080),"1080p_2":sn(1920,1080,30,120,3e3),"1080p_3":sn(1920,1080,30,120,3150),"1080p_5":sn(1920,1080,60,120,4780),"1440p":sn(2560,1440,30,120,4850),"1440p_1":sn(2560,1440,30,120,4850),"1440p_2":sn(2560,1440,60,120,7350),"4k":sn(3840,2160,30,120,8910),"4k_1":sn(3840,2160,30,120,8910),"4k_3":sn(3840,2160,60,120,13500)},Cq={"480p":Qo(640,480,5),"480p_1":Qo(640,480,5),"480p_2":Qo(640,480,30),"480p_3":Qo(640,480,15),"720p":Qo(1280,720,5),"720p_auto":sn(1280,720,30,900,3e3),"720p_1":Qo(1280,720,5),"720p_2":Qo(1280,720,30),"720p_3":Qo(1280,720,15),"1080p":Qo(1920,1080,5),"1080p_1":Qo(1920,1080,5),"1080p_2":Qo(1920,1080,30),"1080p_3":Qo(1920,1080,15)},Iq={"1SL1TL":dO(1,1),"3SL3TL":dO(3,3),"2SL3TL":dO(2,3)};function $l(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Aq[e]):e}function uO(e){return typeof e=="string"?Object.assign({},Cq[e]):e}function fR(e){return typeof e=="string"?Object.assign({},Iq[e]):e}const wq={speech_low_quality:jE(16e3,!1),speech_standard:jE(32e3,!1,18),music_standard:jE(48e3,!1),standard_stereo:jE(48e3,!0,56),high_quality:jE(48e3,!1,128),high_quality_stereo:jE(48e3,!0,192)};function pR(e){return typeof e=="string"?Object.assign({},wq[e]):e}const GE=[];function YM(e){return zi(e,"mediaSource",["screen","window","application"]),!0}let dt=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),kn=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),HE=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Oq=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Dq=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),nm=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),KE=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),WE=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),YE=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),ka=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const hO={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},fO={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},qM={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Nq={uplinkNetworkQuality:0,downlinkNetworkQuality:0},$M={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Sr=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Ma=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),uy=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),im=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),ir=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),zl=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const pO={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let mR=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function zM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Jn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zM(Object(n),!0).forEach(function(s){ge(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zM(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function ge(e,t,n){return(t=function(s){var a=function(l,f){if(typeof l!="object"||l===null)return l;var m=l[Symbol.toPrimitive];if(m!==void 0){var _=m.call(l,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(s);return typeof a=="symbol"?a:String(a)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rn(e,t,n,s,a){var l,f,m={};return Object.keys(s).forEach(function(_){m[_]=s[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=jr(l=ih(f=n.slice()).call(f)).call(l,function(_,S){return S(e,t,_)||_},m),a&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(a):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(e,t,m),m=null),m}class XM extends ii{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(nm.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),ge(this,"trackMediaType",void 0),ge(this,"_ID",void 0),ge(this,"_rtpTransceiver",void 0),ge(this,"_lowRtpTransceiver",void 0),ge(this,"_hints",[]),ge(this,"_isClosed",!1),ge(this,"_originMediaStreamTrack",void 0),ge(this,"mediaStreamTrack",void 0),ge(this,"_external",{}),this._ID=n||Pn(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(s){We(GE).call(GE,s)||GE.push(s)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Uh(()=>{var n;gt.reportApiInvoke(null,{name:Fi.GET_MEDIA_STREAM_TRACK,options:[],tag:li.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===HE.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=GE.indexOf(t);n!==-1&&GE.splice(n,1)}(this),this.emit(KE.CLOSED),this.removeAllListeners(nm.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===HE.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(nm.TRANSCEIVER_UPDATED,t,n)}}class qE extends XM{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),ge(this,"_enabled",!0),ge(this,"_muted",!1),ge(this,"_isExternalTrack",!1),ge(this,"_isClosed",!1),ge(this,"_enabledMutex",void 0),ge(this,"processor",void 0),ge(this,"_processorContext",void 0),ge(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ps("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,k.debug("[".concat(this.getTrackId(),"] close")),this.emit(dt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=s,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await xn(this,dt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(KE.TRACK_ENDED)}stateCheck(t,n){if(k.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),ru(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new ve($.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",k);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new ve($.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",k)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Ye.resolve([])}}const JM=window.AudioContext||window.webkitAudioContext;let Ua=null;const bn=new class extends ii{constructor(){super(...arguments),ge(this,"prevState",void 0),ge(this,"curState",void 0),ge(this,"currentTime",void 0),ge(this,"currentTimeStuckAt",void 0),ge(this,"interruptDetectorTrack",void 0),ge(this,"onLocalAudioTrackMute",()=>{k.info("ios15-interruption-start"),this.emit(_s.IOS_15_16_INTERRUPTION_START)}),ge(this,"onLocalAudioTrackUnmute",async()=>{k.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?k.info("ios15-interruption-end-canceled"):(Ua&&await Ua.suspend(),this.emit(_s.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){k.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){k.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function $E(){if(!Ua){if(function(){if(!JM)return void k.error("your browser is not support web audio");k.info("create audio context");const e=Jn({},Z("WEBAUDIO_INIT_OPTIONS"));k.debug("audio context init option:",JSON.stringify(e)),Ua=new JM(e),bn.curState=Ua.state,Ua.onstatechange=()=>{bn.prevState=bn.curState,bn.curState=Ua?Ua.state:void 0;const{prevState:t,curState:n}=bn,s=n==="running",a=n==="interrupted",l=t==="running",f=t==="suspended",m=t==="interrupted",_=nn().osVersion;(_r()||Xo())&&l&&a&&(k.info("ios".concat(_,"-interruption-start")),bn.emit(_s.IOS_INTERRUPTION_START)),(_r()||Xo())&&(f||m)&&s&&(k.info("ios".concat(_,"-interruption-end")),bn.emit(_s.IOS_INTERRUPTION_END)),t!==n&&bn.emit(_s.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=Ua)===null||t===void 0?void 0:t.currentTime;bn.currentTime!==n?(bn.currentTimeStuckAt&&(k.debug("AudioContext current time resume at ".concat(n)),bn.currentTimeStuckAt=void 0),bn.currentTime=n):(n!==bn.currentTimeStuckAt&&(gt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:li.TRACER}).onSuccess(),k.warning("AudioContext current time stuck at ".concat(n))),bn.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let s,a=!1,l=!1,f=!1;function m(B){t.state==="running"?_(!1):_r()||Xo()?t.state==="suspended"&&(_(!0),B&&t.resume().then(S,S)):t.state!=="closed"&&(_(!0),B&&t.resume().then(S,S))}function _(B){if(a!==B){a=B;for(let j=0,Y=n;j<Y.length;j+=1){const q=Y[j];B?window.addEventListener(q,b,{capture:!0,passive:!0}):window.removeEventListener(q,b,{capture:!0,passive:!0})}}}function S(){m(!1)}function b(){m(!0)}function A(B){if(!f)if(s.paused)if(B){let j;O(!1),f=!0;try{j=s.play(),j?j.then(D,D):(s.addEventListener("playing",D),s.addEventListener("abort",D),s.addEventListener("error",D))}catch{D()}}else O(!0);else O(!1)}function O(B){if(l!==B){l=B;for(let j=0,Y=n;j<Y.length;j++){const q=Y[j];B?window.addEventListener(q,G,{capture:!0,passive:!0}):window.removeEventListener(q,G,{capture:!0,passive:!0})}}}function D(){s.removeEventListener("playing",D),s.removeEventListener("abort",D),s.removeEventListener("error",D),f=!1,A(!1)}function G(){A(!0)}if(_r()){const B=t.createMediaStreamDestination(),j=document.createElement("div");j.innerHTML="<audio x-webkit-airplay='deny'></audio>",s=j.children.item(0),s.controls=!1,s.disableRemotePlayback=!0,s.preload="auto",s.srcObject=B.stream,A(!0)}bn.on(_s.STATE_CHANGE,function(){m(!0)}),m(!1)}(Ua)}(),!Ua)throw new ve($.NOT_SUPPORTED,"can not create audio context");return Ua}return Ua}function sm(e){if(function(){if(mO!==null)return mO;const s=$E(),a=s.createBufferSource(),l=s.createGain(),f=s.createGain();a.connect(l),a.connect(f),a.disconnect(l);let m=!1;try{a.disconnect(l)}catch{m=!0}return a.disconnect(),mO=m,m}())return;const t=e.connect,n=e.disconnect;e.connect=(s,a,l)=>{var f;return e._inputNodes||(e._inputNodes=[]),We(f=e._inputNodes).call(f,s)||(s instanceof AudioNode?(e._inputNodes.push(s),t.call(e,s,a,l)):t.call(e,s,a)),e},e.disconnect=(s,a,l)=>{n.call(e),s?sR(e._inputNodes,s):e._inputNodes=[];for(const f of e._inputNodes)t.call(e,f)}}let mO=null;function gO(e,t){let n=!1;const s=1/t;if(Z("DISABLE_WEBAUDIO")){const a=window.setInterval(()=>{n?window.clearInterval(a):e(performance.now()/1e3)},1e3*s)}else{const a=$E();let l=a.createGain();l.gain.value=0,l.connect(a.destination);const f=()=>{if(n)return void(l=null);const m=a.createOscillator();m.onended=f,m.connect(l),m.start(0),m.stop(a.currentTime+s),e(a.currentTime)};f()}return()=>{n=!0}}class QM{constructor(){ge(this,"context",void 0),ge(this,"analyserNode",void 0),ge(this,"sourceNode",void 0),this.context=$E(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||_r()||Xo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let a=0;a<t.length;++a)t[a]=s[a]/128-1}const n=jr(t).call(t,(s,a)=>s+a*a,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{k.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class ZM extends ii{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var s;(s=this.sourceNode)===null||s===void 0||s.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ge(this,"outputNode",void 0),ge(this,"outputTrack",void 0),ge(this,"isPlayed",!1),ge(this,"sourceNode",void 0),ge(this,"context",void 0),ge(this,"audioBufferNode",void 0),ge(this,"destNode",void 0),ge(this,"audioOutputLevel",0),ge(this,"volumeLevelAnalyser",void 0),ge(this,"_processedNode",void 0),ge(this,"playNode",void 0),ge(this,"isDestroyed",!1),ge(this,"onNoAudioInput",void 0),ge(this,"isNoAudioInput",!1),ge(this,"_noAudioInputCount",0),this.context=$E(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),sm(this.outputNode),this.volumeLevelAnalyser=new QM}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(ka.ON_AUDIO_BUFFER,function(s){for(let a=0;a<s.outputBuffer.numberOfChannels;a+=1){const l=s.outputBuffer.getChannelData(a);for(let f=0;f<l.length;f+=1)l[f]=0}return s.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!on().webAudioMediaStreamDest)throw new ve($.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&rR(()=>{bn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;_r()||Xo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let s;n.getFloatTimeDomainData?(s=new Float32Array(n.fftSize),n.getFloatTimeDomainData(s)):(s=new Uint8Array(n.fftSize),n.getByteTimeDomainData(s));let a=!1;for(let l=0;l<s.length;l++)s[l]!==0&&(a=!0);return a?(this.isNoAudioInput=!1,!0):(await gs(200),await this.checkHasAudioInput(t?t+1:1)&&a)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class e2 extends ZM{get isFreeze(){return!1}constructor(t,n,s){var a;if(super(),ge(this,"sourceNode",void 0),ge(this,"track",void 0),ge(this,"clonedTrack",void 0),ge(this,"audioElement",void 0),ge(this,"isCurrentTrackCloned",!1),ge(this,"isRemoteTrack",!1),ge(this,"originVolumeLevelAnalyser",void 0),ge(this,"rebuildWebAudio",async()=>{if(k.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void k.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>k.info("resume success")),k.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),sm(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const S=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(S,this.context.currentTime),sm(this.outputNode),this.emit(ka.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new ve($.UNEXPECTED_ERROR);this.track=t;const l=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(l),sm(this.sourceNode),s){const m=s.clone();m.enabled=!0,this.clonedTrack=m,k.debug("create an unmuted track ".concat(m.id," from the original track ").concat(s.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));sm(_),this.originVolumeLevelAnalyser=new QM,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=l;const f=nn();n&&f.os===Qi.IOS&&Number((a=f.osVersion)===null||a===void 0?void 0:a.split(".")[0])<15&&(bn.on(_s.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),sm(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ka.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),bn.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),k.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([n]));sm(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function t2(e,t,n){const s=(l,f)=>l?typeof l!="number"?l.max||l.exact||l.ideal||l.min||f:l:f,a={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:s(t.height,1080),maxWidth:s(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(a.video.mandatory.maxFrameRate=t.frameRate.max,a.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(a.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(a)}async function Lq(e,t){const n=await n2(e.mediaSource),{sourceId:s,audio:a}=await function(l){let f=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Ye((m,_)=>{const S=document.createElement("div");S.innerText="share screen",S.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const b=document.createElement("div");b.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const A=document.createElement("div");A.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",A.setAttribute("style","height: 12%;");const O=document.createElement("div");O.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const D=document.createElement("div");D.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(Y);const q=new Error("NotAllowedError");q.name="NotAllowedError",_(q)};let B=f;const j=document.createElement("div");if(f){const q=document.createElement("input");q.setAttribute("type","checkbox");const ie=document.createElement("span");q.setAttribute("style","margin-right: 6px;"),ie.innerText="Share audio",q.checked=B,q.onchange=()=>{B=q.checked},j.appendChild(q),j.appendChild(ie)}D.appendChild(j),D.appendChild(G),b.appendChild(A),b.appendChild(O),b.appendChild(D);const Y=document.createElement("div");Y.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Y.appendChild(S),Y.appendChild(b),document.body.appendChild(Y),l.map(q=>{if(q.id){const ie=document.createElement("div");ie.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let le=q.thumbnail;try{const{width:ue}=le.getSize();ue>1920&&(le=le.resize({width:1920}))}catch(ue){throw ue&&ue.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ue}ie.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+le.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+q.name.replace(/[\u00A0-\u9999<>\&]/g,function(ue){return"&#"+ue.charCodeAt(0)+";"})+"</span>",ie.onclick=()=>{document.body.removeChild(Y),m({sourceId:q.id,audio:B})},O.appendChild(ie)}})})}(n,t);return await t2(s,e,a)}async function n2(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=pM();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new ve($.ELECTRON_IS_NULL);let s=null;try{var a;s=((a=n.desktopCapturer)===null||a===void 0?void 0:a.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{s=null}s&&s.then||(s=new Ye((l,f)=>{n.desktopCapturer.getSources({types:t},(m,_)=>{m?f(m):l(_)})}));try{return await s}catch(l){throw new ve($.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}const EO=new Ps("safari");let i2=!1,s2=!1;async function Fa(e,t){let n=0,s=null;for(;n<2;)try{s=await xq(e,t,n>0);break}catch(a){if(a instanceof ve)throw k.error("[".concat(t,"] ").concat(a.toString())),a;const l=gR(a.name||a.code||a,a.message);if(l.code===$.MEDIA_OPTION_INVALID){k.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await gs(500);continue}throw k.error("[".concat(t,"] ").concat(l.toString())),l}if(!s)throw new ve($.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}async function xq(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ve($.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const s=on(),a=new MediaStream;if(e.audioSource&&a.addTrack(e.audioSource),e.videoSource&&a.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return k.debug("Using Video Source/ Audio Source"),a;if(e.screen)if(pM())e.screen.sourceId?zE(a,await t2(e.screen.sourceId,e.screen,!!e.screenAudio)):zE(a,await Lq(e.screen,!!e.screenAudio));else if(iu()&&e.screen.extensionId&&e.screen.mandatory){if(!s.getStreamFromExtension)throw new ve($.NOT_SUPPORTED,"This browser does not support screen sharing");k.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const O=await(f=e.screen.extensionId,m=t,new Ye((D,G)=>{try{chrome.runtime.sendMessage(f,{getStream:!0},B=>{if(!B||!B.streamId)return k.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),B),void G(new ve($.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));D(B.streamId)})}catch(B){k.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(f,")"),B.toString()),G(new ve($.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=O,zE(a,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(s.getDisplayMedia){var l;e.screen.mediaSource&&YM(e.screen.mediaSource);const O={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(l=e.screen.displaySurface)!==null&&l!==void 0?l:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:D,surfaceSwitching:G,systemAudio:B,preferCurrentTab:j}=e.screen,Y={selfBrowserSurface:D,surfaceSwitching:G,systemAudio:B,preferCurrentTab:j};!D&&delete Y.selfBrowserSurface,!G&&delete Y.surfaceSwitching,!B&&delete Y.systemAudio,!j&&delete Y.preferCurrentTab,k.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:O,audio:e.screenAudio,controls:Y})),zE(a,await navigator.mediaDevices.getDisplayMedia(Jn({video:O,audio:e.screenAudio},Y)))}else{if(!oi())throw k.error("[".concat(t,"] This browser does not support screenSharing")),new ve($.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&YM(e.screen.mediaSource);const O={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};k.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(O))),zE(a,await navigator.mediaDevices.getUserMedia(O))}}var f,m;if(!e.video&&!e.audio)return a;let _={video:e.video,audio:e.audio},S=Z("MEDIA_DEVICE_CONSTRAINTS");if(S)try{typeof S=="string"&&(S=JSON.parse(S)),_=$w(_,S)}catch{}k.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(_)),nn();let b,A=null;(Cs()||_r()||nR())&&(A=await EO.lock());try{b=await navigator.mediaDevices.getUserMedia(_)}catch(O){throw A&&A(),O}return _.audio&&(i2=!0),_.video&&(s2=!0),zE(a,b),A&&A(),a}function gR(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ve($.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new ve($.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new ve($.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new ve($.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ve($.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new ve($.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return k.error("getUserMedia unexpected error",e),new ve($.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function zE(e,t){const n=e.getVideoTracks()[0],s=e.getAudioTracks()[0],a=t.getVideoTracks()[0],l=t.getAudioTracks()[0];l&&(s&&e.removeTrack(s),e.addTrack(l)),a&&(n&&e.removeTrack(n),e.addTrack(a))}const Ba=new class extends ii{get state(){return this._state}set state(e){e!==this._state&&(this.emit(im.STATE_CHANGE,e),this._state=e)}constructor(){super(),ge(this,"_state",uy.IDLE),ge(this,"isAccessMicrophonePermission",!1),ge(this,"isAccessCameraPermission",!1),ge(this,"lastAccessMicrophonePermission",!1),ge(this,"lastAccessCameraPermission",!1),ge(this,"checkdeviceMatched",!1),ge(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(Z("ENUMERATE_DEVICES_INTERVAL")||(iR()||tR()===Qi.HARMONY_OS)&&su())&&this.updateDevicesInfo()},Z("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>k.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ve($.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const s=await navigator.mediaDevices.enumerateDevices(),a=this.checkMediaDeviceInfoIsOk(s);let l=!this.isAccessMicrophonePermission&&e,f=!this.isAccessCameraPermission&&t;a.audio&&(l=!1),a.video&&(f=!1);let m=null,_=null,S=null;if(!n&&(l||f)){if(EO.isLocked&&(k.debug("[device manager] wait GUM lock"),(await EO.lock())(),k.debug("[device manager] GUM unlock")),i2&&(l=!1,this.isAccessMicrophonePermission=!0),s2&&(f=!1,this.isAccessCameraPermission=!0),k.debug("[device manager] check media device permissions",e,t,l,f),l&&f){try{S=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(b){const A=gR(b.name||b.code||b,b.message);if(A.code===$.PERMISSION_DENIED)throw A;k.warning("getUserMedia failed in getDevices",A)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(b){const A=gR(b.name||b.code||b,b.message);if(A.code===$.PERMISSION_DENIED)throw A;k.warning("getUserMedia failed in getDevices",A)}this.isAccessMicrophonePermission=!0}else if(f){try{_=await navigator.mediaDevices.getUserMedia({video:t})}catch(b){const A=gR(b.name||b.code||b,b.message);if(A.code===$.PERMISSION_DENIED)throw A;k.warning("getUserMedia failed in getDevices",A)}this.isAccessCameraPermission=!0}k.debug("[device manager] mic permission",e,"cam permission",t)}try{const b=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(A=>A.stop()),_&&_.getTracks().forEach(A=>A.stop()),S&&S.getTracks().forEach(A=>A.stop()),m=null,_=null,S=null,b}catch(b){return m&&m.getTracks().forEach(A=>A.stop()),_&&_.getTracks().forEach(A=>A.stop()),S&&S.getTracks().forEach(A=>A.stop()),m=null,_=null,S=null,new ve($.ENUMERATE_DEVICES_FAILED,b.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new ve($.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=uy.INITING;try{await this.updateDevicesInfo(),this.state=uy.INITEND}catch(e){throw k.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=uy.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new ve($.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const a=e.find(f=>f.kind==="audioinput"&&f.deviceId==="default"),l=e.find(f=>f.kind==="audiooutput"&&f.deviceId==="default");a&&l?l.groupId===a.groupId?k.debug("[device-check] default input ".concat(a.label," and output ").concat(l.label," is the same group")):k.debug("[device-check] default input ".concat(a.label," and output ").concat(l.label," is not the same group")):k.debug("[device-check] default input or output not found")}const s=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(a=>{if(!a.deviceId)return;const l=this.deviceInfoMap.get("".concat(a.kind,"_").concat(a.deviceId));if((l?l.state:"INACTIVE")!=="ACTIVE"){const f={initAt:t,updateAt:t,device:a,state:"ACTIVE"};this.deviceInfoMap.set("".concat(a.kind,"_").concat(a.deviceId),f),n.push(f)}l&&(l.updateAt=t)}),this.deviceInfoMap.forEach((a,l)=>{a.state==="ACTIVE"&&a.updateAt!==t&&(a.state="INACTIVE",n.push(a))}),this.state!==uy.INITEND)return s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(a=>{switch(a.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(im.RECORDING_DEVICE_CHANGED,a);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(im.CAMERA_DEVICE_CHANGED,a);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(im.PLAYOUT_DEVICE_CHANGED,a)}}),s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(a=>a.kind==="audioinput"),n=e.filter(a=>a.kind==="videoinput"),s={audio:!1,video:!1};for(const a of t)if(a.label&&a.deviceId){s.audio=!0;break}for(const a of n)if(a.label&&a.deviceId){s.video=!0;break}return s}};let _O=!1;const Va=new class extends ii{constructor(){super(...arguments),ge(this,"onAutoplayFailed",void 0),ge(this,"onAudioAutoplayFailed",void 0)}};function r2(){if(nn(),!_O){const e=t=>{t.preventDefault(),_O=!1,ny()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};_O=!0,ny()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),k.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Va.onAutoplayFailed?Va.onAutoplayFailed():Va.onAudioAutoplayFailed?k.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):k.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Va.emit("autoplay-failed")}}function a2(e,t,n,s){if(!e)return;const a=gt.getBaseInfoBySessionId(e);if(!a)return;const l=a.info,f=Date.now(),m=Jn(Jn({},l),{},{vid:l.vid===void 0?0:Number(l.vid),lts:f,elapse:f-a.startTime,cbRegistered:Va.onAutoplayFailed||Va.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:s,extend:void 0});gt.send({type:Xn.AUTOPLAY_FAILED,data:m},!0)}const Pq=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],xr=new class{constructor(){ge(this,"onAutoplayFailed",void 0),ge(this,"elementMap",new Map),ge(this,"elementStateMap",new Map),ge(this,"elementsNeedToResume",[]),ge(this,"sinkIdMap",new Map),ge(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,s]=t;const a=this.elementStateMap.get(n),l=s.srcObject.getAudioTracks()[0],f=l&&l.readyState;if(k.debug("resume after interrupted, ele: ".concat(a," audio: ").concat(f," ").concat(e)),f==="live"){if(e)return s.pause(),void s.play();if(bn.curState==="running")return kE()?(s.pause(),void s.play()):void(a&&a==="paused"&&s.play())}})}),ge(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const s=n.srcObject.getAudioTracks()[0];s&&s.readyState==="live"&&(k.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),bn.on(_s.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),bn.on(_s.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),bn.on(_s.STATE_CHANGE,()=>{_r()&&bn.prevState==="suspended"&&bn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(s){throw new ve($.PERMISSION_DENIED,"can not set sink id: "+s.toString())}}play(e,t,n,s){if(this.elementMap.has(t))return;const a=document.createElement("audio");a.autoplay=!0,a.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,a),this.elementMap.set(t,a),this.elementStateMap.set(t,ir.INIT),this.setVolume(t,n);const l=this.sinkIdMap.get(t);if(l)try{a.setSinkId(l).catch(m=>{k.warning("[".concat(t,"] set sink id failed"),m.toString())})}catch(m){k.warning("[".concat(t,"] set sink id failed"),m.toString())}const f=a.play();f&&f.then&&f.catch(m=>{s&&a2(s,"audio",m.message,t),k.warning("audio element play warning",m.toString()),this.elementMap.has(t)&&m.name==="NotAllowedError"&&(k.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(a),rR(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),r2()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Pq.forEach(n=>{t.addEventListener(n,s=>{const a=this.elementStateMap.get(e),l=s.type==="pause"?"paused":s.type;if(k.debug("[".concat(e,"] audio-element-status change ").concat(a," => ").concat(l)),s.type==="error"){const f=t==null?void 0:t.error;f&&k.error("[".concat(e,"] media error, code: ").concat(f.code,", message: ").concat(f.message))}this.elementStateMap.set(e,l)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{k.debug("Auto resume audio element success")}).catch(n=>{k.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new Ye(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{ny()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function bi(){return function(e,t,n){const s=n.value;return typeof s=="function"&&(n.value=function(){this._isClosed&&new ve($.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",k);for(var a=arguments.length,l=new Array(a),f=0;f<a;f++)l[f]=arguments[f];const m=s.apply(this,l);return m instanceof Ye?new Ye((_,S)=>{m.then(_).catch(S)}):m}),n}}class o2 extends ii{constructor(t){super(),ge(this,"name","VideoProcessorDestination"),ge(this,"ID","0"),ge(this,"_source",void 0),ge(this,"videoContext",void 0),ge(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ve($.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ve($.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Sr.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Sr.ON_TRACK,void 0)}}class c2 extends ii{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),ge(this,"constraintsMap",new Map),ge(this,"statsRegistry",[]),ge(this,"usageRegistry",[]),ge(this,"trackId",void 0),ge(this,"direction",void 0),ge(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await ws(this,Ma.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var s;return k.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),xn(this,Ma.REQUEST_UPDATE_CONSTRAINTS,Array.from(ps(s=this.constraintsMap).call(s)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return k.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),xn(this,Ma.REQUEST_UPDATE_CONSTRAINTS,Array.from(ps(n=this.constraintsMap).call(n)))}registerStats(t,n,s){this.statsRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:s})}unregisterStats(t,n){const s=this.statsRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===n);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:s,type:a,cb:l}of this.statsRegistry)try{const f=l();t.push({processorID:n,processorName:s,type:a,stats:f})}catch(f){k.error(new ve($.UNEXPECTED_ERROR,f.message))}return t}registerUsage(t,n){this.usageRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let s=n();s instanceof Ye&&(s=await s),t.push(Jn(Jn({},s),{},{direction:this.direction}))}catch(s){k.error("gather extension usage error",s)}return t}getDirection(){return this.direction}}class l2 extends ii{constructor(t){super(),ge(this,"name","AudioProcessorDestination"),ge(this,"ID","0"),ge(this,"inputTrack",void 0),ge(this,"inputNode",void 0),ge(this,"audioProcessorContext",void 0),ge(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ve($.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ve($.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Sr.ON_TRACK,void 0),this.emit(Sr.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Sr.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Sr.ON_NODE,this.inputNode))}}class d2 extends ii{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,s){super(),ge(this,"constraintsMap",new Map),ge(this,"statsRegistry",[]),ge(this,"audioContext",void 0),ge(this,"trackId",void 0),ge(this,"direction",void 0),ge(this,"usageRegistry",[]),ge(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=s}async getConstraints(){return ws(this,Ma.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var s;return k.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),xn(this,Ma.REQUEST_UPDATE_CONSTRAINTS,Array.from(ps(s=this.constraintsMap).call(s)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),xn(this,Ma.REQUEST_UPDATE_CONSTRAINTS,Array.from(ps(n=this.constraintsMap).call(n)))}registerStats(t,n,s){this.statsRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:s})}unregisterStats(t,n){const s=this.statsRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===n);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:s,type:a,cb:l}of this.statsRegistry)try{const f=l();t.push({processorID:n,processorName:s,type:a,stats:f})}catch(f){k.error(new ve($.UNEXPECTED_ERROR,f.message))}return t}registerUsage(t,n){this.usageRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let s=n();s instanceof Ye&&(s=await s),t.push(Jn(Jn({},s),{},{direction:this.direction}))}catch(s){k.error("gather extension usage error",s)}return t}getDirection(){return this.direction}}class SO extends ii{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ge(this,"context",void 0),ge(this,"processSourceNode",void 0),ge(this,"outputTrack",void 0),ge(this,"processedNode",void 0),ge(this,"clonedTrack",void 0),ge(this,"outputNode",void 0),this.outputNode=new kq}setVolume(){}createOutputTrack(){throw new ve($.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class kq{disconnect(){}connect(){}}function u2(e){return new Ye((t,n)=>{let s=!1;const a=document.createElement("video");a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.muted=!0,a.autoplay=!0,a.setAttribute("playsinline",""),a.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(a);const l=_r()?"canplay":"playing";a.addEventListener(l,()=>{const f=a.videoWidth,m=a.videoHeight;!f&&oi()||(s=!0,a.srcObject=null,a.remove(),t([f,m]))}),a.srcObject=new MediaStream([e]),a.play().catch(aR),setTimeout(()=>{s||(a.srcObject=null,a.remove(),t([a.videoWidth,a.videoHeight]))},4e3)})}function ER(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=$l(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!lM()&&n.frameRate&&(t.frameRate=n.frameRate),tM()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),oi()&&(t.frameRate={ideal:30,max:30}),t}function h2(e){const t={};return lM()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,iu()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function f2(e){const t=h2(e);if(e.encoderConfig){const n=pR(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),iR()&&(t.sampleRate=void 0),t}const Mq=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:s,height:a}=e.getMediaStreamTrackSettings();let{frameRate:l=n,width:f=s,height:m=a}=t;if(!l||!f||!m)return;f=zw(f),m=zw(m),l=zw(l);const{max:_,min:S}=function(D,G,B){const j=200*Math.pow(B/15,.6)*Math.pow(D*G/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(f,m,l),{bitrateMax:b,bitrateMin:A}=t||{};b||k.debug("calculate bitrate: [w: ".concat(f,", h: ").concat(m,", fps: ").concat(l,"] => [brMax: ").concat(b,", brMin: ").concat(A,"]"));const{maxFramerate:O}=Z("ENCODER_CONFIG_LIMIT");return O&&typeof O=="number"&&(l=Math.min(l,O)),{frameRate:l,bitrateMax:b||_,bitrateMin:A||S,scaleResolutionDownBy:1,scale:0}},p2=async(e,t,n)=>await(async(s,a,l)=>{const f=function(S){const b=[];for(let A=0;A<S.length;A+=2)b.push(parseInt(S.slice(A,A+2),16));return Uint8Array.from(b)}(AM(""+a+l)).slice(0,16),m=f.slice(0,12),_=await window.crypto.subtle.importKey("raw",f,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,s))})(e.buffer,t,n),yO=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Ye((n,s)=>{t.toBlob(async a=>{if(t.remove(),a){const l=await m2(a);n({buffer:l,width:t.width,height:t.height})}else s(new ve($.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},m2=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var g2,E2,_2,S2,y2,T2,v2,b2,R2,A2,C2,I2,w2,O2,D2,N2,L2,x2,si,P2,k2,M2,U2,F2,B2,Xl,V2,j2,G2,H2,K2,W2,Y2,q2,$2,z2,X2,J2,Q2,Ds;let fi=(g2=Ct({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),E2=Ct({argsMap:(e,t)=>[e.getTrackId(),t]}),_2=bi(),S2=FE("LocalAudioTrack","_enabledMutex"),y2=Ct({argsMap:(e,t)=>[e.getTrackId(),t]}),T2=bi(),v2=FE("LocalAudioTrack","_enabledMutex"),b2=Ct({argsMap:(e,t)=>[e.getTrackId(),t]}),R2=bi(),A2=bi(),C2=bi(),I2=Ct({argsMap:e=>[e.getTrackId()]}),w2=bi(),O2=Ct({argsMap:e=>[e.getTrackId()]}),D2=bi(),N2=Ct({argsMap:e=>[e.getTrackId()]}),L2=Ct({argsMap:(e,t)=>[e.getTrackId(),t.name]}),x2=Ct({argsMap:e=>[e.getTrackId()]}),rn((si=class extends qE{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?xr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,s){super(e,n),ge(this,"trackMediaType",YE.AUDIO),ge(this,"_encoderConfig",void 0),ge(this,"_trackSource",void 0),ge(this,"metadata",[]),ge(this,"_enabled",!0),ge(this,"_volume",100),ge(this,"_useAudioElement",!0),ge(this,"_bypassWebAudio",!1),ge(this,"processor",void 0),ge(this,"_processorContext",void 0),ge(this,"_processorDestination",void 0),ge(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!s,this._trackSource=new SO,Z("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),Z("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Cs()&&!Ua?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){An(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&xr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void k.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,xn(this,dt.NEED_REPLACE_TRACK,this).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{k.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!KM())throw new ve($.NOT_SUPPORTED,"your browser does not support setting the audio output device");await xr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await xn(this,dt.NEED_ENABLE_TRACK,this),k.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(s){throw n||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await xn(this,dt.NEED_DISABLE_TRACK,this)}catch(s){throw n||(this._enabled=!0),k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await xn(this,dt.NEED_MUTE_TRACK,this):await xn(this,dt.NEED_UNMUTE_TRACK,this))}getStats(){return Uh(()=>{k.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),La(this,dt.GET_STATS)||Jn({},hO)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ka.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ka.ON_AUDIO_BUFFER),this._source.on(ka.ON_AUDIO_BUFFER,n=>e(n))}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] start audio playback in element")),xr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?xr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&xr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await xn(this,dt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Ye.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new ve($.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new ve($.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Sr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await xn(this,dt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await xn(this,dt.NEED_REPLACE_TRACK,this))}),e.on(Sr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Sr.ON_TRACK),e.removeAllListeners(Sr.ON_NODE)}bindProcessorContextEvents(e){e.on(Ma.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Ma.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof SO&&(this._trackSource=new e2(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new d2(this._source.context,this.getTrackId(),"local"),t=new l2(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(ka.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(xr.stop(this.getTrackId()),this._source.play()),xn(this,dt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{k.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[g2],Object.getOwnPropertyDescriptor(si.prototype,"setVolume"),si.prototype),rn(si.prototype,"setPlaybackDevice",[E2,_2],Object.getOwnPropertyDescriptor(si.prototype,"setPlaybackDevice"),si.prototype),rn(si.prototype,"setEnabled",[S2,y2,T2],Object.getOwnPropertyDescriptor(si.prototype,"setEnabled"),si.prototype),rn(si.prototype,"setMuted",[v2,b2,R2],Object.getOwnPropertyDescriptor(si.prototype,"setMuted"),si.prototype),rn(si.prototype,"getStats",[A2],Object.getOwnPropertyDescriptor(si.prototype,"getStats"),si.prototype),rn(si.prototype,"setAudioFrameCallback",[C2],Object.getOwnPropertyDescriptor(si.prototype,"setAudioFrameCallback"),si.prototype),rn(si.prototype,"play",[I2,w2],Object.getOwnPropertyDescriptor(si.prototype,"play"),si.prototype),rn(si.prototype,"stop",[O2,D2],Object.getOwnPropertyDescriptor(si.prototype,"stop"),si.prototype),rn(si.prototype,"close",[N2],Object.getOwnPropertyDescriptor(si.prototype,"close"),si.prototype),rn(si.prototype,"pipe",[L2],Object.getOwnPropertyDescriptor(si.prototype,"pipe"),si.prototype),rn(si.prototype,"unpipe",[x2],Object.getOwnPropertyDescriptor(si.prototype,"unpipe"),si.prototype),si),_R=(P2=Ct({argsMap:(e,t)=>[e.getTrackId(),t]}),k2=bi(),M2=FE("MicrophoneAudioTrack","_enabledMutex"),U2=Ct({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),F2=bi(),B2=Ct({argsMap:e=>[e.getTrackId()]}),rn((Xl=class extends fi{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,s){super(e,t.encoderConfig?pR(t.encoderConfig):{},s,Z("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ge(this,"_config",void 0),ge(this,"_deviceName","default"),ge(this,"_constraints",void 0),ge(this,"_originalConstraints",void 0),ge(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(kE()||jw())&&bn.bindInterruptDetectorTrack(this)}async setDevice(e){if(k.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Ba.getDeviceById(e),n={};n.audio=Jn({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let s=null;try{s=await Fa(n,this.getTrackId())}catch(a){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),s=await Fa({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Ba.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}k.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return k.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),Z("AUTO_RESET_AUDIO_ROUTE")&&(_r()||Xo())){const f=navigator.audioSession;f&&(e||(f.type="playback"),f.type="auto")}if(!e){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),n||(this._enabled=!1);try{await xn(this,dt.NEED_DISABLE_TRACK,this)}catch(f){throw k.error("[".concat(this.getTrackId(),"] setEnabled false failed"),f.toString()),f}return}const a=Jn({},this._constraints),l=Ba.searchDeviceIdByName(this._deviceName);l&&!a.deviceId&&(a.deviceId=l);try{n||(this._enabled=!0);const f=await Fa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(f.getAudioTracks()[0],!1),await xn(this,dt.NEED_ENABLE_TRACK,this)}catch(f){throw n||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled true failed"),f.toString()),f}k.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(kE()||jw())&&bn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((_r()||Xo())&&this._enabled&&!this._isClosed&&bn.duringInterruption){const e=async()=>{bn.off(_s.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};bn.on(_s.IOS_INTERRUPTION_END,e)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(KE.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=Ba.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const s=await Fa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Ma.REQUEST_UPDATE_CONSTRAINTS,async(t,n,s)=>{try{const a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),n()}catch(a){s(a)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Ma.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[P2,k2],Object.getOwnPropertyDescriptor(Xl.prototype,"setDevice"),Xl.prototype),rn(Xl.prototype,"setEnabled",[M2,U2,F2],Object.getOwnPropertyDescriptor(Xl.prototype,"setEnabled"),Xl.prototype),rn(Xl.prototype,"close",[B2],Object.getOwnPropertyDescriptor(Xl.prototype,"close"),Xl.prototype),Xl),Uq=(V2=Ct({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),j2=bi(),G2=Ct({argsMap:e=>[e.getTrackId()]}),H2=bi(),K2=Ct({argsMap:e=>[e.getTrackId()]}),W2=bi(),Y2=Ct({argsMap:e=>[e.getTrackId()]}),q2=bi(),$2=Ct({argsMap:e=>[e.getTrackId()]}),z2=bi(),X2=Ct({argsMap:e=>[e.getTrackId()]}),J2=Ct({argsMap:e=>[e.getTrackId()]}),Q2=bi(),rn((Ds=class extends fi{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,s){super(t.createOutputTrack(),n,s),ge(this,"source",void 0),ge(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(ka.AUDIO_SOURCE_STATE_CHANGE,a=>{this.safeEmit(KE.SOURCE_STATE_CHANGE,a)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){An(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[V2,j2],Object.getOwnPropertyDescriptor(Ds.prototype,"startProcessAudioBuffer"),Ds.prototype),rn(Ds.prototype,"pauseProcessAudioBuffer",[G2,H2],Object.getOwnPropertyDescriptor(Ds.prototype,"pauseProcessAudioBuffer"),Ds.prototype),rn(Ds.prototype,"seekAudioBuffer",[K2,W2],Object.getOwnPropertyDescriptor(Ds.prototype,"seekAudioBuffer"),Ds.prototype),rn(Ds.prototype,"resumeProcessAudioBuffer",[Y2,q2],Object.getOwnPropertyDescriptor(Ds.prototype,"resumeProcessAudioBuffer"),Ds.prototype),rn(Ds.prototype,"stopProcessAudioBuffer",[$2,z2],Object.getOwnPropertyDescriptor(Ds.prototype,"stopProcessAudioBuffer"),Ds.prototype),rn(Ds.prototype,"close",[X2],Object.getOwnPropertyDescriptor(Ds.prototype,"close"),Ds.prototype),rn(Ds.prototype,"setAudioBufferPlaybackSpeed",[J2,Q2],Object.getOwnPropertyDescriptor(Ds.prototype,"setAudioBufferPlaybackSpeed"),Ds.prototype),Ds);class Hi extends fi{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=$E().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Pn(8,"track-mix-")),ge(this,"trackList",void 0),ge(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(k.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):k.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){k.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}sR(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof Hi?n.emit(nm.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class Fq extends ZM{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ka.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ge(this,"audioBuffer",void 0),ge(this,"sourceNode",void 0),ge(this,"startPlayTime",0),ge(this,"startPlayOffset",0),ge(this,"pausePlayTime",0),ge(this,"options",void 0),ge(this,"currentLoopCount",0),ge(this,"currentPlaybackSpeed",100),ge(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):k.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Z2=new Map;class TO{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const t=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(k.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){ge(this,"trackId",void 0),ge(this,"config",void 0),ge(this,"onFirstVideoFrameDecoded",void 0),ge(this,"onVideoStateChanged",void 0),ge(this,"freezeTimeCounterList",[]),ge(this,"renderFreezeAccTime",0),ge(this,"isKeepLastFrame",!1),ge(this,"timeUpdatedCount",0),ge(this,"freezeTime",0),ge(this,"playbackTime",0),ge(this,"lastTimeUpdatedTime",0),ge(this,"autoplayFailed",!1),ge(this,"videoTrack",void 0),ge(this,"videoElement",void 0),ge(this,"cacheVideoElement",void 0),ge(this,"renderStats",void 0),ge(this,"_videoState",zl.VideoStateStopped),ge(this,"videoElementCheckInterval",void 0),ge(this,"videoElementFreezeTimeout",void 0),ge(this,"_videoElementStatus",ir.NONE),ge(this,"isGettingVideoDimensions",!1),ge(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return k.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),ge(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&bn.curState==="running"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(eM())),oM()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),ge(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=ir.PLAYING;break;case"loadeddata":if(this.videoState=zl.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ir.CANPLAY;break;case"stalled":this.videoElementStatus=ir.STALLED;break;case"suspend":this.videoElementStatus=ir.SUSPEND;break;case"pause":this.videoElementStatus=ir.PAUSED,_r()||Xo()||Cs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ir.WAITING;break;case"abort":this.videoElementStatus=ir.ABORT;break;case"ended":this.videoElementStatus=ir.ENDED;break;case"emptied":this.videoElementStatus=ir.EMPTIED;break;case"error":{const s=this.videoElement.error;s&&(this.videoElementStatus=ir.ERROR,k.error("[".concat(this.trackId,"] media error: ").concat(s.message," (").concat(s.code,")")));break}case"timeupdate":{const s=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const a=s-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,ou.lastVisibleTime<ou.lastHiddenTime||l<ou.lastHiddenTime||l<ou.lastVisibleTime)return;for(a>Z("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=a),this.playbackTime+=a;this.playbackTime>=6e3;){this.playbackTime-=6e3;const f=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(f),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),ge(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(eM())),oM()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),bn.on(_s.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),bn.on(_s.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(a=>{t&&a2(t,"video",a.message,this.trackId),a.name==="NotAllowedError"?(k.warning("detected video element autoplay failed",a),this.autoplayFailed=!0,this.handleAutoPlayFailed()):k.warning("[".concat(this.trackId,"] play warning: "),a)});const s=nn();if((s.name==="Safari"&&Number(s.version)===15||kE())&&n&&n.then){const a=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(a).catch(a)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return k.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const s=n.getImageData(0,0,t.width,t.height);return t.remove(),s}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const s=document.createElement("canvas");s.width=this.videoElement.videoWidth,s.height=this.videoElement.videoHeight;const a=s.getContext("2d");return a?(a.drawImage(this.videoElement,0,0,s.width,s.height),new Ye((l,f)=>{s.toBlob(async m=>{if(s.remove(),m){const _=await m2(m);l({buffer:_,width:s.width,height:s.height})}else f(new ve($.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await yO(t)}destroy(){this.renderStats=void 0,bn.off(_s.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),bn.off(_s.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=zl.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ir.INIT,!this.videoElementCheckInterval&&(eU.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(l){return l!==document.body&&document.body.contains(l)})(this.videoElement)||(this.videoElementStatus=ir.DESTROYED)},1e3),Z("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let l;const f=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",f),this.videoElementFreezeTimeout=window.setTimeout(m,Z("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===zl.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=zl.VideoStateFrozen:document.addEventListener("visibilitychange",f))},_=(S,b)=>{if(this.videoElementStatus===ir.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=b.mediaTime):this.renderStats={lastTs:b.mediaTime,curTs:b.mediaTime,lastRenderNum:0,renderNum:0},l){const D=b.presentationTime-l.presentationTime;this.videoState===zl.VideoStateStarting&&(this.videoState=zl.VideoStateDecoding),this.videoState===zl.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,Z("VIDEO_FREEZE_DURATION"))),D<Z("VIDEO_FREEZE_DURATION")&&this.videoState===zl.VideoStateFrozen&&(this.videoState=zl.VideoStateDecoding),D>Z("VIDEO_FREEZE_DURATION")&&ou.lastVisibleTime>=ou.lastHiddenTime&&l.timestamp>ou.lastVisibleTime&&l.timestamp>ou.lastHiddenTime&&(this.renderFreezeAccTime+=D)}l=Jn(Jn({},b),{},{timestamp:S})}var A,O;Z("ENABLE_VIDEO_FRAME_CALLBACK")&&((A=(O=this.videoElement).requestVideoFrameCallback)===null||A===void 0||A.call(O,_))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),iR()&&!Z("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const s=nn();s.name==="Safari"&&Number(s.version)===15||kE()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,oi()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,oi()&&this.videoElement.load());const a=this.videoElement.play();a!==void 0&&a.catch(l=>{k.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){eU.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=ir.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{k.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(s=>{k.error(s)}),this.autoplayFailed=!1,ny()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};ny()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),r2()}}const eU=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class tU extends TO{constructor(t){super(t),ge(this,"container",void 0),ge(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,s):await yO(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",Z("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var nU,iU,sU,rU,aU,oU,cU,lU,dU,uU,hU,fU,pU,mU,gU,EU,_U,SU,yU,TU,vU,bU,RU,AU,Zt,CU,IU,wU,OU,DU,NU,LU,xU,ja;let Kn=(nU=Ct({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),iU=bi(),sU=Ct({argsMap:e=>[e.getTrackId()]}),rU=FE("LocalVideoTrack","_enabledMutex"),aU=Ct({argsMap:(e,t)=>[e.getTrackId(),t]}),oU=bi(),cU=FE("LocalVideoTrack","_enabledMutex"),lU=Ct({argsMap:(e,t)=>[e.getTrackId(),t]}),dU=bi(),uU=Ct({argsMap:(e,t)=>[e.getTrackId(),t]}),hU=bi(),fU=bi(),pU=Ct({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),mU=bi(),gU=bi(),EU=bi(),_U=bi(),SU=bi(),yU=bi(),TU=bi(),vU=Ct({argsMap:(e,t)=>[e.getTrackId(),t.name]}),bU=Ct({argsMap:e=>[e.getTrackId()]}),RU=Ct({argsMap:e=>[e.getTrackId()]}),AU=Ct({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),Zt=class zG extends qE{get videoHeight(){if(Cs()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Cs()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ir.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,s,a,l,f){if(super(t,l),ge(this,"trackMediaType",YE.VIDEO),ge(this,"_player",void 0),ge(this,"isUseScaleResolutionDownBy",!1),ge(this,"_videoVisibleTimer",null),ge(this,"_previousVideoVisibleStatus",void 0),ge(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ge(this,"_encoderConfig",void 0),ge(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ge(this,"_optimizationMode",void 0),ge(this,"_videoHeight",void 0),ge(this,"_videoWidth",void 0),ge(this,"_forceBitrateLimit",void 0),ge(this,"_enabled",!0),ge(this,"_processorDestination",void 0),ge(this,"_processorContext",void 0),Cs()){const{width:m,height:_}=t.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=s,this._optimizationMode=a,this._hints=f||[],this._hints.indexOf(kn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(Fw(ln.CHROME,115)&&tR().indexOf("Windows")!==-1){const m=function(_,S){if("VideoFrame"in window&&"TransformStream"in window&&on().supportWebRTCInsertableStream){const b=new MediaStreamTrackProcessor(_),A=new MediaStreamTrackGenerator({kind:"video"});let O,D,G=Date.now();const B=()=>{j&&(clearInterval(j),j=void 0),O&&(O.close(),O=void 0),_.stop(),D=void 0,A.removeEventListener("ended",B)};let j=window.setInterval(()=>{if(D&&O&&Date.now()-G>1e3)try{A.readyState==="live"?D.enqueue(O.clone()):B()}catch{B()}},1e3);const Y=new TransformStream({transform:(q,ie)=>{A.readyState==="live"?(D=ie,G=Date.now(),O===void 0?(O=q,ie.enqueue(q.clone())):(ie.enqueue(O),O=q)):q.close()}});return A.addEventListener("ended",B),b.readable.pipeThrough(Y).pipeTo(A.writable),A}}(t);m&&(k.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}n&&this._hints.indexOf(kn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new c2(this.getTrackId(),"local"),this._processorDestination=new o2(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const a=document.getElementById(t);a?t=a:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const s=Jn(Jn(Jn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(s):(t instanceof HTMLVideoElement?this._player=new TO(s):this._player=new tU(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(KE.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},Z("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await xn(this,dt.NEED_DISABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}return n||(this._enabled=!1),void k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await xn(this,dt.NEED_ENABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await xn(this,dt.NEED_MUTE_TRACK,this):await xn(this,dt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,n){if(!this._enabled)throw new ve($.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=$l(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const s=ER({encoderConfig:t});(Cs()||_r()||Xo())&&(s.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(a){const l=new ve($.UNEXPECTED_ERROR,a.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}}this._encoderConfig=t,this._hints.indexOf(kn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await xn(this,dt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(k)}}getStats(){return Uh(()=>{k.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),La(this,dt.GET_STATS)||Jn({},fO)}async setBeautyEffect(t){k.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await yO(t)}async setBitrateLimit(t){k.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void k.error($.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await xn(this,dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(s){throw this._optimizationMode=n,k.error("[".concat(this.getTrackId(),"] set optimization mode failed"),s.toString()),s}k.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return k.error($.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,k.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){u2(this._originMediaStreamTrack).then(t=>{let[n,s]=t;this._videoHeight=s,this._videoWidth=n}).catch(aR)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new ve($.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");k.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=$l(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(kn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await xn(this,dt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(k)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:s}=this.getMediaStreamTrackSettings();if(!t||!n||!s)return;const{bitrateMax:a,bitrateMin:l}=this._encoderConfig;if(l==null||a==null){const{max:f,min:m}=function(_,S,b,A,O){const D=Z("BITRATE_ADAPTER_TYPE");if(D==="DEFAULT_BITRATE")return{min:A,max:O};if(O===void 0){var G;const j=Math.floor(200*Math.pow(b/15,.6)*Math.pow(_*S/640/360,.75));O=D==="STANDARD_BITRATE"?4*j:2*j,A=(G=A)!==null&&G!==void 0?G:j}else{var B;A=(B=A)!==null&&B!==void 0?B:Math.floor(O/10)}return{min:A,max:O}}(t,n,s,l,a);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=f,k.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(s,"] => [brMax: ").concat(f,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var t,n;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:l,slot:f}=a;if(this.isPlaying&&l instanceof HTMLVideoElement&&f instanceof HTMLElement){const m=hM.checkOneElementVisible(l),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const S=gt.reportApiInvoke(null,{tag:li.TRACER,name:Fi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?S.onSuccess("Video is visible"):S.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(s){throw new ve($.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new ve($.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;t&&(s=Jn(Jn({},s),$l(t))),s=Qp(s);const a=Pn(8,"track-video-cloned-"),l=new zG(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,Qp(this._scalabilityMode),this._optimizationMode,a,Qp(this._hints));return t&&s&&l.setEncoderConfiguration(s),k.debug("clone video track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(n)),l}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new ve($.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new ve($.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Uh(()=>{gt.reportApiInvoke(null,{name:Fi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:li.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!Z("ENABLE_VIDEO_SEI")||!Z("ENABLE_ENCODED_TRANSFORM"))return void k.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new ve($.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void k.warning("Video track is not published, SEI can not be send");const s=n.sender.getParameters();if(s.codecs.length===0)return;const a=s.codecs[0].mimeType.toLocaleLowerCase();a==="video/h264"?this.safeEmit("sei-to-send",t):k.warning("SEI is not supported by ".concat(a))}bindProcessorDestinationEvents(){this.processorDestination.on(Sr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await xn(this,dt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await xn(this,dt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Sr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ma.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ma.REQUEST_CONSTRAINTS)}},rn(Zt.prototype,"play",[nU,iU],Object.getOwnPropertyDescriptor(Zt.prototype,"play"),Zt.prototype),rn(Zt.prototype,"stop",[sU],Object.getOwnPropertyDescriptor(Zt.prototype,"stop"),Zt.prototype),rn(Zt.prototype,"setEnabled",[rU,aU,oU],Object.getOwnPropertyDescriptor(Zt.prototype,"setEnabled"),Zt.prototype),rn(Zt.prototype,"setMuted",[cU,lU,dU],Object.getOwnPropertyDescriptor(Zt.prototype,"setMuted"),Zt.prototype),rn(Zt.prototype,"setEncoderConfiguration",[uU,hU],Object.getOwnPropertyDescriptor(Zt.prototype,"setEncoderConfiguration"),Zt.prototype),rn(Zt.prototype,"getStats",[fU],Object.getOwnPropertyDescriptor(Zt.prototype,"getStats"),Zt.prototype),rn(Zt.prototype,"setBeautyEffect",[pU,mU],Object.getOwnPropertyDescriptor(Zt.prototype,"setBeautyEffect"),Zt.prototype),rn(Zt.prototype,"getCurrentFrameData",[gU],Object.getOwnPropertyDescriptor(Zt.prototype,"getCurrentFrameData"),Zt.prototype),rn(Zt.prototype,"getCurrentFrameImage",[EU],Object.getOwnPropertyDescriptor(Zt.prototype,"getCurrentFrameImage"),Zt.prototype),rn(Zt.prototype,"setBitrateLimit",[_U],Object.getOwnPropertyDescriptor(Zt.prototype,"setBitrateLimit"),Zt.prototype),rn(Zt.prototype,"setOptimizationMode",[SU],Object.getOwnPropertyDescriptor(Zt.prototype,"setOptimizationMode"),Zt.prototype),rn(Zt.prototype,"setScalabiltyMode",[yU],Object.getOwnPropertyDescriptor(Zt.prototype,"setScalabiltyMode"),Zt.prototype),rn(Zt.prototype,"updateMediaStreamTrackResolution",[TU],Object.getOwnPropertyDescriptor(Zt.prototype,"updateMediaStreamTrackResolution"),Zt.prototype),rn(Zt.prototype,"pipe",[vU],Object.getOwnPropertyDescriptor(Zt.prototype,"pipe"),Zt.prototype),rn(Zt.prototype,"unpipe",[bU],Object.getOwnPropertyDescriptor(Zt.prototype,"unpipe"),Zt.prototype),rn(Zt.prototype,"close",[RU],Object.getOwnPropertyDescriptor(Zt.prototype,"close"),Zt.prototype),rn(Zt.prototype,"replaceTrack",[AU],Object.getOwnPropertyDescriptor(Zt.prototype,"replaceTrack"),Zt.prototype),Zt),vO=(CU=Ct({argsMap:(e,t)=>[e.getTrackId(),t]}),IU=bi(),wU=FE("CameraVideoTrack","_enabledMutex"),OU=Ct({argsMap:(e,t)=>[e.getTrackId(),t]}),DU=bi(),NU=Ct({argsMap:(e,t)=>[e.getTrackId(),t]}),LU=bi(),xU=Ct({argsMap:e=>[e.getTrackId()]}),ja=class XG extends Kn{get __className__(){return"CameraVideoTrack"}constructor(t,n,s,a,l,f){super(t,$l(n.encoderConfig),a,l,f),ge(this,"_config",void 0),ge(this,"_originalConstraints",void 0),ge(this,"_constraints",void 0),ge(this,"_enabled",!0),ge(this,"_deviceName","default"),ge(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(kE()||jw())&&!function(){const m=nn();if(m.os!==Qi.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&cM()&&this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=s,this._constraints=s,this._deviceName=t.label,this._encoderConfig=$l(this._config.encoderConfig),bn.on(_s.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),bn.on(_s.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(k.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await Ba.getDeviceById(t),s={};s.video=Jn({},this._constraints),s.video.deviceId={exact:t},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let a=null;try{a=await Fa(s,this.getTrackId())}catch(l){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),l.toString()),a=await Fa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Ba.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}k.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){k.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:Jn(Jn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let s=null;try{s=await Fa(n,this.getTrackId())}catch(a){throw k.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),a.toString()),s=await Fa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Jn({},n.video),k.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const s=await Fa({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1)}await xn(this,dt.NEED_ENABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled true error"),s.toString()),s}this.updateMediaStreamTrackResolution(),k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await xn(this,dt.NEED_DISABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new ve($.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=$l(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const s=di(this._config);s.encoderConfig=t;const a=ER(s);(Cs()||_r()||Xo())&&(a.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(l){const f=new ve($.UNEXPECTED_ERROR,l.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),f.toString()),f}this._config=s,this._constraints=a,this._originalConstraints=a,this._encoderConfig=t,this._hints.indexOf(kn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await xn(this,dt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw(k)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((_r()||Xo())&&this._enabled&&!this._isClosed&&bn.duringInterruption){const t=async()=>{bn.off(_s.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};bn.on(_s.IOS_INTERRUPTION_END,t)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(KE.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,s=Ba.searchDeviceIdByName(this._deviceName);if(s&&!n.deviceId&&(n.deviceId={exact:s}),this._enabled){const a=await Fa({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),bn.off(_s.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),bn.off(_s.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;t&&(s=Jn(Jn({},s),$l(t))),s=Qp(s);const a=Pn(8,"track-cam-cloned-"),l=new XG(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Qp(Jn(Jn({},this._config),{},{encoderConfig:s})),Qp(this._constraints),Qp(this._scalabilityMode),this._optimizationMode,a);return t&&s&&l.setEncoderConfiguration(s),k.debug("clone track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(n)),l}bindProcessorContextEvents(){this.processorContext.on(Ma.REQUEST_UPDATE_CONSTRAINTS,async(t,n,s)=>{try{const a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),n()}catch(a){s(a)}}),this.processorContext.on(Ma.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},rn(ja.prototype,"setDevice",[CU,IU],Object.getOwnPropertyDescriptor(ja.prototype,"setDevice"),ja.prototype),rn(ja.prototype,"setEnabled",[wU,OU,DU],Object.getOwnPropertyDescriptor(ja.prototype,"setEnabled"),ja.prototype),rn(ja.prototype,"setEncoderConfiguration",[NU,LU],Object.getOwnPropertyDescriptor(ja.prototype,"setEncoderConfiguration"),ja.prototype),rn(ja.prototype,"close",[xU],Object.getOwnPropertyDescriptor(ja.prototype,"close"),ja.prototype),ja);function bO(e,t,n,s){n.optimizationMode&&(s&&s.width&&s.height?(n.encoderConfig=Jn(Jn({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?k.debug("[".concat(e,"] set content hint to"),n.optimizationMode):k.debug("[".concat(e,"] set content hint failed")))):k.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var PU,kU,MU,UU,co,FU,BU,VU,jU,GU,HU,sr;class KU extends XM{getUserId(){return this._userId}constructor(t,n,s,a){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(a.clientId,"_").concat(Pn(5,""))),ge(this,"_userId",void 0),ge(this,"_uintId",void 0),ge(this,"_isDestroyed",!1),ge(this,"store",void 0),ge(this,"processor",void 0),ge(this,"processorContext",void 0),this._userId=n,this._uintId=s,this.store=a}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,k.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let XE=(PU=Ct({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),kU=Ct({argsMap:e=>[e.getTrackId()]}),MU=Ct({argsMap:(e,t)=>[e.getTrackId(),t.name]}),UU=Ct({argsMap:e=>[e.getTrackId()]}),rn((co=class extends KU{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ir.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,s){super(e,t,n,s),ge(this,"_videoVisibleTimer",null),ge(this,"_previousVideoVisibleStatus",void 0),ge(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ge(this,"trackMediaType",YE.VIDEO),ge(this,"_videoWidth",void 0),ge(this,"_videoHeight",void 0),ge(this,"_player",void 0),ge(this,"processorDestination",void 0),ge(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new c2(this.getTrackId(),"remote"),this.processorDestination=new o2(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Uh(()=>{k.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),La(this,dt.GET_STATS)||Jn({},$M)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const s=document.getElementById(e);s?e=s:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Jn(Jn({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new TO(n):this._player=new tU(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(WE.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=s=>{this.safeEmit(WE.VIDEO_STATE_CHANGED,s)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(WE.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},Z("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){u2(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(aR)}_updatePlayerSource(){k.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),s={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:a,slot:l}=s;if(this.isPlaying&&a instanceof HTMLVideoElement&&l instanceof HTMLElement){const f=hM.checkOneElementVisible(a),m=Object.assign({},f);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=gt.reportApiInvoke(null,{tag:li.TRACER,name:Fi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(n){throw new ve($.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new ve($.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Sr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Sr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(nm.SEI_RECEIVED,e)}}).prototype,"play",[PU],Object.getOwnPropertyDescriptor(co.prototype,"play"),co.prototype),rn(co.prototype,"stop",[kU],Object.getOwnPropertyDescriptor(co.prototype,"stop"),co.prototype),rn(co.prototype,"pipe",[MU],Object.getOwnPropertyDescriptor(co.prototype,"pipe"),co.prototype),rn(co.prototype,"unpipe",[UU],Object.getOwnPropertyDescriptor(co.prototype,"unpipe"),co.prototype),co),JE=(FU=Ct({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),BU=Ct({argsMap:(e,t)=>[e.getTrackId(),t]}),VU=Ct({argsMap:e=>[e.getTrackId()]}),jU=Ct({argsMap:e=>[e.getTrackId()]}),GU=Ct({argsMap:(e,t)=>[e.getTrackId(),t.name]}),HU=Ct({argsMap:e=>[e.getTrackId()]}),rn((sr=class extends KU{get isPlaying(){return this._useAudioElement?xr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,s){super(e,t,n,s),ge(this,"trackMediaType",YE.AUDIO),ge(this,"_source",void 0),ge(this,"_useAudioElement",!0),ge(this,"_volume",100),ge(this,"processorContext",void 0),ge(this,"processorDestination",void 0),ge(this,"_played",!1),ge(this,"_bypassWebAudio",!1),Z("DISABLE_WEBAUDIO")?(this._source=new SO,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new e2(e,!0),Z("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ka.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(WE.FIRST_FRAME_DECODED)}),this.processorContext=new d2(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new l2(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ka.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ka.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ka.ON_AUDIO_BUFFER),this._source.on(ka.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?xr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!KM())throw new ve($.NOT_SUPPORTED,"your browser does not support setting the audio output device");await xr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Uh(()=>{k.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),La(this,dt.GET_STATS)||Jn({},qM)}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] use audio element to play")),xr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?xr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&xr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new ve($.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new ve($.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new ve($.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Sr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Sr.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Sr.ON_TRACK),this.processorDestination.removeAllListeners(Sr.ON_NODE)}}).prototype,"setVolume",[FU],Object.getOwnPropertyDescriptor(sr.prototype,"setVolume"),sr.prototype),rn(sr.prototype,"setPlaybackDevice",[BU],Object.getOwnPropertyDescriptor(sr.prototype,"setPlaybackDevice"),sr.prototype),rn(sr.prototype,"play",[VU],Object.getOwnPropertyDescriptor(sr.prototype,"play"),sr.prototype),rn(sr.prototype,"stop",[jU],Object.getOwnPropertyDescriptor(sr.prototype,"stop"),sr.prototype),rn(sr.prototype,"pipe",[GU],Object.getOwnPropertyDescriptor(sr.prototype,"pipe"),sr.prototype),rn(sr.prototype,"unpipe",[HU],Object.getOwnPropertyDescriptor(sr.prototype,"unpipe"),sr.prototype),sr);const ou=new class extends ii{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ge(this,"_lastHiddenTime",0),ge(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),k.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class WU extends ii{constructor(t,n){super(),ge(this,"trackMediaType",YE.DATA),ge(this,"_version",1),ge(this,"_type",3),ge(this,"_config",void 0),ge(this,"_originDataChannel",void 0),ge(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ge(this,"_dataStreamPacketHandler",{serialize:s=>s,deserialize:s=>s}),ge(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return Z("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Ye((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const s=setTimeout(()=>{var a;n(new ve($.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((a=this._originDataChannel)===null||a===void 0?void 0:a.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(s),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(s),new ve($.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new ve($.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[mR.OPEN,mR.CLOSE,mR.ERROR].forEach(n=>{const s=()=>{this.emit(n)};this._datachannelEventMap.set(n,s),t.addEventListener(n,s)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[s,a]=n;t.removeEventListener(s,a)}),this._datachannelEventMap.clear()}}class Bq extends WU{constructor(t){super(t),ge(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const s=n.data.slice(0,this._dataStreamPacketHeader.byteLength),a=new DataView(s).getUint8(3);if(a!==this.id)return void(Z("SHOW_DATASTREAM2_LOG")&&k.debug("invalid datachannel id: ".concat(a," !== ").concat(this.id)));let l=n.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(mR.MESSAGE,l)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Vq extends WU{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const s=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}function SR(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>Sb.revokeObjectURL(e),0),new Worker(Sb.createObjectURL(e))}const YU=71,RO=1,AO=2,CO=1,qU=2;var cu=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(cu||{});function $U(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==YU)return;const s=e.getUint16(1),a=RO+AO+s,l=new Uint8Array(e.byteLength-a);l.set(new Uint8Array(e.buffer,a,e.byteLength-a));const f={m:n,tlvLen:s,tlv:[],frame:l};let m=RO+AO;for(;m<a;){const _=e.getUint8(m),S=e.getUint16(m+CO),b=CO+qU;if(_===cu.AUDIO_LEVEL){let A=e.getUint8(m+b);for(let O=1;O<S;O++)A=A<<8|e.getUint8(m+b+O);f.tlv.push({tag:_,length:S,value:t?127^A>>1:127&A})}else if(_===cu.METADATA||_===cu.AUDIO_64_BIT_PTS){const A=new Uint8Array(S);for(let O=0;O<S;O++)A[O]=e.getUint8(m+b+O);f.tlv.push({tag:_,length:S,value:A})}m+=b+S}return f}const yR=new Map,TR=127,rm=1e-10,IO=139/13,vR=new Map;function wO(e,t,n){const s="".concat(e,"-").concat(t,"-").concat(n);let a=0;return vR.has(s)?a=vR.get(s):(a=Math.log(function(f,m){const _=f-m;m<_&&(m=_);let S=1;for(let b=f,A=1;b>m;b--,A++)S=S*b/A;return S}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,vR.set(s,a)),a<rm&&(a=rm),a}function zU(e,t,n){const s=t.length,a=e.length/s;let l=!1;for(let f=0,m=0;f<s;f++){let _=0;for(let S=m+a;m<S;m++)e[m]>n&&_++;t[f]!==_&&(t[f]=_,l=!0)}return l}window.cache=vR;let jq=0;class XU{constructor(t){ge(this,"id",void 0),ge(this,"immediates",[]),ge(this,"lastNonSilence",-1),ge(this,"immediateSpeechActivityScore",rm),ge(this,"lastLevelChangedTime",Date.now()),ge(this,"levels",[]),ge(this,"longs",[]),ge(this,"longSpeechActivityScore",rm),ge(this,"mediums",[]),ge(this,"mediumSpeechActivityScore",rm),ge(this,"minLevel",0),ge(this,"nextMinLevel",0),ge(this,"nextMinLevelWindowLength",0),ge(this,"energyScore",0),this.id=t||"".concat(jq++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,s=this.minLevel+IO;let a=!1;for(let l=0;l<t.length;++l){let f=n[l];f<s&&(f=0);const m=Math.floor(f/IO);t[l]!==m&&(t[l]=m,a=!0)}return a}computeLongs(){return zU(this.mediums,this.longs,4)}computeMediums(){return zU(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=wO(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=wO(this.longs[0],10,47),this.longSpeechActivityScore>rm&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=wO(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(ih(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let s=t;return t<0&&(s=0),t>TR&&(s=TR),this.levels.unshift(s),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(s),s>=this.minLevel+IO?s:s/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>TR&&(n=TR),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Gq{constructor(t){ge(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class OO{constructor(t,n,s){ge(this,"isDominant",void 0),ge(this,"energyRanking",void 0),ge(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=s}}class Hq extends ii{constructor(t){super(),ge(this,"dominantId",null),ge(this,"lastDecisionTime",0),ge(this,"lastLevelChangedTime",0),ge(this,"lastLevelIdleTime",0),ge(this,"relativeSpeechActivities",[]),ge(this,"speakers",new Map),ge(this,"enableSilence",!1),ge(this,"timeoutToSilenceInterval",0),ge(this,"decisionMaker",null),ge(this,"loudest",[]),ge(this,"numLoudestToTrack",3),ge(this,"energyExpireTimeMs",250),ge(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),s!=null&&(this.energyAlphaPct=s),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const s=Date.now(),a=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<s&&(this.lastLevelChangedTime=s,this.maybeStartDecisionMaker());const l=a.levelChanged(n,s);return this.updateLoudestList(a,l,s)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new XU(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,s){const a=t.id===this.dominantId;if(n<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==t;)++_;return new OO(a,_,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new OO(a,0,t.energyScore);const l=s-this.energyExpireTimeMs;let f=0;for(;f<this.loudest.length;){const _=this.loudest[f];if(_.getLastLevelChangedTime()<l&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(f,1);else if(_.id!==t.id)++f;else if(this.loudest.splice(f,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<t.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new OO(a,m,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Gq(this),this.decisionMaker.execute())}makeDecision(t){let n=null,s=null;const a=this.speakers.size;let l=null;if(a===0)l=null;else if(a===1){var f;const m=ps(f=this.speakers).call(f).next().value;this.enableSilence&&m&&(l=m.id,m.evaluateSpeechActivityScores(t),t-m.lastNonSilence>this.timeoutToSilenceInterval&&(l=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const b=this.speakers.entries().next();b.value&&(l=b.value[0],m=b.value[1])}else l=m.id;m!=null&&m.evaluateSpeechActivityScores(t);const _=this.relativeSpeechActivities;let S=2;for(const b of this.speakers.entries()){const[A,O]=b;if(O===m)continue;O.evaluateSpeechActivityScores(t);for(let j=0;j<_.length;++j){const Y=m==null?rm:m.getSpeechActivityScore(j);_[j]=Math.log(O.getSpeechActivityScore(j)/Y)}const D=_[0],G=_[1],B=_[2];D>3&&G>2&&B>0&&G>S&&(S=G,l=A)}this.enableSilence&&m!=null&&l===m.id&&t-m.lastNonSilence>this.timeoutToSilenceInterval&&(l=null)}l==null&&!this.enableSilence||l===this.dominantId||(n=this.dominantId,this.dominantId=l,s=this.dominantId),s==null&&!this.enableSilence||s===n||this.emit("ActiveSpeakerChanged",s)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let s=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):s=n;let a=300-(t-this.lastDecisionTime);return a<=0&&(this.lastDecisionTime=t,this.makeDecision(t),a=300-(Date.now()-t)),a>0&&s>a&&(s=a),s}timeoutIdleLevels(t){const n=[];for(const a of ps(s=this.speakers).call(s)){var s;const l=t-a.getLastLevelChangedTime();36e5<l&&(this.dominantId==null||a.id!==this.dominantId)?n.push(a.id):300<l&&a.levelTimedOut()}n.forEach(a=>this.speakers.delete(a))}}const QE=new Map;let Xc=null,bR=null;const JU=3;let am=[];const Jc=new Map,RR=new Map;class Kq{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){ge(this,"id",void 0),ge(this,"track",void 0),ge(this,"score",0),ge(this,"active",!0),ge(this,"muted",!1),ge(this,"timer",0),ge(this,"actives",0),ge(this,"inactives",0),this.id=t,this.track=n,this.setActive(Jc.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:s}=function(){const a=[],l=[];return Array.from(ps(Jc).call(Jc)).forEach(f=>{f.active?a.push(f):l.push(f)}),{actives:a,inactives:l}}();if(n.length>3){let a;n.forEach(l=>{(!a||a.score>l.score)&&(a=l)}),a&&a.setActive(!1)}if(n.length<3&&s.length>0){let a;s.forEach(l=>{(!a||a.score<l.score)&&l.id!==this.id&&(a=l)}),a&&t&&!this.active&&(a.samples>40&&a.activeRate-this.activeRate>.4?a.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let s;return Array.from(ps(Jc).call(Jc)).forEach(a=>{!a.active||a.id===n||a.samples<40||(!s||a.score<s.score)&&(s=a)}),s}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let s;return Array.from(ps(Jc).call(Jc)).forEach(a=>{a.active||a.id===n||a.samples<40||(!s||a.score>s.score)&&(s=a)}),s}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let AR;function QU(e){const t=Jc.get(e);t&&(Jc.delete(e),t.clearTimer())}const CR=new Map,Wq=new Map;function Yq(e,t,n){let s=new Uint8Array(e,t,n),a=[],l=0;for(;a.length<n;)l+3<n&&s[l]===0&&s[l+1]===0&&s[l+2]===3&&(s[l+3]===0||s[l+3]===1||s[l+3]===2||s[l+3]===3)?(a.push(s[l],s[l+1],s[l+3]),l+=4):(a.push(s[l]),l++);return new Uint8Array(a)}const IR=new Map,hy=new Map;(function(){const e=nn();Es.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Es.getStreamFromExtension=e.name===ln.CHROME&&Number(e.version)>34,Es.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Es.supportMinBitrate=e.name===ln.CHROME||e.name===ln.EDGE,Es.supportSetRtpSenderParameters=function(){const t=nn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!su()||!(!Cs()&&!nR())||t.name===ln.FIREFOX&&Number(t.version)>=64)}(),e.name===ln.SAFARI&&(Number(e.version)>=14?Es.supportDualStream=!0:Es.supportDualStream=!1),Es.webAudioMediaStreamDest=function(){const t=nn();return!(t.name===ln.SAFARI&&Number(t.version)<12)}(),Es.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Es.supportWebGL=typeof WebGLRenderingContext<"u",Es.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,su()||(Es.webAudioWithAEC=!0),Es.supportShareAudio=function(){const t=nn();return(t.os===Qi.WIN_10||t.os===Qi.WIN_81||t.os===Qi.WIN_7||t.os===Qi.LINUX||t.os===Qi.MAC_OS||t.os===Qi.CHROMIUM_OS)&&t.name===ln.CHROME&&Number(t.version)>=74}(),Es.supportDataChannel=!!(ty(76)||function(t){const n=nn();return!(n.name!==ln.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||iM(14)),Es.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!oi()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Es.supportWebRTCEncodedTransform=function(){const t=nn();return t.name==="Chrome"&&Number(t.version)>=87||t.name==="Safari"&&Number(t.version)>=15}(),Es.supportWebRTCInsertableStream=function(){const t=nn();return(t.name===ln.CHROME||t.name===ln.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Es.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Es.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,rR(()=>{Es.supportDualStreamEncoding=function(){const t=nn();return!!Z("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&Z("CHROME_DUAL_STREAM_USE_ENCODING"))}(),k.debug("browser ua: ",navigator.userAgent),k.info("browser info: ",e),k.info("browser compatibility: ",Es)})})();const qq=["CHINA","GLOBAL"],ZU=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],om=[],ZE=[];function cm(e,t){return!!t&&om.some(n=>n.uid===e&&n.channelName===t)}function DO(){return ZE.length>0}var $q=Tk.forEach,eF=Xa("forEach")?[].forEach:function(e){return $q(this,e,arguments.length>1?arguments[1]:void 0)};fn({target:"Array",proto:!0,forced:[].forEach!=eF},{forEach:eF});var zq=Bs("Array").forEach,Xq=aa,Jq=Yi,Qq=L,Zq=zq,NO=Array.prototype,e$={DOMTokenList:!0,NodeList:!0},t$=function(e){var t=e.forEach;return e===NO||Qq(NO,e)&&t===NO.forEach||Jq(e$,Xq(e))?Zq:t},n$=d(t$),i$=Ns,tF=rs;fn({target:"Object",stat:!0,forced:p(function(){tF(1)})},{keys:function(e){return tF(i$(e))}});var nF=d(Ot.Object.keys),s$=d(xo),r$=d(zf),a$=fn,iF=Ra,o$=eo,c$=yt,sF=Nd,l$=va,d$=Wn,u$=SE,h$=ti,f$=vp,p$=uk("slice"),m$=h$("species"),LO=Array,g$=Math.max;a$({target:"Array",proto:!0,forced:!p$},{slice:function(e,t){var n,s,a,l=d$(this),f=l$(l),m=sF(e,f),_=sF(t===void 0?f:t,f);if(iF(l)&&(n=l.constructor,(o$(n)&&(n===LO||iF(n.prototype))||c$(n)&&(n=n[m$])===null)&&(n=void 0),n===LO||n===void 0))return f$(l,m,_);for(s=new(n===void 0?LO:n)(g$(_-m,0)),a=0;m<_;m++,a++)m in l&&u$(s,a,l[m]);return s.length=a,s}});var E$=Bs("Array").slice,_$=L,S$=E$,xO=Array.prototype,y$=function(e){var t=e.slice;return e===xO||_$(xO,e)&&t===xO.slice?S$:t},T$=d(y$);function ft(e,t,n,s,a){var l,f,m,_={};return n$(l=nF(s)).call(l,function(S){_[S]=s[S]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=s$(f=r$(m=T$(n).call(n)).call(m)).call(f,function(S,b){return b(e,t,S)||S},_),a&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(a):void 0,_.initializer=void 0),_.initializer===void 0&&(ok(e,t,_),_=null),_}let wR=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),PO=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Zo=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),yr=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Rt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Fn=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Nt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Dt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),fy=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),qt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Tr=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),kt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function OR(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw k.error("Invalid Channel Name ".concat(e)),new Ee($.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function DR(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||uM(e,1,255)))throw new Ee($.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&k.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let lu=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const v$={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},kO={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function MO(e,t){ms(e.url,"".concat(t,".url"),1,1e3,!1),ci(e.x)||An(e.x,"".concat(t,".x"),0,1e4),ci(e.y)||An(e.y,"".concat(t,".y"),0,1e4),ci(e.width)||An(e.width,"".concat(t,".width"),0,1e4),ci(e.height)||An(e.height,"".concat(t,".height"),0,1e4),ci(e.zOrder)||An(e.zOrder,"".concat(t,".zOrder"),0,255),ci(e.alpha)||An(e.alpha,"".concat(t,".alpha"),0,1,!1)}const b$={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Vh=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),UO=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Ki=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function rF(e){if(!e.channelName)throw new Ee($.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Ee($.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&ms(e.token,"info.token",1,2047),DR(e.uid),OR(e.channelName),!0}let vr=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),du=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),qr=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),e_=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),En=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),os=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),NR=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),es=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),dn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const aF=[dn.AFRICA,dn.ASIA,dn.CHINA,dn.EUROPE,dn.GLOBAL,dn.INDIA,dn.JAPAN,dn.NORTH_AMERICA,dn.OCEANIA,dn.OVERSEA,dn.SOUTH_AMERICA];let ks=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const LR={CHINA:{},ASIA:{CODE:ks.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ks.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ks.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ks.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ks.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ks.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ks.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ks.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ks.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ks.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ks.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ks.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ks.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};sO&&(LR.CHINA={CODE:ks.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let py=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function oF(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class cF extends ii{constructor(t,n){super(),W(this,"onICEConnectionStateChange",void 0),W(this,"onConnectionStateChange",void 0),W(this,"onDTLSTransportStateChange",void 0),W(this,"onDTLSTransportError",void 0),W(this,"onICETransportStateChange",void 0),W(this,"onFirstAudioReceived",void 0),W(this,"onFirstVideoReceived",void 0),W(this,"onFirstAudioDecoded",void 0),W(this,"onFirstVideoDecoded",void 0),W(this,"onFirstVideoDecodedTimeout",void 0),W(this,"onSelectedLocalCandidateChanged",void 0),W(this,"onSelectedRemoteCandidateChanged",void 0),W(this,"onICECandidateError",void 0),W(this,"getLocalVideoStats",void 0)}}class lF extends cF{constructor(t,n){super(t,n),W(this,"establishPromise",void 0)}}let at=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Ms=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),uu=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const dF=["disconnected","failed"];let Le=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),mn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),vt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),ec=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),tc=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),cs=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),uF=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Jl=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),lo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Qc=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),t_=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Ri=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),n_=function(e){return e.ABORT="abort",e}({}),jh=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),R$=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const A$={[wR.ACCESS_POINT]:{[yr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[yr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[yr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[yr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[yr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[yr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[yr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[wR.UNILBS]:{[Zo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Zo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Zo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Zo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Zo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Zo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Zo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Zo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Zo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Zo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Zo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Zo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[wR.STRING_UID_ALLOCATOR]:{[PO.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[PO.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[PO.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function i_(e){const t=A$[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===wR.ACCESS_POINT){const s=e%1e4;if(s.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(s.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const C$={[Rt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Rt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Rt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Rt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Rt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Rt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Rt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Rt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Rt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Rt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Rt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Rt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Rt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Rt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Rt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Rt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Rt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Rt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Rt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Rt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Rt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Rt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Rt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Rt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Rt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Rt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Rt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Rt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Rt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Rt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Rt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Rt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Rt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Rt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Rt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Rt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Rt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Rt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Rt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Rt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Rt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Rt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Rt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Rt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Rt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Rt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Rt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Rt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Rt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Rt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Rt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Rt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Rt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Rt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Rt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Rt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Rt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Rt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Rt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Rt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Rt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Rt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Rt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function my(e){return C$[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function hF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function FO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hF(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hF(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function fF(e,t){if(typeof e=="string")return e;const{proxy:n,host:s,port:a}=e;if(t){const l=Z("JOIN_GATEWAY_FALLBACK_PORT")||443;return l===443?"wss://".concat(s,"/ws/?p=").concat(Number(a)+150):"wss://".concat(s,":").concat(l,"/ws/?p=").concat(Number(a)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(s,"&p=").concat(a):"wss://".concat(s,":").concat(a)}const I$=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,w$=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,O$=/wss:\/\/(.+):([0-9]+)\/?/,D$=/wss:\/\/(.[^\/]+)\/?/;let N$=0;class L${constructor(t,n){W(this,"id",0),W(this,"store",void 0),W(this,"recordIndex",void 0),W(this,"websockets",[]),W(this,"try443PortDuration",2e3),W(this,"forceCloseWSDuration",5e3),W(this,"try443PortTimeout",null),W(this,"forceCloseTimeout",null),W(this,"isTry443PortFailed",!1),W(this,"isNormalPortFailed",!1),W(this,"useDoubleDomain",!1),W(this,"useProxy",!1),W(this,"startTime",Date.now()),this.id=++N$,this.try443PortDuration=Z("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var s=arguments.length,a=new Array(s),l=0;l<s;l++)a[l]=arguments[l];k.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...a)}createWebSocket(t,n,s){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:s});const a=Z("GATEWAY_DOMAINS"),l=Date.now(),f=[],m=a.find(O=>{var D;return We(D=t.host).call(D,O)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)a.forEach(O=>{_.push(fF(FO(FO({},t),{},{host:t.host.replace(m,O)}),n))});else{const O=FO({},t);if(n&&m){const D=a.find(G=>G!==m);D&&(O.host=O.host.replace(m,D))}_.push(fF(O,n))}try{_.forEach(O=>{const D=new WebSocket(O);D.binaryType="arraybuffer",f.push(D),this.logger("ws is connecting:",D.url)})}catch(O){if(this.logger("ws create failed"),f.forEach(D=>D.close()),f.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,s);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,s);throw new Ee($.WS_ERR,"init websocket failed! Error: ".concat(O.toString()))}const S=ey();this.store&&this.store.recordJoinChannelService({urls:f.map(O=>O.url),service:"gateway"},this.recordIndex),f.forEach(O=>{O.onopen=()=>{this.logger("onopen: ws ".concat(O.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(D=>{D!==O&&(D.onopen=null,D.onclose=null,D.onmessage=null,D.close(),this.logger("close backup websocket: ".concat(D.url)))}),this.websockets.length=0,S.resolve(O)},O.onclose=D=>{this.logger("onclose: ws ".concat(O.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(O.readyState));const G=f.every(B=>B.readyState===WebSocket.CLOSED||B.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(D.reason)),S.reject({code:D.code,reason:NR.A_ROUND_WS_FAILED})):!n&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),A()),n?this.isTry443PortFailed=G:this.isNormalPortFailed=G},O.onmessage=D=>this.logger("".concat(O.url," onmessage: ").concat(D.data))}),this.websockets.push(...f);const b=()=>{this.websockets.forEach(O=>O.readyState!==WebSocket.OPEN&&O.close())},A=()=>{if(S.isResolved)return b();nn().os===Qi.MAC_OS&&oi()&&b(),this.createWebSocket(t,!0,!0).then(O=>{S.resolve(O)}).catch(O=>{this.isNormalPortFailed&&S.reject(O),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",S.isResolved),this.forceCloseTimeout=null,b()},this.forceCloseWSDuration)};return s||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,b()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",S.isResolved),this.try443PortTimeout=null,A()},this.try443PortDuration)})(),S.promise}chooseBestWebsocket(t,n,s,a){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(l){let f,m,_;return[,f,m,_]=l.match(I$)||[],f||([,m,_]=l.match(w$)||[]),m&&_||([,m,_]=l.match(O$)||[]),m&&_||([,m]=l.match(D$)||[]),m||k.warning("un-destructible url: ",l),{proxy:f,host:m,port:_||"443"}}(t)),this.recordIndex=a,this.useProxy=!!t.proxy,s&&this.useProxy&&(k.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(t,!!s,!1).finally(()=>this.clearTimeout())}}function pF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}class mF extends ii{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;We(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(kt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(kt.CONNECTED):this._state==="closed"?this.emit(kt.CLOSED):this._state==="failed"&&this.emit(kt.FAILED))}resetReconnectCount(t){k.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=arguments.length>3&&arguments[3]!==void 0&&arguments[3],l=arguments.length>4&&arguments[4]!==void 0&&arguments[4],f=arguments.length>5?arguments[5]:void 0;super(),W(this,"connectionID",0),W(this,"currentURLIndex",0),W(this,"urls",[]),W(this,"_reconnectMode","tryNext"),W(this,"reconnectReason",void 0),W(this,"_initMutex",void 0),W(this,"name",void 0),W(this,"_state","closed"),W(this,"reconnectInterrupter",void 0),W(this,"websocket",void 0),W(this,"retryConfig",void 0),W(this,"reconnectCount",0),W(this,"forceCloseTimeout",5e3),W(this,"onlineReconnectListener",void 0),W(this,"useCompress",void 0),W(this,"tryDoubleDomain",!1),W(this,"use443PortOnly",!1),W(this,"wsInflateLength",0),W(this,"wsDeflateLength",0),W(this,"closeEstablishingWs",()=>{}),W(this,"store",void 0),W(this,"joinGatewayRecordIndex",void 0),this.store=f,this.name=t,this.retryConfig=function(A){for(var O=1;O<arguments.length;O++){var D=arguments[O]!=null?arguments[O]:{};O%2?pF(Object(D),!0).forEach(function(G){W(A,G,D[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(D)):pF(Object(D)).forEach(function(G){Object.defineProperty(A,G,Object.getOwnPropertyDescriptor(D,G))})}return A}({},n),this.useCompress=s,this.tryDoubleDomain=a,this.use443PortOnly=l,this._initMutex=new Ps("websocket",f?f.clientId:void 0);const{timeout:m,timeoutFactor:_}=n,S=Math.max(300,Math.floor(3*m/5)),b=Math.max(1.2,Math.floor(8*_)/10);ga.ONLINE&&(this.retryConfig.timeout=S,this.retryConfig.timeoutFactor=b),Di.on(ME.NETWORK_STATE_CHANGE,(A,O)=>{A!==O&&(this.resetReconnectCount("network state change: ".concat(O," -> ").concat(A)),A===ga.ONLINE?(this.retryConfig.timeout=S,this.retryConfig.timeoutFactor=b):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{const a=ey(),l=this.urls[this.currentURLIndex];Z("ENABLE_PREALLOC_PC")&&this.emit(uF.PRE_CONNECT_PC),this.createWebSocketConnection(l).then(a.resolve).catch(a.reject),this.once(kt.CLOSED,()=>{a.reject(new ve($.WS_DISCONNECT))}),this.once(kt.CONNECTED,a.resolve),await a.promise}catch{}finally{s()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;n?setTimeout(()=>s.close(),500):s.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void k.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),k.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ve($.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(s){throw new ve($.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const s=ey();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const a=b=>{var A;(A=this.store)===null||A===void 0||A.signalChannelOpen(),k.debug("[".concat(this.name,"] websocket opened:"),b),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s.resolve()},l=async b=>{var A;if(k.debug("[".concat(this.name,"] websocket close ").concat((A=this.websocket)===null||A===void 0?void 0:A.url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)s.reject(new ve($.WS_DISCONNECT,"websocket close: ".concat(b.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=b.reason,this.state="reconnecting");const O=La(this,kt.WILL_RECONNECT,this.reconnectMode,b.reason)||this.reconnectMode,D=await this.reconnectWithAction(O);if(this.state==="closed")return void k.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!D)return s.reject(new ve($.WS_DISCONNECT,"websocket reconnect failed: ".concat(b.code))),this.close(!0);s.resolve()}},f=b=>{this.emit(kt.ON_MESSAGE,b)},m=b=>{k.warn("[".concat(this.connectionID,"] ws open error ").concat(b))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Z("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=Z("GATEWAY_WSS_ADDRESS")),k.debug("[".concat(this.name,"] start connect, url:"),t);const _=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var S;const b=await this.chooseBestWebsocketConnection(t);this.websocket=b,a&&a(this.websocket.url),this.websocket.onclose=l,this.websocket.onmessage=f,this.websocket.onerror=m,(S=this.store)===null||S===void 0||S.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(b){const A=this.state==="closed",O=b instanceof ve,D=O&&b.code===$.WS_ABORT,G=O&&b.code===$.WS_ERR,B=O?b.message:b&&(b.reason||b.toString());k.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(B)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:D?"aborted":"error",errors:[b]},_),A||G?(s.reject(A?new ve($.WS_DISCONNECT,"websocket is closed: ".concat(B)):new ve($.WS_ERR,"init websocket failed: ".concat(B))),G&&k.error("[".concat(this.name,"] init websocket failed: ").concat(B))):l&&l(b)}return s.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;k.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Di.isOnline||!Di.onlineWaiter||(this.onlineReconnectListener=Di.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let s=!0;if(this.reconnectInterrupter=()=>s=!1,n){const f=Xw(this.reconnectCount,this.retryConfig);k.debug("[".concat(this.name,"] wait ").concat(f,"ms to reconnect websocket, mode: ").concat(t)),await Ye.race([gs(f),this.onlineReconnectListener||new Ye(()=>{})])}if(this._state==="closed"||!s)return!1;this.reconnectCount+=1;const a=async(f,m)=>{this.emit(kt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(f)};try{if(t==="retry")await a(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);k.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await a(this.urls[this.currentURLIndex],t)}else t==="recover"&&(k.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ws(this,kt.REQUEST_NEW_URLS),this.currentURLIndex=0,await a(this.urls[this.currentURLIndex],t))}catch(f){var l;k.error("[".concat(this.name,"] reconnect failed ").concat(f&&f.toString()));const m=f==null||(l=f.data)===null||l===void 0?void 0:l.desc;return Array.isArray(m)&&We(m).call(m,"dynamic key expired")?(this.emit(kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class BO extends mF{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const s=ey(),a=function(f,m){return new L$(f,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),a.closeAllWebsockets(),s.reject(new ve($.WS_ABORT,"choose best websocket aborted"))};const l=Z("GATEWAY_DOMAINS");return k.debug("[choose-best-ws] currentDomain: ",t,", domains: ",l,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),a.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(s.resolve).catch(s.reject),s.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class gy extends mF{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new Ye((s,a)=>{let l=!1;const f=[];this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),f.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),a(new ve($.WS_ABORT,"choose best websocket aborted"))};const m=Z("GATEWAY_DOMAINS");let _;const S=t.indexOf("?h="),b=m.find(G=>S!==-1?We(t).call(t,G,S):We(t).call(t,G));k.debug("[choose-best-ws] currentDomain: ",b,", domains: ",m);let A=!this.tryDoubleDomain||!b;if(!A&&b){var O;const G=Date.now();try{m.forEach(B=>{const j=S===-1?t.replace(b,B):t.substr(0,S)+t.substr(S).replace(b,B),Y=new WebSocket(j);Y.binaryType="arraybuffer",f.push(Y),k.debug("[choose-best-ws] ws is connecting:",Y.url)})}catch{for(k.debug("[choose-best-ws] ws create failed, fallback to single url"),f.forEach(j=>j.close());f.length;)f.pop();A=!0}(O=this.store)===null||O===void 0||O.recordJoinChannelService({urls:f.map(B=>B.url),service:"gateway"},n),f.forEach(B=>{B.onopen=()=>{if(l)return;const j=Date.now()-G;k.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),f.filter(Y=>Y!==B).forEach(Y=>{k.debug("[choose-best-ws]close backup websocket: ".concat(Y.url)),Y.close()}),l=!0,s(B)},B.onclose=j=>{_=j,!l&&(f.find(Y=>!(Y.readyState===WebSocket.CLOSED||Y.readyState===WebSocket.CLOSING))||(k.debug("[choose-best-ws] all websocket is closed"),l=!0,a(_)))},B.onmessage=j=>{k.debug("[choose-best-ws]".concat(B.url," onmessage: ").concat(j.data))}}),gs(this.forceCloseTimeout).then(()=>{f.forEach(B=>{B.readyState!==WebSocket.OPEN&&B.close()})})}if(A){var D;let G;k.debug("[choose-best-ws] use single url: ",t),(D=this.store)===null||D===void 0||D.recordJoinChannelService({urls:[t],service:"gateway"},n);try{G=new WebSocket(t),f.push(G),G.binaryType="arraybuffer"}catch(B){const j=new ve($.WS_ERR,"init websocket failed! Error: ".concat(B.toString()));return k.error("[".concat(this.name,"]").concat(j)),void a(j)}G.onopen=()=>{s(G)},G.onclose=B=>{a(B)},G.onmessage=B=>{k.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(B.data))},gs(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(s=>(this.closeEstablishingWs=void 0,s)).catch(s=>{throw this.closeEstablishingWs=void 0,s})}}class x$ extends ii{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Fn.CONNECTED?this.emit(Nt.WS_CONNECTED):t===Fn.RECONNECTING?this.emit(Nt.WS_RECONNECTING,this._websocketReconnectReason):t===Fn.CLOSED&&this.emit(Nt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),W(this,"_disconnectedReason",void 0),W(this,"_websocketReconnectReason",void 0),W(this,"_connectionState",Fn.CLOSED),W(this,"reconnectToken",void 0),W(this,"websocket",void 0),W(this,"openConnectionTime",void 0),W(this,"clientId",void 0),W(this,"lastMsgTime",Date.now()),W(this,"uploadCache",[]),W(this,"uploadCacheInterval",void 0),W(this,"rttRolling",new IM(5)),W(this,"pingpongTimer",void 0),W(this,"wsInflateDataTimer",void 0),W(this,"pingpongTimeoutCount",0),W(this,"joinResponse",void 0),W(this,"multiIpOption",void 0),W(this,"initError",void 0),W(this,"spec",void 0),W(this,"store",void 0),W(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(Nt.ON_BINARY_DATA,s.data);const a=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const l="res-@".concat(a._id);this.emit(l,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")){if(this.emit(a._type,a._message),a._type===qt.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===qt.ON_USER_BANNED)switch(a._message.error_code){case 14:this.close(pn.UID_BANNED);break;case 15:this.close(pn.IP_BANNED);break;case 16:this.close(pn.CHANNEL_BANNED)}if(a._type===qt.ON_USER_LICENSE_BANNED)switch(a._message.error_code){case Rt.ERR_LICENSE_MISSING:this.close(pn.LICENSE_MISSING);break;case Rt.ERR_LICENSE_EXPIRED:this.close(pn.LICENSE_EXPIRED);break;case Rt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(pn.LICENSE_MINUTES_EXCEEDED);break;case Rt.ERR_LICENSE_PERIOD_INVALID:this.close(pn.LICENSE_PERIOD_INVALID);break;case Rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(pn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Rt.ERR_LICENSE_ILLEGAL:this.close(pn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new BO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Z("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Fn.CONNECTED&&this.reconnect("retry",Is.OFFLINE)})}async request(t,n,s,a){const l=Pn(6,""),f={_id:l,_type:t,_message:n},m=this.websocket.connectionID,_=()=>new Ye((G,B)=>{if(this.connectionState===Fn.CONNECTED)return G();const j=()=>{this.off(Nt.WS_CLOSED,Y),G()},Y=()=>{this.off(Nt.WS_CONNECTED,j),B(new Ee($.WS_ABORT))};this.once(Nt.WS_CONNECTED,j),this.once(Nt.WS_CLOSED,Y),t!==Dt.PUBLISH&&t!==Dt.PUBLISH_DATASTREAM&&t!==Dt.SUBSCRIBE&&t!==Dt.SUBSCRIBE_DATASTREAM&&t!==Dt.UNSUBSCRIBE&&t!==Dt.UNSUBSCRIBE_DATASTREAM&&t!==Dt.UNPUBLISH&&t!==Dt.UNPUBLISH_DATASTREAM&&t!==Dt.CONTROL&&t!==Dt.RESTART_ICE||this.once(Nt.DISCONNECT_P2P,()=>{B(new Ee($.DISCONNECT_P2P))}),t!==Dt.PUBLISH&&t!==Dt.RESTART_ICE||this.once(Nt.ABORT_P2P_EXECUTION,()=>{B(new Ee($.DISCONNECT_P2P))})});if(this.connectionState!==Fn.CONNECTING&&this.connectionState!==Fn.RECONNECTING||t===Dt.JOIN||t===Dt.REJOIN||await _(),this.websocket.sendMessage(f,!0),a)return;const S=new Ye((G,B)=>{let j=!1;const Y=(ie,le)=>{j=!0,G({isSuccess:ie==="success",message:le||{}}),this.off(Nt.WS_CLOSED,q),this.off(Nt.WS_RECONNECTING,q),this.emit(Nt.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),Y);const q=()=>{B(new Ee($.WS_ABORT,"type: ".concat(t))),this.off(Nt.WS_CLOSED,q),this.off(Nt.WS_RECONNECTING,q),this.off("res-@".concat(l),Y)};this.once(Nt.WS_CLOSED,q),this.once(Nt.WS_RECONNECTING,q),gs(Z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Nt.REQUEST_TIMEOUT,t,n))})});let b=null;try{b=await S}catch(G){if(this.connectionState===Fn.CLOSED||t===Dt.LEAVE)throw new Ee($.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?G.throw():t===Dt.JOIN||t===Dt.REJOIN?null:(await _(),await this.request(t,n))}if(b.isSuccess)return b.message;const A=Number(b.message.error_code||b.message.code),O=my(A),D=new Ee($.UNEXPECTED_RESPONSE,"".concat(O.desc,": ").concat(b.message.error_str),{code:A,data:b.message,desc:O.desc});return O.action==="success"?b.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(A,", message: ").concat(O.desc,", action: ").concat(O.action)),A===Rt.ERR_TOO_MANY_BROADCASTERS?((t===Dt.JOIN||t===Dt.REJOIN)&&(this.initError=D,this.close()),D.throw()):O.action==="failed"?D.throw():O.action==="quit"?(this.initError=D,this.close(),D.throw()):(A===Rt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Is.MULTI_IP)):this.reconnect(O.action,Is.SERVER_ERROR),t===Dt.JOIN||t===Dt.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Ye(s=>{const a=l=>{(!n||n(l))&&(this.off(t,a),s(l))};this.on(t,a)})}uploadWRTCStats(t){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(fy.WRTC_STATS,n)}upload(t,n){const s={_type:t,_message:n};try{this.websocket.sendMessage(s)}catch{const l=Z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Fn.CONNECTED)return;const f=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(f._type,f._message)},Z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const s={_type:t,_message:n};this.websocket.sendMessage(s)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ye((n,s)=>{this.once(Nt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Nt.WS_CLOSED,a=>s(this.initError||new Ee($.WS_ABORT,a))),this.connectionState=Fn.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||pn.LEAVE,this.connectionState=Fn.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Nt.ABORT_P2P_EXECUTION);const t=await ws(this,Nt.REQUEST_JOIN_INFO),n=await this.request(Dt.JOIN,t);if(!n)return this.emit(Nt.REPORT_JOIN_GATEWAY,NR.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Nt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Fn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Ee($.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=ay(this,Nt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Dt.REJOIN,t);return!!n&&(this.connectionState=Fn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(s=>{this.emit(qt.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(qt.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(qt.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(qt.MUTE_AUDIO,{uid:s.uid}):this.emit(qt.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(qt.MUTE_VIDEO,{uid:s.uid}):this.emit(qt.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(qt.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(qt.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(qt.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(qt.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(qt.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){k.debug("[".concat(this.clientId,"] receive notification: "),t);const n=my(t.code);if(t.code===28&&"detail"in t&&(k.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Nt.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(pn.UID_BANNED),void this.close()):void this.reconnect(n.action,Is.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=Z("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(k.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>Z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Is.TIMEOUT):this.request(Dt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-n;this.rttRolling.add(s),Z("REPORT_STATS")&&this.send(Dt.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(fy.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(kt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Nt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(kt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(kt.CLOSED,()=>{this.connectionState=Fn.CLOSED}),this.websocket.on(kt.FAILED,()=>{this._disconnectedReason=pn.NETWORK_ERROR,this.connectionState=Fn.CLOSED}),this.websocket.on(kt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Fn.CONNECTED?this.connectionState=Fn.RECONNECTING:this.connectionState=Fn.CONNECTING}),this.websocket.on(kt.WILL_RECONNECT,(t,n,s)=>{const a=ay(this,Nt.IS_P2P_DISCONNECTED),l=a||t!=="retry";a&&t==="retry"&&(k.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=NR.P2P_DISCONNECTED),l&&(k.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Nt.REPORT_JOIN_GATEWAY,n||NR.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Nt.DISCONNECT_P2P)),s(t)}),this.websocket.on(kt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{k.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Is.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Nt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Ee){if(t.code===$.UNEXPECTED_RESPONSE&&t.data.code===Rt.ERR_NO_AUTHORIZED)return this.initError=new Ee($.TOKEN_EXPIRE,"dynamic key expired"),void this.close(pn.TOKEN_EXPIRE);k.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Is.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(kt.REQUEST_NEW_URLS,(t,n)=>{ws(this,Nt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(uF.PRE_CONNECT_PC,()=>{this.emit(Nt.PRE_CONNECT_PC)})}}let P$=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Ni=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function gF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function xR(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?gF(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gF(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Gh(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(Z("TURN_DOMAIN")):(k.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function VO(e,t){e.addresses||(e.addresses=[]);const n=function(m,_){if(Z("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(A=>{let{ip:O,port:D}=A;return{address:"".concat(O,":").concat(D)}});const S=Z("GATEWAY_DOMAINS");let b=S[1]&&We(_).call(_,S[1])?1:0;return m.map(A=>{let{domain_prefix:O,port:D,ip:G}=A;if(O)return{address:"".concat(O,".").concat(S[b++%S.length],":").concat(D)};const B=/^[\.\:\d]+$/.test(G),j=B?"".concat(G.replace(/[^\d]/g,"-"),".").concat(S[b++%S.length],":").concat(D):"".concat(G,":").concat(D);return B||k.debug("Cannot recognized as ip address: ".concat(G,", use as host")),{ip:G,port:D,address:j}})}(e.addresses,t),s=Array.isArray(e.detail)&&e.detail[18];if(s&&typeof s=="string"){const m=s.split(";");for(let _=0;_<m.length;_++){var a;const S=nr(a=m[_]).call(a);n[_]&&S&&(n[_].ip6=S)}}const l=e.detail&&e.detail.candidate;let f;if(l){const[m,_]=l.split(":");m&&_&&(f={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:n,apGatewayAddress:f,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ea(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function EF(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Ea(t.width),"x").concat(Ea(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function _F(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Ey(e,t){let n,s,a;switch(t){case Ni.CHOOSE_SERVER:s=4096,a="choose server";break;case Ni.CLOUD_PROXY:s=1048576,a="proxy";break;case Ni.CLOUD_PROXY_5:s=4194304,a="proxy5";break;case Ni.CLOUD_PROXY_FALLBACK:s=4194310,a="proxy fallback";break;default:throw new Ee($.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(l=>{l.buffer&&l.buffer.flag===s&&(n={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(f=>xR(xR({},f),{},{ticket:l.buffer.cert})),server_ts:e.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:xR(xR({},l.buffer.detail),e.detail),flag:l.buffer.flag,opid:e.opid,cert:l.buffer.cert})}),!n)throw new Ee($.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(a," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function SF(e,t){return await Ye.all(e.addresses.map(async n=>({address:Z("USE_TURN_IP")?n.ip:Gh(n.ip),tcpport:n.port,udpport:n.port,username:t&&Z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Os.username,password:t&&Z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Yw(t.toString()):Os.password})))}function jO(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),s=t.videoHeight||n.height,a=t.videoWidth||n.width;return s&&a?Math.max(Math.min(s,a)/Math.min(Ea(e.height),Ea(e.width)),1):(k.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Hh(e){let{candidateType:t,relayProtocol:n,type:s,address:a,port:l,protocol:f}=e;const m={candidateType:t,relayProtocol:n,protocol:f};if(s!=="local-candidate"){const _=a.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=l}return m}function PR(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Z("SVC_MODE");if(Z("ENABLE_SVC"))return function(t){return t in lR}(e)?e:lR.L1T3}const yF={[at.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[at.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function kR(e,t,n){t.forEach(s=>{var a;const l=yF[e].find(m=>{var _;let{key:S}=m;return We(_=s.extensionName).call(_,S)});if(!l)return;const f=n.find(m=>{let{extensionName:_}=m;return We(_).call(_,l.key)});f&&We(a=f.extensionName).call(a,"gdpr_forbidden")&&(s.extensionName=f.extensionName)})}function s_(e,t){t.forEach(n=>{var s;const a=yF[e].find(l=>{var f;let{key:m}=l;return We(f=n.extensionName).call(f,m)});We(s=n.extensionName).call(s,"gdpr_forbidden")&&a&&(n.extensionName=a.extensionName)})}function TF(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||We(e).call(e,"abs-send-time")}function MR(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||We(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function vF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function bF(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vF(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vF(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function _y(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{filterRTX:a,filterVideoFec:l,filterAudioFec:f,filterAudioCodec:m,filterVideoCodec:_}=t,{useXR:S}=n;let b=[],A=[],O=[],D=[],G=!1,B=!1;if(Yr(e).mediaDescriptions.forEach(Y=>{s&&s!==Y.attributes.direction||(Y.media.mediaType!=="video"||G||(A=Y.attributes.payloads,D=Y.attributes.extmaps,G=!0),Y.media.mediaType!=="audio"||B||(b=Y.attributes.payloads,O=Y.attributes.extmaps,B=!0))}),!D||A.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!O||b.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(A.forEach(Y=>{var q;(q=Y.rtpMap)!==null&&q!==void 0&&q.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),S&&Y.rtcpFeedbacks.push({type:"rrtr"})}),b.forEach(Y=>{var q;(q=Y.rtpMap)!==null&&q!==void 0&&q.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),S&&Y.rtcpFeedbacks.push({type:"rrtr"})}),a&&(b=b.filter(Y=>{var q;return((q=Y.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())!=="rtx"}),A=A.filter(Y=>{var q;return((q=Y.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())!=="rtx"})),l&&(A=A.filter(Y=>{var q;return!/(red)|(ulpfec)|(flexfec)/i.test(((q=Y.rtpMap)===null||q===void 0?void 0:q.encodingName)||"")})),f&&(b=b.filter(Y=>{var q;return!/(red)|(ulpfec)|(flexfec)/i.test(((q=Y.rtpMap)===null||q===void 0?void 0:q.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(b=b.filter(Y=>{var q;return We(m).call(m,((q=Y.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const Y=A.filter(q=>{var ie;return We(_).call(_,((ie=q.rtpMap)===null||ie===void 0?void 0:ie.encodingName.toLowerCase())||"")});A=Y.concat(a?[]:KO(Y,A))}const j=Z("UNSUPPORTED_VIDEO_CODEC");return j&&j.length>0&&(A=A.filter(Y=>!(Y.rtpMap&&We(j).call(j,Y.rtpMap.encodingName.toLowerCase())))),{audioCodecs:b,videoCodecs:A,audioExtensions:O,videoExtensions:D}}function Kh(e){const t=Yr(e);let n,s;for(const a of t.mediaDescriptions){if(!n){const l=a.attributes.iceUfrag,f=a.attributes.icePwd;if(!l||!f)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:l,icePwd:f}}if(!s){const l=a.attributes.fingerprints;l.length>0&&(s={fingerprints:l})}}if(!s&&t.attributes.fingerprints.length>0&&(s={fingerprints:t.attributes.fingerprints}),!s||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:s}}function RF(e,t){const n=[],s=e.attributes.ssrcGroups.filter(f=>f.semantic==="FID"),a=e.attributes.ssrcGroups.find(f=>f.semantic==="SIM"),l=e.attributes.ssrcs;if(a)a.ssrcIds.forEach(f=>{var m;const _=(m=s.find(S=>S.ssrcIds[0]===f))===null||m===void 0?void 0:m.ssrcIds[1];n.push({ssrcId:f,rtx:t?_:void 0})});else if(s.length>0){const f=s[0].ssrcIds[0],m=s[0].ssrcIds[1];n.push({ssrcId:f,rtx:t?m:void 0})}else{if(l.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:l[0].ssrcId})}return n}function AF(e,t,n){const{cname:s}=e;let a=[];t&&(a=CF(t)),a.length===0&&(a=e.iceParameters.candidates.map(b=>({foundation:b.foundation,componentId:"1",transport:b.protocol,priority:b.priority.toString(),connectionAddress:b.ip,port:b.port.toString(),type:b.type,extension:{}})),k.debug("Using candidates from gateway."));const l={fingerprints:e.dtlsParameters.fingerprints.map(b=>({hashFunction:b.algorithm,fingerprint:b.fingerprint}))},f={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=FR(e.rtpCapabilities),S=[];return Array.isArray(n)&&n.length>0&&n.forEach(b=>{S.push({kind:at.VIDEO,ssrcId:b.v,rtx:b.v_rtx,mslabel:"".concat(b.v,"_").concat(b.a)},{kind:at.AUDIO,ssrcId:b.a,mslabel:"".concat(b.v,"_").concat(b.a)})}),{dtlsParameters:l,iceParameters:f,candidates:a,rtpCapabilities:_,setup:m,cname:s,preSSRCs:S}}function CF(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],k.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),k.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function lm(e,t,n){const s=[],a=[];return e.forEach(l=>{let{ssrcId:f,rtx:m}=l;const _=Pn(8,"track-"),S={ssrcId:f,attributes:bF({label:_,mslabel:n=n||Pn(10,""),msid:"".concat(n," ").concat(_)},t&&{cname:t})};if(s.push(S),m!==void 0){const b={ssrcId:m,attributes:bF({label:_,mslabel:n,msid:"".concat(n," ").concat(_)},t&&{cname:t})};s.push(b),a.push({semantic:"FID",ssrcIds:[f,m]})}}),e.length>1&&a.push({semantic:"SIM",ssrcIds:e.map(l=>{let{ssrcId:f}=l;return f})}),{ssrcs:s,ssrcGroups:a}}function r_(e,t){t instanceof fi&&e.attributes.payloads.forEach(n=>{var s;const a=(s=n.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase();if(!a||["opus","pcmu","pcma","g722"].indexOf(a)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const l=t._encoderConfig;l&&a!=="pcmu"&&a!=="pcma"&&a!=="g722"&&(l.bitrate&&!oi()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function GO(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function HO(e,t){var n;if(!(t instanceof Kn&&t._encoderConfig&&t._hints.indexOf(kn.SCREEN_TRACK)===-1))return;const s=t._encoderConfig;on().supportMinBitrate&&s.bitrateMin&&e.attributes.payloads.forEach(a=>{var l,f;We(l=["h264","h265","vp8","vp9","av1"]).call(l,((f=a.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),on().supportMinBitrate&&!We(n=t._hints).call(n,kn.LOW_STREAM)&&s.bitrateMax&&e.attributes.payloads.forEach(a=>{var l,f;We(l=["h264","h265","vp8","vp9","av1"]).call(l,((f=a.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-start-bitrate"]="".concat(Z("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function IF(e){if(e.media.mediaType!=="video")return;const t=nn();if(t.name!==ln.SAFARI&&t.os!==Qi.IOS)return;const n=e.attributes.extmaps.findIndex(s=>/video-orientation/g.test(s.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function UR(e,t,n){if(!t)return;let s,a;if(e.media.mediaType==="video"?(s=n.videoExtensions,a=n.videoCodecs):(s=n.audioExtensions,a=n.audioCodecs),t.twcc===!0){const l=s.find(f=>MR(f.extensionName));if(l){const f=l.extensionName;e.attributes.extmaps.find(_=>MR(_.extensionName))||e.attributes.extmaps.push({entry:l.entry,extensionName:f}),function(_,S){return S.filter(b=>!!_.find(A=>A.payloadType===b.payloadType&&!!A.rtcpFeedbacks.find(O=>O.type==="transport-cc")))}(a,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(S=>S.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const l=e.attributes.extmaps.findIndex(f=>MR(f.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(f=>{const m=f.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&f.rtcpFeedbacks.splice(m,1)})}if(t.remb===!0){const l=s.find(f=>TF(f.extensionName));if(l){const f=l.extensionName;e.attributes.extmaps.find(_=>_.extensionName===f)||e.attributes.extmaps.push({entry:l.entry,extensionName:f}),function(_,S){return S.filter(b=>!!_.find(A=>A.payloadType===b.payloadType&&!!A.rtcpFeedbacks.find(O=>O.type==="goog-remb")))}(a,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(S=>S.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const l=e.attributes.extmaps.findIndex(f=>TF(f.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(f=>{const m=f.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&f.rtcpFeedbacks.splice(m,1)})}}function wF(e,t,n){if(oi()||e.media.mediaType!=="video"||!(t instanceof Kn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!Z("SIMULCAST")||n==="vp9"&&Z("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const s=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,a=e.attributes.ssrcs[0],l=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===a.ssrcId),f={semantic:"SIM",ssrcIds:[a.ssrcId]};for(let m=1;m<s;m++)e.attributes.ssrcs.push({ssrcId:a.ssrcId+m,attributes:di(a.attributes)}),f.ssrcIds.push(a.ssrcId+m),l&&(e.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+m,attributes:di(a.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[a.ssrcId+m,l.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(f)}async function OF(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const s=(await n.createOffer()).sdp,{send:a,recv:l,sendrecv:f}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;const b=_y(S,m,_,"sendonly"),A=_y(S,m,_,"recvonly"),O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nc(b,A,"videoExtensions",O,D,G),nc(b,A,"videoCodecs",O,D,G),nc(b,A,"audioExtensions",O,D,G),nc(b,A,"audioCodecs",O,D,G),Z("RAISE_H264_BASELINE_PRIORITY")){const B=[],j=[];G.videoCodecs.forEach((Y,q)=>{var ie;if(((ie=Y.rtpMap)===null||ie===void 0?void 0:ie.encodingName.toLocaleLowerCase())==="h264"){var le,ue;const oe=G.videoCodecs[q+1],ye=oe&&PF(Y,oe),Pe=(le=Y.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"],ze=(ue=Y.fmtp)===null||ue===void 0?void 0:ue.parameters["packetization-mode"];!Pe||Pe!==Z("FIRST_H264_PROFILE_LEVEL_ID")||Z("FIRST_PACKETIZATION_MODE")&&ze!==Z("FIRST_PACKETIZATION_MODE")?ye?j.push([Y,oe]):j.push([Y]):ye?B.push([Y,oe]):B.push([Y])}}),B.length>0&&j.length>0&&(k.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((Y,q)=>{var ie;if(((ie=Y.rtpMap)===null||ie===void 0?void 0:ie.encodingName.toLocaleLowerCase())==="h264"){const le=PF(Y,G.videoCodecs[q+1]),ue=B.shift()||j.shift()||[];ue.length>0&&(le?G.videoCodecs.splice(q,2,...ue):G.videoCodecs.splice(q,1,...ue))}}),D.videoCodecs=D.videoCodecs.filter(Y=>{var q,ie;return!(((q=Y.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"&&((ie=Y.fmtp)===null||ie===void 0?void 0:ie.parameters["profile-level-id"])!==Z("FIRST_H264_PROFILE_LEVEL_ID"))}),Z("FILTER_SEND_H264_BASELINE")&&(O.videoCodecs=O.videoCodecs.filter(Y=>{var q,ie;return!(((q=Y.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"&&((ie=Y.fmtp)===null||ie===void 0?void 0:ie.parameters["profile-level-id"])!==Z("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:O,recv:D,sendrecv:G}}(e,t,s);try{n.close()}catch{}return{send:a,recv:l,sendrecv:f}}function DF(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=_y(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nc(e,t,"videoExtensions",n,s,a),nc(e,t,"videoCodecs",n,s,a),nc(e,t,"audioExtensions",n,s,a),nc(e,t,"audioCodecs",n,s,a),Z("RAISE_H264_BASELINE_PRIORITY")){const l=a.videoCodecs.findIndex(f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]==="42001f");if(l!==-1){const f=a.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(f<l){k.debug("raising H264 baseline profile priority");const m=a.videoCodecs[l];a.videoCodecs.splice(l,1),a.videoCodecs.splice(f,0,m)}f!==-1&&(s.videoCodecs=s.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:s,sendrecv:a}}function nc(e,t,n,s,a,l){if(n==="videoExtensions"||n==="audioExtensions"){const f=[];return e[n].forEach(m=>{t[n].some((_,S)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return f.push(S),!0})?l[n].push(m):s[n].push(m)}),void t[n].forEach((m,_)=>{f.indexOf(_)===-1&&a[n].push(m)})}if(n==="videoCodecs"||n==="audioCodecs"){const f=[];return e[n].forEach(m=>{t[n].some((_,S)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return f.push(S),!0})?l[n].push(m):s[n].push(m)}),void t[n].forEach((m,_)=>{f.indexOf(_)===-1&&a[n].push(m)})}}function FR(e){const{send:t,recv:n,sendrecv:s}=e;if(!s){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let a,l;return t?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...t.audioCodecs,...s.audioCodecs],a.videoCodecs=[...t.videoCodecs,...s.videoCodecs],a.audioExtensions=[...t.audioExtensions,...s.audioExtensions],a.videoExtensions=[...t.videoExtensions,...s.videoExtensions]):a=s,n?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...n.audioCodecs,...s.audioCodecs],l.videoCodecs=[...n.videoCodecs,...s.videoCodecs],l.audioExtensions=[...n.audioExtensions,...s.audioExtensions],l.videoExtensions=[...n.videoExtensions,...s.videoExtensions]):l=s,{send:a,recv:l}}function a_(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Sy(e,t,n,s){let a=[];if(e===at.VIDEO){if(Z("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(a=t.videoCodecs.filter(l=>{var f;return We(f=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(f,s)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===Z("H264_PROFILE_LEVEL_ID")})),!Array.isArray(a)||a.length===0){let l=[];const f=[],m=[],_=[];if(n.videoCodecs.forEach(S=>{const b=S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||"";We(b).call(b,s)?l.push(S):We(b).call(b,"vp9")?f.push(S):We(b).call(b,"vp8")?m.push(S):We(b).call(b,"h264")&&_.push(S)}),l.length===0){let S="";f.length!==0?(l=f,S="vp9"):m.length!==0?(l=m,S="vp8"):_.length!==0&&(l=_,S="h264"),k.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(S))}l.length!==0&&(a=t.videoCodecs.filter(S=>l.some(b=>b.payloadType===S.payloadType)))}if(a.length===0&&(k.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),a=t.videoCodecs),Z("USE_PUB_RTX")||Z("USE_SUB_RTX")){const l=KO(a,t.videoCodecs);a=[...a,...l]}}else a=t.audioCodecs.filter(l=>{var f;return We(f=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(f,s)}),a.length===0&&(k.warning("codec ".concat(s," not included in rtpCapabilities, fallback to opus")),a=t.audioCodecs.filter(l=>{var f;return We(f=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(f,"opus")}));return a}function KO(e,t){const n=e.map(s=>s.payloadType.toString());return t.filter(s=>s.rtpMap&&s.rtpMap.encodingName==="rtx"&&s.fmtp&&s.fmtp.parameters.apt&&We(n).call(n,s.fmtp&&s.fmtp.parameters.apt))}async function yy(e,t,n){const s=t.toString(),a=LF(s,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:s});const l=await e.createAnswer();if(!l.sdp)throw new Error("cannot get answer sdp");let f=l.sdp;f=NF(f,n||{}),a==null||a(f||""),await e.setLocalDescription({type:"answer",sdp:f})}function NF(e,t,n){const s=Yr(e),{useXR:a}=t;return s.mediaDescriptions.forEach(l=>{var f;l.attributes.mid&&(Array.isArray(n)&&!We(n).call(n,l.attributes.mid)||(l.media.mediaType==="audio"&&a_(l),a&&We(f=["audio","video"]).call(f,l.media.mediaType)&&l.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Bh(s)}function LF(e,t,n,s){if(Z("SDP_LOGGING"))return k.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(s,`
`),e),t==="offer"?a=>{LF(a,"answer",n==="local"?"remote":"local",s)}:void 0}function xF(e){const t=Z("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>We(e).call(e,n))}function PF(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function kF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function uo(e,t){return typeof Z(e)===t?Z(e):void 0}function k$(){try{const e=Z("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?kF(Object(s),!0).forEach(function(a){W(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):kF(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}({},e)}catch(e){return k.debug("handle gateway attributes failed: ",e),{}}}const MF={};function Wh(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&k.debug("install service ".concat(e.name)),MF[e.name]=e}function hu(e){const t=MF[e];if(!t)throw new ve($.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function UF(e,t){return hu("DataStream").create(e,t)}function BR(){return hu("InterceptFrame").create()}function FF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function fu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FF(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FF(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}const WO=new Map;class M$ extends ii{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(os.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(os.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){k.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var s,a,l;super(),W(this,"store",void 0),W(this,"joinInfo",void 0),W(this,"key",void 0),W(this,"ntpOffset",0),W(this,"signal",void 0),W(this,"role",void 0),W(this,"inChannelInfo",{joinAt:null,duration:0}),W(this,"spec",void 0),W(this,"_state","DISCONNECTED"),W(this,"_statsCollector",void 0),W(this,"_disconnectedReason",void 0),W(this,"isSignalRecover",!1),W(this,"hasChangeBGPAddress",!1),W(this,"trafficStatsInterval",void 0),W(this,"networkQualityInterval",void 0),W(this,"_joinGatewayStartTime",0),W(this,"_signalTimeout",!1),W(this,"_clientRoleOptions",void 0),W(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(s={spec:fu(fu({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(a=(l=hu("P2PChannel")).createSubmodule)===null||a===void 0?void 0:a.call(l,s)):new x$(fu(fu({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,s){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const a=Date.now();let l=WO.get(t.cname);if(l||(l=new Map,WO.set(t.cname,l)),this._isProactiveJoin=!0,l.has(t.uid)){const S=new Ee($.UID_CONFLICT);throw gt.joinGateway(t.sid,{lts:a,succ:!1,ec:S.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),S}l.set(t.uid,!0),this.joinInfo=t,this.key=n;let f=0;this.joinGatewayStartTime=a;const m=t.proxyServer;try{k.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(f));const S=t.gatewayAddrs.map(b=>{let{address:A}=b;const[O,D]=A.split(":"),G={host:O,port:D};return t.proxyServer&&(G.proxy=t.proxyServer),G});f=(await this.signal.init(S)).uid,k.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(f," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(S){var _;throw k.error("[".concat(this.store.clientId,"] User join failed"),S.toString()),gt.joinGateway(t.sid,{lts:a,succ:!1,ec:((_=S.data)===null||_===void 0?void 0:_.desc)||S.code,errorMsg:S.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:t.preload}),l.delete(t.uid),this.signal.close(),S}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),k.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(S=>{k.warning("[".concat(this.store.clientId,"] get traffic stats error"),S.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(os.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(os.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(os.NETWORK_QUALITY,{uplinkNetworkQuality:_F(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:_F(this._statsCollector.trafficStats.B_dnq)}):this.emit(os.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),f}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==pn.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Fn.CONNECTED||await function(s,a){return a===1/0?s:Ye.race([s,oq(a)])}(this.signal.request(Dt.LEAVE,void 0,!0),3e3)}catch(s){k.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),s)}this.signal.close(n),n!==pn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:Z("PUB_EXTEND"),twcc:!!Z("PUBLISH_TWCC"),rtx:!!Z("USE_PUB_RTX")};try{return(await this.signal.request(Dt.PUBLISH,a,!0))._message}catch(l){if(s&&l.data&&l.data.code===Rt.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),l.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw l}}async publishDataChannel(t,n,s){var a;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const l={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(a=n.maxRetransmits)!==null&&a!==void 0?a:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Dt.PUBLISH_DATASTREAM,l,!0)}catch(f){if(s&&f.data&&f.data.code===Rt.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),f.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw f}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Dt.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(s){k.warning("[".concat(this.store.clientId,"] unpublish warning: "),s)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ye.all(t.map(n=>this.signal.request(Dt.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){k.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const a={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Z("SUBSCRIBE_TWCC"),rtx:!!Z("USE_SUB_RTX")||void 0,extend:Z("SUB_EXTEND"),svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return await this.signal.request(Dt.PRE_SUBSCRIBE,a,!0)}catch(l){if(s&&l.data&&l.data.code===Rt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),l.toString()),this.presubscribe(t,n,!1);throw l}}async subscribe(t,n,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const a={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Z("SUBSCRIBE_TWCC"),rtx:!!Z("USE_SUB_RTX"),extend:Z("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return(await this.signal.request(Dt.SUBSCRIBE,a,!0))._message}catch(l){if(s&&l.data&&l.data.code===Rt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),l.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw l}}async subscribeDataChannel(t,n,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const a={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Dt.SUBSCRIBE_DATASTREAM,a,!0)}catch(l){if(s&&l.data&&l.data.code===Rt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),l.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw l}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const s={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!Z("USE_SUB_RTX"),twcc:!!Z("SUBSCRIBE_TWCC"),svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return await this.signal.request(Dt.SUBSCRIBE_STREAMS,s,!0)}catch(a){if(n&&a.data&&a.data.code===Rt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),a.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw a}}async setVideoProfile(t){const n=function(s){if(!(s.bitrateMax&&s.bitrateMin&&s.frameRate&&s.height&&s.width))return;let a=s.frameRate,l=s.width,f=s.height,m=!0;return typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(m=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,l||(m=!1)),typeof f!="number"&&(f=f.exact||f.ideal||f.max||f.min||0,a||(m=!1)),m?{stream_type:0,width:l,height:f,fps:a,start_bps:1e3*s.bitrateMax,min_bps:1e3*s.bitrateMin,target_bps:1e3*s.bitrateMax}:void 0}(t);if(n)return this.signal.request(Dt.SET_VIDEO_PROFILE,n);k.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(Dt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(s){k.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),s)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ye.all(t.map(s=>this.signal.request(Dt.UNSUBSCRIBE_DATASTREAM,{stream_id:s,uid:n},!0)))}catch(s){k.warning("unsubscribeDataChannel warning: ",s)}}async massUnsubscribe(t){try{await this.signal.request(Dt.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){k.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:s,rtpCapabilities:a}=t;return{gatewayEstablishParams:await this.signal.request(Dt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:s,rtpCapabilities:a}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Dt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Dt.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),Z("CLIENT_ROLE_OPTIONS")&&(k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},Z("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),Z("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},Z("CLIENT_ROLE_OPTIONS")),k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let s,a=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(s=this._clientRoleOptions.delay,a=1):a=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:a=0,await this.signal.request(Dt.SET_CLIENT_ROLE,{role:t,level:a,delay:s,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(Dt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Dt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(Dt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Dt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Dt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,s){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,s)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),fu({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Dt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=WO.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let s;return s=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:Os.username,password:Os.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(fu(fu({},Os),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Dt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const s=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(a=>a.peer_uid===n.peer_uid);s&&s.B_st!==n.B_st&&rR(()=>{this.emit(os.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new Ee($.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let s=Z("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var a;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(os.UPDATE_GATEWAY_CONFIG),a=this.store.clientId,We(ZE).call(ZE,a)||ZE.push(a);const l=!(oi()||nM(87)||WM())&&typeof Z("ENABLE_PRE_SUB")=="boolean"&&Z("ENABLE_PRE_SUB"),f=!WM()&&uo("ENABLE_PREALLOC_PC","boolean"),m=k$(),_=ty(87)||function(){const b=nn();if(b.name!==ln.SAFARI||!b.browserVersion)return!1;const A=b.browserVersion.split(".");return Number(A[0])>15||Number(A[0])===15&&Number(A[1])>=4}(),S=fu({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ao,browser:navigator.userAgent,process_id:Z("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:Z("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:fu({enableEncodedTransform:!!Z("ENABLE_AUDIO_METADATA")&&_||!!Z("ENABLE_AUDIO_TOPN")&&Fw(ln.CHROME,87,116)||void 0,enableAudioMetadata:!!Z("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!Z("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:Z("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:Z("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:Z("TOPN_SWITCH_HOLD_MS"),topnAudioGain:Z("TOPN_AUDIO_GAIN"),enablePublishedUserList:Z("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Z("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:uo("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:uo("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:uo("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:Z("USE_PUB_RTX")===!0||Z("USE_SUB_RTX")===!0||void 0,disableFEC:Z("DISABLE_FEC"),enableNTPReport:!!Z("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!Z("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!Z("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:uo("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!Z("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!Z("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:uo("USE_XR","boolean"),enableLossbasedBwe:uo("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!Z("ENABLE_AUT_CC")||void 0,enableCCFallback:uo("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:f,preSubNum:l?uo("PRE_SUB_NUM","number"):void 0,enablePubTWCC:uo("PUBLISH_TWCC","boolean"),enableSubTWCC:uo("SUBSCRIBE_TWCC","boolean"),enablePubRTX:uo("USE_PUB_RTX","boolean"),enableSubRTX:uo("USE_SUB_RTX","boolean"),enableSubSVC:Z("ENABLE_SVC")?Z("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0,enableSvcExtended:Z("ENABLE_SVC")&&Array.isArray(Z("SVC_EXTENDED"))&&Z("SVC_EXTENDED").length!==0?Z("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(S.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(S.aes_mode=this.joinInfo.aesmode,Z("ENCRYPT_AES")?(S.aes_secret=this.joinInfo.aespassword,S.aes_encrypt=!0):S.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(S.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(S.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(S.default_video_stream=this.joinInfo.defaultVideoStream),S}getRejoinMessage(){if(!this.joinInfo)throw new Ee($.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Nt.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Nt.WS_RECONNECTING,t=>{this.joinInfo&&gt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Is.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",gt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Nt.WS_CLOSED,t=>{let n;switch(t){case pn.LEAVE:n=Is.LEAVE;break;case pn.UID_BANNED:case pn.IP_BANNED:case pn.CHANNEL_BANNED:case pn.SERVER_ERROR:n=Is.SERVER_ERROR;break;case pn.FALLBACK:n=Is.FALLBACK;break;case pn.LICENSE_MISSING:case pn.LICENSE_EXPIRED:case pn.LICENSE_MINUTES_EXCEEDED:case pn.LICENSE_PERIOD_INVALID:case pn.LICENSE_MULTIPLE_SDK_SERVICE:case pn.LICENSE_ILLEGAL:case pn.TOKEN_EXPIRE:n=t;break;default:n=Is.NETWORK_ERROR}k.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Is.NETWORK_ERROR)),this.joinInfo&&gt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===pn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==pn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Nt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=Z("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(k.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(gt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void k.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));vn("EVENT_REPORT_DOMAIN",t[1]),vn("EVENT_REPORT_BACKUP_DOMAIN",t[1]),vn("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(qt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Nt.REQUEST_RECOVER,(t,n,s)=>{if(!this.joinInfo)return s(new Ee($.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ws(this,os.REQUEST_NEW_GATEWAY_LIST).then(n).catch(s)}),this.signal.on(Nt.REQUEST_JOIN_INFO,async(t,n,s)=>{var a;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const l=di((a=this.joinInfo)===null||a===void 0?void 0:a.turnServer);if(Z("NEW_TURN_MODE")&&l){let S=l.servers,b=l.serversFromGateway;const A=this.signal.currentURLIndex;S.length>0&&(S=[S[A%S.length]],l.servers=S),Array.isArray(b)&&b.length>0&&(b=[b[0]],l.serversFromGateway=b),k.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(A))}const{iceParameters:f,dtlsParameters:m,rtpCapabilities:_}=await ws(this,os.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:l});try{t(this.getJoinMessage({ortc:{iceParameters:f,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(S){n(S)}}),this.signal.on(Nt.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Nt.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let s,a="";var l;t instanceof Ee?(s=((l=t.data)===null||l===void 0?void 0:l.desc)||t.code,a=t.message):s=t,gt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:s,errorMsg:a,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Nt.IS_P2P_DISCONNECTED,t=>{t(ay(this,os.IS_P2P_DISCONNECTED))}),this.signal.on(Nt.DISCONNECT_P2P,()=>{this.emit(os.DISCONNECT_P2P)}),this.signal.on(Nt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Nt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Nt.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(os.JOIN_RESPONSE,t,n)}),this.signal.on(Nt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const t=this.getCurrentGatewayAddress(),n=Z("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t&&n){const s=CF(t);this.emit(os.PRE_CONNECT_PC,{candidates:s,fingerprint:n})}}}),this.signal.on(Nt.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof Z("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(Z("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(Dt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),s),s}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(Dt.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(s){throw k.warning("unsubscribe datachannel warning",s),s}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(Dt.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),s),s}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(Dt.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(s){throw k.warning("unpublish datastream warning: ",s),s}}async tryMassUnsubBeforeResub(t){const n={users:t.map(s=>({stream_id:s.stream_id,stream_type:s.stream_type}))};try{await this.signal.request(Dt.UNSUBSCRIBE_STREAMS,n,!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),s),s}}async muteLocal(t,n){const s={action:t.find(a=>a.stream_type===En.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Dt.CONTROL,s,!0,!0)}catch(a){throw k.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),a),a}}async unmuteLocal(t,n){const s={action:t.find(a=>a.stream_type===En.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Dt.CONTROL,s,!0,!0)}catch(a){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),a),a}}async muteRemote(t,n){const s={action:t===at.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Dt.CONTROL,s,!0,!0)}catch(a){throw k.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),a),a}}async unmuteRemote(t,n){const s={action:t===at.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Dt.CONTROL,s,!0,!0)}catch(a){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),a),a}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Dt.RESTART_ICE,n,!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),s),s}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||Is.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!Z("GATEWAY_WSS_ADDRESS"))return Z("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(k.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Dt.SET_PARAMETER,{enablePublishAudioFilter:t})}}let VR=0,YO=0;function Zc(e,t,n,s){return new Ye((a,l)=>{t.timeout=t.timeout||Z("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),VR+=Yl(t.data)):n&&(t.data.size?VR+=t.data.size:t.data instanceof FormData?VR+=yM(t.data):VR+=Yl(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Lr.request(t).then(f=>{typeof f.data=="string"?YO+=Yl(f.data):f.data instanceof ArrayBuffer||f.data instanceof Uint8Array?YO+=f.data.byteLength:YO+=Yl(JSON.stringify(f.data)),s&&a({data:f.data,headers:f.headers}),a(f.data)}).catch(f=>{Lr.isCancel(f)?l(new Ee($.OPERATION_ABORTED,"cancel token canceled")):f.code==="ECONNABORTED"?l(new Ee($.NETWORK_TIMEOUT,f.message)):f.response?l(new Ee($.NETWORK_RESPONSE_ERROR,f.response.status)):l(new Ee($.NETWORK_ERROR,f.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Ie){var je=0;return function(){return je<Ie.length?{done:!1,value:Ie[je++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(Ie,je,pt){return Ie==Array.prototype||Ie==Object.prototype||(Ie[je]=pt.value),Ie},s,a=function(Ie){Ie=[typeof globalThis=="object"&&globalThis,Ie,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var je=0;je<Ie.length;++je){var pt=Ie[je];if(pt&&pt.Math==Math)return pt}throw Error("Cannot find global object")}(this);function l(Ie,je){if(je)e:{var pt=a;Ie=Ie.split(".");for(var De=0;De<Ie.length-1;De++){var F=Ie[De];if(!(F in pt))break e;pt=pt[F]}(je=je(De=pt[Ie=Ie[Ie.length-1]]))!=De&&je!=null&&n(pt,Ie,{configurable:!0,writable:!0,value:je})}}function f(Ie){return(Ie={next:Ie})[Symbol.iterator]=function(){return this},Ie}function m(Ie){var je=typeof Symbol<"u"&&Symbol.iterator&&Ie[Symbol.iterator];return je?je.call(Ie):{next:t(Ie)}}if(l("Symbol",function(Ie){function je(F,te){this.A=F,n(this,"description",{configurable:!0,writable:!0,value:te})}if(Ie)return Ie;je.prototype.toString=function(){return this.A};var pt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",De=0;return function F(te){if(this instanceof F)throw new TypeError("Symbol is not a constructor");return new je(pt+(te||"")+"_"+De++,te)}}),l("Symbol.iterator",function(Ie){if(Ie)return Ie;Ie=Symbol("Symbol.iterator");for(var je="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),pt=0;pt<je.length;pt++){var De=a[je[pt]];typeof De=="function"&&typeof De.prototype[Ie]!="function"&&n(De.prototype,Ie,{configurable:!0,writable:!0,value:function(){return f(t(this))}})}return Ie}),typeof Object.setPrototypeOf=="function")s=Object.setPrototypeOf;else{var _;e:{var S={};try{S.__proto__={a:!0},_=S.a;break e}catch{}_=!1}s=_?function(Ie,je){if(Ie.__proto__=je,Ie.__proto__!==je)throw new TypeError(Ie+" is not extensible");return Ie}:null}var b=s;function A(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function O(Ie){if(Ie.m)throw new TypeError("Generator is already running");Ie.m=!0}function D(Ie,je){return Ie.h=3,{value:je}}function G(Ie){this.g=new A,this.G=Ie}function B(Ie,je,pt,De){try{var F=je.call(Ie.g.j,pt);if(!(F instanceof Object))throw new TypeError("Iterator result "+F+" is not an object");if(!F.done)return Ie.g.m=!1,F;var te=F.value}catch(re){return Ie.g.j=null,Ie.g.s(re),j(Ie)}return Ie.g.j=null,De.call(Ie.g,te),j(Ie)}function j(Ie){for(;Ie.g.h;)try{var je=Ie.G(Ie.g);if(je)return Ie.g.m=!1,{value:je.value,done:!1}}catch(pt){Ie.g.v=void 0,Ie.g.s(pt)}if(Ie.g.m=!1,Ie.g.l){if(je=Ie.g.l,Ie.g.l=null,je.F)throw je.D;return{value:je.return,done:!0}}return{value:void 0,done:!0}}function Y(Ie){this.next=function(je){return Ie.o(je)},this.throw=function(je){return Ie.s(je)},this.return=function(je){return function(pt,De){O(pt.g);var F=pt.g.j;return F?B(pt,"return"in F?F.return:function(te){return{value:te,done:!0}},De,pt.g.return):(pt.g.return(De),j(pt))}(Ie,je)},this[Symbol.iterator]=function(){return this}}function q(Ie,je){return je=new Y(new G(je)),b&&Ie.prototype&&b(je,Ie.prototype),je}if(A.prototype.o=function(Ie){this.v=Ie},A.prototype.s=function(Ie){this.l={D:Ie,F:!0},this.h=this.C||this.u},A.prototype.return=function(Ie){this.l={return:Ie},this.h=this.u},G.prototype.o=function(Ie){return O(this.g),this.g.j?B(this,this.g.j.next,Ie,this.g.o):(this.g.o(Ie),j(this))},G.prototype.s=function(Ie){return O(this.g),this.g.j?B(this,this.g.j.throw,Ie,this.g.o):(this.g.s(Ie),j(this))},l("Array.prototype.entries",function(Ie){return Ie||function(){return function(je,pt){je instanceof String&&(je+="");var De=0,F=!1,te={next:function(){if(!F&&De<je.length){var re=De++;return{value:pt(re,je[re]),done:!1}}return F=!0,{done:!0,value:void 0}}};return te[Symbol.iterator]=function(){return te},te}(this,function(je,pt){return[je,pt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ie=function(Ie,je){for(var pt=0;pt<Ie.length;pt++)je(Ie[pt])},le=function(Ie){return Ie.replace(/\r?\n|\r/g,`\r
`)},ue=function(Ie,je,pt){return je instanceof Blob?(pt=pt!==void 0?pt+"":typeof je.name=="string"?je.name:"blob",je.name===pt&&Object.prototype.toString.call(je)!=="[object Blob]"||(je=new File([je],pt)),[String(Ie),je]):[String(Ie),String(je)]},oe=function(Ie,je){if(Ie.length<je)throw new TypeError(je+" argument required, but only "+Ie.length+" present.")},ye=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Pe=ye.FormData,ze=ye.XMLHttpRequest&&ye.XMLHttpRequest.prototype.send,nt=ye.Request&&ye.fetch,$t=ye.navigator&&ye.navigator.sendBeacon,zt=ye.Element&&ye.Element.prototype,Mn=ye.Symbol&&Symbol.toStringTag;Mn&&(Blob.prototype[Mn]||(Blob.prototype[Mn]="Blob"),"File"in ye&&!File.prototype[Mn]&&(File.prototype[Mn]="File"));try{new File([],"")}catch{ye.File=function(je,pt,De){return je=new Blob(je,De||{}),Object.defineProperties(je,{name:{value:pt},lastModified:{value:+(De&&De.lastModified!==void 0?new Date(De.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Mn&&Object.defineProperty(je,Mn,{value:"File"}),je}}var Ai=function(Ie){return Ie.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},pi=function(Ie){this.i=[];var je=this;Ie&&ie(Ie.elements,function(pt){if(pt.name&&!pt.disabled&&pt.type!=="submit"&&pt.type!=="button"&&!pt.matches("form fieldset[disabled] *"))if(pt.type==="file"){var De=pt.files&&pt.files.length?pt.files:[new File([],"",{type:"application/octet-stream"})];ie(De,function(F){je.append(pt.name,F)})}else pt.type==="select-multiple"||pt.type==="select-one"?ie(pt.options,function(F){!F.disabled&&F.selected&&je.append(pt.name,F.value)}):pt.type==="checkbox"||pt.type==="radio"?pt.checked&&je.append(pt.name,pt.value):(De=pt.type==="textarea"?le(pt.value):pt.value,je.append(pt.name,De))})};if((e=pi.prototype).append=function(Ie,je,pt){oe(arguments,2),this.i.push(ue(Ie,je,pt))},e.delete=function(Ie){oe(arguments,1);var je=[];Ie=String(Ie),ie(this.i,function(pt){pt[0]!==Ie&&je.push(pt)}),this.i=je},e.entries=function Ie(){var je,pt=this;return q(Ie,function(De){if(De.h==1&&(je=0),De.h!=3)return je<pt.i.length?De=D(De,pt.i[je]):(De.h=0,De=void 0),De;je++,De.h=2})},e.forEach=function(Ie,je){oe(arguments,1);for(var pt=m(this),De=pt.next();!De.done;De=pt.next()){var F=m(De.value);De=F.next().value,F=F.next().value,Ie.call(je,F,De,this)}},e.get=function(Ie){oe(arguments,1);var je=this.i;Ie=String(Ie);for(var pt=0;pt<je.length;pt++)if(je[pt][0]===Ie)return je[pt][1];return null},e.getAll=function(Ie){oe(arguments,1);var je=[];return Ie=String(Ie),ie(this.i,function(pt){pt[0]===Ie&&je.push(pt[1])}),je},e.has=function(Ie){oe(arguments,1),Ie=String(Ie);for(var je=0;je<this.i.length;je++)if(this.i[je][0]===Ie)return!0;return!1},e.keys=function Ie(){var je,pt,De,F,te=this;return q(Ie,function(re){if(re.h==1&&(je=m(te),pt=je.next()),re.h!=3)return pt.done?void(re.h=0):(De=pt.value,F=m(De),D(re,F.next().value));pt=je.next(),re.h=2})},e.set=function(Ie,je,pt){oe(arguments,2),Ie=String(Ie);var De=[],F=ue(Ie,je,pt),te=!0;ie(this.i,function(re){re[0]===Ie?te&&(te=!De.push(F)):De.push(re)}),te&&De.push(F),this.i=De},e.values=function Ie(){var je,pt,De,F,te=this;return q(Ie,function(re){if(re.h==1&&(je=m(te),pt=je.next()),re.h!=3)return pt.done?void(re.h=0):(De=pt.value,(F=m(De)).next(),D(re,F.next().value));pt=je.next(),re.h=2})},pi.prototype._asNative=function(){for(var Ie=new Pe,je=m(this),pt=je.next();!pt.done;pt=je.next()){var De=m(pt.value);pt=De.next().value,De=De.next().value,Ie.append(pt,De)}return Ie},pi.prototype._blob=function(){var Ie="----formdata-polyfill-"+Math.random(),je=[],pt="--"+Ie+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(De,F){return typeof De=="string"?je.push(pt+Ai(le(F))+`"\r
\r
`+le(De)+`\r
`):je.push(pt+Ai(le(F))+'"; filename="'+Ai(De.name)+`"\r
Content-Type: `+(De.type||"application/octet-stream")+`\r
\r
`,De,`\r
`)}),je.push("--"+Ie+"--"),new Blob(je,{type:"multipart/form-data; boundary="+Ie})},pi.prototype[Symbol.iterator]=function(){return this.entries()},pi.prototype.toString=function(){return"[object FormData]"},zt&&!zt.matches&&(zt.matches=zt.matchesSelector||zt.mozMatchesSelector||zt.msMatchesSelector||zt.oMatchesSelector||zt.webkitMatchesSelector||function(Ie){for(var je=(Ie=(this.document||this.ownerDocument).querySelectorAll(Ie)).length;0<=--je&&Ie.item(je)!==this;);return-1<je}),Mn&&(pi.prototype[Mn]="FormData"),ze){var Fr=ye.XMLHttpRequest.prototype.setRequestHeader;ye.XMLHttpRequest.prototype.setRequestHeader=function(Ie,je){Fr.call(this,Ie,je),Ie.toLowerCase()==="content-type"&&(this.B=!0)},ye.XMLHttpRequest.prototype.send=function(Ie){Ie instanceof pi?(Ie=Ie._blob(),this.B||this.setRequestHeader("Content-Type",Ie.type),ze.call(this,Ie)):ze.call(this,Ie)}}nt&&(ye.fetch=function(Ie,je){return je&&je.body&&je.body instanceof pi&&(je.body=je.body._blob()),nt.call(this,Ie,je)}),$t&&(ye.navigator.sendBeacon=function(Ie,je){return je instanceof pi&&(je=je._asNative()),$t.call(this,Ie,je)}),ye.FormData=pi}})();const Ty=()=>{const e=Z("AREAS");return e.length===0&&e.push(dn.GLOBAL),jr(e).call(e,(t,n,s)=>{const a=BF(n);return a?s===0?a:"".concat(t,",").concat(a):t},"")},BF=e=>e===dn.OVERSEA?"".concat(ks.ASIA,",").concat(ks.EUROPE,",").concat(ks.AFRICA,",").concat(ks.NORTH_AMERICA,",").concat(ks.SOUTH_AMERICA,",").concat(ks.OCEANIA):ks[e],U$=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const s=LR[n],a=Object.keys(s);a&&a.map(l=>{l!=="CODE"&&(t[l]=t[l].concat(s[l]))})}),t},jR={GLOBAL:{ASIA:[dn.CHINA,dn.JAPAN,dn.INDIA,dn.KOREA,dn.HKMC],EUROPE:[],NORTH_AMERICA:[dn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},GR=Object.keys(jR[dn.GLOBAL]),qO=[dn.CHINA,dn.NORTH_AMERICA,dn.EUROPE,dn.ASIA,dn.JAPAN,dn.INDIA,dn.OCEANIA,dn.SOUTH_AMERICA,dn.AFRICA,dn.KOREA,dn.HKMC,dn.US],F$=function(e,t){let n=[];if(We(e).call(e,dn.GLOBAL)){const l=[dn.GLOBAL,dn.OVERSEA],f=Object.keys(LR);if(t===dn.GLOBAL)throw new Ee($.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===dn.CHINA)n=[dn.OVERSEA];else if(a=t,We(GR).call(GR,a)){const m=(s=t,jR[dn.GLOBAL][s]||[]),_=[...l,t,...m];n=f.filter(S=>!We(_).call(_,S))}else if(function(m){let _=!1;return GR.forEach(S=>{var b;We(b=jR[dn.GLOBAL][S]).call(b,m)&&(_=!0)}),_}(t)){const m=function(S){let b;return GR.forEach(A=>{var O;We(O=jR[dn.GLOBAL][A]).call(O,S)&&(b=A)}),b}(t),_=[...l,m,t];n=f.filter(S=>!We(_).call(_,S))}else n=e;n=function(m){const _=[];return qO.forEach(S=>{We(m).call(m,S)&&_.push(S)}),_.concat(m.filter(S=>!We(qO).call(qO,S)))}(n)}else n=e;var s,a;return n};function VF(e){var t,n;if(!e&&We(t=Z("AREAS")).call(t,dn.EXTENSIONS))return k.debug("update area from ap : reset"),void $O(qq,!0);if(!We(n=Z("AREAS")).call(n,dn.GLOBAL)||!e)return;let s=LR.EXTENSIONS;s&&(s={CODE:BF(dn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},k.debug("update area from ap success: ".concat(e,",config is "),s),vn("AREAS",[dn.EXTENSIONS],!0),Object.keys(s).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?vn(a,s[a][0]):vn(a,s[a])}))}function $O(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=gt.reportApiInvoke(null,{name:Fi.SET_AREA,options:e,tag:li.TRACER});try{let s=[];if(typeof e=="string"&&(s=[e]),Array.isArray(e)&&(e.forEach(l=>{if(!We(aF).call(aF,l))throw new Ee($.INVALID_PARAMS,"invalid area code")}),s=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:l,excludedArea:f}=e;if(!l)throw new Ee($.INVALID_PARAMS,"area code is needed");let m=l;typeof l=="string"&&(m=[l]),s=f?F$(m,f):m}if(!t){if(zc.AREAS){const l=new Ee($.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(l),void k.warning("setArea is prohibited because of config-distribute")}if(We(s).call(s,dn.GLOBAL)&&Z("AREAS")===dn.EXTENSIONS){const l=new Ee($.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(l),void k.warning("setArea is prohibited because of ap extensions")}}vn("AREAS",s,t);const a=U$(s);Object.keys(a).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?vn(l,a[l][0]):vn(l,a[l])}),k.debug("set area success:",s.join(","))}catch(s){throw n.onError(s),s}n.onSuccess()}function jF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Ql(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jF(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jF(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let zO=1;function B$(e,t,n,s,a){zO+=1;const l={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:zO,requestId:zO,version:ao,cname:n.cname},f={service_name:t,json_body:JSON.stringify(l)};let m,_,S=e[0];return $c(async()=>{m=Date.now();const b=await Zc(S,{data:f,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,b.code!==0){const D=new Ee($.UNEXPECTED_RESPONSE,"live streaming ap error, code"+b.code,{retry:!0,responseTime:_});throw k.error(D.toString()),D}const A=JSON.parse(b.json_body);if(A.code!==200){const D=new Ee($.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(A.code,", reason: ").concat(A.reason),{code:A.code,responseTime:_});throw k.error(D.toString()),D}if(!A.servers||A.servers.length===0){const D=new Ee($.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:A.code,responseTime:_});throw k.error(D.toString()),D}const O=function(D,G){return{addressList:D.servers.map(B=>"wss://".concat(B.address.replace(/\./g,"-"),".").concat(Z("WORKER_DOMAIN"),":").concat(B.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:D.workerToken,vid:D.vid}}(A,t);return Z("LIVE_STREAMING_ADDRESS")&&(O.addressList=Z("LIVE_STREAMING_ADDRESS")instanceof Array?Z("LIVE_STREAMING_ADDRESS"):[Z("LIVE_STREAMING_ADDRESS")]),Ql(Ql({},O),{},{responseTime:_})},(b,A)=>(gt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(b.addressList),firstSuccess:A===0,responseTime:_,serverIp:e[A%e.length]}),!1),(b,A)=>(gt.apworkerEvent(n.sid,{success:!1,sc:b.data&&b.data.code||200,serviceName:t,responseTime:_,serverIp:e[A%e.length]}),!!(b.code!==$.OPERATION_ABORTED&&b.code!==$.UNEXPECTED_RESPONSE||b.data&&b.data.retry)&&(S=e[(A+1)%e.length],!0)),a)}let XO=1;function GF(e,t,n,s){let{url:a,areaCode:l}=e;const{clientId:f,sid:m}=t,_=Date.now();let S;const b=t.role,[A,O]=QO(t,l,[Ni.CHOOSE_SERVER]);let D=Di.networkState;return $c(async()=>{D&&Di.networkState===ga.OFFLINE&&Di.onlineWaiter&&await Ye.race([Di.onlineWaiter,gs(s&&s.maxRetryTimeout||Bi.maxRetryTimeout)]),D=Di.networkState;const{data:G,headers:B}=await Zc(a,{data:A,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);S=B.http3==="1"?1:-1,gt.reportResourceTiming(a,m),KF(G,a,t,_,[Ni.CHOOSE_SERVER],S);const j=Ey(G,Ni.CHOOSE_SERVER);return JO(j),VO(j,a)},G=>(G&&gt.joinChooseServer(m,{role:b,lts:_,succ:!0,csAddr:a,opid:O,serverList:G.gatewayAddrs.map(B=>B.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[Ni.CHOOSE_SERVER].toString(),isHttp3:S,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==$.OPERATION_ABORTED&&(G.code===$.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(gt.joinChooseServer(m,{role:b,lts:_,succ:!1,csAddr:a,serverList:null,opid:O,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[Ni.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:D}),isHttp3:S,corssRegionTagReq:t.apRequestDetail}),k.warning("[".concat(f||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),s)}function HF(e,t,n,s){let a,{url:l,areaCode:f,serviceIds:m}=e;const _=Date.now(),S=t.role,[b,A]=QO(t,f,m);let O;return $c(async()=>{O&&Di.networkState===ga.OFFLINE&&Di.onlineWaiter&&await Ye.race([Di.onlineWaiter,gs(s&&s.maxRetryTimeout||Bi.maxRetryTimeout)]),O=Di.networkState;const{data:D,headers:G}=await Zc(l,{data:b,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);a=G.http3==="1"?1:-1,gt.reportResourceTiming(l,t.sid),KF(D,l,t,_,m,a);const B=Ey(D,Ni.CHOOSE_SERVER),j=Ey(D,t.cloudProxyServer==="proxy5"?Ni.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ni.CLOUD_PROXY:Ni.CLOUD_PROXY_FALLBACK);return JO(B),{gatewayInfo:VO(B,l),proxyInfo:j,url:l}},D=>(D.gatewayInfo&&gt.joinChooseServer(t.sid,{role:S,lts:_,succ:!0,csAddr:l,serverList:D.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:A,cid:D.gatewayInfo.cid.toString(),uid:D.gatewayInfo.uid.toString(),csIp:D.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:a,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:D.gatewayInfo.res.detail&&D.gatewayInfo.res.detail[38]}),D.proxyInfo&&gt.joinWebProxyAP(t.sid,{lts:_,sucess:1,apServerAddr:l,turnServerAddrList:D.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:m.toString()}),!1),D=>D.code!==$.OPERATION_ABORTED&&(D.code===$.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(gt.joinWebProxyAP(t.sid,{lts:_,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:D.code,eventType:t.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:O})}),k.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),D),!0)),s)}const KF=(e,t,n,s,a,l)=>{const{sid:f,clientId:m,cloudProxyServer:_}=n,S=[],b=A=>{A.flag===4096?gt.joinChooseServer(f,{role:n.role,lts:s,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:A.error.message,csIp:A.error.data&&A.error.data.csIp,unilbsServerIds:a.toString(),isHttp3:l,corssRegionTagReq:n.apRequestDetail}):A.flag!==1048576&&A.flag!==4194304&&A.flag!==4194310||gt.joinWebProxyAP(f,{lts:s,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:A.error.code,eventType:_,unilbsServerIds:a.toString()})};if(e.response_body.forEach(A=>{const O=A.buffer.code;if(A.uri===23&&O===0&&!A.buffer.edges_services)if(A.buffer.flag===4194310)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),A.buffer.edges_services=[];else{const D={error:new Ee($.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:A.buffer.flag};S.push(D),b(D)}if(O!==0){const D=i_(O),G={error:new Ee($.CAN_NOT_GET_GATEWAY_SERVER,D.desc,{desc:D.desc,retry:D.retry,csIp:e.detail[502]}),flag:A.buffer.flag};A.buffer.flag===4194310?k.warning(G.error.toString()):S.push(G),b(G)}}),S.length)throw k.warning("[".concat(m||"sid-".concat(f.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(S.map(A=>"flag: ".concat(A.flag,", message: ").concat(A.error.message,", retry: ").concat(A.error.data.retry)).join(" | "))),new Ee($.CAN_NOT_GET_GATEWAY_SERVER,S.map(A=>"flag: ".concat(A.flag,", message: ").concat(A.error.message)).join(" | "),{retry:!!S.find(A=>A.error.data.retry),csIp:e.detail[502],desc:[...new Set(S.map(A=>{var O;return A==null||(O=A.error)===null||O===void 0||(O=O.data)===null||O===void 0?void 0:O.desc}).filter(A=>!!A))]})},JO=e=>{var t,n,s,a;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Ee($.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(Z("AP_AREA")&&((s=e.detail)!==null&&s!==void 0&&s[23]&&typeof((a=e.detail)===null||a===void 0?void 0:a[23])=="string"?VF(e.detail[23].toLowerCase()):VF()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const f=e.detail[19],m=f==null?void 0:f.split(";");for(let _=0;_<m.length;_++){var l;const S=nr(l=m[_]).call(l);e.addresses[_]&&m&&(e.addresses[_].fingerprint=S)}}if(Z("GATEWAY_ADDRESS")&&Z("GATEWAY_ADDRESS").length>0){k.debug("assign gateway address to",Z("GATEWAY_ADDRESS"));const f=Z("GATEWAY_ADDRESS").map(m=>{var _,S;const b=(_=(S=e.addresses.find(A=>A.ip===m.ip&&A.port===m.port))===null||S===void 0?void 0:S.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:b}});e.addresses=f}},V$=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const s=i_(n.buffer.code);throw new Ee($.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return n.buffer.ticket}throw k.debug("update ticket request received ap response without response body:",t),new Ee($.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},QO=(e,t,n)=>{const s=Math.floor(Math.random()*1e12),a=e.role==="host"?"1":e.role==="audience"?"2":void 0,l={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Ql(Ql(Ql({6:e.stringUid,11:t,12:Z("USE_NEW_TOKEN")?"1":void 0},a?{17:a}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};l.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const f=new FormData;return f.append("request",JSON.stringify(l)),[f,s]},j$=(e,t)=>{const n=Math.floor(Math.random()*1e12),s={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},a=new FormData;return a.append("request",JSON.stringify(s)),[a,n]};let o_=0;function c_(e){return Ye.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const vy=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:s,allFailedhandler:a,promisesCollector:l}=e,f=0;const m=t;let _,S=0;const b=async()=>{const A=(()=>{const O=f*m,D=O+m;return n.slice(O,D).map(s)})();l&&l.push(...A);try{_=await c_(A)}catch(O){if(S+=m,f++,!(S>=n.length))return void await b();a(O)}A.forEach(O=>O.cancel())};return await b(),_},WF=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:s}=e;const a=t.length;let l=0;const f=async()=>{const m=n(t.shift());try{return await m}catch(_){if(l++,l>=a||s!=null&&s(_))throw _;return f()}};return f()};async function ZO(e,t,n,s){return{gatewayInfo:await async function(l,f,m,_){let S=null;const b=[],A=async()=>{const D=Z("WEBCS_DOMAIN").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(j=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:Ty()})),G=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),B=await vy({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(k.debug("[".concat(l.clientId,"] Connect to choose_server:"),j.url),GF(j,l,f,m)),allFailedhandler:j=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:b});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},G),B},O=async()=>{if(await gs(1e3),S!==null)return S;const D=Z("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:Ty()})),G=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),B=await vy({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(k.debug("[".concat(l.clientId,"] Connect to backup choose_server:"),j.url),GF(j,l,f,m)),allFailedhandler:j=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:b});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},G),B};try{return S=await c_([A(),O()]),b.length&&b.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),S}catch(D){throw D[0]}}(e,t,n,s)}}async function YF(e,t,n,s,a){const l=e.cloudProxyServer;if(l==="disabled"){if(e.useLocalAccessPoint)return await ZO(e,t,n,a);if(Z("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:O,proxyInfo:D}=await zF(e,t,n,a);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:O};const G=D.map(B=>({turnServerURL:B.address,tcpport:B.tcpport||Os.tcpport,udpport:B.udpport||Os.udpport,username:B.username||Os.username,password:B.password||Os.password,forceturn:!1,security:!0}));if(a.useP2P){var f;const B=(f=e.uid)!==null&&f!==void 0?f:O.uid,j="glb:".concat(B.toString()),Y=await Yw(j),q=D.map(ie=>({turnServerURL:ie.address,tcpport:ie.tcpport||Os.tcpport,udpport:ie.udpport||Os.udpport,username:j,password:Y,forceturn:!1,security:!0}));G.push(...q)}return e.turnServer={mode:"manual",servers:G},{gatewayInfo:O}}return await ZO(e,t,n,a)}const{proxyInfo:m,gatewayInfo:_}=await zF(e,t,n,a),S={gatewayInfo:_},b=m.map(O=>({turnServerURL:O.address,tcpport:l==="proxy3"?void 0:O.tcpport?O.tcpport:Os.tcpport,udpport:l==="proxy4"?void 0:O.udpport?O.udpport:Os.udpport,username:O.username||Os.username,password:O.password||Os.password,forceturn:l!=="proxy4",security:l==="proxy5"}));if(a.useP2P){var A;const O=(A=e.uid)!==null&&A!==void 0?A:_.uid,D="glb:".concat(O.toString()),G=await Yw(D),B=m.map(j=>({turnServerURL:j.address,tcpport:l==="proxy3"?void 0:j.tcpport||Os.tcpport,udpport:l==="proxy4"?void 0:j.udpport||Os.udpport,username:D,password:G,forceturn:l!=="proxy4",security:l==="proxy5"}));b.push(...B)}return e.turnServer={mode:"manual",servers:b},k.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(l)),S}async function qF(e,t,n,s,a){const l=Z("ACCOUNT_REGISTER").slice(0,Z("AJAX_REQUEST_CONCURRENT"));let f=[];f=t.proxyServer?l.map(_=>"https://".concat(t.proxyServer,"/ap/?url=").concat(_+"/api/v1")):l.map(_=>"https://".concat(_,"/api/v1"));const m=a==null?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:f});try{const _=await async function(S,b,A,O,D){const G=Date.now(),B={sid:A.sid,opid:10,appid:A.appId,string_uid:b};let j=S[0];const Y=await $c(()=>Zc(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:B,cancelToken:O,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(q,ie)=>{if(q.code===0){if(q.uid<=0||q.uid>=Math.pow(2,32))throw k.error("Invalid Uint Uid ".concat(b," => ").concat(q.uid),q),gt.reqUserAccount(B.sid,{lts:G,success:!1,serverAddr:j,stringUid:B.string_uid,uid:q.uid,errorCode:$.INVALID_UINT_UID_FROM_STRING_UID,extend:B}),new Ee($.INVALID_UINT_UID_FROM_STRING_UID);return gt.reqUserAccount(B.sid,{lts:G,success:!0,serverAddr:j,stringUid:B.string_uid,uid:q.uid,errorCode:null,extend:B}),!1}const le=i_(q.code);return le.retry&&(j=S[(ie+1)%S.length]),gt.reqUserAccount(B.sid,{lts:G,success:!1,serverAddr:j,stringUid:B.string_uid,uid:q.uid,errorCode:le.desc,extend:B}),le.retry},(q,ie)=>q.code!==$.OPERATION_ABORTED&&(gt.reqUserAccount(B.sid,{lts:G,success:!1,serverAddr:j,stringUid:B.string_uid,uid:null,errorCode:q.code,extend:B}),j=S[(ie+1)%S.length],!0),D);if(Y.code!==0){const q=i_(Y.code);throw new Ee($.UNEXPECTED_RESPONSE,q.desc)}return Y}(f,e,t,n,s);return a==null||a.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw a==null||a.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function G$(e,t,n){const s=Z("ACCOUNT_REGISTER");let a=[];a=t.proxyServer?s.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):s.map(l=>"https://".concat(l,"/api/v1"));try{return await WF({referenceList:a,asyncMapHandler:f=>async function(m,_,S,b){const A=Date.now(),O={sid:S.sid,opid:10,appid:S.appId,string_uid:_};try{const D=await Zc(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:O,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(D.code!==0){const G=i_(D.code);throw new Ee($.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(D.uid<=0||D.uid>=Math.pow(2,32))throw new Ee($.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:A,url:m,req:O,uid:D.uid,elapse:Date.now()-A}}catch(D){throw D}}(f,e,t,n),closeFn:f=>f.code===$.OPERATION_ABORTED||f.code===$.UNEXPECTED_RESPONSE&&!f.data.retry})}catch(l){throw l}}async function H$(e,t,n){const s=Z("CDS_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),a=s.map(_=>function(S,b,A,O){const D=nn(),G={flag:64,cipher_method:0,features:Ql(Ql(Ql(Ql(Ql({install_id:iO(),device:D.name,system:D.os,system_general:navigator.userAgent,vendor:b.appId,version:ao,cname:b.cname,session_id:b.sid,proxyServer:b.proxyServer,sdk_type:P$.WEB_RTC,browser_name:D.name,browser_version:D.version,user_agent:navigator.userAgent,channel_name:b.cname},b.stringUid&&{string_uid:b.stringUid}),b.uid&&{uid:b.uid+""}),D.os&&{os_name:D.os}),D.osVersion&&{os_version:D.osVersion}),{},{detail:""})};return $c(()=>Zc(S,{data:G,timeout:1e3,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,B=>B.code!==$.OPERATION_ABORTED,O)}(_,e,t,n));let l=null,f=null,m={};try{l=await c_(a)}catch(_){if(_.code===$.OPERATION_ABORTED)throw _;f=_}if(a.forEach(_=>_.cancel()),gt.reportApiInvoke(e.sid,{name:Fi.REQUEST_CONFIG_DISTRIBUTE,options:{error:f,res:l}}).onSuccess(),l&&l.test_tags)try{m=function(_){if(!_.test_tags)return{};const S=_.test_tags,b=Object.keys(S),A={};return b.forEach(O=>{var D;const G=nr(D=O.slice(4)).call(D),B=JSON.parse(S[O]),j=B[1];A[G]={tag:B[0]||"",value:j}}),A}(l)}catch{}return m}async function $F(e,t){const n=Z("WEBCS_DOMAIN").concat(Z("WEBCS_DOMAIN_BACKUP_LIST")).map(s=>({url:"https://".concat(s,"/api/v2/transpond/webrtc?v=2"),areaCode:Ty(),serviceIds:[Ni.CHOOSE_SERVER,Ni.CLOUD_PROXY_FALLBACK]}));try{return await WF({referenceList:n,asyncMapHandler:a=>async function(l,f,m){let _,{url:S,areaCode:b,serviceIds:A}=l;const O=Date.now(),[D,G]=QO(f,b,A);let B=Di.networkState;try{B&&Di.networkState===ga.OFFLINE&&Di.onlineWaiter&&await Ye.race([Di.onlineWaiter,gs(Bi.maxRetryTimeout)]),B=Di.networkState;const{data:j,headers:Y}=await Zc(S,{data:D,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=Y.http3==="1"?1:-1,(ue=>{const oe=[];if(ue.response_body.forEach(ye=>{const Pe=ye.buffer.code;if(ye.uri===23&&Pe===0&&!ye.buffer.edges_services)if(ye.buffer.flag===4194310)ye.buffer.edges_services=[];else{const ze={error:new Ee($.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ue.detail[502]}),flag:ye.buffer.flag};oe.push(ze)}if(Pe!==0){const ze=i_(Pe),nt={error:new Ee($.CAN_NOT_GET_GATEWAY_SERVER,ze.desc,{desc:ze.desc,retry:ze.retry,csIp:ue.detail[502]}),flag:ye.buffer.flag};ye.buffer.flag===4194310?k.warning(nt.error.toString()):oe.push(nt)}}),oe.length)throw new Ee($.CAN_NOT_GET_GATEWAY_SERVER,oe.map(ye=>"flag: ".concat(ye.flag,", message: ").concat(ye.error.message)).join(" | "),{retry:!!oe.find(ye=>ye.error.data.retry),csIp:ue.detail[502],desc:[...new Set(oe.map(ye=>{var Pe;return ye==null||(Pe=ye.error)===null||Pe===void 0||(Pe=Pe.data)===null||Pe===void 0?void 0:Pe.desc}).filter(ye=>!!ye))]})})(j);const ie=Ey(j,Ni.CHOOSE_SERVER),le=Ey(j,Ni.CLOUD_PROXY_FALLBACK);return JO(ie),{gatewayInfo:VO(ie,S),proxyInfo:le,opid:G,requestTime:O,url:S,isHttp3:_,elapse:Date.now()-O}}catch(j){throw j}}(a,e,t),closeFn:a=>a.code===$.OPERATION_ABORTED||a.code===$.CAN_NOT_GET_GATEWAY_SERVER&&!a.data.retry})}catch(s){throw s}}async function zF(e,t,n,s){const a=Z("PROXY_SERVER_TYPE3"),l=(D,G,B)=>{let j=B||a;return Array.isArray(j)&&(j=G%2==0?a[1]:a[0]),"https://".concat(j,"/ap/?url=").concat(D)};let f=null;const m=[],_=async()=>{const D=Z("WEBCS_DOMAIN").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map((j,Y)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(j,"/api/v2/transpond/webrtc?v=2"),Y,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):l("".concat(j,"/api/v2/transpond/webrtc?v=2"),Y),{url:q,areaCode:Ty(),serviceIds:[Ni.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Ni.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Ni.CLOUD_PROXY:Ni.CLOUD_PROXY_FALLBACK]}}),G=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),B=await vy({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(k.debug("[".concat(e.clientId,"] Connect to choose_server:"),j.url),HF(j,e,t,n)),allFailedhandler:j=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:m});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},G),B},S=async()=>{if(await gs(1e3),f!==null)return f;const D=Z("WEBCS_DOMAIN_BACKUP_LIST").map((j,Y)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(j,"/api/v2/transpond/webrtc?v=2"),Y,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):l("".concat(j,"/api/v2/transpond/webrtc?v=2"),Y),{url:q,areaCode:Ty(),serviceIds:[Ni.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Ni.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Ni.CLOUD_PROXY:Ni.CLOUD_PROXY_FALLBACK]}}),G=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),B=await vy({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(k.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),j.url),HF(j,e,t,n)),allFailedhandler:j=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:m});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},G),B};let b,A,O;try{({gatewayInfo:b,proxyInfo:A,url:O}=await c_([_(),S()]))}catch(D){throw D[0]}if(m.length&&m.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),!b||!A)throw new Ee($.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=O,e.cloudProxyServer!=="disabled"&&Array.isArray(a)&&O){const D=/^https?:\/\/(.+?)(\/.*)?$/.exec(O)[1];We(a).call(a,D)&&(e.proxyServer=D,k.setProxyServer(D),gt.setProxyServer(D))}return f={gatewayInfo:b,proxyInfo:await SF(A,b.uid)},f}async function K$(e,t,n){const s=Z("UAP_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")),a=s.map(l=>function(f,m,_,S){const b={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:ao,cname:m.cname,uid:m.uid.toString(),requestId:XO,seq:XO};XO+=1;const A={service_name:"tele_channel",json_body:JSON.stringify(b)};return $c(async()=>{const O=await Zc(f,{data:A,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(O.code!==0){const G=new Ee($.UNEXPECTED_RESPONSE,"cross channel ap error, code"+O.code,{retry:!0});throw k.error(G.toString()),G}const D=JSON.parse(O.json_body);if(D.code!==200){const G=new Ee($.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(D.code,", reason: ").concat(D.reason));throw k.error(G.toString()),G}if(!D.servers||D.servers.length===0){const G=new Ee($.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw k.error(G.toString()),G}return{vid:D.vid,workerToken:D.workerToken,addressList:(Z("CHANNEL_MEDIA_RELAY_SERVERS")||D.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(Z("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,O=>!!(O.code!==$.OPERATION_ABORTED&&O.code!==$.UNEXPECTED_RESPONSE||O.data&&O.data.retry),S)}(l,e,t,n));try{const l=await c_(a);return a.forEach(f=>f.cancel()),l}catch(l){throw l[0]}}async function W$(e,t,n){let s=null;const a=[],l=async f=>{const m=Z(f?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return f&&(await gs(1e3),s!==null)?s:await vy({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(k.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(f?"backup":""," choose_server:"),_),function(S,b,A,O){const[D]=j$(b,[Ni.CHOOSE_SERVER]);let G=Di.networkState;return $c(async()=>{G&&Di.networkState===ga.OFFLINE&&Di.onlineWaiter&&await Ye.race([Di.onlineWaiter,gs(O&&O.maxRetryTimeout||Bi.maxRetryTimeout)]),G=Di.networkState;const B=await Zc(S,{data:D,cancelToken:A,headers:{"Content-Type":"multipart/form-data;"}},!0);return V$(B,S)},()=>!1,B=>B.code!==$.OPERATION_ABORTED&&(B.code===$.UPDATE_TICKET_FAILED?B.data.retry:(k.warning("[".concat(b.clientId,"] update ticket network error, retry"),B),!0)),O)}(_,e,t,n)),allFailedhandler:_=>{throw _[0]},promisesCollector:a})};try{return s=await c_([l(!1),l(!0)]),a.length&&a.forEach(f=>f.cancel&&typeof f.cancel=="function"&&f.cancel()),s}catch(f){throw f[0]}}function XF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function eD(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?XF(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XF(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}class Y$ extends ii{get isSuccess(){return!!this.configs}constructor(t,n){super(),W(this,"configs",void 0),W(this,"store",void 0),W(this,"joinInfo",void 0),W(this,"cancelToken",void 0),W(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),W(this,"interval",void 0),W(this,"mutex",void 0),W(this,"mutableParamsRead",!1),W(this,"configCache",{}),W(this,"limit_bitrate",void 0),this.mutex=new Ps("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),Z("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},Z("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,gt.reportApiInvoke(null,{options:void 0,name:Fi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:li.TRACER}).onSuccess(JSON.stringify(zc))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void k.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await H$(this.joinInfo,this.cancelToken,this.retryConfig),k.debug("[config-distribute] get config distribute",JSON.stringify(t));const s=function(a){var l;const f=HS(l=Object.keys(a).filter(S=>/^webrtc_ng_global_parameter/.test(S))).call(l);for(let S=0;S<f.length;S++)for(let b=f.length-1;b>S;b--){const A=f[b],O=a[A].value;if(typeof O.__priority=="number"){const D=O.__priority,G=f[b-1],B=a[G].value;if(typeof B.__priority=="number"){if(!(D>B.__priority))continue;{const j=A;f[b]=f[b-1],f[b-1]=j}}else{const j=A;f[b]=f[b-1],f[b-1]=j}}}const m=Date.now();let _={};return f.forEach(S=>{const b=a[S].value.__expires;b&&b<=m||(_[S]=a[S])}),_}(t);this.cacheGlobalParameterConfig(s),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=s}catch(s){const a=new Ee($.NETWORK_RESPONSE_ERROR,s);k.warning("[config-distribute] ".concat(a.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){oF(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(py.UPDATE_BITRATE_LIMIT,t):this.emit(py.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&eD({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},s=Object.keys(t),a=[];s.forEach(l=>{const f=t[l].value;n[l]=f;const m=f.__id;if(m&&this.configCache[l]&&this.configCache[l].__id===m)return;const _=f.__type,S=t[l].value,b=t[l].tag;let A=0;_?_===MM.REALTIME&&(A=1):Object.keys(S).some(O=>Object.prototype.hasOwnProperty.call(oO,O)||!DO()&&Object.prototype.hasOwnProperty.call(dR,O)?(A=1,!0):void 0),a.push({tag:b,isApplied:A,feature:l,params:JSON.stringify(f)})}),a.forEach(l=>{let{tag:f,feature:m,params:_,isApplied:S}=l;this.store.sessionId&&gt.abTest(this.store.sessionId,{intSucc:1,isApplied:S,tag:f,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){k.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(a){const l={};return Object.keys(a).forEach(f=>{const m=a[f].value,_=m.__expires,S=m.__type;Object.keys(m).forEach(b=>{b==="__id"||b==="__type"||b==="__priority"||b==="__expires"||Object.prototype.hasOwnProperty.call(l,b)||(l[b]=eD(eD({value:m[b]},_&&{expires:_}),S&&{type:S}))})}),l}(t);try{var s;const a=(s=n.LIMIT_BITRATE)===null||s===void 0?void 0:s.value;delete n.LIMIT_BITRATE,a&&oF(a)&&this.handleBitrateLimit(a),this.limit_bitrate=a,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(m){try{const _=Date.now();Object.keys(m).forEach(S=>{const{value:b,type:A,expires:O}=m[S];O&&O<=_||((A===MM.REALTIME||Object.prototype.hasOwnProperty.call(oO,S))&&(zc[S]=b,Hn[S]=b,k.debug("Update realtime parameters from config distribute",S,b)),A||DO()||!Object.prototype.hasOwnProperty.call(dR,S)||(zc[S]=b,Hn[S]=b,k.debug("Update gateway parameters from config distribute",S,b)))})}catch(_){k.error("Error update config immediately: ".concat(m),_.message)}}(n);const l=JSON.stringify(n),f=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",f),k.debug("Caching global parameters ".concat(l))}catch(a){k.error("Error caching global parameters:",a.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(s=>{if(s==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Hn,s)){const{value:a,expires:l}=t[s];if(l&&l<=n)return;(function(f,m){try{return typeof f=="object"&&typeof m=="object"&&JSON.stringify(f)===JSON.stringify(m)}catch{return!1}})(Hn[s],a)||(zc[s]=a,Hn[s]=a,this.emit(py.UPDATE_CLIENT_ROLE_OPTIONS,a),k.debug("Updating client role options: ".concat(JSON.stringify(a))))}})}catch(n){k.error("Error handling global parameter config:",n.message)}}}class q$ extends ii{constructor(){super(...arguments),W(this,"resultStorage",new Map)}setLocalAudioStats(t,n,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(s,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(s,n))}setLocalVideoStats(t,n,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(s,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(s,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(s))}setRemoteAudioStats(t,n){const s=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const s=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(n))}record(t,n,s){if(Z("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const a=this.resultStorage.get(t);if(a&&(a.result.push(s),a.result.length>=5)){var l;const f=We(l=a.result).call(l,!0);a.isPrevNormal&&!f&&this.emit("exception",JF[t],t,n),!a.isPrevNormal&&f&&this.emit("exception",JF[t]+2e3,t+"_RECOVER",n),a.isPrevNormal=f,a.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof Hi&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let s=null;n._encoderConfig&&n._encoderConfig.frameRate&&(s=Ea(n._encoderConfig.frameRate));const a=t.captureFrameRate;return!s||!a||!(s>10&&a<5||s<10&&s>=5&&a<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof Hi&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const JF={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Us=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const s=n[n.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const s=n[n.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function QF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function dm(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QF(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QF(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}class by{constructor(t){W(this,"store",void 0),W(this,"onStatsException",void 0),W(this,"onUploadPublishDuration",void 0),W(this,"onStatsChanged",void 0),W(this,"localStats",new Map),W(this,"remoteStats",new Map),W(this,"updateStatsInterval",void 0),W(this,"trafficStats",void 0),W(this,"trafficStatsPeerList",[]),W(this,"uplinkStats",void 0),W(this,"exceptionMonitor",void 0),W(this,"p2pChannel",void 0),W(this,"scalabilityMode",lR.L1T1),W(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new q$,this.exceptionMonitor.on("exception",(n,s,a)=>{this.onStatsException&&this.onStatsException(n,s,a)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Le.LocalAudioTrack)||dm({},hO)}getLocalVideoTrackStats(){return this.localStats.get(Le.LocalVideoTrack)||dm({},fO)}getRemoteAudioTrackStats(t){const n=(l,f)=>{if(!this.trafficStats)return f;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===l);return m&&(f.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),f},s={};if(t){var a;const l=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.audioStats;l&&(s[t]=n(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[f,{audioStats:m}]=l;m&&(s[f]=n(f,m))});return s}getRemoteNetworkQualityStats(t){const n={};if(t){var s;const a=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.networkStats;a&&(n[t]=a)}else Array.from(this.remoteStats.entries()).forEach(a=>{let[l,{networkStats:f}]=a;f&&(n[l]=f)});return n}getRemoteVideoTrackStats(t){const n=(l,f)=>{if(!this.trafficStats)return f;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===l);return m&&(f.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),f},s={};if(t){var a;const l=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.videoStats;l&&(s[t]=n(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[f,{videoStats:m}]=l;m&&(s[f]=n(f,m))});return s}getRTCStats(){let t=0,n=0,s=0,a=0;const l=this.localStats.get(Le.LocalAudioTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate);const f=this.localStats.get(Le.LocalVideoTrack);f&&(t+=f.sendBytes,n+=f.sendBitrate);const m=this.localStats.get(Le.LocalVideoLowTrack);m&&(t+=m.sendBytes,n+=m.sendBitrate),this.remoteStats.forEach(S=>{let{audioStats:b,videoStats:A}=S;b&&(s+=b.receiveBytes,a+=b.receiveBitrate),A&&(s+=A.receiveBytes,a+=A.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:n,SendBytes:t,RecvBytes:s,RecvBitrate:a,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var s;const a=(s=this.p2pChannel)===null||s===void 0?void 0:s.getRemoteMedia(n.peer_uid),l=a!=null&&a.videoSSRC?Us.measureFromSubscribeStart(this.store.clientId,a.videoSSRC):0,f=a!=null&&a.audioSSRC?Us.measureFromSubscribeStart(this.store.clientId,a.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,l>f?l:f),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&k.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,s){if(!t)return!1;const a=!!s&&n.framesDecodeFreezeTime>s.framesDecodeFreezeTime,l=!s||n.framesDecodeCount>s.framesDecodeCount;return a||!l}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[s,a]=n;switch(s){case Le.LocalVideoTrack:case Le.LocalVideoLowTrack:{const f=a,m=dm({},fO),_=t.getStats(),S=t.getLocalMedia(s);if(_){const b=_.videoSend.find(A=>A.ssrc===(S==null?void 0:S.ssrcs[0].ssrcId));if(b){const A=t.getLocalVideoSize(),O=t.getEncoderConfig(Le.LocalVideoTrack);b.codec!=="H264"&&b.codec!=="H265"&&b.codec!=="VP8"&&b.codec!=="VP9"&&b.codec!=="AV1X"&&b.codec!=="AV1"||(m.codecType=b.codec),m.sendBytes=b.bytes,m.sendBitrate=f?8*Math.max(0,m.sendBytes-f.sendBytes):0,b.inputFrame?(m.captureFrameRate=b.inputFrame.frameRate,m.captureResolutionHeight=b.inputFrame.height,m.captureResolutionWidth=b.inputFrame.width):A&&(m.captureResolutionWidth=A.width,m.captureResolutionHeight=A.height),b.sentFrame?(m.sendFrameRate=b.sentFrame.frameRate,m.sendResolutionHeight=b.sentFrame.height,m.sendResolutionWidth=b.sentFrame.width):A&&(m.sendResolutionWidth=A.width,m.sendResolutionHeight=A.height),b.avgEncodeMs&&(m.encodeDelay=b.avgEncodeMs),O&&O.bitrateMax&&(m.targetSendBitrate=1e3*O.bitrateMax),m.sendPackets=b.packets,m.sendPacketsLost=b.packetsLost,m.sendJitterMs=b.jitterMs,m.sendRttMs=b.rttMs,m.totalDuration=f?f.totalDuration+1:1,m.totalFreezeTime=f?f.totalFreezeTime:0,this.isLocalVideoFreeze(b)&&(m.totalFreezeTime+=1),b.scalabilityMode&&this.scalabilityMode!==b.scalabilityMode&&(k.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(b.scalabilityMode)),this.scalabilityMode=b.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var l;this.localStats.set(s,m),((f==null?void 0:f.sendResolutionWidth)!==m.sendResolutionWidth||(f==null?void 0:f.sendResolutionHeight)!==m.sendResolutionHeight)&&((l=this.onStatsChanged)===null||l===void 0||l.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&S&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,S.track,m);break}case Le.LocalAudioTrack:{const f=a,m=dm({},hO),_=t.getStats(),S=t.getLocalMedia(s);if(_){const b=_.audioSend.find(A=>A.ssrc===(S==null?void 0:S.ssrcs[0].ssrcId));if(b){if(b.codec!=="opus"&&b.codec!=="aac"&&b.codec!=="PCMU"&&b.codec!=="PCMA"&&b.codec!=="G722"||(m.codecType=b.codec),b.inputLevel)m.sendVolumeLevel=Math.round(32767*b.inputLevel);else{const A=t.getLocalAudioVolume();A&&(m.sendVolumeLevel=Math.round(32767*A))}m.sendBytes=b.bytes,m.sendPackets=b.packets,m.sendPacketsLost=b.packetsLost,m.sendJitterMs=b.jitterMs,m.sendRttMs=b.rttMs,m.sendBitrate=f?8*Math.max(0,m.sendBytes-f.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Le.LocalAudioTrack,m),m&&S&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,S.track,m);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var s,a;let[l,{videoStats:f,audioStats:m,videoPcStats:_}]=n;const S=m,b=f,A=_,O=dm({},qM),D=dm({},$M),G=dm({},Nq),{audioTrack:B,videoTrack:j,audioSSRC:Y,videoSSRC:q}=t.getRemoteMedia(l);let ie;ie=this.store.useP2P?t.getStats(!0):t.getStats();const le=(s=ie)===null||s===void 0?void 0:s.audioRecv.find(Pe=>Pe.ssrc===Y),ue=(a=ie)===null||a===void 0?void 0:a.videoRecv.find(Pe=>Pe.ssrc===q),oe=this.trafficStats&&this.trafficStats.peer_delay.find(Pe=>Pe.peer_uid===l);if(le&&(le.codec!=="opus"&&le.codec!=="aac"&&le.codec!=="PCMU"&&le.codec!=="PCMA"&&le.codec!=="G722"||(O.codecType=le.codec),le.outputLevel?O.receiveLevel=Math.round(32767*le.outputLevel):B&&(O.receiveLevel=Math.round(32767*B.getVolumeLevel())),O.receiveBytes=le.bytes,O.receivePackets=le.packets,O.receivePacketsLost=le.packetsLost,O.receivePacketsDiscarded=le.packetsDiscarded,O.packetLossRate=O.receivePacketsLost/(O.receivePackets+O.receivePacketsLost),O.receiveBitrate=S?8*Math.max(0,O.receiveBytes-S.receiveBytes):0,O.totalDuration=S?S.totalDuration+1:1,O.totalFreezeTime=S?S.totalFreezeTime:0,O.freezeRate=O.totalFreezeTime/O.totalDuration,O.receiveDelay=le.jitterBufferMs,O.totalDuration>10&&by.isRemoteAudioFreeze(B)&&(O.totalFreezeTime+=1)),ue){var ye;ue.codec!=="H264"&&ue.codec!=="H265"&&ue.codec!=="VP8"&&ue.codec!=="VP9"&&ue.codec!=="AV1X"&&ue.codec!=="AV1"||(D.codecType=ue.codec),D.receiveBytes=ue.bytes,D.receiveBitrate=b?8*Math.max(0,D.receiveBytes-b.receiveBytes):0,D.decodeFrameRate=ue.decodeFrameRate<0?0:ue.decodeFrameRate,D.renderFrameRate=ue.decodeFrameRate<0?0:ue.decodeFrameRate,ue.outputFrame&&(D.renderFrameRate=ue.outputFrame.frameRate),ue.receivedFrame?(D.receiveFrameRate=ue.receivedFrame.frameRate,D.receiveResolutionHeight=ue.receivedFrame.height,D.receiveResolutionWidth=ue.receivedFrame.width):j&&(D.receiveResolutionHeight=j._videoHeight||0,D.receiveResolutionWidth=j._videoWidth||0),ue.framesRateFirefox!==void 0&&(D.receiveFrameRate=Math.round(ue.framesRateFirefox)),D.receivePackets=ue.packets,D.receivePacketsLost=ue.packetsLost,D.packetLossRate=D.receivePacketsLost/(D.receivePackets+D.receivePacketsLost);const Pe=b?b.totalFreezeTime:0,ze=b?b.totalDuration:0;D.totalDuration=b?b.totalDuration+1:1,D.totalFreezeTime=(ye=ue.totalFreezesDuration)!==null&&ye!==void 0?ye:Pe||0,D.receiveDelay=ue.jitterBufferMs||0;const nt=!!q&&t.getRemoteVideoIsReady(q);ue.totalFreezesDuration===void 0&&j&&nt&&by.isRemoteVideoFreeze(j,ue,A)&&(D.totalFreezeTime+=1),D.freezeRate=Math.max(0,Math.min((D.totalFreezeTime-Pe)/(D.totalDuration-ze),1))}oe&&(O.end2EndDelay=oe.B_ad,D.end2EndDelay=oe.B_vd,O.transportDelay=oe.B_ed,D.transportDelay=oe.B_ed,O.currentPacketLossRate=oe.B_ealr4/100,D.currentPacketLossRate=oe.B_evlr4/100,G.uplinkNetworkQuality=oe.B_punq?oe.B_punq:0,G.downlinkNetworkQuality=oe.B_pdnq?oe.B_pdnq:0),this.remoteStats.set(l,{audioStats:O,videoStats:D,videoPcStats:ue,networkStats:G}),B&&this.exceptionMonitor.setRemoteAudioStats(B,O),j&&this.exceptionMonitor.setRemoteVideoStats(j,D)})}}class ZF{constructor(){W(this,"destChannelMediaInfos",new Map),W(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){rF(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){rF(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){OR(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function eB(e){if(!(e instanceof ZF))return new Ee($.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new Ee($.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new Ee($.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Yh{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){W(this,"uid",void 0),W(this,"_uintid",void 0),W(this,"_trust_in_room_",!0),W(this,"_trust_audio_enabled_state_",!0),W(this,"_trust_video_enabled_state_",!0),W(this,"_trust_audio_mute_state_",!0),W(this,"_trust_video_mute_state_",!0),W(this,"_audio_muted_",!1),W(this,"_video_muted_",!1),W(this,"_audio_enabled_",!0),W(this,"_video_enabled_",!0),W(this,"_audio_added_",!1),W(this,"_video_added_",!1),W(this,"_is_pre_created",!1),W(this,"_video_pre_subscribed",!1),W(this,"_audio_pre_subscribed",!1),W(this,"_trust_video_stream_added_state_",!0),W(this,"_trust_audio_stream_added_state_",!0),W(this,"_audioTrack",void 0),W(this,"_videoTrack",void 0),W(this,"_dataChannels",[]),W(this,"_audioSSRC",void 0),W(this,"_videoSSRC",void 0),W(this,"_audioOrtc",void 0),W(this,"_videoOrtc",void 0),W(this,"_cname",void 0),W(this,"_rtxSsrcId",void 0),W(this,"_videoMid",void 0),W(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function tB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function nB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tB(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}const Ry="9",iB=4e4;function sB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function pu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sB(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var l_=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(l_||{});const HR=new Map;function rB(e,t,n,s){let{scale:a}=e;if(a===0&&s===l_.UP||a>=t.length-1&&s===l_.DOWN)return e;let l=pu(pu({},e),{},{scale:s===l_.DOWN?++a:--a});switch(n){case"maintain-framerate":l=pu(pu({},l),t[a].motion);break;case"maintain-resolution":l=pu(pu({},l),t[a].detail);break;case"balanced":l=pu(pu({},l),t[a].balanced)}return l}function aB(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:oB(t)};HR.set(e,n)}else HR.delete(e)}function oB(e){const t=pu({},e),{bitrateMax:n,frameRate:s,scaleResolutionDownBy:a,bitrateMin:l}=t,{MIN_FRAME_RATE:f,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:S,BITRATE_MAX_THRESHOLD:b,BWE_SCALE_UP_THRESHOLD:A,BWE_SCALE_DOWN_THRESHOLD:O,PERF_SCALE_DOWN_THRESHOLD:D,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:B,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:Y,MOTION_RESOLUTION_FACTOR:q,MOTION_BITRATE_FACTOR:ie,DETAIL_FRAMERATE_FACTOR:le,DETAIL_BITRATE_FACTOR:ue}=rO,oe=Math.min(t.frameRate,m),ye=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(O,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(D,1)*oe),fps_up:s},balanced:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:n,bitrateMin:l},motion:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:n,bitrateMin:l},detail:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:n,bitrateMin:l}}];for(let Pe=1;Pe<=_;Pe++){const ze={bwe_up:Math.round(Math.pow(A,Pe)*n),bwe_down:Math.round(Math.pow(O,Pe+1)*n),fps_up:Math.round(Math.pow(G,Pe)*oe),fps_down:Math.round(Math.pow(D,Pe+1)*oe)},nt={scaleResolutionDownBy:a/Math.pow(Y,Pe),frameRate:Math.max(Math.round(Math.pow(j,Pe)*s),f),bitrateMax:Math.max(Math.round(Math.pow(B,Pe)*n),b),bitrateMin:Math.max(Math.round(Math.pow(B,Pe)*l),S)},$t={scaleResolutionDownBy:a/Math.pow(q,Pe),frameRate:s,bitrateMax:Math.max(Math.round(Math.pow(ie,Pe)*n),b),bitrateMin:Math.max(Math.round(Math.pow(ie,Pe)*l),S)},zt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(le,Pe)*s),f),bitrateMax:Math.max(Math.round(Math.pow(ue,Pe)*n),b),bitrateMin:Math.max(Math.round(Math.pow(ue,Pe)*l),S)};ye.push({scale:Pe,threshold:ze,balanced:nt,motion:$t,detail:zt})}return ye}function $$(e,t,n,s,a,l){const f=HR.get(e)||{overUse:0,underUse:0,adaptationList:oB(a)},{adaptationList:m}=f;HR.set(e,f);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:S}=rO,{scale:b}=s;let A,O;return typeof t=="number"&&t>0&&function(D,G,B,j){if(G>=B.length)return!1;let{threshold:{fps_down:Y}}=B[G];return Z("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(Y=B[0].threshold.fps_down),D<Y}(t,b,m,l)&&(f.overUse++,O=cy.CPU,f.overUse>_)||typeof n=="number"&&n>0&&function(D,G,B){if(G>=B.length)return!1;const{threshold:{bwe_down:j}}=B[G];return D<j}(n,b,m)&&(f.overUse++,O=cy.BANDWIDTH,f.overUse>_)?(f.overUse=0,f.underUse=0,A=rB(s,m,l,l_.DOWN),[A,O]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(D,G,B,j){if(G===0)return;let{threshold:{fps_up:Y}}=B[G];return Z("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(Y=B[1].threshold.fps_up),D>Y}(t,b,m,l)&&function(D,G,B){if(G===0)return;const{threshold:{bwe_up:j}}=B[G];return D>j}(n,b,m)&&(f.underUse++,f.underUse>S&&(f.overUse=0,f.underUse=0,A=rB(s,m,l,l_.UP),A.scale===0&&(O=cy.NONE))),[A,O])}function cB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function tD(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cB(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function z$(e){var t;return!!Z("ENABLE_AG_ADAPTATION")&&!!(e instanceof vO||We(t=e._hints).call(t,kn.CUSTOM_TRACK))&&(!!Z("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const s=nn();if(s.os!==Qi.IOS||!s.osVersion)return!1;const a=s.osVersion.split(".");return Number(a[0])>=n}(14)&&sM(17,4)||iM(14)&&rM(17,4,!0)))}const KR=new Map;function WR(e,t){const n=KR.get(e);if(n){const{timer:s}=n;window.clearTimeout(s),KR.delete(e)}t.qualityLimitationReason=cy.NONE,aB(e)}function X$(e,t){var n;let s;switch(t){case Le.LocalAudioTrack:s=En.Audio;break;case Le.LocalVideoTrack:s=We(n=e._hints).call(n,kn.SCREEN_TRACK)?En.Screen:En.High;break;case Le.LocalVideoLowTrack:s=En.Low}return s}function nD(e){const t=on();if(e.some(n=>n._bypassWebAudio))throw new ve($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new ve($.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function iD(e,t){nD(e);const n=new Hi;return e.forEach(s=>n.addAudioTrack(s)),n}const J$=!on().supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&su();function YR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return J$?(n={spec:t,store:e},hu("PlanBConnection").create(n)):new Zl(t,e)}function sD(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function lB(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(ry(e.turnServer.servers))return!1;if(Z("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var en;function dB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function el(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dB(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let Zl=(en=class Im extends lF{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return We(n=Object.keys(uR)).call(n,t)}))]}constructor(t,n){super(t,n),W(this,"id",Pn(5,"connection-")),W(this,"store",void 0),W(this,"peerConnection",void 0),W(this,"forceTurn",!1),W(this,"remoteSDP",void 0),W(this,"initialOffer",void 0),W(this,"transportEventReceiver",void 0),W(this,"statsFilter",void 0),W(this,"extension",{useXR:Z("USE_XR")}),W(this,"localCapabilities",void 0),W(this,"remoteCodecs",void 0),W(this,"localCandidateCount",0),W(this,"allCandidatesReceived",!1),W(this,"isPreallocation",!1),W(this,"preSSRCMap",new Map),W(this,"dataStreamChannelMap",new Map),W(this,"establishPromise",void 0),W(this,"recoveredDataChannelIds",[]),W(this,"currentDataChannelId",1),W(this,"supportAV1RtpSpec",!1),W(this,"mutex",void 0),W(this,"qualityLimitationReason",cy.NONE),W(this,"isFirstConnected",!1),this.store=n,this.forceTurn=lB(t),this.mutex=new Ps("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Im.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=nO(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,oi()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){const n=this.preSSRCMap.get(t);if(n!==void 0){const s=this.peerConnection.getTransceivers().find(a=>a.mid===n);if(s)return{transceiver:s,track:s.receiver.track,id:n}}}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void k.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const s=await this.peerConnection.createOffer(),a=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else k.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Kh(s.sdp),l=await OF({filterRTX:!Z("USE_PUB_RTX")&&!Z("USE_SUB_RTX"),filterVideoFec:Z("FILTER_VIDEO_FEC"),filterAudioFec:Z("FILTER_AUDIO_FEC"),filterVideoCodec:Z("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=FR(l),this.initialOffer=s,Z("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:lR.L1T3}]});const S=await _.createOffer();if(!S.sdp)return void _.close();const b=Yr(S.sdp).mediaDescriptions[0];if(!b)return;const A=b.attributes.extmaps.find(O=>O.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),A}catch{return}}();var t;m&&(this.supportAV1RtpSpec=!0,(t=l.send)===null||t===void 0||t.videoExtensions.push(m))}let f;return s.sdp&&xF(s.sdp)&&(f=di(l),(n=f).send&&(s_(at.VIDEO,n.send.videoExtensions),s_(at.AUDIO,n.send.audioExtensions)),n.recv&&(s_(at.VIDEO,n.recv.videoExtensions),s_(at.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(s_(at.VIDEO,n.sendrecv.videoExtensions),s_(at.AUDIO,n.sendrecv.audioExtensions))),el(el({},a),{},{rtpCapabilities:f||l,offerSDP:s.sdp})}catch(s){throw new ve($.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&xF(this.initialOffer.sdp)&&(n=t.rtpCapabilities,s=this.localCapabilities,n.send&&(kR(at.VIDEO,n.send.videoExtensions,s.send.videoExtensions),kR(at.AUDIO,n.send.audioExtensions,s.send.audioExtensions)),n.recv&&(kR(at.VIDEO,n.recv.videoExtensions,s.recv.videoExtensions),kR(at.AUDIO,n.recv.audioExtensions,s.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return di(this._localCapabilities)}get rtpCapabilities(){return di(this._rtpCapabilities)}get candidates(){return di(this._candidates)}get iceParameters(){return di(this._iceParameters)}get dtlsParameters(){return di(this._dtlsParameters)}constructor(S){let b=arguments.length>1&&arguments[1]!==void 0&&arguments[1];W(this,"sessionDesc",void 0),W(this,"_localCapabilities",void 0),W(this,"_rtpCapabilities",void 0),W(this,"_candidates",void 0),W(this,"_originCandidates",void 0),W(this,"_iceParameters",void 0),W(this,"_isUseExtmapAllowMixed",void 0),W(this,"_dtlsParameters",void 0),W(this,"setup",void 0),W(this,"currentMidIndex",void 0),W(this,"cname",void 0),W(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=b,S=di(S);const{iceParameters:A,dtlsParameters:O,candidates:D,rtpCapabilities:G,setup:B,localCapabilities:j,cname:Y}=S;this._rtpCapabilities=G,this._candidates=D,this._originCandidates=di(D),this._iceParameters=A,this._dtlsParameters=O,this._localCapabilities=j,this.setup=B,this.cname=Y,this.sessionDesc=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(S){const b=this.candidates,A=this.dtlsParameters,O=this.iceParameters,D=this.rtpCapabilities.send;let G=this.sessionDesc.mediaDescriptions.length-1;for(let B=1;B<S;B++){const j=2*B+2e4,Y=2*B+iB,{ssrcs:q,ssrcGroups:ie}=lm([{ssrcId:j}],this.cname),{ssrcs:le,ssrcGroups:ue}=lm([{ssrcId:Y,rtx:Z("USE_SUB_RTX")?Y+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Ry,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.videoCodecs.map(oe=>oe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:O.iceUfrag,icePwd:O.icePwd,unrecognized:[],candidates:b,extmaps:D.videoExtensions,fingerprints:A.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:le,ssrcGroups:ue,rtcpFeedbackWildcards:[],payloads:D.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Ry,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.audioCodecs.map(oe=>oe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:O.iceUfrag,icePwd:O.icePwd,unrecognized:[],candidates:b,extmaps:D.audioExtensions,fingerprints:A.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:q,ssrcGroups:ie,rtcpFeedbackWildcards:[],payloads:D.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Bh(this.sessionDesc)}send(S,b,A,O){const{ssrcs:D,ssrcGroups:G}=lm(b,this.cname,Z("SYNC_GROUP")?A:void 0),B=this.findPreloadMediaDesc(D);if(B){if(oi()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,B.attributes.mid),O&&(O.twcc||O.remb)){const j=this.sessionDesc.mediaDescriptions.indexOf(B);return this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(B,O),{mid:B.attributes.mid,needExchangeSDP:!0}}return{mid:B.attributes.mid,needExchangeSDP:!1}}{const j=this.findAvailableMediaIndex(S,D);let Y;return j===-1||j===1&&(Cs()||function(){const q=nn();return!(q.name!==ln.CHROME||!q.osVersion)&&Number(q.version)<=90}()||Z("ENABLE_ENCODED_TRANSFORM")&&iu())||j===0&&Z("USE_SUB_RTX")||aM()?(Y=this.createOrRecycleSendMedia(S,D,G,"sendonly",O),this.updateBundleMids()):(Y=di(this.sessionDesc.mediaDescriptions[j]),Y.attributes.direction="sendonly",Y.attributes.ssrcs=D,Y.attributes.ssrcGroups=G,this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(Y,O)),oi()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,Y.attributes.mid),{mid:Y.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:S,needExchangeSDP:b}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:S.attributes.mid,needExchangeSDP:b}}batchSend(S){const b=S.map(D=>{let{kind:G,ssrcMsg:B,mslabel:j}=D;return this.send(G,B,j)}),A=[];let O=!1;return b.forEach(D=>{let{mid:G,needExchangeSDP:B}=D;B&&(O=!0),A.push(G)}),{mids:A,needExchangeSDP:O}}stopSending(S){const b=this.sessionDesc.mediaDescriptions.filter(A=>A.attributes.mid&&S.indexOf(A.attributes.mid)!==-1);if(b.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");b.forEach(A=>{A.attributes.mid==="0"||oi()||aM()?A.attributes.ssrcs=[]:(A.attributes.ssrcs=[],A.attributes.direction="inactive",A.media.port="0")}),this.updateBundleMids()}mute(S){const b=this.sessionDesc.mediaDescriptions.find(A=>A.attributes.mid===S);if(!b)throw new Error("mediaDescription not found with ".concat(S," in remote SDP when calling RemoteSDP.mute."));b.attributes.direction="inactive"}unmute(S){const b=this.sessionDesc.mediaDescriptions.find(A=>A.attributes.mid===S);if(!b)throw new Error("mediaDescription not found with ".concat(S," in remote SDP when calling RemoteSDP.unmute."));b.attributes.direction="sendonly"}muteRemote(S){const b=this.sessionDesc.mediaDescriptions.filter(A=>We(S).call(S,A.attributes.mid||""));if(b.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");b.forEach(A=>{A.attributes.direction="inactive"})}unmuteRemote(S){const b=this.sessionDesc.mediaDescriptions.filter(A=>We(S).call(S,A.attributes.mid||""));if(b.length!==S.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");b.forEach(A=>{A.attributes.direction="recvonly"})}receive(S,b,A,O){S.forEach((D,G)=>{this.createOrRecycleRecvMedia(D,[],"recvonly",b,A,O[G])}),this.updateBundleMids()}stopReceiving(S){const b=this.sessionDesc.mediaDescriptions.filter(A=>S.indexOf(A.attributes.mid)!==-1);if(b.length!==S.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");b.forEach(A=>{A.media.port="0",A.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(S){const b=this.sessionDesc||Yr((A=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(A?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var A;this._rtpCapabilities=S;const O=this.rtpCapabilities.send,D=this.localCapabilities.send;for(const G of b.mediaDescriptions){if(G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video"){if(O.videoCodecs.length===0){const B=D.videoCodecs.filter(j=>{var Y,q;return(Y=j.rtpMap)===null||Y===void 0?void 0:We(q=Y.encodingName.toLowerCase()).call(q,"vp8")})||[D.videoCodecs[0]];G.media.fmts=B.map(j=>j.payloadType.toString(10)),G.attributes.payloads=B,G.attributes.extmaps=[]}else if(G.media.fmts=O.videoCodecs.map(B=>B.payloadType.toString(10)),G.attributes.payloads=O.videoCodecs,G.attributes.extmaps=O.videoExtensions,Z("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:B,ssrcGroups:j}=lm([{ssrcId:iB,rtx:Z("USE_SUB_RTX")?40001:void 0}],this.cname);G.attributes.ssrcs=B,G.attributes.ssrcGroups=j}}if(G.media.mediaType==="audio"){if(O.audioCodecs.length===0){const B=D.audioCodecs.filter(j=>{var Y,q;return(Y=j.rtpMap)===null||Y===void 0?void 0:We(q=Y.encodingName.toLowerCase()).call(q,"opus")})||[D.audioCodecs[0]];G.media.fmts=B.map(j=>j.payloadType.toString(10)),G.attributes.payloads=B,G.attributes.extmaps=[]}else if(G.media.fmts=O.audioCodecs.map(B=>B.payloadType.toString(10)),G.attributes.payloads=O.audioCodecs,G.attributes.extmaps=O.audioExtensions,a_(G),Z("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:B,ssrcGroups:j}=lm([{ssrcId:2e4}],this.cname);G.attributes.ssrcs=B,G.attributes.ssrcGroups=j}}}return this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(S){const b=this._originCandidates.filter(O=>O.transport==="udp"),A=[];if(b.forEach(O=>{A.push(nB(nB({},O),{},{foundation:"tcpcandidate",priority:Number(O.priority)-1+"",transport:"tcp",port:Number(O.port)+90+""}))}),b.length!==0){switch(S){case Ms.TCP_RELAY:this._candidates=A;break;case Ms.UDP_TCP_RELAY:case Ms.RELAY:this._candidates=[...b,...A];break;default:this._candidates=b}for(const O of this.sessionDesc.mediaDescriptions)O.attributes.candidates=this.candidates}}restartICE(S){S=di(S),this._iceParameters=S,this.sessionDesc.mediaDescriptions.forEach(b=>{b.attributes.iceUfrag=S.iceUfrag,b.attributes.icePwd=S.icePwd})}predictReceivingMids(S){const b=[];for(let A=0;A<S;A++)b.push((this.currentMidIndex+A+1).toString(10));return b}findAvailableMediaIndex(S,b){return this.sessionDesc.mediaDescriptions.findIndex(A=>{const O=A.media.mediaType===S&&A.media.port!=="0"&&(A.attributes.direction==="sendonly"||A.attributes.direction==="sendrecv")&&A.attributes.ssrcs.length===0;if(oi()){if(O){const D=this.firefoxSsrcMidMap.get(b[0].ssrcId);return!(D||A.attributes.mid!=="0"&&A.attributes.mid!=="1")||!(!D||D!==A.attributes.mid)}return!1}return O})}createOrRecycleDataChannel(){for(const A of this.sessionDesc.mediaDescriptions)if(A.media.mediaType==="application")return{mediaDesc:A,needExchangeSDP:!1};this.currentMidIndex+=1;const S="".concat(this.currentMidIndex),b={media:{mediaType:"application",port:Ry,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(S),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(b),{mediaDesc:b,needExchangeSDP:!0}}createOrRecycleRecvMedia(S,b,A,O,D,G){const B=S._mediaStreamTrack.kind,j=this.rtpCapabilities.recv,Y=Sy(B,j,this.localCapabilities.send,B===at.VIDEO?O:D),q=B===at.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const ie="".concat(this.currentMidIndex);let le={media:{mediaType:B,port:Ry,protos:["UDP","TLS","RTP","SAVPF"],fmts:Y.map(oe=>oe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:q,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:b,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:Y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:A,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ie)}};le=this.mungRecvMediaDsec(le,S,G);const ue=this.findFirstClosedMedia(B);if(ue){const oe=this.sessionDesc.mediaDescriptions.indexOf(ue);this.sessionDesc.mediaDescriptions[oe]=le}else this.sessionDesc.mediaDescriptions.push(le);return le}updateRemoteCodec(S,b,A){const O=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(le=>le.rtpMap&&le.rtpMap.encodingName.toLowerCase()||"").filter(le=>{var ue;return We(ue=Object.keys(uR)).call(ue,le)}))],D=new Set(b);if(O.every(le=>D.has(le)))return k.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(b)),!1;const G=this._rtpCapabilities.recv.videoCodecs.filter(le=>b.some(ue=>{var oe;return We(oe=le.rtpMap&&le.rtpMap.encodingName.toLowerCase()||"").call(oe,ue)}));if(G.length===0)return k.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(O," codecs: ").concat(b)),!1;const B=[...new Set(G.map(le=>le.rtpMap&&le.rtpMap.encodingName.toLowerCase()||""))];let j;if(k.debug("updateRemoteCodec, from ".concat(O," to ").concat(B)),S.length===0)j=this.sessionDesc.mediaDescriptions.filter(le=>le.media.mediaType==="video"&&le.attributes.direction==="recvonly");else if(j=this.sessionDesc.mediaDescriptions.filter(le=>le.attributes.mid&&We(S).call(S,le.attributes.mid)&&le.attributes.direction==="recvonly"),j.length!==S.length)return k.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(S,", codecs: ").concat(b)),!1;if(Z("USE_PUB_RTX")||Z("USE_SUB_RTX")){const le=KO(G,this.rtpCapabilities.recv.videoCodecs);G.push(...le)}this._rtpCapabilities.recv.videoCodecs=G;const Y=this.localCapabilities.send,q=this.rtpCapabilities.recv,ie=Sy(at.VIDEO,q,Y,A);return j.forEach(le=>{const ue=ie.map(oe=>oe.payloadType.toString(10));k.debug("updateRemoteCodec mid: ".concat(le.attributes.mid,", from"),le.attributes.payloads,"to",ie),le.attributes.payloads=ie,le.media.fmts=ue}),!0}createOrRecycleSendMedia(S,b,A,O,D){const G=this.rtpCapabilities.send,B=S===at.VIDEO?G.videoCodecs:G.audioCodecs,j=S===at.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const Y="".concat(this.currentMidIndex);let q={media:{mediaType:S,port:Ry,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.map(le=>le.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:b,ssrcGroups:A,rtcpFeedbackWildcards:[],payloads:B,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:O,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};q=this.mungSendMediaDesc(q,D);const ie=this.findFirstClosedMedia(S);if(ie){const le=this.sessionDesc.mediaDescriptions.indexOf(ie);this.sessionDesc.mediaDescriptions[le]=q}else this.sessionDesc.mediaDescriptions.push(q);return q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(S=>S.media.port!=="0").map(S=>S.attributes.mid)}mungRecvMediaDsec(S,b,A){const O=di(S);return GO(O),r_(O,b),HO(O,b),IF(O),UR(O,A,this.localCapabilities.send),O}mungSendMediaDesc(S,b){const A=di(S);return UR(A,b,this.localCapabilities.recv),a_(A),A}updateRecvMedia(S,b){const A=this.sessionDesc.mediaDescriptions.findIndex(O=>O.attributes.mid===S);if(A!==-1){const O=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[A],b);this.sessionDesc.mediaDescriptions[A]=O}}bumpMid(S){this.currentMidIndex+=S}findFirstClosedMedia(S){return this.sessionDesc.mediaDescriptions.find(b=>oi()?b.media.port==="0"&&b.media.mediaType===S:b.media.port==="0")}findPreloadMediaDesc(S){return this.sessionDesc.mediaDescriptions.find(b=>{var A;return((A=b.attributes)===null||A===void 0||(A=A.ssrcs[0])===null||A===void 0?void 0:A.ssrcId)===S[0].ssrcId})}getSSRC(S){var b;return(b=this.sessionDesc.mediaDescriptions.find(A=>A.attributes.mid===S))===null||b===void 0?void 0:b.attributes.ssrcs}}(el(el({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const a=this.remoteSDP.toString(),l=NF(this.initialOffer.sdp,this.extension),f=this.logSDPExchange(l||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),f==null||f(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),Z("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(Z("PRELOAD_MEDIA_COUNT"));const S=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:S});const b=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(b)}const{preSSRCs:_}=t;if(Array.isArray(_)&&_.length>0){const{mids:S}=this.remoteSDP.batchSend(_.map(b=>({kind:b.kind,ssrcMsg:[{ssrcId:b.ssrcId,rtx:b.rtx}],mslabel:b.mslabel})));S.forEach((b,A)=>{this.preSSRCMap.set(_[A].ssrcId,b)}),await yy(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(a){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}var n,s}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=t;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:s}=t;if(Array.isArray(s)&&s.length>0){const{mids:a}=this.remoteSDP.batchSend(s.map(l=>Object.assign({},{kind:l.kind,ssrcMsg:[{ssrcId:l.ssrcId,rtx:l.rtx}],mslabel:l.mslabel})));a.forEach((l,f)=>{this.preSSRCMap.set(s[f].ssrcId,l)})}await yy(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,s){var a=this;return ro(function*(){const l=yield tn(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const f=[],m=PR();t.forEach(j=>{const Y=a.peerConnection.addTransceiver(j._mediaStreamTrack,el({direction:"sendonly"},j.trackMediaType==="video"&&a.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));f.push(Y),j._updateRtpTransceiver(Y)}),oi()&&Z("SIMULCAST")===!0&&(yield tn(a.applySimulcastForFirefox(f,t)));const _=yield tn(a.peerConnection.createOffer()),S=a.remoteSDP.predictReceivingMids(t.length),b=a.mungSendOfferSDP(_.sdp,t,S),A=Yr(b),O=S.map(j=>{const Y=A.mediaDescriptions.find(q=>q.attributes.mid===j);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return RF(Y,Z("USE_PUB_RTX"))});let D;try{D=yield O}catch(j){D=[],a.remoteSDP.receive(t,n,s,D);const Y=a.remoteSDP.toString();throw yield tn(a.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield tn(a.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),yield tn(a.stopSending(S,!0)),j}a.remoteSDP.receive(t,n,s,D);const G=a.remoteSDP.toString(),B=a.logSDPExchange(b,"offer","local","send");return yield tn(a.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield tn(a.applySimulcastEncodings(f,t)),yield tn(a.applySendEncodings(f,t)),B==null||B(G),yield tn(a.peerConnection.setRemoteDescription({type:"answer",sdp:G})),f.map((j,Y)=>{const q=S[Y];return{localSSRC:O[Y],id:q,transceiver:j}})}catch(f){throw f instanceof ve?f:new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(f.toString()))}finally{l()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(t);if(s&&s.readyState==="open")k.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:Z("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,s)}n.forEach(l=>{l._updateOriginDataChannel(s)});const{needExchangeSDP:a}=this.remoteSDP.sendDataChannel();if(a){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const f=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(f),k.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else k.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof ve?s:new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof ve?n:new ve($.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const s=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter(_=>t.indexOf(_.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(_=>{var S;WR(this.id+_.mid,this),_.direction="inactive",(S=_.stop)===null||S===void 0||S.call(_)});const l=await this.peerConnection.createOffer(),f=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const m=this.remoteSDP.toString();f==null||f(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(a){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{s&&s()}}async receive(t,n,s,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:f}=this.remoteSDP.send(t,n,s,a);f&&(await yy(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===l);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:l,transceiver:m}}catch(l){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:s}=this.remoteSDP.batchSend(t);return s&&(await yy(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(a=>{const l=this.peerConnection.getTransceivers().find(f=>f.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a,transceiver:l}})}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preSSRCMap.entries()).some(f=>{let[m,_]=f;if(_===l)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();s==null||s(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();s==null||s(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();s==null||s(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(f=>f.mid&&t.indexOf(f.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(f=>{f.direction="inactive"});const s=await this.peerConnection.createOffer(),a=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(f=>f.mid&&t.indexOf(f.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(f,m)=>{f.direction="sendonly"});const s=await this.peerConnection.createOffer(),a=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ro(function*(){const s=yield tn(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const a=on().supportPCSetConfiguration,l=Z("FORCE_TURN_TCP")||n.forceTurn;if(t===Ms.RELAY&&!a)return;if(a&&!l){const A=t===Ms.RELAY?"relay":"all",O=n.peerConnection.getConfiguration();O.iceTransportPolicy!==A&&(k.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(O.iceTransportPolicy,"] to [").concat(A,"]")),O.iceTransportPolicy=A,n.peerConnection.setConfiguration(O))}n.remoteSDP.updateCandidates(t);const f=yield tn(n.peerConnection.createOffer({iceRestart:!0}));if(!f.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Kh(f.sdp),{remoteIceParameters:_}=yield m.iceParameters;n.remoteSDP.restartICE(_);const S=n.remoteSDP.toString(),b=n.logSDPExchange(f.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield tn(n.peerConnection.setLocalDescription(f)),b==null||b(S),yield tn(n.peerConnection.setRemoteDescription({type:"answer",sdp:S}))}catch(a){k.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),a)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ms.TCP_RELAY),await yy(this.peerConnection,this.remoteSDP,this.extension)}catch(n){k.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{WR(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return el(el({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(s.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),f=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),f==null||f(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new ve($.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(t,n){const s=this.peerConnection.getTransceivers().filter(a=>a.mid===t);s.length===1&&(this.isVP8Simulcast(n)?oi()||await this.applySimulcastEncodings(s,[n]):await this.applySendEncodings(s,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const s=this.peerConnection.getTransceivers().find(a=>a.mid===n);s&&await s.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:s,remote:a}=n.getSelectedCandidatePair();return{local:el(el({},ql),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:el(el({},ql),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const s="code: ".concat(t.errorCode,", message: ").concat(t.errorText),a=t.port?"local: ".concat(t.port):"";k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(s,"), url: ").concat(t.url||"",", host_candidate:").concat(a)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,s)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(ry(t.turnServer.servers)?n.iceServers=t.turnServer.servers:Z("NEW_TURN_MODE")&&n.iceServers?(Z("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Im.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Im.newTurnServerConfigToIceServers(t.turnServer.servers)),Z("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Im.turnServerConfigToIceServers(t.turnServer.servers)),Z("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Im.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),Z("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(n.iceTransportPolicy="relay")}))),Z("ENABLE_ENCODED_TRANSFORM")&&on().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(s=>{s.security?s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Gh(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!Z("FORCE_TURN_TCP")&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(s=>{const a=Z("NEW_TURN_MODE");a===1?n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):a===2?n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):a===3?n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Gh(s.turnServerURL),":443?transport=tcp")}):a===4&&(n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Gh(s.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var a;n!=null&&n.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,n.state))},n.onerror=a=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in a?a.error:a)};const s=n.iceTransport;s&&(s.onstatechange=()=>{const a=n==null?void 0:n.iceTransport.state;var l;a&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,a))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:a,remote:l}=s.getSelectedCandidatePair();k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var s,a;if(n||(n=this.peerConnection.getSenders().find(j=>j.track===t._mediaStreamTrack)),!n)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!on().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},f={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const m=function(B,j){return B.getTransceivers().find(Y=>Y.sender.track===j||Y.receiver.track===j)}(this.peerConnection,t._mediaStreamTrack),_=Mq(t);if(z$(t)&&m&&n&&_&&this.getLocalVideoStats&&We(s=["vp8","vp9"]).call(s,this.store.codec)){var S;const B=l.degradationPreference||(We(S=t._hints).call(S,kn.CUSTOM_TRACK)?Z("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(j,Y,q,ie,le,ue){if(WR(j,q),le(Y),ie!=="balanced"&&ie!=="maintain-framerate"&&ie!=="maintain-resolution")return;let oe=-1;aB(j,Y);const ye=window.setInterval(()=>{const ze=KR.get(j);if(!Z("ENABLE_AG_ADAPTATION")||!ze)return WR(j,q),void le(Y);const nt=ue();if(nt.sendPackets>0&&nt.OutgoingAvailableBandwidth>0){if(oe===-1)return void(oe=Date.now());if(Date.now()-oe<1e3)return;const $t=nt.sendFrameRate,zt=nt.OutgoingAvailableBandwidth,[Mn,Ai]=$$(j,$t,zt,ze.adaptationConfig,Y,ie);Ai&&(q.qualityLimitationReason=Ai),Mn&&ze.adaptationConfig.scale!==Mn.scale&&(k.debug("[".concat(j,"] applyAdaptation: ").concat(q.qualityLimitationReason,`
           sendFps `).concat($t,", bwe ").concat(zt,", switch from ").concat(ze.adaptationConfig.scale," to ").concat(Mn.scale," ")),ze.adaptationConfig=tD(tD({},ze.adaptationConfig),Mn),le(Mn))}},Z("CHECK_LOCAL_STATS_INTERVAL")),Pe=tD({},Y);KR.set(j,{timer:ye,adaptationConfig:Pe,originConfig:Y,adaptationFunc:le}),k.debug("[".concat(j,"] start adaptation, originConfig: ").concat(JSON.stringify(Y),", degradationPreference: ").concat(ie))})(this.id+m.mid,_,this,B,j=>{n&&this.updateAdaptation(n,j)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var b;const{bitrateMax:B,frameRate:j,scaleResolutionDownBy:Y}=t._encoderConfig;B&&(f.maxBitrate=1e3*B),(We(b=t._hints).call(b,kn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(j&&(f.maxFramerate=Ea(j)),Y&&Y>=1&&(f.scaleResolutionDownBy=Y))}const{maxFramerate:A}=Z("ENCODER_CONFIG_LIMIT");if(A&&typeof A=="number"&&(f.maxFramerate=f.maxFramerate?Math.min(f.maxFramerate,A):A),Z("DSCP_TYPE")&&su()){var O;const B=Z("DSCP_TYPE");We(O=["very-low","low","medium","high"]).call(O,B)&&(f.networkPriority=B)}const D=n.getParameters(),G=(a=D.encodings)===null||a===void 0?void 0:a[0];oi()&&!G&&(l.encodings=[f]),G&&Object.assign(G,f),Object.assign(D,l),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(D.encodings))),await n.setParameters(D),await async function(B,j,Y){try{var q;if(!on().supportSetRtpSenderParameters||!function(ye){return ye==="vp9"||ye==="av1"}(B)||!Z("ENABLE_SVC"))return;const ie={},le={},ue=j.getParameters(),oe=(q=ue.encodings)===null||q===void 0?void 0:q[0];le.scalabilityMode=PR(Y),oe&&Object.assign(oe,le),Object.assign(ue,ie),await j.setParameters(ue),k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ue.encodings)))}catch(ie){k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ie)}}(this.store.codec,n,Z("SVC_MODE"))}async updateAdaptation(t,n){var s,a;if(!t)return k.debug("[updateAdaptation] no rtpSender found");if(!on().supportSetRtpSenderParameters)return k.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:f,frameRate:m,scaleResolutionDownBy:_}=n;f&&(l.maxBitrate=1e3*f),m&&(l.maxFramerate=Ea(m)),_&&_>=1&&We(s=["vp8","vp9"]).call(s,this.store.codec)&&(l.scaleResolutionDownBy=_);const S=t.getParameters(),b=(a=S.encodings)===null||a===void 0?void 0:a[0];b&&Object.assign(b,l),Object.assign(S,{});try{await t.setParameters(S),k.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(S.encodings)))}catch(A){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?k.debug("[updateAdaptation] peerConnection not connected}"):k.debug("[updateAdaptation] updateRtpSenderEncodings failed",A):k.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!on().supportSetRtpSenderParameters||t.length!==n.length)return;for(let s=0;s<t.length;s++){const a=t[s],l=n[s];l instanceof Kn&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,a.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,s){const a=Yr(t);return n.forEach((l,f)=>{const m=s[f],_=a.mediaDescriptions.find(S=>S.attributes.mid===m);_&&(r_(_,l),wF(_,l,this.store.codec))}),Bh(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,s)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,n,s)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let _=0;_<t.length;_++){var s,a,l,f,m;const S=t[_],b=n[_];if(b instanceof Kn&&!We(s=b._hints).call(s,kn.LOW_STREAM)&&(a=b._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((l=b._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(f=b._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((m=b._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const A={},O={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{rid:"m",active:!0,maxBitrate:O.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:O.high}];const D=S.sender.getParameters();await S.sender.setParameters(Object.assign(D,A))}}}async applySimulcastEncodings(t,n){if(!oi()&&t.length===n.length)for(let s=0;s<t.length;s++){const a=n[s];if(a instanceof Kn&&this.isVP8Simulcast(a)){const l=t[s],f={},m={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=l.sender.getParameters();await l.sender.setParameters(Object.assign(_,f))}}}isVP8Simulcast(t){var n,s,a,l,f;return!!(t instanceof Kn&&Z("SIMULCAST")&&this.store.codec==="vp8"&&!We(n=t._hints).call(n,kn.LOW_STREAM)&&(s=t._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((f=t._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1)}logSDPExchange(t,n,s,a){if(Z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(n," SDP during P2PConnection.").concat(a,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",s==="local"?"remote":"local",a)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(on().supportPCSetConfiguration){const n=Im.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},ft(en.prototype,"updateRemoteRTPCapabilities",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"updateRemoteRTPCapabilities"),en.prototype),ft(en.prototype,"connect",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"connect"),en.prototype),ft(en.prototype,"updateRemoteConnect",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"updateRemoteConnect"),en.prototype),ft(en.prototype,"createDataChannels",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"createDataChannels"),en.prototype),ft(en.prototype,"receive",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"receive"),en.prototype),ft(en.prototype,"batchReceive",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"batchReceive"),en.prototype),ft(en.prototype,"stopReceiving",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"stopReceiving"),en.prototype),ft(en.prototype,"muteRemote",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"muteRemote"),en.prototype),ft(en.prototype,"unmuteRemote",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"unmuteRemote"),en.prototype),ft(en.prototype,"muteLocal",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"muteLocal"),en.prototype),ft(en.prototype,"unmuteLocal",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"unmuteLocal"),en.prototype),ft(en.prototype,"close",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"close"),en.prototype),ft(en.prototype,"updateEncoderConfig",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"updateEncoderConfig"),en.prototype),ft(en.prototype,"updateSendParameters",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"updateSendParameters"),en.prototype),ft(en.prototype,"replaceTrack",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"replaceTrack"),en.prototype),ft(en.prototype,"updateAdaptation",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"updateAdaptation"),en.prototype),ft(en.prototype,"getRemoteSSRC",[Pr],Object.getOwnPropertyDescriptor(en.prototype,"getRemoteSSRC"),en.prototype),en);function Pr(e,t,n){const s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,l=await a.lock("From P2PConnection.".concat(t));try{for(var f=arguments.length,m=new Array(f),_=0;_<f;_++)m[_]=arguments[_];return await s.apply(this,m)}finally{l()}},n}function rD(e,t){let n=document.createElement("video"),s=document.createElement("canvas");n.setAttribute("style","display:none"),s.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),s.width=Ea(t.width),s.height=Ea(t.height);const a=Ea(t.framerate||15);document.body.append(n),document.body.append(s);let l=e._mediaStreamTrack;n.srcObject=new MediaStream([l]),n.play();const f=s.getContext("2d");if(!f)throw new Ee($.UNEXPECTED_ERROR,"can not get canvas context");const m=on(),_=s.captureStream(m.supportRequestFrame?0:a).getVideoTracks()[0];_.canvas||(_.canvas=s),s.startCapture=()=>{if(!n)return s.stopCapture&&s.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const b=n.videoWidth,A=n.videoHeight/b,O=s.width*A;Math.abs(O-s.height)>=2&&(k.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(O)),s.height=O)}f.drawImage(n,0,0,s.width,s.height),_.requestFrame&&_.requestFrame(),l!==e._mediaStreamTrack&&(l=e._mediaStreamTrack,n.srcObject=new MediaStream([l]))},s.stopCapture=gO(()=>s.startCapture&&s.startCapture(),a);const S=_.stop;return _.stop=()=>{S.call(_),n&&(n.remove(),n.srcObject=null,n=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),k.debug("clean low stream renderer")},_}var qR=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(qR||{}),Li=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(Li||{}),um=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(um||{}),xi=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(xi||{}),hm=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(hm||{}),uB=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(uB||{}),ed=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(ed||{}),kr=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(kr||{}),hB=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(hB||{}),Mr=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Mr||{}),$R=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}($R||{});const fm=1e3,pm=6,zR=3,Q$=Math.max(pm,zR);function wt(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function fB(e){const t={[Mr.CONN_TYPE]:0,[Mr.RTT]:e.rtt,[Mr.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Mr.CONN_TYPE]=1),n==="tcp"&&(t[Mr.CONN_TYPE]=3),n==="tls"&&(t[Mr.CONN_TYPE]=4);break}case"srflx":t[Mr.CONN_TYPE]=2;break;case"unknown":t[Mr.CONN_TYPE]=5;break;default:t[Mr.CONN_TYPE]=0}return t}function pB(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class mB extends ii{constructor(t){super(),W(this,"store",void 0),W(this,"uploadWRTCStatsTimer",void 0),W(this,"uploadOutboundDenoiserStatsTimer",void 0),W(this,"uploadExtStatsTimer",void 0),W(this,"uploadExtUsageStatsTimer",void 0),W(this,"uploadInboundExtStatsTimer",void 0),W(this,"requestStats",void 0),W(this,"requestTransportStats",void 0),W(this,"requestLocalMedia",void 0),W(this,"requestRemoteMedia",void 0),W(this,"requestAllTracks",void 0),W(this,"requestVideoIsReady",void 0),W(this,"requestUploadStats",void 0),W(this,"requestUpload",void 0),W(this,"uploadOutboundStarted",!1),W(this,"uploadInboundStarted",!1),W(this,"uploadTransportStarted",!1),W(this,"uploadBaseStatsStarted",!1),W(this,"uploadExtensionUsageStarted",!1),W(this,"lastRecvStats",void 0),W(this,"lastSendStats",void 0),W(this,"lastRefRecvStats",void 0),W(this,"lastRefSendStats",void 0),W(this,"lastFullRecvStats",void 0),W(this,"lastFullSendStats",void 0),W(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%zR==0,s=t%pm==0;let a,l;if(this.uploadTransportStarted&&(a=this.requestStats(),this.store.useP2P&&(l=this.requestStats(!0))),!a&&this.uploadOutboundStarted&&(a=this.requestStats()),!l&&this.uploadInboundStarted&&(l=this.requestStats(!0)),a||l){var f;const m={};if(this.uploadTransportStarted&&a){const S=this.getTransportStats(a,l,n);S&&(m.misc=[S])}if(this.uploadOutboundStarted&&a){const S=this.getOutboundStats(a,s?this.lastFullSendStats:n?this.lastRefSendStats:this.lastSendStats,n,s);S&&(m.outbound=[S])}if(this.uploadInboundStarted&&l){const S=this.getInboundStats(l,s?this.lastFullRecvStats:n?this.lastRefRecvStats:this.lastRecvStats,n,s);S&&(m.inbound=S)}const _=(f=this.requestTransportStats)===null||f===void 0?void 0:f.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[$R.RTC_PEER_CONNECTION_STATE]=tO[_]):m.misc=[{addition:{[$R.RTC_PEER_CONNECTION_STATE]:tO[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=l,this.lastSendStats=a,s&&(this.lastFullRecvStats=l,this.lastFullSendStats=a),n&&(this.lastRefRecvStats=l,this.lastRefSendStats=a)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,s;const a=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(a&&((s=this.requestUploadStats)===null||s===void 0||s.call(this,{misc:[{addition:{[$R.RTC_PEER_CONNECTION_STATE]:tO[a.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Q$+1&&(t=1)},fm)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,n,s){if(!this.requestStats)return;if(!s)return t.rtt==null?void 0:{addition:{[Mr.RTT]:t.rtt,[Mr.CONN_TYPE]:void 0,[Mr.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const a=fB(t);if(this.store.useP2P){if(n){const l=fB(n);a[Mr.CONN_TYPE]+=l[Mr.CONN_TYPE]<<3}a[Mr.CONN_TYPE]+=110}else a[Mr.CONN_TYPE]+=100;return{addition:a}}getOutboundStats(t,n,s,a){if(!this.requestUploadStats||!this.requestLocalMedia)return;const l=this.requestLocalMedia();if(!l||l.length===0)return;let f,m,_;return l.forEach(S=>{let[b,{track:A,ssrcs:O}]=S;switch(b){case Le.LocalVideoLowTrack:case Le.LocalVideoTrack:if(b===Le.LocalVideoTrack){const D=function(j,Y,q,ie,le,ue){const oe=Y.videoSend.find(nt=>nt.ssrc===j);if(!oe)return;const ye={},{sentFrame:Pe,inputFrame:ze}=oe;if(ue&&(wt(ye,Li.QP_SUM,oe.qpSumPerFrame),ze&&Pe)){const nt=ze.frameRate,$t=Pe.frameRate;ye[Li.FREEZE]=function(zt,Mn){let Ai=!0;return Ai=!(zt<=5)&&(zt<=10?Mn<3:zt<=20?Mn<4:Mn<5),Ai}(nt,$t)?1:0}if(le){switch(Pe&&(wt(ye,Li.HEIGHT,Pe.height),wt(ye,Li.WIDTH,Pe.width),wt(ye,Li.FRAME_RATE,Pe.frameRate)),ye[Li.DISABLED]=ie._originMediaStreamTrack&&!ie._originMediaStreamTrack.enabled||ie._mediaStreamTrack&&!ie._mediaStreamTrack.enabled?1:0,oe.adaptionChangeReason){case"none":ye[Li.ADAPTATION]=0;break;case"cpu":ye[Li.ADAPTATION]=1;break;case"bandwidth":ye[Li.ADAPTATION]=2;break;case"other":ye[Li.ADAPTATION]=3}let nt=0;oe.adaptionChangeReason&&(nt+=pB(oe.adaptionChangeReason)),Y.qualityLimitationReason&&(nt+=pB(Y.qualityLimitationReason)<<3),ye[Li.ADAPTATION]=nt,ye[Li.PLAYER_STATUS]=pO[ie._player?ie._player.videoElementStatus:"uninit"],wt(ye,Li.NACKS,oe.nacksCount),wt(ye,Li.PLIS,oe.plisCount),wt(ye,Li.FIRS,oe.firsCount),wt(ye,Li.AVG_ENCODE,oe.avgEncodeMs),wt(ye,Li.HUGE_FRAME_SENT,oe.hugeFramesSent),wt(ye,Li.BYTES_RETRANSMIT,oe.retransmittedBytesSent),wt(ye,Li.PACKAGES_RETRANSMIT,oe.retransmittedPacketsSent),wt(ye,Li.KEY_FRAMES_ENCODED,oe.keyFramesEncoded);const $t=q&&q.videoSend.find(zt=>zt.ssrc===j);if($t){let zt=le?fm:fm*pm;$t.timestamp&&oe.timestamp&&(zt=oe.timestamp-$t.timestamp),$t.packets!=null&&oe.packets!=null&&wt(ye,Li.PACKAGE_RATE,1e3*(oe.packets-$t.packets)/zt),oe.packetsLost!=null&&$t.packetsLost!=null&&wt(ye,Li.PACKAGE_LOST,oe.packetsLost-$t.packetsLost),$t.bytes!=null&&oe.bytes!=null&&wt(ye,Li.BITRATE,8*(oe.bytes-$t.bytes)/zt)}}return ye}(O[0].ssrcId,t,n,A,s,a),G=A&&function(j,Y,q,ie){const le=Y.videoSend.find(oe=>oe.ssrc===j);if(!le)return null;const ue={};if(ie){const oe=le.inputFrame,ye=oe&&oe.height||q.videoHeight||0,Pe=oe&&oe.width||q.videoWidth||0,ze=oe&&oe.frameRate||0;wt(ue,qR.HEIGHT,ye),wt(ue,qR.WIDTH,Pe),wt(ue,qR.FRAME_RATE,ze)}return ue}(O[0].ssrcId,t,A,s),B=function(j,Y){const q={};return Y&&(wt(q,Li.RETRANSMIT,j.bitrate.retransmit),wt(q,Li.TARGET_ENCODED,j.bitrate.targetEncoded),wt(q,Li.ACTUAL_ENCODED,j.bitrate.actualEncoded),wt(q,Li.TRANSMIT,j.bitrate.transmit),wt(q,Li.BANDWIDTH,j.sendBandwidth)),q}(t,s);m=Object.assign({},D,G,B)}else _=function(D,G,B,j){const Y=G.videoSend.find(ie=>ie.ssrc===D);if(!Y)return;const q={};if(j){const ie=Y.sentFrame;if(ie&&(wt(q,um.HEIGHT,ie.height),wt(q,um.WIDTH,ie.width),wt(q,um.FRAME_RATE,ie.frameRate)),B){const le=B.videoSend.find(ue=>ue.ssrc===D);if(le){let ue=fm*pm;le.timestamp&&Y.timestamp&&(ue=Y.timestamp-le.timestamp),le.packets!=null&&Y.packets!=null&&wt(q,um.PACKAGE_RATE,1e3*(Y.packets-le.packets)/ue),Y.packetsLost!=null&&le.packetsLost!=null&&wt(q,um.PACKAGE_LOST,Y.packetsLost-le.packetsLost),le.bytes!=null&&Y.bytes!=null&&wt(q,um.BITRATE,8*(Y.bytes-le.bytes)/ue)}}}return q}(O[0].ssrcId,t,n,s);break;case Le.LocalAudioTrack:f=A&&function(D,G,B,j,Y){const q=G.audioSend.find(le=>le.ssrc===D);if(!q)return;const ie={};if(Y){ie[ed.DISABLED]=j._originMediaStreamTrack&&!j._originMediaStreamTrack.enabled||j._mediaStreamTrack&&!j._mediaStreamTrack.enabled?1:0;const le=100*j._source.getAccurateVolumeLevel(),ue=q.inputLevel;if(ue!=null){const ye=Math.ceil(50*Math.log10(100*ue+1));wt(ie,ed.LEVEL,ye)}wt(ie,uB.PCM_LEVEL,le),wt(ie,ed.AEC_RETURN_LOSS,q.aecReturnLoss),wt(ie,ed.AEC_RETURN_LOSS_ENH,q.aecReturnLossEnhancement),wt(ie,ed.BYTES_RETRANSMIT,q.retransmittedBytesSent),wt(ie,ed.PACKAGES_RETRANSMIT,q.retransmittedPacketsSent),ie[ed.FREEZE]=0;const oe=B&&B.audioSend.find(ye=>ye.ssrc===D);if(oe){let ye=fm*pm;oe.timestamp&&q.timestamp&&(ye=q.timestamp-oe.timestamp),oe.bytes!=null&&q.bytes!=null&&wt(ie,ed.BITRATE,8*(q.bytes-oe.bytes)/ye),oe.packets!=null&&q.packets!=null&&wt(ie,ed.PACKAGE_RATE,1e3*(q.packets-oe.packets)/ye)}}return ie}(O[0].ssrcId,t,n,A,s)}}),{high:m,low:_,audio:f}}getInboundStats(t,n,s,a){if(!this.requestRemoteMedia)return;const l=this.requestRemoteMedia()||[],f=[];return l.forEach(m=>{let[_,S]=m;const b={peer:_.uid};if(S.has(at.VIDEO)&&_.videoTrack){const A=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,O=_.videoTrack?function(D,G,B,j,Y,q,ie,le){const ue=G.videoRecv.find(zt=>zt.ssrc===D);if(!ue)return;const oe={},{receivedFrame:ye,outputFrame:Pe,decodeFrameRate:ze}=ue,nt=B&&B.videoRecv.find(zt=>zt.ssrc===D);if(wt(oe,hm.FRAME_RATE_DECODE,ze),ue.framesRateFirefox&&wt(oe,xi.FRAME_RATE,ue.framesRateFirefox),ye&&wt(oe,xi.FRAME_RATE,ye.frameRate),wt(oe,xi.FRAMES_DROPPED,ue.framesDroppedCount),wt(oe,xi.BYTES_RETRANSMIT,ue.retransmittedBytesReceived),wt(oe,xi.PACKAGES_RETRANSMIT,ue.retransmittedPacketsReceived),wt(oe,xi.PACKAGES_DISCARDED,ue.packetsDiscarded),wt(oe,xi.AVG_DECODE,ue.avgDecodeMs),wt(oe,xi.AVG_PROCESSING_DELAY,ue.avgProcessingDelayMs),wt(oe,xi.AVG_ASSEMBLY_TIME,ue.avgFramesAssembledFromMultiplePacketsMs),wt(oe,xi.AVG_INTER_FRAME_DELAY,ue.avgInterFrameDelayMs),wt(oe,xi.KEY_FRAMES_DECODED,ue.keyFramesDecoded),nt){const zt=G.timestamp-B.timestamp||fm*(le?pm:ie?zR:1);ue.packetsLost!=null&&nt.packetsLost!=null&&wt(oe,xi.PACKAGE_LOST,ue.packetsLost-nt.packetsLost),nt.bytes!=null&&ue.bytes!=null&&wt(oe,xi.BITRATE,8*(ue.bytes-nt.bytes)/zt),nt.packets!=null&&ue.packets!=null&&wt(oe,xi.PACKAGE_RATE,1e3*(ue.packets-nt.packets)/zt)}if(le&&(wt(oe,xi.QP_SUM,ue.qpSumPerFrame),oe[xi.FREEZE]=Y&&by.isRemoteVideoFreeze(j,ue,nt)?1:0),ie){var $t;ye?(wt(oe,xi.HEIGHT,ye.height),wt(oe,xi.WIDTH,ye.width)):j&&(wt(oe,xi.HEIGHT,j._videoHeight||0),wt(oe,xi.WIDTH,j._videoWidth||0)),Pe&&wt(oe,hm.FRAME_RATE_OUTPUT,Pe.frameRate);const zt=($t=j._player)===null||$t===void 0?void 0:$t.rendFrameRate.toFixed(0);if(zt&&wt(oe,hm.FRAME_RATE_RENDER,+zt),wt(oe,xi.JITTER_BUFFER,ue.jitterBufferMs),wt(oe,xi.CURRENT_DELAY,ue.currentDelayMs),wt(oe,xi.FIRS,ue.firsCount),wt(oe,xi.NACKS,ue.nacksCount),wt(oe,xi.PLIS,ue.plisCount),j){oe[xi.DISABLED]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const Mn=j._player;if(Mn){const{freezeTimeCounterList:Ai,renderFreezeAccTime:pi,videoElementStatus:Fr}=Mn;if(Ai&&Ai.length>0&&wt(oe,hm.FREEZE_TIME,Ai.splice(0,1)[0]),q&&ou.visibility==="visible"&&Fr===ir.PLAYING&&on().supportRequestVideoFrameCallback){const Ie=Math.min(6e3,pi);Mn.renderFreezeAccTime=Math.max(0,pi-Ie),wt(oe,hm.FREEZE_TIME_RENDER,Ie)}if(typeof ue.totalFreezesDuration=="number"){const Ie=nt&&nt.totalFreezesDuration?ue.totalFreezesDuration-nt.totalFreezesDuration:ue.totalFreezesDuration;wt(oe,hm.FREEZE_DURATION,1e3*Ie)}}}if(oe[xi.PLAYER_STATUS]=pO[j._player?j._player.videoElementStatus:"uninit"],nt&&ue.totalInterFrameDelay!==void 0&&ue.totalSquaredInterFrameDelay!==void 0&&nt.totalInterFrameDelay!==void 0&&nt.totalSquaredInterFrameDelay!==void 0){const Mn=ue.totalInterFrameDelay-nt.totalInterFrameDelay,Ai=ue.totalSquaredInterFrameDelay-nt.totalSquaredInterFrameDelay,pi=ue.framesDecodeCount-nt.framesDecodeCount,Fr=Mn/pi*1e3,Ie=Math.round(1e3*Math.sqrt((Ai-Math.pow(Mn,2)/pi)/pi));!isNaN(Ie)&&Fr+Ie>Math.max(3*Fr,Fr+150)&&(oe[xi.I_FRAME_DELAY]=Ie)}}return oe}(_._videoSSRC,t,n,_.videoTrack,A===!0,this.needUploadRenderFreezeTime,s,a):void 0;O&&(b.video=O)}if(S.has(at.AUDIO)&&_.audioTrack){const A=_.audioTrack?function(O,D,G,B,j,Y){const q=D.audioRecv.find(oe=>oe.ssrc===O);if(!q)return;const ie={},le=G&&G.audioRecv.find(oe=>oe.ssrc===O);if(wt(ie,kr.JITTER,q.jitterMs),wt(ie,kr.BYTES_RETRANSMIT,q.retransmittedBytesReceived),wt(ie,kr.PACKAGES_RETRANSMIT,q.retransmittedPacketsReceived),wt(ie,kr.PACKAGES_DISCARDED,q.packetsDiscarded),wt(ie,kr.AVG_PROCESSING_DELAY,q.avgProcessingDelayMs),le){const oe=D.timestamp-G.timestamp||fm*(Y?pm:j?zR:1);q.packets!=null&&le.packets!=null&&wt(ie,kr.PACKAGE_RATE,1e3*(q.packets-le.packets)/oe),j&&le.bytes!=null&&q.bytes!=null&&wt(ie,kr.BITRATE,8*(q.bytes-le.bytes)/oe),q.packetsLost!=null&&le.packetsLost!=null&&wt(ie,kr.PACKAGE_LOST,q.packetsLost-le.packetsLost)}if(Y){const{receivedFrames:oe,droppedFrames:ye}=q;oe!=null&&ye!=null&&(ie[kr.FREEZE]=(ue=oe)===0||100*ye/ue>20?1:0)}var ue;if(j){const oe=100*B._source.getAccurateVolumeLevel(),ye=q.outputLevel;if(ye!=null){const Pe=Math.ceil(50*Math.log10(100*ye+1));wt(ie,hB.LEVEL,Pe)}if(wt(ie,kr.PCM_LEVEL,oe),B&&(ie[kr.DISABLED]=B._originMediaStreamTrack.enabled&&B._mediaStreamTrack.enabled?0:1),wt(ie,kr.JITTER_BUFFER,q.jitterBufferMs),wt(ie,kr.CURRENT_DELAY,q.jitterBufferMs),ie[kr.PLAYER_STATUS]=pO[xr.getPlayerState(B.getTrackId())],le){const Pe=q.concealedSamples-le.concealedSamples;Pe>0&&wt(ie,kr.CONCEALED_SAMPLES,Pe);const ze=q.totalSamplesReceived-le.totalSamplesReceived;ze>0&&wt(ie,kr.TOTAL_SAMPLES_RECEIVED,ze)}}return ie}(_._audioSSRC,t,n,_.audioTrack,s,a):void 0;A&&(b.audio=A)}(b.video||b.audio)&&f.push(b)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,f}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof _R);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(fy.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,s]=t;s.has(at.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(a=>{this.requestUpload&&this.requestUpload(a.type,a.stats)}),s.has(at.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(a=>{this.requestUpload&&this.requestUpload(a.type,a.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),s={connectionInterval:Z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let a=[];const l=this.requestAllTracks&&this.requestAllTracks()||[];for(const S of l)!S.muted&&S.enabled&&(a=a.concat(await S.getProcessorUsage()));const f=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[S,b]of f)b.has(at.VIDEO)&&S.videoTrack&&(a=a.concat(await S.videoTrack.getProcessorUsage())),b.has(at.AUDIO)&&S.audioTrack&&(a=a.concat(await S.audioTrack.getProcessorUsage()));if(a.length===0)return;s.details=function(S,b){const A={};for(const{id:B,value:j,level:Y,direction:q}of S){var O;const ie=(O=b.get(B))!==null&&O!==void 0?O:0,le=j===2?ie+Z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ie;var D,G;b.set(B,le),A[B]?(j===2&&(A[B].value=j),Y>A[B].level&&(A[B].level=Y),q==="remote"&&(A[B].remoteUidCount+=1),A[B].totalTs=(D=b.get(B))!==null&&D!==void 0?D:0):A[B]={value:j,level:Y,remoteUidCount:q==="local"?0:1,totalTs:(G=b.get(B))!==null&&G!==void 0?G:0}}return Object.keys(A).map(B=>{const{level:j,value:Y,totalTs:q}=A[B];return{id:B,level:j,value:Y,totalTs:q}})}(a,t);const m=Date.now(),_=m>n?m:n+1;this.requestUpload&&this.requestUpload(fy.EXTENSION_USAGE_STATS,{usageStats:s,sendTs:_})},Z("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Z$=Z("ICE_RESTART_INTERVAL");let XR=new Map,d_=new Map,qh=[Ms.UDP_TCP_RELAY,Ms.TCP_RELAY,Ms.RELAY],aD=Z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&on().supportPCSetConfiguration;function gB(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=XR.get(e.id);n&&(window.clearTimeout(n),XR.delete(e.id));const s=d_.get(e.id);t&&s&&s.index===qh.length-1&&(k.debug("[".concat(e.id,"] reset ICE restart policy")),d_.delete(e.id))}function EB(e,t,n){if(XR.size===0&&d_.size===0&&(Array.isArray(Z("RESTART_SEQUENCE"))&&Z("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let S=0;S<m.length;S+=1){const b=m[S];if(m.filter(A=>A===b).length!==_.filter(A=>A===b).length)return!1}return!0}(qh,Z("RESTART_SEQUENCE"))&&(qh=Z("RESTART_SEQUENCE").filter(m=>{var _;if(We(_=Object.values(Ms)).call(_,m))return!0}),k.debug("use reconnection policy from config distribution, queues: ".concat(qh.join(" => ")))),aD=Z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&on().supportPCSetConfiguration),qh.length===0)return void n();let s,{index:a=0,type:l}=d_.get(e.id)||{};if(aD&&l===Ms.RELAY)return void n();let f=l&&a>=qh.length-1;if(aD)l=Ms.RELAY;else{if(f)return void n();l?(a++,l=qh[a]):(l=qh[0],a=0)}k.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(l,", index: ").concat(a)),t(l),d_.set(e.id,{index:a,type:l}),s=window.setTimeout(()=>EB(e,t,n),Z$),XR.set(e.id,s)}var Ht;function _B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function td(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_B(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_B(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function SB(e){var t,n,s,a=2;for(typeof Symbol<"u"&&(n=Dw,s=Symbol.iterator);a--;){if(n&&(t=e[n])!=null)return t.call(e);if(s&&(t=e[s])!=null)return new JR(t.call(e));n="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function JR(e){function t(n){if(Object(n)!==n)return Ye.reject(new TypeError(n+" is not an object."));var s=n.done;return Ye.resolve(n.value).then(function(a){return{value:a,done:s}})}return JR=function(n){this.s=n,this.n=n.next},JR.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var s=this.s.return;return s===void 0?Ye.resolve({value:n,done:!0}):t(s.apply(this.s,arguments))},throw:function(n){var s=this.s.return;return s===void 0?Ye.reject(n):t(s.apply(this.s,arguments))}},new JR(e)}let Ay=(Ht=class extends ii{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(vt.StateChange,t,this._state)}constructor(e,t){super(),W(this,"isPlanB",void 0),W(this,"store",void 0),W(this,"statsUploader",void 0),W(this,"connection",void 0),W(this,"localTrackMap",new Map),W(this,"remoteUserMap",new Map),W(this,"localDataChannels",[]),W(this,"remoteDataChannelMap",new Map),W(this,"pendingLocalTracks",[]),W(this,"pendingRemoteTracks",[]),W(this,"pendingLocalDataChannels",[]),W(this,"pendingRemoteDataChannels",[]),W(this,"statsCollector",void 0),W(this,"shouldForwardP2PCreation",void 0),W(this,"iceFailedCount",0),W(this,"dtlsFailedCount",0),W(this,"mutex",void 0),W(this,"_state",mn.Disconnected),W(this,"_pcStatsUploadType",Z("NEW_ICE_RESTART")?uu.FIRST_CONNECTION:uu.OLD_FIRST_CONNECTION),W(this,"_isStartRestartIce",!1),W(this,"_restartTimer",void 0),W(this,"_isTryConnecting",!1),W(this,"_iceError",null),W(this,"_forceTurn",!1),W(this,"_isWaitPcToRePub",!1),W(this,"handleMuteLocalTrack",async(n,s,a)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==mn.Connected)return void a(new ve($.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const f=this.filterTobeMutedTracks(n);if(f.length===0)return void s();const m=f.find(S=>S[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(f.map(S=>{let[,{id:b}]=S;return b}));const _=this.createMuteMessage(f);await xn(this,vt.RequestMuteLocal,_),s()}catch(f){a(f)}finally{l()}}),W(this,"handleUnmuteLocalTrack",async(n,s,a)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==mn.Connected)return void a(new ve($.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const f=this.filterTobeUnmutedTracks(n);if(f.length===0)return void s();const m=f.find(S=>S[0]==="videoLowTrack");if(m){const S=m[1];if(S.track._originMediaStreamTrack.stop(),!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&on().supportDualStreamEncoding){const b=n._mediaStreamTrack.clone();S.track._mediaStreamTrack=b,S.track._originMediaStreamTrack=b}else{const b=rD(n,ay(this,vt.RequestLowStreamParameter));S.track._mediaStreamTrack=b,S.track._originMediaStreamTrack=b}await new Ye((b,A)=>{this.handleReplaceTrack(S.track,b,A,!0)})}await this.connection.unmuteLocal(f.map(S=>{let[,{id:b}]=S;return b}));const _=this.createUnmuteMessage(f);await xn(this,vt.RequestUnmuteLocal,_),s()}catch(f){a(f)}finally{l()}}),W(this,"handleUpdateVideoEncoder",async(n,s,a,l)=>{let f;l||(f=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Le.LocalVideoTrack);if(!this.connection||!_||_.track!==n||this.state!==mn.Connected)return void s();const{id:S,track:b}=_;await this.connection.updateSendParameters(S,b),await this.connection.updateEncoderConfig(S,b),this.emit(vt.UpdateVideoEncoder,b),s()}catch(_){a(_)}finally{var m;(m=f)===null||m===void 0||m()}}),W(this,"handleUpdateVideoSendParameters",async(n,s,a)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const f=this.localTrackMap.get(Le.LocalVideoTrack);if(!this.connection||!f||f.track!==n||this.state!==mn.Connected)return void s();const{id:m,track:_}=f;await this.connection.updateSendParameters(m,_),s()}catch(f){a(f)}finally{l()}}),W(this,"handleReplaceMixingTrack",async(n,s,a,l)=>{if(!this.connection||this.state!==mn.Connected)return void s();const f=iD([n]);let m;k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(f.getTrackId(),"]")),typeof l=="boolean"&&l||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,f),s()}catch(S){a(S)}finally{var _;(_=m)===null||_===void 0||_()}}),W(this,"handleReplaceTrack",async(n,s,a,l)=>{let f;k.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof l=="boolean"&&l||(f=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const S=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:A}]=b;return n===A});if(!this.connection||!S||this.state!==mn.Connected)return void s();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(n,S[1].id)),this.isPlanB){const b=S[1];b.id=n._mediaStreamTrack.id,this.localTrackMap.set(S[0],b)}if(S[0]===Le.LocalVideoTrack&&!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&on().supportDualStreamEncoding){const b=this.localTrackMap.get(Le.LocalVideoLowTrack);if(b){const A=n._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=A,b.track._originMediaStreamTrack=A,await new Ye((O,D)=>{this.handleReplaceTrack(b.track,O,D,!0)})}}s()}catch(S){a(S)}finally{var _;(_=f)===null||_===void 0||_()}}),W(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),W(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),W(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),W(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),W(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new mB(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ps("P2PChannel-mutex",this.store.clientId),this.isPlanB=!on().supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&su(),this.shouldForwardP2PCreation=Z("FORWARD_P2P_CREATION")&&on().supportPCSetConfiguration&&Gw(),this.shouldForwardP2PCreation&&(this.connection=YR(this.store),this.emit(vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=mn.New,this._forceTurn=lB(e),k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=YR(this.store,e),this.emit(vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new ve($.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=Z("NEW_ICE_RESTART")?uu.FIRST_CONNECTION:uu.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new ve($.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");Z("ENABLE_PREALLOC_PC")&&this.state===mn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=mn.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(a=>{var l;let[f]=a;return We(l=[Le.LocalVideoLowTrack,Le.LocalVideoTrack]).call(l,f)}),n=t.map(a=>{let[,{id:l}]=a;return l}),s=t.map(a=>{let[l]=a;return l});if(this.connection instanceof Zl){if(gt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(s),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!We(e).call(e,this.store.codec)){const a=["vp9","vp8","h264"].find(l=>We(e).call(e,l));a&&(this.store.codec=a,k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(a,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof Zl&&this.connection.peerConnectionState!=="closed"&&We(e=[mn.New,mn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==mn.Connected){if(this.state===mn.Disconnected)throw new ve($.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var s;We(s=this.pendingLocalDataChannels).call(s,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const s=Date.now();this.store.publish(n.id.toString(),"datachannel",s)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const s=Date.now();this.store.publish(n.id+"","datachannel",void 0,s)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var s=this;return ro(function*(){const a=yield tn(s.mutex.lock("From P2PChannel.publish"));try{var l;const f=s.connection&&We(l=["disconnected","failed"]).call(l,s.connection.peerConnectionState);if(!s.connection||s.state!==mn.Connected||f){if(s.state===mn.Disconnected)throw new ve($.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(e);const _=e.filter(S=>s.pendingLocalTracks.indexOf(S)===-1);return s.pendingLocalTracks=s.pendingLocalTracks.concat(_),void(f&&(s._isWaitPcToRePub=!0))}s.store.pubId=s.store.pubId+1,Us.markPublishStart(s.store.clientId,s.store.pubId);const m=s.filterTobePublishedTracks(e,t,n);if(m.length===0)return void(yield tn(s.tryToUnmuteAudio(e)));yield*Wb(SB(s.doPublish(s.connection,m)))}finally{a()}})()}doPublish(e,t){var n=this;return ro(function*(){t.forEach(O=>{let{track:D,type:G}=O;const B=Date.now();n.store.publish(D.getTrackId(),G===Le.LocalAudioTrack?"audio":"video",B)}),n.bindLocalTrackEvents(t);const s=t.map(O=>{let{track:D}=O;return D}),a=yield tn(e.send(s,n.store.codec,n.store.audioCodec)),l=(yield tn(a.next())).value,f=n.createGatewayPublishMessage(t,l);let m;try{m=yield f}catch(O){throw a.throw(O),(O==null?void 0:O.code)===$.WS_ABORT&&t.forEach(D=>{let{track:G}=D;n.pendingLocalTracks.indexOf(G)===-1&&n.pendingLocalTracks.push(G)}),n.unbindLocalTrackEvents(t),O}const _=n.mapPubResToRemoteConfig(f,m,s),S=(yield tn(a.next(_))).value;if(n.state===mn.Disconnected)throw new ve($.UNEXPECTED_ERROR,"PeerConnection already disconnected.");Z("ENABLE_VIDEO_SEI");const b=Z("ENABLE_ENCODED_TRANSFORM"),A=Z("ENABLE_AUDIO_METADATA");s.forEach(async O=>{const D=O.getRTCRtpTransceiver();if(!D||!b)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:B}=BR();O.trackMediaType===at.VIDEO?await G(D.sender,O):O.trackMediaType===at.AUDIO&&await B(D.sender,{metadata:A?()=>{const j=O.metadata.shift();return j&&j.value}:void 0})}),t.forEach(O=>{let{type:D}=O;n.statsCollector.addLocalStats(D)}),n.assignLocalTracks(t,S),n.statsUploader.startUploadOutboundStats(),t.forEach(O=>{let{track:D,type:G}=O;const B=Date.now();n.store.publish(D.getTrackId(),G===Le.LocalAudioTrack?"audio":"video",void 0,B)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof Kn))return k.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:s}=n,a=function(l,f){const m={};return l.height&&l.width&&(m.scaleResolutionDownBy=jO(l,f)),m.maxFramerate=l.framerate?Ea(l.framerate):void 0,m.maxBitrate=l.bitrate?1e3*l.bitrate:void 0,m}(e,s);if(s._encoderConfig||(s._encoderConfig={}),t!==Le.LocalVideoLowTrack||!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&on().supportDualStreamEncoding)a.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=a.scaleResolutionDownBy);else{const l=s._originMediaStreamTrack;if(!l.canvas)return k.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(f,m){const _=f.canvas;m.width&&(_.width=Ea(m.width)),m.height&&(_.height=Ea(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=gO(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},Ea(m.framerate)))})(l,e)}a.maxBitrate!=null&&(s._encoderConfig.bitrateMax=a.maxBitrate/1e3),a.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=a.maxFramerate:s._encoderConfig.frameRate={max:a.maxFramerate}),k.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(e){var t=this;return ro(function*(){if(!t.connection||t.state!==mn.Connected)return;const n=yield tn(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const a=t.localTrackMap.get(Le.LocalVideoTrack);if(!a)throw new ve($.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Le.LocalVideoLowTrack))throw new ve($.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const l=[{track:t.getLowVideoTrack(a.track,e),type:Le.LocalVideoLowTrack}];if(yield*Wb(SB(t.doPublish(t.connection,l))),a.track.muted||!a.track.enabled){var s;const f=(s=t.localTrackMap.get(Le.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;f!==void 0&&(yield tn(t.connection.muteLocal([f])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ws(this,vt.RequestRePublish,this.pendingLocalTracks),this.emit(vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(k.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ws(this,vt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:s}=this.pendingRemoteTracks[t];(s!==at.AUDIO||n._audio_added_&&n._audioSSRC)&&(s!==at.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await ws(this,vt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===at.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(vt.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==mn.Connected)return void e.forEach(s=>{const a=this.pendingLocalTracks.indexOf(s);a!==-1&&this.pendingLocalTracks.splice(a,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(s=>s[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==mn.Connected)return void e.forEach(n=>{const s=this.pendingLocalDataChannels.indexOf(n);s!==-1&&this.pendingLocalDataChannels.splice(s,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const s=this.localDataChannels.indexOf(n);s!==-1&&this.localDataChannels.splice(s,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==mn.Connected)return;const e=this.localTrackMap.get(Le.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[Le.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(s=>{let[,{id:a}]=s;return a})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(s=>{let[a,{track:l}]=s;return{type:a,track:l}})),t.forEach(s=>{let[a]=s;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==mn.Connected)throw new ve($.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(s=>{var a;return!((a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.get(s.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(s=>{var a;this.remoteDataChannelMap.has(e)?(a=this.remoteDataChannelMap.get(e))===null||a===void 0||a.set(s.id,s):this.remoteDataChannelMap.set(e,new Map([[s.id,s]]));const l=this.pendingRemoteDataChannels.findIndex(f=>{let{user:m,id:_}=f;return m.uid===e.uid&&_===s.id});l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),n.map(s=>s.id)}async subscribe(e,t,n,s,a){var l;if(!this.connection||this.state!==mn.Connected)throw new ve($.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(e))!==null&&l!==void 0&&l.has(t))return;let f,m,_;const S=this.connection.getPreMedia(n);if(S)k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),_=S.transceiver,f=S.track,m=S.id;else if(a){const O=a.find(G=>{let{stream_type:B}=G;return B===t});if(!O)throw new ve($.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const D=await this.connection.receive(t,O.ssrcs,String(e._uintid),O.attributes);this.connection instanceof Zl&&(_=D.transceiver),f=D.track,m=D.id}else{const O=await this.connection.receive(t,[{ssrcId:n,rtx:s}],String(e._uintid),void 0);this.connection instanceof Zl&&(_=O.transceiver),f=O.track,m=O.id}if(t===at.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(f):(e._audioTrack=new JE(f,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(f):(e._videoTrack=new XE(f,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&Z("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:O,interceptRemoteAudioFrame:D}=BR();t==at.VIDEO?await O(_.receiver,{onSei:Z("ENABLE_VIDEO_SEI")&&(G=>{var B;return(B=e._videoTrack)===null||B===void 0?void 0:B._onSei(G)})}):t==at.AUDIO&&await D(_.receiver,{enableTopn:!!Z("ENABLE_AUDIO_TOPN"),enableMetadata:!!Z("ENABLE_AUDIO_METADATA"),onMetadata:G=>{this.safeEmit(vt.AudioMetadata,G)}})}const b=this.remoteUserMap.get(e);b?b.set(t,m):this.remoteUserMap.set(e,new Map([[t,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const A=this.pendingRemoteTracks.findIndex(O=>{let{user:D,kind:G}=O;return D.uid===e.uid&&t===G});A!==-1&&(this.pendingRemoteTracks.splice(A,1),this.emit(vt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==mn.Connected)throw new ve($.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(a=>{var l;let{user:f,mediaType:m}=a;return!((l=this.remoteUserMap.get(f))!==null&&l!==void 0&&l.has(m))});const t=[],n=new Map;e.forEach(a=>{if(!this.connection)return;const l=this.connection.getPreMedia(a.ssrcId);l?n.set(a.ssrcId,l):t.push(a)});const s=await this.connection.batchReceive(t.map(a=>{let{user:l,mediaType:f,ssrcId:m,rtxSsrcId:_}=a;return{kind:f,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(l._uintid)}}));t.forEach((a,l)=>{n.set(a.ssrcId,s[l])});for(const{user:a,mediaType:l,ssrcId:f}of e){const m=n.get(f);if(!m)return void k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(a.uid," subscribe data,").concat(l,", ").concat(f));const{track:_,id:S,transceiver:b}=m;if(b&&Z("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:G}=BR();l==at.VIDEO?await D(b.receiver,{onSei:Z("ENABLE_VIDEO_SEI")&&(B=>{var j;return(j=a._videoTrack)===null||j===void 0?void 0:j._onSei(B)})}):l==at.AUDIO&&await G(b.receiver,{enableTopn:!!Z("ENABLE_AUDIO_TOPN"),enableMetadata:!!Z("ENABLE_AUDIO_METADATA"),onMetadata:B=>{this.safeEmit(vt.AudioMetadata,B)}})}if(l===at.AUDIO?(a._audioTrack?a._audioTrack._updateOriginMediaStreamTrack(_):(a._audioTrack=new JE(_,a.uid,a._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(a._audioTrack.getTrackId()))),b&&a._audioTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(a,a._audioTrack)):(a._videoTrack?a._videoTrack._updateOriginMediaStreamTrack(_):(a._videoTrack=new XE(_,a.uid,a._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(a._videoTrack.getTrackId()))),b&&a._videoTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(a,a._videoTrack)),Z("ENABLE_VIDEO_SEI")&&b){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:G}=BR();l==at.VIDEO?await D(b.receiver,{onSei:B=>{var j;(j=a._videoTrack)===null||j===void 0||j._onSei(B)}}):l==at.AUDIO&&await G(b.receiver)}const A=this.remoteUserMap.get(a);A?A.set(l,S):this.remoteUserMap.set(a,new Map([[l,S]])),this.statsCollector.addRemoteStats(a.uid),this.statsUploader.startUploadInboundStats();const O=this.pendingRemoteTracks.findIndex(D=>{let{user:G,kind:B}=D;return G.uid===a.uid&&l===B});O!==-1&&(this.pendingRemoteTracks.splice(O,1),this.emit(vt.MediaReconnectEnd,a.uid))}}async unsubscribe(e,t,n){const s=this.pendingRemoteTracks.filter(f=>{let{user:m,kind:_}=f;return t!==void 0?m.uid===e.uid&&t===_:m.uid===e.uid});if(s.forEach(f=>{const m=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===mn.Connected||n||s.forEach(f=>{let{kind:m}=f;var _;if(m===at.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(m===at.VIDEO){var S;(S=e._videoTrack)===null||S===void 0||S._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==mn.Connected)return;const a=this.filterTobeUnSubscribedTracks(e,t);if(a.length===0)return;await this.connection.stopReceiving(a.map(f=>{let[,{id:m}]=f;return m}));const l=this.createUnsubscribeMessage(a);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),a.forEach(f=>{let[m,{kind:_}]=f;var S,b;if(_===at.VIDEO&&m._videoSSRC&&((S=this.connection)===null||S===void 0||S.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===at.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),n||((b=m._videoTrack)===null||b===void 0||b._destroy(),m._videoTrack=void 0);else if(_===at.AUDIO){var A;this.unbindRemoteTrackEvents(m._audioTrack),!n&&((A=m._audioTrack)===null||A===void 0||A._destroy(),m._audioTrack=void 0)}}),l}async unsubscribeDataChannel(e,t){if(t.forEach(a=>{const l=this.pendingRemoteDataChannels.findIndex(f=>f.id===a.id);l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(a=>{a._close()});const s=this.remoteDataChannelMap.get(e);return n.forEach(a=>{s&&s.delete(a.id)}),s&&s.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(a=>a.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:a,mediaType:l}of e){const f=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:S}=m;return l!==void 0?_.uid===a.uid&&l===S:_.uid===a.uid});f.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),t=t.concat(f)}if(!this.connection||this.state!==mn.Connected)return void t.forEach(a=>{let{user:l,kind:f}=a;var m;if(f===at.AUDIO)(m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0;else if(f===at.VIDEO){var _;(_=l._videoTrack)===null||_===void 0||_._destroy(),l._videoTrack=void 0}});const n=jr(e).call(e,(a,l)=>{let{user:f,mediaType:m}=l;const _=this.filterTobeUnSubscribedTracks(f,m);return a.concat(_)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(a=>{let[,{id:l}]=a;return l}));const s=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(a=>{let[l,{kind:f}]=a;var m,_;if(f===at.VIDEO&&l._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),f===at.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),(_=l._videoTrack)===null||_===void 0||_._destroy(),l._videoTrack=void 0;else if(f===at.AUDIO){var S;this.unbindRemoteTrackEvents(l._audioTrack),(S=l._audioTrack)===null||S===void 0||S._destroy(),l._audioTrack=void 0}}),s}isPreSubScribe(e){return!this.connection||this.state!==mn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const s=t===at.VIDEO?e._videoSSRC:e._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(Le.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(Le.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Hi){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return a!==Le.LocalAudioTrack}).filter(s=>{let[a]=s;return!(e&&a===Le.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[s]=n;return!(e&&s===Le.LocalVideoLowTrack)}).map(n=>{let[,{track:s}]=n;return s})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,s,a){if(e){const f=this.localTrackMap.get(Le.LocalAudioTrack),m=s?this.localTrackMap.get(Le.LocalVideoLowTrack):this.localTrackMap.get(Le.LocalVideoTrack);gt.publish(this.store.sessionId,{eventElapse:Us.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:f==null?void 0:f.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(kn.SCREEN_TRACK))!==-1,audio:!!f,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var l;n||(n=[]);const f=n.find(_=>_ instanceof fi),m=s?(l=this.localTrackMap.get(Le.LocalVideoTrack))===null||l===void 0?void 0:l.track:n.find(_=>_ instanceof Kn);gt.publish(this.store.sessionId,{eventElapse:Us.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:f==null?void 0:f.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(kn.SCREEN_TRACK))!==-1,audio:!!f,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,n,s){const a=s===at.VIDEO?n._videoSSRC:n._audioSSRC;a&&gt.subscribe(this.store.sessionId,{succ:e,ec:t,video:s===at.VIDEO,audio:s===at.AUDIO,peerid:n.uid,subscribeRequestid:a,p2pid:this.store.p2pId,eventElapse:Us.measureFromSubscribeStart(this.store.clientId,a),preSsrc:this.isPreSubScribe(a)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ps("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=YR(this.store),this.emit(vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Le.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Hi){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=mn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Le.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Le.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Kn||t&&t.track instanceof fi?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Pa(t=this.remoteUserMap).call(t)).find(s=>s.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[s]=n;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Le.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=HS(e).call(e,(n,s)=>n.level-s.level),e}async disconnectForReconnect(){this.connection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=mn.Reconnecting,Z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=YR(this.store),this.emit(vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:s}]=e;switch(n){case Le.LocalVideoTrack:We(t=s._hints).call(t,kn.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case Le.LocalAudioTrack:s instanceof Hi?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case Le.LocalVideoLowTrack:}}),this.emit(vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Pa(n).call(n)).forEach(s=>{this.setPendingRemoteMedia(t,s)}),this.emit(vt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Pa(n).call(n)).forEach(s=>{this.setPendingRemoteDataChannel(t,s)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:s,id:a}=n;if((e instanceof Yh?e.uid:e)===s.uid&&a===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:s,kind:a}=n;if((e instanceof Yh?e.uid:e)===s.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return ro(function*(){if(!t.connection||t.state!==mn.Connected)return;const n=yield tn(t.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield tn(t.connection.restartICE(e));const l=yield tn(s.next());if(l.done)return;const f=l.value,m=yield f;switch(sD(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Ms.UDP_TCP_RELAY:t._pcStatsUploadType=uu.UDP_TCP_RESTART;break;case Ms.TCP_RELAY:t._pcStatsUploadType=uu.TCP_RESTART;break;case Ms.RELAY:t._pcStatsUploadType=uu.RELAY_RESTART;break;default:t._pcStatsUploadType=uu.OLD_RESTART}t._isTryConnecting=!0,s.next(m)}catch(l){var a;(a=s)===null||a===void 0||a.throw(l)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(Le.LocalVideoTrack),n=this.localTrackMap.get(Le.LocalAudioTrack),s=e.videoSend.find(D=>D.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),a=e.audioSend.find(D=>D.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!s||!a)return 1;const l=La(this,vt.NeedSignalRTT),f=s?s.rttMs:void 0,m=a?a.rttMs:void 0,_=f&&m?(f+m)/2:f||m,S=(_&&l?(_+l)/2:_||l)||0,b=100*e.sendPacketLossRate*.7/50+.3*S/1500,A=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,O=t==null?void 0:t.track;if(O&&O._encoderConfig&&O._hints.indexOf(kn.SCREEN_TRACK)===-1){const D=O._encoderConfig.bitrateMax,G=e.bitrate.actualEncoded;if(D&&G){const B=(1e3*D-G)/(1e3*D);return ZU[B<.15?0:B<.3?1:B<.45?2:B<.6?3:4][A]}}return A}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[s]=n;const a=s._audioSSRC,l=s._videoSSRC,f=e.audioRecv.find(G=>G.ssrc===a),m=e.videoRecv.find(G=>G.ssrc===l);if(!f&&!m)return void(t+=1);const _=La(this,vt.NeedSignalRTT),S=e.rtt,b=(S&&_?(S+_)/2:S||_)||0,A=f?f.jitterMs:void 0,O=e.recvPacketLossRate;let D=.7*O*100/50+.3*b/1500;A&&(D=.6*O*100/50+.2*b/1500+.2*A/400),t+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ye((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(k.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==mn.Connected)return;const s=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:f}]=l;return e===f});if(!s)return;const a=s[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:a}]),this.bindLocalTrackEvents([{track:t,type:a}]),s[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,s[1].id)),this.isPlanB){const l=s[1];l.id=t._mediaStreamTrack.id,this.localTrackMap.set(a,l)}if(a===Le.LocalVideoTrack&&!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&on().supportDualStreamEncoding){const l=this.localTrackMap.get(Le.LocalVideoLowTrack);if(l){const f=e._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=f,l.track._originMediaStreamTrack=f,await new Ye((m,_)=>{this.handleReplaceTrack(l.track,m,_,!0)})}}}filterTobePublishedTracks(e,t,n){const s=[],a=this.getAllTracks();e=UE(e=e.filter(_=>a.indexOf(_)===-1));let l,f=!1;const m=this.localTrackMap.get(Le.LocalAudioTrack);for(const _ of e){if(_ instanceof Kn&&(this.localTrackMap.has(Le.LocalVideoTrack)||f?new ve($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:_,type:Le.LocalVideoTrack}),f=!0),t)){const S=this.getLowVideoTrack(_,n);s.push({track:S,type:Le.LocalVideoLowTrack})}if(_ instanceof fi)if(m){const S=m.track;if(S instanceof Hi)nD([_]),S.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const b=iD([S,_]);k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(b.getTrackId(),"]")),this.replaceTrack(S,b)}}else l instanceof Hi?(nD([_]),l.addAudioTrack(_)):l||!_._useAudioElement&&on().webAudioMediaStreamDest&&!_._bypassWebAudio?l=iD(l?[_,l]:[_]):l=_}return l&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(l.getTrackId(),"]")),s.push({track:l,type:Le.LocalAudioTrack})),s}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=UE(e=e.filter(s=>n.indexOf(s)!==-1));for(const s of e){if(s instanceof fi){const a=this.localTrackMap.get(Le.LocalAudioTrack);if(!a)continue;a.track instanceof Hi?(a.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),a.track.trackList.length===0&&(t.push([Le.LocalAudioTrack,a]),a.track.close())):t.push([Le.LocalAudioTrack,a])}if(s instanceof Kn){const a=this.localTrackMap.get(Le.LocalVideoTrack);if(!a)continue;t.push([Le.LocalVideoTrack,a]);const l=this.localTrackMap.get(Le.LocalVideoLowTrack);l&&t.push([Le.LocalVideoLowTrack,l])}}return t}filterTobePublishedDataChannels(e){return e=(e=UE(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=UE(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:s}=t;switch(s){case Le.LocalVideoTrack:n.addListener(dt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(dt.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(dt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Le.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Le.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Hi?e.trackList.forEach(n=>{n.addListener(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(dt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(dt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(dt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:s}]=t;return{track:s,type:n}})),e.forEach(t=>{let{track:n,type:s}=t;switch(s){case Le.LocalVideoTrack:n.off(dt.GET_STATS,this.handleGetLocalVideoStats),n.off(dt.GET_RTC_STATS,this.handleGetRTCStats),n.off(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(dt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Le.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Le.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Hi?e.trackList.forEach(t=>{t.off(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(dt.GET_STATS,this.handleGetLocalAudioStats),t.off(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(dt.GET_STATS,this.handleGetLocalAudioStats),e.off(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(dt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof XE&&t.addListener(dt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof JE&&t.addListener(dt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(dt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(at.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(at.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,s)=>{var a;let l,f,{track:m,type:_}=n;switch(_){case Le.LocalAudioTrack:l=En.Audio,f={dtx:m instanceof _R&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Le.LocalVideoTrack:l=We(a=m._hints).call(a,kn.SCREEN_TRACK)?En.Screen:En.High,f=td(td({},EF(m)),{},{codec:this.store.codec,svc_mode:PR()});break;case Le.LocalVideoLowTrack:l=En.Low,f=td(td({},EF(m)),{},{codec:this.store.codec,svc_mode:PR()})}return{stream_type:l,attributes:f,ssrcs:t[s]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let s,[a,{track:l,ssrcs:f,id:m}]=t;switch(a){case Le.LocalVideoTrack:s=We(n=l._hints).call(n,kn.SCREEN_TRACK)?En.Screen:En.High;break;case Le.LocalAudioTrack:s=En.Audio;break;case Le.LocalVideoLowTrack:s=En.Low}return{stream_type:s,ssrcs:f,mid:m}})}assignLocalTracks(e,t){e.forEach((n,s)=>{let{track:a,type:l}=n;this.localTrackMap.set(l,{track:a,id:t[s].id,ssrcs:t[s].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(vt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Zl&&!oi()&&Z("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},Z("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Zl&&gB(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=uu.DISCONNECTED_OR_FAILED,La(this,vt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(a=>a.getTrackId()),s=this.pendingLocalDataChannels.map(a=>"dc_".concat(a.id));gt.reportApiInvoke(this.store.sessionId,{name:Fi.REPUB_AFTER_PC_CONNECTED,options:n.concat(s),tag:li.TRACER}).onSuccess(),this.republish()}if(Z("NEW_ICE_RESTART")&&e instanceof Zl&&!oi()&&!this._forceTurn){if(We(dF).call(dF,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=a=>{sD(e)&&(k.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(a)),La(this,vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(vt.RequestRestartICE,a))},s=()=>{sD(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),k.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{EB(e,n,s)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&Z("ICE_RESTART")&&La(this,vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(vt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(vt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),gt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:li.TRACER}).onSuccess(),this.emit(vt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const s=Array.from(Pa(n=this.remoteUserMap).call(n)).find(l=>l._audioSSRC===t);var a;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(a=s.audioTrack)===null||a===void 0||a.emit(WE.FIRST_FRAME_DECODED),gt.firstRemoteFrame(this.store.sessionId,Zi.FIRST_AUDIO_DECODE,Xn.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const s=Array.from(Pa(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);s&&gt.firstRemoteFrame(this.store.sessionId,Zi.FIRST_AUDIO_RECEIVED,Xn.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,s)=>{this.reportVideoFirstFrameDecoded(t,n,s)},e.onFirstVideoReceived=t=>{var n;const s=Array.from(Pa(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===t);s&&gt.firstRemoteFrame(this.store.sessionId,Zi.FIRST_VIDEO_RECEIVED,Xn.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const s=t.candidateType==="relay",a=n.candidateType==="relay";n.candidateType!=="unknown"&&s===a||this.emit(vt.ConnectionTypeChange,s),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Hh(n))," -> ").concat(JSON.stringify(Hh(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Hh(n))," -> ").concat(JSON.stringify(Hh(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return td(td({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Zl&&function(t){d_.delete(t.id),gB(t)}(e),e.close(),this.emit(vt.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Le.LocalAudioTrack);if(e instanceof fi&&(n==null?void 0:n.track)instanceof Hi)return n.track.isActive||t.push([Le.LocalAudioTrack,n]),t;const s=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(s&&(t.push(s),s[0]===Le.LocalVideoTrack)){const a=this.localTrackMap.get(Le.LocalVideoLowTrack);a&&t.push([Le.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Le.LocalAudioTrack);if(e instanceof fi&&(n==null?void 0:n.track)instanceof Hi)return n.track.isActive&&t.push([Le.LocalAudioTrack,n]),t;const s=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(s)if(s[0]===Le.LocalVideoTrack){t.push(s);const a=this.localTrackMap.get(Le.LocalVideoLowTrack);a&&t.push([Le.LocalVideoLowTrack,a])}else t.push(s);return t}createMuteMessage(e){return e.map(t=>{var n;let s,[a,{track:l,ssrcs:f,id:m}]=t;switch(a){case Le.LocalAudioTrack:s=En.Audio;break;case Le.LocalVideoTrack:s=We(n=l._hints).call(n,kn.SCREEN_TRACK)?En.Screen:En.High;break;case Le.LocalVideoLowTrack:s=En.Low}return{stream_type:s,ssrcs:f,mid:m}})}createUnmuteMessage(e){return e.map(t=>{var n;let s,[a,{track:l,ssrcs:f,id:m}]=t;switch(a){case Le.LocalAudioTrack:s=En.Audio;break;case Le.LocalVideoTrack:s=We(n=l._hints).call(n,kn.SCREEN_TRACK)?En.Screen:En.High;break;case Le.LocalVideoLowTrack:s=En.Low}return{stream_type:s,ssrcs:f,mid:m}})}filterTobeUnSubscribedTracks(e,t){const n=[],s=this.remoteUserMap.get(e);if(!s)return n;if(t){const a=s.get(t);if(!a)return n;n.push([e,{kind:t,id:a}])}else Array.from(s.entries()).forEach(a=>{let[l,f]=a;n.push([e,{kind:l,id:f}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(s=>{var a;(a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.has(s.id)&&n.push(s)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[s,{kind:a,id:l}]=n;switch(a){case at.VIDEO:return void(s._videoSSRC&&t.push({stream_type:at.VIDEO,ssrcId:s._videoSSRC}));case at.AUDIO:return void(s._audioSSRC&&t.push({stream_type:at.AUDIO,ssrcId:s._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[s,{kind:a}]=n;if(t.has(s)){let l=t.get(s);a===at.VIDEO?l|=es.Video:l|=es.Audio,t.set(s,l)}else a===at.VIDEO?t.set(s,es.Video):t.set(s,es.Audio)}),{users:Array.from(t.entries()).map(n=>{let[s,a]=n;return{stream_id:s.uid,stream_type:a}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:s}]=t;const a=this.remoteUserMap.get(n);a&&(a.delete(s),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Le.LocalVideoTrack),n=this.localTrackMap.get(Le.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ye((s,a)=>{this.handleUpdateVideoEncoder(t.track,s,a,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ye((s,a)=>{this.handleUpdateVideoEncoder(n.track,s,a,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t,n){return e.map((s,a)=>{var l;let{stream_type:f}=s;const m=(l=t.find(_=>{let{stream_type:S}=_;return f===S}))===null||l===void 0?void 0:l.attributes;if(m&&Z("DISABLE_SCREEN_SHARE_REMB")){const _=n[a]._hints;(We(_).call(_,kn.SCREEN_TRACK)||We(_).call(_,kn.SCREEN_LOW_TRACK))&&(m.remb=!1,k.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof fi){var t;const s=this.filterTobeUnmutedTracks(e[n]);if(s.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(s.map(l=>{let[,{id:f}]=l;return f})));const a=this.createUnmuteMessage(s);return void await xn(this,vt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(vt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(vt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await gs(Xw(this.dtlsFailedCount,Bi)),this.emit(vt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await ws(this,vt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(vt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Le.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Kn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Kn).length>1)throw new ve($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof fi).length>1&&(e.some(t=>t instanceof fi&&t._bypassWebAudio)||!on().webAudioMediaStreamDest))throw new ve($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Kn&&this.pendingLocalTracks.some(n=>n instanceof Kn))throw new ve($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof fi&&this.pendingLocalTracks.some(n=>n instanceof fi)&&(!on().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof fi&&n._bypassWebAudio)))throw new ve($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const s=!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&on().supportDualStreamEncoding,a=td(td({},{width:160,height:120,framerate:15,bitrate:50}),t);let l;l=s?e._mediaStreamTrack.clone():rD(e,a);const f=Pn(8,"track-low-"),m=new Kn(l,td(td({},s&&{scaleResolutionDownBy:jO(a,e)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,f);return m.on(nm.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,HE.LOW_STREAM)}),m._hints.push(kn.LOW_STREAM),We(n=e._hints).call(n,kn.SCREEN_TRACK)&&m._hints.push(kn.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),e.addListener(dt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Zl){var a,l,f,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:S,dtlsTransportState:b,peerConnectionState:A}=this.connection,{local:O,remote:D}=await this.connection.getSelectedCandidatePair();gt.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:S,dtlsstate:b,connectionstate:A,intSucc:t?1:2,error:this._iceError||s||"",selectedLocalCandidateProtocol:(a=O==null?void 0:O.protocol)!==null&&a!==void 0?a:"",selectedLocalCandidateType:(l=O.candidateType)!==null&&l!==void 0?l:"",selectedLocalCandidateAddress:"".concat(O.address,":").concat(O.port),selectedRemoteCandidateProtocol:(f=D.protocol)!==null&&f!==void 0?f:"",selectedRemoteCandidateType:(m=D.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,n,s){var a;const l=Array.from(Pa(a=this.remoteUserMap).call(a)).find(f=>f._videoSSRC===e);if(l){s||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,m=f.subscribe.find(_=>_.userId===l.uid&&_.type==="video");gt.firstRemoteVideoDecode(this.store.sessionId,Zi.FIRST_VIDEO_DECODE,Xn.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:n,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:s?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const s=this.remoteUserMap.get(e);if(!s)return!1;const a=s.get(t);if(!a)return!1;const l=await this.connection.getRemoteSSRC(a);return l!==void 0&&l!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Le.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,HE.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},ft(Ht.prototype,"startP2PConnection",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"startP2PConnection"),Ht.prototype),ft(Ht.prototype,"connect",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"connect"),Ht.prototype),ft(Ht.prototype,"updateRemoteRTPCapabilities",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"updateRemoteRTPCapabilities"),Ht.prototype),ft(Ht.prototype,"publishDataChannel",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"publishDataChannel"),Ht.prototype),ft(Ht.prototype,"unpublish",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"unpublish"),Ht.prototype),ft(Ht.prototype,"unpublishDataChannel",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"unpublishDataChannel"),Ht.prototype),ft(Ht.prototype,"unpublishLowStream",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"unpublishLowStream"),Ht.prototype),ft(Ht.prototype,"subscribeDataChannel",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"subscribeDataChannel"),Ht.prototype),ft(Ht.prototype,"subscribe",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"subscribe"),Ht.prototype),ft(Ht.prototype,"massSubscribe",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"massSubscribe"),Ht.prototype),ft(Ht.prototype,"unsubscribe",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"unsubscribe"),Ht.prototype),ft(Ht.prototype,"unsubscribeDataChannel",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"unsubscribeDataChannel"),Ht.prototype),ft(Ht.prototype,"massUnsubscribe",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"massUnsubscribe"),Ht.prototype),ft(Ht.prototype,"muteRemote",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"muteRemote"),Ht.prototype),ft(Ht.prototype,"unmuteRemote",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"unmuteRemote"),Ht.prototype),ft(Ht.prototype,"hasRemoteMediaWithLock",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"hasRemoteMediaWithLock"),Ht.prototype),ft(Ht.prototype,"disconnectForReconnect",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"disconnectForReconnect"),Ht.prototype),ft(Ht.prototype,"updateBitrateLimit",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"updateBitrateLimit"),Ht.prototype),ft(Ht.prototype,"remoteMediaSsrcChanged",[rr],Object.getOwnPropertyDescriptor(Ht.prototype,"remoteMediaSsrcChanged"),Ht.prototype),Ht);function rr(e,t,n){const s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,l=await a.lock("From P2PChannel.".concat(t));try{for(var f=arguments.length,m=new Array(f),_=0;_<f;_++)m[_]=arguments[_];return await s.apply(this,m)}finally{l()}},n}function yB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function TB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yB(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}const ez=Date.now(),tz=20,oD=new Map,QR=new Map;async function vB(e){const t=oD.get(e),n=Array.isArray(t)&&t[t.length-1],s=QR.get(e);if(!n)return void(s.isSyncing=!1);const a={uid:n.uid,payload:n.payload};s.firstRecvTs===0&&(s.firstRecvTs=n.recvTs,s.firstSendTs=n.sendTs);const l=n.sendTs-s.firstSendTs,f=l-(Date.now()-s.firstRecvTs);f>0&&(s.firstRecvTs=Date.now()-l);let m=n.mediaDelay+f;m<=0?(t.pop(),bB(n.context,a),m=0):m=Math.min(m,tz),setTimeout(()=>t.length&&vB(e),m)}function bB(e,t){e.safeEmit(Wt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function nz(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return bB(n,{uid:e.uid,payload:e.payload});const s="".concat(n.id,"-").concat(e.uid),a=oD.get(s)||[],l=a.findIndex(S=>e.sendTs>=S.sendTs),f=TB(TB({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});l===-1?a.push(f):a.splice(l,0,f),oD.set(s,a);let m=!1;var _;QR.has(s)?m=!((_=QR.get(s))===null||_===void 0||!_.isSyncing):QR.set(s,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||vB(s)}const iz=nn().name;function RB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function AB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RB(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}const u_="websdk_ng_cache_parameter",sz=Z("MAX_PRELOAD_ASYNC_LENGTH"),rz=1e4,mm=new Map,gm=[];let cD=null,lD=0,dD=0;const ZR=new Map,az=function(e,t){const n=[];let s=0;const a=async()=>{const l=n.shift();l&&await l(),n.length>0&&s<t?a():s--};return async function(){for(var l=arguments.length,f=new Array(l),m=0;m<l;m++)f[m]=arguments[m];return new Ye(async(_,S)=>{n.push(async()=>{try{const b=await e(...f);_(b)}catch(b){S(b)}}),s<t&&(s++,a())})}}(CB,sz),uD=Lr.CancelToken.source();async function CB(e,t,n,s,a,l){try{if(!Z("ENABLE_PRELOAD"))return;if(!on().supportWebCrypto)return void Uh(()=>{k.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new ve($.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ms(n,"token",1,2047),ms(e,"appid",1,2047),OR(t),s&&DR(s);const f=em();k.debug("preload channel ".concat(t,", uid is ").concat(s));const m={appId:e,cname:t,token:n||e,uid:typeof s!="string"?s:null,sid:f,proxyServer:a};let _,S;typeof s=="string"?(m.stringUid=s,[S,_]=await Ye.all([G$(s,{sid:f,appId:e},uD.token),$F(AB(AB({},m),{},{token:n||e,uid:0}),uD.token)]),m.uid=S.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(l&&(m.stringUid=l),_=await $F(m,uD.token));const b={sid:f,appId:e,cname:t,token:n||e,uid:m.stringUid||s,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:S,ap:_};await async function(A){let O;try{A.uid&&wB({appId:A.appId,cname:A.cname,token:A.token,uid:A.uid,stringUid:A.stringUid});const D=LB(A),G=await async function(j,Y){try{const q=await window.crypto.subtle.importKey("raw",_M(Y),"AES-GCM",!1,["encrypt"]),ie=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},q,Zp(window.btoa(JSON.stringify(j))));return Fh(new Uint8Array(ie))}catch{return}}(A,A.token||A.appId);if(!G)return;O=NB(u_);const B=O?JSON.parse(O):[];B.push({[D]:G}),B.length>Z("AP_CACHE_NUM")&&B.shift(),eA(u_,JSON.stringify(B))}catch(D){k.warn("Error caching server parameters:",D.message),eA(u_,"")}}(b),lD++}catch(f){throw dD++,function(m){cD||(cD=window.setTimeout(()=>{let S="";ZR.forEach((b,A)=>{S+="".concat(A,": ").concat(b," ;")}),gt.reportApiInvoke(null,{name:Fi.PRELOAD,options:{success:lD,failed:dD,err:S}}).onError(m),lD=0,dD=0,ZR.clear(),cD=null},rz));const _=ZR.get(m.code)||0;ZR.set(m.code,_+1)}(f),f}}async function IB(e){try{if(Z("AP_REQUEST_DETAIL")||Z("ENABLE_ROLE_SELECT_EDGE"))return;const t=wB(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(s,a){try{const l=await window.crypto.subtle.importKey("raw",_M(a),"AES-GCM",!1,["decrypt"]),f=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},l,Zp(s));return JSON.parse(window.atob(Fh(new Uint8Array(f))))}catch{return}}(t,e.token||e.appId);if(!n||!function(s,a){return s.cname===a.cname&&s.appId===a.appId&&s.token===a.token?a.stringUid?s.stringUid===a.stringUid:typeof a.uid=="number"?s.uid===a.uid:s.uid==a.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<Z("AP_CACHE_LIFETIME"))return n}catch(t){k.warn("Error get preloadInfo",t.message)}}function wB(e){let t;try{if(t=NB(u_),!t)return;const n=JSON.parse(t),s=LB(e),a=function(f,m){for(let _=f.length-1;_>=0;_--)if(m(f[_]))return _;return-1}(n,f=>s in f);if(a===-1)return;const l=n.splice(a,1)[0];return eA(u_,JSON.stringify(n)),l[s]}catch(n){k.warn("Error delete preload info: ".concat(t),n.message),eA(u_,"")}}function hD(e){if(e){let t=mm.get(e);t&&(window.clearTimeout(t),t=null,mm.delete(e)),We(gm).call(gm,e)||e.cloudProxyServer!=="disabled"||gm.push(e)}if(mm.size<Z("AP_CACHE_NUM")&&gm.length>0){const t=gm.shift();mm.set(t,window.setTimeout(async()=>{const{appId:n,cname:s,token:a,stringUid:l,uid:f,proxyServer:m}=t;try{await az(n,s,a,f,m,l),mm.has(t)&&hD(t)}catch(_){k.warn("update preload failed",_.message),OB(t)}},Z("AP_UPDATE_INTERVAL")))}}function OB(e){const t=gm.indexOf(e);t!==-1&&gm.splice(t,1);let n=mm.get(e);n&&(window.clearTimeout(n),n=null,mm.delete(e),hD())}function DB(e,t){const n=e.sua,s=e.ap;t&&n&&gt.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),gt.reportResourceTiming(e.ap.url,e.sid),gt.joinWebProxyAP(e.sid,{lts:s.requestTime,elapse:s.elapse,sucess:1,apServerAddr:s.url,turnServerAddrList:s.proxyInfo.addresses.map(a=>a.ip).join(","),eventType:"disabled",unilbsServerIds:[Ni.CHOOSE_SERVER,Ni.CLOUD_PROXY_FALLBACK].toString()}),gt.joinChooseServer(e.sid,{lts:s.requestTime,elapse:s.elapse,succ:!0,csAddr:s.url,opid:s.opid,serverList:s.gatewayInfo.gatewayAddrs.map(a=>a.address),ec:null,cid:s.gatewayInfo.cid.toString(),uid:s.gatewayInfo.uid.toString(),csIp:s.gatewayInfo.csIp,unilbsServerIds:[Ni.CHOOSE_SERVER].toString(),isHttp3:s.isHttp3})}function NB(e){return window.atob(window.localStorage.getItem(e)||"")}function eA(e,t){window.localStorage.setItem(e,window.btoa(t))}function LB(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),AM(t)}function oz(e){let t=function(){const n=dz.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,s){let a=n.appId;a!==void 0&&(Pi(s,10),$h(s,a));let l=n.cid;l!==void 0&&(Pi(s,16),Pi(s,l));let f=n.cname;f!==void 0&&(Pi(s,26),$h(s,f));let m=n.deviceId;m!==void 0&&(Pi(s,34),$h(s,m));let _=n.elapse;_!==void 0&&(Pi(s,40),zh(s,_));let S=n.fileSize;S!==void 0&&(Pi(s,48),zh(s,h_(S)));let b=n.height;b!==void 0&&(Pi(s,56),zh(s,h_(b)));let A=n.jpg;A!==void 0&&(Pi(s,66),Pi(s,A.length),PB(s,A));let O=n.networkType;O!==void 0&&(Pi(s,72),zh(s,h_(O)));let D=n.osType;D!==void 0&&(Pi(s,80),zh(s,h_(D)));let G=n.requestId;G!==void 0&&(Pi(s,90),$h(s,G));let B=n.sdkVersion;B!==void 0&&(Pi(s,98),$h(s,B));let j=n.sequence;j!==void 0&&(Pi(s,104),zh(s,h_(j)));let Y=n.sid;Y!==void 0&&(Pi(s,114),$h(s,Y));let q=n.timestamp;q!==void 0&&(Pi(s,120),zh(s,q));let ie=n.uid;ie!==void 0&&(Pi(s,128),Pi(s,ie));let le=n.vid;le!==void 0&&(Pi(s,136),Pi(s,le));let ue=n.width;ue!==void 0&&(Pi(s,144),zh(s,h_(ue)));let oe=n.service;oe!==void 0&&(Pi(s,152),Pi(s,oe));let ye=n.callbackData;ye!==void 0&&(Pi(s,162),Pi(s,ye.length),PB(s,ye));let Pe=n.ticket;Pe!==void 0&&(Pi(s,170),$h(s,Pe));let ze=n.vendorConfigs;ze!==void 0&&(Pi(s,178),$h(s,ze))}(e,t),function(n){let s=n.bytes,a=n.limit;return s.length===a?s:s.subarray(0,a)}(t)}function cz(e){return function(n){let s={};e:for(;!uz(n);){let a=Cy(n);switch(a>>>3){case 0:break e;case 1:s.code=Cy(n);break;case 2:s.msg=kB(n,Cy(n));break;case 3:s.requestId=kB(n,Cy(n));break;case 4:s.timestamp=hz(n,!1);break;default:lz(n,7&a)}}return s}({bytes:t=e,offset:0,limit:t.length});var t}function lz(e,t){switch(t){case 0:for(;128&ic(e););break;case 2:fD(e,Cy(e));break;case 5:fD(e,4);break;case 1:fD(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function h_(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let dz=[];function fD(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function uz(e){return e.offset>=e.limit}function tA(e,t){let n=e.bytes,s=e.offset,a=e.limit,l=s+t;if(l>n.length){let f=new Uint8Array(2*l);f.set(n),e.bytes=f}return e.offset=l,l>a&&(e.limit=l),s}function xB(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function PB(e,t){let n=tA(e,t.length);e.bytes.set(t,n)}function kB(e,t){let n=xB(e,t),s=String.fromCharCode,a=e.bytes,l="",f="";for(let m=0;m<t;m++){let _,S,b,A,O=a[m+n];(128&O)==0?f+=s(O):(224&O)==192?m+1>=t?f+=l:(_=a[m+n+1],(192&_)!=128?f+=l:(A=(31&O)<<6|63&_,A<128?f+=l:(f+=s(A),m++))):(240&O)==224?m+2>=t?f+=l:(_=a[m+n+1],S=a[m+n+2],(49344&(_|S<<8))!=32896?f+=l:(A=(15&O)<<12|(63&_)<<6|63&S,A<2048||A>=55296&&A<=57343?f+=l:(f+=s(A),m+=2))):(248&O)==240?m+3>=t?f+=l:(_=a[m+n+1],S=a[m+n+2],b=a[m+n+3],(12632256&(_|S<<8|b<<16))!=8421504?f+=l:(A=(7&O)<<18|(63&_)<<12|(63&S)<<6|63&b,A<65536||A>1114111?f+=l:(A-=65536,f+=s(55296+(A>>10),56320+(1023&A)),m+=3))):f+=l}return f}function $h(e,t){let n=t.length,s=0;for(let f=0;f<n;f++){let m=t.charCodeAt(f);m>=55296&&m<=56319&&f+1<n&&(m=(m<<10)+t.charCodeAt(++f)-56613888),s+=m<128?1:m<2048?2:m<65536?3:4}Pi(e,s);let a=tA(e,s),l=e.bytes;for(let f=0;f<n;f++){let m=t.charCodeAt(f);m>=55296&&m<=56319&&f+1<n&&(m=(m<<10)+t.charCodeAt(++f)-56613888),m<128?l[a++]=m:(m<2048?l[a++]=m>>6&31|192:(m<65536?l[a++]=m>>12&15|224:(l[a++]=m>>18&7|240,l[a++]=m>>12&63|128),l[a++]=m>>6&63|128),l[a++]=63&m|128)}}function ic(e){return e.bytes[xB(e,1)]}function MB(e,t){let n=tA(e,1);e.bytes[n]=t}function Cy(e){let t,n=0,s=0;do t=ic(e),n<32&&(s|=(127&t)<<n),n+=7;while(128&t);return s}function Pi(e,t){for(t>>>=0;t>=128;)MB(e,127&t|128),t>>>=7;MB(e,t)}function hz(e,t){let n,s=0,a=0,l=0;return n=ic(e),s=127&n,128&n&&(n=ic(e),s|=(127&n)<<7,128&n&&(n=ic(e),s|=(127&n)<<14,128&n&&(n=ic(e),s|=(127&n)<<21,128&n&&(n=ic(e),a=127&n,128&n&&(n=ic(e),a|=(127&n)<<7,128&n&&(n=ic(e),a|=(127&n)<<14,128&n&&(n=ic(e),a|=(127&n)<<21,128&n&&(n=ic(e),l=127&n,128&n&&(n=ic(e),l|=(127&n)<<7))))))))),{low:s|a<<28,high:a>>>4|l<<24,unsigned:t}}function zh(e,t){let n=t.low>>>0,s=(t.low>>>28|t.high<<4)>>>0,a=t.high>>>24,l=a===0?s===0?n<16384?n<128?1:2:n<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:a<128?9:10,f=tA(e,l),m=e.bytes;switch(l){case 10:m[f+9]=a>>>7&1;case 9:m[f+8]=l!==9?128|a:127&a;case 8:m[f+7]=l!==8?s>>>21|128:s>>>21&127;case 7:m[f+6]=l!==7?s>>>14|128:s>>>14&127;case 6:m[f+5]=l!==6?s>>>7|128:s>>>7&127;case 5:m[f+4]=l!==5?128|s:127&s;case 4:m[f+3]=l!==4?n>>>21|128:n>>>21&127;case 3:m[f+2]=l!==3?n>>>14|128:n>>>14&127;case 2:m[f+1]=l!==2?n>>>7|128:n>>>7&127;case 1:m[f]=l!==1?128|n:127&n}}const UB={},FB={},nA=4294967296,fz=nA*nA,pz=fz/2;VB(0,!0);const BB=VB(0),mz=Iy(0,-2147483648,!1),gz=Iy(-1,2147483647,!1);function VB(e,t){let n,s,a;return t?(a=0<=(e>>>=0)&&e<256)&&(s=FB[e],s)?s:(n=Iy(e,0,!0),a&&(FB[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(s=UB[e],s)?s:(n=Iy(e,e<0?-1:0,!1),a&&(UB[e]=n),n)}function Iy(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function jB(e,t){if(isNaN(e))return BB;{if(e<=-9223372036854776e3)return mz;if(e+1>=pz)return gz}return e<0?BB:Iy(e%nA|0,e/nA|0,t)}function GB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}class pD extends ii{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Qc.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),W(this,"name","AgoraRTCImageModeration"),W(this,"_connectionState",lo.CONNECTING),W(this,"_sequence",0),W(this,"_moderationStartTime",void 0),W(this,"_workerConnection",void 0),W(this,"_workerMessageLengthLimit",void 0),W(this,"_qualityRatio",void 0),W(this,"_connectInfo",void 0),W(this,"_cancelTokenSource",Lr.CancelToken.source()),W(this,"_retryConfig",void 0),W(this,"_moderationInterval",void 0),W(this,"_moderationTimer",null),W(this,"_moderationMode",1),W(this,"_quality",1),W(this,"_qualityTimer",null),W(this,"_ticket",void 0),W(this,"_moderationIntervalMinimum",void 0),W(this,"_uploadFailedNum",0),W(this,"_uploadNum",0),W(this,"_uploadTimer",null),W(this,"_extraInfo",void 0),W(this,"_vendor",""),W(this,"_encoder",new TextEncoder),W(this,"_moderationId",void 0),W(this,"inspectImage",()=>{if(this.connectionState!==lo.CONNECTED)throw new Ee($.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===lo.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Pn(5,"image-moderation-"),this._workerMessageLengthLimit=Z("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=Z("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=Z("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new gy("worker-"+this._moderationId,Bi),this.on(Qc.STATE_CHANGE,(s,a)=>{k.debug("[".concat(this._moderationId,"] Moderation operation :").concat(t_[s]," ").concat(a||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Qc.STATE_CHANGE,t_.CONNECT_AP),this._connectInfo=t;const s=this._cancelTokenSource.token;return this._retryConfig=n,new Ye((a,l)=>{this.on(Qc.CONNECTION_STATE_CHANGE,(f,m)=>{f===lo.CONNECTED&&a()}),this.requestAP(t,s,n).then(f=>{this.connectWorker(f)}).catch(f=>{l(f)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),k.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===lo.CONNECTED&&this.inspectImage()}async requestAP(t,n,s){const a=Z("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),l=await function(_,S,b,A){let{appId:O,areaCode:D,cname:G,sid:B,token:j,uid:Y}=S;o_++;const q="moderation_plugin",ie={service_name:q,json_body:JSON.stringify({appId:O,areaCode:D,cname:G,command:"allocateEdge",requestId:o_,seq:o_,sid:B,appToken:j,ts:Date.now(),uid:Y+""})};let le,ue,oe=_[0];return $c(async()=>{le=Date.now();const ye=await Zc(oe,{data:ie,cancelToken:b,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ue=Date.now()-le,ye.code!==0){const nt=new Ee($.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ye.code,{retry:!0,responseTime:ue});throw k.error(nt.toString()),nt}const Pe=JSON.parse(ye.json_body);if(Pe.code!==200){const nt=new Ee($.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Pe.code,", reason: ").concat(Pe.reason),{code:Pe.code,responseTime:ue});throw k.error(nt.toString()),nt}if(!Pe.servers||!Array.isArray(Pe.servers)||Pe.servers.length===0){const nt=new Ee($.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Pe.code,responseTime:ue});throw k.error(nt.toString()),nt}if(!Pe.servers.some(nt=>!!nt.wss)){const nt=new Ee($.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Pe.code,responseTime:ue});throw k.error(nt.toString()),nt}const ze=Z("IMAGE_MODERATION_WORKER_HOST");return{addressList:Pe.servers.map(nt=>{let{address:$t,wss:zt}=nt;if($t&&zt)return"wss://".concat($t.replace(/\./g,"-"),".").concat(ze,":").concat(zt,"/moderation")}).filter(nt=>!!nt),workerToken:Pe.workerToken,vid:Pe.vid,ticket:Pe.appTicket,responseTime:ue}},(ye,Pe)=>(gt.apworkerEvent(B,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(ye.addressList),firstSuccess:Pe===0,responseTime:ue,serverIp:_[Pe%_.length]}),!1),(ye,Pe)=>(gt.apworkerEvent(B,{success:!1,sc:ye.data&&ye.data.code||200,serviceName:q,responseTime:ue,serverIp:_[Pe%_.length]}),!!(ye.code!==$.OPERATION_ABORTED&&ye.code!==$.UNEXPECTED_RESPONSE||ye.data&&ye.data.retry)&&(oe=_[(Pe+1)%_.length],!0)),A)}(a,t,n,s);this.emit(Qc.STATE_CHANGE,t_.AP_CONNECTED);const{addressList:f,ticket:m}=l;return this._ticket=m,f}async connectWorker(t){this.emit(Qc.STATE_CHANGE,t_.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(kt.CONNECTED,async()=>{this.emit(Qc.STATE_CHANGE,t_.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=lo.CONNECTED}),this._workerConnection.on(kt.CLOSED,()=>{this.connectionState=lo.CLOSED}),this._workerConnection.on(kt.FAILED,()=>{this.connectionState=lo.CLOSED}),this._workerConnection.on(kt.RECONNECTING,()=>{this.connectionState=this.connectionState===lo.CONNECTED?lo.RECONNECTING:lo.CONNECTING}),this._workerConnection.on(kt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=cz(new Uint8Array(t.data));Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,k.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{gt.reportApiInvoke(this._connectInfo.sid||null,{name:Fi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:li.TRACER}).onError(new Ee($.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},Z("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else k.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(kt.WILL_RECONNECT,(t,n,s)=>{t==="recover"&&s(t),s("tryNext")}),this._workerConnection.on(kt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=La(this,Qc.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being played can be inspected"));this._sequence++;const s=await this.generateRequestData(t,n);this._workerConnection.sendMessage(s,!0,!0)}else Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:s,cname:a,cid:l,vid:f,sid:m,uid:_}=n;const S=Date.now(),b=await t.getCurrentFrameImage("image/jpeg",this.quality),A=await p2(b,s,a),O=this._sequence+"-"+l+"-"+_+"-"+S+"-"+Pn(12,""),D={appId:s,cid:l,cname:a,deviceId:"",elapse:pD.intToLong(Number(S-this._moderationStartTime)),fileSize:b.buffer.byteLength,height:b.height,width:b.width,jpg:A,networkType:6,osType:7,requestId:O,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:jB(S),uid:_,vid:f,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete D.callbackData;const G=oz(D);if(G.byteLength<this._workerMessageLengthLimit){if(Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const B=function(j){for(var Y=1;Y<arguments.length;Y++){var q=arguments[Y]!=null?arguments[Y]:{};Y%2?GB(Object(q),!0).forEach(function(ie){W(j,ie,q[ie])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(q)):GB(Object(q)).forEach(function(ie){Object.defineProperty(j,ie,Object.getOwnPropertyDescriptor(q,ie))})}return j}({},D);delete B.jpg,k.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(B))}return G}{const B=this.quality*this._qualityRatio;return this.quality=B,await this.generateRequestData(t,{appId:s,cname:a,cid:l,vid:f,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Lr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=lo.CLOSED,this.emit(Qc.STATE_CHANGE,t_.CLOSED)}}function HB(e){if(An(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Ee($.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Ee($.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Ez={name:"ImageModeration",create:function(e){let{config:t}=e;return HB(t),new pD(t)}};var KB,WB,YB,qB,$B,zB,XB,JB,QB,ZB,eV,tV,nV,iV,sV,rV,aV,oV,cV,lV,dV,uV,hV,fV,pV,mV,gV,EV,_V,SV,yV,TV,vV,bV,RV,AV,CV,IV,wV,OV,DV,et;function NV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function sc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?NV(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NV(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}Ps.setLogger(k);let _z=(KB=Ct(),WB=Ct({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof qE))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),YB=Ct({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==YE.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),qB=Ct({argsMap:(e,t,n,s)=>[typeof t=="object"?t.uid:t,n,s]}),$B=Ct({argsMap:(e,t,n)=>[t,n]}),zB=Ct({argsMap:(e,t)=>t.map(n=>{let{user:s,mediaType:a}=n;return[s==null?void 0:s.uid,a]})}),XB=Ct({argsMap:(e,t,n,s)=>[typeof t=="object"?t.uid:t,n,s]}),JB=Ct({argsMap:(e,t)=>t.map(n=>{let{user:s,mediaType:a}=n;return{uid:s==null?void 0:s.uid,mediaType:a}})}),QB=Ct(),ZB=Ct(),eV=Ct(),tV=Ct(),nV=Ct(),iV=Ct(),sV=Ct(),rV=Ct(),aV=Ct(),oV=Ct(),cV=Ct(),lV=Ct(),dV=Ct(),uV=Ct(),hV=Ct(),fV=Ct({argsMap:(e,t)=>[t]}),pV=Ct(),mV=Ct(),gV=Ct(),EV=Ct(),_V=Ct(),SV=Ct(),yV=Ct(),TV=Ct(),vV=Ct({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),bV=Ct(),RV=Ct(),AV=Ct(),CV=Ct(),IV=Ct(),wV=Ct(),OV=Ct({reportResult:!0}),DV=Ct(),et=class extends ii{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),W(this,"store",void 0),W(this,"_uid",void 0),W(this,"_channelName",void 0),W(this,"_uintUid",void 0),W(this,"_users",[]),W(this,"_config",void 0),W(this,"_clientId",void 0),W(this,"_appId",void 0),W(this,"_sessionId",null),W(this,"_key",void 0),W(this,"_rtmConfig",{}),W(this,"_joinInfo",void 0),W(this,"_gateway",void 0),W(this,"_statsCollector",void 0),W(this,"_configDistribute",void 0),W(this,"_leaveMutex",void 0),W(this,"_publishMutex",void 0),W(this,"_renewTokenMutex",void 0),W(this,"_subscribeMutex",void 0),W(this,"_encryptionMode","none"),W(this,"_encryptionSecret",null),W(this,"_encryptionSalt",null),W(this,"_encryptDataStream",!1),W(this,"_encryptDataStreamKey",null),W(this,"_encryptDataStreamIv",null),W(this,"_proxyServer",void 0),W(this,"_turnServer",{servers:[],mode:"auto"}),W(this,"_cloudProxyServerMode","disabled"),W(this,"_isDualStreamEnabled",!1),W(this,"_defaultStreamFallbackType",void 0),W(this,"_lowStreamParameter",void 0),W(this,"_streamFallbackTypeCacheMap",new Map),W(this,"_remoteStreamTypeCacheMap",new Map),W(this,"_axiosCancelSource",Lr.CancelToken.source()),W(this,"_audioVolumeIndicationInterval",void 0),W(this,"_networkQualityInterval",void 0),W(this,"_userOfflineTimeout",void 0),W(this,"_streamRemovedTimeout",void 0),W(this,"_liveTranscodeStreamingClient",void 0),W(this,"_liveRawStreamingClient",void 0),W(this,"_channelMediaRelayClient",void 0),W(this,"_networkQualitySensitivity","normal"),W(this,"_p2pChannel",void 0),W(this,"_useLocalAccessPoint",!1),W(this,"_setLocalAPVersion",void 0),W(this,"_joinAndNotLeaveYet",!1),W(this,"_numberOfJoinCount",0),W(this,"_remoteDefaultVideoStreamType",void 0),W(this,"_inspect",void 0),W(this,"_moderation",void 0),W(this,"_license",void 0),W(this,"_pendingPublishedUsers",[]),W(this,"ntpAlignErrorCount",0),W(this,"remoteInboundOffset",0),W(this,"_peerConnectionState",void 0),W(this,"_handleLocalTrackEnable",(a,l,f)=>{this.publish(a,!1).then(l).catch(f)}),W(this,"_handleLocalTrackDisable",(a,l,f)=>{this.unpublish(a).then(l).catch(f)}),W(this,"_handleUserOnline",a=>{if(Z("BLOCK_LOCAL_CLIENT")&&cm(a.uid,this.channelName))return void k.debug("[".concat(a.uid,"] will be ignored in local"));this.isStringUID&&typeof a.uid!="string"&&k.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const l=this._users.find(f=>f.uid===a.uid);if(l)l._trust_in_room_=!0,l._is_pre_created&&(l._is_pre_created=!1,this.safeEmit(Wt.USER_JOINED,l));else{const f=new Yh(a.uid,a.uint_id||a.uid);this._users.push(f),k.debug("[".concat(this._clientId,"] user online"),a.uid),this.safeEmit(Wt.USER_JOINED,f)}}),W(this,"_handleUserOffline",a=>{if(Z("BLOCK_LOCAL_CLIENT")&&cm(a.uid,this.channelName))return;const l=this._users.find(f=>f.uid===a.uid);l&&(this._handleRemoveStream(a),this._handleRemoveDataChannels(a),l._audio_pre_subscribed||l._video_pre_subscribed?l._is_pre_created=!0:sR(this._users,l),this._remoteStreamTypeCacheMap.delete(l.uid),this._streamFallbackTypeCacheMap.delete(l.uid),k.debug("[".concat(this._clientId,"] user offline"),a.uid,"reason:",a.reason),this.safeEmit(Wt.USER_LEAVED,l,a.reason))}),W(this,"_handleAddAudioOrVideoStream",(a,l,f,m,_,S,b)=>{if(Z("BLOCK_LOCAL_CLIENT")&&cm(l,this.channelName))return;const A=this._users.find(D=>D.uid===l);if(!A)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(a)),this.store.subscribe(A.uid,a,void 0,void 0,void 0,Date.now());const O=a==="audio"?A.hasAudio:A.hasVideo;A._uintid||(A._uintid=_||l),a==="audio"?A._trust_audio_stream_added_state_=!0:A._trust_video_stream_added_state_=!0,a==="audio"?(A._audio_added_=!0,f!==void 0&&(A._audioSSRC=f),m!==void 0&&(A._cname=m),S&&(A._audioOrtc=S)):(A._video_added_=!0,f!==void 0&&(A._videoSSRC=f),m!==void 0&&(A._cname=m),b!==void 0&&(A._rtxSsrcId=b),S&&(A._videoOrtc=S)),(a==="audio"?A.hasAudio:A.hasVideo)&&!O&&(k.info("[".concat(this._clientId,"] remote user ").concat(A.uid," published ").concat(a)),this.safeEmit(Wt.USER_PUBLISHED,A,a)),a==="video"?gt.onGatewayStream(this._sessionId,Zi.ON_ADD_VIDEO_STREAM,Xn.ON_ADD_VIDEO_STREAM,{peer:_||l,ssrc:A._videoSSRC}):gt.onGatewayStream(this._sessionId,Zi.ON_ADD_AUDIO_STREAM,Xn.ON_ADD_AUDIO_STREAM,{peer:_||l,ssrc:A._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(A,a,f).then(D=>{if(D&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(A.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Ay))return this._p2pChannel.unsubscribe(A,a,!0).then(()=>this._subscribe(A,a,!0).catch(G=>{k.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(A,a)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(A.uid," after reconnect.")),this._subscribe(A,a,!0).catch(D=>{k.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}))}),W(this,"_handleRemoveStream",a=>{if(Z("BLOCK_LOCAL_CLIENT")&&cm(a.uid,this.channelName))return;const l=this._users.find(m=>m.uid===a.uid);if(!l)return void k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));k.debug("[".concat(this._clientId,"] stream removed with uid ").concat(a.uid));let f=()=>{};l.hasAudio&&l.hasVideo?f=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(Wt.USER_UNPUBLISHED,l,"audio"),k.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(Wt.USER_UNPUBLISHED,l,"video")}:l.hasVideo?f=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(Wt.USER_UNPUBLISHED,l,"video")}:l.hasAudio&&(f=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(Wt.USER_UNPUBLISHED,l,"audio")}),l._video_pre_subscribed||l._audio_pre_subscribed||(l._trust_audio_stream_added_state_=!0,l._trust_video_stream_added_state_=!0,l._audio_added_=!1,l._video_added_=!1,this._p2pChannel instanceof Ay&&this._p2pChannel.unsubscribe(l).then(m=>{if(m)return this._gateway.unsubscribe(m,l.uid)}),l._audioSSRC=void 0,l._videoSSRC=void 0,l._audioOrtc=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),gt.onGatewayStream(this._sessionId,Zi.ON_REMOVE_STREAM,Xn.ON_REMOVE_STREAM,{peer:a.uint_id||a.uid}),f()}),W(this,"_handleSetStreamLocalEnable",(a,l,f)=>{if(Z("BLOCK_LOCAL_CLIENT")&&cm(l,this.channelName))return;const m=this._users.find(b=>b.uid===l);if(!m)return void k.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));k.debug("[".concat(this._clientId,"] local ").concat(a," ").concat(f?"enabled":"disabled"," with uid ").concat(l));const _=a==="audio"?m.hasAudio:m.hasVideo;if(a==="audio"){m._trust_audio_enabled_state_=!0;const b=m._audio_enabled_;if(m._audio_enabled_=f,m._audio_enabled_===b)return;{const A=m._audio_enabled_?"enable-local-audio":"disable-local-audio";k.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(l,", msg: ").concat(A)),this.safeEmit(Wt.USER_INFO_UPDATED,l,A)}}else{m._trust_video_enabled_state_=!0;const b=m._video_enabled_;if(m._video_enabled_=f,m._video_enabled_===b)return;{const A=m._video_enabled_?"enable-local-video":"disable-local-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(A)),this.safeEmit(Wt.USER_INFO_UPDATED,l,A)}}const S=a==="audio"?m.hasAudio:m.hasVideo;return _!==S?!_&&S?(k.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(a)),void this.safeEmit(Wt.USER_PUBLISHED,m,a)):(a==="video"&&m._videoTrack&&m._videoTrack._destroy(),a==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,a),k.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(a)),void this.safeEmit(Wt.USER_UNPUBLISHED,m,a)):void 0}),W(this,"_handleMuteStream",(a,l,f)=>{if(Z("BLOCK_LOCAL_CLIENT")&&cm(a,this.channelName))return;k.debug("[".concat(this._clientId,"] receive mute message"),a,l,f);const m=this._users.find(b=>b.uid===a);if(!m)return void k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a));const _=l==="audio"?m.hasAudio:m.hasVideo;if(l==="audio"){m._trust_audio_mute_state_=!0;const b=m._audio_muted_;if(m._audio_muted_=f,m._audio_muted_===b)return;{const A=m._audio_muted_?"mute-audio":"unmute-audio";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(A)),this.safeEmit(Wt.USER_INFO_UPDATED,a,A)}}else{m._trust_video_mute_state_=!0;const b=m._video_muted_;if(m._video_muted_=f,m._video_muted_===b)return;{const A=m._video_muted_?"mute-video":"unmute-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(A)),this.safeEmit(Wt.USER_INFO_UPDATED,a,A)}}const S=l==="audio"?m.hasAudio:m.hasVideo;if(_!==S){if(!_&&S)return(l==="audio"?m._audioSSRC:m._videoSSRC)?(k.info("[".concat(this._clientId,"] remote user ").concat(a," published ").concat(l)),void this.safeEmit(Wt.USER_PUBLISHED,m,l)):void k.warning("[".concat(this._clientId,"] remote user ").concat(a," receive ").concat(l," unmute message  before add stream message, ").concat(l," SSRC doesn't exist yet."));l==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),l==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,l),k.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished ").concat(l)),this.safeEmit(Wt.USER_UNPUBLISHED,m,l)}}),W(this,"_handleP2PLost",async a=>{k.debug("[".concat(this._clientId,"] receive p2p lost"),a),parseInt(a.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():k.warning("[".concat(this._clientId,"] P2PLost stream not found"),a)}),W(this,"_handleTokenWillExpire",()=>{k.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Wt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),W(this,"_handleBeforeUnload",a=>{a.type==="beforeunload"&&a.returnValue!==void 0&&a.returnValue!==""||(this.leave(),k.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),W(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Wt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const a={downlinkNetworkQuality:0,uplinkNetworkQuality:0};a.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),a.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Wt.NETWORK_QUALITY,a)}),W(this,"_handleP2PAddAudioOrVideoStream",(a,l,f,m)=>{const _=this._users.find(b=>b.uid===l);if(!_)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(a)),this.store.subscribe(_.uid,a,void 0,void 0,void 0,Date.now());const S=a==="audio"?_.hasAudio:_.hasVideo;a==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,a==="audio"?(_._audio_added_=!0,f!==void 0&&(_._audioSSRC=f),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,f!==void 0&&(_._videoSSRC=f),m!==void 0&&(_._videoMid=m)),(a==="audio"?_.hasAudio:_.hasVideo)&&!S&&(k.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(a)),this.safeEmit(Wt.USER_PUBLISHED,_,a)),this._p2pChannel.hasPendingRemoteMedia(_,a)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,a,!0).catch(b=>{k.error("[".concat(this._clientId,"] resubscribe error"),b.toString())}))}),this._config=e,this._clientId=t||Pn(5,"client-"),this.store=new class{constructor(a,l,f,m){Lt(this,"state",void 0),this.state={codec:a,audioCodec:l,mode:f,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:tm.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(a){this.state=function(l,f){switch(f.type){case Yt.SET_SESSION_ID:return rt(rt({},l),{},{sessionId:f.sessionId});case Yt.SET_P2P_ID:return rt(rt({},l),{},{p2pId:f.p2pId});case Yt.SET_UID:return rt(rt({},l),{},{uid:f.uid});case Yt.SET_INT_UID:return rt(rt({},l),{},{intUid:f.intUid});case Yt.SET_PUB_ID:return rt(rt({},l),{},{pubId:f.pubId});case Yt.KEY_METRIC_CLIENT_CREATED:return rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{clientCreated:f.metric})});case Yt.KEY_METRIC_JOIN_START:return rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{joinStart:f.metric})});case Yt.AVOID_JOIN_START:return rt(rt({},l),{},{avoidJoinStart:f.avoidJoinStart});case Yt.KEY_METRIC_JOIN_END:return rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{joinEnd:f.metric})});case Yt.KEY_METRIC_REQUEST_AP_START:return rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{requestAPStart:f.metric})});case Yt.KEY_METRIC_REQUEST_AP_END:return rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{requestAPEnd:f.metric})});case Yt.KEY_METRIC_JOIN_GATEWAY_START:return rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{joinGatewayStart:f.metric})});case Yt.KEY_METRIC_JOIN_GATEWAY_END:return rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{joinGatewayEnd:f.metric})});case Yt.KEY_METRIC_PEER_CONNECTION_START:return rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{peerConnectionStart:f.metric})});case Yt.KEY_METRIC_PEER_CONNECTION_END:return rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{peerConnectionEnd:f.metric})});case Yt.KEY_METRIC_DESCRIPTION_START:return rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{descriptionStart:f.metric})});case Yt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{signalChannelOpen:f.metric})});case Yt.KEY_METRIC_ICE_CONNECTION_END:return rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{iceConnectionEnd:f.metric})});case Yt.KEY_METRIC_PUBLISH:{const m=l.keyMetrics.publish,_=m.findIndex(S=>S.trackId===f.metric.trackId);return _!==-1?(m[_]=rt(rt({},m[_]),f.metric),rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{publish:[...m]})})):rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{publish:[...l.keyMetrics.publish,f.metric]})})}case Yt.KEY_METRIC_SUBSCRIBE:{const m=l.keyMetrics.subscribe,_=m.findIndex(S=>S.userId===f.metric.userId&&S.type===f.metric.type);return _!==-1?(m[_]=rt(rt({},m[_]),f.metric),rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{subscribe:[...m]})})):rt(rt({},l),{},{keyMetrics:rt(rt({},l.keyMetrics),{},{subscribe:[...l.keyMetrics.subscribe,f.metric]})})}case Yt.SET_CLOUD_PROXY_SERVER_MODE:return l.cloudProxyServerMode=f.mode,l;case Yt.RECORD_JOIN_CHANNEL_SERVICE:return typeof f.index!="number"?l.joinChannelServiceRecords=[...l.joinChannelServiceRecords,f.record]:(l.joinChannelServiceRecords[f.index]=rt(rt({},l.joinChannelServiceRecords[f.index]),f.record),l.joinChannelServiceRecords=[...l.joinChannelServiceRecords]),l;case Yt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return l.joinChannelServiceRecords=[],l;case Yt.RESET_KEY_METRICS:return l.keyMetrics={publish:[],subscribe:[]},l;case Yt.SET_USE_P2P:return rt(rt({},l),{},{useP2P:f.val});case Yt.SET_TRANSPORT_TYPE:return rt(rt({},l),{},{p2pTransport:f.val});default:return l}}(this.state,a)}set sessionId(a){this.dispatch({type:Yt.SET_SESSION_ID,sessionId:a})}get sessionId(){return this.state.sessionId}set cid(a){this.state.cid=a}get cid(){return this.state.cid}set codec(a){this.state.codec=a}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(a){this.dispatch({type:Yt.SET_P2P_ID,p2pId:a})}get p2pId(){return this.state.p2pId}set dcId(a){this.dispatch({type:Yt.SET_DC_ID,dcId:a})}get dcId(){return this.state.dcId}set uid(a){this.dispatch({type:Yt.SET_UID,uid:a})}get uid(){return this.state.uid}set intUid(a){this.dispatch({type:Yt.SET_INT_UID,intUid:a})}get intUid(){return this.state.intUid}set pubId(a){this.dispatch({type:Yt.SET_PUB_ID,pubId:a})}get pubId(){return this.state.pubId}set cloudProxyServerMode(a){this.dispatch({type:Yt.SET_CLOUD_PROXY_SERVER_MODE,mode:a})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(a){this.dispatch({type:Yt.SET_USE_P2P,val:a})}get useP2P(){return this.state.useP2P}set p2pTransport(a){this.dispatch({type:Yt.SET_TRANSPORT_TYPE,val:a})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(a){this.state.hasStartJoinChannel=a}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(a){this.state.isABTestSuccess=a}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Yt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Yt.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Yt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Yt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Yt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Yt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Yt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Yt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Yt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Yt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Yt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Yt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(a,l,f,m){this.dispatch({type:Yt.KEY_METRIC_PUBLISH,metric:rt(rt({trackId:a,type:l},f&&{publishStart:f}),m&&{publishEnd:m})})}subscribe(a,l,f,m,_,S,b){this.dispatch({type:Yt.KEY_METRIC_SUBSCRIBE,metric:rt(rt(rt(rt(rt({userId:a,type:l},f&&{subscribeStart:f}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),S&&{streamAdded:S}),b&&{firstDecoded:b})})}massSubscribe(a,l,f,m){a.forEach(_=>{this.dispatch({type:Yt.KEY_METRIC_SUBSCRIBE,metric:rt(rt(rt({userId:_.userId,type:_.type},l&&{subscribeStart:l}),f&&{subscribeEnd:f}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(a,l){a.service==="gateway"&&Array.isArray(a.urls)&&(a.urls=a.urls.map(f=>f.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof l!="number"?(this.dispatch({type:Yt.RECORD_JOIN_CHANNEL_SERVICE,record:rt(rt({},a),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(l<0||l>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Yt.RECORD_JOIN_CHANNEL_SERVICE,record:a,index:l}),l)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Yt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Yt.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(a){this.dispatch({type:Yt.AVOID_JOIN_START,avoidJoinStart:a})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Ps("client-leave",this._clientId),this._publishMutex=new Ps("client-publish",this._clientId),this._renewTokenMutex=new Ps("client-renewtoken",this._clientId),this._subscribeMutex=new Ps("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),k.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(ao," build: ").concat(aO,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{qw(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(a){k.warning("[".concat(this._clientId,"] ").concat(a.toString()))}var s;this._statsCollector=new by(this.store),this._statsCollector.onStatsException=(a,l,f)=>{k.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(a,", msg: ").concat(l,", uid: ").concat(f)),this.safeEmit(Wt.EXCEPTION,{code:a,msg:l,uid:f})},this._statsCollector.onUploadPublishDuration=(a,l,f,m)=>{const _=this._users.find(S=>S.uid===a);_&&gt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:l,videoPublishDuration:f,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new M$(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Bi,httpRetryConfig:e.httpRetryConfig||Bi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new Y$(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(s={store:this.store,statsCollector:this._statsCollector},hu("P2PChannel").create(s)),this._handleP2PEvents()):this._p2pChannel=new Ay(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,s,a){let l=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],f=arguments.length>6&&arguments[6]!==void 0&&arguments[6];vn("JOIN_GATEWAY_USE_443PORT_ONLY",l),vn("JOIN_GATEWAY_USE_DUAL_DOMAIN",f);const m=this._gateway.signal.websocket;return m instanceof BO&&(m.use443PortOnly=l,m.tryDoubleDomain=f),async function(_,S,b){Zb.get(_)||Zb.set(_,[]),eR.get(_)||eR.set(_,S),Wl.get(_)||Wl.set(_,0);const A=Zb.get(_),O=eR.get(_);if(!A||!O)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Wl.get(_)===O){const Y=ey();A.push(Y),await Y.promise}Wl.set(_,Wl.get(_)+1);for(var D=arguments.length,G=new Array(D>3?D-3:0),B=3;B<D;B++)G[B-3]=arguments[B];const j=await b(...G);return Wl.set(_,Wl.get(_)-1),Wl.get(_)===O-1&&A.length>0&&(A[0].resolve(),A.shift()),Wl.get(_)===0&&(Zb.set(_,[]),eR.set(_,0),Wl.set(_,0)),j}("client.join",Z("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,s,a)}async join(e,t,n,s,a){const l=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const f=(oR||oR||(oR=(window.location.protocol.split(":")[0]||"").toUpperCase(),oR))==="HTTPS",m=wM()?window.isSecureContext:"Browser Not Support";(!wM()&&!f||!window.isSecureContext)&&k.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),k.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),gt.setAppId(e);try{if(!n&&n!==null)throw new Ee($.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ms(n,"token",1,2047),ms(e,"appid",1,2047),OR(t),s&&DR(s),a&&ms(a,"optionalInfo",1,2047)}catch(B){throw gt.reportApiInvoke(em(),{name:Fi.JOIN,options:[e,t,n,s],states:{isHttps:f,isSecureContext:m},tag:li.TRACER}).onError(B),B}if(this._leaveMutex.isLocked&&(k.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),k.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const B=new Ee($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw gt.reportApiInvoke(em(),{name:Fi.JOIN,options:[e,t,n,s],states:{isHttps:f,isSecureContext:m},tag:li.TRACER}).onError(B),B}this._gateway.state="CONNECTING";const _=await IB({appId:e,cname:t,uid:s,stringUid:typeof s=="string"?s:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Ee($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const S=(_==null?void 0:_.sid)||em();k.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(l)),this._sessionId||(this._sessionId=S,this.store.sessionId=this._sessionId);const b=gt.reportApiInvoke(S,{id:this._clientId,name:Fi.JOIN,options:[e,t,n,s],states:{isHttps:f,isSecureContext:m},tag:li.TRACER}),A=sc(sc(sc({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:a,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:Z("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(A.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(A.stringUid=s,this._uintUid?(A.uid=this._uintUid,this._uintUid=void 0):A.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(A.aesmode=this._encryptionMode,A.aespassword=await(async B=>{const j=function(le){const ue=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),oe=new Uint8Array(new ArrayBuffer(ue.length));for(let ye=0;ye<ue.length;ye+=1)oe[ye]=ue.charCodeAt(ye);return oe}(),Y=await window.crypto.subtle.importKey("spki",j,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),q=Ww(B),ie=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Y,q);return function(le){let ue="";for(let oe=0;oe<le.length;oe+=1)ue+=String.fromCharCode(le[oe]);return window.btoa(ue)}(new Uint8Array(ie))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Ee($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(A.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const B=new TextEncoder,j=Z("USE_PURE_ENCRYPTION_MASTER_KEY")?B.encode(A.appId+this._encryptionSecret+this._encryptionSecret):B.encode(A.appId+A.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Y,q,ie){const le=await window.crypto.subtle.importKey("raw",q,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=Y==="aes-128-gcm2"?128:256,oe=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:FM,hash:"SHA-256",salt:ie},le,ue+hq);return new Uint8Array(oe).subarray(ue/8)}(this._encryptionMode,j,Zp(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Y,q,ie){const le=await window.crypto.subtle.importKey("raw",q,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=Y==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:FM,hash:"SHA-256",salt:ie},le,{name:"AES-GCM",length:ue},!0,["encrypt","decrypt"])}(this._encryptionMode,j,Zp(this._encryptionSalt))}else m?k.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):k.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,k.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:A.stringUid});const O=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&O===this._sessionId&&gt.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let B;const j=A.cloudProxyServer;if(We(D=["proxy3","proxy4","proxy5"]).call(D,j)){const ue=Z("PROXY_SERVER_TYPE3");Array.isArray(ue)?A.proxyServer=ue[0]:A.proxyServer=ue}if(gt.setProxyServer(A.proxyServer),k.setProxyServer(A.proxyServer),this.store.requestAPStart(),_){if(k.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(A.stringUid?", ".concat(A.stringUid," => ").concat(_.intUid):""," ")),A.stringUid&&!A.uid&&(A.uid=_.intUid),B={gatewayInfo:_.ap.gatewayInfo},Z("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&A.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ue=(await SF(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(oe=>({turnServerURL:oe.address,tcpport:oe.tcpport||Os.tcpport,udpport:oe.udpport||Os.udpport,username:oe.username||Os.username,password:oe.password||Os.password,forceturn:!1,security:!0}));A.turnServer={mode:"manual",servers:ue}}DB(_,A.stringUid)}else{if(A.stringUid&&!A.uid){let ue;[ue,B]=await Ye.all([qF(A.stringUid,A,this._axiosCancelSource.token,this._config.httpRetryConfig||Bi,this.store),YF(A,this._axiosCancelSource.token,this._config.httpRetryConfig||Bi,!0,this.store)]),k.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(A.stringUid," => ").concat(ue)),A.uid=ue,B.gatewayInfo.uid=ue,B.gatewayInfo.res.uid=ue}else B=await YF(A,this._axiosCancelSource.token,this._config.httpRetryConfig||Bi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Ee($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(A,this._axiosCancelSource.token),this._configDistribute.on(py.UPDATE_BITRATE_LIMIT,ue=>{this._p2pChannel.updateBitrateLimit(ue)}),this._configDistribute.on(py.UPDATE_CLIENT_ROLE_OPTIONS,ue=>{this._setClientRoleOptions(ue)})},0),this._key=n||e;const Y=B.gatewayInfo,q=A.uid?A.uid:Y.uid;this._joinInfo=sc(sc({},A),{},{cid:Y.cid,uid:q,vid:Y.vid,apResponse:Y.res,apGatewayAddress:Y.apGatewayAddress,uni_lbs_ip:Y.uni_lbs_ip,gatewayAddrs:Y.gatewayAddrs}),this.store.intUid=q,this.store.cid=Y.cid;const ie=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Ee($.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));b.onSuccess(ie),this._appId=e,this._channelName=A.cname,this._uid=ie,this.store.uid=ie,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Cs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const le=A.stringUid?"string uid: ".concat(A.stringUid,",uid: ").concat(A.uid):"uid: ".concat(this._uid);return k.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(le)),setTimeout(()=>{k.startUpload()},5e3),this.store.joinEnd(),G=this,We(om).call(om,G)||om.push(G),this._cloudProxyServerMode==="disabled"&&on().supportWebCrypto&&Z("ENABLE_PRELOAD")&&hD(this._joinInfo),ie}catch(B){const j=Array.isArray(B)?B[0]:B;throw j&&j.code===$.OPERATION_ABORTED?k.warning("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),j):k.error("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),j),j.code!==$.OPERATION_ABORTED&&this._numberOfJoinCount===l&&(this._gateway.state="DISCONNECTED",this._reset()),b.onError(j),j}var G}_joinGateway(){if(!this._joinInfo||!this._key)throw new Ee($.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!Z("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){k.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Cs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=om.indexOf(t);n!==-1&&om.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return k.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",pn.LEAVE),k.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof qE))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Ee($.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new Ee($.INVALID_OPERATION,"audience can not publish stream");for(const a of n){if(!(a instanceof qE))throw new Ee($.INVALID_PARAMS,"parameter is not local track");if(!a._enabled&&t)throw new Ee($.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(a.getTrackId()))}k.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(a=>"".concat(a.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(a=>{const l=this._configDistribute.getBitrateLimit();a instanceof Kn&&l&&a.setBitrateLimit(l.uplink)});try{await this._publishHighStream(n),k.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(a=>"".concat(a.getTrackId()," "))))}catch(a){throw k.error("[".concat(this._clientId,"] publish error"),a.toString()),a}finally{s()}}async _publishDataChannel(e){An(e.id,"id",0,65535,!0),ru(e.ordered,"ordered"),ms(e.metadata,"metadata",0,512),k.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(a=>a.id===e.id)!==-1)throw new Ee($.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Ee($.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Z("FORCE_TURN")&&!Z("TURN_ENABLE_TCP")&&!Z("TURN_ENABLE_UDP"))throw new Ee($.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(a){return UF(a,!1)}(e),s=await this._p2pChannel.publishDataChannel([n]);if(s.length>0){if(typeof n._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Ee($.CREATE_DATACHANNEL_ERROR);try{await Ye.all(s.map(a=>this._uid&&this._gateway.publishDataChannel(this._uid,a,!0))),await n._waitTillOpen()}catch(a){if(a.code!==$.DISCONNECT_P2P)throw a}}return k.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw k.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Ee($.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof qE))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);k.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(s=>"".concat(s.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const s=await this._p2pChannel.unpublish(t);s&&await this._gateway.sendExtensionMessage(Ri.UNPUBLISH,{unpubMsg:s},!0)}else{const s=await this._p2pChannel.unpublish(t);s&&await this._gateway.unpublish(s,this._uid),k.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(a=>"".concat(a.getTrackId()))))}}catch(s){throw k.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),k.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),k.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(s=>"".concat(s.id))))}catch(n){throw k.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Yh)){const s=this.remoteUsers.find(a=>a.uid===e);if(!s)throw new Ee($.INVALID_REMOTE_USER,"user is not in the channel");e=s}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(zi(t,"mediaType",["audio","video"]),this.store.useP2P)throw new Ee($.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Ee($.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===at.AUDIO,s=t===at.VIDEO,a=await this._subscribeMutex.lock();try{const{ssrcId:l,ortc:f,rtxSsrcId:m,cname:_,uint_id:S}=await this._gateway.presubscribe(e,t,!0);if(l==null)throw new Ee($.UNEXPECTED_RESPONSE,"no ssrc id");let b=this._users.find(O=>O.uid===e);b||(b=new Yh(e,S||e),b._is_pre_created=!0,this._users.push(b)),_&&(b._cname=_),b._uintid||(b._uintid=S||e),n&&(b._audioSSRC=l,b._audio_pre_subscribed=!0,f&&(b._audioOrtc=f)),s&&(b._videoSSRC=l,b._video_pre_subscribed=!0,f&&(b._videoOrtc=f),m!=null&&(b._rtxSsrcId=m)),k.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(l)),await this._p2pChannel.subscribe(b,t,l,m,f);const A=n?b._audioTrack:b._videoTrack;if(!A)throw new Ee($.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(b._trust_audio_stream_added_state_=!0,b._audio_added_=!0),s&&(b._trust_video_stream_added_state_=!0,b._video_added_=!0),A}catch(l){throw k.error("[".concat(this._clientId,"] presub user ").concat(e," error"),l),l}finally{a()}}async _subscribeDataChannel(e,t){var n;if(An(t,"channelId",0,65535,!0),!this._joinInfo)throw new Ee($.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e))throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Ee($.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Ee($.INVALID_REMOTE_USER,"user is not published");const a=(n=e._dataChannels)===null||n===void 0?void 0:n.find(m=>m.id===t);if(!a)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Ee($.REMOTE_USER_IS_NOT_PUBLISHED);const l=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[a]);if(m&&We(m).call(m,a.id))try{var f;if(typeof a._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Ee($.CREATE_DATACHANNEL_ERROR);const _={id:a.id,datachannelId:a._originDataChannelId,ordered:a.ordered,maxRetransmits:a.maxRetransmits,metadata:(f=a.metadata)!==null&&f!==void 0?f:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await a._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==$.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[a]),_;await this._p2pChannel.unsubscribeDataChannel(e,[a]),this._p2pChannel.setPendingRemoteDataChannel(e,a.id)}return k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),a}finally{l()}}async _p2pSubscribe(e,t,n){if(zi(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Ee($.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e)){const l=new Ee($.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),l}if(!e.hasAudio&&!e.hasVideo){const l=new Ee($.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),l}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const l=new Ee($.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),l}const a=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const f=t==="audio"?e._audioSSRC:e._videoSSRC,m=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,f,m)}catch(f){throw f}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(f=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),f)});const l=t==="audio"?e._audioTrack:e._videoTrack;if(!l)throw new Ee($.UNEXPECTED_ERROR,"can not find remote track in user object");return l}catch(l){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),l),l}finally{a()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(zi(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Ee($.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(S=>S===e)){const S=new Ee($.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),S}if(!e.hasAudio&&!e.hasVideo){const S=new Ee($.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),S}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const S=new Ee($.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),S}let a=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioOrtc:e._videoOrtc,f=t==="video"?e._rtxSsrcId:void 0,m={stream_type:t==="audio"?at.AUDIO:at.VIDEO,ssrcId:a};const _=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const b=t==="audio"?e._audioSSRC:e._videoSSRC;b!==void 0&&b!==a&&(a=b,l=t==="audio"?e._audioOrtc:e._videoOrtc,f=t==="video"?e._rtxSsrcId:void 0,m={stream_type:t==="audio"?at.AUDIO:at.VIDEO,ssrcId:a}),Us.markSubscribeStart(this.store.clientId,a),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,a,f,l);try{this._p2pChannel.isPreSubScribe(a)||await this._gateway.subscribe(e.uid,m,!0)}catch(A){if((A==null?void 0:A.code)!==$.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),A;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(b){throw this._p2pChannel.reportSubscribeEvent(!1,b==null?void 0:b.code,e,t),b}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(b=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),b)});const S=t==="audio"?e._audioTrack:e._videoTrack;if(!S)throw new Ee($.UNEXPECTED_ERROR,"can not find remote track in user object");return S}catch(S){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),S),S}finally{_()}}async massSubscribe(e){if(au(e,"subscribeList"),!this._joinInfo)throw new Ee($.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,s=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:_,mediaType:S}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(S)}).join("; ")));const a=(e=[...e]).map(m=>{let{user:_,mediaType:S}=m;return{user:_,mediaType:S}}),l=await this._p2pChannel.globalLock();try{var f;for(let _=e.length-1;_>=0;_--){const S=e[_],{user:b,mediaType:A}=S;if(zi(A,"mediaType",["audio","video"]),!b){const B=new Ee($.INVALID_PARAMS,"user property does not exist in subscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),B}if(!this._users.find(B=>B===b)){const B=new Ee($.INVALID_REMOTE_USER,"user is not in the channel");k.error("[".concat(this._clientId,"] can not massSubscribe ").concat(b.uid,", this user is not in the channel")),a[_].error=B,e.splice(_,1);continue}if(A==="audio"&&(!b.hasAudio||b._audioSSRC===void 0)||A==="video"&&(!b.hasVideo||b._videoSSRC===void 0)){const B=new Ee($.REMOTE_USER_IS_NOT_PUBLISHED);k.error("[".concat(this._clientId,"] can not subscribe ").concat(b.uid," with mediaType ").concat(A,", remote user is not published")),a[_].error=B,e.splice(_,1);continue}const D=es.Video|es.LwoVideo,G=n.get(b);if(G){if(A==="video"?G&D:G&es.Audio){e.splice(_,1),k.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(b.uid,", mediaType:").concat(A," twice"));continue}n.set(b,G|(A==="video"?D:es.Audio))}else n.set(b,A==="video"?D:es.Audio)}for(let _=e.length-1;_>=0;_--){const S=e[_],{user:b,mediaType:A}=S,O=es.Video|es.LwoVideo;if(this._p2pChannel.hasRemoteMedia(b,A)){await this._p2pChannel.unmuteRemoteNoLock(b,A);const D=n.get(b);n.set(b,A==="video"?D^O:D^es.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),t);let m=jr(f=Array.from(n.entries())).call(f,(_,S)=>{let[b,A]=S;if(A===0)return _;const O={stream_id:b.uid,stream_type:A};return A&es.Audio&&(O.audio_ssrc=b._audioSSRC),A&es.Video&&(O.video_ssrc=b._videoSSRC),_.push(O),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(S=>{let{user:b,mediaType:A}=S;return{user:b,mediaType:A,ssrcId:A===at.VIDEO?b._videoSSRC:b._audioSSRC,rtxSsrcId:A===at.VIDEO?b._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(S=>S.video_ssrc&&!this._p2pChannel.isPreSubScribe(S.video_ssrc)||S.audio_ssrc&&!this._p2pChannel.isPreSubScribe(S.audio_ssrc)||!S.video_ssrc&&!S.audio_ssrc),m.length>0){const S=await this._gateway.subscribeAll(m,!0);((S==null?void 0:S.users)||[]).forEach(b=>{let{stream_id:A,video_error_code:O,audio_error_code:D,error_code:G}=b;(O||D||G)&&_.set(A,{video_error_code:O,audio_error_code:D,error_code:G})})}if(Array.from(_.entries()).length>0){const S=[];Array.from(_.entries()).forEach(b=>{let[A,O]=b;const D=this.remoteUsers.find(G=>G.uid===A);if(D){let G;O.error_code||O.video_error_code&&O.audio_error_code?G=void 0:O.video_error_code?G=at.VIDEO:O.audio_error_code&&(G=at.AUDIO),S.push({user:D,mediaType:G})}}),S.length>0&&await this._p2pChannel.massUnsubscribeNoLock(S)}for(const S of a){const b=_.get(S.user.uid);if(b){const A=b.error_code||S.mediaType==="audio"&&b.audio_error_code||S.mediaType==="video"&&b.video_error_code;if(A){const O=my(A);k.error("user:".concat(S.user.uid," mediaType:").concat(S.mediaType," has massSubscribe error ").concat(O.desc)),S.error=new Ee($.SUBSCRIBE_FAILED,"code ".concat(A,": ").concat(O.desc))}}S.error||(S.mediaType==="video"?S.track=S.user.videoTrack:S.track=S.user.audioTrack)}return this.store.massSubscribe(a.filter(S=>!S.error).map(S=>({userId:S.user.uid,type:S.mediaType})),void 0,Date.now()),a.forEach(S=>{var b;gt.subscribe(this.store.sessionId,{succ:!!S.error,ec:((b=S.error)===null||b===void 0?void 0:b.code)||null,video:S.mediaType===at.VIDEO,audio:S.mediaType===at.AUDIO,peerid:S.user.uid,subscribeRequestid:S.mediaType===at.VIDEO?S.user._videoSSRC:S.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(S.user._videoSSRC)},!0)}),k.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(S=>{let{user:b,mediaType:A}=S;return"user: ".concat(b==null?void 0:b.uid,", mediaType: ").concat(A)}).join("; "))),a}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{l(),s()}}async unsubscribe(e,t,n){if(!(e instanceof Yh)){const l=this.remoteUsers.find(f=>f.uid===e);if(!l)throw new Ee($.INVALID_REMOTE_USER,"user is not in the channel");e=l}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&zi(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Ee($.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(l=>l===e)){const l=new Ee($.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),l}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const a=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const l=await this._p2pChannel.unsubscribe(e,t);l&&await this._gateway.unsubscribe(l,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&sR(this._users,e),k.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(l){if(l.code===$.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),l.toString()),l}finally{a()}}async _unsubscribeDataChannel(e,t){if(t&&An(t,"id",0,65535,!0),!this._joinInfo)throw new Ee($.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(a=>a===e)){const a=new Ee($.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}let s;if(typeof t=="number"){const a=e._dataChannels.find(l=>l.id===t);a&&(s=[a])}else s=e._dataChannels;if(s===void 0){const a=new Ee($.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),a}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s.map(a=>a.id)));try{const a=await this._p2pChannel.unsubscribeDataChannel(e,s);a&&await this._gateway.unsubscribeDataChannel(a,e.uid),k.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(a))}catch(a){if(a.code===$.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}}async massUnsubscribe(e){if(au(e,"unsubscribeList"),!this._joinInfo)throw new Ee($.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");k.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:s,mediaType:a}=n;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(a,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:s,mediaType:a}=e[n];if(!s){const m=new Ee($.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(zi(a,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===s)){k.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),e.splice(n,1);continue}const f=es.Video|es.LwoVideo;if(t.has(s)){const m=t.get(s);let _;switch(a){case"video":_=m&f;break;case"audio":_=m&es.Audio;break;default:_=m&(es.Audio|f)}if(_){k.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(a," twice.")),e.splice(n,1);continue}a?a==="audio"?t.set(s,m|es.Audio):a==="video"&&t.set(s,m|f):t.set(s,m|es.Audio|f)}else a?a==="audio"?t.set(s,es.Audio):a==="video"&&t.set(s,f):t.set(s,es.Audio|f)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),k.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(s=>{let{user:a,mediaType:l}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(l,";")}).join()))}catch(n){if(n.code===$.DISCONNECT_P2P)return void k.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw k.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new ve($.INVALID_PARAMS);ci(n.width)||Hw(n.width,"streamParameter.width"),ci(n.height)||Hw(n.height,"streamParameter.height"),ci(n.framerate)||Hw(n.framerate,"streamParameter.framerate"),ci(n.bitrate)||An(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&k.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),k.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Le.LocalVideoLowTrack)}async enableDualStream(){if(!on().supportDualStream)throw gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Ee($.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Ee($.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),k.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Ee($.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Le.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),k.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(s){zi(s,"role",["audience","host"])}(e),t&&qw(t),this.mode==="rtc"||this.mode==="p2p")throw k.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Ee($.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new Ee($.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Ee($.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&Z("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Is.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),k.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&qw(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{k.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(ms(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new Ee($.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ee($.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,gt.setProxyServer(this._proxyServer),k.setProxyServer(this._proxyServer),k.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new Ee($.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ee($.INVALID_OPERATION,"You have already set the proxy")}if(ry(e))return this._turnServer={servers:e,mode:"original-manual"},void k.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>gM(n)),this._turnServer={servers:e,mode:"manual"},k.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Ee($.INVALID_OPERATION,"you should set license before join channel");if(ms(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Ee($.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,k.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Ee($.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Ee($.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Ee($.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new Ee($.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Ee($.INVALID_OPERATION,"Stop proxy server after leave channel");gt.setProxyServer(),k.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Ee($.INVALID_PARAMS,"accessPoints is required.");au(e.accessPoints.serverList,"accessPoints.serverList"),ms(e.accessPoints.domain,"accessPoints.domain");const t=(O,D)=>{An(O,D,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ee($.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Z("CLOSE_AFB_FOR_LOCAL_AP")&&(vn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),vn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,a=e.accessPoints.domain,l=e.accessPoints.serverList.map(O=>s.test(O)?"".concat(O.replace(/\./g,"-"),".").concat(a):O),f=l.map(O=>"".concat(O,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,vn("WEBCS_DOMAIN",f),vn("WEBCS_DOMAIN_BACKUP_LIST",f),vn("GATEWAY_DOMAINS",[a]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(au(e.report.hostname,"report.hostname"),vn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),vn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(vn("EVENT_REPORT_DOMAIN",l[0]),vn("EVENT_REPORT_BACKUP_DOMAIN",l[1]||l[0]));let m=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),m=e.report.port),vn("STATS_COLLECTOR_PORT",m),e.report?vn("ENABLE_EVENT_REPORT",!0):vn("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(au(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=l[0];let S=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),S=e.log.port),vn("LOG_UPLOAD_SERVER","".concat(_,":").concat(S));let b=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(au(e.cds.hostname,"cds.hostname"),b=e.cds.hostname):b=l;let A=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),A=e.cds.port),vn("CDS_AP",b.map(O=>"".concat(O,":").concat(A))),e.cds?vn("ENABLE_CONFIG_DISTRIBUTE",!0):vn("ENABLE_CONFIG_DISTRIBUTE",!1),k.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(au(e,"serverList"),ms(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ee($.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(s=>n.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(t):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,vn("WEBCS_DOMAIN",e),vn("WEBCS_DOMAIN_BACKUP_LIST",e),vn("GATEWAY_DOMAINS",[t]),vn("EVENT_REPORT_DOMAIN",e[0]),vn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),vn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),k.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(zi(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw k.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else k.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){zi(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(s=>s.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw k.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}k.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){zi(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw k.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}k.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,s){(function(l){zi(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),ms(t,"secret");const a=["aes-128-gcm2","aes-256-gcm2"];if(We(a).call(a,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new Ee($.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new Ee($.INVALID_PARAMS,"current encrypt mode does not need salt");if(s){if(ru(s,"encryptDataStream"),!We(a).call(a,e))throw new Ee($.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||k.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Fh(n))}async renewToken(e){if(ms(e,"token",1,2047),!this._key||!this._joinInfo)throw new Ee($.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(Z("USE_NEW_TOKEN")){k.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const s=await W$(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Bi);k.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:s})}else k.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});k.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=t,this._joinInfo.token=t,k.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?k.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Wt.VOLUME_INDICATOR,e)},Z("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new Ee($.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Ee($.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Ee($.LIVE_STREAMING_TASK_CONFLICT);const n=t?lu.TRANSCODE:lu.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(lu.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new Ee($.INVALID_PARAMS,"can not find live streaming url to stop");await Ye.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){eB(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){eB(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Ay&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Ee($.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const a=new TextEncoder;e.payload=a.encode(e.payload)}let s=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&We(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(s=!0,e.payload=await async function(a,l,f){var m;const _=jr(m=Array.from(f)).call(m,(B,j)=>B+j,0),S={serverTs:0,seq:fq++,length:f.length,checkSum:_},b=new Uint8Array(RM(_,2)),A=new ArrayBuffer(VE),O=new DataView(A);O.setUint32(0,S.serverTs),O.setUint16(4,S.seq),O.setUint16(6,S.length),O.setUint16(8,S.checkSum);const D=16-f.length%16;f=SM(f,new Uint8Array(D));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a,tagLength:UM,additionalData:b},l,f);return SM(new Uint8Array(A),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Ee($.INVALID_PARAMS,s?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Dt.DATA_STREAM,{payload:Fh(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-ez},!n)}sendMetadata(e){if(!this._joinInfo)throw new Ee($.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Ee($.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Dt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Fh(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(vq),!this._joinInfo)throw new Ee($.INVALID_OPERATION,"can not send custom report, not joined");await gt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){zi(t.spatialLayer,"spatialLayer",[0,1,2,3]),zi(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw k.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(ru(t,"apRTM"),An(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,k.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(k.debug("[".concat(this._clientId,"] reset client")),function(e){const t=ZE.indexOf(e);t!==-1&&ZE.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Lr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&OB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&gt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ps("client-publish",this._clientId),this._subscribeMutex=new Ps("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const s=e||em();e?k.debug("[".concat(this._clientId,"] new Session ").concat(s)):k.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s));const a=e?"":this._sessionId||"";this._sessionId=s,this.store.sessionId=s,gt.addSid(s);const l={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:a,clientRole:this.role==="audience"?2:1};gt.sessionInit(this._sessionId,sc({cname:t.channel,appid:t.appId},l)),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Ee($.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Z("FORCE_TURN")&&!Z("TURN_ENABLE_TCP")&&!Z("TURN_ENABLE_UDP"))throw new Ee($.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");k.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const s=(await n.next()).value;if(s){try{await this._gateway.sendExtensionMessage(Ri.PUBLISH,s,!0)}catch(a){throw n.throw(a),a}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const s=(await n.next()).value;if(s){var t;let a;try{a=await this._gateway.publish(this._uid,s,!0)}catch(l){if(l.code!==$.DISCONNECT_P2P)throw n.throw(l),l}await n.next(((t=a)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const a of e)a instanceof Kn&&a._encoderConfig&&this._gateway.setVideoProfile(a._encoderConfig).catch(l=>{k.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!a.muted&&a.enabled||await this._p2pChannel.muteLocalTrack(a)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===$.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Ee($.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ee($.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));k.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await n.next()).value;if(s){var t;let a;try{a=await this._gateway.publish(this._uid,s,!0)}catch(l){if(l.code!==$.DISCONNECT_P2P)throw n.throw(l),l}n.next(((t=a)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===$.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new Ee($.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(s={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},hu("LiveStreaming").create(s));var s;return n.onLiveStreamError=(a,l)=>{gt.reportApiInvoke(this._sessionId,{name:Fi.ON_LIVE_STREAM_ERROR,options:[a,l],tag:li.TRACER}).onSuccess(),this.safeEmit(Wt.LIVE_STREAMING_ERROR,a,l)},n.onLiveStreamWarning=(a,l)=>{gt.reportApiInvoke(this._sessionId,{name:Fi.ON_LIVE_STREAM_WARNING,options:[a,l],tag:li.TRACER}).onSuccess(),this.safeEmit(Wt.LIVE_STREAMING_WARNING,a,l)},n.on(UO.REQUEST_WORKER_MANAGER_LIST,(a,l,f)=>{if(!this._joinInfo)return f(new Ee($.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,S,b){const A=Z("UAP_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(O=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(O+"/api/v1?action=uap"):"https://".concat(O,"/api/v1?action=uap"));return await B$(A,m,_,S,b)})(a,this._joinInfo,this._axiosCancelSource.token,Bi).then(l).catch(f)}),n};return e===lu.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Ee($.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),s=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},hu("ChannelMediaRelay").create(e));s.on("state",a=>{a===qr.RELAY_STATE_FAILURE&&s&&s.dispose(),this.safeEmit(Wt.CHANNEL_MEDIA_RELAY_STATE,a)}),s.on("event",a=>{this.safeEmit(Wt.CHANNEL_MEDIA_RELAY_EVENT,a)}),this._channelMediaRelayClient=s,this._statsCollector.onStatsChanged=(a,l)=>{var f;a==="resolution"&&((f=this._channelMediaRelayClient)===null||f===void 0||f.setVideoProfile(l))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:s}=e,a=[];if(t){const l=[];this._users.forEach(f=>{f._dataChannels.forEach(m=>{n.every(_=>_.uid!==f._uintid||_.stream_id!==m.id)&&l.push({uid:f._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),l.length>0&&this._handleUpdateDataChannel({added:[],deleted:l})}Array.isArray(n)&&n.length>0&&n.forEach(l=>{const{uid:f,stream_id:m,ordered:_,max_retrans_times:S,metadata:b}=l,A=this._users.find(O=>O._uintid===f);if(!A)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(k.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(f)),We(a).call(a,A)||a.push(A),A._uintid||(A._uintid=f),A._dataChannels.findIndex(O=>O.id===l.stream_id)===-1){const O={id:m,ordered:!!_,maxRetransmits:S,metadata:b},D=function(G){return UF(G,!0)}(O);A._dataChannels.push(D),k.info("[".concat(this._clientId,"] remote user ").concat(A.uid," published datachannel")),t||this.safeEmit(Wt.USER_PUBLISHED,A,"datachannel",O)}this._p2pChannel.hasPendingRemoteDataChannel(A,l.stream_id)&&(k.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(A.uid," after reconnect.")),this._subscribeDataChannel(A,l.stream_id).catch(O=>{k.error("[".concat(this._clientId,"] resubscribe datachannel error"),O.toString())}))}),t&&(this.safeEmit(Wt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(l=>{const{uid:f,stream_id:m}=l,_=this._users.find(b=>b._uintid===f);if(!_)return void k.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const S=_._dataChannels.find(b=>b.id===l.stream_id);S&&(k.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(f)),this._p2pChannel.unsubscribeDataChannel(_,[S]).then(b=>{if(_._dataChannels=_._dataChannels.filter(A=>A!==S),b)return this._gateway.unsubscribeDataChannel(b,_.uid)}),k.info("[".concat(this._clientId,"] remote user ").concat(f," unpublished datachannel ,id:").concat(S.id)),this.safeEmit(Wt.USER_UNPUBLISHED,_,"datachannel",S._config))})}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){k.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(s=>{this.safeEmit(Wt.USER_UNPUBLISHED,t,"datachannel",s._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(s=>{if(s)return this._gateway.unsubscribeDataChannel(s,t.uid)}),n()}}else k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(os.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void k.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(s=>{const{value:a,type:l,expires:f}=t[s];f&&f<=n||l||DO()||!Object.prototype.hasOwnProperty.call(dR,s)||(zc[s]=a,Hn[s]=a,k.debug("Update gateway parameters from config distribute",s,a))})}catch(t){k.error("Error update config from local cache",t.message)}})()}),this._gateway.on(os.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(os.CONNECTION_STATE_CHANGE,(e,t,n)=>{var s;if(n===pn.FALLBACK)return;const a=()=>{this.safeEmit(Wt.CONNECTION_STATE_CHANGE,e,t,n)};if(gt.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:Fi.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:li.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),k.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void a();if(e==="RECONNECTING")this._users.forEach(f=>{f._trust_in_room_=!1,f._trust_audio_enabled_state_=!1,f._trust_video_enabled_state_=!1,f._trust_audio_mute_state_=!1,f._trust_video_mute_state_=!1,f._trust_audio_stream_added_state_=!1,f._trust_video_stream_added_state_=!1,f._is_pre_created||(f._audio_pre_subscribed||(f._audioSSRC=void 0,f._audioOrtc=void 0),f._video_pre_subscribed||(f._videoSSRC=void 0,f._videoOrtc=void 0,f._rtxSsrcId=void 0),f._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var l;this._streamFallbackTypeCacheMap.forEach((f,m)=>{this._gateway.setStreamFallbackOption(m,f).catch(_=>{k.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((f,m)=>{this._gateway.setRemoteVideoStreamType(m,f).catch(_=>{k.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((l=this._joinInfo)===null||l===void 0?void 0:l.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{k.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(f=>{k.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(f))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(f=>!f._trust_in_room_).forEach(f=>{k.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(f.uid)),this._handleUserOffline({uid:f.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(f=>{f._trust_audio_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,at.AUDIO,!1)),f._trust_video_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,at.VIDEO,!1)),f._trust_audio_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(f.uid)),this._handleSetStreamLocalEnable("audio",f.uid,!0)),f._trust_video_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(f.uid)),this._handleSetStreamLocalEnable("video",f.uid,!0)),f._trust_video_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(f.uid)),this._handleResetAddStream(f,"video")),f._trust_audio_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(f.uid)),this._handleResetAddStream(f,"audio")),f._video_added_||f._audio_added_||(k.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(f.uid)),this._handleRemoveStream({uid:f.uid,uint_id:f._uintid}))}))},1e3))}a()}),this._gateway.on(os.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new Ee($.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const s=await IB(sc(sc({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));s?(n=s.ap,DB(s),this._joinInfo.preload=!0):(n=await ZO(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Bi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const a=[];n.gatewayInfo.gatewayAddrs.forEach(l=>{let{address:f}=l;const[m,_]=f.split(":");this._joinInfo&&this._joinInfo.proxyServer?a.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):a.push({host:m,port:_})}),e(a)}catch(n){t(n)}}),this._gateway.on(os.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Wt.NETWORK_QUALITY,e)}),this._gateway.on(os.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Wt.STREAM_TYPE_CHANGED,e,t),gt.reportApiInvoke(this._sessionId,{name:Fi.STREAM_TYPE_CHANGE,options:[e,t],tag:li.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(os.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(os.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let s=await this._p2pChannel.getEstablishParams();Z("ENABLE_PREALLOC_PC")&&s||(s=await this._p2pChannel.startP2PConnection(e)),t(s)}catch(s){n(s)}}),this._gateway.on(os.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;e.attributes?n=e.attributes.userAttributes.preSubSsrcs:k.debug("no attributes in joinResponse");const s=AF(e.ortc,t,n);this._p2pChannel.connect(s)}),this._gateway.on(os.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var s;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:a,cid:l}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(l,"_").concat(a),icePwd:"".concat(l,"_").concat(a)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(s=Z("FINGERPRINT"))!==null&&s!==void 0?s:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(qt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(qt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(qt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(qt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(qt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(qt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(qt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(qt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(qt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,at.AUDIO,!0)),this._gateway.signal.on(qt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,at.AUDIO,!1)),this._gateway.signal.on(qt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,at.VIDEO,!0)),this._gateway.signal.on(qt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,at.VIDEO,!1)),this._gateway.signal.on(qt.RECEIVE_METADATA,e=>{const t=Zp(e.metadata);this.safeEmit(Wt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(qt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=Zp(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&We(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<VE)throw new Ee($.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(VE));n=await async function(l,f,m){const _=m.subarray(0,VE),S=_.slice(8,VE),b=(S[0]<<8)+S[1],A=(_[6]<<8)+_[7],O=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:l,tagLength:UM,additionalData:new Uint8Array(RM(b,2))},f,m.subarray(VE));return new Uint8Array(O).subarray(0,A)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let s=0;if(e.ordered||e.syncWithAudio){const a=this._p2pChannel.getStats(),l=this.remoteUsers.find(m=>m.uid===e.uid),f=a==null?void 0:a.audioRecv.find(m=>m.ssrc===(l==null?void 0:l._audioSSRC));s=f==null?void 0:f.jitterBufferMs}(s==null||Number.isNaN(s))&&(s=0),nz(sc(sc({},e),{},{payload:n}),s,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(qt.ON_CRYPT_ERROR,()=>{Uh(()=>{k.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Wt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(qt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{k.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,pn.TOKEN_EXPIRE),this.safeEmit(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(qt.ON_STREAM_FALLBACK_UPDATE,e=>{k.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Wt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(qt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),k.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(qt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(qt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Nt.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Dt.PUBLISH:{if(!t)return;const a=t.ortc;if(a){var n,s;const l=a.some(_=>{let{stream_type:S}=_;return S===En.Audio}),f=a.some(_=>{let{stream_type:S}=_;return S!==En.Audio}),m=a.some(_=>{let{stream_type:S}=_;return S===En.Screen||S===En.ScreenLow});t.state==="offer"&&gt.publish(this._joinInfo.sid,{eventElapse:Us.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:$.TIMEOUT,audio:l,video:f,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:l?(n=a.find(_=>{let{stream_type:S}=_;return S===En.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:f?(s=a.find(_=>{let{stream_type:S}=_;return S!==En.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case Dt.SUBSCRIBE:t&&gt.subscribe(this._joinInfo.sid,{succ:!1,ec:$.TIMEOUT,audio:t.stream_type===at.AUDIO,video:t.stream_type===at.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Us.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(qt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(qt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;Z("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(s=>!cm(s.string_id||s.stream_id,this.channelName)));const t=[],n=[];for(const s of e.users){let a=this._users.find(b=>b._uintid===s.stream_id);a?a._trust_in_room_=!0:(a=new Yh(s.string_id||s.stream_id,s.stream_id),this._users.push(a),this.getListeners(Wt.PUBLISHED_USER_LIST).length===0&&(k.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(Wt.USER_JOINED,a)));const l=es.Audio&s.stream_type,f=(es.Video|es.LwoVideo)&s.stream_type,m=(65280&s.stream_type)!=0,_=l&&a.hasAudio,S=f&&a.hasVideo;f&&(a._trust_video_stream_added_state_=!0,a._video_added_=!0,a._videoSSRC=s.video_ssrc,a._rtxSsrcId=s.video_rtx),l&&(a._trust_audio_stream_added_state_=!0,a._audio_added_=!0,a._audioSSRC=s.audio_ssrc),l&&!_&&this.getListeners(Wt.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published audio")),this.safeEmit(Wt.USER_PUBLISHED,a,"audio")),f&&!S&&this.getListeners(Wt.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published video")),this.safeEmit(Wt.USER_PUBLISHED,a,"video")),(l&&!_||f&&!S||m)&&t.push(a),f&&this._p2pChannel.hasPendingRemoteMedia(a,"video")&&n.push({user:a,mediaType:"video"}),l&&this._p2pChannel.hasPendingRemoteMedia(a,"audio")&&n.push({user:a,mediaType:"audio"})}n.length>0&&(k.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(s=>{k.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(Wt.PUBLISHED_USER_LIST).length>0?Z("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(k.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(s=>s.uid).join(", "))),this.safeEmit(Wt.PUBLISHED_USER_LIST,t)):k.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(s=>s.uid).join(", ")))}),this._gateway.signal.on(qt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof Ay&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var s;return We(s=Object.keys(uR)).call(s,n)}))})}_handleP2PEvents(){this._gateway.signal.on(qt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Ri.PUBLISH,(e,t,n)=>{const{uid:s}=e;e.forEach(a=>{const{kind:l,ssrcs:f,mid:m,isMuted:_}=a;this._handleP2PAddAudioOrVideoStream(l,s,f[0].ssrcId,m);const S=this._users.find(b=>b.uid===s);return S&&this.store.useP2P?this._p2pChannel.mockSubscribe(S,l,f[0].ssrcId,m).then(()=>{t()}).catch(n):t(),this._handleMuteStream(s,l,!!_)})}),this._gateway.signal.on(Ri.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var s;t(await this._p2pChannel.startP2P({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer},e))}catch(a){n(a)}}),this._gateway.signal.on(Nt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Ri.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:s,uid:a}=e,l=this._users.find(f=>f.uid===a);if(!l)return k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a)),void t();try{s.forEach(async f=>{let{stream_type:m}=f;const _=m===En.Audio?at.AUDIO:at.VIDEO;await this._p2pChannel.unsubscribe(l,_),this._handleMuteStream(a,_,!0)}),t()}catch(f){n(f)}}}),this._gateway.signal.on(Ri.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case jh.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,at.VIDEO,!0);break;case jh.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,at.AUDIO,!0);break;case jh.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,at.VIDEO,!1);break;case jh.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,at.AUDIO,!1)}}),this._gateway.signal.on(Ri.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:s,iceParameter:a}=e;s!==Tr.SEND_ONLY||a?t(await this._p2pChannel.restartICE(s,a)):(this._p2pChannel.handleDisconnect(s),t())}catch(s){n(s)}}),this._gateway.signal.on(Ri.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(vt.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:s}=e;t(await this._gateway.sendExtensionMessage(Ri.RESTART_ICE,e,s===Tr.SEND_ONLY))}catch(s){n(s)}}),this._p2pChannel.on(vt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Ri.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(vt.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Ri.CONTROL,e,!0),t()}catch(s){n(s)}}),this._p2pChannel.on(vt.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===$.DISCONNECT_P2P?t():n(s)}else t()}),this._p2pChannel.on(vt.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===$.DISCONNECT_P2P?t():n(s)}else t()}),this._p2pChannel.on(vt.StateChange,(e,t)=>{t===mn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(vt.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(Wt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(vt.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===$.DISCONNECT_P2P?t():n(s)}else t()}),this._p2pChannel.on(vt.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===$.DISCONNECT_P2P?t():n(s)}else t()}),this._p2pChannel.on(vt.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(vt.RequestRePublishDataChannel,(e,t,n)=>{Ye.all(e.map(async s=>{const a=await this._p2pChannel.publishDataChannel([s]);try{a.forEach(l=>{this._uid&&this._gateway.publishDataChannel(this._uid,l,!0)})}catch(l){if(l.code!==$.DISCONNECT_P2P)throw l}})).then(t).catch(n)}),this._p2pChannel.on(vt.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:s,kind:a}of e)a===at.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");t()}catch(s){n(s)}}),this._p2pChannel.on(vt.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(vt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(vt.MediaReconnectStart,e=>{this.safeEmit(Wt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(vt.MediaReconnectEnd,e=>{this.safeEmit(Wt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(vt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(vt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const s=n.value;let a;try{a=await this._gateway.restartICE({iceParameters:s})}catch(f){return void t.throw(f)}const{iceParameters:l}=function(f){const m=f.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(a);await t.next({remoteIceParameters:l})}),this._p2pChannel.on(vt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(vt.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:a,gatewayAddress:l}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:s}),f=AF(a,l);await this._p2pChannel.connect(f),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(vt.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(vt.P2PLost,()=>{this.safeEmit(Wt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(vt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(vt.ConnectionTypeChange,e=>{this.safeEmit(Wt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(vt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(vt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(vt.AudioMetadata,e=>{this.safeEmit(Wt.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Ee($.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Ee($.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},hu("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:s,cname:a,sid:l,token:f,uid:m,cid:_,vid:S}=this._joinInfo;await n.init({appId:s,areaCode:"",cname:a,sid:l,token:f,uid:m,cid:_,vid:S?Number(S):0},Bi)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(cs.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Wt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===ec.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Wt.CONTENT_INSPECT_ERROR,new Ee($.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(cs.INSPECT_RESULT,(t,n)=>{var s;if((n==null?void 0:n.code)===$.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return k.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(Wt.CONTENT_INSPECT_RESULT,t,n)}),e.on(cs.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Ee($.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(ru(e,"enabled"),e){if(!t)throw new Ee($.INVALID_PARAMS,"config is required");if(HB(t),!this._joinInfo)throw new Ee($.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const s=(n={config:t},hu("ImageModeration").create(n));this._moderation=s,this.handleImageModerationEvents(s);const{appId:a,cname:l,sid:f,token:m,uid:_,cid:S,vid:b}=this._joinInfo;await s.init({appId:a,areaCode:"",cname:l,sid:f,token:m,uid:_,cid:S,vid:b?Number(b):0},Bi)}}catch(s){throw Array.isArray(s)?s[0]:s}}else{var n;if(!this._moderation)throw new Ee($.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(s){throw Array.isArray(s)?s[0]:s}}}handleImageModerationEvents(e){e.on(Qc.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Wt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===lo.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Ee($.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Qc.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){zi(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Ee($.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,k.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return k.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){ru(e,"enabled"),vn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ft(et.prototype,"leave",[KB],Object.getOwnPropertyDescriptor(et.prototype,"leave"),et.prototype),ft(et.prototype,"publish",[WB],Object.getOwnPropertyDescriptor(et.prototype,"publish"),et.prototype),ft(et.prototype,"unpublish",[YB],Object.getOwnPropertyDescriptor(et.prototype,"unpublish"),et.prototype),ft(et.prototype,"subscribe",[qB],Object.getOwnPropertyDescriptor(et.prototype,"subscribe"),et.prototype),ft(et.prototype,"presubscribe",[$B],Object.getOwnPropertyDescriptor(et.prototype,"presubscribe"),et.prototype),ft(et.prototype,"massSubscribe",[zB],Object.getOwnPropertyDescriptor(et.prototype,"massSubscribe"),et.prototype),ft(et.prototype,"unsubscribe",[XB],Object.getOwnPropertyDescriptor(et.prototype,"unsubscribe"),et.prototype),ft(et.prototype,"massUnsubscribe",[JB],Object.getOwnPropertyDescriptor(et.prototype,"massUnsubscribe"),et.prototype),ft(et.prototype,"setLowStreamParameter",[QB],Object.getOwnPropertyDescriptor(et.prototype,"setLowStreamParameter"),et.prototype),ft(et.prototype,"enableDualStream",[ZB],Object.getOwnPropertyDescriptor(et.prototype,"enableDualStream"),et.prototype),ft(et.prototype,"disableDualStream",[eV],Object.getOwnPropertyDescriptor(et.prototype,"disableDualStream"),et.prototype),ft(et.prototype,"setClientRole",[tV],Object.getOwnPropertyDescriptor(et.prototype,"setClientRole"),et.prototype),ft(et.prototype,"_setClientRoleOptions",[nV],Object.getOwnPropertyDescriptor(et.prototype,"_setClientRoleOptions"),et.prototype),ft(et.prototype,"setProxyServer",[iV],Object.getOwnPropertyDescriptor(et.prototype,"setProxyServer"),et.prototype),ft(et.prototype,"setTurnServer",[sV],Object.getOwnPropertyDescriptor(et.prototype,"setTurnServer"),et.prototype),ft(et.prototype,"setLicense",[rV],Object.getOwnPropertyDescriptor(et.prototype,"setLicense"),et.prototype),ft(et.prototype,"startProxyServer",[aV],Object.getOwnPropertyDescriptor(et.prototype,"startProxyServer"),et.prototype),ft(et.prototype,"stopProxyServer",[oV],Object.getOwnPropertyDescriptor(et.prototype,"stopProxyServer"),et.prototype),ft(et.prototype,"setLocalAccessPointsV2",[cV],Object.getOwnPropertyDescriptor(et.prototype,"setLocalAccessPointsV2"),et.prototype),ft(et.prototype,"setLocalAccessPoints",[lV],Object.getOwnPropertyDescriptor(et.prototype,"setLocalAccessPoints"),et.prototype),ft(et.prototype,"setRemoteDefaultVideoStreamType",[dV],Object.getOwnPropertyDescriptor(et.prototype,"setRemoteDefaultVideoStreamType"),et.prototype),ft(et.prototype,"setRemoteVideoStreamType",[uV],Object.getOwnPropertyDescriptor(et.prototype,"setRemoteVideoStreamType"),et.prototype),ft(et.prototype,"setStreamFallbackOption",[hV],Object.getOwnPropertyDescriptor(et.prototype,"setStreamFallbackOption"),et.prototype),ft(et.prototype,"setEncryptionConfig",[fV],Object.getOwnPropertyDescriptor(et.prototype,"setEncryptionConfig"),et.prototype),ft(et.prototype,"renewToken",[pV],Object.getOwnPropertyDescriptor(et.prototype,"renewToken"),et.prototype),ft(et.prototype,"enableAudioVolumeIndicator",[mV],Object.getOwnPropertyDescriptor(et.prototype,"enableAudioVolumeIndicator"),et.prototype),ft(et.prototype,"startLiveStreaming",[gV],Object.getOwnPropertyDescriptor(et.prototype,"startLiveStreaming"),et.prototype),ft(et.prototype,"setLiveTranscoding",[EV],Object.getOwnPropertyDescriptor(et.prototype,"setLiveTranscoding"),et.prototype),ft(et.prototype,"stopLiveStreaming",[_V],Object.getOwnPropertyDescriptor(et.prototype,"stopLiveStreaming"),et.prototype),ft(et.prototype,"startChannelMediaRelay",[SV],Object.getOwnPropertyDescriptor(et.prototype,"startChannelMediaRelay"),et.prototype),ft(et.prototype,"updateChannelMediaRelay",[yV],Object.getOwnPropertyDescriptor(et.prototype,"updateChannelMediaRelay"),et.prototype),ft(et.prototype,"stopChannelMediaRelay",[TV],Object.getOwnPropertyDescriptor(et.prototype,"stopChannelMediaRelay"),et.prototype),ft(et.prototype,"sendCustomReportMessage",[vV],Object.getOwnPropertyDescriptor(et.prototype,"sendCustomReportMessage"),et.prototype),ft(et.prototype,"pickSVCLayer",[bV],Object.getOwnPropertyDescriptor(et.prototype,"pickSVCLayer"),et.prototype),ft(et.prototype,"setRTMConfig",[RV],Object.getOwnPropertyDescriptor(et.prototype,"setRTMConfig"),et.prototype),ft(et.prototype,"enableContentInspect",[AV],Object.getOwnPropertyDescriptor(et.prototype,"enableContentInspect"),et.prototype),ft(et.prototype,"disableContentInspect",[CV],Object.getOwnPropertyDescriptor(et.prototype,"disableContentInspect"),et.prototype),ft(et.prototype,"setImageModeration",[IV],Object.getOwnPropertyDescriptor(et.prototype,"setImageModeration"),et.prototype),ft(et.prototype,"setP2PTransport",[wV],Object.getOwnPropertyDescriptor(et.prototype,"setP2PTransport"),et.prototype),ft(et.prototype,"getJoinChannelServiceRecords",[OV],Object.getOwnPropertyDescriptor(et.prototype,"getJoinChannelServiceRecords"),et.prototype),ft(et.prototype,"setPublishAudioFilterEnabled",[DV],Object.getOwnPropertyDescriptor(et.prototype,"setPublishAudioFilterEnabled"),et.prototype),et);class wy{constructor(t,n){W(this,"id",0),W(this,"element",void 0),W(this,"peerPair",void 0),W(this,"context",void 0),W(this,"audioPlayerElement",void 0),W(this,"audioTrack",void 0),wy.count+=1,this.id=wy.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(s,a)=>{const l=a==="offer"?await s.createOffer():await s.createAnswer();return await s.setLocalDescription(l),s.iceGatheringState==="complete"?s.localDescription:new Ye(f=>{s.onicegatheringstatechange=()=>{s.iceGatheringState==="complete"&&f(s.localDescription)}})},n=async(s,a)=>await s.setRemoteDescription(a);try{const s=await t(this.peerPair[0],"offer");await n(this.peerPair[1],s);const a=await t(this.peerPair[1],"answer");await n(this.peerPair[0],a)}catch(s){throw new Ee($.LOCAL_AEC_ERROR,s.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(a){throw new Ee($.LOCAL_AEC_ERROR,a.toString()).print()}if(!n)throw new Ee($.LOCAL_AEC_ERROR,"no dest node when local aec").print();const s=n.stream.getAudioTracks()[0];return this.audioTrack=s,s}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){k.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var LV,iA;W(wy,"count",0);const Sz=window.AudioContext||window.webkitAudioContext,yz=new(LV=Ct({report:gt}),ft((iA=class{constructor(){W(this,"units",[]),W(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return k.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Sz);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new wy(e,this.context),this.units.push(t)),t.startEchoCancellation(),k.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return nn().name!==ln.SAFARI}}).prototype,"processExternalMediaAEC",[LV],Object.getOwnPropertyDescriptor(iA.prototype,"processExternalMediaAEC"),iA.prototype),iA);function xV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function PV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?xV(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xV(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}const mD=window||document;function kV(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!mD)return;const n=Vi._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const s=a=>{if(!(a&&a.blockedURI&&(Vi.onSecurityPolicyViolation||Vi.getListeners(Jl.SECURITY_POLICY_VIOLATION).length>0)))return;const l=a.blockedURI;Z("CSP_DETECTED_HOSTNAME_LIST").some(f=>We(l).call(l,f))&&(Vi.onSecurityPolicyViolation&&typeof Vi.onSecurityPolicyViolation=="function"&&Vi.onSecurityPolicyViolation(a),Vi.getListeners(Jl.SECURITY_POLICY_VIOLATION).length>0&&Vi.safeEmit(Jl.SECURITY_POLICY_VIOLATION,a))};n&&mD.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Vi.getListeners(Jl.SECURITY_POLICY_VIOLATION).length>0)&&mD.addEventListener("securitypolicyviolation",s),Vi._cspEventHandlerPointer=s}var Tz=L,vz=_1,MV=RegExp.prototype,bz=function(e){return e===MV||Tz(MV,e)?vz(e):e.flags},ar=d(bz);function f_(e){let t=e.length;for(;--t>=0;)e[t]=0}const gD=256,UV=286,Oy=30,Dy=15,ED=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),sA=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Rz=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),FV=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mu=new Array(576);f_(mu);const Ny=new Array(60);f_(Ny);const Ly=new Array(512);f_(Ly);const xy=new Array(256);f_(xy);const _D=new Array(29);f_(_D);const rA=new Array(Oy);function SD(e,t,n,s,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=s,this.max_length=a,this.has_stree=e&&e.length}let BV,VV,jV;function yD(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}f_(rA);const GV=e=>e<256?Ly[e]:Ly[256+(e>>>7)],Py=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ga=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Py(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},nd=(e,t,n)=>{Ga(e,n[2*t],n[2*t+1])},HV=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},KV=(e,t,n)=>{const s=new Array(16);let a,l,f=0;for(a=1;a<=Dy;a++)f=f+n[a-1]<<1,s[a]=f;for(l=0;l<=t;l++){let m=e[2*l+1];m!==0&&(e[2*l]=HV(s[m]++,m))}},WV=e=>{let t;for(t=0;t<UV;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Oy;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},YV=e=>{e.bi_valid>8?Py(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},qV=(e,t,n,s)=>{const a=2*t,l=2*n;return e[a]<e[l]||e[a]===e[l]&&s[t]<=s[n]},TD=(e,t,n)=>{const s=e.heap[n];let a=n<<1;for(;a<=e.heap_len&&(a<e.heap_len&&qV(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!qV(t,s,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=s},$V=(e,t,n)=>{let s,a,l,f,m=0;if(e.sym_next!==0)do s=255&e.pending_buf[e.sym_buf+m++],s+=(255&e.pending_buf[e.sym_buf+m++])<<8,a=e.pending_buf[e.sym_buf+m++],s===0?nd(e,a,t):(l=xy[a],nd(e,l+gD+1,t),f=ED[l],f!==0&&(a-=_D[l],Ga(e,a,f)),s--,l=GV(s),nd(e,l,n),f=sA[l],f!==0&&(s-=rA[l],Ga(e,s,f)));while(m<e.sym_next);nd(e,256,t)},vD=(e,t)=>{const n=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,l=t.stat_desc.elems;let f,m,_,S=-1;for(e.heap_len=0,e.heap_max=573,f=0;f<l;f++)n[2*f]!==0?(e.heap[++e.heap_len]=S=f,e.depth[f]=0):n[2*f+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=S<2?++S:0,n[2*_]=1,e.depth[_]=0,e.opt_len--,a&&(e.static_len-=s[2*_+1]);for(t.max_code=S,f=e.heap_len>>1;f>=1;f--)TD(e,n,f);_=l;do f=e.heap[1],e.heap[1]=e.heap[e.heap_len--],TD(e,n,1),m=e.heap[1],e.heap[--e.heap_max]=f,e.heap[--e.heap_max]=m,n[2*_]=n[2*f]+n[2*m],e.depth[_]=(e.depth[f]>=e.depth[m]?e.depth[f]:e.depth[m])+1,n[2*f+1]=n[2*m+1]=_,e.heap[1]=_++,TD(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((b,A)=>{const O=A.dyn_tree,D=A.max_code,G=A.stat_desc.static_tree,B=A.stat_desc.has_stree,j=A.stat_desc.extra_bits,Y=A.stat_desc.extra_base,q=A.stat_desc.max_length;let ie,le,ue,oe,ye,Pe,ze=0;for(oe=0;oe<=Dy;oe++)b.bl_count[oe]=0;for(O[2*b.heap[b.heap_max]+1]=0,ie=b.heap_max+1;ie<573;ie++)le=b.heap[ie],oe=O[2*O[2*le+1]+1]+1,oe>q&&(oe=q,ze++),O[2*le+1]=oe,le>D||(b.bl_count[oe]++,ye=0,le>=Y&&(ye=j[le-Y]),Pe=O[2*le],b.opt_len+=Pe*(oe+ye),B&&(b.static_len+=Pe*(G[2*le+1]+ye)));if(ze!==0){do{for(oe=q-1;b.bl_count[oe]===0;)oe--;b.bl_count[oe]--,b.bl_count[oe+1]+=2,b.bl_count[q]--,ze-=2}while(ze>0);for(oe=q;oe!==0;oe--)for(le=b.bl_count[oe];le!==0;)ue=b.heap[--ie],ue>D||(O[2*ue+1]!==oe&&(b.opt_len+=(oe-O[2*ue+1])*O[2*ue],O[2*ue+1]=oe),le--)}})(e,t),KV(n,S,e.bl_count)},zV=(e,t,n)=>{let s,a,l=-1,f=t[1],m=0,_=7,S=4;for(f===0&&(_=138,S=3),t[2*(n+1)+1]=65535,s=0;s<=n;s++)a=f,f=t[2*(s+1)+1],++m<_&&a===f||(m<S?e.bl_tree[2*a]+=m:a!==0?(a!==l&&e.bl_tree[2*a]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,l=a,f===0?(_=138,S=3):a===f?(_=6,S=3):(_=7,S=4))},XV=(e,t,n)=>{let s,a,l=-1,f=t[1],m=0,_=7,S=4;for(f===0&&(_=138,S=3),s=0;s<=n;s++)if(a=f,f=t[2*(s+1)+1],!(++m<_&&a===f)){if(m<S)do nd(e,a,e.bl_tree);while(--m!=0);else a!==0?(a!==l&&(nd(e,a,e.bl_tree),m--),nd(e,16,e.bl_tree),Ga(e,m-3,2)):m<=10?(nd(e,17,e.bl_tree),Ga(e,m-3,3)):(nd(e,18,e.bl_tree),Ga(e,m-11,7));m=0,l=a,f===0?(_=138,S=3):a===f?(_=6,S=3):(_=7,S=4)}};let JV=!1;const QV=(e,t,n,s)=>{Ga(e,0+(s?1:0),3),YV(e),Py(e,n),Py(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Az=e=>{JV||((()=>{let t,n,s,a,l;const f=new Array(16);for(s=0,a=0;a<28;a++)for(_D[a]=s,t=0;t<1<<ED[a];t++)xy[s++]=a;for(xy[s-1]=a,l=0,a=0;a<16;a++)for(rA[a]=l,t=0;t<1<<sA[a];t++)Ly[l++]=a;for(l>>=7;a<Oy;a++)for(rA[a]=l<<7,t=0;t<1<<sA[a]-7;t++)Ly[256+l++]=a;for(n=0;n<=Dy;n++)f[n]=0;for(t=0;t<=143;)mu[2*t+1]=8,t++,f[8]++;for(;t<=255;)mu[2*t+1]=9,t++,f[9]++;for(;t<=279;)mu[2*t+1]=7,t++,f[7]++;for(;t<=287;)mu[2*t+1]=8,t++,f[8]++;for(KV(mu,287,f),t=0;t<Oy;t++)Ny[2*t+1]=5,Ny[2*t]=HV(t,5);BV=new SD(mu,ED,257,UV,Dy),VV=new SD(Ny,sA,0,Oy,Dy),jV=new SD(new Array(0),Rz,0,19,7)})(),JV=!0),e.l_desc=new yD(e.dyn_ltree,BV),e.d_desc=new yD(e.dyn_dtree,VV),e.bl_desc=new yD(e.bl_tree,jV),e.bi_buf=0,e.bi_valid=0,WV(e)},Cz=(e,t,n,s)=>{let a,l,f=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let _,S=4093624447;for(_=0;_<=31;_++,S>>>=1)if(1&S&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<gD;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(e)),vD(e,e.l_desc),vD(e,e.d_desc),f=(m=>{let _;for(zV(m,m.dyn_ltree,m.l_desc.max_code),zV(m,m.dyn_dtree,m.d_desc.max_code),vD(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*FV[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(e),a=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=a&&(a=l)):a=l=n+5,n+4<=a&&t!==-1?QV(e,t,n,s):e.strategy===4||l===a?(Ga(e,2+(s?1:0),3),$V(e,mu,Ny)):(Ga(e,4+(s?1:0),3),((m,_,S,b)=>{let A;for(Ga(m,_-257,5),Ga(m,S-1,5),Ga(m,b-4,4),A=0;A<b;A++)Ga(m,m.bl_tree[2*FV[A]+1],3);XV(m,m.dyn_ltree,_-1),XV(m,m.dyn_dtree,S-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,f+1),$V(e,e.dyn_ltree,e.dyn_dtree)),WV(e),s&&YV(e)},Iz=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(xy[n]+gD+1)]++,e.dyn_dtree[2*GV(t)]++),e.sym_next===e.sym_end),wz=e=>{Ga(e,2,3),nd(e,256,mu),(t=>{t.bi_valid===16?(Py(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Oz={_tr_init:Az,_tr_stored_block:QV,_tr_flush_block:Cz,_tr_tally:Iz,_tr_align:wz},ky=(e,t,n,s)=>{let a=65535&e|0,l=e>>>16&65535|0,f=0;for(;n!==0;){f=n>2e3?2e3:n,n-=f;do a=a+t[s++]|0,l=l+a|0;while(--f);a%=65521,l%=65521}return a|l<<16|0};const Dz=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var br=(e,t,n,s)=>{const a=Dz,l=s+n;e^=-1;for(let f=s;f<l;f++)e=e>>>8^a[255&(e^t[f])];return-1^e},Em={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},aA={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Nz,_tr_stored_block:bD,_tr_flush_block:Lz,_tr_tally:Xh,_tr_align:xz}=Oz,{Z_NO_FLUSH:Jh,Z_PARTIAL_FLUSH:Pz,Z_FULL_FLUSH:kz,Z_FINISH:rc,Z_BLOCK:ZV,Z_OK:Ur,Z_STREAM_END:ej,Z_STREAM_ERROR:id,Z_DATA_ERROR:Mz,Z_BUF_ERROR:RD,Z_DEFAULT_COMPRESSION:Uz,Z_FILTERED:Fz,Z_HUFFMAN_ONLY:oA,Z_RLE:Bz,Z_FIXED:Vz,Z_DEFAULT_STRATEGY:jz,Z_UNKNOWN:Gz,Z_DEFLATED:cA}=aA,AD=286,Hz=30,Kz=19,Wz=2*AD+1,Yz=15,_m=258,sd=262,p_=42,Sm=113,My=666,ym=(e,t)=>(e.msg=Em[t],t),tj=e=>2*e-(e>4?9:0),Qh=e=>{let t=e.length;for(;--t>=0;)e[t]=0},qz=e=>{let t,n,s,a=e.w_size;t=e.hash_size,s=t;do n=e.head[--s],e.head[s]=n>=a?n-a:0;while(--t);t=a,s=t;do n=e.prev[--s],e.prev[s]=n>=a?n-a:0;while(--t)};let Zh=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ho=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},fo=(e,t)=>{Lz(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ho(e.strm)},Si=(e,t)=>{e.pending_buf[e.pending++]=t},Uy=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},CD=(e,t,n,s)=>{let a=e.avail_in;return a>s&&(a=s),a===0?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),n),e.state.wrap===1?e.adler=ky(e.adler,t,a,n):e.state.wrap===2&&(e.adler=br(e.adler,t,a,n)),e.next_in+=a,e.total_in+=a,a)},nj=(e,t)=>{let n,s,a=e.max_chain_length,l=e.strstart,f=e.prev_length,m=e.nice_match;const _=e.strstart>e.w_size-sd?e.strstart-(e.w_size-sd):0,S=e.window,b=e.w_mask,A=e.prev,O=e.strstart+_m;let D=S[l+f-1],G=S[l+f];e.prev_length>=e.good_match&&(a>>=2),m>e.lookahead&&(m=e.lookahead);do if(n=t,S[n+f]===G&&S[n+f-1]===D&&S[n]===S[l]&&S[++n]===S[l+1]){l+=2,n++;do;while(S[++l]===S[++n]&&S[++l]===S[++n]&&S[++l]===S[++n]&&S[++l]===S[++n]&&S[++l]===S[++n]&&S[++l]===S[++n]&&S[++l]===S[++n]&&S[++l]===S[++n]&&l<O);if(s=_m-(O-l),l=O-_m,s>f){if(e.match_start=t,f=s,s>=m)break;D=S[l+f-1],G=S[l+f]}}while((t=A[t&b])>_&&--a!=0);return f<=e.lookahead?f:e.lookahead},m_=e=>{const t=e.w_size;let n,s,a;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-sd)&&(e.window.set(e.window.subarray(t,t+t-s),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),qz(e),s+=t),e.strm.avail_in===0)break;if(n=CD(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=n,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=Zh(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=Zh(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<sd&&e.strm.avail_in!==0)},ij=(e,t)=>{let n,s,a,l=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,f=0,m=e.strm.avail_in;do{if(n=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a||(a=e.strm.avail_out-a,s=e.strstart-e.block_start,n>s+e.strm.avail_in&&(n=s+e.strm.avail_in),n>a&&(n=a),n<l&&(n===0&&t!==rc||t===Jh||n!==s+e.strm.avail_in)))break;f=t===rc&&n===s+e.strm.avail_in?1:0,bD(e,0,0,f),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ho(e.strm),s&&(s>n&&(s=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,n-=s),n&&(CD(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(f===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),f?4:t!==Jh&&t!==rc&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(CD(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,l=a>e.w_size?e.w_size:a,s=e.strstart-e.block_start,(s>=l||(s||t===rc)&&t!==Jh&&e.strm.avail_in===0&&s<=a)&&(n=s>a?a:s,f=t===rc&&e.strm.avail_in===0&&n===s?1:0,bD(e,e.block_start,n,f),e.block_start+=n,ho(e.strm)),f?3:1)},ID=(e,t)=>{let n,s;for(;;){if(e.lookahead<sd){if(m_(e),e.lookahead<sd&&t===Jh)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Zh(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-sd&&(e.match_length=nj(e,n)),e.match_length>=3)if(s=Xh(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Zh(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Zh(e,e.ins_h,e.window[e.strstart+1]);else s=Xh(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(fo(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===rc?(fo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(fo(e,!1),e.strm.avail_out===0)?1:2},g_=(e,t)=>{let n,s,a;for(;;){if(e.lookahead<sd){if(m_(e),e.lookahead<sd&&t===Jh)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Zh(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-sd&&(e.match_length=nj(e,n),e.match_length<=5&&(e.strategy===Fz||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,s=Xh(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=Zh(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(fo(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(s=Xh(e,0,e.window[e.strstart-1]),s&&fo(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Xh(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===rc?(fo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(fo(e,!1),e.strm.avail_out===0)?1:2};function rd(e,t,n,s,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=s,this.func=a}const Fy=[new rd(0,0,0,0,ij),new rd(4,4,8,4,ID),new rd(4,5,16,8,ID),new rd(4,6,32,32,ID),new rd(4,4,16,16,g_),new rd(8,16,32,32,g_),new rd(8,16,128,128,g_),new rd(8,32,128,256,g_),new rd(32,128,258,1024,g_),new rd(32,258,258,4096,g_)];function $z(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=cA,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Wz),this.dyn_dtree=new Uint16Array(2*(2*Hz+1)),this.bl_tree=new Uint16Array(2*(2*Kz+1)),Qh(this.dyn_ltree),Qh(this.dyn_dtree),Qh(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Yz+1),this.heap=new Uint16Array(2*AD+1),Qh(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*AD+1),Qh(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const By=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==p_&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Sm&&t.status!==My?1:0},sj=e=>{if(By(e))return ym(e,id);e.total_in=e.total_out=0,e.data_type=Gz;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?p_:Sm,e.adler=t.wrap===2?0:1,t.last_flush=-2,Nz(t),Ur},rj=e=>{const t=sj(e);return t===Ur&&(n=>{n.window_size=2*n.w_size,Qh(n.head),n.max_lazy_match=Fy[n.level].max_lazy,n.good_match=Fy[n.level].good_length,n.nice_match=Fy[n.level].nice_length,n.max_chain_length=Fy[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},aj=(e,t,n,s,a,l)=>{if(!e)return id;let f=1;if(t===Uz&&(t=6),s<0?(f=0,s=-s):s>15&&(f=2,s-=16),a<1||a>9||n!==cA||s<8||s>15||t<0||t>9||l<0||l>Vz||s===8&&f!==1)return ym(e,id);s===8&&(s=9);const m=new $z;return e.state=m,m.strm=e,m.status=p_,m.wrap=f,m.gzhead=null,m.w_bits=s,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=a+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<a+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=t,m.strategy=l,m.method=n,rj(e)};var zz=(e,t)=>{if(By(e)||t>ZV||t<0)return e?ym(e,id):id;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===My&&t!==rc)return ym(e,e.avail_out===0?RD:id);const s=n.last_flush;if(n.last_flush=t,n.pending!==0){if(ho(e),e.avail_out===0)return n.last_flush=-1,Ur}else if(e.avail_in===0&&tj(t)<=tj(s)&&t!==rc)return ym(e,RD);if(n.status===My&&e.avail_in!==0)return ym(e,RD);if(n.status===p_&&n.wrap===0&&(n.status=Sm),n.status===p_){let a=cA+(n.w_bits-8<<4)<<8,l=-1;if(l=n.strategy>=oA||n.level<2?0:n.level<6?1:n.level===6?2:3,a|=l<<6,n.strstart!==0&&(a|=32),a+=31-a%31,Uy(n,a),n.strstart!==0&&(Uy(n,e.adler>>>16),Uy(n,65535&e.adler)),e.adler=1,n.status=Sm,ho(e),n.pending!==0)return n.last_flush=-1,Ur}if(n.status===57){if(e.adler=0,Si(n,31),Si(n,139),Si(n,8),n.gzhead)Si(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Si(n,255&n.gzhead.time),Si(n,n.gzhead.time>>8&255),Si(n,n.gzhead.time>>16&255),Si(n,n.gzhead.time>>24&255),Si(n,n.level===9?2:n.strategy>=oA||n.level<2?4:0),Si(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Si(n,255&n.gzhead.extra.length),Si(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=br(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Si(n,0),Si(n,0),Si(n,0),Si(n,0),Si(n,0),Si(n,n.level===9?2:n.strategy>=oA||n.level<2?4:0),Si(n,3),n.status=Sm,ho(e),n.pending!==0)return n.last_flush=-1,Ur}if(n.status===69){if(n.gzhead.extra){let a=n.pending,l=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+l>n.pending_buf_size;){let m=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+m),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>a&&(e.adler=br(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex+=m,ho(e),n.pending!==0)return n.last_flush=-1,Ur;a=0,l-=m}let f=new Uint8Array(n.gzhead.extra);n.pending_buf.set(f.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending+=l,n.gzhead.hcrc&&n.pending>a&&(e.adler=br(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let a,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=br(e.adler,n.pending_buf,n.pending-l,l)),ho(e),n.pending!==0)return n.last_flush=-1,Ur;l=0}a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Si(n,a)}while(a!==0);n.gzhead.hcrc&&n.pending>l&&(e.adler=br(e.adler,n.pending_buf,n.pending-l,l)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let a,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=br(e.adler,n.pending_buf,n.pending-l,l)),ho(e),n.pending!==0)return n.last_flush=-1,Ur;l=0}a=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Si(n,a)}while(a!==0);n.gzhead.hcrc&&n.pending>l&&(e.adler=br(e.adler,n.pending_buf,n.pending-l,l))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ho(e),n.pending!==0))return n.last_flush=-1,Ur;Si(n,255&e.adler),Si(n,e.adler>>8&255),e.adler=0}if(n.status=Sm,ho(e),n.pending!==0)return n.last_flush=-1,Ur}if(e.avail_in!==0||n.lookahead!==0||t!==Jh&&n.status!==My){let a=n.level===0?ij(n,t):n.strategy===oA?((l,f)=>{let m;for(;;){if(l.lookahead===0&&(m_(l),l.lookahead===0)){if(f===Jh)return 1;break}if(l.match_length=0,m=Xh(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,m&&(fo(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,f===rc?(fo(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(fo(l,!1),l.strm.avail_out===0)?1:2})(n,t):n.strategy===Bz?((l,f)=>{let m,_,S,b;const A=l.window;for(;;){if(l.lookahead<=_m){if(m_(l),l.lookahead<=_m&&f===Jh)return 1;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(S=l.strstart-1,_=A[S],_===A[++S]&&_===A[++S]&&_===A[++S])){b=l.strstart+_m;do;while(_===A[++S]&&_===A[++S]&&_===A[++S]&&_===A[++S]&&_===A[++S]&&_===A[++S]&&_===A[++S]&&_===A[++S]&&S<b);l.match_length=_m-(b-S),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(m=Xh(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(m=Xh(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),m&&(fo(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,f===rc?(fo(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(fo(l,!1),l.strm.avail_out===0)?1:2})(n,t):Fy[n.level].func(n,t);if(a!==3&&a!==4||(n.status=My),a===1||a===3)return e.avail_out===0&&(n.last_flush=-1),Ur;if(a===2&&(t===Pz?xz(n):t!==ZV&&(bD(n,0,0,!1),t===kz&&(Qh(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),ho(e),e.avail_out===0))return n.last_flush=-1,Ur}return t!==rc?Ur:n.wrap<=0?ej:(n.wrap===2?(Si(n,255&e.adler),Si(n,e.adler>>8&255),Si(n,e.adler>>16&255),Si(n,e.adler>>24&255),Si(n,255&e.total_in),Si(n,e.total_in>>8&255),Si(n,e.total_in>>16&255),Si(n,e.total_in>>24&255)):(Uy(n,e.adler>>>16),Uy(n,65535&e.adler)),ho(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Ur:ej)},Xz=(e,t)=>{let n=t.length;if(By(e))return id;const s=e.state,a=s.wrap;if(a===2||a===1&&s.status!==p_||s.lookahead)return id;if(a===1&&(e.adler=ky(e.adler,t,n,0)),s.wrap=0,n>=s.w_size){a===0&&(Qh(s.head),s.strstart=0,s.block_start=0,s.insert=0);let _=new Uint8Array(s.w_size);_.set(t.subarray(n-s.w_size,n),0),t=_,n=s.w_size}const l=e.avail_in,f=e.next_in,m=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,m_(s);s.lookahead>=3;){let _=s.strstart,S=s.lookahead-2;do s.ins_h=Zh(s,s.ins_h,s.window[_+3-1]),s.prev[_&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=_,_++;while(--S);s.strstart=_,s.lookahead=2,m_(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=f,e.input=m,e.avail_in=l,s.wrap=a,Ur},Vy={deflateInit:(e,t)=>aj(e,t,cA,15,8,jz),deflateInit2:aj,deflateReset:rj,deflateResetKeep:sj,deflateSetHeader:(e,t)=>By(e)||e.state.wrap!==2?id:(e.state.gzhead=t,Ur),deflate:zz,deflateEnd:e=>{if(By(e))return id;const t=e.state.status;return e.state=null,t===Sm?ym(e,Mz):Ur},deflateSetDictionary:Xz,deflateInfo:"pako deflate (from Nodeca project)"};const Jz=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var lA={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const s in n)Jz(n,s)&&(e[s]=n[s])}}return e},flattenChunks:e=>{let t=0;for(let s=0,a=e.length;s<a;s++)t+=e[s].length;const n=new Uint8Array(t);for(let s=0,a=0,l=e.length;s<l;s++){let f=e[s];n.set(f,a),a+=f.length}return n}};let oj=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{oj=!1}const jy=new Uint8Array(256);for(let e=0;e<256;e++)jy[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;jy[254]=jy[254]=1;var Gy={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,s,a,l,f=e.length,m=0;for(a=0;a<f;a++)n=e.charCodeAt(a),(64512&n)==55296&&a+1<f&&(s=e.charCodeAt(a+1),(64512&s)==56320&&(n=65536+(n-55296<<10)+(s-56320),a++)),m+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(m),l=0,a=0;l<m;a++)n=e.charCodeAt(a),(64512&n)==55296&&a+1<f&&(s=e.charCodeAt(a+1),(64512&s)==56320&&(n=65536+(n-55296<<10)+(s-56320),a++)),n<128?t[l++]=n:n<2048?(t[l++]=192|n>>>6,t[l++]=128|63&n):n<65536?(t[l++]=224|n>>>12,t[l++]=128|n>>>6&63,t[l++]=128|63&n):(t[l++]=240|n>>>18,t[l++]=128|n>>>12&63,t[l++]=128|n>>>6&63,t[l++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let s,a;const l=new Array(2*n);for(a=0,s=0;s<n;){let f=e[s++];if(f<128){l[a++]=f;continue}let m=jy[f];if(m>4)l[a++]=65533,s+=m-1;else{for(f&=m===2?31:m===3?15:7;m>1&&s<n;)f=f<<6|63&e[s++],m--;m>1?l[a++]=65533:f<65536?l[a++]=f:(f-=65536,l[a++]=55296|f>>10&1023,l[a++]=56320|1023&f)}}return((f,m)=>{if(m<65534&&f.subarray&&oj)return String.fromCharCode.apply(null,f.length===m?f:f.subarray(0,m));let _="";for(let S=0;S<m;S++)_+=String.fromCharCode(f[S]);return _})(l,a)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+jy[e[n]]>t?n:t}},cj=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const lj=Object.prototype.toString,{Z_NO_FLUSH:Qz,Z_SYNC_FLUSH:Zz,Z_FULL_FLUSH:e7,Z_FINISH:t7,Z_OK:dA,Z_STREAM_END:n7,Z_DEFAULT_COMPRESSION:i7,Z_DEFAULT_STRATEGY:s7,Z_DEFLATED:r7}=aA;function uA(e){this.options=lA.assign({level:i7,method:r7,chunkSize:16384,windowBits:15,memLevel:8,strategy:s7},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new cj,this.strm.avail_out=0;let n=Vy.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==dA)throw new Error(Em[n]);if(t.header&&Vy.deflateSetHeader(this.strm,t.header),t.dictionary){let s;if(s=typeof t.dictionary=="string"?Gy.string2buf(t.dictionary):lj.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=Vy.deflateSetDictionary(this.strm,s),n!==dA)throw new Error(Em[n]);this._dict_set=!0}}function a7(e,t){const n=new uA(t);if(n.push(e,!0),n.err)throw n.msg||Em[n.err];return n.result}uA.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize;let a,l;if(this.ended)return!1;for(l=t===~~t?t:t===!0?t7:Qz,typeof e=="string"?n.input=Gy.string2buf(e):lj.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),(l===Zz||l===e7)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(a=Vy.deflate(n,l),a===n7)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),a=Vy.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===dA;if(n.avail_out!==0){if(l>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},uA.prototype.onData=function(e){this.chunks.push(e)},uA.prototype.onEnd=function(e){e===dA&&(this.result=lA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var o7={deflate:a7};const hA=16209;var c7=function(e,t){let n,s,a,l,f,m,_,S,b,A,O,D,G,B,j,Y,q,ie,le,ue,oe,ye,Pe,ze;const nt=e.state;n=e.next_in,Pe=e.input,s=n+(e.avail_in-5),a=e.next_out,ze=e.output,l=a-(t-e.avail_out),f=a+(e.avail_out-257),m=nt.dmax,_=nt.wsize,S=nt.whave,b=nt.wnext,A=nt.window,O=nt.hold,D=nt.bits,G=nt.lencode,B=nt.distcode,j=(1<<nt.lenbits)-1,Y=(1<<nt.distbits)-1;e:do{D<15&&(O+=Pe[n++]<<D,D+=8,O+=Pe[n++]<<D,D+=8),q=G[O&j];t:for(;;){if(ie=q>>>24,O>>>=ie,D-=ie,ie=q>>>16&255,ie===0)ze[a++]=65535&q;else{if(!(16&ie)){if((64&ie)==0){q=G[(65535&q)+(O&(1<<ie)-1)];continue t}if(32&ie){nt.mode=16191;break e}e.msg="invalid literal/length code",nt.mode=hA;break e}le=65535&q,ie&=15,ie&&(D<ie&&(O+=Pe[n++]<<D,D+=8),le+=O&(1<<ie)-1,O>>>=ie,D-=ie),D<15&&(O+=Pe[n++]<<D,D+=8,O+=Pe[n++]<<D,D+=8),q=B[O&Y];n:for(;;){if(ie=q>>>24,O>>>=ie,D-=ie,ie=q>>>16&255,!(16&ie)){if((64&ie)==0){q=B[(65535&q)+(O&(1<<ie)-1)];continue n}e.msg="invalid distance code",nt.mode=hA;break e}if(ue=65535&q,ie&=15,D<ie&&(O+=Pe[n++]<<D,D+=8,D<ie&&(O+=Pe[n++]<<D,D+=8)),ue+=O&(1<<ie)-1,ue>m){e.msg="invalid distance too far back",nt.mode=hA;break e}if(O>>>=ie,D-=ie,ie=a-l,ue>ie){if(ie=ue-ie,ie>S&&nt.sane){e.msg="invalid distance too far back",nt.mode=hA;break e}if(oe=0,ye=A,b===0){if(oe+=_-ie,ie<le){le-=ie;do ze[a++]=A[oe++];while(--ie);oe=a-ue,ye=ze}}else if(b<ie){if(oe+=_+b-ie,ie-=b,ie<le){le-=ie;do ze[a++]=A[oe++];while(--ie);if(oe=0,b<le){ie=b,le-=ie;do ze[a++]=A[oe++];while(--ie);oe=a-ue,ye=ze}}}else if(oe+=b-ie,ie<le){le-=ie;do ze[a++]=A[oe++];while(--ie);oe=a-ue,ye=ze}for(;le>2;)ze[a++]=ye[oe++],ze[a++]=ye[oe++],ze[a++]=ye[oe++],le-=3;le&&(ze[a++]=ye[oe++],le>1&&(ze[a++]=ye[oe++]))}else{oe=a-ue;do ze[a++]=ze[oe++],ze[a++]=ze[oe++],ze[a++]=ze[oe++],le-=3;while(le>2);le&&(ze[a++]=ze[oe++],le>1&&(ze[a++]=ze[oe++]))}break}}break}}while(n<s&&a<f);le=D>>3,n-=le,D-=le<<3,O&=(1<<D)-1,e.next_in=n,e.next_out=a,e.avail_in=n<s?s-n+5:5-(n-s),e.avail_out=a<f?f-a+257:257-(a-f),nt.hold=O,nt.bits=D};const fA=15,l7=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),d7=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),u7=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),h7=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Hy=(e,t,n,s,a,l,f,m)=>{const _=m.bits;let S,b,A,O,D,G,B=0,j=0,Y=0,q=0,ie=0,le=0,ue=0,oe=0,ye=0,Pe=0,ze=null;const nt=new Uint16Array(16),$t=new Uint16Array(16);let zt,Mn,Ai,pi=null;for(B=0;B<=fA;B++)nt[B]=0;for(j=0;j<s;j++)nt[t[n+j]]++;for(ie=_,q=fA;q>=1&&nt[q]===0;q--);if(ie>q&&(ie=q),q===0)return a[l++]=20971520,a[l++]=20971520,m.bits=1,0;for(Y=1;Y<q&&nt[Y]===0;Y++);for(ie<Y&&(ie=Y),oe=1,B=1;B<=fA;B++)if(oe<<=1,oe-=nt[B],oe<0)return-1;if(oe>0&&(e===0||q!==1))return-1;for($t[1]=0,B=1;B<fA;B++)$t[B+1]=$t[B]+nt[B];for(j=0;j<s;j++)t[n+j]!==0&&(f[$t[t[n+j]]++]=j);if(e===0?(ze=pi=f,G=20):e===1?(ze=l7,pi=d7,G=257):(ze=u7,pi=h7,G=0),Pe=0,j=0,B=Y,D=l,le=ie,ue=0,A=-1,ye=1<<ie,O=ye-1,e===1&&ye>852||e===2&&ye>592)return 1;for(;;){zt=B-ue,f[j]+1<G?(Mn=0,Ai=f[j]):f[j]>=G?(Mn=pi[f[j]-G],Ai=ze[f[j]-G]):(Mn=96,Ai=0),S=1<<B-ue,b=1<<le,Y=b;do b-=S,a[D+(Pe>>ue)+b]=zt<<24|Mn<<16|Ai|0;while(b!==0);for(S=1<<B-1;Pe&S;)S>>=1;if(S!==0?(Pe&=S-1,Pe+=S):Pe=0,j++,--nt[B]==0){if(B===q)break;B=t[n+f[j]]}if(B>ie&&(Pe&O)!==A){for(ue===0&&(ue=ie),D+=Y,le=B-ue,oe=1<<le;le+ue<q&&(oe-=nt[le+ue],!(oe<=0));)le++,oe<<=1;if(ye+=1<<le,e===1&&ye>852||e===2&&ye>592)return 1;A=Pe&O,a[A]=ie<<24|le<<16|D-l|0}}return Pe!==0&&(a[D+Pe]=B-ue<<24|64<<16|0),m.bits=ie,0};const{Z_FINISH:dj,Z_BLOCK:f7,Z_TREES:pA,Z_OK:Tm,Z_STREAM_END:p7,Z_NEED_DICT:m7,Z_STREAM_ERROR:ac,Z_DATA_ERROR:uj,Z_MEM_ERROR:hj,Z_BUF_ERROR:g7,Z_DEFLATED:fj}=aA,mA=16180,gA=16190,gu=16191,wD=16192,OD=16194,EA=16199,_A=16200,DD=16206,ls=16209,pj=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function E7(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const vm=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<mA||t.mode>16211?1:0},mj=e=>{if(vm(e))return ac;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=mA,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Tm},gj=e=>{if(vm(e))return ac;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,mj(e)},Ej=(e,t)=>{let n;if(vm(e))return ac;const s=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ac:(s.window!==null&&s.wbits!==t&&(s.window=null),s.wrap=n,s.wbits=t,gj(e))},_j=(e,t)=>{if(!e)return ac;const n=new E7;e.state=n,n.strm=e,n.window=null,n.mode=mA;const s=Ej(e,t);return s!==Tm&&(e.state=null),s};let ND,LD,Sj=!0;const _7=e=>{if(Sj){ND=new Int32Array(512),LD=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Hy(1,e.lens,0,288,ND,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Hy(2,e.lens,0,32,LD,0,e.work,{bits:5}),Sj=!1}e.lencode=ND,e.lenbits=9,e.distcode=LD,e.distbits=5},yj=(e,t,n,s)=>{let a;const l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),s>=l.wsize?(l.window.set(t.subarray(n-l.wsize,n),0),l.wnext=0,l.whave=l.wsize):(a=l.wsize-l.wnext,a>s&&(a=s),l.window.set(t.subarray(n-s,n-s+a),l.wnext),(s-=a)?(l.window.set(t.subarray(n-s,n),0),l.wnext=s,l.whave=l.wsize):(l.wnext+=a,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=a))),0};var S7=(e,t)=>{let n,s,a,l,f,m,_,S,b,A,O,D,G,B,j,Y,q,ie,le,ue,oe,ye,Pe=0;const ze=new Uint8Array(4);let nt,$t;const zt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(vm(e)||!e.output||!e.input&&e.avail_in!==0)return ac;n=e.state,n.mode===gu&&(n.mode=wD),f=e.next_out,a=e.output,_=e.avail_out,l=e.next_in,s=e.input,m=e.avail_in,S=n.hold,b=n.bits,A=m,O=_,ye=Tm;e:for(;;)switch(n.mode){case mA:if(n.wrap===0){n.mode=wD;break}for(;b<16;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}if(2&n.wrap&&S===35615){n.wbits===0&&(n.wbits=15),n.check=0,ze[0]=255&S,ze[1]=S>>>8&255,n.check=br(n.check,ze,2,0),S=0,b=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&S)<<8)+(S>>8))%31){e.msg="incorrect header check",n.mode=ls;break}if((15&S)!==fj){e.msg="unknown compression method",n.mode=ls;break}if(S>>>=4,b-=4,oe=8+(15&S),n.wbits===0&&(n.wbits=oe),oe>15||oe>n.wbits){e.msg="invalid window size",n.mode=ls;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&S?16189:gu,S=0,b=0;break;case 16181:for(;b<16;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}if(n.flags=S,(255&ar(n))!==fj){e.msg="unknown compression method",n.mode=ls;break}if(57344&ar(n)){e.msg="unknown header flags set",n.mode=ls;break}n.head&&(n.head.text=S>>8&1),512&ar(n)&&4&n.wrap&&(ze[0]=255&S,ze[1]=S>>>8&255,n.check=br(n.check,ze,2,0)),S=0,b=0,n.mode=16182;case 16182:for(;b<32;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}n.head&&(n.head.time=S),512&ar(n)&&4&n.wrap&&(ze[0]=255&S,ze[1]=S>>>8&255,ze[2]=S>>>16&255,ze[3]=S>>>24&255,n.check=br(n.check,ze,4,0)),S=0,b=0,n.mode=16183;case 16183:for(;b<16;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}n.head&&(n.head.xflags=255&S,n.head.os=S>>8),512&ar(n)&&4&n.wrap&&(ze[0]=255&S,ze[1]=S>>>8&255,n.check=br(n.check,ze,2,0)),S=0,b=0,n.mode=16184;case 16184:if(1024&ar(n)){for(;b<16;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}n.length=S,n.head&&(n.head.extra_len=S),512&ar(n)&&4&n.wrap&&(ze[0]=255&S,ze[1]=S>>>8&255,n.check=br(n.check,ze,2,0)),S=0,b=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&ar(n)&&(D=n.length,D>m&&(D=m),D&&(n.head&&(oe=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(s.subarray(l,l+D),oe)),512&ar(n)&&4&n.wrap&&(n.check=br(n.check,s,D,l)),m-=D,l+=D,n.length-=D),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&ar(n)){if(m===0)break e;D=0;do oe=s[l+D++],n.head&&oe&&n.length<65536&&(n.head.name+=String.fromCharCode(oe));while(oe&&D<m);if(512&ar(n)&&4&n.wrap&&(n.check=br(n.check,s,D,l)),m-=D,l+=D,oe)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&ar(n)){if(m===0)break e;D=0;do oe=s[l+D++],n.head&&oe&&n.length<65536&&(n.head.comment+=String.fromCharCode(oe));while(oe&&D<m);if(512&ar(n)&&4&n.wrap&&(n.check=br(n.check,s,D,l)),m-=D,l+=D,oe)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&ar(n)){for(;b<16;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}if(4&n.wrap&&S!==(65535&n.check)){e.msg="header crc mismatch",n.mode=ls;break}S=0,b=0}n.head&&(n.head.hcrc=ar(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=gu;break;case 16189:for(;b<32;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}e.adler=n.check=pj(S),S=0,b=0,n.mode=gA;case gA:if(n.havedict===0)return e.next_out=f,e.avail_out=_,e.next_in=l,e.avail_in=m,n.hold=S,n.bits=b,m7;e.adler=n.check=1,n.mode=gu;case gu:if(t===f7||t===pA)break e;case wD:if(n.last){S>>>=7&b,b-=7&b,n.mode=DD;break}for(;b<3;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}switch(n.last=1&S,S>>>=1,b-=1,3&S){case 0:n.mode=16193;break;case 1:if(_7(n),n.mode=EA,t===pA){S>>>=2,b-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=ls}S>>>=2,b-=2;break;case 16193:for(S>>>=7&b,b-=7&b;b<32;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}if((65535&S)!=(S>>>16^65535)){e.msg="invalid stored block lengths",n.mode=ls;break}if(n.length=65535&S,S=0,b=0,n.mode=OD,t===pA)break e;case OD:n.mode=16195;case 16195:if(D=n.length,D){if(D>m&&(D=m),D>_&&(D=_),D===0)break e;a.set(s.subarray(l,l+D),f),m-=D,l+=D,_-=D,f+=D,n.length-=D;break}n.mode=gu;break;case 16196:for(;b<14;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}if(n.nlen=257+(31&S),S>>>=5,b-=5,n.ndist=1+(31&S),S>>>=5,b-=5,n.ncode=4+(15&S),S>>>=4,b-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=ls;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;b<3;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}n.lens[zt[n.have++]]=7&S,S>>>=3,b-=3}for(;n.have<19;)n.lens[zt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,nt={bits:n.lenbits},ye=Hy(0,n.lens,0,19,n.lencode,0,n.work,nt),n.lenbits=nt.bits,ye){e.msg="invalid code lengths set",n.mode=ls;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;Pe=n.lencode[S&(1<<n.lenbits)-1],j=Pe>>>24,Y=Pe>>>16&255,q=65535&Pe,!(j<=b);){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}if(q<16)S>>>=j,b-=j,n.lens[n.have++]=q;else{if(q===16){for($t=j+2;b<$t;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}if(S>>>=j,b-=j,n.have===0){e.msg="invalid bit length repeat",n.mode=ls;break}oe=n.lens[n.have-1],D=3+(3&S),S>>>=2,b-=2}else if(q===17){for($t=j+3;b<$t;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}S>>>=j,b-=j,oe=0,D=3+(7&S),S>>>=3,b-=3}else{for($t=j+7;b<$t;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}S>>>=j,b-=j,oe=0,D=11+(127&S),S>>>=7,b-=7}if(n.have+D>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=ls;break}for(;D--;)n.lens[n.have++]=oe}}if(n.mode===ls)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=ls;break}if(n.lenbits=9,nt={bits:n.lenbits},ye=Hy(1,n.lens,0,n.nlen,n.lencode,0,n.work,nt),n.lenbits=nt.bits,ye){e.msg="invalid literal/lengths set",n.mode=ls;break}if(n.distbits=6,n.distcode=n.distdyn,nt={bits:n.distbits},ye=Hy(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,nt),n.distbits=nt.bits,ye){e.msg="invalid distances set",n.mode=ls;break}if(n.mode=EA,t===pA)break e;case EA:n.mode=_A;case _A:if(m>=6&&_>=258){e.next_out=f,e.avail_out=_,e.next_in=l,e.avail_in=m,n.hold=S,n.bits=b,c7(e,O),f=e.next_out,a=e.output,_=e.avail_out,l=e.next_in,s=e.input,m=e.avail_in,S=n.hold,b=n.bits,n.mode===gu&&(n.back=-1);break}for(n.back=0;Pe=n.lencode[S&(1<<n.lenbits)-1],j=Pe>>>24,Y=Pe>>>16&255,q=65535&Pe,!(j<=b);){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}if(Y&&(240&Y)==0){for(ie=j,le=Y,ue=q;Pe=n.lencode[ue+((S&(1<<ie+le)-1)>>ie)],j=Pe>>>24,Y=Pe>>>16&255,q=65535&Pe,!(ie+j<=b);){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}S>>>=ie,b-=ie,n.back+=ie}if(S>>>=j,b-=j,n.back+=j,n.length=q,Y===0){n.mode=16205;break}if(32&Y){n.back=-1,n.mode=gu;break}if(64&Y){e.msg="invalid literal/length code",n.mode=ls;break}n.extra=15&Y,n.mode=16201;case 16201:if(n.extra){for($t=n.extra;b<$t;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}n.length+=S&(1<<n.extra)-1,S>>>=n.extra,b-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;Pe=n.distcode[S&(1<<n.distbits)-1],j=Pe>>>24,Y=Pe>>>16&255,q=65535&Pe,!(j<=b);){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}if((240&Y)==0){for(ie=j,le=Y,ue=q;Pe=n.distcode[ue+((S&(1<<ie+le)-1)>>ie)],j=Pe>>>24,Y=Pe>>>16&255,q=65535&Pe,!(ie+j<=b);){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}S>>>=ie,b-=ie,n.back+=ie}if(S>>>=j,b-=j,n.back+=j,64&Y){e.msg="invalid distance code",n.mode=ls;break}n.offset=q,n.extra=15&Y,n.mode=16203;case 16203:if(n.extra){for($t=n.extra;b<$t;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}n.offset+=S&(1<<n.extra)-1,S>>>=n.extra,b-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=ls;break}n.mode=16204;case 16204:if(_===0)break e;if(D=O-_,n.offset>D){if(D=n.offset-D,D>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=ls;break}D>n.wnext?(D-=n.wnext,G=n.wsize-D):G=n.wnext-D,D>n.length&&(D=n.length),B=n.window}else B=a,G=f-n.offset,D=n.length;D>_&&(D=_),_-=D,n.length-=D;do a[f++]=B[G++];while(--D);n.length===0&&(n.mode=_A);break;case 16205:if(_===0)break e;a[f++]=n.length,_--,n.mode=_A;break;case DD:if(n.wrap){for(;b<32;){if(m===0)break e;m--,S|=s[l++]<<b,b+=8}if(O-=_,e.total_out+=O,n.total+=O,4&n.wrap&&O&&(e.adler=n.check=ar(n)?br(n.check,a,O,f-O):ky(n.check,a,O,f-O)),O=_,4&n.wrap&&(ar(n)?S:pj(S))!==n.check){e.msg="incorrect data check",n.mode=ls;break}S=0,b=0}n.mode=16207;case 16207:if(n.wrap&&ar(n)){for(;b<32;){if(m===0)break e;m--,S+=s[l++]<<b,b+=8}if(4&n.wrap&&S!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=ls;break}S=0,b=0}n.mode=16208;case 16208:ye=p7;break e;case ls:ye=uj;break e;case 16210:return hj;default:return ac}return e.next_out=f,e.avail_out=_,e.next_in=l,e.avail_in=m,n.hold=S,n.bits=b,(n.wsize||O!==e.avail_out&&n.mode<ls&&(n.mode<DD||t!==dj))&&yj(e,e.output,e.next_out,O-e.avail_out),A-=e.avail_in,O-=e.avail_out,e.total_in+=A,e.total_out+=O,n.total+=O,4&n.wrap&&O&&(e.adler=n.check=ar(n)?br(n.check,a,O,e.next_out-O):ky(n.check,a,O,e.next_out-O)),e.data_type=n.bits+(n.last?64:0)+(n.mode===gu?128:0)+(n.mode===EA||n.mode===OD?256:0),(A===0&&O===0||t===dj)&&ye===Tm&&(ye=g7),ye},Eu={inflateReset:gj,inflateReset2:Ej,inflateResetKeep:mj,inflateInit:e=>_j(e,15),inflateInit2:_j,inflate:S7,inflateEnd:e=>{if(vm(e))return ac;let t=e.state;return t.window&&(t.window=null),e.state=null,Tm},inflateGetHeader:(e,t)=>{if(vm(e))return ac;const n=e.state;return(2&n.wrap)==0?ac:(n.head=t,t.done=!1,Tm)},inflateSetDictionary:(e,t)=>{const n=t.length;let s,a,l;return vm(e)?ac:(s=e.state,s.wrap!==0&&s.mode!==gA?ac:s.mode===gA&&(a=1,a=ky(a,t,n,0),a!==s.check)?uj:(l=yj(e,t,n,n),l?(s.mode=16210,hj):(s.havedict=1,Tm)))},inflateInfo:"pako inflate (from Nodeca project)"},y7=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Tj=Object.prototype.toString,{Z_NO_FLUSH:T7,Z_FINISH:v7,Z_OK:Ky,Z_STREAM_END:xD,Z_NEED_DICT:PD,Z_STREAM_ERROR:b7,Z_DATA_ERROR:vj,Z_MEM_ERROR:R7}=aA;function SA(e){this.options=lA.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new cj,this.strm.avail_out=0;let n=Eu.inflateInit2(this.strm,t.windowBits);if(n!==Ky)throw new Error(Em[n]);if(this.header=new y7,Eu.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Gy.string2buf(t.dictionary):Tj.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Eu.inflateSetDictionary(this.strm,t.dictionary),n!==Ky)))throw new Error(Em[n])}function A7(e,t){const n=new SA(t);if(n.push(e),n.err)throw n.msg||Em[n.err];return n.result}SA.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize,a=this.options.dictionary;let l,f,m;if(this.ended)return!1;for(f=t===~~t?t:t===!0?v7:T7,Tj.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),l=Eu.inflate(n,f),l===PD&&a&&(l=Eu.inflateSetDictionary(n,a),l===Ky?l=Eu.inflate(n,f):l===vj&&(l=PD));n.avail_in>0&&l===xD&&n.state.wrap>0&&e[n.next_in]!==0;)Eu.inflateReset(n),l=Eu.inflate(n,f);switch(l){case b7:case vj:case PD:case R7:return this.onEnd(l),this.ended=!0,!1}if(m=n.avail_out,n.next_out&&(n.avail_out===0||l===xD))if(this.options.to==="string"){let _=Gy.utf8border(n.output,n.next_out),S=n.next_out-_,b=Gy.buf2string(n.output,_);n.next_out=S,n.avail_out=s-S,S&&n.output.set(n.output.subarray(_,_+S),0),this.onData(b)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(l!==Ky||m!==0){if(l===xD)return l=Eu.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},SA.prototype.onData=function(e){this.chunks.push(e)},SA.prototype.onEnd=function(e){e===Ky&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=lA.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var C7={inflate:A7};const{deflate:I7}=o7,{inflate:w7}=C7;var O7=I7,D7=w7,bj=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(bj||{});class N7{constructor(){W(this,"_sequence",0),W(this,"_startTime",Date.now()),W(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},S={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};n.commonPacketHeader.extension=1,n.extension=S,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;Z("SHOW_DATASTREAM2_LOG")&&k.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const s=new ArrayBuffer(n.commonPacketHeader.length),a=new Uint8Array(s),l=new DataView(s);let f=0;if(l.setUint16(f,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),f+=2,l.setUint32(f,n.commonPacketHeader.sequence,!0),f+=4,l.setUint16(f,n.commonStreamHeader,!0),f+=2,n.extension){const m=this.serializeExtension(n.extension);a.set(new Uint8Array(m),f),f+=m.byteLength}if(a.set(new Uint8Array(n.payload),f),f+=n.payload.byteLength,f!==n.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let s=0;const a=n.getUint16(s,!0);s+=2;const l={length:16383&a,reserved:(16384&a)>>14,extension:(32768&a)>>15,sequence:n.getUint16(s+2,!0)<<16|n.getUint16(s,!0)};let f,m;if(s+=4,Z("SHOW_DATASTREAM2_LOG")&&k.debug("receive data header: ".concat(JSON.stringify(l))),n.getUint16(s,!0),s+=2,l.extension){m=this.deserializeExtension(t.slice(s)),s+=2+m.length,f=t.slice(s);let _=!1;if(m.datas.length>0){const S=m.datas.find(b=>b.id===0);S&&(_=(1&new DataView(S.data).getUint32(0,!0))==1)}f=_?this.decompress(f):f}else f=t.slice(8);return f}serializeExtension(t){const{profile:n,length:s,datas:a}=t,l=new ArrayBuffer(s+2),f=new Uint8Array(l),m=new DataView(l);let _=0;if(m.setUint8(_++,n),m.setUint8(_++,s),a.forEach(S=>{n?(m.setUint8(_++,S.id),m.setUint8(_++,S.length),f.set(new Uint8Array(S.data),_),_+=S.data.byteLength):(m.setUint8(_++,S.id|S.length<<4),f.set(new Uint8Array(S.data),_),_+=S.data.byteLength)}),_!==s+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(s+2));return l}deserializeExtension(t){const n=new DataView(t);let s=0;const a=n.getUint8(s);s++;const l=n.getUint8(s);s++;const f=a===bj.TWO_BYTE,m=[],_=new DataView(t,2);let S=0;for(;S<l;){let b=0,A=0,O=new ArrayBuffer(0);f?(b=_.getUint8(S),S++,A=_.getUint8(S),S++):(b=15&_.getUint8(S),A=_.getUint8(S)>>4,S++),A>0&&(O=_.buffer.slice(S+2,S+2+A),S+=O.byteLength),m.push({id:b,length:A,data:O})}if(S!==l)throw Error("parse error");return{profile:a,length:l,datas:m}}decompress(t){return D7(new Uint8Array(t))}compress(t){return O7(new Uint8Array(t))}}const L7={name:"DataStream",create:(e,t)=>{const n=t?new Bq(e):new Vq(e);return n.useDataStream(new N7),n}};class x7 extends ii{constructor(t,n,s){super(),W(this,"ws",void 0),W(this,"requestId",1),W(this,"heartBeatTimer",void 0),W(this,"joinInfo",void 0),W(this,"clientId",void 0),W(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),W(this,"onClose",a=>{this.emit("close"),this.dispose()}),W(this,"onMessage",a=>{const l=JSON.parse(a.data);if(!l||l.command!=="serverResponse"||!l.requestId)return l&&l.command==="serverStatus"&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=t,this.clientId=n,this.ws=new gy("cross-channel-".concat(this.clientId),s),this.ws.on(kt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(kt.CONNECTED,this.onOpen),this.ws.on(kt.ON_MESSAGE,this.onMessage),this.ws.on(kt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new Ye((n,s)=>{const a=window.setTimeout(()=>{s(new Ee($.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,l=>{window.clearTimeout(a),l.state&&l.state!==0?s(new Ee($.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(a),s(new Ee($.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new Ee($.WS_DISCONNECT);const n=()=>new Ye((f,m)=>{this.ws.once(kt.CLOSED,()=>m(new Ee($.WS_ABORT))),this.ws.once(kt.CONNECTED,f)});this.ws.state!=="connected"&&await n();const s=this.sendMessage(t),a=new Ye((f,m)=>{const _=()=>{m(new Ee($.WS_ABORT))};this.ws.once(kt.RECONNECTING,_),this.ws.once(kt.CLOSED,_),this.once("req_".concat(s),f),gs(3e3).then(()=>{this.removeAllListeners("req_".concat(s)),this.ws.off(kt.RECONNECTING,_),this.ws.off(kt.CLOSED,_),m(new Ee($.TIMEOUT,"cross channel ws request timeout"))})}),l=await a;if(!l||l.code!==200)throw new Ee($.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(l)));return l}async connect(t){this.ws.removeAllListeners(kt.REQUEST_NEW_URLS),this.ws.on(kt.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class P7 extends ii{set state(t){t!==this._state&&(t!==qr.RELAY_STATE_FAILURE&&(this.errorCode=e_.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,s,a,l){super(),W(this,"joinInfo",void 0),W(this,"sid",void 0),W(this,"clientId",void 0),W(this,"cancelToken",Lr.CancelToken.source()),W(this,"workerToken",void 0),W(this,"requestId",0),W(this,"signal",void 0),W(this,"prevChannelMediaConfig",void 0),W(this,"httpRetryConfig",void 0),W(this,"_resolution",void 0),W(this,"_state",qr.RELAY_STATE_IDLE),W(this,"errorCode",e_.RELAY_OK),W(this,"onStatus",f=>{k.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(f))),f&&f.command&&(f.command==="onAudioPacketReceived"&&this.emit("event",du.PACKET_RECEIVED_AUDIO_FROM_SRC),f.command==="onVideoPacketReceived"&&this.emit("event",du.PACKET_RECEIVED_VIDEO_FROM_SRC),f.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=e_.SRC_TOKEN_EXPIRED,this.state=qr.RELAY_STATE_FAILURE),f.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=e_.DEST_TOKEN_EXPIRED,this.state=qr.RELAY_STATE_FAILURE))}),W(this,"onReconnect",async()=>{k.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",du.NETWORK_DISCONNECTED),this.state=qr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(f=>{this.state!==qr.RELAY_STATE_IDLE&&(k.error("auto restart channel media relay failed",f.toString()),this.errorCode=e_.SERVER_CONNECTION_LOST,this.state=qr.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=em(),this.signal=new x7(this.joinInfo,this.clientId,s),this.httpRetryConfig=a,this._resolution=l}async startChannelMediaRelay(t){if(this.state!==qr.RELAY_STATE_IDLE)throw new Ee($.INVALID_OPERATION);this.state=qr.RELAY_STATE_CONNECTING,await this.connect(),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new Ee($.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new Ee($.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new Ee($.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==qr.RELAY_STATE_RUNNING)throw new Ee($.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==qr.RELAY_STATE_RUNNING)throw new Ee($.INVALID_OPERATION);const n=this.genMessage(vr.SetVideoProfile);await this.signal.request(n),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),k.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=qr.RELAY_STATE_IDLE,this.dispose()}dispose(){k.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Lr.CancelToken.source(),this.state=qr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await K$(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",du.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(vr.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const s=this.genMessage(vr.SetSdkProfile,t);await this.signal.request(s),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const a=this.genMessage(vr.SetSourceChannel,t);await this.signal.request(a),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",du.PACKET_JOINED_SRC_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const l=this.genMessage(vr.SetSourceUserId,t);await this.signal.request(l),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const f=this.genMessage(vr.SetDestChannel,t);await this.signal.request(f),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",du.PACKET_JOINED_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(vr.StartPacketTransfer,t);await this.signal.request(m),this.emit("event",du.PACKET_SENT_TO_DEST_CHANNEL),this.state=qr.RELAY_STATE_RUNNING,k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(vr.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",du.PACKET_UPDATE_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(vr.StopPacketTransfer);await this.signal.request(t),k.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const s=[],a=[],l=[];this.requestId+=1;const f={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:ao,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};f.sdkVersion==="4.23.2"&&(f.sdkVersion="0.0.1");let m=null,_=null;switch(t){case vr.SetSdkProfile:return f.clientRequest={command:"SetSdkProfile",type:"multi_channel"},f;case vr.SetSourceChannel:if(_=n&&n.getSrcChannelMediaInfo(),!_)throw new Ee($.UNEXPECTED_ERROR,"can not find source config");return f.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},f;case vr.SetSourceUserId:if(_=n&&n.getSrcChannelMediaInfo(),!_)throw new Ee($.UNEXPECTED_ERROR,"can not find source config");return f.clientRequest={command:"SetSourceUserId",uid:_.uid+""},f;case vr.SetDestChannel:if(m=n&&n.getDestChannelMediaInfo(),!m)throw new Ee($.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(S=>{s.push(S.channelName),a.push(S.uid+""),l.push(S.token||this.joinInfo.appId)}),f.clientRequest={command:"SetDestChannel",channelName:s,uid:a,token:l},f;case vr.StartPacketTransfer:return f.clientRequest={command:"StartPacketTransfer"},f;case vr.Reconnect:return f.clientRequest={command:"Reconnect"},f;case vr.StopPacketTransfer:return f.clientRequest={command:"StopPacketTransfer"},f;case vr.UpdateDestChannel:if(m=n&&n.getDestChannelMediaInfo(),!m)throw new Ee($.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(S=>{s.push(S.channelName),a.push(S.uid+""),l.push(S.token||this.joinInfo.appId)}),f.clientRequest={command:"UpdateDestChannel",channelName:s,uid:a,token:l},f;case vr.SetVideoProfile:f.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return f}}const k7={name:"ChannelMediaRelay",create:function(e){return new P7(e.joinInfo,e.clientId,e.websocketRetryConfig||Bi,e.httpRetryConfig||Bi,e.resolution)}};function Rj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Wy(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Rj(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}class M7 extends ii{constructor(t,n,s,a){super(),W(this,"spec",void 0),W(this,"token",void 0),W(this,"websocket",void 0),W(this,"pingpongTimer",void 0),W(this,"reconnectMode","retry"),W(this,"serviceMode",void 0),W(this,"reqId",0),W(this,"commandReqId",0),W(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),W(this,"handleWebSocketMessage",l=>{if(!l.data)return;const f=JSON.parse(l.data);f.requestId?this.emit("@".concat(f.requestId,"-").concat(f.sid),f):(gt.workerEvent(this.spec.sid,{actionType:"status",serverCode:f.code,workerType:this.serviceMode===lu.TRANSCODE?1:2}),this.emit(Vh.PUBLISH_STREAM_STATUS,f))}),this.spec=n,this.token=t,this.serviceMode=a,this.websocket=new gy("live-streaming",s),this.websocket.on(kt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(kt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(kt.REQUEST_NEW_URLS,(l,f)=>{ws(this,Vh.REQUEST_NEW_ADDRESS).then(l).catch(f)}),this.websocket.on(kt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,s,a){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const l=this.commandReqId,f=this.reqId;if(!f||!this.websocket)throw new Ee($.UNEXPECTED_ERROR);const m=Wy({command:t,sdkVersion:ao==="4.23.2"?"0.0.1":ao,seq:f,requestId:f,allocate:s,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new Ee($.WS_DISCONNECT);const _=()=>new Ye((O,D)=>{this.websocket.once(kt.CLOSED,()=>D(new Ee($.WS_ABORT))),this.websocket.once(kt.CONNECTED,O)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const S=new Ye((O,D)=>{const G=()=>{D(new Ee($.WS_ABORT))};this.websocket.once(kt.RECONNECTING,G),this.websocket.once(kt.CLOSED,G),this.once("@".concat(f,"-").concat(this.spec.sid),B=>{O(B)})});a&&gt.workerEvent(this.spec.sid,Wy(Wy({},a),{},{requestId:l,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const b=Date.now();this.websocket.sendMessage(m);let A=null;try{A=await S}catch(O){if(this.websocket.state==="closed")throw O;return await _(),await this.request(t,n,s)}return a&&gt.workerEvent(this.spec.sid,Wy(Wy({},a),{},{requestId:l,actionType:"response",payload:JSON.stringify(A.serverResponse),serverCode:A.code,success:A.code===200,responseTime:Date.now()-b})),A.code!==200&&this.handleResponseError(A),A}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=ao==="4.23.2"?"0.0.1":ao;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Ki.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void k.warning("live stream response already exists stream");case Ki.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ki.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ki.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Ee($.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Ki.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new Ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ki.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Ee($.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Ki.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new Ee($.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Vh.WARNING,n,t.serverResponse.url)}case Ki.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new Ee($.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Vh.WARNING,n,t.serverResponse.url)}case Ki.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ki.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Ee($.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Ki.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new Ee($.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Vh.WARNING,n,t.serverResponse.url)}case Ki.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Ki.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ki.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ki.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new Ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ki.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new Ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new Ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ki.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Ee($.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(aR)},6e3)}}function Aj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function $r(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Aj(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Aj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}class U7 extends ii{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Bi,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Bi;super(),W(this,"onLiveStreamWarning",void 0),W(this,"onLiveStreamError",void 0),W(this,"spec",void 0),W(this,"retryTimeout",1e4),W(this,"connection",void 0),W(this,"httpRetryConfig",void 0),W(this,"wsRetryConfig",void 0),W(this,"streamingTasks",new Map),W(this,"isStartingStreamingTask",!1),W(this,"taskMutex",new Ps("live-streaming")),W(this,"cancelToken",Lr.CancelToken.source()),W(this,"transcodingConfig",void 0),W(this,"uapResponse",void 0),W(this,"lastTaskId",1),W(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=s,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=$r($r({},b$),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(k.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(f=>$r($r($r({},v$),f),{},{zOrder:f.zOrder?f.zOrder+1:1}))),function(f){ci(f.width)||An(f.width,"config.width",0,1e4),ci(f.height)||An(f.height,"config.height",0,1e4),ci(f.videoBitrate)||An(f.videoBitrate,"config.videoBitrate",1,1e6),ci(f.videoFrameRate)||An(f.videoFrameRate,"config.videoFrameRate"),ci(f.lowLatency)||ru(f.lowLatency,"config.lowLatency"),ci(f.audioSampleRate)||zi(f.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),ci(f.audioBitrate)||An(f.audioBitrate,"config.audioBitrate",1,128),ci(f.audioChannels)||zi(f.audioChannels,"config.audioChannels",[1,2,3,4,5]),ci(f.videoGop)||An(f.videoGop,"config.videoGop"),ci(f.videoCodecProfile)||zi(f.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),ci(f.userCount)||An(f.userCount,"config.userCount",0,17),ci(f.backgroundColor)||An(f.backgroundColor,"config.backgroundColor",0,16777215),ci(f.userConfigExtraInfo)||ms(f.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),f.transcodingUsers&&!ci(f.transcodingUsers)&&(au(f.transcodingUsers,"config.transcodingUsers"),f.transcodingUsers.forEach((m,_)=>{DR(m.uid),ci(m.x)||An(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),ci(m.y)||An(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),ci(m.width)||An(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),ci(m.height)||An(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),ci(m.zOrder)||An(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),ci(m.alpha)||An(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),ci(f.watermark)||MO(f.watermark,"watermark"),ci(f.backgroundImage)||MO(f.backgroundImage,"backgroundImage"),f.images&&!ci(f.images)&&(au(f.images,"config.images"),f.images.forEach((m,_)=>{MO(m,"images[".concat(_,"]"))}))}(n);const s=[];n.images&&s.push(...n.images.map(f=>$r($r($r({},kO),f),{},{zOrder:255}))),n.backgroundImage&&(s.push($r($r($r({},kO),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(s.push($r($r($r({},kO),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=s,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(f=>$r({},f)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const a=(n.userConfigs||[]).map(f=>typeof f.uid=="number"?Ye.resolve(f.uid):qF(f.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Ye.all(a)).forEach((f,m)=>{n.userConfigs&&n.userConfigs[m]&&(n.userConfigs[m].uid=f)}),this.transcodingConfig=n,this.connection)try{var l;const f=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(ps(l=this.streamingTasks).call(l)).map(m=>m.taskId).join("#")});k.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(f.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(f){if(!f.data||!f.data.retry)throw f;f.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{k.warning("[".concat(this.spec.clientId,"] live streaming receive error"),f.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,f).then(()=>{k.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{k.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(t,n,s){if(!this.transcodingConfig&&n===lu.TRANSCODE)throw new Ee($.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const a={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};k.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const l=await this.taskMutex.lock();if(!this.connection&&s)return void l();if(this.streamingTasks.get(t)&&!s)return l(),new Ee($.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(m){throw l(),m}switch(n){case lu.TRANSCODE:a.transcodingConfig=$r({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(a.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const f=this.lastTaskId++;try{const m=new Ye((S,b)=>{gs(this.retryTimeout).then(()=>{if(s)return b(s);const A=this.statusError.get(t);return A?(this.statusError.delete(t),b(A)):void 0})}),_=await Ye.race([this.connection.request("request",{clientRequest:a},!0,{url:t,command:"PublishStream",workerType:n===lu.TRANSCODE?1:2,requestByUser:!s,tid:f.toString()}),m]);this.isStartingStreamingTask=!1,k.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(t,{clientRequest:a,mode:n,url:t,taskId:f}),l()}catch(m){if(l(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||s)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,m)):await this.startLiveStreamingTask(t,n,m)}}stopLiveStreamingTask(t){return new Ye((n,s)=>{const a=this.streamingTasks.get(t);if(!a||!this.connection)return new Ee($.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const l=a.mode;a.abortTask=()=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:a.url}},!1,{url:t,command:"UnPublishStream",workerType:l===lu.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(f=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(f.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(s)})}resetAllTask(){var t;const n=Array.from(ps(t=this.streamingTasks).call(t));this.terminate();for(const s of n)this.startLiveStreamingTask(s.url,s.mode).catch(a=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,a)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Lr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new Ee($.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await ws(this,UO.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new M7(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Vh.WARNING,(s,a)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(a,s)),this.connection.on(Vh.PUBLISH_STREAM_STATUS,s=>this.handlePublishStreamServer(s)),this.connection.on(Vh.REQUEST_NEW_ADDRESS,(s,a)=>{if(!this.connection)return a(new Ee($.UNEXPECTED_ERROR,"can not get new live streaming address list"));ws(this,UO.REQUEST_WORKER_MANAGER_LIST,t).then(l=>{this.uapResponse=l,s(l.addressList)}).catch(a)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",s=this.streamingTasks.get(n),a=t.reason;switch(t.code){case Ki.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const f=new Ee($.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(s)return k.error(f.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,f);if(!this.isStartingStreamingTask)return;this.statusError.set(n,f)}case Ki.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const f=new Ee($.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,a);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,f)}case Ki.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ki.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();const f=Array.from(ps(l=this.streamingTasks).call(l));for(const m of f)m.abortTask?m.abortTask():(k.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Ee($.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{k.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{k.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const F7={name:"LiveStreaming",create:function(e){return new U7(e.joinInfo,e.websocketRetryConfig||Bi,e.httpRetryConfig||Bi)}};function B7(e){let t=wj();return function(n,s){let a=n.appId;a!==void 0&&(Sn(s,10),ad(s,a));let l=n.cid;l!==void 0&&(Sn(s,16),Sn(s,l));let f=n.cname;f!==void 0&&(Sn(s,26),ad(s,f));let m=n.deviceId;m!==void 0&&(Sn(s,34),ad(s,m));let _=n.elapse;_!==void 0&&(Sn(s,40),ef(s,_));let S=n.fileSize;S!==void 0&&(Sn(s,48),ef(s,E_(S)));let b=n.height;b!==void 0&&(Sn(s,56),ef(s,E_(b)));let A=n.jpg;A!==void 0&&(Sn(s,66),Sn(s,A.length),function(Fr,Ie){let je=__(Fr,Ie.length);Fr.bytes.set(Ie,je)}(s,A));let O=n.networkType;O!==void 0&&(Sn(s,72),ef(s,E_(O)));let D=n.osType;D!==void 0&&(Sn(s,80),ef(s,E_(D)));let G=n.requestId;G!==void 0&&(Sn(s,90),ad(s,G));let B=n.sdkVersion;B!==void 0&&(Sn(s,98),ad(s,B));let j=n.sequence;j!==void 0&&(Sn(s,104),ef(s,E_(j)));let Y=n.sid;Y!==void 0&&(Sn(s,114),ad(s,Y));let q=n.timestamp;q!==void 0&&(Sn(s,120),ef(s,q));let ie=n.uid;ie!==void 0&&(Sn(s,128),Sn(s,ie));let le=n.vid;le!==void 0&&(Sn(s,136),Sn(s,le));let ue=n.width;ue!==void 0&&(Sn(s,144),ef(s,E_(ue)));let oe=n.service;oe!==void 0&&(Sn(s,152),Sn(s,oe));let ye=n.callbackData;ye!==void 0&&(Sn(s,162),ad(s,ye));let Pe=n.jpgEncryption;Pe!==void 0&&(Sn(s,168),Sn(s,Pe));let ze=n.requestType;ze!==void 0&&(Sn(s,176),Sn(s,ze));let nt=n.scorePorn;nt!==void 0&&(Sn(s,185),BD(s,nt));let $t=n.scoreSexy;$t!==void 0&&(Sn(s,193),BD(s,$t));let zt=n.scoreNeutral;zt!==void 0&&(Sn(s,201),BD(s,zt));let Mn=n.scene;Mn!==void 0&&(Sn(s,208),Sn(s,Mn));let Ai=n.ossFilePrefix;Ai!==void 0&&(Sn(s,218),ad(s,Ai));let pi=n.serviceVendor;if(pi!==void 0)for(let Fr of pi){Sn(s,226);let Ie=wj();G7(Fr,Ie),Sn(s,Ie.limit),Y7(s,Ie),W7(Ie)}}(e,t),function(n){let s=n.bytes,a=n.limit;return s.length===a?s:s.subarray(0,a)}(t)}function V7(e){return function(n){let s={};e:for(;!Oj(n);){let a=od(n);switch(a>>>3){case 0:break e;case 1:s.code=od(n);break;case 2:s.msg=Dj(n,od(n));break;case 3:{let l=H7(n);s.data=j7(n),n.limit=l;break}default:Cj(n,7&a)}}return s}({bytes:t=e,offset:0,limit:t.length});var t}function j7(e){let t={};e:for(;!Oj(e);){let n=od(e);switch(n>>>3){case 0:break e;case 1:t.requestId=Dj(e,od(e));break;case 2:t.requestType=od(e)>>>0;break;case 3:t.scorePorn=FD(e);break;case 4:t.scoreSexy=FD(e);break;case 5:t.scoreNeutral=FD(e);break;case 6:t.requestScene=od(e)>>>0;break;case 7:t.scene=od(e)>>>0;break;default:Cj(e,7&n)}}return t}function G7(e,t){let n=e.service;n!==void 0&&(Sn(t,8),Sn(t,n));let s=e.vendor;s!==void 0&&(Sn(t,16),Sn(t,s));let a=e.token;a!==void 0&&(Sn(t,26),ad(t,a));let l=e.callbackUrl;l!==void 0&&(Sn(t,34),ad(t,l))}function H7(e){let t=od(e),n=e.limit;return e.limit=e.offset+t,n}function Cj(e,t){switch(t){case 0:for(;128&Nj(e););break;case 2:MD(e,od(e));break;case 5:MD(e,4);break;case 1:MD(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let K7=new Float32Array(1);new Uint8Array(K7.buffer);let kD=new Float64Array(1),zr=new Uint8Array(kD.buffer);function E_(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Ij=[];function wj(){const e=Ij.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function W7(e){Ij.push(e)}function MD(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Oj(e){return e.offset>=e.limit}function __(e,t){let n=e.bytes,s=e.offset,a=e.limit,l=s+t;if(l>n.length){let f=new Uint8Array(2*l);f.set(n),e.bytes=f}return e.offset=l,l>a&&(e.limit=l),s}function UD(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function Dj(e,t){let n=UD(e,t),s=String.fromCharCode,a=e.bytes,l="",f="";for(let m=0;m<t;m++){let _,S,b,A,O=a[m+n];(128&O)==0?f+=s(O):(224&O)==192?m+1>=t?f+=l:(_=a[m+n+1],(192&_)!=128?f+=l:(A=(31&O)<<6|63&_,A<128?f+=l:(f+=s(A),m++))):(240&O)==224?m+2>=t?f+=l:(_=a[m+n+1],S=a[m+n+2],(49344&(_|S<<8))!=32896?f+=l:(A=(15&O)<<12|(63&_)<<6|63&S,A<2048||A>=55296&&A<=57343?f+=l:(f+=s(A),m+=2))):(248&O)==240?m+3>=t?f+=l:(_=a[m+n+1],S=a[m+n+2],b=a[m+n+3],(12632256&(_|S<<8|b<<16))!=8421504?f+=l:(A=(7&O)<<18|(63&_)<<12|(63&S)<<6|63&b,A<65536||A>1114111?f+=l:(A-=65536,f+=s(55296+(A>>10),56320+(1023&A)),m+=3))):f+=l}return f}function ad(e,t){let n=t.length,s=0;for(let f=0;f<n;f++){let m=t.charCodeAt(f);m>=55296&&m<=56319&&f+1<n&&(m=(m<<10)+t.charCodeAt(++f)-56613888),s+=m<128?1:m<2048?2:m<65536?3:4}Sn(e,s);let a=__(e,s),l=e.bytes;for(let f=0;f<n;f++){let m=t.charCodeAt(f);m>=55296&&m<=56319&&f+1<n&&(m=(m<<10)+t.charCodeAt(++f)-56613888),m<128?l[a++]=m:(m<2048?l[a++]=m>>6&31|192:(m<65536?l[a++]=m>>12&15|224:(l[a++]=m>>18&7|240,l[a++]=m>>12&63|128),l[a++]=m>>6&63|128),l[a++]=63&m|128)}}function Y7(e,t){let n=__(e,t.limit),s=e.bytes,a=t.bytes;for(let l=0,f=t.limit;l<f;l++)s[l+n]=a[l]}function Nj(e){return e.bytes[UD(e,1)]}function Lj(e,t){let n=__(e,1);e.bytes[n]=t}function FD(e){let t=UD(e,8),n=e.bytes;return zr[0]=n[t++],zr[1]=n[t++],zr[2]=n[t++],zr[3]=n[t++],zr[4]=n[t++],zr[5]=n[t++],zr[6]=n[t++],zr[7]=n[t++],kD[0]}function BD(e,t){let n=__(e,8),s=e.bytes;kD[0]=t,s[n++]=zr[0],s[n++]=zr[1],s[n++]=zr[2],s[n++]=zr[3],s[n++]=zr[4],s[n++]=zr[5],s[n++]=zr[6],s[n++]=zr[7]}function od(e){let t,n=0,s=0;do t=Nj(e),n<32&&(s|=(127&t)<<n),n+=7;while(128&t);return s}function Sn(e,t){for(t>>>=0;t>=128;)Lj(e,127&t|128),t>>>=7;Lj(e,t)}function ef(e,t){let n=t.low>>>0,s=(t.low>>>28|t.high<<4)>>>0,a=t.high>>>24,l=a===0?s===0?n<16384?n<128?1:2:n<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:a<128?9:10,f=__(e,l),m=e.bytes;switch(l){case 10:m[f+9]=a>>>7&1;case 9:m[f+8]=l!==9?128|a:127&a;case 8:m[f+7]=l!==8?s>>>21|128:s>>>21&127;case 7:m[f+6]=l!==7?s>>>14|128:s>>>14&127;case 6:m[f+5]=l!==6?s>>>7|128:s>>>7&127;case 5:m[f+4]=l!==5?128|s:127&s;case 4:m[f+3]=l!==4?n>>>21|128:n>>>21&127;case 3:m[f+2]=l!==3?n>>>14|128:n>>>14&127;case 2:m[f+1]=l!==2?n>>>7|128:n>>>7&127;case 1:m[f]=l!==1?128|n:127&n}}function xj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}const q7=new Map([["moderation",1],["supervise",2]]);class $7 extends ii{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(cs.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=jr(n=t.map(s=>q7.get(s)||0)).call(n,(s,a)=>s+a),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),W(this,"name","AgoraRTCVideoContentInspect"),W(this,"_connectionState",ec.CONNECTING),W(this,"_innerConnectionState",void 0),W(this,"sequence",0),W(this,"inspectStartTime",void 0),W(this,"workerManagerConnection",void 0),W(this,"workerConnection",void 0),W(this,"workerMessageLengthLimit",void 0),W(this,"inspectIntervalMinimum",void 0),W(this,"qualityRatio",void 0),W(this,"_connectInfo",void 0),W(this,"_cancelTokenSource",Lr.CancelToken.source()),W(this,"_retryConfig",void 0),W(this,"wmSequence",0),W(this,"inspectInterval",void 0),W(this,"inspectTimer",null),W(this,"ossFilePrefix",void 0),W(this,"extraInfo",void 0),W(this,"_inspectType",void 0),W(this,"_inspectMode",void 0),W(this,"_quality",1),W(this,"qualityTimer",null),W(this,"_inspectId",void 0),W(this,"_needWorkUrlOnly",!1),W(this,"inspectImage",()=>{if(this.connectionState!==ec.CONNECTED)throw new Ee($.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===ec.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Pn(5,"inspect-"),this.workerMessageLengthLimit=Z("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Z("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Z("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new gy("worker-manager-"+this._inspectId,Bi),this.on(cs.STATE_CHANGE,(n,s)=>{this._innerConnectionState=n,k.debug("[".concat(this._inspectId,"] Inspect operation :").concat(tc[n]," ").concat(s||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new gy("worker-"+this._inspectId,Bi),this.handleWorkerEvents()}async init(t,n){this.emit(cs.STATE_CHANGE,tc.CONNECT_AP),this._connectInfo=t;const s=this._cancelTokenSource.token;return this._retryConfig=n,new Ye((a,l)=>{this.on(cs.CONNECTION_STATE_CHANGE,(f,m)=>{m===ec.CONNECTED&&a()}),this.requestAP(t,s,n).then(f=>{this.connectWorkerManager(f)}).catch(f=>{l(f)})})}async requestAP(t,n,s){const a=Z("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),l=await function(m,_,S,b){let{appId:A,areaCode:O,cname:D,sid:G,token:B,uid:j}=_;o_++;const Y="image_moderation_api",q={service_name:Y,json_body:JSON.stringify({appId:A,areaCode:O,cname:D,command:"allocateEdge",requestId:o_,seq:o_,sid:G,token:B,ts:Date.now(),uid:j+""})};let ie,le,ue=m[0];return $c(async()=>{ie=Date.now();const oe=await Zc(ue,{data:q,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(le=Date.now()-ie,oe.code!==0){const nt=new Ee($.UNEXPECTED_RESPONSE,"image inspect ap error, code"+oe.code,{retry:!0,responseTime:le});throw k.error(nt.toString()),nt}const ye=JSON.parse(oe.json_body);if(ye.code!==200){const nt=new Ee($.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ye.code,", reason: ").concat(ye.reason),{code:ye.code,responseTime:le});throw k.error(nt.toString()),nt}if(!ye.servers||!Array.isArray(ye.servers)||ye.servers.length===0){const nt=new Ee($.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ye.code,responseTime:le});throw k.error(nt.toString()),nt}const Pe=Z("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ze=Z("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ye.servers.map(nt=>{let{address:$t,wss:zt}=nt;if($t&&zt)return"wss://".concat($t.replace(/\./g,"-"),".").concat(Pe,":").concat(ze||zt)}).filter(nt=>!!nt),workerToken:ye.workerToken,vid:ye.vid,responseTime:le}},(oe,ye)=>(gt.apworkerEvent(G,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(oe.addressList),firstSuccess:ye===0,responseTime:le,serverIp:m[ye%m.length]}),!1),(oe,ye)=>(gt.apworkerEvent(G,{success:!1,sc:oe.data&&oe.data.code||200,serviceName:Y,responseTime:le,serverIp:m[ye%m.length]}),!!(oe.code!==$.OPERATION_ABORTED&&oe.code!==$.UNEXPECTED_RESPONSE||oe.data&&oe.data.retry)&&(ue=m[(ye+1)%m.length],!0)),b)}(a,t,n,s);this.emit(cs.STATE_CHANGE,tc.AP_CONNECTED);const{addressList:f}=l;return this.wmSequence++,f}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(cs.STATE_CHANGE,tc.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(kt.CONNECTED,async()=>{this.emit(cs.STATE_CHANGE,tc.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(kt.CLOSED,()=>{this._innerConnectionState<tc.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(kt.FAILED,()=>{this._innerConnectionState<tc.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(kt.RECONNECTING,()=>{this._innerConnectionState<tc.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(kt.ON_MESSAGE,async t=>{this.emit(cs.STATE_CHANGE,tc.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const s=JSON.parse(t.data);if(s.code!==200)throw k.error("[".concat(this._inspectId,"] Unexpected code ").concat(s.code," from worker manager")),new Ee($.UNEXPECTED_RESPONSE,"response code of worker is unexpected",s);if(!(s.serverResponse&&s.serverResponse.portWss&&n))throw k.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(s))),new Ee($.UNEXPECTED_RESPONSE,"response content of worker is unexpected",s);{const a=Z("VIDEO_INSPECT_WORKER_PORT")||s.serverResponse.portWss,l=n.replace(/:\d+\/?$/,":".concat(a));this.emit(cs.STATE_CHANGE,tc.CONNECT_WORKER,l),this._needWorkUrlOnly?this.emit(cs.REQUEST_NEW_WORKER_URL,l):await this.connectWorker(l)}}),this.workerManagerConnection.on(kt.WILL_RECONNECT,(t,n,s)=>{s(t)}),this.workerManagerConnection.on(kt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(kt.CONNECTED,async()=>{this.emit(cs.STATE_CHANGE,tc.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=ec.CONNECTED}),this.workerConnection.on(kt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const s=V7(new Uint8Array(t.data));if(Z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&k.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(s)),s.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(cs.INSPECT_RESULT,void 0,void 0);if(s.data&&s.data.scorePorn&&s.data.scoreSexy&&s.data.scoreNeutral){var n;const a={porn:s.data.scorePorn,sexy:s.data.scoreSexy,neutral:s.data.scoreNeutral},l=jr(n=Object.keys(a)).call(n,(m,_)=>a[m]>a[_]?m:_,"porn"),f=Object.keys(a).find(m=>m===l);this.emit(cs.INSPECT_RESULT,f)}else this.emit(cs.INSPECT_RESULT,void 0,new Ee($.UNEXPECTED_RESPONSE,s.code+"","There is an unexpected data on message"))}else this.emit(cs.INSPECT_RESULT,void 0,new Ee($.UNEXPECTED_RESPONSE,s.code+"",s.msg))}else k.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(cs.INSPECT_RESULT,void 0,new Ee($.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(kt.CLOSED,()=>{this.connectionState=ec.CLOSED}),this.workerConnection.on(kt.FAILED,()=>{this.connectionState=ec.CLOSED}),this.workerConnection.on(kt.RECONNECTING,()=>{this.connectionState=this.connectionState===ec.CONNECTED?ec.RECONNECTING:ec.CONNECTING}),this.workerConnection.on(kt.WILL_RECONNECT,(t,n,s)=>{t==="recover"&&s(t),s("tryNext")}),this.workerConnection.on(kt.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(cs.REQUEST_NEW_WORKER_URL,s=>{t([s])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(s=>{this.connectWorkerManager(s,!0)}).catch(s=>{n(s)})})}async requestToInspectImage(){this.sequence++;const t=La(this,cs.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(cs.INSPECT_RESULT,void 0,new Ee($.INVALID_OPERATION,"Only the track being played can be inspected"));const s=await this.generateRequestData(t,n);this.workerConnection.sendMessage(s,!0,!0)}else this.emit(cs.INSPECT_RESULT,void 0,new Ee($.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:s,cname:a,cid:l,vid:f,sid:m,uid:_}=n;const S=Date.now(),b=await t.getCurrentFrameImage("image/jpeg",this.quality),A=await p2(b,s,a),O=this.sequence+"-"+l+"-"+_+"-"+S+"-"+Pn(12,""),D={appId:s,cid:l,cname:a,deviceId:"",elapse:(G=Number(S-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:A.byteLength,jpgEncryption:2,height:b.height,width:b.width,jpg:A,networkType:6,osType:7,requestId:O,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:jB(S),uid:_,vid:f,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete D.callbackData,this.ossFilePrefix===void 0&&delete D.ossFilePrefix;const B=B7(D);if(B.byteLength<this.workerMessageLengthLimit){if(Z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function(Y){for(var q=1;q<arguments.length;q++){var ie=arguments[q]!=null?arguments[q]:{};q%2?xj(Object(ie),!0).forEach(function(le){W(Y,le,ie[le])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors(ie)):xj(Object(ie)).forEach(function(le){Object.defineProperty(Y,le,Object.getOwnPropertyDescriptor(ie,le))})}return Y}({},D);delete j.jpg,k.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return B}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(t,{appId:s,cname:a,cid:l,vid:f,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Lr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=ec.CLOSED,this.emit(cs.STATE_CHANGE,tc.CLOSED)}}const z7={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new Ee($.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new Ee($.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const s=[...new Set(n.inspectType)];s.forEach(a=>{var l;if(!We(l=["supervise","moderation"]).call(l,a))throw new Ee($.INVALID_PARAMS,"".concat(a," is not a valid inspect type."))}),n.inspectType=s}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new Ee($.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new $7(t)}};var Pj=d(Ot.Object.getOwnPropertySymbols),X7=fn,J7=_c.indexOf,Q7=Xa,VD=he([].indexOf),kj=!!VD&&1/VD([1],1,-0)<0;X7({target:"Array",proto:!0,forced:kj||!Q7("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return kj?VD(this,e,t)||0:J7(this,e,t)}});var Z7=Bs("Array").indexOf,e9=L,t9=Z7,jD=Array.prototype,n9=function(e){var t=e.indexOf;return e===jD||e9(jD,e)&&t===jD.indexOf?t9:t},Mj=d(n9);function i9(e,t){if(e==null)return{};var n,s,a=function(f,m){if(f==null)return{};var _,S,b={},A=nF(f);for(S=0;S<A.length;S++)_=A[S],Mj(m).call(m,_)>=0||(b[_]=f[_]);return b}(e,t);if(Pj){var l=Pj(e);for(s=0;s<l.length;s++)n=l[s],Mj(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}let Uj=class{get localCapabilities(){return di(this._localCapabilities)}get rtpCapabilities(){return di(this._rtpCapabilities)}get candidates(){return di(this._candidates)}get iceParameters(){return di(this._iceParameters)}get dtlsParameters(){return di(this._dtlsParameters)}constructor(e){W(this,"sessionDesc",void 0),W(this,"_localCapabilities",void 0),W(this,"_rtpCapabilities",void 0),W(this,"_candidates",void 0),W(this,"_iceParameters",void 0),W(this,"_dtlsParameters",void 0),W(this,"setup",void 0),W(this,"currentMidIndex",void 0),W(this,"cname","o/i14u9pJrxRKAsu"),W(this,"firefoxSsrcMidMap",new Map),e=di(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:s,remoteRTPCapabilities:a,localCapabilities:l,direction:f,setup:m,videoCodec:_,audioCodec:S}=e;let b;this.setup=m,b=f===Tr.RECEIVE_ONLY?Yr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Yr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=a,this._candidates=s,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=l;const A=f===Tr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,O=f===Tr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,D=f===Tr.RECEIVE_ONLY?a.send.videoCodecs:Sy(at.VIDEO,A,O,_),G=f===Tr.RECEIVE_ONLY?a.send.audioCodecs:Sy(at.AUDIO,A,O,S);for(const B of b.mediaDescriptions)B.attributes.iceUfrag=t.iceUfrag,B.attributes.icePwd=t.icePwd,B.attributes.fingerprints=n.fingerprints,B.attributes.candidates=s,B.attributes.setup=this.setup,B.media.mediaType==="application"&&(B.attributes.sctpPort="5000"),B.media.mediaType==="video"&&(B.media.fmts=D.map(j=>j.payloadType.toString(10)),B.attributes.payloads=D,B.attributes.extmaps=A.videoExtensions),B.media.mediaType==="audio"&&(B.media.fmts=G.map(j=>j.payloadType.toString(10)),B.attributes.payloads=G,B.attributes.extmaps=A.audioExtensions,a_(B));this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return Bh(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,s,a){n=n.replace(/ /g,"-");const{ssrcs:l,ssrcGroups:f}=lm(t,this.cname,Z("SYNC_GROUP")?n:void 0),m=this.findPreloadMediaDesc(l);if(m){if(oi()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,m.attributes.mid),a&&(a.twcc||a.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,a),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,l,s);let S;return _===-1?(S=this.createOrRecycleSendMedia(e,l,f,"sendonly",s,a),this.updateBundleMids()):(S=di(this.sessionDesc.mediaDescriptions[_]),S.attributes.direction="sendonly",S.attributes.ssrcs=l,S.attributes.ssrcGroups=f,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(S,a)),oi()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,S.attributes.mid),{needExchangeSDP:!0,mid:S.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const s=[];return e.forEach(a=>{const l=a._mediaStreamTrack.kind,f=this.findAvailableRecvMediaIndex(l);let m,_=!1;f===-1?(_=!0,m=this.createOrRecycleRecvMedia(a,[],"recvonly",t,n),this.updateBundleMids()):(m=di(this.sessionDesc.mediaDescriptions[f]),m.attributes.direction="recvonly"),s.push({mid:m.attributes.mid,needCreateTransceiver:_})}),s}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:s,port:a,type:l,relatedAddress:f,relatedPort:m,priority:_}=new RTCIceCandidate(e),S={foundation:t??"",componentId:"1",transport:n??"",priority:_?_+"":"",connectionAddress:s??"",port:a?a+"":"",type:l?l+"":"",relAddr:f??"",relPort:m?m+"":"",extension:{}};this.candidates.some(b=>b.priority===S.priority&&b.connectionAddress===S.connectionAddress&&b.port===S.port)||(this._candidates.push(S),this.sessionDesc.mediaDescriptions.forEach(b=>{b.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,s,a){const l=e._mediaStreamTrack.kind,f=this.rtpCapabilities.recv,m=Sy(l,f,this.localCapabilities.send,l===at.AUDIO?a:s),_=l===at.VIDEO?f.videoExtensions:f.audioExtensions,S="".concat(++this.currentMidIndex);let b={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(O=>O.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(S)}};b=this.mungRecvMediaDsec(b,e);const A=this.findFirstClosedMedia(l);if(A){const O=this.sessionDesc.mediaDescriptions.indexOf(A);this.sessionDesc.mediaDescriptions[O]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>We(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>We(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const a=s.media.mediaType===e&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0;if(oi()){if(a){const l=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(l||s.attributes.mid!=="0"&&s.attributes.mid!=="1")||!(!l||l!==s.attributes.mid)}return!1}return a&&s.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=di(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,s,a,l){const f=this.rtpCapabilities.send,m=e===at.VIDEO?f.videoCodecs:f.audioCodecs,_=e===at.VIDEO?f.videoExtensions:f.audioExtensions;oi()&&(a="".concat(++this.currentMidIndex));let S={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:a}};S=this.mungSendMediaDesc(S,l);const b=this.findFirstClosedMedia(e);if(b){const A=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[A]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}mungRecvMediaDsec(e,t,n){const s=di(e);return GO(s),r_(s,t),HO(s,t),IF(s),UR(s,n,this.localCapabilities.send),s}mungSendMediaDesc(e,t){const n=di(e);return UR(n,t,this.localCapabilities.recv),a_(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===e);if(n!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=s}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>oi()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const s9=["sdp"];var Bn;function Fj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function tf(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Fj(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let Bj=(Bn=class R_ extends cF{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,s){super(t,n),W(this,"direction",void 0),W(this,"name",void 0),W(this,"store",void 0),W(this,"spec",void 0),W(this,"peerConnection",void 0),W(this,"initialOffer",void 0),W(this,"transport",void 0),W(this,"statsFilter",void 0),W(this,"localCandidateCount",0),W(this,"_isInRestartIce",!1),W(this,"mutex",void 0),W(this,"onLocalCandidate",void 0),W(this,"remoteSDP",void 0),W(this,"pendingCandidates",[]),W(this,"localCapabilities",void 0),W(this,"isReady",!1),W(this,"restartCnt",0),W(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new Ps("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(R_.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=s??Tr.SEND_ONLY,this.name=this.direction===Tr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=nO(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,oi()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await OF();if(this.localCapabilities=FR(n),t){const{sdp:s}=t,a=i9(t,s9),l=function(){const b={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},A=_y(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nc(A,b,"videoExtensions",O,D,G),nc(A,b,"videoCodecs",O,D,G),nc(A,b,"audioExtensions",O,D,G),nc(A,b,"audioCodecs",O,D,G),Z("RAISE_H264_BASELINE_PRIORITY")){const B=G.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(B!==-1){const j=G.videoCodecs.findIndex(Y=>Y.rtpMap&&Y.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<B){k.debug("raising H264 baseline profile priority");const Y=G.videoCodecs[B];G.videoCodecs.splice(B,1),G.videoCodecs.splice(j,0,Y)}j!==-1&&Z("FILTER_SEND_H264_BASELINE")&&(O.videoCodecs=O.videoCodecs.filter(Y=>!(Y.rtpMap&&Y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Y.fmtp&&Y.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:O,recv:D,sendrecv:G}}({},{},s);this.remoteSDP=new Uj({remoteIceParameters:a.iceParameters,remoteDtlsParameters:a.dtlsParameters,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const f=await this.peerConnection.createAnswer();if(!f.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Kh(f.sdp);await this.peerConnection.setLocalDescription(f);const _=await DF({},{},f.sdp);this.localCapabilities=FR(_);const S=this.peerConnection.getTransceivers()[0];return S!=null&&S.receiver&&S.receiver.transport&&this.tryBindTransportEvents(S.receiver.transport),tf(tf({},m),{},{sdp:f.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Kh(s.sdp);return this.initialOffer=s,tf(tf({},a),{},{sdp:s.sdp})}}catch(n){throw new ve($.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:s,dtlsParameters:a}=t,l=await DF({},{},n);this.remoteSDP=new Uj({remoteIceParameters:s,remoteDtlsParameters:a,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const f=this.peerConnection.getTransceivers()[0];f!=null&&f.sender&&f.sender.transport&&this.tryBindTransportEvents(f.sender.transport)}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new ve($.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,s){var a=this;return ro(function*(){const l=yield tn(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const f=[],m=a.remoteSDP.receive(t,n,s);t.forEach((j,Y)=>{if(m[Y].needCreateTransceiver){const q=a.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});f.push(q),j._updateRtpTransceiver(q)}else{const q=a.peerConnection.getTransceivers().find(ie=>ie.mid===m[Y].mid);if(!q)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[Y].mid));f.push(q),j._updateRtpTransceiver(q)}}),oi()&&Z("SIMULCAST")===!0&&(yield tn(a.applySimulcastForFirefox(f,t)));const _=m.map(j=>j.mid),S=yield tn(a.peerConnection.createOffer()),b=a.mungSendOfferSDP(S.sdp,t,_),A=Yr(b),O=_.map(j=>{const Y=A.mediaDescriptions.find(q=>q.attributes.mid===j);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return RF(Y,Z("USE_PUB_RTX"))}),D=f.map((j,Y)=>{const q=_[Y];return{localSSRC:O[Y],id:q}});yield tn(a.peerConnection.setLocalDescription({type:"offer",sdp:b}));try{yield D}catch(j){const Y=a.remoteSDP.toString();throw yield tn(a.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield tn(a.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),yield tn(a.stopSending(_,!0)),j}yield tn(a.applySimulcastEncodings(f,t)),yield tn(a.applySendEncodings(f,t));const G=a.remoteSDP.toString(),B=a.logSDPExchange(b,"offer","local","send");return B==null||B(G),yield tn(a.setRemoteDescription({type:"answer",sdp:G})),f.map((j,Y)=>{const q=_[Y];return{localSSRC:O[Y],id:q}})}catch(f){throw f instanceof ve?f:new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(f.toString()))}finally{l()}})()}async stopSending(t,n){const s=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter(_=>t.indexOf(_.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length (".concat(a.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));a.map(_=>{var S;_.direction="inactive",(S=_.stop)===null||S===void 0||S.call(_)});const l=await this.peerConnection.createOffer(),f=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const m=this.remoteSDP.toString();f==null||f(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(a){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{s&&s()}}async receive(t,n,s,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:f}=this.remoteSDP.send(t,n,s,a);if(f){const _=this.remoteSDP.toString(),S=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const b=await this.peerConnection.createAnswer(),A=this.mungReceiveAnswerSDP(b.sdp,l,t);S==null||S(A||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:A}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===l);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(l){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async mockReceive(t,n,s,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:f}=this.remoteSDP.send(t,n,s,a);if(f){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const S=await this.peerConnection.createAnswer(),b=this.mungReceiveAnswerSDP(S.sdp,l,t);_==null||_(b||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:b}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(l){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();s==null||s(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===tm.Auto&&(this.store.p2pTransport=tm.SdRtn,on().supportPCSetConfiguration&&this.peerConnection.setConfiguration(R_.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,on().supportPCSetConfiguration&&this.peerConnection.setConfiguration(R_.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:s}=Kh(n.sdp);return this.store.descriptionStart(),this.direction===Tr.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),s}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Tr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:s}=Kh(n.sdp);return await this.peerConnection.setLocalDescription(n),s}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(s.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),f=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),f==null||f(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new ve($.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(t,n){const s=this.peerConnection.getTransceivers().filter(a=>a.mid===t);s.length===1&&(this.isVP8Simulcast(n)?oi()||await this.applySimulcastEncodings(s,[n]):await this.applySendEncodings(s,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const s=this.peerConnection.getTransceivers().find(a=>a.mid===n);s&&await s.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:s,remote:a}=n.getSelectedCandidatePair();return{local:tf(tf({},ql),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:tf(tf({},ql),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;We(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const a={iceServers:[]};var l;return t.iceServers?a.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(ry(t.turnServer.servers)?a.iceServers=t.turnServer.servers:(a.iceServers&&a.iceServers.push(...R_.turnServerConfigToIceServers(t.turnServer.servers,n,s)),Z("USE_TURN_SERVER_OF_GATEWAY")&&a.iceServers&&t.turnServer.serversFromGateway&&a.iceServers.push(...R_.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,s)),We(l=[tm.Relay,tm.SdRtn]).call(l,n)&&(a.iceTransportPolicy="relay"),Z("FORCE_TURN_TCP")?a.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(f=>{f.forceturn&&(a.iceTransportPolicy="relay")}))),Z("ENABLE_ENCODED_TRANSFORM")&&on().supportWebRTCEncodedTransform&&(a.encodedInsertableStreams=!0),k.debug("P2PConnection p2pTransport is ".concat(n)),a}static turnServerConfigToIceServers(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const a=[],l=t.filter(m=>m.tcpport);k.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(s));const f=l.length>s?l[s]:l[0];switch(n){case tm.SdRtn:const m=t.filter(S=>{var b;return We(b=S.username).call(b,"glb:")&&S.turnServerURL==S.turnServerURL}),_=m.length>s?m[s]:m[0];_&&(a.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(Gh(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),a.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(Gh(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case tm.Relay:f&&(a.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=udp")}),a.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(Gh(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}));break;default:f&&(a.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=udp")}),a.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(Gh(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}),a.push({username:f.username,credential:f.password,credentialType:"password",urls:"stun:".concat(f.turnServerURL,":").concat(f.tcpport)}))}return a}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var s;t!=null&&t.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,t.state))},t.onerror=s=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in s?s.error:s)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const s=t==null?void 0:t.iceTransport.state;var a;s&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,s))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:s,remote:a}=n.getSelectedCandidatePair();k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var s;if(n||(n=this.peerConnection.getSenders().find(b=>b.track===t._mediaStreamTrack)),!n)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!on().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const a={},l={};switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(t._encoderConfig){var f;const{bitrateMax:b,frameRate:A,scaleResolutionDownBy:O}=t._encoderConfig;b&&(l.maxBitrate=1e3*b),We(f=t._hints).call(f,kn.LOW_STREAM)&&(A&&(l.maxFramerate=Ea(A)),O&&O>=1&&(l.scaleResolutionDownBy=O))}if(Z("DSCP_TYPE")&&su()){var m;const b=Z("DSCP_TYPE");We(m=["very-low","low","medium","high"]).call(m,b)&&(l.networkPriority=b)}const _=n.getParameters(),S=(s=_.encodings)===null||s===void 0?void 0:s[0];oi()&&!S&&(a.encodings=[l]),S&&Object.assign(S,l),Object.assign(_,a),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await n.setParameters(_)}async applySendEncodings(t,n){try{if(!on().supportSetRtpSenderParameters||t.length!==n.length)return;for(let s=0;s<t.length;s++){const a=t[s],l=n[s];l instanceof Kn&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,a.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,s){const a=Yr(t);return n.forEach((l,f)=>{const m=s[f],_=a.mediaDescriptions.find(S=>S.attributes.mid===m);_&&(r_(_,l),wF(_,l,this.store.codec))}),Bh(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,s)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,n,s)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let _=0;_<t.length;_++){var s,a,l,f,m;const S=t[_],b=n[_];if(b instanceof Kn&&!We(s=b._hints).call(s,kn.LOW_STREAM)&&(a=b._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((l=b._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(f=b._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((m=b._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const A={},O={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{rid:"m",active:!0,maxBitrate:O.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:O.high}];const D=S.sender.getParameters();await S.sender.setParameters(Object.assign(D,A))}}}async applySimulcastEncodings(t,n){if(!oi()&&t.length===n.length)for(let s=0;s<t.length;s++){const a=n[s];if(a instanceof Kn&&this.isVP8Simulcast(a)){const l=t[s],f={},m={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=l.sender.getParameters();await l.sender.setParameters(Object.assign(_,f))}}}isVP8Simulcast(t){var n,s,a,l,f;return!!(t instanceof Kn&&Z("SIMULCAST")&&this.store.codec==="vp8"&&!We(n=t._hints).call(n,kn.LOW_STREAM)&&(s=t._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((f=t._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1)}logSDPExchange(t,n,s,a){if(Z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(n," SDP during P2PConnection.").concat(a,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",s==="local"?"remote":"local",a)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(f=>f.mid&&t.indexOf(f.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(f=>{f.direction="inactive"});const s=await this.peerConnection.createOffer(),a=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();a==null||a(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(f=>f.mid&&t.indexOf(f.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async f=>{f.direction="sendonly"});const s=await this.peerConnection.createOffer(),a=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(t);const l=this.remoteSDP.toString();a==null||a(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var s,a;if(n=(s=n)!==null&&s!==void 0?s:(a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp){var l;const f=(l=Yr(n).mediaDescriptions.find(m=>m.attributes.mid===t))===null||l===void 0?void 0:l.attributes.ssrcs;return f==null?void 0:f[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),We(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,s){const a=Yr(t),l=a.mediaDescriptions.find(f=>f.attributes.mid===n);return l&&s===at.AUDIO&&l.media.mediaType==="audio"&&a_(l),Bh(a)}},ft(Bn.prototype,"establish",[oc],Object.getOwnPropertyDescriptor(Bn.prototype,"establish"),Bn.prototype),ft(Bn.prototype,"connect",[oc],Object.getOwnPropertyDescriptor(Bn.prototype,"connect"),Bn.prototype),ft(Bn.prototype,"receive",[oc],Object.getOwnPropertyDescriptor(Bn.prototype,"receive"),Bn.prototype),ft(Bn.prototype,"mockReceive",[oc],Object.getOwnPropertyDescriptor(Bn.prototype,"mockReceive"),Bn.prototype),ft(Bn.prototype,"stopReceiving",[oc],Object.getOwnPropertyDescriptor(Bn.prototype,"stopReceiving"),Bn.prototype),ft(Bn.prototype,"restartICE",[oc],Object.getOwnPropertyDescriptor(Bn.prototype,"restartICE"),Bn.prototype),ft(Bn.prototype,"close",[oc],Object.getOwnPropertyDescriptor(Bn.prototype,"close"),Bn.prototype),ft(Bn.prototype,"updateEncoderConfig",[oc],Object.getOwnPropertyDescriptor(Bn.prototype,"updateEncoderConfig"),Bn.prototype),ft(Bn.prototype,"updateSendParameters",[oc],Object.getOwnPropertyDescriptor(Bn.prototype,"updateSendParameters"),Bn.prototype),ft(Bn.prototype,"replaceTrack",[oc],Object.getOwnPropertyDescriptor(Bn.prototype,"replaceTrack"),Bn.prototype),ft(Bn.prototype,"muteLocal",[oc],Object.getOwnPropertyDescriptor(Bn.prototype,"muteLocal"),Bn.prototype),ft(Bn.prototype,"unmuteLocal",[oc],Object.getOwnPropertyDescriptor(Bn.prototype,"unmuteLocal"),Bn.prototype),Bn);function oc(e,t,n){const s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,l=await a.lock("From P2PConnection.".concat(t));try{for(var f=arguments.length,m=new Array(f),_=0;_<f;_++)m[_]=arguments[_];return await s.apply(this,m)}finally{l()}},n}let tl=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var Vj,jj,Gj,Hj,Kj,Wj,Yj,qj,$j,zj,Xj,Qn;function Jj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function yA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Jj(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let r9=(Vj=nl(tl.SEND_ONLY),jj=nl(tl.SEND_ONLY),Gj=nl(),Hj=nl(tl.RECEIVE_ONLY),Kj=nl(tl.RECEIVE_ONLY),Wj=nl(tl.RECEIVE_ONLY),Yj=nl(tl.RECEIVE_ONLY),qj=nl(tl.RECEIVE_ONLY),$j=nl(tl.RECEIVE_ONLY),zj=nl(),Xj=nl(tl.RECEIVE_ONLY),Qn=class extends ii{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(vt.StateChange,t,this._state)}constructor(e,t){super(),W(this,"isPlanB",!1),W(this,"store",void 0),W(this,"statsUploader",void 0),W(this,"sendConnection",void 0),W(this,"recvConnection",void 0),W(this,"localTrackMap",new Map),W(this,"remoteUserMap",new Map),W(this,"localDataChannels",[]),W(this,"pendingLocalTracks",[]),W(this,"pendingRemoteTracks",[]),W(this,"statsCollector",void 0),W(this,"dtlsFailedCount",0),W(this,"sendMutex",void 0),W(this,"recvMutex",void 0),W(this,"_state",mn.Disconnected),W(this,"_restartStates",["disconnected","failed"]),W(this,"reconnectInterval",void 0),W(this,"uploadUnplinkStarted",!1),W(this,"uploadDownlinkStarted",!1),W(this,"uplinkStateUploadInterval",void 0),W(this,"downlinkStatsUploadInterval",void 0),W(this,"handleMuteLocalTrack",async(n,s,a)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==mn.Connected)return void a(new ve($.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(n);if(_.length===0)return void s();const S=_.find(D=>D[0]==="videoLowTrack");S&&S[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(D=>{let[,{id:G}]=D;return G}));let b=!1;var f,m;n.trackMediaType==="video"?b=!((f=this.localTrackMap.get(Le.LocalAudioTrack))===null||f===void 0||!f.track._muted):b=((m=this.localTrackMap.get(Le.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const A=this.createMuteMessage(_);await xn(this,vt.RequestMuteLocal,A);const O=n.trackMediaType==="video"?jh.MUTE_LOCAL_VIDEO:jh.MUTE_LOCAL_AUDIO;await xn(this,vt.RequestP2PMuteLocal,{action:O,message:A,isMuteAll:b}),s()}catch(_){a(_)}finally{l()}}),W(this,"handleUnmuteLocalTrack",async(n,s,a)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==mn.Connected)return void a(new ve($.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const f=this.filterTobeUnmutedTracks(n);if(f.length===0)return void s();await this.sendConnection.unmuteLocal(f.map(S=>{let[,{id:b}]=S;return b}));const m=this.createUnmuteMessage(f),_=n.trackMediaType==="video"?jh.UNMUTE_LOCAL_VIDEO:jh.UNMUTE_LOCAL_AUDIO;await xn(this,vt.RequestP2PMuteLocal,{action:_,message:m}),s()}catch(f){a(f)}finally{l()}}),W(this,"handleUpdateVideoEncoder",async(n,s,a,l)=>{let f;typeof l=="boolean"&&l||(f=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Le.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==n||this.state!==mn.Connected)return void s();const{id:S,track:b}=_;S&&(await this.sendConnection.updateSendParameters(S,b),await this.sendConnection.updateEncoderConfig(S,b),this.emit(vt.UpdateVideoEncoder,b)),s()}catch(_){a(_)}finally{var m;(m=f)===null||m===void 0||m()}}),W(this,"handleUpdateVideoSendParameters",async(n,s,a)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const f=this.localTrackMap.get(Le.LocalVideoTrack);if(!this.sendConnection||!f||f.track!==n||this.state!==mn.Connected)return void s();const{id:m,track:_}=f;m&&await this.sendConnection.updateSendParameters(m,_),s()}catch(f){a(f)}finally{l()}}),W(this,"handleReplaceTrack",async(n,s,a,l)=>{let f;k.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof l=="boolean"&&l||(f=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const S=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:A}]=b;return n===A});if(!this.sendConnection||!S||S[1].id===void 0||this.state!==mn.Connected)return void s();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(n,S[1].id)),S[0]===Le.LocalVideoTrack&&on().supportDualStreamEncoding){const b=this.localTrackMap.get(Le.LocalVideoLowTrack);if(b){const A=n._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=A,b.track._originMediaStreamTrack=A,await new Ye((O,D)=>{this.handleReplaceTrack(b.track,O,D,!0)})}}s()}catch(S){a(S)}finally{var _;(_=f)===null||_===void 0||_()}}),W(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),W(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),W(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),W(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new mB(e),this.bindStatsUploaderEvents(),this.sendMutex=new Ps("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Ps("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},Z("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new ve($.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new ve($.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Bj(e,this.store,Tr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const s=await this.recvConnection.establish(t);return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}{this.state=mn.New,this.sendConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Bj(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const s=await this.sendConnection.establish();return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new ve($.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=mn.Connected}async addRemoteCandidate(e,t){if(t===Tr.RECEIVE_ONLY){if(!this.sendConnection)throw new ve($.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new ve($.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var s=this;return ro(function*(){const a=yield tn(s.sendMutex.lock("From P2PChannel.publish"));try{if(!s.sendConnection||s.state!==mn.Connected){s.throwIfTrackTypeNotMatch(e);const S=e.filter(b=>s.pendingLocalTracks.indexOf(b)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(S))}s.store.pubId=s.store.pubId+1,Us.markPublishStart(s.store.clientId,s.store.pubId);const l=s.filterTobePublishedTracks(e,t,n);if(l.length===0)return void(yield tn(s.tryToUnmuteAudio(e)));l.forEach(S=>{let{track:b,type:A}=S;const O=Date.now();s.store.publish(b.getTrackId(),A===Le.LocalAudioTrack?"audio":"video",O)}),s.bindLocalTrackEvents(l);const f=yield tn(s.sendConnection.send(l.map(S=>{let{track:b}=S;return b}),s.store.codec,s.store.audioCodec)),m=(yield tn(f.next())).value,_=s.createGatewayPublishMessage(l,m);try{yield _}catch(S){throw f.throw(S),(S==null?void 0:S.code)===$.WS_ABORT&&l.forEach(b=>{let{track:A}=b;s.pendingLocalTracks.indexOf(A)===-1&&s.pendingLocalTracks.push(A)}),s.unbindLocalTrackEvents(l),S}yield tn(f.next()),l.forEach(S=>{let{type:b}=S;s.statsCollector.addLocalStats(b)}),s.statsUploader.startUploadOutboundStats(),s.assignLocalTracks(l,m),l.forEach(S=>{let{track:b,type:A}=S;const O=Date.now();s.store.publish(b.getTrackId(),A===Le.LocalAudioTrack?"audio":"video",void 0,O)}),s.startUploadUplinkState()}finally{a()}})()}async unpublish(e){if(!this.sendConnection||this.state!==mn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(a=>!We(e).call(e,a)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(a=>a[0]==="videoLowTrack");n&&n[1].track.close();const s=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(a=>{let[,{id:l}]=a;return l})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(a=>{let[l,{track:f}]=a;return{type:l,track:f}})),t.forEach(a=>{let[l]=a;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===mn.Connected)return n&&n[1].track.close(),s;e.forEach(a=>{const l=this.pendingLocalTracks.indexOf(a);l!==-1&&this.pendingLocalTracks.splice(l,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(s=>{let[a,{track:l,ssrcs:f}]=s;const m={stream_type:X$(l,a),ssrcs:f};l._muted||!l._enabled?t.push(m):n.push(m)}),t.length>0&&t.forEach(s=>{xn(this,vt.RequestMuteLocal,[s])}),n.length>0&&n.forEach(s=>{xn(this,vt.RequestUnmuteLocal,[s])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return ro(function*(){throw new ve($.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ws(this,vt.RequestRePublish,this.pendingLocalTracks),this.emit(vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ve($.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,s){var a;if(!this.recvConnection)throw new ve($.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;const{track:l,mid:f,transceiver:m}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),s);t===at.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new JE(l,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new XE(l,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(t,f):this.remoteUserMap.set(e,new Map([[t,f]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const S=this.pendingRemoteTracks.findIndex(b=>{let{user:A,kind:O}=b;return A.uid===e.uid&&t===O});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(vt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,s){if(!this.recvConnection)throw new ve($.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),s)}async unsubscribe(e,t,n){const s=this.pendingRemoteTracks.filter(l=>{let{user:f,kind:m}=l;return t!==void 0?f.uid===e.uid&&t===m:f.uid===e.uid});if(s.forEach(l=>{const f=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(f,1)}),this.recvConnection||n||s.forEach(l=>{let{kind:f}=l;var m;if(f===at.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(f===at.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const a=this.filterTobeUnSubscribedTracks(e,t);a.length!==0&&(await this.recvConnection.stopReceiving(a.map(l=>{let[,{id:f}]=l;return f})),this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),a.forEach(l=>{let[f,{kind:m}]=l;var _,S;if(m===at.VIDEO&&f._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),m===at.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),n||((S=f._videoTrack)===null||S===void 0||S._destroy(),f._videoTrack=void 0);else if(m===at.AUDIO){var b;this.unbindRemoteTrackEvents(f._audioTrack),!n&&((b=f._audioTrack)===null||b===void 0||b._destroy(),f._audioTrack=void 0)}}),a.forEach(l=>{let[,{kind:f}]=l;xn(this,vt.RequestP2PMuteRemote,f)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[at.VIDEO,at.AUDIO].forEach(s=>{n.has(s)?xn(this,vt.RequestP2PUnmuteRemote,s):xn(this,vt.RequestP2PMuteRemote,s)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new ve($.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new ve($.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new ve($.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new ve($.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const s=t===at.VIDEO?e._videoSSRC:e._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(Le.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Hi){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return a!==Le.LocalAudioTrack}).filter(s=>{let[a]=s;return!(e&&a===Le.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[s]=n;return!(e&&s===Le.LocalVideoLowTrack)}).map(n=>{let[,{track:s}]=n;return s})}reportPublishEvent(e,t,n,s,a){if(e){const f=this.localTrackMap.get(Le.LocalAudioTrack),m=s?this.localTrackMap.get(Le.LocalVideoLowTrack):this.localTrackMap.get(Le.LocalVideoTrack);gt.publish(this.store.sessionId,{eventElapse:Us.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:f==null?void 0:f.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(kn.SCREEN_TRACK))!==-1,audio:!!f,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var l;n||(n=[]);const f=n.find(_=>_ instanceof fi),m=s?(l=this.localTrackMap.get(Le.LocalVideoTrack))===null||l===void 0?void 0:l.track:n.find(_=>_ instanceof Kn);gt.publish(this.store.sessionId,{eventElapse:Us.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:f==null?void 0:f.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(kn.SCREEN_TRACK))!==-1,audio:!!f,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,n,s){const a=s===at.VIDEO?n._videoSSRC:n._audioSSRC;a&&gt.subscribe(this.store.sessionId,{succ:e,ec:t,video:s===at.VIDEO,audio:s===at.AUDIO,peerid:n.uid,subscribeRequestid:s===at.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Us.measureFromSubscribeStart(this.store.clientId,a)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ps("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ps("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Le.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Hi){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=mn.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Le.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Le.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Kn||t&&t.track instanceof fi?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Pa(t=this.remoteUserMap).call(t)).find(s=>s.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[s]=n;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Le.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=HS(e).call(e,(n,s)=>n.level-s.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=mn.Reconnecting,Z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:s}]=e;switch(n){case Le.LocalVideoTrack:We(t=s._hints).call(t,kn.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case Le.LocalAudioTrack:s instanceof Hi?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case Le.LocalVideoLowTrack:}}),this.emit(vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Pa(n).call(n)).forEach(s=>{this.setPendingRemoteMedia(t,s)}),this.emit(vt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:s,kind:a}=n;if((e instanceof Yh?e.uid:e)===s.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,s;if(e===Tr.SEND_ONLY){if(!this.sendConnection)throw new ve($.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection}else{if(!this.recvConnection)throw new ve($.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection}try{if(t){const a=await s.restartICE(t);return s.isInRestartIce=!1,a}{const a=await s.restartICE();if(a){const l=await ws(this,vt.RequestP2PRestartICE,{direction:Tr.RECEIVE_ONLY,iceParameter:a});await s.restartICE(l),s.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(Le.LocalVideoTrack),n=this.localTrackMap.get(Le.LocalAudioTrack),s=e.videoSend.find(D=>{var G;return D.ssrc===(t==null||(G=t.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),a=e.audioSend.find(D=>{var G;return D.ssrc===(n==null||(G=n.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!s||!a)return 1;const l=La(this,vt.NeedSignalRTT),f=s?s.rttMs:void 0,m=a?a.rttMs:void 0,_=f&&m?(f+m)/2:f||m,S=(_&&l?(_+l)/2:_||l)||0,b=100*e.sendPacketLossRate*.7/50+.3*S/1500,A=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,O=t==null?void 0:t.track;if(O&&O._encoderConfig&&O._hints.indexOf(kn.SCREEN_TRACK)===-1){const D=O._encoderConfig.bitrateMax,G=e.bitrate.actualEncoded;if(D&&G){const B=(1e3*D-G)/(1e3*D);return ZU[B<.15?0:B<.3?1:B<.45?2:B<.6?3:4][A]}}return A}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[s]=n;const a=s._audioSSRC,l=s._videoSSRC,f=e.audioRecv.find(G=>G.ssrc===a),m=e.videoRecv.find(G=>G.ssrc===l);if(!f&&!m)return void(t+=1);const _=La(this,vt.NeedSignalRTT),S=e.rtt,b=(S&&_?(S+_)/2:S||_)||0,A=f?f.jitterMs:void 0,O=e.recvPacketLossRate;let D=.7*O*100/50+.3*b/1500;A&&(D=.6*O*100/50+.2*b/1500+.2*A/400),t+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ye((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const s=[],a=on(),l=this.getAllTracks();e=UE(e=e.filter(_=>l.indexOf(_)===-1));let f=!1,m=!1;for(const _ of e){if(_ instanceof Kn&&(this.localTrackMap.has(Le.LocalVideoTrack)||f?new ve($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:_,type:Le.LocalVideoTrack}),f=!0),t)){const S=this.getLowVideoTrack(_,n);s.push({track:S,type:Le.LocalVideoLowTrack})}if(_ instanceof fi){const S=this.localTrackMap.get(Le.LocalAudioTrack);if(S){if(!(S.track instanceof Hi))throw new ve($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new ve($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const b=s.find(A=>{let{type:O}=A;return O===Le.LocalAudioTrack});if(!(b.track instanceof Hi))throw new ve($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new ve($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");b.track.addAudioTrack(_)}else{if(!a.webAudioMediaStreamDest||_ instanceof Hi||_._bypassWebAudio)s.push({track:_,type:Le.LocalAudioTrack});else{const b=new Hi;b.addAudioTrack(_),s.push({track:b,type:Le.LocalAudioTrack})}m=!0}}}return s}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=UE(e=e.filter(s=>n.indexOf(s)!==-1));for(const s of e){if(s instanceof fi){const a=this.localTrackMap.get(Le.LocalAudioTrack);if(!a)continue;a.track instanceof Hi?(a.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),a.track.trackList.length===0&&(t.push([Le.LocalAudioTrack,a]),a.track.close())):t.push([Le.LocalAudioTrack,a])}if(s instanceof Kn){const a=this.localTrackMap.get(Le.LocalVideoTrack);if(!a)continue;t.push([Le.LocalVideoTrack,a]);const l=this.localTrackMap.get(Le.LocalVideoLowTrack);l&&t.push([Le.LocalVideoLowTrack,l])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:s}=t;switch(s){case Le.LocalVideoTrack:n.addListener(dt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(dt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Le.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Le.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Hi?e.trackList.forEach(n=>{n.addListener(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(dt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(dt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:s}]=t;return{track:s,type:n}})),e.forEach(t=>{let{track:n,type:s}=t;switch(s){case Le.LocalVideoTrack:n.off(dt.GET_STATS,this.handleGetLocalVideoStats),n.off(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(dt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Le.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Le.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Hi?e.trackList.forEach(t=>{t.off(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(dt.GET_STATS,this.handleGetLocalAudioStats),t.off(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(dt.GET_STATS,this.handleGetLocalAudioStats),e.off(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof XE&&t.addListener(dt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof JE&&t.addListener(dt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(dt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(at.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(at.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,s)=>{var a;let l,{track:f,type:m}=n;switch(m){case Le.LocalAudioTrack:l=En.Audio;break;case Le.LocalVideoTrack:l=We(a=f._hints).call(a,kn.SCREEN_TRACK)?En.Screen:En.High;break;case Le.LocalVideoLowTrack:l=En.Low}return{kind:m===Le.LocalAudioTrack?at.AUDIO:at.VIDEO,stream_type:l,mid:t[s].id,ssrcs:t[s].localSSRC,isMuted:f.muted||!f.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let s,[a,{track:l,ssrcs:f,id:m}]=t;switch(a){case Le.LocalVideoTrack:s=We(n=l._hints).call(n,kn.SCREEN_TRACK)?En.Screen:En.High;break;case Le.LocalAudioTrack:s=En.Audio;break;case Le.LocalVideoLowTrack:s=En.Low}return{stream_type:s,ssrcs:f,mid:m}})}assignLocalTracks(e,t){e.forEach((n,s)=>{let{track:a,type:l}=n;this.localTrackMap.set(l,{track:a,id:t[s].id,ssrcs:t[s].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(vt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),We(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await gs(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),gt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:li.TRACER}).onSuccess(),this.emit(vt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const s=Array.from(Pa(n=this.remoteUserMap).call(n)).find(l=>l._audioSSRC===t);var a;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(a=s.audioTrack)===null||a===void 0||a.emit(WE.FIRST_FRAME_DECODED),gt.firstRemoteFrame(this.store.sessionId,Zi.FIRST_AUDIO_DECODE,Xn.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const s=Array.from(Pa(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);s&&gt.firstRemoteFrame(this.store.sessionId,Zi.FIRST_AUDIO_RECEIVED,Xn.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,s)=>{this.reportVideoFirstFrameDecoded(t,n,s)},e.onFirstVideoReceived=t=>{var n;const s=Array.from(Pa(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===t);s&&gt.firstRemoteFrame(this.store.sessionId,Zi.FIRST_VIDEO_RECEIVED,Xn.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const s=t.candidateType==="relay",a=n.candidateType==="relay";n.candidateType!=="unknown"&&s===a||this.emit(vt.ConnectionTypeChange,s),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Hh(n))," -> ").concat(JSON.stringify(Hh(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Hh(n))," -> ").concat(JSON.stringify(Hh(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(vt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Tr.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,k.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Tr.SEND_ONLY?this.restartICE(e):ws(this,vt.RequestP2PRestartICE,{direction:Tr.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Le.LocalAudioTrack);if(e instanceof fi&&(n==null?void 0:n.track)instanceof Hi)return n.track.isActive||t.push([Le.LocalAudioTrack,n]),t;const s=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(s&&(t.push(s),s[0]===Le.LocalVideoTrack)){const a=this.localTrackMap.get(Le.LocalVideoLowTrack);a&&t.push([Le.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Le.LocalAudioTrack);if(e instanceof fi&&(n==null?void 0:n.track)instanceof Hi)return n.track.isActive&&t.push([Le.LocalAudioTrack,n]),t;const s=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(s)if(s[0]===Le.LocalVideoTrack){t.push(s);const a=this.localTrackMap.get(Le.LocalVideoLowTrack);a&&t.push([Le.LocalVideoLowTrack,a])}else t.push(s);return t}createMuteMessage(e){return e.map(t=>{var n;let s,[a,{track:l,ssrcs:f,id:m}]=t;switch(a){case Le.LocalAudioTrack:s=En.Audio;break;case Le.LocalVideoTrack:s=We(n=l._hints).call(n,kn.SCREEN_TRACK)?En.Screen:En.High;break;case Le.LocalVideoLowTrack:s=En.Low}return{stream_type:s,ssrcs:f,mid:m}})}createUnmuteMessage(e){return e.map(t=>{var n;let s,[a,{track:l,ssrcs:f,id:m}]=t;switch(a){case Le.LocalAudioTrack:s=En.Audio;break;case Le.LocalVideoTrack:s=We(n=l._hints).call(n,kn.SCREEN_TRACK)?En.Screen:En.High;break;case Le.LocalVideoLowTrack:s=En.Low}return{stream_type:s,ssrcs:f,mid:m}})}filterTobeUnSubscribedTracks(e,t){const n=[],s=this.remoteUserMap.get(e);if(!s)return n;if(t){const a=s.get(t);if(!a)return n;n.push([e,{kind:t,id:a}])}else Array.from(s.entries()).forEach(a=>{let[l,f]=a;n.push([e,{kind:l,id:f}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[s,{kind:a,id:l}]=n;switch(a){case at.VIDEO:return void(s._videoSSRC&&t.push({stream_type:at.VIDEO,ssrcId:s._videoSSRC}));case at.AUDIO:return void(s._audioSSRC&&t.push({stream_type:at.AUDIO,ssrcId:s._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:s}]=t;const a=this.remoteUserMap.get(n);a&&(a.delete(s),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Le.LocalVideoTrack),n=this.localTrackMap.get(Le.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ye((s,a)=>{this.handleUpdateVideoEncoder(t.track,s,a,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ye((s,a)=>{this.handleUpdateVideoEncoder(n.track,s,a,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof fi){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const s=this.createUnmuteMessage(n);return void await xn(this,vt.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(vt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(vt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await gs(Xw(this.dtlsFailedCount,Bi)),this.emit(vt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Le.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Kn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Kn).length>1)throw new ve($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof fi).length>1&&(e.some(t=>t instanceof fi&&t._bypassWebAudio)||!on().webAudioMediaStreamDest))throw new ve($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Kn&&this.pendingLocalTracks.some(n=>n instanceof Kn))throw new ve($.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof fi&&this.pendingLocalTracks.some(n=>n instanceof fi)&&(!on().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof fi&&n._bypassWebAudio)))throw new ve($.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&on().supportDualStreamEncoding,s=yA(yA({},{width:160,height:120,framerate:15,bitrate:50}),t);let a;a=n?e._mediaStreamTrack.clone():rD(e,s);const l=Pn(8,"track-low-"),f=new Kn(a,yA(yA({},n&&{scaleResolutionDownBy:jO(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,l);return f.on(nm.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,HE.LOW_STREAM)}),f._hints.push(kn.LOW_STREAM),e.addListener(dt.NEED_CLOSE,()=>{f.close()}),f}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,s){var a;const l=Array.from(Pa(a=this.remoteUserMap).call(a)).find(f=>f._videoSSRC===e);if(l){s||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,m=f.subscribe.find(_=>_.userId===l.uid&&_.type==="video");gt.firstRemoteVideoDecode(this.store.sessionId,Zi.FIRST_VIDEO_DECODE,Xn.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:n,subscribeElapse:Us.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(e);if(!s)return!1;const a=s.get(t);if(!a)return!1;const l=await this.recvConnection.getRemoteSSRC(a);return l!==void 0&&l!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new ve($.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new ve($.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new ve($.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new ve($.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new ve($.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new ve($.NOT_SUPPORTED)}async preConnect(e){throw new ve($.NOT_SUPPORTED)}getEstablishParams(){throw new ve($.NOT_SUPPORTED)}async reSubscribe(e){throw new ve($.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new ve($.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Le.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,HE.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},ft(Qn.prototype,"p2pConnect",[Vj],Object.getOwnPropertyDescriptor(Qn.prototype,"p2pConnect"),Qn.prototype),ft(Qn.prototype,"unpublish",[jj],Object.getOwnPropertyDescriptor(Qn.prototype,"unpublish"),Qn.prototype),ft(Qn.prototype,"unpublishLowStream",[Gj],Object.getOwnPropertyDescriptor(Qn.prototype,"unpublishLowStream"),Qn.prototype),ft(Qn.prototype,"subscribe",[Hj],Object.getOwnPropertyDescriptor(Qn.prototype,"subscribe"),Qn.prototype),ft(Qn.prototype,"mockSubscribe",[Kj],Object.getOwnPropertyDescriptor(Qn.prototype,"mockSubscribe"),Qn.prototype),ft(Qn.prototype,"unsubscribe",[Wj],Object.getOwnPropertyDescriptor(Qn.prototype,"unsubscribe"),Qn.prototype),ft(Qn.prototype,"muteRemote",[Yj],Object.getOwnPropertyDescriptor(Qn.prototype,"muteRemote"),Qn.prototype),ft(Qn.prototype,"unmuteRemote",[qj],Object.getOwnPropertyDescriptor(Qn.prototype,"unmuteRemote"),Qn.prototype),ft(Qn.prototype,"hasRemoteMediaWithLock",[$j],Object.getOwnPropertyDescriptor(Qn.prototype,"hasRemoteMediaWithLock"),Qn.prototype),ft(Qn.prototype,"disconnectForReconnect",[zj],Object.getOwnPropertyDescriptor(Qn.prototype,"disconnectForReconnect"),Qn.prototype),ft(Qn.prototype,"remoteMediaSsrcChanged",[Xj],Object.getOwnPropertyDescriptor(Qn.prototype,"remoteMediaSsrcChanged"),Qn.prototype),Qn);function nl(e){return function(t,n,s){const a=t[n];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){for(var l=arguments.length,f=new Array(l),m=0;m<l;m++)f[m]=arguments[m];switch(e){case tl.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await a.apply(this,f)}finally{_()}}case tl.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await a.apply(this,f)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(n)),S=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await a.apply(this,f)}finally{_(),S()}}}},s}}class bm extends ii{constructor(t,n){super(),W(this,"signal",void 0),W(this,"token",void 0),W(this,"tokenTimeout",void 0),W(this,"tokenInterval",void 0),W(this,"_sequence",0),W(this,"userMap",new Map),W(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const s=()=>{this.signal.connectionState===Fn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(s,1e3):this.tokenInterval=window.setTimeout(s,3*Z("P2P_TOKEN_INTERVAL"))};s()}async send(t,n,s,a,l){var f,m,_;if(this.userMap.size===0)return;const S=Array.from(ps(f=this.userMap).call(f))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),a=(m=a)!==null&&m!==void 0?m:Pn(6,""),l=(_=l)!==null&&_!==void 0?_:this._sequence++;const b={_id:a,_type:t,_seq:l,_message:n,token:"".concat(this.token,"_").concat(S)};Z("SHOW_P2P_LOG")&&k.debug("send message",b,"noNeedResponse : ".concat(s)),this.splitMessage(JSON.stringify(b)).forEach(O=>{this.signal.request(Dt.DATA_STREAM,{payload:Fh(this.encoder.encode(O))})});const A=new Ye((O,D)=>{const G=window.setTimeout(()=>{this.off("res-@".concat(a,"_ack"),B),this.off("res-@".concat(a),Y),this.off(n_.ABORT,j),k.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(a)),this.userMap.size===0?D(new ve($.INVALID_REMOTE_USER)):D(new ve($.TIMEOUT))},Z("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),B=()=>{G&&window.clearTimeout(G),this.off(n_.ABORT,j),s&&O()},j=()=>{G&&window.clearTimeout(G),this.off("res-@".concat(a,"_ack"),B),this.off("res-@".concat(a),Y),D(new ve($.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(a)))};this.once(n_.ABORT,j),this.once("res-@".concat(a,"_ack"),B);const Y=(ie,le)=>{q=!0,G&&window.clearTimeout(G),this.off("res-@".concat(a,"_ack"),B),this.off(n_.ABORT,j),ie==="success"?O(le):D(new ve($.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(a)))};let q=!1;s||(this.once("res-@".concat(a),Y),gs(Z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{q||k.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(a,", ").concat(b))}))});try{return await A}catch(O){if(O.code===$.TIMEOUT)return await this.send(t,n,s,a,l);throw O}}onMessage(t){var n;const{_uid:s}=t;let a,l=this.userMap.get(s);if(l)a=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Ri.CHECK)return;const{token:S}=t;a=new Map,l={uid:s,isStart:!0,token:S,splitMessageMap:a,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(s,l),this.signal.emit(qt.ON_USER_ONLINE,{uid:s}),this.handleUserOnline()}if("id"in t&&"total"in t){var f;const{id:S,total:b}=t,A=(f=a.get(S))!==null&&f!==void 0?f:[];if(A.push(t),a.has(S)||a.set(S,A),A.length!==b)return;{const O=HS(A).call(A,(D,G)=>D.index-G.index).map(D=>D.payload).join("");a.delete(S),(t=JSON.parse(O))._uid=s}}const{_type:m,token:_}=t;if(We(n=[Ri.ACK,Ri.CHECK]).call(n,m))return m===Ri.CHECK&&this.handleCheckToken(l,_),void this.receiveMessage(t);_==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(t):k.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(l.token,"_").concat(this.token),t)}check(){const t={_id:Pn(6,""),token:this.token,_type:Ri.CHECK};Z("SHOW_P2P_LOG")&&k.debug("send message",t),this.signal.request(Dt.DATA_STREAM,{payload:Fh(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Ri.ACK,token:this.token};Z("SHOW_P2P_LOG")&&k.debug("send message",n),this.signal.request(Dt.DATA_STREAM,{payload:Fh(this.encoder.encode(JSON.stringify(n)))})}response(t,n,s){this.send(Ri.RESPONSE,JSON.stringify({success:!s,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(S=>{const{receivedMessagesMap:b,nextExpectedSequenceNumber:A}=S;for(;b.has(A);){const O=b.get(A);b.delete(A),this.receiveMessage(O),S.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:s,_seq:a}=t,l=this.userMap.get(s),{receivedMessagesMap:f,isStart:m,nextExpectedSequenceNumber:_}=l;if(a<_)return this.ack(t._id),void k.debug("[external-signal] receive old message, seq: ".concat(a,", ").concat(t._message));f.set(a,t),m&&a===_&&(this.receiveMessage(t),f.delete(_),l.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:s,_message:a,_uid:l}=t;if(Z("SHOW_P2P_LOG")&&k.debug("receive message",t),n){let f;switch(t._type!==Ri.ACK&&(a&&(f=JSON.parse(a)),this.ack(t._id)),t._type){case Ri.CANDIDATE:case Ri.CONTROL:this.signal.emit(s,f,l);break;case Ri.PUBLISH:case Ri.UNPUBLISH:case Ri.RESTART_ICE:case Ri.CALL:f.uid=l,ws(this.signal,s,f).then(m=>{this.response(t._id,m)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Ri.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Ri.RESPONSE:{const{success:m,message:_}=f;this.emit("res-@".concat(n),m?"success":"failed",_);break}}}}splitMessage(t){if(t.length<bm.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:s}=JSON.parse(t),a=Pn(6,"");let l=0,f=800;const m=Math.ceil(t.length/f);for(;t.length>0;){l++;const _={id:a,index:l,total:m,payload:t.slice(0,f),token:"".concat(this.token,"_").concat(s)};JSON.stringify(_).length>bm.MAX_MESSAGE_SIZE?f-=50:(n.push(_),t=t.slice(f))}return n.map(_=>JSON.stringify(_))}handleCheckToken(t,n){return t.token!==n?(k.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{k.debug("token timeout, ".concat(n)),this.reset(t.uid)},Z("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await ws(this.signal,Ri.CALL,void 0),n=await this.send(Ri.CALL,t);this.signal.emit(Nt.P2P_CONNECTION,n,!0)}async reset(t,n){const s=this.userMap.get(t);s&&(this.emit(n_.ABORT),this.signal.emit(qt.ON_USER_OFFLINE,{uid:s.uid,reason:R$.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(k.debug("change local token from ".concat(n," to ").concat(n)),this.token=Pn(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(n_.ABORT)}}W(bm,"MAX_SIZE",1),W(bm,"MAX_MESSAGE_SIZE",1024);class a9 extends ii{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Fn.CONNECTED?this.emit(Nt.WS_CONNECTED):t===Fn.RECONNECTING?this.emit(Nt.WS_RECONNECTING,this._websocketReconnectReason):t===Fn.CLOSED&&this.emit(Nt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),W(this,"_disconnectedReason",void 0),W(this,"_websocketReconnectReason",void 0),W(this,"_connectionState",Fn.CLOSED),W(this,"reconnectToken",void 0),W(this,"p2pToken",void 0),W(this,"websocket",void 0),W(this,"openConnectionTime",void 0),W(this,"clientId",void 0),W(this,"lastMsgTime",Date.now()),W(this,"uploadCache",[]),W(this,"uploadCacheInterval",void 0),W(this,"rttRolling",new IM(5)),W(this,"pingpongTimer",void 0),W(this,"pingpongTimeoutCount",0),W(this,"joinResponse",void 0),W(this,"multiIpOption",void 0),W(this,"initError",void 0),W(this,"spec",void 0),W(this,"store",void 0),W(this,"_external_signal",void 0),W(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(Nt.ON_BINARY_DATA,s.data);const a=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const l="res-@".concat(a._id);this.emit(l,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")){switch(a._type){case qt.ON_DATA_STREAM:return void this.handleDataStream(a._message);case qt.MUTE_AUDIO:case qt.MUTE_VIDEO:case qt.ON_P2P_LOST:case qt.ON_USER_ONLINE:return;case qt.ON_USER_OFFLINE:const{uid:l}=a._message;return k.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(a._type,a._message),a._type===qt.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===qt.ON_USER_BANNED)switch(a._message.error_code){case 14:this.close(pn.UID_BANNED);break;case 15:this.close(pn.IP_BANNED);break;case 16:this.close(pn.CHANNEL_BANNED)}if(a._type===qt.ON_USER_LICENSE_BANNED)switch(a._message.error_code){case Rt.ERR_LICENSE_MISSING:this.close(pn.LICENSE_MISSING);break;case Rt.ERR_LICENSE_EXPIRED:this.close(pn.LICENSE_EXPIRED);break;case Rt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(pn.LICENSE_MINUTES_EXCEEDED);break;case Rt.ERR_LICENSE_PERIOD_INVALID:this.close(pn.LICENSE_PERIOD_INVALID);break;case Rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(pn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Rt.ERR_LICENSE_ILLEGAL:this.close(pn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new BO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Z("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Fn.CONNECTED&&this.reconnect("retry",Is.OFFLINE)}),this.p2pToken=Pn(6,""),this._external_signal=new bm(this,this.p2pToken)}async request(t,n,s,a){const l=Pn(6,""),f={_id:l,_type:t,_message:n},m=this.websocket.connectionID,_=()=>new Ye((G,B)=>{if(this.connectionState===Fn.CONNECTED)return G();const j=()=>{this.off(Nt.WS_CLOSED,Y),G()},Y=()=>{this.off(Nt.WS_CONNECTED,j),B(new ve($.WS_ABORT))};this.once(Nt.WS_CONNECTED,j),this.once(Nt.WS_CLOSED,Y)});if(this.connectionState!==Fn.CONNECTING&&this.connectionState!==Fn.RECONNECTING||t===Dt.JOIN||t===Dt.REJOIN||await _(),this.websocket.sendMessage(f,!0),a)return;const S=new Ye((G,B)=>{let j=!1;const Y=(ie,le)=>{j=!0,G({isSuccess:ie==="success",message:le||{}}),this.off(Nt.WS_CLOSED,q),this.off(Nt.WS_RECONNECTING,q),this.emit(Nt.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),Y);const q=()=>{B(new ve($.WS_ABORT,"type: ".concat(t))),this.off(Nt.WS_CLOSED,q),this.off(Nt.WS_RECONNECTING,q),this.off("res-@".concat(l),Y)};this.once(Nt.WS_CLOSED,q),this.once(Nt.WS_RECONNECTING,q),gs(Z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Nt.REQUEST_TIMEOUT,t,n))})});let b=null;try{b=await S}catch(G){if(this.connectionState===Fn.CLOSED||t===Dt.LEAVE)throw new ve($.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?G.throw():t===Dt.JOIN||t===Dt.REJOIN?null:(await _(),await this.request(t,n))}if(b.isSuccess)return b.message;const A=Number(b.message.error_code||b.message.code),O=my(A),D=new ve($.UNEXPECTED_RESPONSE,"".concat(O.desc,": ").concat(b.message.error_str),{code:A,data:b.message,desc:O.desc});return O.action==="success"?b.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(A,", message: ").concat(O.desc,", action: ").concat(O.action)),A===Rt.ERR_TOO_MANY_BROADCASTERS?((t===Dt.JOIN||t===Dt.REJOIN)&&(this.initError=D,this.close()),D.throw()):O.action==="failed"?D.throw():O.action==="quit"?(this.initError=D,this.close(),D.throw()):(A===Rt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Is.MULTI_IP)):this.reconnect(O.action,Is.SERVER_ERROR),t===Dt.JOIN||t===Dt.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Ye(s=>{const a=l=>{(!n||n(l))&&(this.off(t,a),s(l))};this.on(t,a)})}uploadWRTCStats(t){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(fy.WRTC_STATS,n)}upload(t,n){const s={_type:t,_message:n};try{this.websocket.sendMessage(s)}catch{const l=Z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Fn.CONNECTED)return;const f=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(f._type,f._message)},Z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const s={_type:t,_message:n};this.websocket.sendMessage(s)}async sendExtensionMessage(t,n,s){return await this._external_signal.send(t,n,s)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ye((n,s)=>{this.once(Nt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Nt.WS_CLOSED,()=>s(this.initError||new ve($.WS_ABORT))),this.connectionState=Fn.CONNECTING,this.websocket.init(t).catch(s)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||pn.LEAVE,this.connectionState=Fn.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Pn(6,""),this._external_signal.clear(),this._external_signal=new bm(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Nt.ABORT_P2P_EXECUTION);const t=await ws(this,Nt.REQUEST_JOIN_INFO),n=await this.request(Dt.JOIN,t);if(!n)return this.emit(Nt.REPORT_JOIN_GATEWAY,$.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Nt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Fn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleDataStream(t){try{var n;const s=Zp(t.payload),a=new TextDecoder().decode(s),l=JSON.parse(a);"total"in l&&"id"in l||We(n=Object.values(Ri)).call(n,l._type)?(l._uid=t.uid,this._external_signal.onMessage(l)):this.emit(qt.ON_DATA_STREAM,t)}catch{this.emit(qt.ON_DATA_STREAM,t)}}handleNotification(t){k.debug("[".concat(this.clientId,"] receive notification: "),t);const n=my(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(pn.UID_BANNED),void this.close()):void this.reconnect(n.action,Is.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=Z("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(k.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>Z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Is.TIMEOUT):this.request(Dt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-n;this.rttRolling.add(s),Z("REPORT_STATS")&&this.send(Dt.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWebsocketEvents(){this.websocket.on(kt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Nt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(kt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(kt.CLOSED,()=>{this.connectionState=Fn.CLOSED}),this.websocket.on(kt.FAILED,()=>{this._disconnectedReason=pn.NETWORK_ERROR,this.connectionState=Fn.CLOSED}),this.websocket.on(kt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Fn.CONNECTED?this.connectionState=Fn.RECONNECTING:this.connectionState=Fn.CONNECTING}),this.websocket.on(kt.WILL_RECONNECT,(t,n,s)=>{t!=="retry"?(k.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):k.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),s(t)}),this.websocket.on(kt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Nt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ve&&t.code===$.UNEXPECTED_RESPONSE&&t.data.code===Rt.ERR_NO_AUTHORIZED)return k.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Is.SERVER_ERROR);k.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Is.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(kt.REQUEST_NEW_URLS,(t,n)=>{ws(this,Nt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const o9={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new r9(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new a9(n,t)}};function Qj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Zj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Qj(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}class c9{constructor(t){W(this,"sessionDesc",void 0),W(this,"localCapabilities",void 0),W(this,"rtpCapabilities",void 0),W(this,"candidates",void 0),W(this,"_originCandidates",void 0),W(this,"iceParameters",void 0),W(this,"dtlsParameters",void 0),W(this,"setup",void 0),W(this,"currentMidIndex",void 0),W(this,"cname",void 0),t=di(t);const{iceParameters:n,dtlsParameters:s,candidates:a,rtpCapabilities:l,setup:f,localCapabilities:m,sdkCodec:_,cname:S}=t,b=Yr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=l,this.candidates=a,this._originCandidates=di(a),this.iceParameters=n,this.dtlsParameters=s,this.setup=f,this.localCapabilities=m,this.cname=S;for(let A=0;A<b.mediaDescriptions.length;A++){const O=b.mediaDescriptions[A];if(O.attributes.iceUfrag=n.iceUfrag,O.attributes.icePwd=n.icePwd,O.attributes.fingerprints=s.fingerprints,O.attributes.candidates=a,O.attributes.setup=f,O.media.mediaType==="video"){O.media.fmts=l.videoCodecs.map(G=>G.payloadType.toString(10));let D=l.videoCodecs.filter(G=>{var B,j;return(B=G.rtpMap)===null||B===void 0?void 0:We(j=B.encodingName.toLowerCase()).call(j,_)});D.length===0&&(D=l.videoCodecs),O.attributes.payloads=D,O.attributes.extmaps=l.videoExtensions}O.media.mediaType==="audio"&&(O.media.fmts=l.audioCodecs.map(D=>D.payloadType.toString(10)),O.attributes.payloads=l.audioCodecs,O.attributes.extmaps=l.audioExtensions),b.mediaDescriptions[A]=this.mungMediaDesc(O)}this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return Bh(this.sessionDesc)}send(t,n,s){const{ssrcs:a,ssrcGroups:l}=lm(n,this.cname),f=this.sessionDesc.mediaDescriptions.find(S=>t===at.VIDEO?S.media.mediaType==="video":S.media.mediaType==="audio"),m=a[0].attributes.label,_=a[0].attributes.mslabel;return f.attributes.ssrcs=f.attributes.ssrcs.concat(a),f.attributes.ssrcGroups=f.attributes.ssrcGroups.concat(l),{id:m,mslabel:_}}batchSend(t){return t.map(n=>{let{kind:s,ssrcMsg:a}=n;return this.send(s,a,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const s=[],a=[],l=[];n.attributes.ssrcs.forEach(f=>{We(t).call(t,f.attributes.label||"")?l.push(f):s.push(f)}),n.attributes.ssrcGroups.forEach(f=>{var m;We(m=l.map(_=>_.ssrcId)).call(m,f.ssrcIds[0])||a.push(f)}),n.attributes.ssrcs=s,n.attributes.ssrcGroups=a})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,s){t.forEach((a,l)=>{const f=a._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(S=>S.attributes.mid===f.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],a);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(a=>a.transport==="udp"),s=[];if(n.forEach(a=>{s.push(Zj(Zj({},a),{},{foundation:"tcpcandidate",priority:Number(a.priority)-1+"",transport:"tcp",port:Number(a.port)+90+""}))}),n.length!==0){switch(t){case Ms.TCP_RELAY:this.candidates=s;break;case Ms.UDP_TCP_RELAY:case Ms.RELAY:this.candidates=[...n,...s];break;default:this.candidates=n}for(const a of this.sessionDesc.mediaDescriptions)a.attributes.candidates=this.candidates}}restartICE(t){t=di(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let s=0;s<t;s++)n.push((this.currentMidIndex+s+1).toString(10));return n}mungRecvMediaDsec(t,n){const s=di(t);return r_(s,n),HO(s,n),s}updateRecvMedia(t,n){const s=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===t);if(s!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],n);this.sessionDesc.mediaDescriptions[s]=a}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,s){const a=this.sessionDesc.mediaDescriptions.find(f=>t===at.VIDEO?f.attributes.mid==="video":f.attributes.mid==="audio");if(a){const f=a.attributes.ssrcs.find(m=>m.attributes.label===n);var l;f&&(f.attributes.label=s,(l=f.attributes.msid)===null||l===void 0||l.replace(n,s))}}mungMediaDesc(t){const n=di(t);return GO(n),function(s){const a=s.attributes.extmaps.find(l=>MR(l.extensionName));a&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(a),1),s.attributes.payloads.forEach(l=>{const f=l.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");f!==-1&&l.rtcpFeedbacks.splice(f,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const s of n.attributes.ssrcs)if(s.attributes.label===t)return[s]}}var wn;function e3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function TA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?e3(Object(n),!0).forEach(function(s){W(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e3(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let l9=(wn=class eT extends lF{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return We(n=Object.keys(uR)).call(n,t)}))]}constructor(t,n){super(t,n),W(this,"store",void 0),W(this,"peerConnection",void 0),W(this,"remoteSDP",void 0),W(this,"initialOffer",void 0),W(this,"statsFilter",void 0),W(this,"useRTX",!1),W(this,"localCapabilities",void 0),W(this,"localCandidateCount",0),W(this,"allCandidatesReceived",!1),W(this,"establishPromise",void 0),W(this,"mutex",void 0),this.store=n,this.mutex=new Ps("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(eT.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=nO(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,oi()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Kh(t.sdp),s=_y(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:Z("FILTER_VIDEO_FEC"),filterAudioFec:Z("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=s,this.initialOffer=t,TA(TA({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:s},offerSDP:t.sdp})}catch(t){throw new ve($.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new c9(TA(TA({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new ve($.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var s=this;return ro(function*(){const a=yield tn(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=t.map(O=>s.peerConnection.addTrack(O._mediaStreamTrack)),f=yield tn(s.peerConnection.createOffer()),m=Yr(f.sdp),_=t.map(O=>{const D=O._mediaStreamTrack,G=m.mediaDescriptions.find(B=>B.attributes.mid===D.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(B,j,Y){const q=B.attributes.ssrcs.filter(le=>le.attributes.label===j),ie=B.attributes.ssrcGroups;if(q.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ie&&q.length>1){const le=ie.find(ue=>ue.ssrcIds.indexOf(q[0].ssrcId)!==-1);return le?[{ssrcId:le.ssrcIds[0],rtx:Y?le.ssrcIds[1]:void 0}]:[{ssrcId:q[0].ssrcId}]}return[{ssrcId:q[0].ssrcId}]}(G,D.id,s.useRTX)});let S;try{S=yield _}catch(O){throw l.forEach(D=>{Cs()&&D.replaceTrack(null),s.peerConnection.removeTrack(D)}),O}const b=s.mungSendOfferSDP(f.sdp,t);s.remoteSDP.receive(t,n,S);const A=s.remoteSDP.toString();return yield tn(s.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield tn(s.applySendEncodings(l,t)),yield tn(s.peerConnection.setRemoteDescription({type:"answer",sdp:A})),t.map((O,D)=>{const G=O._mediaStreamTrack.id;return{localSSRC:_[D],id:G}})}catch(l){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{a()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(l=>{var f;return t.indexOf(((f=l.track)===null||f===void 0?void 0:f.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(l=>{Cs()&&l.replaceTrack(null),this.peerConnection.removeTrack(l)});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,s,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:l,mslabel:f}=this.remoteSDP.send(t,n,a),m=new Ye((b,A)=>{const O=setTimeout(()=>{A(new Error("Cannot receive track, id: ".concat(l)))},1e4),D=G=>{const B=nn();if((B.name==="Safari"&&Number(B.version)===11||_r())&&G.track.id!==l&&G.streams[0].id===f){var j;const Y=G.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(t,l,G.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(O),void b(Y)}if(G.track.id===l)return this.peerConnection.removeEventListener("track",D),clearTimeout(O),void b(G.track)};this.peerConnection.addEventListener("track",D)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(S),{track:await m,id:l}}catch(l){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s)}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var a;return t.indexOf(((a=s.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(s=>{if(Cs()&&s.track)s.track.enabled=!1;else{const a=s.getParameters();a.encodings.forEach(l=>l.active=!1),s.setParameters(a)}})}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(l=>{var f;return t.indexOf(((f=l.track)===null||f===void 0?void 0:f.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async l=>{if(Cs()&&l.track)l.track.enabled=!0;else{const f=l.getParameters();f.encodings.forEach(m=>m.active=!0),await l.setParameters(f)}});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s);const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ro(function*(){const s=yield tn(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const a=on().supportPCSetConfiguration;if(t===Ms.RELAY&&!a)return;if(a){const S=n.peerConnection.getConfiguration(),b=t===Ms.RELAY?"relay":"all";S.iceTransportPolicy!==b&&(k.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(b,"]")),S.iceTransportPolicy=b,n.peerConnection.setConfiguration(S))}t!==Ms.RELAY&&n.remoteSDP.updateCandidates(t);const l=yield tn(n.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=Kh(l.sdp),{remoteIceParameters:m}=yield f.iceParameters;n.remoteSDP.restartICE(m);const _=n.remoteSDP.toString();yield tn(n.peerConnection.setLocalDescription(l)),yield tn(n.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(a){k.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),a)}finally{s()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(s.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(s){throw new ve($.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(t,n){const s=this.peerConnection.getSenders().filter(a=>{var l;return((l=a.track)===null||l===void 0?void 0:l.id)===t});s.length===1&&await this.applySendEncodings(s,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const s=this.peerConnection.getSenders().find(a=>{var l;return((l=a.track)===null||l===void 0?void 0:l.id)===n});s&&await s.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new ve($.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new ve($.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(ry(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...eT.turnServerConfigToIceServers(t.turnServer.servers)),Z("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...eT.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(s=>{s.security?s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var s;if(n||(n=this.peerConnection.getSenders().find(S=>{var b;return((b=S.track)===null||b===void 0?void 0:b.id)===t._mediaStreamTrack.id})),!n)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!on().supportSetRtpSenderParameters)return k.warn("Browser not support set rtp-sender parameters");const a={},l={};if(t instanceof Kn)switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(Z("DSCP_TYPE")&&su()){var f;const S=Z("DSCP_TYPE");We(f=["very-low","low","medium","high"]).call(f,S)&&(l.networkPriority=S)}const m=n.getParameters(),_=(s=m.encodings)===null||s===void 0?void 0:s[0];_&&Object.assign(_,l),Object.assign(m,a),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await n.setParameters(m)}async applySendEncodings(t,n){try{if(!on().supportSetRtpSenderParameters||t.length!==n.length)return;for(let s=0;s<t.length;s++){const a=t[s],l=n[s];a&&l&&await this.updateRtpSenderEncodings(l,a)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const s=Yr(t);return n.forEach((a,l)=>{const f=a._mediaStreamTrack,m=s.mediaDescriptions.find(_=>_.attributes.mid===f.kind);m&&r_(m,a)}),Bh(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,s)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,n,s)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((l,f)=>{let{id:m,mslabel:_}=l;const{kind:S}=t[f];return new Ye((b,A)=>{const O=setTimeout(()=>{A(new Error("Cannot receive track, id: ".concat(m)))},1e4),D=G=>{const B=nn();if(B.name==="Safari"&&Number(B.version)===11&&G.track.id!==m&&G.streams[0].id===_){var j;const Y=G.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(S,m,G.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(O),void b({track:Y,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",D),clearTimeout(O),void b({track:G.track,id:m})};this.peerConnection.addEventListener("track",D)})}),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(a),await Ye.all(n)}catch(n){throw new ve($.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(on().supportPCSetConfiguration){const n=eT.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},ft(wn.prototype,"connect",[po],Object.getOwnPropertyDescriptor(wn.prototype,"connect"),wn.prototype),ft(wn.prototype,"stopSending",[po],Object.getOwnPropertyDescriptor(wn.prototype,"stopSending"),wn.prototype),ft(wn.prototype,"receive",[po],Object.getOwnPropertyDescriptor(wn.prototype,"receive"),wn.prototype),ft(wn.prototype,"stopReceiving",[po],Object.getOwnPropertyDescriptor(wn.prototype,"stopReceiving"),wn.prototype),ft(wn.prototype,"muteRemote",[po],Object.getOwnPropertyDescriptor(wn.prototype,"muteRemote"),wn.prototype),ft(wn.prototype,"unmuteRemote",[po],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteRemote"),wn.prototype),ft(wn.prototype,"muteLocal",[po],Object.getOwnPropertyDescriptor(wn.prototype,"muteLocal"),wn.prototype),ft(wn.prototype,"unmuteLocal",[po],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteLocal"),wn.prototype),ft(wn.prototype,"close",[po],Object.getOwnPropertyDescriptor(wn.prototype,"close"),wn.prototype),ft(wn.prototype,"updateEncoderConfig",[po],Object.getOwnPropertyDescriptor(wn.prototype,"updateEncoderConfig"),wn.prototype),ft(wn.prototype,"updateSendParameters",[po],Object.getOwnPropertyDescriptor(wn.prototype,"updateSendParameters"),wn.prototype),ft(wn.prototype,"replaceTrack",[po],Object.getOwnPropertyDescriptor(wn.prototype,"replaceTrack"),wn.prototype),ft(wn.prototype,"getRemoteSSRC",[po],Object.getOwnPropertyDescriptor(wn.prototype,"getRemoteSSRC"),wn.prototype),wn);function po(e,t,n){const s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,l=await a.lock("Locking from P2PConnection.".concat(t));try{for(var f=arguments.length,m=new Array(f),_=0;_<f;_++)m[_]=arguments[_];return await s.apply(this,m)}finally{l()}},n}const d9={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new l9(n,t)}},u9={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!on().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(yR.has(e)||!e.track)return;const n={track:e.track};if(iu()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(f){return void k.error("create audio-encoded-streams error",f&&f.message)}const l=new TransformStream({transform(f,m){n.controller||(n.controller=m),e.track&&e.track.id!==n.track.id&&(k.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s));const _=t.metadata&&t.metadata();_?function(S,b){const{chunk:A,controller:O}=b,D=Z("ENABLE_AUDIO_PTS_METADATA")?cu.AUDIO_64_BIT_PTS:cu.METADATA;A.data=function(G,B,j){const Y=j.byteLength,q=Y+CO+qU,ie=RO+AO+q,le=new ArrayBuffer(G.byteLength+ie),ue=new DataView(le);ue.setUint8(0,YU),ue.setUint16(1,q),ue.setUint8(3,B),ue.setUint16(4,Y);for(let ye=0;ye<Y;ye++)ue.setUint8(6+ye,j[ye]);const oe=new Uint8Array(ue.buffer);return oe.set(new Uint8Array(G),ie),oe.buffer}(A.data,D,S),O.enqueue(A)}(_,{chunk:f,controller:m}):m.enqueue(f)}});a.readable.pipeThrough(l).pipeTo(a.writable)}else if(Cs()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const a=SR(),l=new MessageChannel;await new Ye(m=>a.onmessage=_=>{_.data==="registered"&&m(void 0)});const f=new RTCRtpScriptTransform(a,{name:"audio-metadata-tx",port:l.port2},[l.port2]);e.transform=f,await new Ye(m=>a.onmessage=_=>{_.data==="started"&&m(void 0)}),l.port1.onmessage=m=>{var _;if(m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==n.track.id)k.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s);else if(m.data.getMetadata){const S=t.metadata&&t.metadata();S&&l.port1.postMessage({metadata:S})}},n.worker=a}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}const a=yR.get(e);if(a){yR.delete(e);try{var l,f;(l=a.controller)===null||l===void 0||l.terminate(),(f=a.worker)===null||f===void 0||f.terminate()}catch(m){k.warning(m&&m.message)}}}yR.set(e,n),e.track.addEventListener("ended",s)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!on().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(CR.has(e))return;const n={track:e.track,onMetadata:t.onMetadata};if(iu()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");Fw(ln.CHROME,87,116)||(t.enableTopn=!1);let a=null;try{a=e.createEncodedStreams()}catch(f){return void k.error("create audio-encoded-streams error",f&&f.message)}const l=new TransformStream({transform(f,m){n.controller||(n.controller=m),e.track&&e.track.id!==n.track.id&&(k.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s)),t.enableTopn?function(_,S,b){var A;const O=$U(new DataView(S.data));if(!O)return b.enqueue(S);const D=_.track.id;Wq.set(D,_.track);const G=(A=O.tlv.find(le=>le.tag===cu.AUDIO_LEVEL))===null||A===void 0?void 0:A.value;let B=0;typeof G=="number"&&(B=127-G);const j=Math.round(Math.pow(10,B/60)-1),{selected:Y,speaker:q}=function(le,ue){let oe=QE.get(le);if(oe||(oe=function(ye){const Pe=new XU;return QE.set(ye,Pe),Xc||(Xc=new Hq(Z("TOPN_SILENCE_THRESHOLD")||500),Xc.on("ActiveSpeakerChanged",ze=>{ze!=null&&(bR=ze)})),Xc.addSpeakers([Pe]),Pe}(le)),QE.size<=JU)return{selected:!0,speaker:oe};if(!Xc)throw new Error("no active speaker detector");return Xc.levelChanged(oe.id,ue),am=Xc.loudest.map(ye=>ye.id),bR&&!We(am).call(am,bR)&&am.length>=JU&&am.pop(),{selected:We(am).call(am,oe.id)||oe.id===bR,speaker:oe}}(_,j),ie=function(le,ue,oe){const ye=Jc.get(le)||new Kq(le,ue);return ye.score=oe,Jc.set(le,ye),function(Pe){if(RR.set(Pe,!0),!AR)return void(AR=Date.now());const ze=Date.now();ze-AR>1e3&&(RR.get(Pe)?RR.set(Pe,!1):(QU(Pe),RR.delete(Pe)),AR=ze)}(le),ye}(D,_.track,q.energyScore);ie.addSample(Y),ie.active&&(S.data=O.frame.buffer,b.enqueue(S))}(e,f,m):t.enableMetadata?function(_,S,b){const A=$U(new DataView(_.data));if(!A)return S.enqueue(_);const O=A.tlv.find(D=>D.tag===cu.METADATA||D.tag===cu.AUDIO_64_BIT_PTS);O&&b&&O.value instanceof Uint8Array&&b(O.value),_.data=A.frame.buffer,S.enqueue(_)}(f,m,t.onMetadata):m.enqueue(f)}});a.readable.pipeThrough(l).pipeTo(a.writable)}else if(Cs()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const a=SR(),l=new MessageChannel;await new Ye(m=>a.onmessage=_=>{_.data==="registered"&&m(void 0)});const f=new RTCRtpScriptTransform(a,{name:"audio-metadata-rx",port:l.port2},[l.port2]);e.transform=f,await new Ye(m=>a.onmessage=_=>{_.data==="started"&&m(void 0)}),l.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==n.track.id?(k.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s)):m.data.metadata&&n.onMetadata&&n.onMetadata(m.data.metadata)},n.worker=a}function s(){e.track.removeEventListener("ended",s),function(a){const l=CR.get(a);if(l){(function(_){const S=QE.get(_);S&&(QE.delete(_),Xc&&(Xc.removeSpeakers([S]),QE.size===0&&(Xc.destroy(),Xc=null)))})(a),QU(a.track.id),CR.delete(a);try{var f,m;(f=l.controller)===null||f===void 0||f.terminate(),(m=l.worker)===null||m===void 0||m.terminate()}catch(_){k.warning(_&&_.message)}}}(e)}CR.set(e,n),e.track.addEventListener("ended",s)},interceptLocalVideoFrame:async function(e,t){if(!on().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(IR.has(e)||!e.track)return;const n={track:e.track};if(iu()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(m){return void k.error("create video-encoded-streams error",m&&m.message)}const l=[];t.on("sei-to-send",m=>{l.push(m)});const f=new TransformStream({transform(m,_){n.controller||(n.controller=_),e.track&&e.track.id!==n.track.id&&(k.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s));const S=l.shift();S&&(m.data=function(b,A){const O=function(q){const ie=q.length;let le=[],ue=0;for(;ue<ie;)ue+2<ie&&q[ue]===0&&q[ue+1]===0&&(q[ue+2]===0||q[ue+2]===1||q[ue+2]===2||q[ue+2]===3)?(le.push(q[ue],q[ue+1],3,q[ue+2]),ue+=3):(le.push(q[ue]),ue++);return new Uint8Array(le)}(A),D=O.length,G=Math.floor(D/255),B=D%255,j=new Uint8Array(6+G+1+D+b.byteLength);j[0]=0,j[1]=0,j[2]=0,j[3]=1,j[4]=6,j[5]=101;let Y=0;for(;Y<G;)j[6+Y]=255,Y++;return j[6+Y]=B,Y++,j.set(O,6+Y),j.set(new Uint8Array(b),6+Y+D),j.buffer}(m.data,S)),_.enqueue(m)}});a.readable.pipeThrough(f).pipeTo(a.writable)}else{if(!Cs())return;{if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const a=SR(),l=new MessageChannel;await new Ye(m=>a.onmessage=_=>{_.data==="registered"&&m(void 0)});const f=new RTCRtpScriptTransform(a,{name:"sei-tx",port:l.port2},[l.port2]);e.transform=f,await new Ye(m=>a.onmessage=_=>{_.data==="started"&&m(void 0)}),t.on("sei-to-send",m=>{l.port1.postMessage({sei:m})}),l.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==n.track.id&&(k.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s))},n.worker=a}}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}const a=IR.get(e);if(a){IR.delete(e);try{var l,f;(l=a.controller)===null||l===void 0||l.terminate(),(f=a.worker)===null||f===void 0||f.terminate()}catch(m){k.warning(m&&m.message)}}}IR.set(e,n),e.track.addEventListener("ended",s)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!on().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(!e.track)return;if(hy.has(e)){const a=hy.get(e);return void(a&&(a.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(iu()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(f){return void k.error("create video-encoded-streams error",f&&f.message)}const l=new TransformStream({transform(f,m){n.controller||(n.controller=m),e.track&&e.track.id!==n.track.id&&(k.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s));const _=function(S){const b=new DataView(S.data);let A=0;for(;A+4<S.data.byteLength;){if(b.getUint8(A+0)===0&&b.getUint8(A+1)===0&&b.getUint8(A+2)===0&&b.getUint8(A+3)===1&&b.getUint8(A+4)===6){let O=A+6,D=0,G=0;for(;(G=b.getUint8(O++))===255;)D+=255;D+=G;const B=Yq(S.data,O,D);return new Uint8Array(B)}A++}return null}(f);_&&n.onSei&&n.onSei(_),m.enqueue(f)}});a.readable.pipeThrough(l).pipeTo(a.writable)}else if(Cs()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const a=SR(),l=new MessageChannel;await new Ye(m=>a.onmessage=_=>{_.data==="registered"&&m(void 0)});const f=new RTCRtpScriptTransform(a,{name:"sei-rx",port:l.port2},[l.port2]);e.transform=f,await new Ye(m=>a.onmessage=_=>{_.data==="started"&&m(void 0)}),l.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==n.track.id?(k.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s)):m.data.sei&&n.onSei&&n.onSei(m.data.sei)},n.worker=a}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}(function(a){const l=hy.get(a);if(l){hy.delete(a);try{var f,m;(f=l.controller)===null||f===void 0||f.terminate(),(m=l.worker)===null||m===void 0||m.terminate()}catch(_){k.warning(_&&_.message)}}})(e)}hy.set(e,n),e.track.addEventListener("ended",s)}},h9={name:"InterceptFrame",create:()=>u9};iO(),vn("PROCESS_ID","process-".concat(Pn(8,""),"-").concat(Pn(4,""),"-").concat(Pn(4,""),"-").concat(Pn(4,""),"-").concat(Pn(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void k.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();k.debug("Loading global parameters from cache",t),Object.keys(t).forEach(s=>{if(Object.prototype.hasOwnProperty.call(Hn,s)){const{value:a,expires:l}=t[s];if(l&&l<=n)return;zc[s]=a,Hn[s]=a}})}catch(t){k.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(zc.AREAS)&&zc.AREAS.length>0&&$O(zc.AREAS,!0);const t3=(e,t,n)=>{k.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),vn(e,t,n)};Wh(k7,!1),Wh(F7,!1),Wh(Ez,!1),Wh(z7,!1),Wh(L7,!1),Wh(o9,!1),Wh(d9,!1),Wh(h9,!1);const Vi=function(e){const t=new ii,n=e,s={getListeners:t.getListeners.bind(t),on:(a,l)=>(function(f,m){f===Jl.SECURITY_POLICY_VIOLATION&&kV(m,!0)}(a,l),t.on.bind(t)(a,l)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return PV(PV({},n),s)}({__TRACK_LIST__:GE,VERSION:ao,BUILD:aO,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:t3,getParameter:Z,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(s){let a;return on().supportUnifiedPlan?(s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"}),a=(await s.createOffer()).sdp):a=(await s.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,a}(t);if(!n)return e;t.close(),t=null,e=function(s){const a={video:[],audio:[]};return s.match(/ VP8/i)&&a.video.push("VP8"),s.match(/ VP9/i)&&a.video.push("VP9"),s.match(/ AV1/i)&&a.video.push("AV1"),s.match(/ H264/i)&&a.video.push("H264"),s.match(/ H265/i)&&a.video.push("H265"),s.match(/ opus/i)&&a.audio.push("OPUS"),s.match(/ PCMU/i)&&a.audio.push("PCMU"),s.match(/ PCMA/i)&&a.audio.push("PCMA"),s.match(/ G722/i)&&a.audio.push("G722"),a}(n)}catch(t){throw new Ee($.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=gt.reportApiInvoke(null,{name:Fi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:li.TRACER});let t=!1;try{const l=window.RTCPeerConnection,f=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;t=!!(l&&f&&m),t&&Gw()&&nM(75)&&new l().close()}catch(l){return k.error("check system requirement failed: ",l),!1}let n=!1;const s=nn();s.name===ln.CHROME&&Number(s.version)>=58&&(qc.engine.name!=="WebKit"||function(){const l=nn();if(nR()){if(l.os===Qi.MAC_OS)return!0;if(l.os===Qi.IOS){const f=qc.os.version&&qc.os.version.split(".");if(f&&Number(f[0])===14&&f[1]&&Number(f[1])>=3||f&&Number(f[0])>14)return!0}}return!1}())&&(n=!0),(s.name===ln.FIREFOX&&Number(s.version)>=56||s.name===ln.OPERA&&Number(s.version)>=45||s.name===ln.SAFARI&&Number(s.version)>=11||s.name==="WebKit"&&(_r()||Xo())&&s.osVersion&&Number(s.osVersion.split(".")[0])>=11||cM()||nn().name===ln.QQ)&&(n=!0),k.debug("checkSystemRequirements, api:",t,"browser",n);const a=t&&n;return e.onSuccess(a),a},getDevices:function(e){return Ba.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Ba.getRecordingDevices(e)},getCameras:function(e){return Ba.getCamerasDevices(e)},getElectronScreenSources:n2,getPlaybackDevices:function(e){return Ba.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Pn(5,"client-"),s=gt.reportApiInvoke(null,{id:n,name:Fi.CREATE_CLIENT,options:[t],tag:li.TRACER});try{(function(a){zi(a.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),zi(a.mode,"config.mode",["rtc","live","p2p"]),a.audioCodec!==void 0&&zi(a.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),a.proxyServer!==void 0&&ms(a.proxyServer,"config.proxyServer",1,1e4),a.turnServer!==void 0&&gM(a.turnServer),a.httpRetryConfig!==void 0&&mM(a.httpRetryConfig),a.websocketRetryConfig!==void 0&&mM(a.websocketRetryConfig)})(t)}catch(a){throw s.onError(a),a}return(sM(16,0)||rM(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",k.debug("browser not support vp9, force use vp8")),vn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),s.onSuccess(),new _z(sc(sc({forceWaitGatewayResponse:!0},t),{},{role:We(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Z("CAMERA_CAPTURE_CONFIG"),n=Pn(8,"track-cam-"),s=gt.reportApiInvoke(null,{id:n,tag:li.TRACER,name:Fi.CREATE_CAM_VIDEO_TRACK,options:[Jn({},e),t]});t&&(e.encoderConfig=t);const a=ER(e);let l=null;k.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{l=(await Fa({video:a},n)).getVideoTracks()[0]||null}catch(m){throw s.onError(m),m}if(!l){const m=new ve($.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(m),m.throw(k)}e.optimizationMode&&bO(n,l,e,$l(e.encoderConfig));const f=new vO(l,e,a,e.scalabiltyMode?fR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return s.onSuccess(f.getTrackId()),k.info("create camera video success, trackId:",n),f},createCustomVideoTrack:function(e){const t=Pn(8,"track-cus-"),n=gt.reportApiInvoke(null,{id:t,tag:li.TRACER,name:Fi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),s=new Kn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?fR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[kn.CUSTOM_TRACK]);return n.onSuccess(s.getTrackId()),k.info("create custom video track success with config",e,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(O){return h2(O)}(t):void 0;n&&(t="auto");const s=Pn(8,"track-scr-v-"),a=gt.reportApiInvoke(null,{id:s,tag:li.TRACER,name:Fi.CREATE_SCREEN_VIDEO_TRACK,options:[Jn({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const l=function(O){const D={};O.screenSourceType&&(D.mediaSource=O.screenSourceType),O.extensionId&&iu()&&(D.extensionId=O.extensionId);const{displaySurface:G,selfBrowserSurface:B,surfaceSwitching:j,systemAudio:Y,preferCurrentTab:q}=O;(ty(107)||Bw(107)||Vw(93))&&(G&&(zi(G,"displaySurface",["browser","window","monitor"]),D.displaySurface=G),B?(zi(B,"selfBrowserSurface",["exclude","include"]),D.selfBrowserSurface=B):D.selfBrowserSurface="include",j&&(zi(j,"surfaceSwitching",["exclude","include"]),D.surfaceSwitching=j)),(ty(105)||Bw(105)||Vw(91))&&Y&&(zi(Y,"systemAudio",["exclude","include"]),D.systemAudio=Y),(ty(94)||Bw(94)||Vw(80))&&q&&(D.preferCurrentTab=!0),O.electronScreenSourceId&&(D.sourceId=O.electronScreenSourceId);const ie=O.encoderConfig?uO(O.encoderConfig):null;return D.mandatory={chromeMediaSource:"desktop",maxWidth:ie?ie.width:void 0,maxHeight:ie?ie.height:void 0},ie&&(ie.frameRate&&(typeof ie.frameRate=="number"?(D.mandatory.maxFrameRate=ie.frameRate,D.mandatory.minFrameRate=ie.frameRate):(D.mandatory.maxFrameRate=ie.frameRate.max||ie.frameRate.ideal||ie.frameRate.exact||void 0,D.mandatory.minFrameRate=ie.frameRate.min||ie.frameRate.ideal||ie.frameRate.exact||void 0),D.frameRate=ie.frameRate),ie.width&&(D.width=ie.width),ie.height&&(D.height=ie.height)),D}(e);let f=null,m=null;const _=on();if(!_.supportShareAudio&&t==="enable"){const O=new ve($.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return a.onError(O),O.throw(k)}k.info("start create screen video track with config",e,"withAudio",t,"trackId",s);const S=_.supportShareAudio&&t!=="disable";try{const O=await Fa({screen:l,screenAudio:S?n||!0:void 0},s);f=O.getVideoTracks()[0]||null,m=O.getAudioTracks()[0]||null}catch(O){throw a.onError(O),O}if(!f){const O=new ve($.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(O),O.throw(k)}if(!m&&t==="enable"){f&&f.stop();const O=new ve($.SHARE_AUDIO_NOT_ALLOWED);return a.onError(O),O.throw(k)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(bO(s,f,e,e.encoderConfig&&uO(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const b=new Kn(f,e.encoderConfig?uO(e.encoderConfig):{},e.scalabiltyMode?fR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s,[kn.SCREEN_TRACK]);if(!m)return a.onSuccess(b.getTrackId()),k.info("create screen video track success","video:",b.getTrackId()),b;const A=new fi(m,void 0,Pn(8,"track-scr-a-"),!1);return a.onSuccess([b.getTrackId(),A.getTrackId()]),k.info("create screen video track success","video:",b.getTrackId(),"audio:",A.getTrackId()),[b,A]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=Z("CAMERA_CAPTURE_CONFIG"),s=Pn(8,"track-mic-"),a=Pn(8,"track-cam-"),l=gt.reportApiInvoke(null,{id:"".concat(s,"-").concat(a),tag:li.TRACER,name:Fi.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const f=ER(t),m=f2(e);let _=null,S=null;k.info("start create camera video track(".concat(a,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const O=await Fa({audio:m,video:f},"".concat(s,"-").concat(a));_=O.getAudioTracks()[0],S=O.getVideoTracks()[0]}catch(O){throw l.onError(O),O}if(!_||!S){const O=new ve($.UNEXPECTED_ERROR,"can not find tracks in media stream");return l.onError(O),O.throw(k)}t.optimizationMode&&bO(a,S,t,$l(t.encoderConfig));const b=new _R(_,e,m,s),A=new vO(S,t,f,t.scalabiltyMode?fR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a);return l.onSuccess([b.getTrackId(),A.getTrackId()]),k.info("create camera video track(".concat(a,") and microphone audio track(").concat(s,") success")),[b,A]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Pn(8,"track-mic-"),n=gt.reportApiInvoke(null,{id:t,tag:li.TRACER,name:Fi.CREATE_MIC_AUDIO_TRACK,options:[e]}),s=f2(e);let a=null;k.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{a=(await Fa({audio:s},t)).getAudioTracks()[0]||null}catch(f){throw n.onError(f),f}if(!a){const f=new ve($.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(f),f.throw(k)}const l=new _R(a,e,s,t);return n.onSuccess(l.getTrackId()),k.info("create microphone audio track success, trackId:",t),l},createCustomAudioTrack:function(e){const t=Pn(8,"track-cus-"),n=gt.reportApiInvoke(null,{id:t,tag:li.TRACER,name:Fi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),s=new fi(e.mediaStreamTrack,e.encoderConfig?pR(e.encoderConfig):{},t,!1);return k.info("create custom audio track success with config",e,"trackId",s.getTrackId()),n.onSuccess(s.getTrackId()),s},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:s}=e;let{source:a}=e;const l={source:a instanceof AudioBuffer?"AudioBuffer":a instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":a,cacheOnlineFile:n,encoderConfig:s},f=Pn(8,"track-buf-"),m=gt.reportApiInvoke(null,{id:f,tag:li.TRACER,name:Fi.CREATE_BUFFER_AUDIO_TRACK,options:[l]});if(Z("DISABLE_WEBAUDIO"))throw new ve($.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");k.info("start create buffer source audio track with config",JSON.stringify(l),"trackId",f);const _=a;if(!(a instanceof AudioBuffer))try{a=await async function(A,O){let D=null;if(typeof A=="string"){const B=Z2.get(A);if(B)return k.debug("use cached audio resource: ",A),B;try{D=(await $c(()=>Lr.get(A,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new ve($.FETCH_AUDIO_FILE_FAILED,j.toString())}}else D=await new Ye((j,Y)=>{const q=new FileReader;q.onload=ie=>{ie.target?j(ie.target.result):Y(new ve($.READ_LOCAL_AUDIO_FILE_ERROR))},q.onerror=()=>{Y(new ve($.READ_LOCAL_AUDIO_FILE_ERROR))},q.readAsArrayBuffer(A)});const G=await function(B){const j=$E();return new Ye((Y,q)=>{j.decodeAudioData(B,ie=>{Y(ie)},ie=>{q(new ve($.DECODE_AUDIO_FILE_FAILED,ie.toString()))})})}(D);return typeof A=="string"&&O&&Z2.set(A,G),G}(a,n)}catch(A){return m.onError(A),A.throw(k)}const S=new Fq(a),b=new Uq(_,S,s?pR(s):{},f);return k.info("create buffer source audio track success, trackId:",f),m.onSuccess(b.getTrackId()),b},setAppType:function(e){if(k.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw k.debug("Invalid appType"),new Ee($.INVALID_PARAMS,"invalid app type",e);vn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){k.setLogLevel(e)},enableLogUpload:function(){Z("USE_NEW_LOG")?vn("UPLOAD_LOG",!0):k.enableLogUpload()},disableLogUpload:function(){Z("USE_NEW_LOG")?vn("UPLOAD_LOG",!1):k.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new ZF},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=gt.reportApiInvoke(null,{tag:li.TRACER,name:Fi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof fi||e instanceof JE)){const _=new Ee($.INVALID_TRACK,"the parameter is not a audio track");return n.onError(_),_.throw()}t&&t<1e3&&(t=1e3);const s=e instanceof fi?e.getTrackLabel():"remote_track",a=e.getVolumeLevel();let l=a,f=a;const m=Date.now();return new Ye(_=>{const S=setInterval(()=>{const b=e.getVolumeLevel();l=b>l?b:l,f=b<f?b:f;const A=l-f>1e-4,O=Date.now()-m;if(A||O>t){clearInterval(S);const D=A,G={duration:O,deviceLabel:s,maxVolumeLevel:l,result:D};k.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),n.onSuccess(G),_(D)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=gt.reportApiInvoke(null,{tag:li.TRACER,name:Fi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Kn||e instanceof XE)){const A=new Ee($.INVALID_TRACK,"the parameter is not a video track");return n.onError(A),A.throw()}t&&t<1e3&&(t=1e3);const s=e instanceof Kn?e.getTrackLabel():"remote_track",a=e.getMediaStreamTrack(!0),l=document.createElement("video");l.style.width="1px",l.style.height="1px",l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.controls=!1,(Cs()||nR())&&(l.style.opacity="0.01",l.style.position="fixed",l.style.left="0",l.style.top="0",document.body.appendChild(l)),l.srcObject=new MediaStream([a]),l.play();const f=document.createElement("canvas");f.width=160,f.height=120;let m=0,_=0;try{const A=Date.now();m=await function(O,D,G,B){let j,Y=0,q=null;return new Ye((ie,le)=>{function ue(){Y>B&&j&&(j(),ie(Y));const oe=G.getContext("2d");if(!oe){const ze=new Ee($.UNEXPECTED_ERROR,"can not get canvas 2d context.");return k.error(ze.toString()),void le(ze)}oe.drawImage(O,0,0,160,120);const ye=oe.getImageData(0,0,G.width,G.height),Pe=Math.floor(ye.data.length/3);if(q){for(let ze=0;ze<Pe;ze+=3)if(ye.data[ze]!==q[ze])return Y+=1,void(q=ye.data);q=ye.data}else q=ye.data}setTimeout(()=>{j&&(j(),ie(Y))},D),j=gO(()=>{ue()},30)})}(l,t,f,4),_=Date.now()-A}catch(A){throw n.onError(A),A}iz===ln.SAFARI&&(l.pause(),l.remove()),l.srcObject=null;const S=m>4,b={duration:_,changedPicNum:m,deviceLabel:s,result:S};return k.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(b))),n.onSuccess(b),S},setArea:$O,audioElementPlayCenter:xr,resumeAudioContext:function(){xr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){yz.processExternalMediaAEC(e)},registerExtensions:function(e){const t=Z("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!We(t).call(t,n.name)&&t.push(n.name);const s=n;s.__registered__=!0,s.logger.hookLog=k.extLog,s.reporter.hookApiInvoke=gt.extApiInvoke,s.parameters&&Object.keys(s.parameters).forEach(a=>{s.parameters[a]=Z(a)})}),t3("PLUGIN_INFO",t)},ChannelMediaRelayError:e_,ChannelMediaRelayEvent:du,ChannelMediaRelayState:qr,RemoteStreamFallbackType:Dq,RemoteStreamType:Oq,ConnectionDisconnectedReason:pn,AudienceLatencyLevelType:aq,AREAS:dn,preload:async function(e,t,n,s){return CB(e,t,n,s)}});return Object.defineProperties(Vi,{onAudioAutoplayFailed:{get:()=>Va.onAudioAutoplayFailed,set:e=>{Va.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Va.onAutoplayFailed,set:e=>{Va.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Vi._onSecurityPolicyViolation,set(e){Vi._onSecurityPolicyViolation=e,kV(e)}},__CLIENT_LIST__:{get:()=>Z("SHOW_GLOBAL_CLIENT_LIST")?om:[]}}),Ba.on(im.CAMERA_DEVICE_CHANGED,e=>{k.info("camera device changed",JSON.stringify(e)),Vi.onCameraChanged&&Vi.onCameraChanged(e),Vi.safeEmit(Jl.CAMERA_CHANGED,e)}),Ba.on(im.RECORDING_DEVICE_CHANGED,e=>{k.info("microphone device changed",JSON.stringify(e)),Vi.onMicrophoneChanged&&Vi.onMicrophoneChanged(e),Vi.safeEmit(Jl.MICROPHONE_CHANGED,e)}),Ba.on(im.PLAYOUT_DEVICE_CHANGED,e=>{k.debug("playout device changed",JSON.stringify(e)),Vi.onPlaybackDeviceChanged&&Vi.onPlaybackDeviceChanged(e),Vi.safeEmit(Jl.PLAYBACK_DEVICE_CHANGED,e)}),xr.onAutoplayFailed=()=>{k.info("detect audio element autoplay failed"),Va.onAudioAutoplayFailed&&Va.onAudioAutoplayFailed()},bn.on("autoplay-failed",()=>{k.info("detect webaudio autoplay failed"),Va.onAudioAutoplayFailed&&Va.onAudioAutoplayFailed(),Vi.safeEmit(Jl.AUTOPLAY_FAILED)}),bn.on(_s.STATE_CHANGE,(e,t)=>{k.info("audio context state changed: ".concat(t," => ").concat(e)),Vi.onAudioContextStateChanged&&Vi.onAudioContextStateChanged(e,t),Vi.safeEmit(Jl.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Di.on(ME.NETWORK_STATE_CHANGE,(e,t)=>{k.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Vi),Vi})}(YA)),YA.exports}var IZ=CZ();const S_=tL(IZ),wZ="/assets/startsession-CbHxBiR0.webp",Qy="https://api.skaivoice.live/v1/call";function OZ(){const[h,i]=fe.useState("0 min 0 sec"),r=fe.useRef(null),o=fe.useRef(1),d=fe.useRef({}),p=()=>{r.current=Date.now(),console.log("Call started")},g=async()=>{if(r.current){const yt=Date.now()-r.current,Ot=Math.floor(yt/1e3),Tt=Math.floor(Ot/60),Xt=Ot%60;await Ws(Tt,Xt);const zn=`${Tt} min ${Xt} sec`;return i(zn),r.current=null,zn}return"0 min 0 sec"},[y,v]=fe.useState(!1),[T,C]=fe.useState(!1),[I,L]=fe.useState([]),[N]=fe.useState("Team Meeting"),[x,K]=fe.useState(null),[H,Q]=fe.useState(""),[ne,ee]=fe.useState(!1),[pe,de]=fe.useState(""),[be,Se]=fe.useState(localStorage.getItem("admin_name")||"Admin"),[Te,_e]=fe.useState(localStorage.getItem("admin_id")||""),[he,Ge]=fe.useState(null),[st,It]=fe.useState(""),[qe,ut]=fe.useState(""),[Oe,Qe]=fe.useState(""),Ke=fe.useRef(null),Re=fe.useRef([]),se=fe.useRef(!1),we=async()=>{try{console.log("Checking for audio devices...");const lt=await S_.getMicrophones();Re.current=lt;const yt=lt.find(Tt=>Tt.label.toLowerCase().includes("bluetooth")||Tt.label.toLowerCase().includes("airpods")||Tt.label.toLowerCase().includes("headset")),Ot=se.current;if(se.current=!!yt,yt&&yt.deviceId!==Oe)console.log(`Bluetooth device found: ${yt.label}`),Qe(yt.deviceId),y&&Et.current&&(console.log("Switching to bluetooth device during active session"),await He(yt.deviceId));else if(Ot&&!yt&&lt.length>0){console.log("Bluetooth disconnected, falling back to default microphone");const Tt=lt[0];Qe(Tt.deviceId),y&&Et.current&&(console.log(`Switching to default device: ${Tt.label}`),await He(Tt.deviceId))}else!yt&&lt.length>0&&!Oe&&(console.log(`Setting default device: ${lt[0].label}`),Qe(lt[0].deviceId))}catch(lt){console.error("Error getting audio devices:",lt)}},He=async lt=>{if(!(!y||!Et.current))try{const yt=Re.current;if(!yt.some(Tt=>Tt.deviceId===lt))if(console.warn(`Device ${lt} no longer exists, using default device`),yt.length>0)lt=yt[0].deviceId;else{console.error("No audio devices available");return}Et.current.stop(),Et.current.close(),Et.current=await S_.createMicrophoneAudioTrack({microphoneId:lt}),T&&await Et.current.setMuted(!0),await Be.current.publish([Et.current]),console.log(`Successfully switched to microphone: ${lt}`)}catch(yt){console.error("Error switching microphone:",yt);try{const Ot=await S_.getMicrophones();Ot.length>0&&(console.log("Attempting recovery with first available device"),Et.current=await S_.createMicrophoneAudioTrack({microphoneId:Ot[0].deviceId}),T&&await Et.current.setMuted(!0),await Be.current.publish([Et.current]),Qe(Ot[0].deviceId))}catch(Ot){console.error("Failed to recover microphone:",Ot),de("Microphone error. Please rejoin the session.")}}};fe.useEffect(()=>{we();const lt=y?2e3:5e3;return Ke.current=setInterval(we,lt),navigator.mediaDevices.addEventListener("devicechange",ct),()=>{clearInterval(Ke.current),navigator.mediaDevices.removeEventListener("devicechange",ct)}},[y,Oe]);const ct=async()=>{console.log("Device change event detected"),setTimeout(we,500)};fe.useEffect(()=>{const lt=localStorage.getItem("channel_name")||"",yt=localStorage.getItem("app_certificate")||"",Ot=localStorage.getItem("app_id");K(Ot),Ot||(console.error("App ID is missing in localStorage"),de("Agora App ID is missing. Please check your configuration."));const Tt=localStorage.getItem("admin_id")||"",Xt=localStorage.getItem("admin_name")||"Admin";Se(Xt),_e(Tt),It(lt),ut(yt)},[]);const Be=fe.useRef(null),Et=fe.useRef(null),St=fe.useRef(null),it=fe.useRef({}),Ze=fe.useRef({});fe.useEffect(()=>(Be.current=S_.createClient({mode:"rtc",codec:"vp8"}),Be.current.on("user-published",bt),Be.current.on("user-left",Ft),Be.current.on("user-info-updated",mt),()=>{jt(),Be.current.off("user-published",bt),Be.current.off("user-left",Ft),Be.current.off("user-info-updated",mt)}),[]),fe.useEffect(()=>{if(y)return Be.current.enableAudioVolumeIndicator(),console.log("Audio volume indicator enabled."),Be.current.on("volume-indicator",lt=>{console.log("Volume indicator event:",lt);const yt=50;lt.forEach(({uid:Ot,level:Tt})=>{console.log(`User ${Ot} level: ${Tt} - speaking: ${Tt>yt}`),L(Xt=>Xt.map(zn=>zn.uid===Ot?{...zn,isSpeaking:Tt>yt}:zn))})}),()=>{Be.current.off("volume-indicator")}},[y]),fe.useEffect(()=>{if(!y)return;const lt=setInterval(async()=>{try{(await Wi.get(`${Qy}/meetings/check-participant-status/${st}/${St.current}`)).data.kicked&&(alert("You have been removed from the meeting by the admin."),jt())}catch(yt){console.error("Error checking participant status:",yt)}},4e3);return()=>clearInterval(lt)},[y,st]);const mt=(lt,yt)=>{console.log("User info updated:",lt,yt),yt.userName&&(Ze.current[lt]=yt.userName,L(Ot=>Ot.map(Tt=>Tt.uid===lt?{...Tt,name:yt.userName}:Tt)))},bt=async(lt,yt)=>{if(console.log("User published:",lt),await Be.current.subscribe(lt,yt),yt==="audio"){lt.audioTrack.play(),it.current[lt.uid]={audioTrack:lt.audioTrack,enabled:!0};const Ot=Ze.current[lt.uid]||`User ${lt.uid}`;d.current[lt.uid]={joinTime:new Date,totalTime:0},o.current=Object.keys(d.current).length,console.log(`Participant count increased to: ${o.current}`),L(Tt=>Tt.some(Xt=>Xt.uid===lt.uid)?Tt:[...Tt,{uid:lt.uid,name:Ot,isSpeaking:!1,isMuted:!1}]),gn(lt.uid)}},gn=async lt=>{try{const yt=await Wi.get(`${Qy}/meetings/user-info${st}/${lt}`);yt.data&&yt.data.userName&&(Ze.current[lt]=yt.data.userName,L(Ot=>Ot.map(Tt=>Tt.uid===lt?{...Tt,name:yt.data.userName}:Tt)))}catch(yt){console.error("Error fetching user metadata:",yt)}},Ft=lt=>{if(console.log("User left:",lt),d.current[lt.uid]){const yt=d.current[lt.uid].joinTime,Xt=(new Date-yt)/(1e3*60);console.log(`User ${lt.uid} participated for ${Xt.toFixed(2)} minutes`),delete d.current[lt.uid],o.current=Object.keys(d.current).length,console.log(`Participant count decreased to: ${o.current}`)}it.current[lt.uid]&&delete it.current[lt.uid],L(yt=>yt.filter(Ot=>Ot.uid!==lt.uid))},ei=()=>{if(!he)return 0;const lt=new Date;Object.keys(d.current).forEach(Ot=>{const Tt=d.current[Ot].joinTime,Xt=(lt-Tt)/(1e3*60);d.current[Ot].totalTime=Xt});let yt=0;return Object.values(d.current).forEach(Ot=>{yt+=Ot.totalTime}),console.log(`Total billable minutes: ${yt.toFixed(2)}`),yt},ri=async()=>{var lt,yt;if(ee(!0),de(""),!x){de("Agora App ID is missing. Please check your configuration."),ee(!1);return}try{await we(),!Oe&&Re.current.length>0&&Qe(Re.current[0].deviceId);const Ot=await Wi.post(`${Qy}/meetings/create`,{meetingName:N,adminName:`${be}`,id:localStorage.getItem("adminid")||Te}),{channelName:Tt,token:Xt,adminUid:zn}=Ot.data;Q(st||Tt),St.current=zn,await Be.current.join(x,Tt||st,Xt,zn),Ze.current[zn]=be,d.current[zn]={joinTime:new Date,totalTime:0},o.current=1,Et.current=await S_.createMicrophoneAudioTrack({microphoneId:Oe}),await Be.current.publish([Et.current]),L([{uid:zn,name:`${be}`,isLocal:!0,isAdmin:!0,isSpeaking:!1,isMuted:!1}]),Ge(new Date),v(!0),console.log("Session started successfully with device:",Oe),p()}catch(Ot){console.error("Error starting session:",Ot),de(((yt=(lt=Ot.response)==null?void 0:lt.data)==null?void 0:yt.error)||Ot.message||"Failed to start session")}finally{ee(!1)}};fe.useEffect(()=>{const lt=localStorage.getItem("app_id");localStorage.getItem("agora_token"),localStorage.getItem("channel_name");const yt=new URLSearchParams(window.location.search),Ot=yt.get("triggerSession")==="true";if(!lt){de("Agora App ID is missing. Please check your configuration.");return}if(Ot){yt.delete("triggerSession");const Tt=window.location.pathname+"?"+yt.toString();window.history.replaceState({},"",Tt),ri()}},[]);const Ws=async(lt,yt)=>{console.log("Time call",lt,"sec",yt);try{const Tt=new Date().toISOString().split("T")[0],Xt=ei(),zn={name:be||"Unknown User",date:Tt,calltime:`min=${lt}, sec=${yt}`,userid:Te,billableMinutes:Xt.toFixed(2),maxParticipants:Math.max(o.current,Object.keys(d.current).length)};console.log("Saving call history:",zn),await Wi.post("https://api.skaivoice.live/v1/superadmin/savehistory",zn),console.log("Call history saved successfully")}catch(Ot){console.error("Error saving call history:",Ot)}},jt=async()=>{console.log("Cleaning up session...");try{if(y&&he){const Ot=(new Date-he)/(1e3*60);console.log("durationMinutes",Ot);const Tt=ei();console.log(`Final billable minutes: ${Tt.toFixed(2)}`),g()}await Wi.post(`${Qy}/meetings/update`,{isActive:!1,channelName:st}),console.log("Meeting ended on server."),Et.current&&(Et.current.stop(),Et.current.close(),Et.current=null),Be.current&&y&&await Be.current.leave(),v(!1),L([]),it.current={},Ze.current={},d.current={},o.current=0}catch(lt){console.error("Error ending meeting:",lt)}},$n=async()=>{Et.current&&(await Et.current.setMuted(!T),C(!T),L(lt=>lt.map(yt=>yt.isLocal?{...yt,isMuted:!T}:yt)))},Wn=lt=>{var Xt;const yt=I.find(zn=>zn.uid===lt);if(!yt)return;const Ot=!yt.isMuted;L(zn=>zn.map(hs=>hs.uid===lt?{...hs,isMuted:Ot}:hs));const Tt=(Xt=it.current[lt])==null?void 0:Xt.audioTrack;Tt&&(Ot?Tt.stop():Tt.play(),it.current[lt].enabled=!Ot)},yi=async lt=>{var yt;try{if(!(((yt=I.find(Tt=>Tt.isLocal))==null?void 0:yt.isAdmin)===!0)){console.error("Only admin can kick participants");return}await Wi.post(`${Qy}/meetings/kick-participant`,{channelName:st,participantUid:lt,adminUid:St.current,app_certificateis:qe}),L(Tt=>Tt.filter(Xt=>Xt.uid!==lt)),it.current[lt]&&delete it.current[lt],Ze.current[lt]&&delete Ze.current[lt],console.log(`Participant ${lt} has been kicked`)}catch(Ot){console.error("Error kicking participant:",Ot)}};return console.log(h,"call time"),M.jsxs(M.Fragment,{children:[!y&&M.jsx(gL,{}),y&&M.jsx("div",{className:"px-10 flex space-x-4 w-full justify-end mt-5",children:M.jsx("button",{className:"bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-lg font-bold transform transition-all duration-300 hover:scale-105 shadow-md",onClick:()=>{console.log("Ending session..."),jt()},children:"End Session"})}),M.jsxs("div",{className:"w-full md:w-[95%] h-[80vh] mx-auto mt-2 mb-2 bg-white rounded-xl overflow-hidden transition-all duration-300 shadow-2xl flex flex-col",children:[y?M.jsx("div",{className:"flex-1 flex flex-col p-8 bg-blue-300",children:M.jsx("div",{className:"grid grid-cols-5  overflow-x-auto gap-5 justify-center",children:I.filter(lt=>!lt.isLocal).map(lt=>{var yt;return M.jsx("div",{className:`bg-white rounded-3xl shadow-lg p-6 w-50 transition-all duration-300 hover:shadow-xl border border-blue-100 ${lt.isSpeaking?"blink":""}`,children:M.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[M.jsx("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center",children:M.jsx("span",{className:"text-3xl font-bold text-blue-500",children:(lt==null?void 0:lt.name)||"?"})}),M.jsx("div",{className:"text-center",children:M.jsxs("div",{className:"flex items-center space-x-4 mt-4",children:[M.jsx("button",{onClick:()=>Wn(lt.uid),className:`text-white py-2 px-4 rounded ${lt.isMuted?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"}`,children:lt.isMuted?M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-mic-off",children:[M.jsx("line",{x1:"2",x2:"22",y1:"2",y2:"22"}),M.jsx("path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2"}),M.jsx("path",{d:"M5 10v2a7 7 0 0 0 12 5"}),M.jsx("path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33"}),M.jsx("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12"}),M.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]}):M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-mic",children:[M.jsx("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),M.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),M.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})}),((yt=I.find(Ot=>Ot.isLocal))==null?void 0:yt.isAdmin)&&M.jsx("button",{onClick:()=>yi(lt.uid),className:"bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded",title:"Kick participant from the session",children:M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-x-icon lucide-x",children:[M.jsx("path",{d:"M18 6 6 18"}),M.jsx("path",{d:"m6 6 12 12"})]})})]})}),M.jsxs("div",{className:"flex items-center space-x-2 w-full justify-center",children:[M.jsx("div",{className:`w-4 h-4 rounded-full ${lt.isMuted?"bg-red-500":"bg-green-500"}`}),M.jsx("span",{className:"text-sm text-gray-500",children:lt.isMuted?"Muted":"Active"})]})]})},lt.uid)})})}):M.jsxs(M.Fragment,{children:[M.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:M.jsx("div",{className:"relative w-full h-64 overflow-hidden",children:M.jsx("img",{src:wZ,alt:"Session",className:"w-full h-full object-contain animate-zoomInOut"})})}),M.jsxs("div",{className:"p-6 text-center border-t border-blue-50",children:[M.jsx("button",{onClick:ri,className:"bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg font-bold transform transition-all duration-300 hover:scale-105 shadow-md",disabled:ne,children:ne?"Starting...":"Start Session"}),pe&&M.jsx("p",{className:"text-red-500 mt-2",children:pe})]})]}),M.jsx("style",{jsx:!0,children:`
          @keyframes zoomInOut {
            0%,
            100% {
              transform: scale(1);
            }
            50% {
              transform: scale(1.1);
            }
          }
          .animate-zoomInOut {
            animation: zoomInOut 8s ease-in-out infinite;
          }
          .blink {
            position: relative;
            border: 4px solid #006400; /* Dark green */
            border-radius: 24px;
            padding: 20px;
            background: white;
            animation: borderBlink 1.5s infinite ease-in-out;
            transition: all 0.3s ease;
          }

          @keyframes borderBlink {
            0% {
              box-shadow: 0 0 0px #006400;
            }
            50% {
              box-shadow: 0 0 10px 4px #228b22; /* subtle glow */
            }
            100% {
              box-shadow: 0 0 0px #006400;
            }
          }
        `})]}),y&&M.jsx("div",{className:"flex space-x-4 w-full justify-center",children:M.jsx("button",{onClick:$n,className:`p-3 rounded-full ${T?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600"} transition-colors duration-200`,children:T?M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-mic-off",children:[M.jsx("line",{x1:"2",x2:"22",y1:"2",y2:"22"}),M.jsx("path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2"}),M.jsx("path",{d:"M5 10v2a7 7 0 0 0 12 5"}),M.jsx("path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33"}),M.jsx("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12"}),M.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]}):M.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-mic",children:[M.jsx("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),M.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),M.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})})})]})}function DZ(){const[h,i]=fe.useState(!1);return console.log("modalOpen",h),M.jsx(M.Fragment,{children:M.jsx(OZ,{})})}function NZ(){Pm();const{listTeamUsers:h,deleteuser:i,updateTeamUser:r}=mL(),[o,d]=fe.useState(!1),[p,g]=fe.useState(!1),[y,v]=fe.useState(""),[T,C]=fe.useState(1),I=10,[L,N]=fe.useState(0),[x,K]=fe.useState(!1),[H,Q]=fe.useState(!1),[ne,ee]=fe.useState(!1),[pe,de]=fe.useState([]),[be,Se]=fe.useState(),[Te,_e]=fe.useState(""),[he,Ge]=fe.useState(),[st,It]=fe.useState(!1);console.log(pe,"user"),fe.useEffect(()=>{_e(localStorage.getItem("admin_id"))},[T]),fe.useEffect(()=>{qe()},[T,Te]);const qe=async()=>{console.log("Logadminid",Te);try{const Ze=I,mt=(T-1)*I,bt=await h(Te,Ze,mt);de(bt),console.log("response",bt.length),localStorage.setItem("totaluser",bt.length),bt.totalCount&&N(bt.totalCount),console.log(bt)}catch(Ze){console.log(Ze)}},ut=pe.filter(Ze=>Ze.name.toLowerCase().includes(y.toLowerCase())||Ze.username.toLowerCase().includes(y.toLowerCase())),Oe=Math.ceil(ut.length/I),Qe=T*I,Ke=Qe-I,Re=ut.slice(Ke,Qe),[se,we]=fe.useState({name:"",mobilenumber:"",username:"",tokenid:"",Channelid:"",password:"",confirmPassword:""}),He=Ze=>{we({...se,[Ze.target.name]:Ze.target.value})};fe.useEffect(()=>{be&&we({name:be.name||"",mobilenumber:be.mobilenumber||"",username:be.username||"",tokenid:be.tokenid,Channelid:be.Channelid,password:be.password,confirmPassword:be.password})},[be]);const ct=async()=>{const Ze=await i(be.id);console.log("Delete response:",Ze),qe(),K(!1)};console.log("selecteduser",be);const Be=async Ze=>{if(Ze.preventDefault(),console.log("selecteduser",be),console.log("formData",se.password),(se==null?void 0:se.password)!==(se==null?void 0:se.confirmPassword)){ea.fire({icon:"error",title:"Oops...",text:"Password Does Not Match"});return}const mt=await r(be.id,se);console.log("UPdate response:",mt),qe(),g(!1)},[Et,St]=fe.useState(!1);fe.useEffect(()=>{console.log("userModalOpen changed:",Et),qe()},[o]);const it=async(Ze,mt)=>{console.log("userToToggle",he),console.log(Ze,he.status);try{const bt={status:he!=null&&he.status?0:1};console.log("updateData",bt),await r(Ze,bt),qe()}catch(bt){console.error("Error updating lock status:",bt)}};return console.log("usercreated",o),M.jsxs(M.Fragment,{children:[M.jsx(gL,{setusercreated:d}),M.jsxs("div",{className:"container mx-auto p-3 md:w-4/5 w-full",children:[M.jsx("div",{className:"flex items-center justify-between mb-4",children:M.jsxs("div",{className:"relative md:w-1/3 w-full",children:[M.jsx("input",{type:"text",placeholder:"Search...",className:"w-full p-2 pl-10 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200",value:y,onChange:Ze=>v(Ze.target.value)}),M.jsx(vT,{className:"absolute left-3 top-2.5 text-gray-400",size:20})]})}),M.jsx("div",{className:"overflow-x-auto shadow-lg rounded-lg",children:M.jsx("div",{className:"min-w-full inline-block align-middle",children:M.jsx("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:M.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[M.jsx("thead",{className:"bg-blue-600 text-white",children:M.jsxs("tr",{children:[M.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Name"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Status"}),M.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Username"}),M.jsx("th",{className:"px-6 py-3 text-start text-sm font-semibold",children:"Mobile Number"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Lock/Unlock"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Update"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Delete"})]})}),M.jsx("tbody",{className:"divide-y divide-gray-300 bg-white",children:Re.map((Ze,mt)=>M.jsxs("tr",{className:"hover:bg-gray-100 transition",children:[M.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800",children:Ze.name}),M.jsx("td",{className:"px-6 py-4 text-center",children:Ze.status?M.jsx("span",{children:"Active"}):M.jsx("span",{children:"Inactive"})}),M.jsx("td",{className:"px-6 py-4 text-sm text-gray-800",children:Ze.username}),M.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800",children:Ze.mobilenumber}),M.jsx("td",{className:"px-6 py-4 text-center",children:M.jsx("button",{onClick:()=>{Ge(Ze),It(!0)},className:"cursor-pointer text-gray-600 hover:text-gray-800 transition",children:Ze.status?M.jsx(KG,{size:20}):M.jsx(WG,{size:20})})}),M.jsx("td",{className:"px-6 py-4 text-center",children:M.jsx("button",{onClick:()=>{Se(Ze),g(!0)},className:"cursor-pointer text-yellow-500 hover:text-yellow-700 transition",children:M.jsx(YG,{size:20})})}),M.jsx("td",{className:"px-6 py-4 text-center",children:M.jsx("button",{onClick:()=>{Se(Ze),K(!0)},className:"cursor-pointer text-red-500 hover:text-red-700 transition",children:M.jsx(O_,{size:20})})})]},mt))})]})})})}),M.jsxs("div",{className:"flex justify-between mt-4",children:[M.jsx("button",{disabled:T===1,onClick:()=>C(T-1),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-200 transition disabled:opacity-50",children:"Previous"}),M.jsxs("span",{className:"text-gray-700 hidden md:inline-block",children:["Page ",T," of ",Oe]}),M.jsx("button",{disabled:T===Oe,onClick:()=>C(T+1),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white hover:bg-gray-200 transition disabled:opacity-50",children:"Next"})]})]}),p&&M.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/30 backdrop-blur-sm z-50 animate-fadeIn",children:M.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-2xl w-[500px] max-w-[95%] border border-gray-100 animate-scaleIn",children:[M.jsxs("div",{className:"flex justify-between items-center pb-4 mb-4 border-b border-gray-200",children:[M.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Update User"}),M.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100",children:M.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),M.jsxs("form",{className:"space-y-4",onSubmit:Be,children:[M.jsx("div",{className:"grid grid-cols-1 gap-4",children:M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),M.jsx("input",{type:"text",name:"name",value:se.name,placeholder:"Enter full name",onChange:He,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})}),M.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[M.jsxs("div",{className:"relative",children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),M.jsx("input",{type:H?"text":"password",name:"password",value:se.password,placeholder:"Create password",onChange:He,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),M.jsx("button",{type:"button",onClick:()=>Q(!H),className:"absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:H?M.jsx(md,{className:"h-5 w-5"}):M.jsx(ol,{className:"h-5 w-5"})})]}),M.jsxs("div",{className:"relative",children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),M.jsx("input",{type:ne?"text":"password",name:"confirmPassword",value:se.confirmPassword!==void 0?se.confirmPassword:se.password,placeholder:"Confirm password",onChange:He,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all pr-10"}),M.jsx("button",{type:"button",onClick:()=>ee(!ne),className:"absolute right-3 bottom-3 text-gray-500 hover:text-gray-700 transition-colors",children:ne?M.jsx(md,{className:"h-5 w-5"}):M.jsx(ol,{className:"h-5 w-5"})})]})]}),M.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),M.jsx("input",{type:"text",value:se.username,name:"username",placeholder:"Username",onChange:He,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Channel Name"}),M.jsx("input",{type:"text",readOnly:!0,value:localStorage.getItem("channel_name"),name:"Channelid",placeholder:"Channel ID",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})]}),M.jsx("div",{className:"grid grid-cols-1 gap-4",children:M.jsxs("div",{children:[M.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),M.jsx("input",{type:"number",value:se.mobilenumber,name:"mobilenumber",placeholder:"Phone number",onChange:He,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})}),M.jsx("button",{type:"submit",className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-medium hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg active:scale-95 transform mt-4",children:"Update User"})]})]})}),x&&M.jsx("div",{id:"popup-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:M.jsx("div",{className:"relative p-4 w-full max-w-md",children:M.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[M.jsx("button",{type:"button",className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>K(!1),children:M.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),M.jsxs("div",{className:"p-6 text-center",children:[M.jsx("svg",{className:"mx-auto mb-4 text-red-600 w-14 h-14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),M.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Confirm Permanent Deletion"}),M.jsx("p",{className:"mb-6 text-gray-600",children:"This will permanently delete the item and cannot be recovered. Are you sure you want to continue?"}),M.jsxs("div",{className:"flex justify-center space-x-4",children:[M.jsx("button",{onClick:ct,className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"Delete Permanently"}),M.jsx("button",{onClick:()=>K(!1),className:"px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})}),st&&M.jsx("div",{id:"lock-unlock-modal",tabIndex:-1,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:M.jsx("div",{className:"relative p-4 w-full max-w-md",children:M.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[M.jsx("button",{type:"button",className:"cursor-pointer absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>It(!1),children:M.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),M.jsxs("div",{className:"p-6 text-center",children:[M.jsx("svg",{className:` mx-auto mb-4 ${he!=null&&he.status?"text-red-600":"text-green-600"} w-14 h-14`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:he!=null&&he.status?"M6 18L18 6M6 6l12 12":"M5 12h14M12 5v14M9 9l6 6M9 15l6-6"})}),M.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:he!=null&&he.status?"Lock User Access":"Unlock User Access"}),M.jsxs("p",{className:"mb-6 text-gray-600",children:["Are you sure you want to"," ",he!=null&&he.status?"lock":"unlock"," the User"," ",M.jsx("span",{className:"font-semibold",children:!(he!=null&&he.status)}),"?"]}),M.jsxs("div",{className:"flex justify-center space-x-4",children:[M.jsx("button",{className:`cursor-pointer px-6 py-2 text-white rounded-md transition-colors ${he!=null&&he.status?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"}`,onClick:()=>{it(he.id,!he.locked),It(!1)},children:he!=null&&he.status?"Lock":"Unlock"}),M.jsx("button",{onClick:()=>It(!1),className:"cursor-pointer px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})})]})}function LZ(){return M.jsx(M.Fragment,{children:M.jsx(NZ,{})})}const xt=Number.isFinite||function(h){return typeof h=="number"&&isFinite(h)},xZ=Number.isSafeInteger||function(h){return typeof h=="number"&&Math.abs(h)<=PZ},PZ=Number.MAX_SAFE_INTEGER||9007199254740991;let Gt=function(h){return h.NETWORK_ERROR="networkError",h.MEDIA_ERROR="mediaError",h.KEY_SYSTEM_ERROR="keySystemError",h.MUX_ERROR="muxError",h.OTHER_ERROR="otherError",h}({}),Ue=function(h){return h.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",h.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",h.KEY_SYSTEM_NO_SESSION="keySystemNoSession",h.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",h.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",h.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",h.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",h.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",h.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",h.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",h.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",h.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",h.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",h.MANIFEST_LOAD_ERROR="manifestLoadError",h.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",h.MANIFEST_PARSING_ERROR="manifestParsingError",h.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",h.LEVEL_EMPTY_ERROR="levelEmptyError",h.LEVEL_LOAD_ERROR="levelLoadError",h.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",h.LEVEL_PARSING_ERROR="levelParsingError",h.LEVEL_SWITCH_ERROR="levelSwitchError",h.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",h.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",h.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",h.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",h.FRAG_LOAD_ERROR="fragLoadError",h.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",h.FRAG_DECRYPT_ERROR="fragDecryptError",h.FRAG_PARSING_ERROR="fragParsingError",h.FRAG_GAP="fragGap",h.REMUX_ALLOC_ERROR="remuxAllocError",h.KEY_LOAD_ERROR="keyLoadError",h.KEY_LOAD_TIMEOUT="keyLoadTimeOut",h.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",h.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",h.BUFFER_APPEND_ERROR="bufferAppendError",h.BUFFER_APPENDING_ERROR="bufferAppendingError",h.BUFFER_STALLED_ERROR="bufferStalledError",h.BUFFER_FULL_ERROR="bufferFullError",h.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",h.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",h.ASSET_LIST_LOAD_ERROR="assetListLoadError",h.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",h.ASSET_LIST_PARSING_ERROR="assetListParsingError",h.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",h.INTERNAL_EXCEPTION="internalException",h.INTERNAL_ABORTED="aborted",h.ATTACH_MEDIA_ERROR="attachMediaError",h.UNKNOWN="unknown",h}({}),z=function(h){return h.MEDIA_ATTACHING="hlsMediaAttaching",h.MEDIA_ATTACHED="hlsMediaAttached",h.MEDIA_DETACHING="hlsMediaDetaching",h.MEDIA_DETACHED="hlsMediaDetached",h.MEDIA_ENDED="hlsMediaEnded",h.STALL_RESOLVED="hlsStallResolved",h.BUFFER_RESET="hlsBufferReset",h.BUFFER_CODECS="hlsBufferCodecs",h.BUFFER_CREATED="hlsBufferCreated",h.BUFFER_APPENDING="hlsBufferAppending",h.BUFFER_APPENDED="hlsBufferAppended",h.BUFFER_EOS="hlsBufferEos",h.BUFFERED_TO_END="hlsBufferedToEnd",h.BUFFER_FLUSHING="hlsBufferFlushing",h.BUFFER_FLUSHED="hlsBufferFlushed",h.MANIFEST_LOADING="hlsManifestLoading",h.MANIFEST_LOADED="hlsManifestLoaded",h.MANIFEST_PARSED="hlsManifestParsed",h.LEVEL_SWITCHING="hlsLevelSwitching",h.LEVEL_SWITCHED="hlsLevelSwitched",h.LEVEL_LOADING="hlsLevelLoading",h.LEVEL_LOADED="hlsLevelLoaded",h.LEVEL_UPDATED="hlsLevelUpdated",h.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",h.LEVELS_UPDATED="hlsLevelsUpdated",h.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",h.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",h.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",h.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",h.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",h.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",h.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",h.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",h.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",h.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",h.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",h.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",h.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",h.CUES_PARSED="hlsCuesParsed",h.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",h.INIT_PTS_FOUND="hlsInitPtsFound",h.FRAG_LOADING="hlsFragLoading",h.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",h.FRAG_LOADED="hlsFragLoaded",h.FRAG_DECRYPTED="hlsFragDecrypted",h.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",h.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",h.FRAG_PARSING_METADATA="hlsFragParsingMetadata",h.FRAG_PARSED="hlsFragParsed",h.FRAG_BUFFERED="hlsFragBuffered",h.FRAG_CHANGED="hlsFragChanged",h.FPS_DROP="hlsFpsDrop",h.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",h.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",h.ERROR="hlsError",h.DESTROYING="hlsDestroying",h.KEY_LOADING="hlsKeyLoading",h.KEY_LOADED="hlsKeyLoaded",h.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",h.BACK_BUFFER_REACHED="hlsBackBufferReached",h.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",h.ASSET_LIST_LOADING="hlsAssetListLoading",h.ASSET_LIST_LOADED="hlsAssetListLoaded",h.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",h.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",h.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",h.INTERSTITIAL_STARTED="hlsInterstitialStarted",h.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",h.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",h.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",h.INTERSTITIAL_ENDED="hlsInterstitialEnded",h.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",h.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",h.EVENT_CUE_ENTER="hlsEventCueEnter",h}({});var Vn={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Vt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class y_{constructor(i,r=0,o=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=i,this.alpha_=i?Math.exp(Math.log(.5)/i):0,this.estimate_=r,this.totalWeight_=o}sample(i,r){const o=Math.pow(this.alpha_,i);this.estimate_=r*(1-o)+o*this.estimate_,this.totalWeight_+=i}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const i=1-Math.pow(this.alpha_,this.totalWeight_);if(i)return this.estimate_/i}return this.estimate_}}class kZ{constructor(i,r,o,d=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=o,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new y_(i),this.fast_=new y_(r),this.defaultTTFB_=d,this.ttfb_=new y_(i)}update(i,r){const{slow_:o,fast_:d,ttfb_:p}=this;o.halfLife!==i&&(this.slow_=new y_(i,o.getEstimate(),o.getTotalWeight())),d.halfLife!==r&&(this.fast_=new y_(r,d.getEstimate(),d.getTotalWeight())),p.halfLife!==i&&(this.ttfb_=new y_(i,p.getEstimate(),p.getTotalWeight()))}sample(i,r){i=Math.max(i,this.minDelayMs_);const o=8*r,d=i/1e3,p=o/d;this.fast_.sample(d,p),this.slow_.sample(d,p)}sampleTTFB(i){const r=i/1e3,o=Math.sqrt(2)*Math.exp(-Math.pow(r,2)/2);this.ttfb_.sample(o,Math.max(i,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function MZ(h,i,r){return(i=FZ(i))in h?Object.defineProperty(h,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):h[i]=r,h}function Mi(){return Mi=Object.assign?Object.assign.bind():function(h){for(var i=1;i<arguments.length;i++){var r=arguments[i];for(var o in r)({}).hasOwnProperty.call(r,o)&&(h[o]=r[o])}return h},Mi.apply(null,arguments)}function F3(h,i){var r=Object.keys(h);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(h);i&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(h,d).enumerable})),r.push.apply(r,o)}return r}function Ii(h){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?F3(Object(r),!0).forEach(function(o){MZ(h,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(r)):F3(Object(r)).forEach(function(o){Object.defineProperty(h,o,Object.getOwnPropertyDescriptor(r,o))})}return h}function UZ(h,i){if(typeof h!="object"||!h)return h;var r=h[Symbol.toPrimitive];if(r!==void 0){var o=r.call(h,i);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(h)}function FZ(h){var i=UZ(h,"string");return typeof i=="symbol"?i:i+""}class Ou{constructor(i,r){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const o=`[${i}]:`;this.trace=cf,this.debug=r.debug.bind(null,o),this.log=r.log.bind(null,o),this.warn=r.warn.bind(null,o),this.info=r.info.bind(null,o),this.error=r.error.bind(null,o)}}const cf=function(){},BZ={trace:cf,debug:cf,log:cf,warn:cf,info:cf,error:cf};function UN(){return Mi({},BZ)}function VZ(h,i){const r=self.console[h];return r?r.bind(self.console,`${i?"["+i+"] ":""}[${h}] >`):cf}function B3(h,i,r){return i[h]?i[h].bind(i):VZ(h,r)}const FN=UN();function jZ(h,i,r){const o=UN();if(typeof console=="object"&&h===!0||typeof h=="object"){const d=["debug","log","info","warn","error"];d.forEach(p=>{o[p]=B3(p,h,r)});try{o.log(`Debug logs enabled for "${i}" in hls.js version 1.6.2`)}catch{return UN()}d.forEach(p=>{FN[p]=B3(p,h)})}else Mi(FN,o);return o}const Zn=FN;function uf(h=!0){return typeof self>"u"?void 0:(h||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function GZ(h){return typeof self<"u"&&h===self.ManagedMediaSource}function JG(h,i){const r=Object.keys(h),o=Object.keys(i),d=r.length,p=o.length;return!d||!p||d===p&&!r.some(g=>o.indexOf(g)===-1)}function So(h,i=!1){if(typeof TextDecoder<"u"){const T=new TextDecoder("utf-8").decode(h);if(i){const C=T.indexOf("\0");return C!==-1?T.substring(0,C):T}return T.replace(/\0/g,"")}const r=h.length;let o,d,p,g="",y=0;for(;y<r;){if(o=h[y++],o===0&&i)return g;if(o===0||o===3)continue;switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g+=String.fromCharCode(o);break;case 12:case 13:d=h[y++],g+=String.fromCharCode((o&31)<<6|d&63);break;case 14:d=h[y++],p=h[y++],g+=String.fromCharCode((o&15)<<12|(d&63)<<6|(p&63)<<0);break}}return g}const fd={hexDump:function(h){let i="";for(let r=0;r<h.length;r++){let o=h[r].toString(16);o.length<2&&(o="0"+o),i+=o}return i}};function HZ(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var tN={exports:{}},V3;function KZ(){return V3||(V3=1,function(h,i){(function(r){var o=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,d=/^(?=([^\/?#]*))\1([^]*)$/,p=/(?:\/|^)\.(?=\/)/g,g=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,y={buildAbsoluteURL:function(v,T,C){if(C=C||{},v=v.trim(),T=T.trim(),!T){if(!C.alwaysNormalize)return v;var I=y.parseURL(v);if(!I)throw new Error("Error trying to parse base URL.");return I.path=y.normalizePath(I.path),y.buildURLFromParts(I)}var L=y.parseURL(T);if(!L)throw new Error("Error trying to parse relative URL.");if(L.scheme)return C.alwaysNormalize?(L.path=y.normalizePath(L.path),y.buildURLFromParts(L)):T;var N=y.parseURL(v);if(!N)throw new Error("Error trying to parse base URL.");if(!N.netLoc&&N.path&&N.path[0]!=="/"){var x=d.exec(N.path);N.netLoc=x[1],N.path=x[2]}N.netLoc&&!N.path&&(N.path="/");var K={scheme:N.scheme,netLoc:L.netLoc,path:null,params:L.params,query:L.query,fragment:L.fragment};if(!L.netLoc&&(K.netLoc=N.netLoc,L.path[0]!=="/"))if(!L.path)K.path=N.path,L.params||(K.params=N.params,L.query||(K.query=N.query));else{var H=N.path,Q=H.substring(0,H.lastIndexOf("/")+1)+L.path;K.path=y.normalizePath(Q)}return K.path===null&&(K.path=C.alwaysNormalize?y.normalizePath(L.path):L.path),y.buildURLFromParts(K)},parseURL:function(v){var T=o.exec(v);return T?{scheme:T[1]||"",netLoc:T[2]||"",path:T[3]||"",params:T[4]||"",query:T[5]||"",fragment:T[6]||""}:null},normalizePath:function(v){for(v=v.split("").reverse().join("").replace(p,"");v.length!==(v=v.replace(g,"")).length;);return v.split("").reverse().join("")},buildURLFromParts:function(v){return v.scheme+v.netLoc+v.path+v.params+v.query+v.fragment}};h.exports=y})()}(tN)),tN.exports}var EL=KZ();class _L{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ki={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class QG{constructor(i){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof i=="string"&&(i={url:i}),this.base=i,YZ(this,"stats")}setByteRange(i,r){const o=i.split("@",2);let d;o.length===1?d=(r==null?void 0:r.byteRangeEndOffset)||0:d=parseInt(o[1]),this._byteRange=[d,parseInt(o[0])+d]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ki.AUDIO]:null,[ki.VIDEO]:null,[ki.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(i){this._streams=i}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new _L),this._stats}set stats(i){this._stats=i}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=EL.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(i){this._url=i}clearElementaryStreamInfo(){const{elementaryStreams:i}=this;i[ki.AUDIO]=null,i[ki.VIDEO]=null,i[ki.AUDIOVIDEO]=null}}function Ar(h){return h.sn!=="initSegment"}class nN extends QG{constructor(i,r){super(r),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=i}get byteLength(){if(this.hasStats){const i=this.stats.total;if(i)return i}if(this.byteRange){const i=this.byteRange[0],r=this.byteRange[1];if(xt(i)&&xt(r))return r-i}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(i){this._bitrate=i}get decryptdata(){const{levelkeys:i}=this;if(!i&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const r=this.levelkeys.identity;if(r)this._decryptdata=r.getDecryptData(this.sn);else{const o=Object.keys(this.levelkeys);if(o.length===1)return this._decryptdata=this.levelkeys[o[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const i=xt(this.duration)?this.duration:0;return this.programDateTime+i*1e3}get encrypted(){var i;if((i=this._decryptdata)!=null&&i.encrypted)return!0;if(this.levelkeys){const r=Object.keys(this.levelkeys),o=r.length;if(o>1||o===1&&this.levelkeys[r[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(i){if(!xt(i)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=i}get ref(){return Ar(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(i){this.setStart(this.start+i)}setStart(i){this.start=i,this._ref&&(this._ref.start=i)}setDuration(i){this.duration=i,this._ref&&(this._ref.duration=i)}setKeyFormat(i){if(this.levelkeys){const r=this.levelkeys[i];r&&!this._decryptdata&&(this._decryptdata=r.getDecryptData(this.sn))}}abortRequests(){var i,r;(i=this.loader)==null||i.abort(),(r=this.keyLoader)==null||r.abort()}setElementaryStreamInfo(i,r,o,d,p,g=!1){const{elementaryStreams:y}=this,v=y[i];if(!v){y[i]={startPTS:r,endPTS:o,startDTS:d,endDTS:p,partial:g};return}v.startPTS=Math.min(v.startPTS,r),v.endPTS=Math.max(v.endPTS,o),v.startDTS=Math.min(v.startDTS,d),v.endDTS=Math.max(v.endDTS,p)}}class WZ extends QG{constructor(i,r,o,d,p){super(o),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=i.decimalFloatingPoint("DURATION"),this.gap=i.bool("GAP"),this.independent=i.bool("INDEPENDENT"),this.relurl=i.enumeratedString("URI"),this.fragment=r,this.index=d;const g=i.enumeratedString("BYTERANGE");g&&this.setByteRange(g,p),p&&(this.fragOffset=p.fragOffset+p.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:i}=this;return!!(i.audio||i.video||i.audiovideo)}}function ZG(h,i){const r=Object.getPrototypeOf(h);if(r){const o=Object.getOwnPropertyDescriptor(r,i);return o||ZG(r,i)}}function YZ(h,i){const r=ZG(h,i);r&&(r.enumerable=!0,Object.defineProperty(h,i,r))}const rC=Math.pow(2,32)-1,qZ=[].push,e5={video:1,audio:2,id3:3,text:4};function or(h){return String.fromCharCode.apply(null,h)}function t5(h,i){const r=h[i]<<8|h[i+1];return r<0?65536+r:r}function an(h,i){const r=n5(h,i);return r<0?4294967296+r:r}function j3(h,i){let r=an(h,i);return r*=Math.pow(2,32),r+=an(h,i+4),r}function n5(h,i){return h[i]<<24|h[i+1]<<16|h[i+2]<<8|h[i+3]}function iN(h,i,r){h[i]=r>>24,h[i+1]=r>>16&255,h[i+2]=r>>8&255,h[i+3]=r&255}function $Z(h){const i=h.byteLength;for(let r=0;r<i;){const o=an(h,r);if(o>8&&h[r+4]===109&&h[r+5]===111&&h[r+6]===111&&h[r+7]===102)return!0;r=o>1?r+o:i}return!1}function yn(h,i){const r=[];if(!i.length)return r;const o=h.byteLength;for(let d=0;d<o;){const p=an(h,d),g=or(h.subarray(d+4,d+8)),y=p>1?d+p:o;if(g===i[0])if(i.length===1)r.push(h.subarray(d+8,y));else{const v=yn(h.subarray(d+8,y),i.slice(1));v.length&&qZ.apply(r,v)}d=y}return r}function zZ(h){const i=[],r=h[0];let o=8;const d=an(h,o);o+=4;let p=0,g=0;r===0?(p=an(h,o),g=an(h,o+4),o+=8):(p=j3(h,o),g=j3(h,o+8),o+=16),o+=2;let y=h.length+g;const v=t5(h,o);o+=2;for(let T=0;T<v;T++){let C=o;const I=an(h,C);C+=4;const L=I&2147483647;if((I&2147483648)>>>31===1)return Zn.warn("SIDX has hierarchical references (not supported)"),null;const x=an(h,C);C+=4,i.push({referenceSize:L,subsegmentDuration:x,info:{duration:x/d,start:y,end:y+L-1}}),y+=L,C+=4,o=C}return{earliestPresentationTime:p,timescale:d,version:r,referencesCount:v,references:i}}function i5(h){const i=[],r=yn(h,["moov","trak"]);for(let d=0;d<r.length;d++){const p=r[d],g=yn(p,["tkhd"])[0];if(g){let y=g[0];const v=an(g,y===0?12:20),T=yn(p,["mdia","mdhd"])[0];if(T){y=T[0];const C=an(T,y===0?12:20),I=yn(p,["mdia","hdlr"])[0];if(I){const L=or(I.subarray(8,12)),N={soun:ki.AUDIO,vide:ki.VIDEO}[L],x=yn(p,["mdia","minf","stbl","stsd"])[0],K=XZ(x);N?(i[v]={timescale:C,type:N,stsd:K},i[N]=Ii({timescale:C,id:v},K)):i[v]={timescale:C,type:L,stsd:K}}}}}return yn(h,["moov","mvex","trex"]).forEach(d=>{const p=an(d,4),g=i[p];g&&(g.default={duration:an(d,12),flags:an(d,20)})}),i}function XZ(h){const i=h.subarray(8),r=i.subarray(86),o=or(i.subarray(4,8));let d=o,p;const g=o==="enca"||o==="encv";if(g){const T=yn(i,[o])[0].subarray(o==="enca"?28:78);yn(T,["sinf"]).forEach(I=>{const L=yn(I,["schm"])[0];if(L){const N=or(L.subarray(4,8));if(N==="cbcs"||N==="cenc"){const x=yn(I,["frma"])[0];x&&(d=or(x))}}})}const y=d;switch(d){case"avc1":case"avc2":case"avc3":case"avc4":{const v=yn(r,["avcC"])[0];v&&v.length>3&&(d+="."+CA(v[1])+CA(v[2])+CA(v[3]),p=AA(y==="avc1"?"dva1":"dvav",r));break}case"mp4a":{const v=yn(i,[o])[0],T=yn(v.subarray(28),["esds"])[0];if(T&&T.length>7){let C=4;if(T[C++]!==3)break;C=sN(T,C),C+=2;const I=T[C++];if(I&128&&(C+=2),I&64&&(C+=T[C++]),T[C++]!==4)break;C=sN(T,C);const L=T[C++];if(L===64)d+="."+CA(L);else break;if(C+=12,T[C++]!==5)break;C=sN(T,C);const N=T[C++];let x=(N&248)>>3;x===31&&(x+=1+((N&7)<<3)+((T[C]&224)>>5)),d+="."+x}break}case"hvc1":case"hev1":{const v=yn(r,["hvcC"])[0];if(v&&v.length>12){const T=v[1],C=["","A","B","C"][T>>6],I=T&31,L=an(v,2),N=(T&32)>>5?"H":"L",x=v[12],K=v.subarray(6,12);d+="."+C+I,d+="."+L.toString(16).toUpperCase(),d+="."+N+x;let H="";for(let Q=K.length;Q--;){const ne=K[Q];(ne||H)&&(H="."+ne.toString(16).toUpperCase()+H)}d+=H}p=AA(y=="hev1"?"dvhe":"dvh1",r);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{d=AA(d,r)||d;break}case"vp09":{const v=yn(r,["vpcC"])[0];if(v&&v.length>6){const T=v[4],C=v[5],I=v[6]>>4&15;d+="."+hd(T)+"."+hd(C)+"."+hd(I)}break}case"av01":{const v=yn(r,["av1C"])[0];if(v&&v.length>2){const T=v[1]>>>5,C=v[1]&31,I=v[2]>>>7?"H":"M",L=(v[2]&64)>>6,N=(v[2]&32)>>5,x=T===2&&L?N?12:10:L?10:8,K=(v[2]&16)>>4,H=(v[2]&8)>>3,Q=(v[2]&4)>>2,ne=v[2]&3;d+="."+T+"."+hd(C)+I+"."+hd(x)+"."+K+"."+H+Q+ne+"."+hd(1)+"."+hd(1)+"."+hd(1)+"."+0,p=AA("dav1",r)}break}}return{codec:d,encrypted:g,supplemental:p}}function AA(h,i){const r=yn(i,["dvvC"]),o=r.length?r[0]:yn(i,["dvcC"])[0];if(o){const d=o[2]>>1&127,p=o[2]<<5&32|o[3]>>3&31;return h+"."+hd(d)+"."+hd(p)}}function sN(h,i){const r=i+5;for(;h[i++]&128&&i<r;);return i}function CA(h){return("0"+h.toString(16).toUpperCase()).slice(-2)}function hd(h){return(h<10?"0":"")+h}function JZ(h,i){if(!h||!i)return h;const r=i.keyId;return r&&i.isCommonEncryption&&yn(h,["moov","trak"]).forEach(d=>{const g=yn(d,["mdia","minf","stbl","stsd"])[0].subarray(8);let y=yn(g,["enca"]);const v=y.length>0;v||(y=yn(g,["encv"])),y.forEach(T=>{const C=v?T.subarray(28):T.subarray(78);yn(C,["sinf"]).forEach(L=>{const N=s5(L);if(N){const x=N.subarray(8,24);x.some(K=>K!==0)||(Zn.log(`[eme] Patching keyId in 'enc${v?"a":"v"}>sinf>>tenc' box: ${fd.hexDump(x)} -> ${fd.hexDump(r)}`),N.set(r,8))}})})}),h}function s5(h){const i=yn(h,["schm"])[0];if(i){const r=or(i.subarray(4,8));if(r==="cbcs"||r==="cenc")return yn(h,["schi","tenc"])[0]}return null}function QZ(h,i){return yn(i,["moof","traf"]).reduce((r,o)=>{const d=yn(o,["tfdt"])[0],p=d[0],g=yn(o,["tfhd"]).reduce((y,v)=>{const T=an(v,4),C=h[T];if(C){let I=an(d,4);if(p===1){if(I===rC)return Zn.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),y;I*=rC+1,I+=an(d,8)}const L=C.timescale||9e4,N=I/L;if(xt(N)&&(y===null||N<y))return N}return y},null);return g!==null&&xt(g)&&(r===null||g<r)?g:r},null)}function ZZ(h,i){let r=0,o=0,d=0;const p=yn(h,["moof","traf"]);for(let g=0;g<p.length;g++){const y=p[g],v=yn(y,["tfhd"])[0],T=an(v,4),C=i[T];if(!C)continue;const I=C.default,L=an(v,0)|(I==null?void 0:I.flags);let N=I==null?void 0:I.duration;L&8&&(L&2?N=an(v,12):N=an(v,8));const x=C.timescale||9e4,K=yn(y,["trun"]);for(let H=0;H<K.length;H++){if(r=eee(K[H]),!r&&N){const Q=an(K[H],4);r=N*Q}C.type===ki.VIDEO?o+=r/x:C.type===ki.AUDIO&&(d+=r/x)}}if(o===0&&d===0){let g=1/0,y=0,v=0;const T=yn(h,["sidx"]);for(let C=0;C<T.length;C++){const I=zZ(T[C]);if(I!=null&&I.references){g=Math.min(g,I.earliestPresentationTime/I.timescale);const L=I.references.reduce((N,x)=>N+x.info.duration||0,0);y=Math.max(y,L+I.earliestPresentationTime/I.timescale),v=y-g}}if(v&&xt(v))return v}return o||d}function eee(h){const i=an(h,0);let r=8;i&1&&(r+=4),i&4&&(r+=4);let o=0;const d=an(h,4);for(let p=0;p<d;p++){if(i&256){const g=an(h,r);o+=g,r+=4}i&512&&(r+=4),i&1024&&(r+=4),i&2048&&(r+=4)}return o}function tee(h,i,r){yn(i,["moof","traf"]).forEach(o=>{yn(o,["tfhd"]).forEach(d=>{const p=an(d,4),g=h[p];if(!g)return;const y=g.timescale||9e4;yn(o,["tfdt"]).forEach(v=>{const T=v[0],C=r*y;if(C){let I=an(v,4);if(T===0)I-=C,I=Math.max(I,0),iN(v,4,I);else{I*=Math.pow(2,32),I+=an(v,8),I-=C,I=Math.max(I,0);const L=Math.floor(I/(rC+1)),N=Math.floor(I%(rC+1));iN(v,4,L),iN(v,8,N)}}})})})}function nee(h){const i={valid:null,remainder:null},r=yn(h,["moof"]);if(r.length<2)return i.remainder=h,i;const o=r[r.length-1];return i.valid=h.slice(0,o.byteOffset-8),i.remainder=h.slice(o.byteOffset-8),i}function dc(h,i){const r=new Uint8Array(h.length+i.length);return r.set(h),r.set(i,h.length),r}function G3(h,i){const r=[],o=i.samples,d=i.timescale,p=i.id;let g=!1;return yn(o,["moof"]).map(v=>{const T=v.byteOffset-8;yn(v,["traf"]).map(I=>{const L=yn(I,["tfdt"]).map(N=>{const x=N[0];let K=an(N,4);return x===1&&(K*=Math.pow(2,32),K+=an(N,8)),K/d})[0];return L!==void 0&&(h=L),yn(I,["tfhd"]).map(N=>{const x=an(N,4),K=an(N,0)&16777215,H=(K&1)!==0,Q=(K&2)!==0,ne=(K&8)!==0;let ee=0;const pe=(K&16)!==0;let de=0;const be=(K&32)!==0;let Se=8;x===p&&(H&&(Se+=8),Q&&(Se+=4),ne&&(ee=an(N,Se),Se+=4),pe&&(de=an(N,Se),Se+=4),be&&(Se+=4),i.type==="video"&&(g=AC(i.codec)),yn(I,["trun"]).map(Te=>{const _e=Te[0],he=an(Te,0)&16777215,Ge=(he&1)!==0;let st=0;const It=(he&4)!==0,qe=(he&256)!==0;let ut=0;const Oe=(he&512)!==0;let Qe=0;const Ke=(he&1024)!==0,Re=(he&2048)!==0;let se=0;const we=an(Te,4);let He=8;Ge&&(st=an(Te,He),He+=4),It&&(He+=4);let ct=st+T;for(let Be=0;Be<we;Be++){if(qe?(ut=an(Te,He),He+=4):ut=ee,Oe?(Qe=an(Te,He),He+=4):Qe=de,Ke&&(He+=4),Re&&(_e===0?se=an(Te,He):se=n5(Te,He),He+=4),i.type===ki.VIDEO){let Et=0;for(;Et<Qe;){const St=an(o,ct);if(ct+=4,iee(g,o[ct])){const it=o.subarray(ct,ct+St);SL(it,g?2:1,h+se/d,r)}ct+=St,Et+=St+4}}h+=ut/d}}))})})}),r}function AC(h){if(!h)return!1;const i=h.substring(0,4);return i==="hvc1"||i==="hev1"||i==="dvh1"||i==="dvhe"}function iee(h,i){if(h){const r=i>>1&63;return r===39||r===40}else return(i&31)===6}function SL(h,i,r,o){const d=r5(h);let p=0;p+=i;let g=0,y=0,v=0;for(;p<d.length;){g=0;do{if(p>=d.length)break;v=d[p++],g+=v}while(v===255);y=0;do{if(p>=d.length)break;v=d[p++],y+=v}while(v===255);const T=d.length-p;let C=p;if(y<T)p+=y;else if(y>T){Zn.error(`Malformed SEI payload. ${y} is too small, only ${T} bytes left to parse.`);break}if(g===4){if(d[C++]===181){const L=t5(d,C);if(C+=2,L===49){const N=an(d,C);if(C+=4,N===1195456820){const x=d[C++];if(x===3){const K=d[C++],H=31&K,Q=64&K,ne=Q?2+H*3:0,ee=new Uint8Array(ne);if(Q){ee[0]=K;for(let pe=1;pe<ne;pe++)ee[pe]=d[C++]}o.push({type:x,payloadType:g,pts:r,bytes:ee})}}}}}else if(g===5&&y>16){const I=[];for(let x=0;x<16;x++){const K=d[C++].toString(16);I.push(K.length==1?"0"+K:K),(x===3||x===5||x===7||x===9)&&I.push("-")}const L=y-16,N=new Uint8Array(L);for(let x=0;x<L;x++)N[x]=d[C++];o.push({payloadType:g,pts:r,uuid:I.join(""),userData:So(N),userDataBytes:N})}}}function r5(h){const i=h.byteLength,r=[];let o=1;for(;o<i-2;)h[o]===0&&h[o+1]===0&&h[o+2]===3?(r.push(o+2),o+=2):o++;if(r.length===0)return h;const d=i-r.length,p=new Uint8Array(d);let g=0;for(o=0;o<d;g++,o++)g===r[0]&&(g++,r.shift()),p[o]=h[g];return p}function see(h){const i=h[0];let r="",o="",d=0,p=0,g=0,y=0,v=0,T=0;if(i===0){for(;or(h.subarray(T,T+1))!=="\0";)r+=or(h.subarray(T,T+1)),T+=1;for(r+=or(h.subarray(T,T+1)),T+=1;or(h.subarray(T,T+1))!=="\0";)o+=or(h.subarray(T,T+1)),T+=1;o+=or(h.subarray(T,T+1)),T+=1,d=an(h,12),p=an(h,16),y=an(h,20),v=an(h,24),T=28}else if(i===1){T+=4,d=an(h,T),T+=4;const I=an(h,T);T+=4;const L=an(h,T);for(T+=4,g=2**32*I+L,xZ(g)||(g=Number.MAX_SAFE_INTEGER,Zn.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),y=an(h,T),T+=4,v=an(h,T),T+=4;or(h.subarray(T,T+1))!=="\0";)r+=or(h.subarray(T,T+1)),T+=1;for(r+=or(h.subarray(T,T+1)),T+=1;or(h.subarray(T,T+1))!=="\0";)o+=or(h.subarray(T,T+1)),T+=1;o+=or(h.subarray(T,T+1)),T+=1}const C=h.subarray(T,h.byteLength);return{schemeIdUri:r,value:o,timeScale:d,presentationTime:g,presentationTimeDelta:p,eventDuration:y,id:v,payload:C}}function ree(h,...i){const r=i.length;let o=8,d=r;for(;d--;)o+=i[d].byteLength;const p=new Uint8Array(o);for(p[0]=o>>24&255,p[1]=o>>16&255,p[2]=o>>8&255,p[3]=o&255,p.set(h,4),d=0,o=8;d<r;d++)p.set(i[d],o),o+=i[d].byteLength;return p}function aee(h,i,r){if(h.byteLength!==16)throw new RangeError("Invalid system id");let o,d;o=0,d=new Uint8Array;let p;o>0?(p=new Uint8Array(4),i.length>0&&new DataView(p.buffer).setUint32(0,i.length,!1)):p=new Uint8Array;const g=new Uint8Array(4);return r&&r.byteLength>0&&new DataView(g.buffer).setUint32(0,r.byteLength,!1),ree([112,115,115,104],new Uint8Array([o,0,0,0]),h,p,d,g,r||new Uint8Array)}function oee(h){const i=[];if(h instanceof ArrayBuffer){const r=h.byteLength;let o=0;for(;o+32<r;){const d=new DataView(h,o),p=cee(d);i.push(p),o+=p.size}}return i}function cee(h){const i=h.getUint32(0),r=h.byteOffset,o=h.byteLength;if(o<i)return{offset:r,size:o};if(h.getUint32(4)!==1886614376)return{offset:r,size:i};const p=h.getUint32(8)>>>24;if(p!==0&&p!==1)return{offset:r,size:i};const g=h.buffer,y=fd.hexDump(new Uint8Array(g,r+12,16)),v=h.getUint32(28);let T=null,C=null;if(p===0){if(i-32<v||v<22)return{offset:r,size:i};C=new Uint8Array(g,r+32,v)}else if(p===1){if(!v||o<r+32+v*16+16)return{offset:r,size:i};T=[];for(let I=0;I<v;I++)T.push(new Uint8Array(g,r+32+I*16,16))}return{version:p,systemId:y,kids:T,data:C,offset:r,size:i}}const a5=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),D_={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function o5(h,i){const r=D_[i];return!!r&&!!r[h.slice(0,4)]}function BN(h,i,r=!0){return!h.split(",").some(o=>!c5(o,i,r))}function c5(h,i,r=!0){var o;const d=uf(r);return(o=d==null?void 0:d.isTypeSupported(cT(h,i)))!=null?o:!1}function cT(h,i){return`${i}/mp4;codecs=${h}`}function H3(h){if(h){const i=h.substring(0,4);return D_.video[i]}return 2}function aC(h){const i=a5();return h.split(",").reduce((r,o)=>{const p=i&&AC(o)?9:D_.video[o];return p?(p*2+r)/(r?3:2):(D_.audio[o]+r)/(r?2:1)},0)}const rN={};function lee(h,i=!0){if(rN[h])return rN[h];const r={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[h];for(let d=0;d<r.length;d++){var o;if(c5(r[d],"audio",i))return rN[h]=r[d],r[d];if(r[d]==="mp3"&&(o=uf(i))!=null&&o.isTypeSupported("audio/mpeg"))return""}return h}const dee=/flac|opus|mp4a\.40\.34/i;function oC(h,i=!0){return h.replace(dee,r=>lee(r.toLowerCase(),i))}function uee(h,i){const r=[];if(h){const o=h.split(",");for(let d=0;d<o.length;d++)o5(o[d],"video")||r.push(o[d])}return i&&r.push(i),r.join(",")}function qA(h,i){if(h&&(h.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(h)!==-1))return h;if(i){const r=i.split(",");if(r.length>1){if(h){for(let o=r.length;o--;)if(r[o].substring(0,4)===h.substring(0,4))return r[o]}return r[0]}}return i||h}function hee(h){const i=h.split(",");for(let r=0;r<i.length;r++){const o=i[r].split(".");if(o.length>2){let d=o.shift()+".";d+=parseInt(o.shift()).toString(16),d+=("000"+parseInt(o.shift()).toString(16)).slice(-4),i[r]=d}}return i.join(",")}function fee(h){if(h.startsWith("av01.")){const i=h.split("."),r=["0","111","01","01","01","0"];for(let o=i.length;o>4&&o<10;o++)i[o]=r[o-4];return i.join(".")}return h}function K3(h){const i=uf(h)||{isTypeSupported:()=>!1};return{mpeg:i.isTypeSupported("audio/mpeg"),mp3:i.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:i.isTypeSupported('audio/mp4; codecs="ac-3"')}}function l5(h){return h.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const d5={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function u5(h,i){return{supported:!1,configurations:i,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:h}}const W3={};function pee(h,i,r,o,d,p){const g=h.audioCodec?h.audioGroups:null,y=p==null?void 0:p.audioCodec,v=p==null?void 0:p.channels,T=v?parseInt(v):y?1/0:2;let C=null;if(g!=null&&g.length)try{g.length===1&&g[0]?C=i.groups[g[0]].channels:C=g.reduce((I,L)=>{if(L){const N=i.groups[L];if(!N)throw new Error(`Audio track group ${L} not found`);Object.keys(N.channels).forEach(x=>{I[x]=(I[x]||0)+N.channels[x]})}return I},{2:0})}catch{return!0}return h.videoCodec!==void 0&&(h.width>1920&&h.height>1088||h.height>1920&&h.width>1088||h.frameRate>Math.max(o,30)||h.videoRange!=="SDR"&&h.videoRange!==r||h.bitrate>Math.max(d,8e6))||!!C&&xt(T)&&Object.keys(C).some(I=>parseInt(I)>T)}function h5(h,i,r){const o=h.videoCodec,d=h.audioCodec;if(!o&&!d||!r)return Promise.resolve(d5);const p=[];if(o){const g={width:h.width,height:h.height,bitrate:Math.ceil(Math.max(h.bitrate*.9,h.averageBitrate)),framerate:h.frameRate||30},y=h.videoRange;y!=="SDR"&&(g.transferFunction=y.toLowerCase());const v=o.split(","),T=navigator.userAgent;if(v.some(C=>AC(C))&&a5())return Promise.resolve(u5(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${T})`),p));p.push.apply(p,v.map(C=>({type:"media-source",video:Ii(Ii({},g),{},{contentType:cT(fee(C),"video")})})))}return d&&h.audioGroups&&h.audioGroups.forEach(g=>{var y;g&&((y=i.groups[g])==null||y.tracks.forEach(v=>{if(v.groupId===g){const T=v.channels||"",C=parseFloat(T);xt(C)&&C>2&&p.push.apply(p,d.split(",").map(I=>({type:"media-source",audio:{contentType:cT(I,"audio"),channels:""+C}})))}}))}),Promise.all(p.map(g=>{const y=mee(g);return W3[y]||(W3[y]=r.decodingInfo(g))})).then(g=>({supported:!g.some(y=>!y.supported),configurations:p,decodingInfoResults:g})).catch(g=>({supported:!1,configurations:p,decodingInfoResults:[],error:g}))}function mee(h){const{audio:i,video:r}=h,o=r||i;if(o){const d=l5(o.contentType);if(r)return`r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${d}_${Math.ceil(r.bitrate/1e5)}`;if(i)return`c${i.channels}${i.spatialRendering?"s":"n"}_${d}`}return""}const VN=["NONE","TYPE-0","TYPE-1",null];function gee(h){return VN.indexOf(h)>-1}const cC=["SDR","PQ","HLG"];function Eee(h){return!!h&&cC.indexOf(h)>-1}var $A={No:"",Yes:"YES",v2:"v2"};function Y3(h){const{canSkipUntil:i,canSkipDateRanges:r,age:o}=h,d=o<i/2;return i&&d?r?$A.v2:$A.Yes:$A.No}class q3{constructor(i,r,o){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=i,this.part=r,this.skip=o}addDirectives(i){const r=new self.URL(i);return this.msn!==void 0&&r.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&r.searchParams.set("_HLS_part",this.part.toString()),this.skip&&r.searchParams.set("_HLS_skip",this.skip),r.href}}class lT{constructor(i){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[i.url],this._attrs=[i.attrs],this.bitrate=i.bitrate,i.details&&(this.details=i.details),this.id=i.id||0,this.name=i.name,this.width=i.width||0,this.height=i.height||0,this.frameRate=i.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=i.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=i.audioCodec,this.videoCodec=i.videoCodec,this.codecSet=[i.videoCodec,i.audioCodec].filter(o=>!!o).map(o=>o.substring(0,4)).join(","),"supplemental"in i){var r;this.supplemental=i.supplemental;const o=(r=i.supplemental)==null?void 0:r.videoCodec;o&&o!==i.videoCodec&&(this.codecSet+=`,${o.substring(0,4)}`)}this.addGroupId("audio",i.attrs.AUDIO),this.addGroupId("text",i.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(i){return $3(this._audioGroups,i)}hasSubtitleGroup(i){return $3(this._subtitleGroups,i)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(i,r){if(r){if(i==="audio"){let o=this._audioGroups;o||(o=this._audioGroups=[]),o.indexOf(r)===-1&&o.push(r)}else if(i==="text"){let o=this._subtitleGroups;o||(o=this._subtitleGroups=[]),o.indexOf(r)===-1&&o.push(r)}}}get urlId(){return 0}set urlId(i){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var i;return(i=this.audioGroups)==null?void 0:i[0]}get textGroupId(){var i;return(i=this.subtitleGroups)==null?void 0:i[0]}addFallback(){}}function $3(h,i){return!i||!h?!1:h.indexOf(i)!==-1}function _ee(){if(typeof matchMedia=="function"){const h=matchMedia("(dynamic-range: high)"),i=matchMedia("bad query");if(h.media!==i.media)return h.matches===!0}return!1}function See(h,i){let r=!1,o=[];if(h&&(r=h!=="SDR",o=[h]),i){o=i.allowedVideoRanges||cC.slice(0);const d=o.join("")!=="SDR"&&!i.videoCodec;r=i.preferHDR!==void 0?i.preferHDR:d&&_ee(),r||(o=["SDR"])}return{preferHDR:r,allowedVideoRanges:o}}const yee=h=>{const i=new WeakSet;return(r,o)=>{if(h&&(o=h(r,o)),typeof o=="object"&&o!==null){if(i.has(o))return;i.add(o)}return o}},ds=(h,i)=>JSON.stringify(h,yee(i));function Tee(h,i,r,o,d){const p=Object.keys(h),g=o==null?void 0:o.channels,y=o==null?void 0:o.audioCodec,v=d==null?void 0:d.videoCodec,T=g&&parseInt(g)===2;let C=!1,I=!1,L=1/0,N=1/0,x=1/0,K=1/0,H=0,Q=[];const{preferHDR:ne,allowedVideoRanges:ee}=See(i,d);for(let Te=p.length;Te--;){const _e=h[p[Te]];C||(C=_e.channels[2]>0),L=Math.min(L,_e.minHeight),N=Math.min(N,_e.minFramerate),x=Math.min(x,_e.minBitrate),ee.filter(Ge=>_e.videoRanges[Ge]>0).length>0&&(I=!0)}L=xt(L)?L:0,N=xt(N)?N:0;const pe=Math.max(1080,L),de=Math.max(30,N);x=xt(x)?x:r,r=Math.max(x,r),I||(i=void 0);const be=p.length>1;return{codecSet:p.reduce((Te,_e)=>{const he=h[_e];if(_e===Te)return Te;if(Q=I?ee.filter(Ge=>he.videoRanges[Ge]>0):[],be){if(he.minBitrate>r)return dd(_e,`min bitrate of ${he.minBitrate} > current estimate of ${r}`),Te;if(!he.hasDefaultAudio)return dd(_e,"no renditions with default or auto-select sound found"),Te;if(y&&_e.indexOf(y.substring(0,4))%5!==0)return dd(_e,`audio codec preference "${y}" not found`),Te;if(g&&!T){if(!he.channels[g])return dd(_e,`no renditions with ${g} channel sound found (channels options: ${Object.keys(he.channels)})`),Te}else if((!y||T)&&C&&he.channels[2]===0)return dd(_e,"no renditions with stereo sound found"),Te;if(he.minHeight>pe)return dd(_e,`min resolution of ${he.minHeight} > maximum of ${pe}`),Te;if(he.minFramerate>de)return dd(_e,`min framerate of ${he.minFramerate} > maximum of ${de}`),Te;if(!Q.some(Ge=>he.videoRanges[Ge]>0))return dd(_e,`no variants with VIDEO-RANGE of ${ds(Q)} found`),Te;if(v&&_e.indexOf(v.substring(0,4))%5!==0)return dd(_e,`video codec preference "${v}" not found`),Te;if(he.maxScore<H)return dd(_e,`max score of ${he.maxScore} < selected max of ${H}`),Te}return Te&&(aC(_e)>=aC(Te)||he.fragmentError>h[Te].fragmentError)?Te:(K=he.minIndex,H=he.maxScore,_e)},void 0),videoRanges:Q,preferHDR:ne,minFramerate:N,minBitrate:x,minIndex:K}}function dd(h,i){Zn.log(`[abr] start candidates with "${h}" ignored because ${i}`)}function f5(h){return h.reduce((i,r)=>{let o=i.groups[r.groupId];o||(o=i.groups[r.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),o.tracks.push(r);const d=r.channels||"2";return o.channels[d]=(o.channels[d]||0)+1,o.hasDefault=o.hasDefault||r.default,o.hasAutoSelect=o.hasAutoSelect||r.autoselect,o.hasDefault&&(i.hasDefaultAudio=!0),o.hasAutoSelect&&(i.hasAutoSelectAudio=!0),i},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function vee(h,i,r,o){return h.slice(r,o+1).reduce((d,p,g)=>{if(!p.codecSet)return d;const y=p.audioGroups;let v=d[p.codecSet];v||(d[p.codecSet]=v={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:g,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!y,fragmentError:0}),v.minBitrate=Math.min(v.minBitrate,p.bitrate);const T=Math.min(p.height,p.width);return v.minHeight=Math.min(v.minHeight,T),v.minFramerate=Math.min(v.minFramerate,p.frameRate),v.minIndex=Math.min(v.minIndex,g),v.maxScore=Math.max(v.maxScore,p.score),v.fragmentError+=p.fragmentError,v.videoRanges[p.videoRange]=(v.videoRanges[p.videoRange]||0)+1,y&&y.forEach(C=>{if(!C)return;const I=i.groups[C];I&&(v.hasDefaultAudio=v.hasDefaultAudio||i.hasDefaultAudio?I.hasDefault:I.hasAutoSelect||!i.hasDefaultAudio&&!i.hasAutoSelectAudio,Object.keys(I.channels).forEach(L=>{v.channels[L]=(v.channels[L]||0)+I.channels[L]}))}),d},{})}function z3(h){if(!h)return h;const{lang:i,assocLang:r,characteristics:o,channels:d,audioCodec:p}=h;return{lang:i,assocLang:r,characteristics:o,channels:d,audioCodec:p}}function gd(h,i,r){if("attrs"in h){const o=i.indexOf(h);if(o!==-1)return o}for(let o=0;o<i.length;o++){const d=i[o];if(Nm(h,d,r))return o}return-1}function Nm(h,i,r){const{groupId:o,name:d,lang:p,assocLang:g,default:y}=h,v=h.forced;return(o===void 0||i.groupId===o)&&(d===void 0||i.name===d)&&(p===void 0||bee(p,i.lang))&&(p===void 0||i.assocLang===g)&&(y===void 0||i.default===y)&&(v===void 0||i.forced===v)&&(!("characteristics"in h)||Ree(h.characteristics||"",i.characteristics))&&(r===void 0||r(h,i))}function bee(h,i="--"){return h.length===i.length?h===i:h.startsWith(i)||i.startsWith(h)}function Ree(h,i=""){const r=h.split(","),o=i.split(",");return r.length===o.length&&!r.some(d=>o.indexOf(d)===-1)}function wm(h,i){const{audioCodec:r,channels:o}=h;return(r===void 0||(i.audioCodec||"").substring(0,4)===r.substring(0,4))&&(o===void 0||o===(i.channels||"2"))}function Aee(h,i,r,o,d){const p=i[o],y=i.reduce((L,N,x)=>{const K=N.uri;return(L[K]||(L[K]=[])).push(x),L},{})[p.uri];y.length>1&&(o=Math.max.apply(Math,y));const v=p.videoRange,T=p.frameRate,C=p.codecSet.substring(0,4),I=X3(i,o,L=>{if(L.videoRange!==v||L.frameRate!==T||L.codecSet.substring(0,4)!==C)return!1;const N=L.audioGroups,x=r.filter(K=>!N||N.indexOf(K.groupId)!==-1);return gd(h,x,d)>-1});return I>-1?I:X3(i,o,L=>{const N=L.audioGroups,x=r.filter(K=>!N||N.indexOf(K.groupId)!==-1);return gd(h,x,d)>-1})}function X3(h,i,r){for(let o=i;o>-1;o--)if(r(h[o]))return o;for(let o=i+1;o<h.length;o++)if(r(h[o]))return o;return-1}function lC(h,i){var r;return!!h&&h!==((r=i.loadLevelObj)==null?void 0:r.uri)}class Cee extends Ou{constructor(i){super("abr",i.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=r=>{var o;const{fragCurrent:d,partCurrent:p,hls:g}=this,{autoLevelEnabled:y,media:v}=g;if(!d||!v)return;const T=performance.now(),C=p?p.stats:d.stats,I=p?p.duration:d.duration,L=T-C.loading.start,N=g.minAutoLevel,x=d.level,K=this._nextAutoLevel;if(C.aborted||C.loaded&&C.loaded===C.total||x<=N){this.clearTimer(),this._nextAutoLevel=-1;return}if(!y)return;const H=K>-1&&K!==x,Q=!!r||H;if(!Q&&(v.paused||!v.playbackRate||!v.readyState))return;const ne=g.mainForwardBufferInfo;if(!Q&&ne===null)return;const ee=this.bwEstimator.getEstimateTTFB(),pe=Math.abs(v.playbackRate);if(L<=Math.max(ee,1e3*(I/(pe*2))))return;const de=ne?ne.len/pe:0,be=C.loading.first?C.loading.first-C.loading.start:-1,Se=C.loaded&&be>-1,Te=this.getBwEstimate(),_e=g.levels,he=_e[x],Ge=Math.max(C.loaded,Math.round(I*(d.bitrate||he.averageBitrate)/8));let st=Se?L-be:L;st<1&&Se&&(st=Math.min(L,C.loaded*8/Te));const It=Se?C.loaded*1e3/st:0,qe=ee/1e3,ut=It?(Ge-C.loaded)/It:Ge*8/Te+qe;if(ut<=de)return;const Oe=It?It*8:Te,Qe=((o=(r==null?void 0:r.details)||this.hls.latestLevelDetails)==null?void 0:o.live)===!0,Ke=this.hls.config.abrBandWidthUpFactor;let Re=Number.POSITIVE_INFINITY,se;for(se=x-1;se>N;se--){const Be=_e[se].maxBitrate,Et=!_e[se].details||Qe;if(Re=this.getTimeToLoadFrag(qe,Oe,I*Be,Et),Re<Math.min(de,I+qe))break}if(Re>=ut||Re>I*10)return;Se?this.bwEstimator.sample(L-Math.min(ee,be),C.loaded):this.bwEstimator.sampleTTFB(L);const we=_e[se].maxBitrate;this.getBwEstimate()*Ke>we&&this.resetEstimator(we);const He=this.findBestLevel(we,N,se,0,de,1,1);He>-1&&(se=He),this.warn(`Fragment ${d.sn}${p?" part "+p.index:""} of level ${x} is loading too slowly;
      Fragment duration: ${d.duration.toFixed(3)}
      Time to underbuffer: ${de.toFixed(3)} s
      Estimated load time for current fragment: ${ut.toFixed(3)} s
      Estimated load time for down switch fragment: ${Re.toFixed(3)} s
      TTFB estimate: ${be|0} ms
      Current BW estimate: ${xt(Te)?Te|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${se} @ ${we|0} bps`),g.nextLoadLevel=g.nextAutoLevel=se,this.clearTimer();const ct=()=>{if(this.clearTimer(),this.fragCurrent===d&&this.hls.loadLevel===se&&se>0){const Be=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${se>0?"and switching down":""}
      Fragment duration: ${d.duration.toFixed(3)} s
      Time to underbuffer: ${Be.toFixed(3)} s`),d.abortRequests(),this.fragCurrent=this.partCurrent=null,se>N){let Et=this.findBestLevel(this.hls.levels[N].bitrate,N,se,0,Be,1,1);Et===-1&&(Et=N),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Et,this.resetEstimator(this.hls.levels[Et].bitrate)}}};H||ut>Re*2?ct():this.timer=self.setInterval(ct,Re*1e3),g.trigger(z.FRAG_LOAD_EMERGENCY_ABORTED,{frag:d,part:p,stats:C})},this.hls=i,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(i){i&&(this.log(`setting initial bwe to ${i}`),this.hls.config.abrEwmaDefaultEstimate=i),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const i=this.hls.config;return new kZ(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate)}registerListeners(){const{hls:i}=this;i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.FRAG_LOADING,this.onFragLoading,this),i.on(z.FRAG_LOADED,this.onFragLoaded,this),i.on(z.FRAG_BUFFERED,this.onFragBuffered,this),i.on(z.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(z.LEVEL_LOADED,this.onLevelLoaded,this),i.on(z.LEVELS_UPDATED,this.onLevelsUpdated,this),i.on(z.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),i.on(z.ERROR,this.onError,this)}unregisterListeners(){const{hls:i}=this;i&&(i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.FRAG_LOADING,this.onFragLoading,this),i.off(z.FRAG_LOADED,this.onFragLoaded,this),i.off(z.FRAG_BUFFERED,this.onFragBuffered,this),i.off(z.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(z.LEVEL_LOADED,this.onLevelLoaded,this),i.off(z.LEVELS_UPDATED,this.onLevelsUpdated,this),i.off(z.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),i.off(z.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(i,r){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(i,r){const o=r.frag;if(!this.ignoreFragment(o)){if(!o.bitrateTest){var d;this.fragCurrent=o,this.partCurrent=(d=r.part)!=null?d:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(i,r){this.clearTimer()}onError(i,r){if(!r.fatal)switch(r.details){case Ue.BUFFER_ADD_CODEC_ERROR:case Ue.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Ue.FRAG_LOAD_TIMEOUT:{const o=r.frag,{fragCurrent:d,partCurrent:p}=this;if(o&&d&&o.sn===d.sn&&o.level===d.level){const g=performance.now(),y=p?p.stats:o.stats,v=g-y.loading.start,T=y.loading.first?y.loading.first-y.loading.start:-1;if(y.loaded&&T>-1){const I=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(v-Math.min(I,T),y.loaded)}else this.bwEstimator.sampleTTFB(v)}break}}}getTimeToLoadFrag(i,r,o,d){const p=i+o/r,g=d?i+this.lastLevelLoadSec:0;return p+g}onLevelLoaded(i,r){const o=this.hls.config,{loading:d}=r.stats,p=d.end-d.first;xt(p)&&(this.lastLevelLoadSec=p/1e3),r.details.live?this.bwEstimator.update(o.abrEwmaSlowLive,o.abrEwmaFastLive):this.bwEstimator.update(o.abrEwmaSlowVoD,o.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(r.levelInfo)}onFragLoaded(i,{frag:r,part:o}){const d=o?o.stats:r.stats;if(r.type===Vt.MAIN&&this.bwEstimator.sampleTTFB(d.loading.first-d.loading.start),!this.ignoreFragment(r)){if(this.clearTimer(),r.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const p=o?o.duration:r.duration,g=this.hls.levels[r.level],y=(g.loaded?g.loaded.bytes:0)+d.loaded,v=(g.loaded?g.loaded.duration:0)+p;g.loaded={bytes:y,duration:v},g.realBitrate=Math.round(8*y/v)}if(r.bitrateTest){const p={stats:d,frag:r,part:o,id:r.type};this.onFragBuffered(z.FRAG_BUFFERED,p),r.bitrateTest=!1}else this.lastLoadedFragLevel=r.level}}onFragBuffered(i,r){const{frag:o,part:d}=r,p=d!=null&&d.stats.loaded?d.stats:o.stats;if(p.aborted||this.ignoreFragment(o))return;const g=p.parsing.end-p.loading.start-Math.min(p.loading.first-p.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(g,p.loaded),p.bwEstimate=this.getBwEstimate(),o.bitrateTest?this.bitrateTestDelay=g/1e3:this.bitrateTestDelay=0}ignoreFragment(i){return i.type!==Vt.MAIN||i.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:i,minAutoLevel:r}=this.hls,o=this.getBwEstimate(),d=this.hls.config.maxStarvationDelay,p=this.findBestLevel(o,r,i,0,d,1,1);if(p>-1)return p;const g=this.hls.firstLevel,y=Math.min(Math.max(g,r),i);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${g} clamped to ${y}`),y}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const i=this.forcedAutoLevel,o=this.bwEstimator.canEstimate(),d=this.lastLoadedFragLevel>-1;if(i!==-1&&(!o||!d||this.nextAutoLevelKey===this.getAutoLevelKey()))return i;const p=o&&d?this.getNextABRAutoLevel():this.firstAutoLevel;if(i!==-1){const g=this.hls.levels;if(g.length>Math.max(i,p)&&g[i].loadError<=g[p].loadError)return i}return this._nextAutoLevel=p,this.nextAutoLevelKey=this.getAutoLevelKey(),p}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:i,partCurrent:r,hls:o}=this;if(o.levels.length<=1)return o.loadLevel;const{maxAutoLevel:d,config:p,minAutoLevel:g}=o,y=r?r.duration:i?i.duration:0,v=this.getBwEstimate(),T=this.getStarvationDelay();let C=p.abrBandWidthFactor,I=p.abrBandWidthUpFactor;if(T){const H=this.findBestLevel(v,g,d,T,0,C,I);if(H>=0)return this.rebufferNotice=-1,H}let L=y?Math.min(y,p.maxStarvationDelay):p.maxStarvationDelay;if(!T){const H=this.bitrateTestDelay;H&&(L=(y?Math.min(y,p.maxLoadingDelay):p.maxLoadingDelay)-H,this.info(`bitrate test took ${Math.round(1e3*H)}ms, set first fragment max fetchDuration to ${Math.round(1e3*L)} ms`),C=I=1)}const N=this.findBestLevel(v,g,d,T,L,C,I);if(this.rebufferNotice!==N&&(this.rebufferNotice=N,this.info(`${T?"rebuffering expected":"buffer is empty"}, optimal quality level ${N}`)),N>-1)return N;const x=o.levels[g],K=o.loadLevelObj;return K&&(x==null?void 0:x.bitrate)<K.bitrate?g:o.loadLevel}getStarvationDelay(){const i=this.hls,r=i.media;if(!r)return 1/0;const o=r&&r.playbackRate!==0?Math.abs(r.playbackRate):1,d=i.mainForwardBufferInfo;return(d?d.len:0)/o}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(i,r,o,d,p,g,y){var v;const T=d+p,C=this.lastLoadedFragLevel,I=C===-1?this.hls.firstLevel:C,{fragCurrent:L,partCurrent:N}=this,{levels:x,allAudioTracks:K,loadLevel:H,config:Q}=this.hls;if(x.length===1)return 0;const ne=x[I],ee=!!((v=this.hls.latestLevelDetails)!=null&&v.live),pe=H===-1||C===-1;let de,be="SDR",Se=(ne==null?void 0:ne.frameRate)||0;const{audioPreference:Te,videoPreference:_e}=Q,he=this.audioTracksByGroup||(this.audioTracksByGroup=f5(K));let Ge=-1;if(pe){if(this.firstSelection!==-1)return this.firstSelection;const Oe=this.codecTiers||(this.codecTiers=vee(x,he,r,o)),Qe=Tee(Oe,be,i,Te,_e),{codecSet:Ke,videoRanges:Re,minFramerate:se,minBitrate:we,minIndex:He,preferHDR:ct}=Qe;Ge=He,de=Ke,be=ct?Re[Re.length-1]:Re[0],Se=se,i=Math.max(i,we),this.log(`picked start tier ${ds(Qe)}`)}else de=ne==null?void 0:ne.codecSet,be=ne==null?void 0:ne.videoRange;const st=N?N.duration:L?L.duration:0,It=this.bwEstimator.getEstimateTTFB()/1e3,qe=[];for(let Oe=o;Oe>=r;Oe--){var ut;const Qe=x[Oe],Ke=Oe>I;if(!Qe)continue;if(Q.useMediaCapabilities&&!Qe.supportedResult&&!Qe.supportedPromise){const Et=navigator.mediaCapabilities;typeof(Et==null?void 0:Et.decodingInfo)=="function"&&(pee(Qe,he,be,Se,i,Te)||AC(Qe.videoCodec))?(Qe.supportedPromise=h5(Qe,he,Et),Qe.supportedPromise.then(St=>{if(!this.hls)return;Qe.supportedResult=St;const it=this.hls.levels,Ze=it.indexOf(Qe);St.error?this.warn(`MediaCapabilities decodingInfo error: "${St.error}" for level ${Ze} ${ds(St)}`):St.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ze} ${ds(St)}`),Ze>-1&&it.length>1&&(this.log(`Removing unsupported level ${Ze}`),this.hls.removeLevel(Ze),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):Qe.supportedResult=d5}if((de&&Qe.codecSet!==de||be&&Qe.videoRange!==be||Ke&&Se>Qe.frameRate||!Ke&&Se>0&&Se<Qe.frameRate||Qe.supportedResult&&!((ut=Qe.supportedResult.decodingInfoResults)!=null&&ut[0].smooth))&&(!pe||Oe!==Ge)){qe.push(Oe);continue}const Re=Qe.details,se=(N?Re==null?void 0:Re.partTarget:Re==null?void 0:Re.averagetargetduration)||st;let we;Ke?we=y*i:we=g*i;const He=st&&d>=st*2&&p===0?Qe.averageBitrate:Qe.maxBitrate,ct=this.getTimeToLoadFrag(It,we,He*se,Re===void 0);if(we>=He&&(Oe===C||Qe.loadError===0&&Qe.fragmentError===0)&&(ct<=It||!xt(ct)||ee&&!this.bitrateTestDelay||ct<T)){const Et=this.forcedAutoLevel;return Oe!==H&&(Et===-1||Et!==H)&&(qe.length&&this.trace(`Skipped level(s) ${qe.join(",")} of ${o} max with CODECS and VIDEO-RANGE:"${x[qe[0]].codecs}" ${x[qe[0]].videoRange}; not compatible with "${de}" ${be}`),this.info(`switch candidate:${I}->${Oe} adjustedbw(${Math.round(we)})-bitrate=${Math.round(we-He)} ttfb:${It.toFixed(1)} avgDuration:${se.toFixed(1)} maxFetchDuration:${T.toFixed(1)} fetchDuration:${ct.toFixed(1)} firstSelection:${pe} codecSet:${Qe.codecSet} videoRange:${Qe.videoRange} hls.loadLevel:${H}`)),pe&&(this.firstSelection=Oe),Oe}}return-1}set nextAutoLevel(i){const r=this.deriveNextAutoLevel(i);this._nextAutoLevel!==r&&(this.nextAutoLevelKey="",this._nextAutoLevel=r)}deriveNextAutoLevel(i){const{maxAutoLevel:r,minAutoLevel:o}=this.hls;return Math.min(Math.max(i,o),r)}}const yL={search:function(h,i){let r=0,o=h.length-1,d=null,p=null;for(;r<=o;){d=(r+o)/2|0,p=h[d];const g=i(p);if(g>0)r=d+1;else if(g<0)o=d-1;else return p}return null}};function Iee(h,i,r){if(i===null||!Array.isArray(h)||!h.length||!xt(i))return null;const o=h[0].programDateTime;if(i<(o||0))return null;const d=h[h.length-1].endProgramDateTime;if(i>=(d||0))return null;r=r||0;for(let p=0;p<h.length;++p){const g=h[p];if(Oee(i,r,g))return g}return null}function xm(h,i,r=0,o=0,d=.005){let p=null;if(h){p=i[1+h.sn-i[0].sn]||null;const y=h.endDTS-r;y>0&&y<15e-7&&(r+=15e-7),p&&h.level!==p.level&&p.end<=h.end&&(p=i[2+h.sn-i[0].sn]||null)}else r===0&&i[0].start===0&&(p=i[0]);if(p&&((!h||h.level===p.level)&&J3(r,o,p)===0||wee(p,h,Math.min(d,o))))return p;const g=yL.search(i,J3.bind(null,r,o));return g&&(g!==h||!p)?g:p}function wee(h,i,r){if(i&&i.start===0&&i.level<h.level&&(i.endPTS||0)>0){const o=i.tagList.reduce((d,p)=>(p[0]==="INF"&&(d+=parseFloat(p[1])),d),r);return h.start<=o}return!1}function J3(h=0,i=0,r){if(r.start<=h&&r.start+r.duration>h)return 0;const o=Math.min(i,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-o<=h?1:r.start-o>h&&r.start?-1:0}function Oee(h,i,r){const o=Math.min(i,r.duration+(r.deltaPTS?r.deltaPTS:0))*1e3;return(r.endProgramDateTime||0)-o>h}function p5(h,i){return yL.search(h,r=>r.cc<i?1:r.cc>i?-1:0)}function Dee(h,i,r){if(h&&h.startCC<=i&&h.endCC>=i){const o=r.start,d=r.end;let p=h.fragments;if(!r.relurl){const{fragmentHint:g}=h;g&&(p=p.concat(g))}return yL.search(p,g=>g.cc<i||g.end<=o?1:g.cc>i||g.start>=d?-1:0)}return null}function dC(h){switch(h.details){case Ue.FRAG_LOAD_TIMEOUT:case Ue.KEY_LOAD_TIMEOUT:case Ue.LEVEL_LOAD_TIMEOUT:case Ue.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Q3(h,i){const r=dC(i);return h.default[`${r?"timeout":"error"}Retry`]}function TL(h,i){const r=h.backoff==="linear"?1:Math.pow(2,i);return Math.min(r*h.retryDelayMs,h.maxRetryDelayMs)}function Z3(h){return Ii(Ii({},h),{errorRetry:null,timeoutRetry:null})}function uC(h,i,r,o){if(!h)return!1;const d=o==null?void 0:o.code,p=i<h.maxNumRetry&&(Nee(d)||!!r);return h.shouldRetry?h.shouldRetry(h,i,r,o,p):p}function Nee(h){return h===0&&navigator.onLine===!1||!!h&&(h<400||h>499)}var Zr={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},rl={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2};class Lee extends Ou{constructor(i){super("error-controller",i.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=i,this.registerListeners()}registerListeners(){const i=this.hls;i.on(z.ERROR,this.onError,this),i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const i=this.hls;i&&(i.off(z.ERROR,this.onError,this),i.off(z.ERROR,this.onErrorOut,this),i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(i){}stopLoad(){this.playlistError=0}getVariantLevelIndex(i){return(i==null?void 0:i.type)===Vt.MAIN?i.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(i,r){var o;if(r.fatal)return;const d=this.hls,p=r.context;switch(r.details){case Ue.FRAG_LOAD_ERROR:case Ue.FRAG_LOAD_TIMEOUT:case Ue.KEY_LOAD_ERROR:case Ue.KEY_LOAD_TIMEOUT:r.errorAction=this.getFragRetryOrSwitchAction(r);return;case Ue.FRAG_PARSING_ERROR:if((o=r.frag)!=null&&o.gap){r.errorAction=dT();return}case Ue.FRAG_GAP:case Ue.FRAG_DECRYPT_ERROR:{r.errorAction=this.getFragRetryOrSwitchAction(r),r.errorAction.action=Zr.SendAlternateToPenaltyBox;return}case Ue.LEVEL_EMPTY_ERROR:case Ue.LEVEL_PARSING_ERROR:{var g,y;const T=r.parent===Vt.MAIN?r.level:d.loadLevel;r.details===Ue.LEVEL_EMPTY_ERROR&&((g=r.context)!=null&&(y=g.levelDetails)!=null&&y.live)?r.errorAction=this.getPlaylistRetryOrSwitchAction(r,T):(r.levelRetry=!1,r.errorAction=this.getLevelSwitchAction(r,T))}return;case Ue.LEVEL_LOAD_ERROR:case Ue.LEVEL_LOAD_TIMEOUT:typeof(p==null?void 0:p.level)=="number"&&(r.errorAction=this.getPlaylistRetryOrSwitchAction(r,p.level));return;case Ue.AUDIO_TRACK_LOAD_ERROR:case Ue.AUDIO_TRACK_LOAD_TIMEOUT:case Ue.SUBTITLE_LOAD_ERROR:case Ue.SUBTITLE_TRACK_LOAD_TIMEOUT:if(p){const T=d.loadLevelObj;if(T&&(p.type===Vn.AUDIO_TRACK&&T.hasAudioGroup(p.groupId)||p.type===Vn.SUBTITLE_TRACK&&T.hasSubtitleGroup(p.groupId))){r.errorAction=this.getPlaylistRetryOrSwitchAction(r,d.loadLevel),r.errorAction.action=Zr.SendAlternateToPenaltyBox,r.errorAction.flags=rl.MoveAllAlternatesMatchingHost;return}}return;case Ue.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const T=d.loadLevelObj,C=T==null?void 0:T.attrs["HDCP-LEVEL"];C?r.errorAction={action:Zr.SendAlternateToPenaltyBox,flags:rl.MoveAllAlternatesMatchingHDCP,hdcpLevel:C}:this.keySystemError(r)}return;case Ue.BUFFER_ADD_CODEC_ERROR:case Ue.REMUX_ALLOC_ERROR:case Ue.BUFFER_APPEND_ERROR:if(!r.errorAction){var v;r.errorAction=this.getLevelSwitchAction(r,(v=r.level)!=null?v:d.loadLevel)}return;case Ue.INTERNAL_EXCEPTION:case Ue.BUFFER_APPENDING_ERROR:case Ue.BUFFER_FULL_ERROR:case Ue.LEVEL_SWITCH_ERROR:case Ue.BUFFER_STALLED_ERROR:case Ue.BUFFER_SEEK_OVER_HOLE:case Ue.BUFFER_NUDGE_ON_STALL:r.errorAction=dT();return}r.type===Gt.KEY_SYSTEM_ERROR&&this.keySystemError(r)}keySystemError(i){const r=this.getVariantLevelIndex(i.frag);i.levelRetry=!1,i.errorAction=this.getLevelSwitchAction(i,r)}getPlaylistRetryOrSwitchAction(i,r){const o=this.hls,d=Q3(o.config.playlistLoadPolicy,i),p=this.playlistError++;if(uC(d,p,dC(i),i.response))return{action:Zr.RetryRequest,flags:rl.None,retryConfig:d,retryCount:p};const y=this.getLevelSwitchAction(i,r);return d&&(y.retryConfig=d,y.retryCount=p),y}getFragRetryOrSwitchAction(i){const r=this.hls,o=this.getVariantLevelIndex(i.frag),d=r.levels[o],{fragLoadPolicy:p,keyLoadPolicy:g}=r.config,y=Q3(i.details.startsWith("key")?g:p,i),v=r.levels.reduce((C,I)=>C+I.fragmentError,0);if(d&&(i.details!==Ue.FRAG_GAP&&d.fragmentError++,uC(y,v,dC(i),i.response)))return{action:Zr.RetryRequest,flags:rl.None,retryConfig:y,retryCount:v};const T=this.getLevelSwitchAction(i,o);return y&&(T.retryConfig=y,T.retryCount=v),T}getLevelSwitchAction(i,r){const o=this.hls;r==null&&(r=o.loadLevel);const d=this.hls.levels[r];if(d){var p,g;const T=i.details;d.loadError++,T===Ue.BUFFER_APPEND_ERROR&&d.fragmentError++;let C=-1;const{levels:I,loadLevel:L,minAutoLevel:N,maxAutoLevel:x}=o;o.autoLevelEnabled||(o.loadLevel=-1);const K=(p=i.frag)==null?void 0:p.type,Q=(K===Vt.AUDIO&&T===Ue.FRAG_PARSING_ERROR||i.sourceBufferName==="audio"&&(T===Ue.BUFFER_ADD_CODEC_ERROR||T===Ue.BUFFER_APPEND_ERROR))&&I.some(({audioCodec:be})=>d.audioCodec!==be),ee=i.sourceBufferName==="video"&&(T===Ue.BUFFER_ADD_CODEC_ERROR||T===Ue.BUFFER_APPEND_ERROR)&&I.some(({codecSet:be,audioCodec:Se})=>d.codecSet!==be&&d.audioCodec===Se),{type:pe,groupId:de}=(g=i.context)!=null?g:{};for(let be=I.length;be--;){const Se=(be+L)%I.length;if(Se!==L&&Se>=N&&Se<=x&&I[Se].loadError===0){var y,v;const Te=I[Se];if(T===Ue.FRAG_GAP&&K===Vt.MAIN&&i.frag){const _e=I[Se].details;if(_e){const he=xm(i.frag,_e.fragments,i.frag.start);if(he!=null&&he.gap)continue}}else{if(pe===Vn.AUDIO_TRACK&&Te.hasAudioGroup(de)||pe===Vn.SUBTITLE_TRACK&&Te.hasSubtitleGroup(de))continue;if(K===Vt.AUDIO&&(y=d.audioGroups)!=null&&y.some(_e=>Te.hasAudioGroup(_e))||K===Vt.SUBTITLE&&(v=d.subtitleGroups)!=null&&v.some(_e=>Te.hasSubtitleGroup(_e))||Q&&d.audioCodec===Te.audioCodec||!Q&&d.audioCodec!==Te.audioCodec||ee&&d.codecSet===Te.codecSet)continue}C=Se;break}}if(C>-1&&o.loadLevel!==C)return i.levelRetry=!0,this.playlistError=0,{action:Zr.SendAlternateToPenaltyBox,flags:rl.None,nextAutoLevel:C}}return{action:Zr.SendAlternateToPenaltyBox,flags:rl.MoveAllAlternatesMatchingHost}}onErrorOut(i,r){var o;switch((o=r.errorAction)==null?void 0:o.action){case Zr.DoNothing:break;case Zr.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(r),!r.errorAction.resolved&&r.details!==Ue.FRAG_GAP?r.fatal=!0:/MediaSource readyState: ended/.test(r.error.message)&&(this.warn(`MediaSource ended after "${r.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(r.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(i){const r=this.hls,o=i.errorAction;if(!o)return;const{flags:d,hdcpLevel:p,nextAutoLevel:g}=o;switch(d){case rl.None:this.switchLevel(i,g);break;case rl.MoveAllAlternatesMatchingHDCP:p&&(r.maxHdcpLevel=VN[VN.indexOf(p)-1],o.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${r.maxHdcpLevel}" or lower`);break}o.resolved||this.switchLevel(i,g)}switchLevel(i,r){if(r!==void 0&&i.errorAction&&(this.warn(`switching to level ${r} after ${i.details}`),this.hls.nextAutoLevel=r,i.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,i.details===Ue.BUFFER_ADD_CODEC_ERROR&&i.mimeType&&i.sourceBufferName!=="audiovideo")){const o=l5(i.mimeType),d=this.hls.levels;for(let p=d.length;p--;)d[p][`${i.sourceBufferName}Codec`]===o&&this.hls.removeLevel(p)}}}function dT(h){const i={action:Zr.DoNothing,flags:rl.None};return h&&(i.resolved=!0),i}var cr={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class xee{constructor(i){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=i,this._registerListeners()}_registerListeners(){const{hls:i}=this;i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.BUFFER_APPENDED,this.onBufferAppended,this),i.on(z.FRAG_BUFFERED,this.onFragBuffered,this),i.on(z.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:i}=this;i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.BUFFER_APPENDED,this.onBufferAppended,this),i.off(z.FRAG_BUFFERED,this.onFragBuffered,this),i.off(z.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(i,r){const o=this.activePartLists[r];if(o)for(let d=o.length;d--;){const p=o[d];if(!p)break;const g=p.end;if(p.start<=i&&g!==null&&i<=g)return p}return this.getBufferedFrag(i,r)}getBufferedFrag(i,r){return this.getFragAtPos(i,r,!0)}getFragAtPos(i,r,o){const{fragments:d}=this,p=Object.keys(d);for(let g=p.length;g--;){const y=d[p[g]];if((y==null?void 0:y.body.type)===r&&(!o||y.buffered)){const v=y.body;if(v.start<=i&&i<=v.end)return v}}return null}detectEvictedFragments(i,r,o,d,p){this.timeRanges&&(this.timeRanges[i]=r);const g=(d==null?void 0:d.fragment.sn)||-1;Object.keys(this.fragments).forEach(y=>{const v=this.fragments[y];if(!v||g>=v.body.sn)return;if(!v.buffered&&(!v.loaded||p)){v.body.type===o&&this.removeFragment(v.body);return}const T=v.range[i];if(T){if(T.time.length===0){this.removeFragment(v.body);return}T.time.some(C=>{const I=!this.isTimeBuffered(C.startPTS,C.endPTS,r);return I&&this.removeFragment(v.body),I})}})}detectPartialFragments(i){const r=this.timeRanges;if(!r||i.frag.sn==="initSegment")return;const o=i.frag,d=T_(o),p=this.fragments[d];if(!p||p.buffered&&o.gap)return;const g=!o.relurl;Object.keys(r).forEach(y=>{const v=o.elementaryStreams[y];if(!v)return;const T=r[y],C=g||v.partial===!0;p.range[y]=this.getBufferedTimes(o,i.part,C,T)}),p.loaded=null,Object.keys(p.range).length?(p.buffered=!0,(p.body.endList=o.endList||p.body.endList)&&(this.endListFragments[p.body.type]=p),IA(p)||this.removeParts(o.sn-1,o.type)):this.removeFragment(p.body)}removeParts(i,r){const o=this.activePartLists[r];o&&(this.activePartLists[r]=e4(o,d=>d.fragment.sn>=i))}fragBuffered(i,r){const o=T_(i);let d=this.fragments[o];!d&&r&&(d=this.fragments[o]={body:i,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},i.gap&&(this.hasGaps=!0)),d&&(d.loaded=null,d.buffered=!0)}getBufferedTimes(i,r,o,d){const p={time:[],partial:o},g=i.start,y=i.end,v=i.minEndPTS||y,T=i.maxStartPTS||g;for(let C=0;C<d.length;C++){const I=d.start(C)-this.bufferPadding,L=d.end(C)+this.bufferPadding;if(T>=I&&v<=L){p.time.push({startPTS:Math.max(g,d.start(C)),endPTS:Math.min(y,d.end(C))});break}else if(g<L&&y>I){const N=Math.max(g,d.start(C)),x=Math.min(y,d.end(C));x>N&&(p.partial=!0,p.time.push({startPTS:N,endPTS:x}))}else if(y<=I)break}return p}getPartialFragment(i){let r=null,o,d,p,g=0;const{bufferPadding:y,fragments:v}=this;return Object.keys(v).forEach(T=>{const C=v[T];C&&IA(C)&&(d=C.body.start-y,p=C.body.end+y,i>=d&&i<=p&&(o=Math.min(i-d,p-i),g<=o&&(r=C.body,g=o)))}),r}isEndListAppended(i){const r=this.endListFragments[i];return r!==void 0&&(r.buffered||IA(r))}getState(i){const r=T_(i),o=this.fragments[r];return o?o.buffered?IA(o)?cr.PARTIAL:cr.OK:cr.APPENDING:cr.NOT_LOADED}isTimeBuffered(i,r,o){let d,p;for(let g=0;g<o.length;g++){if(d=o.start(g)-this.bufferPadding,p=o.end(g)+this.bufferPadding,i>=d&&r<=p)return!0;if(r<=d)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(i,r){if(r.frag.sn==="initSegment"||r.frag.bitrateTest)return;const o=r.frag,d=r.part?null:r,p=T_(o);this.fragments[p]={body:o,appendedPTS:null,loaded:d,buffered:!1,range:Object.create(null)}}onBufferAppended(i,r){const{frag:o,part:d,timeRanges:p,type:g}=r;if(o.sn==="initSegment")return;const y=o.type;if(d){let T=this.activePartLists[y];T||(this.activePartLists[y]=T=[]),T.push(d)}this.timeRanges=p;const v=p[g];this.detectEvictedFragments(g,v,y,d)}onFragBuffered(i,r){this.detectPartialFragments(r)}hasFragment(i){const r=T_(i);return!!this.fragments[r]}hasFragments(i){const{fragments:r}=this,o=Object.keys(r);if(!i)return o.length>0;for(let d=o.length;d--;){const p=r[o[d]];if((p==null?void 0:p.body.type)===i)return!0}return!1}hasParts(i){var r;return!!((r=this.activePartLists[i])!=null&&r.length)}removeFragmentsInRange(i,r,o,d,p){d&&!this.hasGaps||Object.keys(this.fragments).forEach(g=>{const y=this.fragments[g];if(!y)return;const v=y.body;v.type!==o||d&&!v.gap||v.start<r&&v.end>i&&(y.buffered||p)&&this.removeFragment(v)})}removeFragment(i){const r=T_(i);i.clearElementaryStreamInfo();const o=this.activePartLists[i.type];if(o){const d=i.sn;this.activePartLists[i.type]=e4(o,p=>p.fragment.sn!==d)}delete this.fragments[r],i.endList&&delete this.endListFragments[i.type]}removeAllFragments(){var i,r;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const o=(i=this.hls)==null||(r=i.latestLevelDetails)==null?void 0:r.partList;o&&o.forEach(d=>d.clearElementaryStreamInfo())}}function IA(h){var i,r,o;return h.buffered&&(h.body.gap||((i=h.range.video)==null?void 0:i.partial)||((r=h.range.audio)==null?void 0:r.partial)||((o=h.range.audiovideo)==null?void 0:o.partial))}function T_(h){return`${h.type}_${h.level}_${h.sn}`}function e4(h,i){return h.filter(r=>{const o=i(r);return o||r.clearElementaryStreamInfo(),o})}var hf={cbc:0,ctr:1};class Pee{constructor(i,r,o){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=i,this.aesIV=r,this.aesMode=o}decrypt(i,r){switch(this.aesMode){case hf.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},r,i);case hf.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},r,i);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function kee(h){const i=h.byteLength,r=i&&new DataView(h.buffer).getUint8(i-1);return r?h.slice(0,i-r):h}class Mee{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(i){const r=new DataView(i),o=new Uint32Array(4);for(let d=0;d<4;d++)o[d]=r.getUint32(d*4);return o}initTable(){const i=this.sBox,r=this.invSBox,o=this.subMix,d=o[0],p=o[1],g=o[2],y=o[3],v=this.invSubMix,T=v[0],C=v[1],I=v[2],L=v[3],N=new Uint32Array(256);let x=0,K=0,H=0;for(H=0;H<256;H++)H<128?N[H]=H<<1:N[H]=H<<1^283;for(H=0;H<256;H++){let Q=K^K<<1^K<<2^K<<3^K<<4;Q=Q>>>8^Q&255^99,i[x]=Q,r[Q]=x;const ne=N[x],ee=N[ne],pe=N[ee];let de=N[Q]*257^Q*16843008;d[x]=de<<24|de>>>8,p[x]=de<<16|de>>>16,g[x]=de<<8|de>>>24,y[x]=de,de=pe*16843009^ee*65537^ne*257^x*16843008,T[Q]=de<<24|de>>>8,C[Q]=de<<16|de>>>16,I[Q]=de<<8|de>>>24,L[Q]=de,x?(x=ne^N[N[N[pe^ne]]],K^=N[N[K]]):x=K=1}}expandKey(i){const r=this.uint8ArrayToUint32Array_(i);let o=!0,d=0;for(;d<r.length&&o;)o=r[d]===this.key[d],d++;if(o)return;this.key=r;const p=this.keySize=r.length;if(p!==4&&p!==6&&p!==8)throw new Error("Invalid aes key size="+p);const g=this.ksRows=(p+6+1)*4;let y,v;const T=this.keySchedule=new Uint32Array(g),C=this.invKeySchedule=new Uint32Array(g),I=this.sBox,L=this.rcon,N=this.invSubMix,x=N[0],K=N[1],H=N[2],Q=N[3];let ne,ee;for(y=0;y<g;y++){if(y<p){ne=T[y]=r[y];continue}ee=ne,y%p===0?(ee=ee<<8|ee>>>24,ee=I[ee>>>24]<<24|I[ee>>>16&255]<<16|I[ee>>>8&255]<<8|I[ee&255],ee^=L[y/p|0]<<24):p>6&&y%p===4&&(ee=I[ee>>>24]<<24|I[ee>>>16&255]<<16|I[ee>>>8&255]<<8|I[ee&255]),T[y]=ne=(T[y-p]^ee)>>>0}for(v=0;v<g;v++)y=g-v,v&3?ee=T[y]:ee=T[y-4],v<4||y<=4?C[v]=ee:C[v]=x[I[ee>>>24]]^K[I[ee>>>16&255]]^H[I[ee>>>8&255]]^Q[I[ee&255]],C[v]=C[v]>>>0}networkToHostOrderSwap(i){return i<<24|(i&65280)<<8|(i&16711680)>>8|i>>>24}decrypt(i,r,o){const d=this.keySize+6,p=this.invKeySchedule,g=this.invSBox,y=this.invSubMix,v=y[0],T=y[1],C=y[2],I=y[3],L=this.uint8ArrayToUint32Array_(o);let N=L[0],x=L[1],K=L[2],H=L[3];const Q=new Int32Array(i),ne=new Int32Array(Q.length);let ee,pe,de,be,Se,Te,_e,he,Ge,st,It,qe,ut,Oe;const Qe=this.networkToHostOrderSwap;for(;r<Q.length;){for(Ge=Qe(Q[r]),st=Qe(Q[r+1]),It=Qe(Q[r+2]),qe=Qe(Q[r+3]),Se=Ge^p[0],Te=qe^p[1],_e=It^p[2],he=st^p[3],ut=4,Oe=1;Oe<d;Oe++)ee=v[Se>>>24]^T[Te>>16&255]^C[_e>>8&255]^I[he&255]^p[ut],pe=v[Te>>>24]^T[_e>>16&255]^C[he>>8&255]^I[Se&255]^p[ut+1],de=v[_e>>>24]^T[he>>16&255]^C[Se>>8&255]^I[Te&255]^p[ut+2],be=v[he>>>24]^T[Se>>16&255]^C[Te>>8&255]^I[_e&255]^p[ut+3],Se=ee,Te=pe,_e=de,he=be,ut=ut+4;ee=g[Se>>>24]<<24^g[Te>>16&255]<<16^g[_e>>8&255]<<8^g[he&255]^p[ut],pe=g[Te>>>24]<<24^g[_e>>16&255]<<16^g[he>>8&255]<<8^g[Se&255]^p[ut+1],de=g[_e>>>24]<<24^g[he>>16&255]<<16^g[Se>>8&255]<<8^g[Te&255]^p[ut+2],be=g[he>>>24]<<24^g[Se>>16&255]<<16^g[Te>>8&255]<<8^g[_e&255]^p[ut+3],ne[r]=Qe(ee^N),ne[r+1]=Qe(be^x),ne[r+2]=Qe(de^K),ne[r+3]=Qe(pe^H),N=Ge,x=st,K=It,H=qe,r=r+4}return ne.buffer}}class Uee{constructor(i,r,o){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=i,this.key=r,this.aesMode=o}expandKey(){const i=Fee(this.aesMode);return this.subtle.importKey("raw",this.key,{name:i},!1,["encrypt","decrypt"])}}function Fee(h){switch(h){case hf.cbc:return"AES-CBC";case hf.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${h}`)}}const Bee=16;class vL{constructor(i,{removePKCS7Padding:r=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=i.enableSoftwareAES,this.removePKCS7Padding=r,r)try{const o=self.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:i,remainderData:r}=this;if(!i||r)return this.reset(),null;const o=new Uint8Array(i);return this.reset(),this.removePKCS7Padding?kee(o):o}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(i,r,o,d){return this.useSoftware?new Promise((p,g)=>{const y=ArrayBuffer.isView(i)?i:new Uint8Array(i);this.softwareDecrypt(y,r,o,d);const v=this.flush();v?p(v.buffer):g(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(i),r,o,d)}softwareDecrypt(i,r,o,d){const{currentIV:p,currentResult:g,remainderData:y}=this;if(d!==hf.cbc||r.byteLength!==16)return Zn.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),y&&(i=dc(y,i),this.remainderData=null);const v=this.getValidChunk(i);if(!v.length)return null;p&&(o=p);let T=this.softwareDecrypter;T||(T=this.softwareDecrypter=new Mee),T.expandKey(r);const C=g;return this.currentResult=T.decrypt(v.buffer,0,o),this.currentIV=v.slice(-16).buffer,C||null}webCryptoDecrypt(i,r,o,d){if(this.key!==r||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(i,r,o,d));this.key=r,this.fastAesKey=new Uee(this.subtle,r,d)}return this.fastAesKey.expandKey().then(p=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Pee(this.subtle,new Uint8Array(o),d).decrypt(i.buffer,p)):Promise.reject(new Error("web crypto not initialized"))).catch(p=>(Zn.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${p.name}: ${p.message}`),this.onWebCryptoError(i,r,o,d)))}onWebCryptoError(i,r,o,d){const p=this.enableSoftwareAES;if(p){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(i,r,o,d);const g=this.flush();if(g)return g.buffer}throw new Error("WebCrypto"+(p?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(i){let r=i;const o=i.length-i.length%Bee;return o!==i.length&&(r=i.slice(0,o),this.remainderData=i.slice(o)),r}logOnce(i){this.logEnabled&&(Zn.log(`[decrypter]: ${i}`),this.logEnabled=!1)}}const t4=Math.pow(2,17);class Vee{constructor(i){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=i}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(i,r){const o=i.url;if(!o)return Promise.reject(new vu({type:Gt.NETWORK_ERROR,details:Ue.FRAG_LOAD_ERROR,fatal:!1,frag:i,error:new Error(`Fragment does not have a ${o?"part list":"url"}`),networkDetails:null}));this.abort();const d=this.config,p=d.fLoader,g=d.loader;return new Promise((y,v)=>{if(this.loader&&this.loader.destroy(),i.gap)if(i.tagList.some(x=>x[0]==="GAP")){v(i4(i));return}else i.gap=!1;const T=this.loader=p?new p(d):new g(d),C=n4(i);i.loader=T;const I=Z3(d.fragLoadPolicy.default),L={loadPolicy:I,timeout:I.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:i.sn==="initSegment"?1/0:t4};i.stats=T.stats;const N={onSuccess:(x,K,H,Q)=>{this.resetLoader(i,T);let ne=x.data;H.resetIV&&i.decryptdata&&(i.decryptdata.iv=new Uint8Array(ne.slice(0,16)),ne=ne.slice(16)),y({frag:i,part:null,payload:ne,networkDetails:Q})},onError:(x,K,H,Q)=>{this.resetLoader(i,T),v(new vu({type:Gt.NETWORK_ERROR,details:Ue.FRAG_LOAD_ERROR,fatal:!1,frag:i,response:Ii({url:o,data:void 0},x),error:new Error(`HTTP Error ${x.code} ${x.text}`),networkDetails:H,stats:Q}))},onAbort:(x,K,H)=>{this.resetLoader(i,T),v(new vu({type:Gt.NETWORK_ERROR,details:Ue.INTERNAL_ABORTED,fatal:!1,frag:i,error:new Error("Aborted"),networkDetails:H,stats:x}))},onTimeout:(x,K,H)=>{this.resetLoader(i,T),v(new vu({type:Gt.NETWORK_ERROR,details:Ue.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i,error:new Error(`Timeout after ${L.timeout}ms`),networkDetails:H,stats:x}))}};r&&(N.onProgress=(x,K,H,Q)=>r({frag:i,part:null,payload:H,networkDetails:Q})),T.load(C,L,N)})}loadPart(i,r,o){this.abort();const d=this.config,p=d.fLoader,g=d.loader;return new Promise((y,v)=>{if(this.loader&&this.loader.destroy(),i.gap||r.gap){v(i4(i,r));return}const T=this.loader=p?new p(d):new g(d),C=n4(i,r);i.loader=T;const I=Z3(d.fragLoadPolicy.default),L={loadPolicy:I,timeout:I.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:t4};r.stats=T.stats,T.load(C,L,{onSuccess:(N,x,K,H)=>{this.resetLoader(i,T),this.updateStatsFromPart(i,r);const Q={frag:i,part:r,payload:N.data,networkDetails:H};o(Q),y(Q)},onError:(N,x,K,H)=>{this.resetLoader(i,T),v(new vu({type:Gt.NETWORK_ERROR,details:Ue.FRAG_LOAD_ERROR,fatal:!1,frag:i,part:r,response:Ii({url:C.url,data:void 0},N),error:new Error(`HTTP Error ${N.code} ${N.text}`),networkDetails:K,stats:H}))},onAbort:(N,x,K)=>{i.stats.aborted=r.stats.aborted,this.resetLoader(i,T),v(new vu({type:Gt.NETWORK_ERROR,details:Ue.INTERNAL_ABORTED,fatal:!1,frag:i,part:r,error:new Error("Aborted"),networkDetails:K,stats:N}))},onTimeout:(N,x,K)=>{this.resetLoader(i,T),v(new vu({type:Gt.NETWORK_ERROR,details:Ue.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i,part:r,error:new Error(`Timeout after ${L.timeout}ms`),networkDetails:K,stats:N}))}})})}updateStatsFromPart(i,r){const o=i.stats,d=r.stats,p=d.total;if(o.loaded+=d.loaded,p){const v=Math.round(i.duration/r.duration),T=Math.min(Math.round(o.loaded/p),v),I=(v-T)*Math.round(o.loaded/T);o.total=o.loaded+I}else o.total=Math.max(o.loaded,o.total);const g=o.loading,y=d.loading;g.start?g.first+=y.first-y.start:(g.start=y.start,g.first=y.first),g.end=y.end}resetLoader(i,r){i.loader=null,this.loader===r&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),r.destroy()}}function n4(h,i=null){const r=i||h,o={frag:h,part:i,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},d=r.byteRangeStartOffset,p=r.byteRangeEndOffset;if(xt(d)&&xt(p)){var g;let y=d,v=p;if(h.sn==="initSegment"&&jee((g=h.decryptdata)==null?void 0:g.method)){const T=p-d;T%16&&(v=p+(16-T%16)),d!==0&&(o.resetIV=!0,y=d-16)}o.rangeStart=y,o.rangeEnd=v}return o}function i4(h,i){const r=new Error(`GAP ${h.gap?"tag":"attribute"} found`),o={type:Gt.MEDIA_ERROR,details:Ue.FRAG_GAP,fatal:!1,frag:h,error:r,networkDetails:null};return i&&(o.part=i),(i||h).stats.aborted=!0,new vu(o)}function jee(h){return h==="AES-128"||h==="AES-256"}class vu extends Error{constructor(i){super(i.error.message),this.data=void 0,this.data=i}}class m5 extends Ou{constructor(i,r){super(i,r),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(i){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,i),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class bL{constructor(i,r,o,d=0,p=-1,g=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=wA(),this.buffering={audio:wA(),video:wA(),audiovideo:wA()},this.level=i,this.sn=r,this.id=o,this.size=d,this.part=p,this.partial=g}}function wA(){return{start:0,executeStart:0,executeEnd:0,end:0}}const s4={length:0,start:()=>0,end:()=>0};class Dn{static isBuffered(i,r){if(i){const o=Dn.getBuffered(i);for(let d=o.length;d--;)if(r>=o.start(d)&&r<=o.end(d))return!0}return!1}static bufferedRanges(i){if(i){const r=Dn.getBuffered(i);return Dn.timeRangesToArray(r)}return[]}static timeRangesToArray(i){const r=[];for(let o=0;o<i.length;o++)r.push({start:i.start(o),end:i.end(o)});return r}static bufferInfo(i,r,o){if(i){const d=Dn.bufferedRanges(i);if(d.length)return Dn.bufferedInfo(d,r,o)}return{len:0,start:r,end:r,bufferedIndex:-1}}static bufferedInfo(i,r,o){r=Math.max(0,r),i.length>1&&i.sort((C,I)=>C.start-I.start||I.end-C.end);let d=-1,p=[];if(o)for(let C=0;C<i.length;C++){r>=i[C].start&&r<=i[C].end&&(d=C);const I=p.length;if(I){const L=p[I-1].end;i[C].start-L<o?i[C].end>L&&(p[I-1].end=i[C].end):p.push(i[C])}else p.push(i[C])}else p=i;let g=0,y,v=r,T=r;for(let C=0;C<p.length;C++){const I=p[C].start,L=p[C].end;if(d===-1&&r>=I&&r<=L&&(d=C),r+o>=I&&r<L)v=I,T=L,g=T-r;else if(r+o<I){y=I;break}}return{len:g,start:v||0,end:T||0,nextStart:y,buffered:i,bufferedIndex:d}}static getBuffered(i){try{return i.buffered||s4}catch(r){return Zn.log("failed to get media.buffered",r),s4}}}const g5=/\{\$([a-zA-Z0-9-_]+)\}/g;function r4(h){return g5.test(h)}function jN(h,i){if(h.variableList!==null||h.hasVariableRefs){const r=h.variableList;return i.replace(g5,o=>{const d=o.substring(2,o.length-1),p=r==null?void 0:r[d];return p===void 0?(h.playlistParsingError||(h.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${d}"`)),o):p})}return i}function a4(h,i,r){let o=h.variableList;o||(h.variableList=o={});let d,p;if("QUERYPARAM"in i){d=i.QUERYPARAM;try{const g=new self.URL(r).searchParams;if(g.has(d))p=g.get(d);else throw new Error(`"${d}" does not match any query parameter in URI: "${r}"`)}catch(g){h.playlistParsingError||(h.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${g.message}`))}}else d=i.NAME,p=i.VALUE;d in o?h.playlistParsingError||(h.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${d}"`)):o[d]=p||""}function Gee(h,i,r){const o=i.IMPORT;if(r&&o in r){let d=h.variableList;d||(h.variableList=d={}),d[o]=r[o]}else h.playlistParsingError||(h.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${o}"`))}const Hee=/^(\d+)x(\d+)$/,o4=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Ss{constructor(i,r){typeof i=="string"&&(i=Ss.parseAttrList(i,r)),Mi(this,i)}get clientAttrs(){return Object.keys(this).filter(i=>i.substring(0,2)==="X-")}decimalInteger(i){const r=parseInt(this[i],10);return r>Number.MAX_SAFE_INTEGER?1/0:r}hexadecimalInteger(i){if(this[i]){let r=(this[i]||"0x").slice(2);r=(r.length&1?"0":"")+r;const o=new Uint8Array(r.length/2);for(let d=0;d<r.length/2;d++)o[d]=parseInt(r.slice(d*2,d*2+2),16);return o}return null}hexadecimalIntegerAsNumber(i){const r=parseInt(this[i],16);return r>Number.MAX_SAFE_INTEGER?1/0:r}decimalFloatingPoint(i){return parseFloat(this[i])}optionalFloat(i,r){const o=this[i];return o?parseFloat(o):r}enumeratedString(i){return this[i]}enumeratedStringList(i,r){const o=this[i];return(o?o.split(/[ ,]+/):[]).reduce((d,p)=>(d[p.toLowerCase()]=!0,d),r)}bool(i){return this[i]==="YES"}decimalResolution(i){const r=Hee.exec(this[i]);if(r!==null)return{width:parseInt(r[1],10),height:parseInt(r[2],10)}}static parseAttrList(i,r){let o;const d={},p='"';for(o4.lastIndex=0;(o=o4.exec(i))!==null;){const g=o[1].trim();let y=o[2];const v=y.indexOf(p)===0&&y.lastIndexOf(p)===y.length-1;let T=!1;if(v)y=y.slice(1,-1);else switch(g){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":T=!0}if(r&&(v||T))y=jN(r,y);else if(!T&&!v)switch(g){case"CLOSED-CAPTIONS":if(y==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Zn.warn(`${i}: attribute ${g} is missing quotes`)}d[g]=y}return d}}const Kee="com.apple.hls.interstitial";function Wee(h){return h!=="ID"&&h!=="CLASS"&&h!=="CUE"&&h!=="START-DATE"&&h!=="DURATION"&&h!=="END-DATE"&&h!=="END-ON-NEXT"}function Yee(h){return h==="SCTE35-OUT"||h==="SCTE35-IN"||h==="SCTE35-CMD"}class E5{constructor(i,r,o=0){var d;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(r==null?void 0:r.tagAnchor)||null,this.tagOrder=(d=r==null?void 0:r.tagOrder)!=null?d:o,r){const p=r.attr;for(const g in p)if(Object.prototype.hasOwnProperty.call(i,g)&&i[g]!==p[g]){Zn.warn(`DATERANGE tag attribute: "${g}" does not match for tags with ID: "${i.ID}"`),this._badValueForSameId=g;break}i=Mi(new Ss({}),p,i)}if(this.attr=i,r?(this._startDate=r._startDate,this._cue=r._cue,this._endDate=r._endDate,this._dateAtEnd=r._dateAtEnd):this._startDate=new Date(i["START-DATE"]),"END-DATE"in this.attr){const p=(r==null?void 0:r.endDate)||new Date(this.attr["END-DATE"]);xt(p.getTime())&&(this._endDate=p)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const i=this._cue;return i===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):i}get startTime(){const{tagAnchor:i}=this;return i===null||i.programDateTime===null?(Zn.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${i}`),NaN):i.start+(this.startDate.getTime()-i.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const i=this._endDate||this._dateAtEnd;if(i)return i;const r=this.duration;return r!==null?this._dateAtEnd=new Date(this._startDate.getTime()+r*1e3):null}get duration(){if("DURATION"in this.attr){const i=this.attr.decimalFloatingPoint("DURATION");if(xt(i))return i}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Kee}get isValid(){return!!this.id&&!this._badValueForSameId&&xt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const qee=10;class $ee{constructor(i){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=i}reloaded(i){if(!i){this.advanced=!0,this.updated=!0;return}const r=this.lastPartSn-i.lastPartSn,o=this.lastPartIndex-i.lastPartIndex;this.updated=this.endSN!==i.endSN||!!o||!!r||!this.live,this.advanced=this.endSN>i.endSN||r>0||r===0&&o>0,this.updated||this.advanced?this.misses=Math.floor(i.misses*.6):this.misses=i.misses+1}get hasProgramDateTime(){return this.fragments.length?xt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||qee}get drift(){const i=this.driftEndTime-this.driftStartTime;return i>0?(this.driftEnd-this.driftStart)*1e3/i:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var i;return(i=this.partList)!=null&&i.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var i;return(i=this.fragments)!=null&&i.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var i;return(i=this.fragments)!=null&&i.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var i;return(i=this.partList)!=null&&i.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const i=this.partList;if(i){const r=this.lastPartIndex;if(r!==-1){for(let o=i.length;o--;)if(i[o].index>r)return i[o].index;return r}}return 0}get lastPartSn(){var i;return(i=this.partList)!=null&&i.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const i=this.partEnd-this.fragmentStart;return this.age>Math.max(i,this.totalduration)+this.levelTargetDuration}return!1}}function C_(h){return h==="AES-128"||h==="AES-256"||h==="AES-256-CTR"}function RL(h){switch(h){case"AES-128":case"AES-256":return hf.cbc;case"AES-256-CTR":return hf.ctr;default:throw new Error(`invalid full segment method ${h}`)}}function AL(h){return Uint8Array.from(atob(h),i=>i.charCodeAt(0))}function GN(h){return Uint8Array.from(unescape(encodeURIComponent(h)),i=>i.charCodeAt(0))}function zee(h){const i=GN(h).subarray(0,16),r=new Uint8Array(16);return r.set(i,16-i.length),r}function Xee(h){const i=function(o,d,p){const g=o[d];o[d]=o[p],o[p]=g};i(h,0,3),i(h,1,2),i(h,4,5),i(h,6,7)}function Jee(h){const i=h.split(":");let r=null;if(i[0]==="data"&&i.length===2){const o=i[1].split(";"),d=o[o.length-1].split(",");if(d.length===2){const p=d[0]==="base64",g=d[1];p?(o.splice(-1,1),r=AL(g)):r=zee(g)}}return r}const hC=typeof self<"u"?self:void 0;var wi={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ka={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function aN(h){switch(h){case Ka.FAIRPLAY:return wi.FAIRPLAY;case Ka.PLAYREADY:return wi.PLAYREADY;case Ka.WIDEVINE:return wi.WIDEVINE;case Ka.CLEARKEY:return wi.CLEARKEY}}var OA={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function oN(h){if(h===OA.WIDEVINE)return wi.WIDEVINE;if(h===OA.PLAYREADY)return wi.PLAYREADY;if(h===OA.CENC||h===OA.CLEARKEY)return wi.CLEARKEY}function cN(h){switch(h){case wi.FAIRPLAY:return Ka.FAIRPLAY;case wi.PLAYREADY:return Ka.PLAYREADY;case wi.WIDEVINE:return Ka.WIDEVINE;case wi.CLEARKEY:return Ka.CLEARKEY}}function DA(h){const{drmSystems:i,widevineLicenseUrl:r}=h,o=i?[wi.FAIRPLAY,wi.WIDEVINE,wi.PLAYREADY,wi.CLEARKEY].filter(d=>!!i[d]):[];return!o[wi.WIDEVINE]&&r&&o.push(wi.WIDEVINE),o}const _5=function(h){return hC!=null&&(h=hC.navigator)!=null&&h.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Qee(h,i,r,o){let d;switch(h){case wi.FAIRPLAY:d=["cenc","sinf"];break;case wi.WIDEVINE:case wi.PLAYREADY:d=["cenc"];break;case wi.CLEARKEY:d=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${h}`)}return Zee(d,i,r,o)}function Zee(h,i,r,o){return[{initDataTypes:h,persistentState:o.persistentState||"optional",distinctiveIdentifier:o.distinctiveIdentifier||"optional",sessionTypes:o.sessionTypes||[o.sessionType||"temporary"],audioCapabilities:i.map(p=>({contentType:`audio/mp4; codecs=${p}`,robustness:o.audioRobustness||"",encryptionScheme:o.audioEncryptionScheme||null})),videoCapabilities:r.map(p=>({contentType:`video/mp4; codecs=${p}`,robustness:o.videoRobustness||"",encryptionScheme:o.videoEncryptionScheme||null}))}]}function ete(h){var i;return h.sessionType==="persistent-license"||!!((i=h.sessionTypes)!=null&&i.some(r=>r==="persistent-license"))}function S5(h){const i=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/2),r=String.fromCharCode.apply(null,Array.from(i)),o=r.substring(r.indexOf("<"),r.length),g=new DOMParser().parseFromString(o,"text/xml").getElementsByTagName("KID")[0];if(g){const y=g.childNodes[0]?g.childNodes[0].nodeValue:g.getAttribute("VALUE");if(y){const v=AL(y).subarray(0,16);return Xee(v),v}}return null}let NA={};class uT{static clearKeyUriToKeyIdMap(){NA={}}constructor(i,r,o,d=[1],p=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=i,this.uri=r,this.keyFormat=o,this.keyFormatVersions=d,this.iv=p,this.encrypted=i?i!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!C_(i)}isSupported(){if(this.method){if(C_(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ka.FAIRPLAY:case Ka.WIDEVINE:case Ka.PLAYREADY:case Ka.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(i){if(!this.encrypted||!this.uri)return null;if(C_(this.method)&&this.uri&&!this.iv){typeof i!="number"&&(Zn.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),i=0);const o=tte(i);return new uT(this.method,this.uri,"identity",this.keyFormatVersions,o)}const r=Jee(this.uri);if(r)switch(this.keyFormat){case Ka.WIDEVINE:this.pssh=r,r.length>=22&&(this.keyId=r.subarray(r.length-22,r.length-6));break;case Ka.PLAYREADY:{const o=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=aee(o,null,r),this.keyId=S5(r);break}default:{let o=r.subarray(0,16);if(o.length!==16){const d=new Uint8Array(16);d.set(o,16-o.length),o=d}this.keyId=o;break}}if(!this.keyId||this.keyId.byteLength!==16){let o=NA[this.uri];if(!o){const d=Object.keys(NA).length%Number.MAX_SAFE_INTEGER;o=new Uint8Array(16),new DataView(o.buffer,12,4).setUint32(0,d),NA[this.uri]=o}this.keyId=o}return this}}function tte(h){const i=new Uint8Array(16);for(let r=12;r<16;r++)i[r]=h>>8*(15-r)&255;return i}const c4=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,l4=/#EXT-X-MEDIA:(.*)/g,nte=/^#EXT(?:INF|-X-TARGETDURATION):/m,lN=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),ite=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Ed{static findGroup(i,r){for(let o=0;o<i.length;o++){const d=i[o];if(d.id===r)return d}}static resolve(i,r){return EL.buildAbsoluteURL(r,i,{alwaysNormalize:!0})}static isMediaPlaylist(i){return nte.test(i)}static parseMasterPlaylist(i,r){const o=r4(i),d={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:o},p=[];c4.lastIndex=0;let g;for(;(g=c4.exec(i))!=null;)if(g[1]){var y;const T=new Ss(g[1],d),C=jN(d,g[2]),I={attrs:T,bitrate:T.decimalInteger("BANDWIDTH")||T.decimalInteger("AVERAGE-BANDWIDTH"),name:T.NAME,url:Ed.resolve(C,r)},L=T.decimalResolution("RESOLUTION");L&&(I.width=L.width,I.height=L.height),h4(T.CODECS,I);const N=T["SUPPLEMENTAL-CODECS"];N&&(I.supplemental={},h4(N,I.supplemental)),(y=I.unknownCodecs)!=null&&y.length||p.push(I),d.levels.push(I)}else if(g[3]){const T=g[3],C=g[4];switch(T){case"SESSION-DATA":{const I=new Ss(C,d),L=I["DATA-ID"];L&&(d.sessionData===null&&(d.sessionData={}),d.sessionData[L]=I);break}case"SESSION-KEY":{const I=d4(C,r,d);I.encrypted&&I.isSupported()?(d.sessionKeys===null&&(d.sessionKeys=[]),d.sessionKeys.push(I)):Zn.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${C}"`);break}case"DEFINE":{{const I=new Ss(C,d);a4(d,I,r)}break}case"CONTENT-STEERING":{const I=new Ss(C,d);d.contentSteering={uri:Ed.resolve(I["SERVER-URI"],r),pathwayId:I["PATHWAY-ID"]||"."};break}case"START":{d.startTimeOffset=u4(C);break}}}const v=p.length>0&&p.length<d.levels.length;return d.levels=v?p:d.levels,d.levels.length===0&&(d.playlistParsingError=new Error("no levels found in manifest")),d}static parseMasterPlaylistMedia(i,r,o){let d;const p={},g=o.levels,y={AUDIO:g.map(T=>({id:T.attrs.AUDIO,audioCodec:T.audioCodec})),SUBTITLES:g.map(T=>({id:T.attrs.SUBTITLES,textCodec:T.textCodec})),"CLOSED-CAPTIONS":[]};let v=0;for(l4.lastIndex=0;(d=l4.exec(i))!==null;){const T=new Ss(d[1],o),C=T.TYPE;if(C){const I=y[C],L=p[C]||[];p[C]=L;const N=T.LANGUAGE,x=T["ASSOC-LANGUAGE"],K=T.CHANNELS,H=T.CHARACTERISTICS,Q=T["INSTREAM-ID"],ne={attrs:T,bitrate:0,id:v++,groupId:T["GROUP-ID"]||"",name:T.NAME||N||"",type:C,default:T.bool("DEFAULT"),autoselect:T.bool("AUTOSELECT"),forced:T.bool("FORCED"),lang:N,url:T.URI?Ed.resolve(T.URI,r):""};if(x&&(ne.assocLang=x),K&&(ne.channels=K),H&&(ne.characteristics=H),Q&&(ne.instreamId=Q),I!=null&&I.length){const ee=Ed.findGroup(I,ne.groupId)||I[0];f4(ne,ee,"audioCodec"),f4(ne,ee,"textCodec")}L.push(ne)}}return p}static parseLevelPlaylist(i,r,o,d,p,g){var y;const v={url:r},T=new $ee(r),C=T.fragments,I=[];let L=null,N=0,x=0,K=0,H=0,Q=0,ne=null,ee=new nN(d,v),pe,de,be,Se=-1,Te=!1,_e=null,he;if(lN.lastIndex=0,T.m3u8=i,T.hasVariableRefs=r4(i),((y=lN.exec(i))==null?void 0:y[0])!=="#EXTM3U")return T.playlistParsingError=new Error("Missing format identifier #EXTM3U"),T;for(;(pe=lN.exec(i))!==null;){Te&&(Te=!1,ee=new nN(d,v),ee.playlistOffset=K,ee.start=K,ee.sn=N,ee.cc=H,Q&&(ee.bitrate=Q),ee.level=o,L&&(ee.initSegment=L,L.rawProgramDateTime&&(ee.rawProgramDateTime=L.rawProgramDateTime,L.rawProgramDateTime=null),_e&&(ee.setByteRange(_e),_e=null)));const qe=pe[1];if(qe){ee.duration=parseFloat(qe);const ut=(" "+pe[2]).slice(1);ee.title=ut||null,ee.tagList.push(ut?["INF",qe,ut]:["INF",qe])}else if(pe[3]){if(xt(ee.duration)){ee.playlistOffset=K,ee.start=K,be&&m4(ee,be,T),ee.sn=N,ee.level=o,ee.cc=H,C.push(ee);const ut=(" "+pe[3]).slice(1);ee.relurl=jN(T,ut),HN(ee,ne,I),ne=ee,K+=ee.duration,N++,x=0,Te=!0}}else{if(pe=pe[0].match(ite),!pe){Zn.warn("No matches on slow regex match for level playlist!");continue}for(de=1;de<pe.length&&pe[de]===void 0;de++);const ut=(" "+pe[de]).slice(1),Oe=(" "+pe[de+1]).slice(1),Qe=pe[de+2]?(" "+pe[de+2]).slice(1):null;switch(ut){case"BYTERANGE":ne?ee.setByteRange(Oe,ne):ee.setByteRange(Oe);break;case"PROGRAM-DATE-TIME":ee.rawProgramDateTime=Oe,ee.tagList.push(["PROGRAM-DATE-TIME",Oe]),Se===-1&&(Se=C.length);break;case"PLAYLIST-TYPE":T.type&&yu(T,ut,pe),T.type=Oe.toUpperCase();break;case"MEDIA-SEQUENCE":T.startSN!==0?yu(T,ut,pe):C.length>0&&g4(T,ut,pe),N=T.startSN=parseInt(Oe);break;case"SKIP":{T.skippedSegments&&yu(T,ut,pe);const Ke=new Ss(Oe,T),Re=Ke.decimalInteger("SKIPPED-SEGMENTS");if(xt(Re)){T.skippedSegments+=Re;for(let we=Re;we--;)C.push(null);N+=Re}const se=Ke.enumeratedString("RECENTLY-REMOVED-DATERANGES");se&&(T.recentlyRemovedDateranges=(T.recentlyRemovedDateranges||[]).concat(se.split("	")));break}case"TARGETDURATION":T.targetduration!==0&&yu(T,ut,pe),T.targetduration=Math.max(parseInt(Oe),1);break;case"VERSION":T.version!==null&&yu(T,ut,pe),T.version=parseInt(Oe);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":T.live||yu(T,ut,pe),T.live=!1;break;case"#":(Oe||Qe)&&ee.tagList.push(Qe?[Oe,Qe]:[Oe]);break;case"DISCONTINUITY":H++,ee.tagList.push(["DIS"]);break;case"GAP":ee.gap=!0,ee.tagList.push([ut]);break;case"BITRATE":ee.tagList.push([ut,Oe]),Q=parseInt(Oe)*1e3,xt(Q)?ee.bitrate=Q:Q=0;break;case"DATERANGE":{const Ke=new Ss(Oe,T),Re=new E5(Ke,T.dateRanges[Ke.ID],T.dateRangeTagCount);T.dateRangeTagCount++,Re.isValid||T.skippedSegments?T.dateRanges[Re.id]=Re:Zn.warn(`Ignoring invalid DATERANGE tag: "${Oe}"`),ee.tagList.push(["EXT-X-DATERANGE",Oe]);break}case"DEFINE":{{const Ke=new Ss(Oe,T);"IMPORT"in Ke?Gee(T,Ke,g):a4(T,Ke,r)}break}case"DISCONTINUITY-SEQUENCE":T.startCC!==0?yu(T,ut,pe):C.length>0&&g4(T,ut,pe),T.startCC=H=parseInt(Oe);break;case"KEY":{const Ke=d4(Oe,r,T);if(Ke.isSupported()){if(Ke.method==="NONE"){be=void 0;break}be||(be={}),be[Ke.keyFormat]&&(be=Mi({},be)),be[Ke.keyFormat]=Ke}else Zn.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${Oe}"`);break}case"START":T.startTimeOffset=u4(Oe);break;case"MAP":{const Ke=new Ss(Oe,T);if(ee.duration){const Re=new nN(d,v);p4(Re,Ke,o,be),L=Re,ee.initSegment=L,L.rawProgramDateTime&&!ee.rawProgramDateTime&&(ee.rawProgramDateTime=L.rawProgramDateTime)}else{const Re=ee.byteRangeEndOffset;if(Re){const se=ee.byteRangeStartOffset;_e=`${Re-se}@${se}`}else _e=null;p4(ee,Ke,o,be),L=ee,Te=!0}L.cc=H;break}case"SERVER-CONTROL":{he&&yu(T,ut,pe),he=new Ss(Oe),T.canBlockReload=he.bool("CAN-BLOCK-RELOAD"),T.canSkipUntil=he.optionalFloat("CAN-SKIP-UNTIL",0),T.canSkipDateRanges=T.canSkipUntil>0&&he.bool("CAN-SKIP-DATERANGES"),T.partHoldBack=he.optionalFloat("PART-HOLD-BACK",0),T.holdBack=he.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{T.partTarget&&yu(T,ut,pe);const Ke=new Ss(Oe);T.partTarget=Ke.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Ke=T.partList;Ke||(Ke=T.partList=[]);const Re=x>0?Ke[Ke.length-1]:void 0,se=x++,we=new Ss(Oe,T),He=new WZ(we,ee,v,se,Re);Ke.push(He),ee.duration+=He.duration;break}case"PRELOAD-HINT":{const Ke=new Ss(Oe,T);T.preloadHint=Ke;break}case"RENDITION-REPORT":{const Ke=new Ss(Oe,T);T.renditionReports=T.renditionReports||[],T.renditionReports.push(Ke);break}default:Zn.warn(`line parsed but not handled: ${pe}`);break}}}ne&&!ne.relurl?(C.pop(),K-=ne.duration,T.partList&&(T.fragmentHint=ne)):T.partList&&(HN(ee,ne,I),ee.cc=H,T.fragmentHint=ee,be&&m4(ee,be,T)),T.targetduration||(T.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const Ge=C.length,st=C[0],It=C[Ge-1];if(K+=T.skippedSegments*T.targetduration,K>0&&Ge&&It){T.averagetargetduration=K/Ge;const qe=It.sn;T.endSN=qe!=="initSegment"?qe:0,T.live||(It.endList=!0),st&&T.startCC===void 0&&(T.startCC=st.cc),Se>0&&(rte(C,Se),st&&I.unshift(st))}else T.endSN=0,T.startCC=0;return T.fragmentHint&&(K+=T.fragmentHint.duration),T.totalduration=K,I.length&&T.dateRangeTagCount&&st&&y5(I,T),T.endCC=H,T}}function y5(h,i){const r=h.length,o=h[r-1],d=i.live?1/0:i.totalduration,p=Object.keys(i.dateRanges);for(let g=p.length;g--;){const y=i.dateRanges[p[g]],v=y.startDate.getTime();y.tagAnchor=o.ref;for(let T=r;T--;){const C=ste(i,v,h,T,d);if(C!==-1){y.tagAnchor=i.fragments[C].ref;break}}}}function ste(h,i,r,o,d){const p=r[o];if(p){const y=p.programDateTime;if(i>=y||o===0){var g;const v=(((g=r[o+1])==null?void 0:g.start)||d)-p.start;if(i<=y+v*1e3){const T=r[o].sn-h.startSN,C=h.fragments;if(C.length>r.length){const L=(r[o+1]||C[C.length-1]).sn-h.startSN;for(let N=L;N>T;N--){const x=C[N].programDateTime;if(i>=x&&i<x+C[N].duration*1e3)return N}}return T}}}return-1}function d4(h,i,r){var o,d;const p=new Ss(h,r),g=(o=p.METHOD)!=null?o:"",y=p.URI,v=p.hexadecimalInteger("IV"),T=p.KEYFORMATVERSIONS,C=(d=p.KEYFORMAT)!=null?d:"identity";y&&p.IV&&!v&&Zn.error(`Invalid IV: ${p.IV}`);const I=y?Ed.resolve(y,i):"",L=(T||"1").split("/").map(Number).filter(Number.isFinite);return new uT(g,I,C,L,v)}function u4(h){const r=new Ss(h).decimalFloatingPoint("TIME-OFFSET");return xt(r)?r:null}function h4(h,i){let r=(h||"").split(/[ ,]+/).filter(o=>o);["video","audio","text"].forEach(o=>{const d=r.filter(p=>o5(p,o));d.length&&(i[`${o}Codec`]=d.map(p=>p.split("/")[0]).join(","),r=r.filter(p=>d.indexOf(p)===-1))}),i.unknownCodecs=r}function f4(h,i,r){const o=i[r];o&&(h[r]=o)}function rte(h,i){let r=h[i];for(let o=i;o--;){const d=h[o];if(!d)return;d.programDateTime=r.programDateTime-d.duration*1e3,r=d}}function HN(h,i,r){h.rawProgramDateTime?r.push(h):i!=null&&i.programDateTime&&(h.programDateTime=i.endProgramDateTime)}function p4(h,i,r,o){h.relurl=i.URI,i.BYTERANGE&&h.setByteRange(i.BYTERANGE),h.level=r,h.sn="initSegment",o&&(h.levelkeys=o),h.initSegment=null}function m4(h,i,r){h.levelkeys=i;const{encryptedFragments:o}=r;(!o.length||o[o.length-1].levelkeys!==i)&&Object.keys(i).some(d=>i[d].isCommonEncryption)&&o.push(h)}function yu(h,i,r){h.playlistParsingError=new Error(`#EXT-X-${i} must not appear more than once (${r[0]})`)}function g4(h,i,r){h.playlistParsingError=new Error(`#EXT-X-${i} must appear before the first Media Segment (${r[0]})`)}function dN(h,i){const r=i.startPTS;if(xt(r)){let o=0,d;i.sn>h.sn?(o=r-h.start,d=h):(o=h.start-r,d=i),d.duration!==o&&d.setDuration(o)}else i.sn>h.sn?h.cc===i.cc&&h.minEndPTS?i.setStart(h.start+(h.minEndPTS-h.start)):i.setStart(h.start+h.duration):i.setStart(Math.max(h.start-i.duration,0))}function T5(h,i,r,o,d,p){o-r<=0&&(Zn.warn("Fragment should have a positive duration",i),o=r+i.duration,p=d+i.duration);let y=r,v=o;const T=i.startPTS,C=i.endPTS;if(xt(T)){const H=Math.abs(T-r);xt(i.deltaPTS)?i.deltaPTS=Math.max(H,i.deltaPTS):i.deltaPTS=H,y=Math.max(r,T),r=Math.min(r,T),d=Math.min(d,i.startDTS),v=Math.min(o,C),o=Math.max(o,C),p=Math.max(p,i.endDTS)}const I=r-i.start;i.start!==0&&i.setStart(r),i.setDuration(o-i.start),i.startPTS=r,i.maxStartPTS=y,i.startDTS=d,i.endPTS=o,i.minEndPTS=v,i.endDTS=p;const L=i.sn;if(!h||L<h.startSN||L>h.endSN)return 0;let N;const x=L-h.startSN,K=h.fragments;for(K[x]=i,N=x;N>0;N--)dN(K[N],K[N-1]);for(N=x;N<K.length-1;N++)dN(K[N],K[N+1]);return h.fragmentHint&&dN(K[K.length-1],h.fragmentHint),h.PTSKnown=h.alignedSliding=!0,I}function ate(h,i){if(h===i)return;let r=null;const o=h.fragments;for(let v=o.length-1;v>=0;v--){const T=o[v].initSegment;if(T){r=T;break}}h.fragmentHint&&delete h.fragmentHint.endPTS;let d;lte(h,i,(v,T,C,I)=>{if(!i.startCC&&T.cc!==v.cc){var L,N;const x=v.cc-T.cc;for(let K=C;K<I.length;K++)I[K].cc+=x;i.startCC=(L=(N=R5(h,i.startSN-1))==null?void 0:N.cc)!=null?L:I[0].cc,i.endCC=I[I.length-1].cc}xt(v.startPTS)&&xt(v.endPTS)&&(T.setStart(T.startPTS=v.startPTS),T.startDTS=v.startDTS,T.maxStartPTS=v.maxStartPTS,T.endPTS=v.endPTS,T.endDTS=v.endDTS,T.minEndPTS=v.minEndPTS,T.setDuration(v.endPTS-v.startPTS),T.duration&&(d=T),i.PTSKnown=i.alignedSliding=!0),v.hasStreams&&(T.elementaryStreams=v.elementaryStreams),T.loader=v.loader,v.hasStats&&(T.stats=v.stats),v.initSegment&&(T.initSegment=v.initSegment,r=v.initSegment)});const p=i.fragments,g=i.fragmentHint?p.concat(i.fragmentHint):p;if(r&&g.forEach(v=>{var T;v&&(!v.initSegment||v.initSegment.relurl===((T=r)==null?void 0:T.relurl))&&(v.initSegment=r)}),i.skippedSegments)if(i.deltaUpdateFailed=p.some(v=>!v),i.deltaUpdateFailed){Zn.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let v=i.skippedSegments;v--;)p.shift();i.startSN=p[0].sn}else{i.endCC=p[p.length-1].cc,i.canSkipDateRanges&&(i.dateRanges=ote(h.dateRanges,i));const v=h.fragments.filter(T=>T.rawProgramDateTime);if(h.hasProgramDateTime&&!i.hasProgramDateTime)for(let T=1;T<g.length;T++)g[T].programDateTime===null&&HN(g[T],g[T-1],v);y5(v,i)}cte(h.partList,i.partList,(v,T)=>{T.elementaryStreams=v.elementaryStreams,T.stats=v.stats}),d?T5(i,d,d.startPTS,d.endPTS,d.startDTS,d.endDTS):v5(h,i),p.length&&(i.totalduration=i.edge-p[0].start),i.driftStartTime=h.driftStartTime,i.driftStart=h.driftStart;const y=i.advancedDateTime;if(i.advanced&&y){const v=i.edge;i.driftStart||(i.driftStartTime=y,i.driftStart=v),i.driftEndTime=y,i.driftEnd=v}else i.driftEndTime=h.driftEndTime,i.driftEnd=h.driftEnd,i.advancedDateTime=h.advancedDateTime;i.requestScheduled===-1&&(i.requestScheduled=h.requestScheduled)}function ote(h,i){const{dateRanges:r,recentlyRemovedDateranges:o}=i,d=Mi({},h);o&&o.forEach(y=>{delete d[y]});const g=Object.keys(d).length;return g&&Object.keys(r).forEach(y=>{const v=d[y],T=new E5(r[y].attr,v);T.isValid?(d[y]=T,v||(T.tagOrder+=g)):Zn.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${ds(r[y].attr)}"`)}),d}function cte(h,i,r){if(h&&i){let o=0;for(let d=0,p=h.length;d<=p;d++){const g=h[d],y=i[d+o];g&&y&&g.index===y.index&&g.fragment.sn===y.fragment.sn?r(g,y):o--}}}function lte(h,i,r){const o=i.skippedSegments,d=Math.max(h.startSN,i.startSN)-i.startSN,p=(h.fragmentHint?1:0)+(o?i.endSN:Math.min(h.endSN,i.endSN))-i.startSN,g=i.startSN-h.startSN,y=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,v=h.fragmentHint?h.fragments.concat(h.fragmentHint):h.fragments;for(let T=d;T<=p;T++){const C=v[g+T];let I=y[T];if(o&&!I&&C&&(I=i.fragments[T]=C),C&&I){if(r(C,I,T,y),C.url&&C.url!==I.url){i.playlistParsingError=E4(`media sequence mismatch ${I.sn}:`,h,i,C,I);return}else if(C.cc!==I.cc){i.playlistParsingError=E4(`discontinuity sequence mismatch (${C.cc}!=${I.cc})`,h,i,C,I);return}}}}function E4(h,i,r,o,d){return new Error(`${h} ${d.url}
Playlist starting @${i.startSN}
${i.m3u8}

Playlist starting @${r.startSN}
${r.m3u8}`)}function v5(h,i,r=!0){const o=i.startSN+i.skippedSegments-h.startSN,d=h.fragments,p=o>=0;let g=0;if(p&&o<d.length)g=d[o].start;else if(p&&i.startSN===h.endSN+1)g=h.fragmentEnd;else if(p&&r)g=h.fragmentStart+o*i.levelTargetDuration;else if(!i.skippedSegments&&i.fragmentStart===0)g=h.fragmentStart;else return;KN(i,g)}function KN(h,i){if(i){const r=h.fragments;for(let o=h.skippedSegments;o<r.length;o++)r[o].addStart(i);h.fragmentHint&&h.fragmentHint.addStart(i)}}function b5(h,i=1/0){let r=1e3*h.targetduration;if(h.updated){const o=h.fragments;if(o.length&&r*4>i){const p=o[o.length-1].duration*1e3;p<r&&(r=p)}}else r/=2;return Math.round(r)}function R5(h,i,r){if(!h)return null;let o=h.fragments[i-h.startSN];return o||(o=h.fragmentHint,o&&o.sn===i)?o:i<h.startSN&&r&&r.sn===i?r:null}function _4(h,i,r){return h?A5(h.partList,i,r):null}function A5(h,i,r){if(h)for(let o=h.length;o--;){const d=h[o];if(d.index===r&&d.fragment.sn===i)return d}return null}function C5(h){h.forEach((i,r)=>{var o;(o=i.details)==null||o.fragments.forEach(d=>{d.level=r,d.initSegment&&(d.initSegment.level=r)})})}function nT(h,i){for(let o=0,d=h.length;o<d;o++){var r;if(((r=h[o])==null?void 0:r.cc)===i)return h[o]}return null}function dte(h,i){return!!(h&&i.startCC<h.endCC&&i.endCC>h.startCC)}function S4(h,i){if(h){const r=h.start+i;h.start=h.startPTS=r,h.endPTS=r+h.duration}}function I5(h,i){const r=i.fragments;for(let o=0,d=r.length;o<d;o++)S4(r[o],h);i.fragmentHint&&S4(i.fragmentHint,h),i.alignedSliding=!0}function ute(h,i){h&&(w5(i,h),!i.alignedSliding&&h&&fC(i,h),!i.alignedSliding&&h&&!i.skippedSegments&&v5(h,i,!1))}function w5(h,i){if(!dte(i,h))return;const r=Math.min(i.endCC,h.endCC),o=nT(i.fragments,r),d=nT(h.fragments,r);if(!o||!d)return;Zn.log(`Aligning playlist at start of dicontinuity sequence ${r}`);const p=o.start-d.start;I5(p,h)}function fC(h,i){if(!h.hasProgramDateTime||!i.hasProgramDateTime)return;const r=h.fragments,o=i.fragments;if(!r.length||!o.length)return;let d,p;const g=Math.min(i.endCC,h.endCC);i.startCC<g&&h.startCC<g&&(d=nT(o,g),p=nT(r,g)),(!d||!p)&&(d=o[Math.floor(o.length/2)],p=nT(r,d.cc)||r[Math.floor(r.length/2)]);const y=d.programDateTime,v=p.programDateTime;if(!y||!v)return;const T=(v-y)/1e3-(p.start-d.start);I5(T,h)}const hte={toString:function(h){let i="";const r=h.length;for(let o=0;o<r;o++)i+=`[${h.start(o).toFixed(3)}-${h.end(o).toFixed(3)}]`;return i}},ot={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class CL extends m5{constructor(i,r,o,d,p){super(d,i.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ot.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:g,fragCurrent:y,media:v,mediaBuffer:T,state:C}=this,I=v?v.currentTime:0,L=Dn.bufferInfo(T||v,I,g.maxBufferHole);if(this.log(`media seeking to ${xt(I)?I.toFixed(3):I}, state: ${C}`),this.state===ot.ENDED)this.resetLoadingState();else if(y){const N=g.maxFragLookUpTolerance,x=y.start-N,K=y.start+y.duration+N;if(!L.len||K<L.start||x>L.end){const H=I>K;(I<x||H)&&(H&&y.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),y.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(v){this.fragmentTracker.removeFragmentsInRange(I,1/0,this.playlistType,!0);const N=this.lastCurrentTime;if(I>N&&(this.lastCurrentTime=I),!this.loadingParts){const x=Math.max(L.end,I),K=this.shouldLoadParts(this.getLevelDetails(),x);K&&(this.log(`LL-Part loading ON after seeking to ${I.toFixed(2)} with buffer @${x.toFixed(2)}`),this.loadingParts=K)}}!this.hls.hasEnoughToStart&&!L.len&&(this.log(`setting startPosition to ${I} because of seek before start`),this.nextLoadPosition=this.startPosition=I),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=p,this.hls=i,this.fragmentLoader=new Vee(i.config),this.keyLoader=o,this.fragmentTracker=r,this.config=i.config,this.decrypter=new vL(i.config)}registerListeners(){const{hls:i}=this;i.on(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(z.ERROR,this.onError,this)}unregisterListeners(){const{hls:i}=this;i.off(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(z.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(i){}stopLoad(){if(this.state===ot.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const i=this.fragCurrent;i!=null&&i.loader&&(i.abortRequests(),this.fragmentTracker.removeFragment(i)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ot.STOPPED}get startPositionValue(){const{nextLoadPosition:i,startPosition:r}=this;return r===-1&&i?i:r}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(i,r){if(r.live||!this.media)return!1;const o=i.end||0,d=this.config.timelineOffset||0;if(o<=d)return!1;const p=i.nextStart;if(p&&p>d&&p<r.edge||this.media.currentTime<i.start)return!1;const y=r.partList;if(y!=null&&y.length){const T=y[y.length-1];return Dn.isBuffered(this.media,T.start+T.duration/2)}const v=r.fragments[r.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(v)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var i;return(i=this.levelLastLoaded)==null?void 0:i.details}}get timelineOffset(){const i=this.config.timelineOffset;if(i){var r;return((r=this.getLevelDetails())==null?void 0:r.appliedTimelineOffset)||i}return 0}onMediaAttached(i,r){const o=this.media=this.mediaBuffer=r.media;o.removeEventListener("seeking",this.onMediaSeeking),o.removeEventListener("ended",this.onMediaEnded),o.addEventListener("seeking",this.onMediaSeeking),o.addEventListener("ended",this.onMediaEnded);const d=this.config;this.levels&&d.autoStartLoad&&this.state===ot.STOPPED&&this.startLoad(d.startPosition)}onMediaDetaching(i,r){const o=!!r.transferMedia,d=this.media;if(d!==null){if(d.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),d.removeEventListener("seeking",this.onMediaSeeking),d.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!o&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,o){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(i,r){}onManifestLoaded(i,r){this.startTimeOffset=r.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ot.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(i,r,o){this.startFragRequested=!0,this._loadFragForPlayback(i,r,o)}_loadFragForPlayback(i,r,o){const d=p=>{const g=p.frag;if(this.fragContextChanged(g)){this.warn(`${g.type} sn: ${g.sn}${p.part?" part: "+p.part.index:""} of ${this.fragInfo(g,!1,p.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(g);return}g.stats.chunkCount++,this._handleFragmentLoadProgress(p)};this._doFragLoad(i,r,o,d).then(p=>{if(!p)return;const g=this.state,y=p.frag;if(this.fragContextChanged(y)){(g===ot.FRAG_LOADING||!this.fragCurrent&&g===ot.PARSING)&&(this.fragmentTracker.removeFragment(y),this.state=ot.IDLE);return}"payload"in p&&(this.log(`Loaded ${y.type} sn: ${y.sn} of ${this.playlistLabel()} ${y.level}`),this.hls.trigger(z.FRAG_LOADED,p)),this._handleFragmentLoadComplete(p)}).catch(p=>{this.state===ot.STOPPED||this.state===ot.ERROR||(this.warn(`Frag error: ${(p==null?void 0:p.message)||p}`),this.resetFragmentLoading(i))})}clearTrackerIfNeeded(i){var r;const{fragmentTracker:o}=this;if(o.getState(i)===cr.APPENDING){const p=i.type,g=this.getFwdBufferInfo(this.mediaBuffer,p),y=Math.max(i.duration,g?g.len:this.config.maxBufferLength),v=this.backtrackFragment;((v?i.sn-v.sn:0)===1||this.reduceMaxBufferLength(y,i.duration))&&o.removeFragment(i)}else((r=this.mediaBuffer)==null?void 0:r.buffered.length)===0?o.removeAllFragments():o.hasParts(i.type)&&(o.detectPartialFragments({frag:i,part:null,stats:i.stats,id:i.type}),o.getState(i)===cr.PARTIAL&&o.removeFragment(i))}checkLiveUpdate(i){if(i.updated&&!i.live){const r=i.fragments[i.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:r,part:null,stats:r.stats,id:r.type})}i.fragments[0]||(i.deltaUpdateFailed=!0)}waitForLive(i){const r=i.details;return(r==null?void 0:r.live)&&r.type!=="EVENT"&&(this.levelLastLoaded!==i||r.expired)}flushMainBuffer(i,r,o=null){if(!(i-r))return;const d={startOffset:i,endOffset:r,type:o};this.hls.trigger(z.BUFFER_FLUSHING,d)}_loadInitSegment(i,r){this._doFragLoad(i,r).then(o=>{const d=o==null?void 0:o.frag;if(!d||this.fragContextChanged(d)||!this.levels)throw new Error("init load aborted");return o}).then(o=>{const{hls:d}=this,{frag:p,payload:g}=o,y=p.decryptdata;if(g&&g.byteLength>0&&y!=null&&y.key&&y.iv&&C_(y.method)){const v=self.performance.now();return this.decrypter.decrypt(new Uint8Array(g),y.key.buffer,y.iv.buffer,RL(y.method)).catch(T=>{throw d.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.FRAG_DECRYPT_ERROR,fatal:!1,error:T,reason:T.message,frag:p}),T}).then(T=>{const C=self.performance.now();return d.trigger(z.FRAG_DECRYPTED,{frag:p,payload:T,stats:{tstart:v,tdecrypt:C}}),o.payload=T,this.completeInitSegmentLoad(o)})}return this.completeInitSegmentLoad(o)}).catch(o=>{this.state===ot.STOPPED||this.state===ot.ERROR||(this.warn(o),this.resetFragmentLoading(i))})}completeInitSegmentLoad(i){const{levels:r}=this;if(!r)throw new Error("init load aborted, missing levels");const o=i.frag.stats;this.state!==ot.STOPPED&&(this.state=ot.IDLE),i.frag.data=new Uint8Array(i.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),this.tick()}fragContextChanged(i){const{fragCurrent:r}=this;return!i||!r||i.sn!==r.sn||i.level!==r.level}fragBufferedComplete(i,r){const o=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${i.type} sn: ${i.sn}${r?" part: "+r.index:""} of ${this.fragInfo(i,!1,r)} > buffer:${o?hte.toString(Dn.getBuffered(o)):"(detached)"})`),Ar(i)){var d;if(i.type!==Vt.SUBTITLE){const g=i.elementaryStreams;if(!Object.keys(g).some(y=>!!g[y])){this.state=ot.IDLE;return}}const p=(d=this.levels)==null?void 0:d[i.level];p!=null&&p.fragmentError&&(this.log(`Resetting level fragment error count of ${p.fragmentError} on frag buffered`),p.fragmentError=0)}this.state=ot.IDLE}_handleFragmentLoadComplete(i){const{transmuxer:r}=this;if(!r)return;const{frag:o,part:d,partsLoaded:p}=i,g=!p||p.length===0||p.some(v=>!v),y=new bL(o.level,o.sn,o.stats.chunkCount+1,0,d?d.index:-1,!g);r.flush(y)}_handleFragmentLoadProgress(i){}_doFragLoad(i,r,o=null,d){var p;this.fragCurrent=i;const g=r==null?void 0:r.details;if(!this.levels||!g)throw new Error(`frag load aborted, missing level${g?"":" detail"}s`);let y=null;i.encrypted&&!((p=i.decryptdata)!=null&&p.key)?(this.log(`Loading key for ${i.sn} of [${g.startSN}-${g.endSN}], ${this.playlistLabel()} ${i.level}`),this.state=ot.KEY_LOADING,this.fragCurrent=i,y=this.keyLoader.load(i).then(I=>{if(!this.fragContextChanged(I.frag))return this.hls.trigger(z.KEY_LOADED,I),this.state===ot.KEY_LOADING&&(this.state=ot.IDLE),I}),this.hls.trigger(z.KEY_LOADING,{frag:i}),this.fragCurrent===null&&(y=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!i.encrypted&&g.encryptedFragments.length&&this.keyLoader.loadClear(i,g.encryptedFragments);const v=this.fragPrevious;if(Ar(i)&&(!v||i.sn!==v.sn)){const I=this.shouldLoadParts(r.details,i.end);I!==this.loadingParts&&(this.log(`LL-Part loading ${I?"ON":"OFF"} loading sn ${v==null?void 0:v.sn}->${i.sn}`),this.loadingParts=I)}if(o=Math.max(i.start,o||0),this.loadingParts&&Ar(i)){const I=g.partList;if(I&&d){o>i.end&&g.fragmentHint&&(i=g.fragmentHint);const L=this.getNextPart(I,i,o);if(L>-1){const N=I[L];i=this.fragCurrent=N.fragment,this.log(`Loading ${i.type} sn: ${i.sn} part: ${N.index} (${L}/${I.length-1}) of ${this.fragInfo(i,!1,N)}) cc: ${i.cc} [${g.startSN}-${g.endSN}], target: ${parseFloat(o.toFixed(3))}`),this.nextLoadPosition=N.start+N.duration,this.state=ot.FRAG_LOADING;let x;return y?x=y.then(K=>!K||this.fragContextChanged(K.frag)?null:this.doFragPartsLoad(i,N,r,d)).catch(K=>this.handleFragLoadError(K)):x=this.doFragPartsLoad(i,N,r,d).catch(K=>this.handleFragLoadError(K)),this.hls.trigger(z.FRAG_LOADING,{frag:i,part:N,targetBufferTime:o}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):x}else if(!i.url||this.loadedEndOfParts(I,o))return Promise.resolve(null)}}if(Ar(i)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${o.toFixed(2)}`),this.loadingParts=!1;else if(!i.url)return Promise.resolve(null);this.log(`Loading ${i.type} sn: ${i.sn} of ${this.fragInfo(i,!1)}) cc: ${i.cc} ${g?"["+g.startSN+"-"+g.endSN+"]":""}, target: ${parseFloat(o.toFixed(3))}`),xt(i.sn)&&!this.bitrateTest&&(this.nextLoadPosition=i.start+i.duration),this.state=ot.FRAG_LOADING;const T=this.config.progressive;let C;return T&&y?C=y.then(I=>!I||this.fragContextChanged(I==null?void 0:I.frag)?null:this.fragmentLoader.load(i,d)).catch(I=>this.handleFragLoadError(I)):C=Promise.all([this.fragmentLoader.load(i,T?d:void 0),y]).then(([I])=>(!T&&I&&d&&d(I),I)).catch(I=>this.handleFragLoadError(I)),this.hls.trigger(z.FRAG_LOADING,{frag:i,targetBufferTime:o}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):C}doFragPartsLoad(i,r,o,d){return new Promise((p,g)=>{var y;const v=[],T=(y=o.details)==null?void 0:y.partList,C=I=>{this.fragmentLoader.loadPart(i,I,d).then(L=>{v[I.index]=L;const N=L.part;this.hls.trigger(z.FRAG_LOADED,L);const x=_4(o.details,i.sn,I.index+1)||A5(T,i.sn,I.index+1);if(x)C(x);else return p({frag:i,part:N,partsLoaded:v})}).catch(g)};C(r)})}handleFragLoadError(i){if("data"in i){const r=i.data;i.data&&r.details===Ue.INTERNAL_ABORTED?this.handleFragLoadAborted(r.frag,r.part):this.hls.trigger(z.ERROR,r)}else this.hls.trigger(z.ERROR,{type:Gt.OTHER_ERROR,details:Ue.INTERNAL_EXCEPTION,err:i,error:i,fatal:!0});return null}_handleTransmuxerFlush(i){const r=this.getCurrentContext(i);if(!r||this.state!==ot.PARSING){!this.fragCurrent&&this.state!==ot.STOPPED&&this.state!==ot.ERROR&&(this.state=ot.IDLE);return}const{frag:o,part:d,level:p}=r,g=self.performance.now();o.stats.parsing.end=g,d&&(d.stats.parsing.end=g);const y=this.getLevelDetails(),T=y&&o.sn>y.endSN||this.shouldLoadParts(y,o.end);T!==this.loadingParts&&(this.log(`LL-Part loading ${T?"ON":"OFF"} after parsing segment ending @${o.end.toFixed(2)}`),this.loadingParts=T),this.updateLevelTiming(o,d,p,i.partial)}shouldLoadParts(i,r){if(this.config.lowLatencyMode){if(!i)return this.loadingParts;if(i!=null&&i.partList){var o;const p=i.partList[0],g=p.end+(((o=i.fragmentHint)==null?void 0:o.duration)||0);if(r>=g){var d;if((this.hls.hasEnoughToStart?((d=this.media)==null?void 0:d.currentTime)||this.lastCurrentTime:this.getLoadPosition())>p.start-p.fragment.duration)return!0}}}return!1}getCurrentContext(i){const{levels:r,fragCurrent:o}=this,{level:d,sn:p,part:g}=i;if(!(r!=null&&r[d]))return this.warn(`Levels object was unset while buffering fragment ${p} of ${this.playlistLabel()} ${d}. The current chunk will not be buffered.`),null;const y=r[d],v=y.details,T=g>-1?_4(v,p,g):null,C=T?T.fragment:R5(v,p,o);return C?(o&&o!==C&&(C.stats=o.stats),{frag:C,part:T,level:y}):null}bufferFragmentData(i,r,o,d,p){var g;if(!i||this.state!==ot.PARSING)return;const{data1:y,data2:v}=i;let T=y;if(y&&v&&(T=dc(y,v)),!((g=T)!=null&&g.length))return;const C={type:i.type,frag:r,part:o,chunkMeta:d,parent:r.type,data:T};if(this.hls.trigger(z.BUFFER_APPENDING,C),i.dropped&&i.independent&&!o){if(p)return;this.flushBufferGap(r)}}flushBufferGap(i){const r=this.media;if(!r)return;if(!Dn.isBuffered(r,r.currentTime)){this.flushMainBuffer(0,i.start);return}const o=r.currentTime,d=Dn.bufferInfo(r,o,0),p=i.duration,g=Math.min(this.config.maxFragLookUpTolerance*2,p*.25),y=Math.max(Math.min(i.start-g,d.end-g),o+g);i.start-y>g&&this.flushMainBuffer(y,i.start)}getFwdBufferInfo(i,r){var o;const d=this.getLoadPosition();if(!xt(d))return null;const g=this.lastCurrentTime>d||(o=this.media)!=null&&o.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(i,d,r,g)}getFwdBufferInfoAtPos(i,r,o,d){const p=Dn.bufferInfo(i,r,d);if(p.len===0&&p.nextStart!==void 0){const g=this.fragmentTracker.getBufferedFrag(r,o);if(g&&(p.nextStart<=g.end||g.gap)){const y=Math.max(Math.min(p.nextStart,g.end)-r,d);return Dn.bufferInfo(i,r,y)}}return p}getMaxBufferLength(i){const{config:r}=this;let o;return i?o=Math.max(8*r.maxBufferSize/i,r.maxBufferLength):o=r.maxBufferLength,Math.min(o,r.maxMaxBufferLength)}reduceMaxBufferLength(i,r){const o=this.config,d=Math.max(Math.min(i-r,o.maxBufferLength),r),p=Math.max(i-r*3,o.maxMaxBufferLength/2,d);return p>=d?(o.maxMaxBufferLength=p,this.warn(`Reduce max buffer length to ${p}s`),!0):!1}getAppendedFrag(i,r=Vt.MAIN){var o;const d=(o=this.fragmentTracker)==null?void 0:o.getAppendedFrag(i,r);return d&&"fragment"in d?d.fragment:d}getNextFragment(i,r){const o=r.fragments,d=o.length;if(!d)return null;const{config:p}=this,g=o[0].start,y=p.lowLatencyMode&&!!r.partList;let v=null;if(r.live){const I=p.initialLiveManifestSize;if(d<I)return this.warn(`Not enough fragments to start playback (have: ${d}, need: ${I})`),null;if(!r.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||i<g){var T;y&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),v=this.getInitialLiveFragment(r,o);const L=this.hls.startPosition,N=this.hls.liveSyncPosition,x=v?(L!==-1&&L>=g?L:N)||v.start:i;this.log(`Setting startPosition to ${x} to match start frag at live edge. mainStart: ${L} liveSyncPosition: ${N} frag.start: ${(T=v)==null?void 0:T.start}`),this.startPosition=this.nextLoadPosition=x}}else i<=g&&(v=o[0]);if(!v){const I=this.loadingParts?r.partEnd:r.fragmentEnd;v=this.getFragmentAtPosition(i,I,r)}let C=this.filterReplacedPrimary(v,r);if(!C&&v){const I=v.sn-r.startSN;C=this.filterReplacedPrimary(o[I+1]||null,r)}return this.mapToInitFragWhenRequired(C)}isLoopLoading(i,r){const o=this.fragmentTracker.getState(i);return(o===cr.OK||o===cr.PARTIAL&&!!i.gap)&&this.nextLoadPosition>r}getNextFragmentLoopLoading(i,r,o,d,p){let g=null;if(i.gap&&(g=this.getNextFragment(this.nextLoadPosition,r),g&&!g.gap&&o.nextStart)){const y=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,o.nextStart,d,0);if(y!==null&&o.len+y.len>=p){const v=g.sn;return this.loopSn!==v&&(this.log(`buffer full after gaps in "${d}" playlist starting at sn: ${v}`),this.loopSn=v),null}}return this.loopSn=void 0,g}get primaryPrefetch(){if(y4(this.hls.config)){var i,r;if((i=this.hls.interstitialsManager)==null||(r=i.playingItem)==null?void 0:r.event)return!0}return!1}filterReplacedPrimary(i,r){if(!i)return i;if(y4(this.hls.config)&&i.type!==Vt.SUBTITLE){const o=this.hls.interstitialsManager,d=o==null?void 0:o.bufferingItem;if(d){const g=d.event;if(g){if(g.appendInPlace||Math.abs(i.start-d.start)>1||d.start===0)return null}else if(i.end<=d.start&&(r==null?void 0:r.live)===!1||i.start>d.end&&d.nextEvent&&(d.nextEvent.appendInPlace||i.start-d.end>1))return null}const p=o==null?void 0:o.playerQueue;if(p)for(let g=p.length;g--;){const y=p[g].interstitial;if(y.appendInPlace&&i.start>=y.startTime&&i.end<=y.resumeTime)return null}}return i}mapToInitFragWhenRequired(i){return i!=null&&i.initSegment&&!(i!=null&&i.initSegment.data)&&!this.bitrateTest?i.initSegment:i}getNextPart(i,r,o){let d=-1,p=!1,g=!0;for(let y=0,v=i.length;y<v;y++){const T=i[y];if(g=g&&!T.independent,d>-1&&o<T.start)break;const C=T.loaded;C?d=-1:(p||T.independent||g)&&T.fragment===r&&(d=y),p=C}return d}loadedEndOfParts(i,r){const o=i[i.length-1];return o&&r>o.start&&o.loaded}getInitialLiveFragment(i,r){const o=this.fragPrevious;let d=null;if(o){if(i.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${o.programDateTime}`),d=Iee(r,o.endProgramDateTime,this.config.maxFragLookUpTolerance)),!d){const p=o.sn+1;if(p>=i.startSN&&p<=i.endSN){const g=r[p-i.startSN];o.cc===g.cc&&(d=g,this.log(`Live playlist, switching playlist, load frag with next SN: ${d.sn}`))}d||(d=p5(r,o.cc),d&&this.log(`Live playlist, switching playlist, load frag with same CC: ${d.sn}`))}}else{const p=this.hls.liveSyncPosition;p!==null&&(d=this.getFragmentAtPosition(p,this.bitrateTest?i.fragmentEnd:i.edge,i))}return d}getFragmentAtPosition(i,r,o){const{config:d}=this;let{fragPrevious:p}=this,{fragments:g,endSN:y}=o;const{fragmentHint:v}=o,{maxFragLookUpTolerance:T}=d,C=o.partList,I=!!(this.loadingParts&&C!=null&&C.length&&v);I&&v&&!this.bitrateTest&&C[C.length-1].fragment.sn===v.sn&&(g=g.concat(v),y=v.sn);let L;if(i<r){var N;const K=i<this.lastCurrentTime||i>r-T||(N=this.media)!=null&&N.paused||!this.startFragRequested?0:T;L=xm(p,g,i,K)}else L=g[g.length-1];if(L){const x=L.sn-o.startSN,K=this.fragmentTracker.getState(L);if((K===cr.OK||K===cr.PARTIAL&&L.gap)&&(p=L),p&&L.sn===p.sn&&(!I||C[0].fragment.sn>L.sn||!o.live&&!I)&&p&&L.level===p.level){const Q=g[x+1];L.sn<y&&this.fragmentTracker.getState(Q)!==cr.OK?L=Q:L=null}}return L}alignPlaylists(i,r,o){const d=i.fragments.length;if(!d)return this.warn("No fragments in live playlist"),0;const p=i.fragmentStart,g=!r,y=i.alignedSliding&&xt(p);if(g||!y&&!p){ute(o,i);const v=i.fragmentStart;return this.log(`Live playlist sliding: ${v.toFixed(2)} start-sn: ${r?r.startSN:"na"}->${i.startSN} fragments: ${d}`),v}return p}waitForCdnTuneIn(i){return i.live&&i.canBlockReload&&i.partTarget&&i.tuneInGoal>Math.max(i.partHoldBack,i.partTarget*3)}setStartPosition(i,r){let o=this.startPosition;o<r&&(o=-1);const d=this.timelineOffset;if(o===-1){const p=this.startTimeOffset!==null,g=p?this.startTimeOffset:i.startTimeOffset;g!==null&&xt(g)?(o=r+g,g<0&&(o+=i.edge),o=Math.min(Math.max(r,o),r+i.totalduration),this.log(`Setting startPosition to ${o} for start time offset ${g} found in ${p?"multivariant":"media"} playlist`),this.startPosition=o):i.live?(o=this.hls.liveSyncPosition||r,this.log(`Setting startPosition to -1 to start at live edge ${o}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=o=0),this.lastCurrentTime=o+d}this.nextLoadPosition=o+d}getLoadPosition(){var i;const{media:r}=this;let o=0;return(i=this.hls)!=null&&i.hasEnoughToStart&&r?o=r.currentTime:this.nextLoadPosition>=0&&(o=this.nextLoadPosition),o}handleFragLoadAborted(i,r){this.transmuxer&&i.type===this.playlistType&&Ar(i)&&i.stats.aborted&&(this.warn(`Fragment ${i.sn}${r?" part "+r.index:""} of ${this.playlistLabel()} ${i.level} was aborted`),this.resetFragmentLoading(i))}resetFragmentLoading(i){(!this.fragCurrent||!this.fragContextChanged(i)&&this.state!==ot.FRAG_LOADING_WAITING_RETRY)&&(this.state=ot.IDLE)}onFragmentOrKeyLoadError(i,r){if(r.chunkMeta&&!r.frag){const x=this.getCurrentContext(r.chunkMeta);x&&(r.frag=x.frag)}const o=r.frag;if(!o||o.type!==i||!this.levels)return;if(this.fragContextChanged(o)){var d;this.warn(`Frag load error must match current frag to retry ${o.url} > ${(d=this.fragCurrent)==null?void 0:d.url}`);return}const p=r.details===Ue.FRAG_GAP;p&&this.fragmentTracker.fragBuffered(o,!0);const g=r.errorAction,{action:y,flags:v,retryCount:T=0,retryConfig:C}=g||{},I=!!g&&!!C,L=I&&y===Zr.RetryRequest,N=I&&!g.resolved&&v===rl.MoveAllAlternatesMatchingHost;if(!L&&N&&Ar(o)&&!o.endList)this.resetFragmentErrors(i),this.treatAsGap(o),g.resolved=!0;else if((L||N)&&T<C.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const x=TL(C,T);this.warn(`Fragment ${o.sn} of ${i} ${o.level} errored with ${r.details}, retrying loading ${T+1}/${C.maxNumRetry} in ${x}ms`),g.resolved=!0,this.retryDate=self.performance.now()+x,this.state=ot.FRAG_LOADING_WAITING_RETRY}else if(C&&g)if(this.resetFragmentErrors(i),T<C.maxNumRetry)!p&&y!==Zr.RemoveAlternatePermanently&&(g.resolved=!0);else{this.warn(`${r.details} reached or exceeded max retry (${T})`);return}else y===Zr.SendAlternateToPenaltyBox?this.state=ot.WAITING_LEVEL:this.state=ot.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(i){if(this.state===ot.PARSING||this.state===ot.PARSED){const r=i.frag,o=i.parent,d=this.getFwdBufferInfo(this.mediaBuffer,o),p=d&&d.len>.5;p&&this.reduceMaxBufferLength(d.len,(r==null?void 0:r.duration)||10);const g=!p;return g&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${o} buffer`),r&&(this.fragmentTracker.removeFragment(r),this.nextLoadPosition=r.start),this.resetLoadingState(),g}return!1}resetFragmentErrors(i){i===Vt.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ot.STOPPED&&(this.state=ot.IDLE)}afterBufferFlushed(i,r,o){if(!i)return;const d=Dn.getBuffered(i);this.fragmentTracker.detectEvictedFragments(r,d,o),this.state===ot.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ot.STOPPED&&(this.state=ot.IDLE)}resetStartWhenNotLoaded(i){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const r=i?i.details:null;r!=null&&r.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(r,r.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(i){this.warn(`The loading context changed while buffering fragment ${i.sn} of ${this.playlistLabel()} ${i.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(i=0){this.fragmentTracker.removeFragmentsInRange(i,1/0,this.playlistType,!1,!0)}updateLevelTiming(i,r,o,d){const p=o.details;if(!p){this.warn("level.details undefined");return}if(!Object.keys(i.elementaryStreams).reduce((v,T)=>{const C=i.elementaryStreams[T];if(C){const I=C.endPTS-C.startPTS;if(I<=0)return this.warn(`Could not parse fragment ${i.sn} ${T} duration reliably (${I})`),v||!1;const L=d?0:T5(p,i,C.startPTS,C.endPTS,C.startDTS,C.endDTS);return this.hls.trigger(z.LEVEL_PTS_UPDATED,{details:p,level:o,drift:L,type:T,frag:i,start:C.startPTS,end:C.endPTS}),!0}return v},!1)){var y;if(o.fragmentError===0&&this.treatAsGap(i,o),((y=this.transmuxer)==null?void 0:y.error)===null){const v=new Error(`Found no media in fragment ${i.sn} of ${this.playlistLabel()} ${i.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(v.message),this.hls.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.FRAG_PARSING_ERROR,fatal:!1,error:v,frag:i,reason:`Found no media in msn ${i.sn} of ${this.playlistLabel()} "${o.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ot.PARSED,this.log(`Parsed ${i.type} sn: ${i.sn}${r?" part: "+r.index:""} of ${this.fragInfo(i,!1,r)})`),this.hls.trigger(z.FRAG_PARSED,{frag:i,part:r})}playlistLabel(){return this.playlistType===Vt.MAIN?"level":"track"}fragInfo(i,r=!0,o){var d,p;return`${this.playlistLabel()} ${i.level} (${o?"part":"frag"}:[${((d=r&&!o?i.startPTS:(o||i).start)!=null?d:NaN).toFixed(3)}-${((p=r&&!o?i.endPTS:(o||i).end)!=null?p:NaN).toFixed(3)}]${o&&i.type==="main"?"INDEPENDENT="+(o.independent?"YES":"NO"):""}`}treatAsGap(i,r){r&&r.fragmentError++,i.gap=!0,this.fragmentTracker.removeFragment(i),this.fragmentTracker.fragBuffered(i,!0)}resetTransmuxer(){var i;(i=this.transmuxer)==null||i.reset()}recoverWorkerError(i){i.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(i){const r=this._state;r!==i&&(this._state=i,this.log(`${r}->${i}`))}get state(){return this._state}}function y4(h){return!!h.interstitialsController&&h.enableInterstitialPlayback!==!1}class O5{constructor(){this.chunks=[],this.dataLength=0}push(i){this.chunks.push(i),this.dataLength+=i.length}flush(){const{chunks:i,dataLength:r}=this;let o;if(i.length)i.length===1?o=i[0]:o=fte(i,r);else return new Uint8Array(0);return this.reset(),o}reset(){this.chunks.length=0,this.dataLength=0}}function fte(h,i){const r=new Uint8Array(i);let o=0;for(let d=0;d<h.length;d++){const p=h[d];r.set(p,o),o+=p.length}return r}var uN={exports:{}},T4;function pte(){return T4||(T4=1,function(h){var i=Object.prototype.hasOwnProperty,r="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(r=!1));function d(v,T,C){this.fn=v,this.context=T,this.once=C||!1}function p(v,T,C,I,L){if(typeof C!="function")throw new TypeError("The listener must be a function");var N=new d(C,I||v,L),x=r?r+T:T;return v._events[x]?v._events[x].fn?v._events[x]=[v._events[x],N]:v._events[x].push(N):(v._events[x]=N,v._eventsCount++),v}function g(v,T){--v._eventsCount===0?v._events=new o:delete v._events[T]}function y(){this._events=new o,this._eventsCount=0}y.prototype.eventNames=function(){var T=[],C,I;if(this._eventsCount===0)return T;for(I in C=this._events)i.call(C,I)&&T.push(r?I.slice(1):I);return Object.getOwnPropertySymbols?T.concat(Object.getOwnPropertySymbols(C)):T},y.prototype.listeners=function(T){var C=r?r+T:T,I=this._events[C];if(!I)return[];if(I.fn)return[I.fn];for(var L=0,N=I.length,x=new Array(N);L<N;L++)x[L]=I[L].fn;return x},y.prototype.listenerCount=function(T){var C=r?r+T:T,I=this._events[C];return I?I.fn?1:I.length:0},y.prototype.emit=function(T,C,I,L,N,x){var K=r?r+T:T;if(!this._events[K])return!1;var H=this._events[K],Q=arguments.length,ne,ee;if(H.fn){switch(H.once&&this.removeListener(T,H.fn,void 0,!0),Q){case 1:return H.fn.call(H.context),!0;case 2:return H.fn.call(H.context,C),!0;case 3:return H.fn.call(H.context,C,I),!0;case 4:return H.fn.call(H.context,C,I,L),!0;case 5:return H.fn.call(H.context,C,I,L,N),!0;case 6:return H.fn.call(H.context,C,I,L,N,x),!0}for(ee=1,ne=new Array(Q-1);ee<Q;ee++)ne[ee-1]=arguments[ee];H.fn.apply(H.context,ne)}else{var pe=H.length,de;for(ee=0;ee<pe;ee++)switch(H[ee].once&&this.removeListener(T,H[ee].fn,void 0,!0),Q){case 1:H[ee].fn.call(H[ee].context);break;case 2:H[ee].fn.call(H[ee].context,C);break;case 3:H[ee].fn.call(H[ee].context,C,I);break;case 4:H[ee].fn.call(H[ee].context,C,I,L);break;default:if(!ne)for(de=1,ne=new Array(Q-1);de<Q;de++)ne[de-1]=arguments[de];H[ee].fn.apply(H[ee].context,ne)}}return!0},y.prototype.on=function(T,C,I){return p(this,T,C,I,!1)},y.prototype.once=function(T,C,I){return p(this,T,C,I,!0)},y.prototype.removeListener=function(T,C,I,L){var N=r?r+T:T;if(!this._events[N])return this;if(!C)return g(this,N),this;var x=this._events[N];if(x.fn)x.fn===C&&(!L||x.once)&&(!I||x.context===I)&&g(this,N);else{for(var K=0,H=[],Q=x.length;K<Q;K++)(x[K].fn!==C||L&&!x[K].once||I&&x[K].context!==I)&&H.push(x[K]);H.length?this._events[N]=H.length===1?H[0]:H:g(this,N)}return this},y.prototype.removeAllListeners=function(T){var C;return T?(C=r?r+T:T,this._events[C]&&g(this,C)):(this._events=new o,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=r,y.EventEmitter=y,h.exports=y}(uN)),uN.exports}var mte=pte(),IL=HZ(mte);const hT="1.6.2",N_={};function gte(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Ete(){const h=N_[hT];if(h)return h.clientCount++,h;const i=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),r=self.URL.createObjectURL(i),d={worker:new self.Worker(r),objectURL:r,clientCount:1};return N_[hT]=d,d}function _te(h){const i=N_[h];if(i)return i.clientCount++,i;const r=new self.URL(h,self.location.href).href,d={worker:new self.Worker(r),scriptURL:r,clientCount:1};return N_[h]=d,d}function Ste(h){const i=N_[h||hT];if(i&&i.clientCount--===1){const{worker:o,objectURL:d}=i;delete N_[h||hT],d&&self.URL.revokeObjectURL(d),o.terminate()}}function D5(h,i){return i+10<=h.length&&h[i]===51&&h[i+1]===68&&h[i+2]===73&&h[i+3]<255&&h[i+4]<255&&h[i+6]<128&&h[i+7]<128&&h[i+8]<128&&h[i+9]<128}function wL(h,i){return i+10<=h.length&&h[i]===73&&h[i+1]===68&&h[i+2]===51&&h[i+3]<255&&h[i+4]<255&&h[i+6]<128&&h[i+7]<128&&h[i+8]<128&&h[i+9]<128}function CC(h,i){let r=0;return r=(h[i]&127)<<21,r|=(h[i+1]&127)<<14,r|=(h[i+2]&127)<<7,r|=h[i+3]&127,r}function fT(h,i){const r=i;let o=0;for(;wL(h,i);){o+=10;const d=CC(h,i+6);o+=d,D5(h,i+10)&&(o+=10),i+=o}if(o>0)return h.subarray(r,r+o)}function yte(h,i,r,o){const d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],p=i[r+2],g=p>>2&15;if(g>12){const N=new Error(`invalid ADTS sampling index:${g}`);h.emit(z.ERROR,z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.FRAG_PARSING_ERROR,fatal:!0,error:N,reason:N.message});return}const y=(p>>6&3)+1,v=i[r+3]>>6&3|(p&1)<<2,T="mp4a.40."+y,C=d[g];let I=g;(y===5||y===29)&&(I-=3);const L=[y<<3|(I&14)>>1,(I&1)<<7|v<<3];return Zn.log(`manifest codec:${o}, parsed codec:${T}, channels:${v}, rate:${C} (ADTS object type:${y} sampling index:${g})`),{config:L,samplerate:C,channelCount:v,codec:T,parsedCodec:T,manifestCodec:o}}function N5(h,i){return h[i]===255&&(h[i+1]&246)===240}function L5(h,i){return h[i+1]&1?7:9}function OL(h,i){return(h[i+3]&3)<<11|h[i+4]<<3|(h[i+5]&224)>>>5}function Tte(h,i){return i+5<h.length}function pC(h,i){return i+1<h.length&&N5(h,i)}function vte(h,i){return Tte(h,i)&&N5(h,i)&&OL(h,i)<=h.length-i}function bte(h,i){if(pC(h,i)){const r=L5(h,i);if(i+r>=h.length)return!1;const o=OL(h,i);if(o<=r)return!1;const d=i+o;return d===h.length||pC(h,d)}return!1}function x5(h,i,r,o,d){if(!h.samplerate){const p=yte(i,r,o,d);if(!p)return;Mi(h,p)}}function P5(h){return 1024*9e4/h}function Rte(h,i){const r=L5(h,i);if(i+r<=h.length){const o=OL(h,i)-r;if(o>0)return{headerLength:r,frameLength:o}}}function k5(h,i,r,o,d){const p=P5(h.samplerate),g=o+d*p,y=Rte(i,r);let v;if(y){const{frameLength:I,headerLength:L}=y,N=L+I,x=Math.max(0,r+N-i.length);x?(v=new Uint8Array(N-L),v.set(i.subarray(r+L,i.length),0)):v=i.subarray(r+L,r+N);const K={unit:v,pts:g};return x||h.samples.push(K),{sample:K,length:N,missing:x}}const T=i.length-r;return v=new Uint8Array(T),v.set(i.subarray(r,i.length),0),{sample:{unit:v,pts:g},length:T,missing:-1}}function Ate(h,i){return wL(h,i)&&CC(h,i+6)+10<=h.length-i}function Cte(h){if(h.size<2)return;const i=So(h.data,!0),r=new Uint8Array(h.data.subarray(i.length+1));return{key:h.type,info:i,data:r.buffer}}function Ite(h){if(h.size<2)return;if(h.type==="TXXX"){let r=1;const o=So(h.data.subarray(r),!0);r+=o.length+1;const d=So(h.data.subarray(r));return{key:h.type,info:o,data:d}}const i=So(h.data.subarray(1));return{key:h.type,info:"",data:i}}function wte(h){if(h.type==="WXXX"){if(h.size<2)return;let r=1;const o=So(h.data.subarray(r),!0);r+=o.length+1;const d=So(h.data.subarray(r));return{key:h.type,info:o,data:d}}const i=So(h.data);return{key:h.type,info:"",data:i}}function Ote(h){return btoa(String.fromCharCode(...h))}function M5(h,i){if(h<0)return-M5(-h,i);const r=Math.pow(10,i);if(Math.abs(h*r%1-.5)<Number.EPSILON){const d=Math.floor(h*r);return(d%2===0?d:d+1)/r}else return Math.round(h*r)/r}function Dte(h,i){const r=new URL(h),o=new URL(i);if(r.origin!==o.origin)return h;const d=r.pathname.split("/").slice(1),p=o.pathname.split("/").slice(1,-1);for(;d[0]===p[0];)d.shift(),p.shift();for(;p.length;)p.shift(),d.unshift("..");return d.join("/")}function Nte(){try{return crypto.randomUUID()}catch{try{const i=URL.createObjectURL(new Blob),r=i.toString();return URL.revokeObjectURL(i),r.slice(r.lastIndexOf("/")+1)}catch{let r=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,d=>{const p=(r+Math.random()*16)%16|0;return r=Math.floor(r/16),(d=="x"?p:p&3|8).toString(16)})}}}function Lte(h){return h instanceof ArrayBuffer?h:h.byteOffset==0&&h.byteLength==h.buffer.byteLength?h.buffer:new Uint8Array(h).buffer}function hN(h,i=0,r=1/0){return xte(h,i,r,Uint8Array)}function xte(h,i,r,o){const d=Pte(h);let p=1;"BYTES_PER_ELEMENT"in o&&(p=o.BYTES_PER_ELEMENT);const g=kte(h)?h.byteOffset:0,y=(g+h.byteLength)/p,v=(g+i)/p,T=Math.floor(Math.max(0,Math.min(v,y))),C=Math.floor(Math.min(T+Math.max(r,0),y));return new o(d,T,C-T)}function Pte(h){return h instanceof ArrayBuffer?h:h.buffer}function kte(h){return h&&h.buffer instanceof ArrayBuffer&&h.byteLength!==void 0&&h.byteOffset!==void 0}function Mte(h){const i={key:h.type,description:"",data:"",mimeType:null,pictureType:null},r=3;if(h.size<2)return;if(h.data[0]!==r){console.log("Ignore frame with unrecognized character encoding");return}const o=h.data.subarray(1).indexOf(0);if(o===-1)return;const d=So(hN(h.data,1,o)),p=h.data[2+o],g=h.data.subarray(3+o).indexOf(0);if(g===-1)return;const y=So(hN(h.data,3+o,g));let v;return d==="-->"?v=So(hN(h.data,4+o+g)):v=Lte(h.data.subarray(4+o+g)),i.mimeType=d,i.pictureType=p,i.description=y,i.data=v,i}function Ute(h){return h.type==="PRIV"?Cte(h):h.type[0]==="W"?wte(h):h.type==="APIC"?Mte(h):Ite(h)}function Fte(h){const i=String.fromCharCode(h[0],h[1],h[2],h[3]),r=CC(h,4),o=10;return{type:i,size:r,data:h.subarray(o,o+r)}}const LA=10,Bte=10;function U5(h){let i=0;const r=[];for(;wL(h,i);){const o=CC(h,i+6);h[i+5]>>6&1&&(i+=LA),i+=LA;const d=i+o;for(;i+Bte<d;){const p=Fte(h.subarray(i)),g=Ute(p);g&&r.push(g),i+=p.size+LA}D5(h,i)&&(i+=LA)}return r}function F5(h){return h&&h.key==="PRIV"&&h.info==="com.apple.streaming.transportStreamTimestamp"}function Vte(h){if(h.data.byteLength===8){const i=new Uint8Array(h.data),r=i[3]&1;let o=(i[4]<<23)+(i[5]<<15)+(i[6]<<7)+i[7];return o/=45,r&&(o+=4772185884e-2),Math.round(o)}}function DL(h){const i=U5(h);for(let r=0;r<i.length;r++){const o=i[r];if(F5(o))return Vte(o)}}let Eo=function(h){return h.audioId3="org.id3",h.dateRange="com.apple.quicktime.HLS",h.emsg="https://aomedia.org/emsg/ID3",h.misbklv="urn:misb:KLV:bin:1910.1",h}({});function pd(h="",i=9e4){return{type:h,id:-1,pid:-1,inputTimeScale:i,sequenceNumber:-1,samples:[],dropped:0}}class NL{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(i,r,o,d){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(i){this.initPTS=i,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(i,r){return!1}appendFrame(i,r,o){}demux(i,r){this.cachedData&&(i=dc(this.cachedData,i),this.cachedData=null);let o=fT(i,0),d=o?o.length:0,p;const g=this._audioTrack,y=this._id3Track,v=o?DL(o):void 0,T=i.length;for((this.basePTS===null||this.frameIndex===0&&xt(v))&&(this.basePTS=jte(v,r,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),o&&o.length>0&&y.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:o,type:Eo.audioId3,duration:Number.POSITIVE_INFINITY});d<T;){if(this.canParse(i,d)){const C=this.appendFrame(g,i,d);C?(this.frameIndex++,this.lastPTS=C.sample.pts,d+=C.length,p=d):d=T}else Ate(i,d)?(o=fT(i,d),y.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:o,type:Eo.audioId3,duration:Number.POSITIVE_INFINITY}),d+=o.length,p=d):d++;if(d===T&&p!==T){const C=i.slice(p);this.cachedData?this.cachedData=dc(this.cachedData,C):this.cachedData=C}}return{audioTrack:g,videoTrack:pd(),id3Track:y,textTrack:pd()}}demuxSampleAes(i,r,o){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(i){const r=this.cachedData;return r&&(this.cachedData=null,this.demux(r,0)),{audioTrack:this._audioTrack,videoTrack:pd(),id3Track:this._id3Track,textTrack:pd()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const jte=(h,i,r)=>{if(xt(h))return h*90;const o=r?r.baseTime*9e4/r.timescale:0;return i*9e4+o};let xA=null;const Gte=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Hte=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Kte=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Wte=[0,1,1,4];function B5(h,i,r,o,d){if(r+24>i.length)return;const p=V5(i,r);if(p&&r+p.frameLength<=i.length){const g=p.samplesPerFrame*9e4/p.sampleRate,y=o+d*g,v={unit:i.subarray(r,r+p.frameLength),pts:y,dts:y};return h.config=[],h.channelCount=p.channelCount,h.samplerate=p.sampleRate,h.samples.push(v),{sample:v,length:p.frameLength,missing:0}}}function V5(h,i){const r=h[i+1]>>3&3,o=h[i+1]>>1&3,d=h[i+2]>>4&15,p=h[i+2]>>2&3;if(r!==1&&d!==0&&d!==15&&p!==3){const g=h[i+2]>>1&1,y=h[i+3]>>6,v=r===3?3-o:o===3?3:4,T=Gte[v*14+d-1]*1e3,I=Hte[(r===3?0:r===2?1:2)*3+p],L=y===3?1:2,N=Kte[r][o],x=Wte[o],K=N*8*x,H=Math.floor(N*T/I+g)*x;if(xA===null){const ee=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);xA=ee?parseInt(ee[1]):0}return!!xA&&xA<=87&&o===2&&T>=224e3&&y===0&&(h[i+3]=h[i+3]|128),{sampleRate:I,channelCount:L,frameLength:H,samplesPerFrame:K}}}function LL(h,i){return h[i]===255&&(h[i+1]&224)===224&&(h[i+1]&6)!==0}function j5(h,i){return i+1<h.length&&LL(h,i)}function Yte(h,i){return LL(h,i)&&4<=h.length-i}function G5(h,i){if(i+1<h.length&&LL(h,i)){const o=V5(h,i);let d=4;o!=null&&o.frameLength&&(d=o.frameLength);const p=i+d;return p===h.length||j5(h,p)}return!1}class qte extends NL{constructor(i,r){super(),this.observer=void 0,this.config=void 0,this.observer=i,this.config=r}resetInitSegment(i,r,o,d){super.resetInitSegment(i,r,o,d),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:r,duration:d,inputTimeScale:9e4,dropped:0}}static probe(i,r){if(!i)return!1;const o=fT(i,0);let d=(o==null?void 0:o.length)||0;if(G5(i,d))return!1;for(let p=i.length;d<p;d++)if(bte(i,d))return r.log("ADTS sync word found !"),!0;return!1}canParse(i,r){return vte(i,r)}appendFrame(i,r,o){x5(i,this.observer,r,o,i.manifestCodec);const d=k5(i,r,o,this.basePTS,this.frameIndex);if(d&&d.missing===0)return d}}const H5=(h,i)=>{let r=0,o=5;i+=o;const d=new Uint32Array(1),p=new Uint32Array(1),g=new Uint8Array(1);for(;o>0;){g[0]=h[i];const y=Math.min(o,8),v=8-y;p[0]=4278190080>>>24+v<<v,d[0]=(g[0]&p[0])>>v,r=r?r<<y|d[0]:d[0],i+=1,o-=y}return r};class $te extends NL{constructor(i){super(),this.observer=void 0,this.observer=i}resetInitSegment(i,r,o,d){super.resetInitSegment(i,r,o,d),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:r,duration:d,inputTimeScale:9e4,dropped:0}}canParse(i,r){return r+64<i.length}appendFrame(i,r,o){const d=K5(i,r,o,this.basePTS,this.frameIndex);if(d!==-1)return{sample:i.samples[i.samples.length-1],length:d,missing:0}}static probe(i){if(!i)return!1;const r=fT(i,0);if(!r)return!1;const o=r.length;return i[o]===11&&i[o+1]===119&&DL(r)!==void 0&&H5(i,o)<16}}function K5(h,i,r,o,d){if(r+8>i.length||i[r]!==11||i[r+1]!==119)return-1;const p=i[r+4]>>6;if(p>=3)return-1;const y=[48e3,44100,32e3][p],v=i[r+4]&63,C=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][v*3+p]*2;if(r+C>i.length)return-1;const I=i[r+6]>>5;let L=0;I===2?L+=2:(I&1&&I!==1&&(L+=2),I&4&&(L+=2));const N=(i[r+6]<<8|i[r+7])>>12-L&1,K=[2,1,2,3,3,4,4,5][I]+N,H=i[r+5]>>3,Q=i[r+5]&7,ne=new Uint8Array([p<<6|H<<1|Q>>2,(Q&3)<<6|I<<3|N<<2|v>>4,v<<4&224]),ee=1536/y*9e4,pe=o+d*ee,de=i.subarray(r,r+C);return h.config=ne,h.channelCount=K,h.samplerate=y,h.samples.push({unit:de,pts:pe}),C}class zte extends NL{resetInitSegment(i,r,o,d){super.resetInitSegment(i,r,o,d),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:r,duration:d,inputTimeScale:9e4,dropped:0}}static probe(i){if(!i)return!1;const r=fT(i,0);let o=(r==null?void 0:r.length)||0;if(r&&i[o]===11&&i[o+1]===119&&DL(r)!==void 0&&H5(i,o)<=16)return!1;for(let d=i.length;o<d;o++)if(G5(i,o))return Zn.log("MPEG Audio sync word found !"),!0;return!1}canParse(i,r){return Yte(i,r)}appendFrame(i,r,o){if(this.basePTS!==null)return B5(i,r,o,this.basePTS,this.frameIndex)}}const Xte=/\/emsg[-/]ID3/i;class Jte{constructor(i,r){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=r}resetTimeStamp(){}resetInitSegment(i,r,o,d){const p=this.videoTrack=pd("video",1),g=this.audioTrack=pd("audio",1),y=this.txtTrack=pd("text",1);if(this.id3Track=pd("id3",1),this.timeOffset=0,!(i!=null&&i.byteLength))return;const v=i5(i);if(v.video){const{id:T,timescale:C,codec:I,supplemental:L}=v.video;p.id=T,p.timescale=y.timescale=C,p.codec=I,p.supplemental=L}if(v.audio){const{id:T,timescale:C,codec:I}=v.audio;g.id=T,g.timescale=C,g.codec=I}y.id=e5.text,p.sampleDuration=0,p.duration=g.duration=d}resetContiguity(){this.remainderData=null}static probe(i){return $Z(i)}demux(i,r){this.timeOffset=r;let o=i;const d=this.videoTrack,p=this.txtTrack;if(this.config.progressive){this.remainderData&&(o=dc(this.remainderData,i));const y=nee(o);this.remainderData=y.remainder,d.samples=y.valid||new Uint8Array}else d.samples=o;const g=this.extractID3Track(d,r);return p.samples=G3(r,d),{videoTrack:d,audioTrack:this.audioTrack,id3Track:g,textTrack:this.txtTrack}}flush(){const i=this.timeOffset,r=this.videoTrack,o=this.txtTrack;r.samples=this.remainderData||new Uint8Array,this.remainderData=null;const d=this.extractID3Track(r,this.timeOffset);return o.samples=G3(i,r),{videoTrack:r,audioTrack:pd(),id3Track:d,textTrack:pd()}}extractID3Track(i,r){const o=this.id3Track;if(i.samples.length){const d=yn(i.samples,["emsg"]);d&&d.forEach(p=>{const g=see(p);if(Xte.test(g.schemeIdUri)){const y=v4(g,r);let v=g.eventDuration===4294967295?Number.POSITIVE_INFINITY:g.eventDuration/g.timeScale;v<=.001&&(v=Number.POSITIVE_INFINITY);const T=g.payload;o.samples.push({data:T,len:T.byteLength,dts:y,pts:y,type:Eo.emsg,duration:v})}else if(this.config.enableEmsgKLVMetadata&&g.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const y=v4(g,r);o.samples.push({data:g.payload,len:g.payload.byteLength,dts:y,pts:y,type:Eo.misbklv,duration:Number.POSITIVE_INFINITY})}})}return o}demuxSampleAes(i,r,o){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function v4(h,i){return xt(h.presentationTime)?h.presentationTime/h.timeScale:i+h.presentationTimeDelta/h.timeScale}class Qte{constructor(i,r,o){this.keyData=void 0,this.decrypter=void 0,this.keyData=o,this.decrypter=new vL(r,{removePKCS7Padding:!1})}decryptBuffer(i){return this.decrypter.decrypt(i,this.keyData.key.buffer,this.keyData.iv.buffer,hf.cbc)}decryptAacSample(i,r,o){const d=i[r].unit;if(d.length<=16)return;const p=d.subarray(16,d.length-d.length%16),g=p.buffer.slice(p.byteOffset,p.byteOffset+p.length);this.decryptBuffer(g).then(y=>{const v=new Uint8Array(y);d.set(v,16),this.decrypter.isSync()||this.decryptAacSamples(i,r+1,o)})}decryptAacSamples(i,r,o){for(;;r++){if(r>=i.length){o();return}if(!(i[r].unit.length<32)&&(this.decryptAacSample(i,r,o),!this.decrypter.isSync()))return}}getAvcEncryptedData(i){const r=Math.floor((i.length-48)/160)*16+16,o=new Int8Array(r);let d=0;for(let p=32;p<i.length-16;p+=160,d+=16)o.set(i.subarray(p,p+16),d);return o}getAvcDecryptedUnit(i,r){const o=new Uint8Array(r);let d=0;for(let p=32;p<i.length-16;p+=160,d+=16)i.set(o.subarray(d,d+16),p);return i}decryptAvcSample(i,r,o,d,p){const g=r5(p.data),y=this.getAvcEncryptedData(g);this.decryptBuffer(y.buffer).then(v=>{p.data=this.getAvcDecryptedUnit(g,v),this.decrypter.isSync()||this.decryptAvcSamples(i,r,o+1,d)})}decryptAvcSamples(i,r,o,d){if(i instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;r++,o=0){if(r>=i.length){d();return}const p=i[r].units;for(;!(o>=p.length);o++){const g=p[o];if(!(g.data.length<=48||g.type!==1&&g.type!==5)&&(this.decryptAvcSample(i,r,o,d,g),!this.decrypter.isSync()))return}}}}class W5{constructor(){this.VideoSample=null}createVideoSample(i,r,o){return{key:i,frame:!1,pts:r,dts:o,units:[],length:0}}getLastNalUnit(i){var r;let o=this.VideoSample,d;if((!o||o.units.length===0)&&(o=i[i.length-1]),(r=o)!=null&&r.units){const p=o.units;d=p[p.length-1]}return d}pushAccessUnit(i,r){if(i.units.length&&i.frame){if(i.pts===void 0){const o=r.samples,d=o.length;if(d){const p=o[d-1];i.pts=p.pts,i.dts=p.dts}else{r.dropped++;return}}r.samples.push(i)}}parseNALu(i,r,o){const d=r.byteLength;let p=i.naluState||0;const g=p,y=[];let v=0,T,C,I,L=-1,N=0;for(p===-1&&(L=0,N=this.getNALuType(r,0),p=0,v=1);v<d;){if(T=r[v++],!p){p=T?0:1;continue}if(p===1){p=T?0:2;continue}if(!T)p=3;else if(T===1){if(C=v-p-1,L>=0){const x={data:r.subarray(L,C),type:N};y.push(x)}else{const x=this.getLastNalUnit(i.samples);x&&(g&&v<=4-g&&x.state&&(x.data=x.data.subarray(0,x.data.byteLength-g)),C>0&&(x.data=dc(x.data,r.subarray(0,C)),x.state=0))}v<d?(I=this.getNALuType(r,v),L=v,N=I,p=0):p=-1}else p=0}if(L>=0&&p>=0){const x={data:r.subarray(L,d),type:N,state:p};y.push(x)}if(y.length===0){const x=this.getLastNalUnit(i.samples);x&&(x.data=dc(x.data,r))}return i.naluState=p,y}}class iT{constructor(i){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=i,this.bytesAvailable=i.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const i=this.data,r=this.bytesAvailable,o=i.byteLength-r,d=new Uint8Array(4),p=Math.min(4,r);if(p===0)throw new Error("no bytes available");d.set(i.subarray(o,o+p)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=p*8,this.bytesAvailable-=p}skipBits(i){let r;i=Math.min(i,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>i?(this.word<<=i,this.bitsAvailable-=i):(i-=this.bitsAvailable,r=i>>3,i-=r<<3,this.bytesAvailable-=r,this.loadWord(),this.word<<=i,this.bitsAvailable-=i)}readBits(i){let r=Math.min(this.bitsAvailable,i);const o=this.word>>>32-r;if(i>32&&Zn.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=r,this.bitsAvailable>0)this.word<<=r;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return r=i-r,r>0&&this.bitsAvailable?o<<r|this.readBits(r):o}skipLZ(){let i;for(i=0;i<this.bitsAvailable;++i)if((this.word&2147483648>>>i)!==0)return this.word<<=i,this.bitsAvailable-=i,i;return this.loadWord(),i+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const i=this.skipLZ();return this.readBits(i+1)-1}readEG(){const i=this.readUEG();return 1&i?1+i>>>1:-1*(i>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class b4 extends W5{parsePES(i,r,o,d){const p=this.parseNALu(i,o.data,d);let g=this.VideoSample,y,v=!1;o.data=null,g&&p.length&&!i.audFound&&(this.pushAccessUnit(g,i),g=this.VideoSample=this.createVideoSample(!1,o.pts,o.dts)),p.forEach(T=>{var C,I;switch(T.type){case 1:{let K=!1;y=!0;const H=T.data;if(v&&H.length>4){const Q=this.readSliceType(H);(Q===2||Q===4||Q===7||Q===9)&&(K=!0)}if(K){var L;(L=g)!=null&&L.frame&&!g.key&&(this.pushAccessUnit(g,i),g=this.VideoSample=null)}g||(g=this.VideoSample=this.createVideoSample(!0,o.pts,o.dts)),g.frame=!0,g.key=K;break}case 5:y=!0,(C=g)!=null&&C.frame&&!g.key&&(this.pushAccessUnit(g,i),g=this.VideoSample=null),g||(g=this.VideoSample=this.createVideoSample(!0,o.pts,o.dts)),g.key=!0,g.frame=!0;break;case 6:{y=!0,SL(T.data,1,o.pts,r.samples);break}case 7:{var N,x;y=!0,v=!0;const K=T.data,H=this.readSPS(K);if(!i.sps||i.width!==H.width||i.height!==H.height||((N=i.pixelRatio)==null?void 0:N[0])!==H.pixelRatio[0]||((x=i.pixelRatio)==null?void 0:x[1])!==H.pixelRatio[1]){i.width=H.width,i.height=H.height,i.pixelRatio=H.pixelRatio,i.sps=[K];const Q=K.subarray(1,4);let ne="avc1.";for(let ee=0;ee<3;ee++){let pe=Q[ee].toString(16);pe.length<2&&(pe="0"+pe),ne+=pe}i.codec=ne}break}case 8:y=!0,i.pps=[T.data];break;case 9:y=!0,i.audFound=!0,(I=g)!=null&&I.frame&&(this.pushAccessUnit(g,i),g=null),g||(g=this.VideoSample=this.createVideoSample(!1,o.pts,o.dts));break;case 12:y=!0;break;default:y=!1;break}g&&y&&g.units.push(T)}),d&&g&&(this.pushAccessUnit(g,i),this.VideoSample=null)}getNALuType(i,r){return i[r]&31}readSliceType(i){const r=new iT(i);return r.readUByte(),r.readUEG(),r.readUEG()}skipScalingList(i,r){let o=8,d=8,p;for(let g=0;g<i;g++)d!==0&&(p=r.readEG(),d=(o+p+256)%256),o=d===0?o:d}readSPS(i){const r=new iT(i);let o=0,d=0,p=0,g=0,y,v,T;const C=r.readUByte.bind(r),I=r.readBits.bind(r),L=r.readUEG.bind(r),N=r.readBoolean.bind(r),x=r.skipBits.bind(r),K=r.skipEG.bind(r),H=r.skipUEG.bind(r),Q=this.skipScalingList.bind(this);C();const ne=C();if(I(5),x(3),C(),H(),ne===100||ne===110||ne===122||ne===244||ne===44||ne===83||ne===86||ne===118||ne===128){const Te=L();if(Te===3&&x(1),H(),H(),x(1),N())for(v=Te!==3?8:12,T=0;T<v;T++)N()&&(T<6?Q(16,r):Q(64,r))}H();const ee=L();if(ee===0)L();else if(ee===1)for(x(1),K(),K(),y=L(),T=0;T<y;T++)K();H(),x(1);const pe=L(),de=L(),be=I(1);be===0&&x(1),x(1),N()&&(o=L(),d=L(),p=L(),g=L());let Se=[1,1];if(N()&&N())switch(C()){case 1:Se=[1,1];break;case 2:Se=[12,11];break;case 3:Se=[10,11];break;case 4:Se=[16,11];break;case 5:Se=[40,33];break;case 6:Se=[24,11];break;case 7:Se=[20,11];break;case 8:Se=[32,11];break;case 9:Se=[80,33];break;case 10:Se=[18,11];break;case 11:Se=[15,11];break;case 12:Se=[64,33];break;case 13:Se=[160,99];break;case 14:Se=[4,3];break;case 15:Se=[3,2];break;case 16:Se=[2,1];break;case 255:{Se=[C()<<8|C(),C()<<8|C()];break}}return{width:Math.ceil((pe+1)*16-o*2-d*2),height:(2-be)*(de+1)*16-(be?2:4)*(p+g),pixelRatio:Se}}}class R4 extends W5{constructor(...i){super(...i),this.initVPS=null}parsePES(i,r,o,d){const p=this.parseNALu(i,o.data,d);let g=this.VideoSample,y,v=!1;o.data=null,g&&p.length&&!i.audFound&&(this.pushAccessUnit(g,i),g=this.VideoSample=this.createVideoSample(!1,o.pts,o.dts)),p.forEach(T=>{var C,I;switch(T.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:g||(g=this.VideoSample=this.createVideoSample(!1,o.pts,o.dts)),g.frame=!0,y=!0;break;case 16:case 17:case 18:case 21:if(y=!0,v){var L;(L=g)!=null&&L.frame&&!g.key&&(this.pushAccessUnit(g,i),g=this.VideoSample=null)}g||(g=this.VideoSample=this.createVideoSample(!0,o.pts,o.dts)),g.key=!0,g.frame=!0;break;case 19:case 20:y=!0,(C=g)!=null&&C.frame&&!g.key&&(this.pushAccessUnit(g,i),g=this.VideoSample=null),g||(g=this.VideoSample=this.createVideoSample(!0,o.pts,o.dts)),g.key=!0,g.frame=!0;break;case 39:y=!0,SL(T.data,2,o.pts,r.samples);break;case 32:y=!0,i.vps||(typeof i.params!="object"&&(i.params={}),i.params=Mi(i.params,this.readVPS(T.data)),this.initVPS=T.data),i.vps=[T.data];break;case 33:if(y=!0,v=!0,i.vps!==void 0&&i.vps[0]!==this.initVPS&&i.sps!==void 0&&!this.matchSPS(i.sps[0],T.data)&&(this.initVPS=i.vps[0],i.sps=i.pps=void 0),!i.sps){const N=this.readSPS(T.data);i.width=N.width,i.height=N.height,i.pixelRatio=N.pixelRatio,i.codec=N.codecString,i.sps=[],typeof i.params!="object"&&(i.params={});for(const x in N.params)i.params[x]=N.params[x]}this.pushParameterSet(i.sps,T.data,i.vps),g||(g=this.VideoSample=this.createVideoSample(!0,o.pts,o.dts)),g.key=!0;break;case 34:if(y=!0,typeof i.params=="object"){if(!i.pps){i.pps=[];const N=this.readPPS(T.data);for(const x in N)i.params[x]=N[x]}this.pushParameterSet(i.pps,T.data,i.vps)}break;case 35:y=!0,i.audFound=!0,(I=g)!=null&&I.frame&&(this.pushAccessUnit(g,i),g=null),g||(g=this.VideoSample=this.createVideoSample(!1,o.pts,o.dts));break;default:y=!1;break}g&&y&&g.units.push(T)}),d&&g&&(this.pushAccessUnit(g,i),this.VideoSample=null)}pushParameterSet(i,r,o){(o&&o[0]===this.initVPS||!o&&!i.length)&&i.push(r)}getNALuType(i,r){return(i[r]&126)>>>1}ebsp2rbsp(i){const r=new Uint8Array(i.byteLength);let o=0;for(let d=0;d<i.byteLength;d++)d>=2&&i[d]===3&&i[d-1]===0&&i[d-2]===0||(r[o]=i[d],o++);return new Uint8Array(r.buffer,0,o)}pushAccessUnit(i,r){super.pushAccessUnit(i,r),this.initVPS&&(this.initVPS=null)}readVPS(i){const r=new iT(i);r.readUByte(),r.readUByte(),r.readBits(4),r.skipBits(2),r.readBits(6);const o=r.readBits(3),d=r.readBoolean();return{numTemporalLayers:o+1,temporalIdNested:d}}readSPS(i){const r=new iT(this.ebsp2rbsp(i));r.readUByte(),r.readUByte(),r.readBits(4);const o=r.readBits(3);r.readBoolean();const d=r.readBits(2),p=r.readBoolean(),g=r.readBits(5),y=r.readUByte(),v=r.readUByte(),T=r.readUByte(),C=r.readUByte(),I=r.readUByte(),L=r.readUByte(),N=r.readUByte(),x=r.readUByte(),K=r.readUByte(),H=r.readUByte(),Q=r.readUByte(),ne=[],ee=[];for(let jt=0;jt<o;jt++)ne.push(r.readBoolean()),ee.push(r.readBoolean());if(o>0)for(let jt=o;jt<8;jt++)r.readBits(2);for(let jt=0;jt<o;jt++)ne[jt]&&(r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte()),ee[jt]&&r.readUByte();r.readUEG();const pe=r.readUEG();pe==3&&r.skipBits(1);const de=r.readUEG(),be=r.readUEG(),Se=r.readBoolean();let Te=0,_e=0,he=0,Ge=0;Se&&(Te+=r.readUEG(),_e+=r.readUEG(),he+=r.readUEG(),Ge+=r.readUEG());const st=r.readUEG(),It=r.readUEG(),qe=r.readUEG(),ut=r.readBoolean();for(let jt=ut?0:o;jt<=o;jt++)r.skipUEG(),r.skipUEG(),r.skipUEG();if(r.skipUEG(),r.skipUEG(),r.skipUEG(),r.skipUEG(),r.skipUEG(),r.skipUEG(),r.readBoolean()&&r.readBoolean())for(let $n=0;$n<4;$n++)for(let Wn=0;Wn<($n===3?2:6);Wn++)if(!r.readBoolean())r.readUEG();else{const lt=Math.min(64,1<<4+($n<<1));$n>1&&r.readEG();for(let yt=0;yt<lt;yt++)r.readEG()}r.readBoolean(),r.readBoolean(),r.readBoolean()&&(r.readUByte(),r.skipUEG(),r.skipUEG(),r.readBoolean());const Ke=r.readUEG();let Re=0;for(let jt=0;jt<Ke;jt++){let $n=!1;if(jt!==0&&($n=r.readBoolean()),$n){jt===Ke&&r.readUEG(),r.readBoolean(),r.readUEG();let Wn=0;for(let yi=0;yi<=Re;yi++){const lt=r.readBoolean();let yt=!1;lt||(yt=r.readBoolean()),(lt||yt)&&Wn++}Re=Wn}else{const Wn=r.readUEG(),yi=r.readUEG();Re=Wn+yi;for(let lt=0;lt<Wn;lt++)r.readUEG(),r.readBoolean();for(let lt=0;lt<yi;lt++)r.readUEG(),r.readBoolean()}}if(r.readBoolean()){const jt=r.readUEG();for(let $n=0;$n<jt;$n++){for(let Wn=0;Wn<qe+4;Wn++)r.readBits(1);r.readBits(1)}}let we=0,He=1,ct=1,Be=!0,Et=1,St=0;r.readBoolean(),r.readBoolean();let it=!1;if(r.readBoolean()){if(r.readBoolean()){const Ot=r.readUByte(),Tt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Xt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Ot>0&&Ot<16?(He=Tt[Ot-1],ct=Xt[Ot-1]):Ot===255&&(He=r.readBits(16),ct=r.readBits(16))}if(r.readBoolean()&&r.readBoolean(),r.readBoolean()&&(r.readBits(3),r.readBoolean(),r.readBoolean()&&(r.readUByte(),r.readUByte(),r.readUByte())),r.readBoolean()&&(r.readUEG(),r.readUEG()),r.readBoolean(),r.readBoolean(),r.readBoolean(),it=r.readBoolean(),it&&(Te+=r.readUEG(),_e+=r.readUEG(),he+=r.readUEG(),Ge+=r.readUEG()),r.readBoolean()&&(Et=r.readBits(32),St=r.readBits(32),r.readBoolean()&&r.readUEG(),r.readBoolean())){const Xt=r.readBoolean(),zn=r.readBoolean();let hs=!1;(Xt||zn)&&(hs=r.readBoolean(),hs&&(r.readUByte(),r.readBits(5),r.readBoolean(),r.readBits(5)),r.readBits(4),r.readBits(4),hs&&r.readBits(4),r.readBits(5),r.readBits(5),r.readBits(5));for(let Nn=0;Nn<=o;Nn++){Be=r.readBoolean();const hi=Be||r.readBoolean();let uc=!1;hi?r.readEG():uc=r.readBoolean();const yo=uc?1:r.readUEG()+1;if(Xt)for(let Br=0;Br<yo;Br++)r.readUEG(),r.readUEG(),hs&&(r.readUEG(),r.readUEG()),r.skipBits(1);if(zn)for(let Br=0;Br<yo;Br++)r.readUEG(),r.readUEG(),hs&&(r.readUEG(),r.readUEG()),r.skipBits(1)}}r.readBoolean()&&(r.readBoolean(),r.readBoolean(),r.readBoolean(),we=r.readUEG())}let mt=de,bt=be;if(Se||it){let jt=1,$n=1;pe===1?jt=$n=2:pe==2&&(jt=2),mt=de-jt*_e-jt*Te,bt=be-$n*Ge-$n*he}const gn=d?["A","B","C"][d]:"",Ft=y<<24|v<<16|T<<8|C;let ei=0;for(let jt=0;jt<32;jt++)ei=(ei|(Ft>>jt&1)<<31-jt)>>>0;let ri=ei.toString(16);return g===1&&ri==="2"&&(ri="6"),{codecString:`hvc1.${gn}${g}.${ri}.${p?"H":"L"}${Q}.B0`,params:{general_tier_flag:p,general_profile_idc:g,general_profile_space:d,general_profile_compatibility_flags:[y,v,T,C],general_constraint_indicator_flags:[I,L,N,x,K,H],general_level_idc:Q,bit_depth:st+8,bit_depth_luma_minus8:st,bit_depth_chroma_minus8:It,min_spatial_segmentation_idc:we,chroma_format_idc:pe,frame_rate:{fixed:Be,fps:St/Et}},width:mt,height:bt,pixelRatio:[He,ct]}}readPPS(i){const r=new iT(this.ebsp2rbsp(i));r.readUByte(),r.readUByte(),r.skipUEG(),r.skipUEG(),r.skipBits(2),r.skipBits(3),r.skipBits(2),r.skipUEG(),r.skipUEG(),r.skipEG(),r.skipBits(2),r.readBoolean()&&r.skipUEG(),r.skipEG(),r.skipEG(),r.skipBits(4);const d=r.readBoolean(),p=r.readBoolean();let g=1;return p&&d?g=0:p?g=3:d&&(g=2),{parallelismType:g}}matchSPS(i,r){return String.fromCharCode.apply(null,i).substr(3)===String.fromCharCode.apply(null,r).substr(3)}}const Rr=188;class lf{constructor(i,r,o,d){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=i,this.config=r,this.typeSupported=o,this.logger=d,this.videoParser=null}static probe(i,r){const o=lf.syncOffset(i);return o>0&&r.warn(`MPEG2-TS detected but first sync word found @ offset ${o}`),o!==-1}static syncOffset(i){const r=i.length;let o=Math.min(Rr*5,r-Rr)+1,d=0;for(;d<o;){let p=!1,g=-1,y=0;for(let v=d;v<r;v+=Rr)if(i[v]===71&&(r-v===Rr||i[v+Rr]===71)){if(y++,g===-1&&(g=v,g!==0&&(o=Math.min(g+Rr*99,i.length-Rr)+1)),p||(p=WN(i,v)===0),p&&y>1&&(g===0&&y>2||v+Rr>o))return g}else{if(y)return-1;break}d++}return-1}static createTrack(i,r){return{container:i==="video"||i==="audio"?"video/mp2t":void 0,type:i,id:e5[i],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:i==="audio"?r:void 0}}resetInitSegment(i,r,o,d){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=lf.createTrack("video"),this._videoTrack.duration=d,this._audioTrack=lf.createTrack("audio",d),this._id3Track=lf.createTrack("id3"),this._txtTrack=lf.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=r,this.videoCodec=o}resetTimeStamp(){}resetContiguity(){const{_audioTrack:i,_videoTrack:r,_id3Track:o}=this;i&&(i.pesData=null),r&&(r.pesData=null),o&&(o.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(i,r,o=!1,d=!1){o||(this.sampleAes=null);let p;const g=this._videoTrack,y=this._audioTrack,v=this._id3Track,T=this._txtTrack;let C=g.pid,I=g.pesData,L=y.pid,N=v.pid,x=y.pesData,K=v.pesData,H=null,Q=this.pmtParsed,ne=this._pmtId,ee=i.length;if(this.remainderData&&(i=dc(this.remainderData,i),ee=i.length,this.remainderData=null),ee<Rr&&!d)return this.remainderData=i,{audioTrack:y,videoTrack:g,id3Track:v,textTrack:T};const pe=Math.max(0,lf.syncOffset(i));ee-=(ee-pe)%Rr,ee<i.byteLength&&!d&&(this.remainderData=new Uint8Array(i.buffer,ee,i.buffer.byteLength-ee));let de=0;for(let Se=pe;Se<ee;Se+=Rr)if(i[Se]===71){const Te=!!(i[Se+1]&64),_e=WN(i,Se),he=(i[Se+3]&48)>>4;let Ge;if(he>1){if(Ge=Se+5+i[Se+4],Ge===Se+Rr)continue}else Ge=Se+4;switch(_e){case C:if(Te){if(I&&(p=v_(I,this.logger))){if(this.videoParser===null)switch(g.segmentCodec){case"avc":this.videoParser=new b4;break;case"hevc":this.videoParser=new R4;break}this.videoParser!==null&&this.videoParser.parsePES(g,T,p,!1)}I={data:[],size:0}}I&&(I.data.push(i.subarray(Ge,Se+Rr)),I.size+=Se+Rr-Ge);break;case L:if(Te){if(x&&(p=v_(x,this.logger)))switch(y.segmentCodec){case"aac":this.parseAACPES(y,p);break;case"mp3":this.parseMPEGPES(y,p);break;case"ac3":this.parseAC3PES(y,p);break}x={data:[],size:0}}x&&(x.data.push(i.subarray(Ge,Se+Rr)),x.size+=Se+Rr-Ge);break;case N:Te&&(K&&(p=v_(K,this.logger))&&this.parseID3PES(v,p),K={data:[],size:0}),K&&(K.data.push(i.subarray(Ge,Se+Rr)),K.size+=Se+Rr-Ge);break;case 0:Te&&(Ge+=i[Ge]+1),ne=this._pmtId=Zte(i,Ge);break;case ne:{Te&&(Ge+=i[Ge]+1);const st=ene(i,Ge,this.typeSupported,o,this.observer,this.logger);C=st.videoPid,C>0&&(g.pid=C,g.segmentCodec=st.segmentVideoCodec),L=st.audioPid,L>0&&(y.pid=L,y.segmentCodec=st.segmentAudioCodec),N=st.id3Pid,N>0&&(v.pid=N),H!==null&&!Q&&(this.logger.warn(`MPEG-TS PMT found at ${Se} after unknown PID '${H}'. Backtracking to sync byte @${pe} to parse all TS packets.`),H=null,Se=pe-188),Q=this.pmtParsed=!0;break}case 17:case 8191:break;default:H=_e;break}}else de++;de>0&&YN(this.observer,new Error(`Found ${de} TS packet/s that do not start with 0x47`),void 0,this.logger),g.pesData=I,y.pesData=x,v.pesData=K;const be={audioTrack:y,videoTrack:g,id3Track:v,textTrack:T};return d&&this.extractRemainingSamples(be),be}flush(){const{remainderData:i}=this;this.remainderData=null;let r;return i?r=this.demux(i,-1,!1,!0):r={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(r),this.sampleAes?this.decrypt(r,this.sampleAes):r}extractRemainingSamples(i){const{audioTrack:r,videoTrack:o,id3Track:d,textTrack:p}=i,g=o.pesData,y=r.pesData,v=d.pesData;let T;if(g&&(T=v_(g,this.logger))){if(this.videoParser===null)switch(o.segmentCodec){case"avc":this.videoParser=new b4;break;case"hevc":this.videoParser=new R4;break}this.videoParser!==null&&(this.videoParser.parsePES(o,p,T,!0),o.pesData=null)}else o.pesData=g;if(y&&(T=v_(y,this.logger))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,T);break;case"mp3":this.parseMPEGPES(r,T);break;case"ac3":this.parseAC3PES(r,T);break}r.pesData=null}else y!=null&&y.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=y;v&&(T=v_(v,this.logger))?(this.parseID3PES(d,T),d.pesData=null):d.pesData=v}demuxSampleAes(i,r,o){const d=this.demux(i,o,!0,!this.config.progressive),p=this.sampleAes=new Qte(this.observer,this.config,r);return this.decrypt(d,p)}decrypt(i,r){return new Promise(o=>{const{audioTrack:d,videoTrack:p}=i;d.samples&&d.segmentCodec==="aac"?r.decryptAacSamples(d.samples,0,()=>{p.samples?r.decryptAvcSamples(p.samples,0,0,()=>{o(i)}):o(i)}):p.samples&&r.decryptAvcSamples(p.samples,0,0,()=>{o(i)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(i,r){let o=0;const d=this.aacOverFlow;let p=r.data;if(d){this.aacOverFlow=null;const I=d.missing,L=d.sample.unit.byteLength;if(I===-1)p=dc(d.sample.unit,p);else{const N=L-I;d.sample.unit.set(p.subarray(0,I),N),i.samples.push(d.sample),o=d.missing}}let g,y;for(g=o,y=p.length;g<y-1&&!pC(p,g);g++);if(g!==o){let I;const L=g<y-1;if(L?I=`AAC PES did not start with ADTS header,offset:${g}`:I="No ADTS header found in AAC PES",YN(this.observer,new Error(I),L,this.logger),!L)return}x5(i,this.observer,p,g,this.audioCodec);let v;if(r.pts!==void 0)v=r.pts;else if(d){const I=P5(i.samplerate);v=d.sample.pts+I}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let T=0,C;for(;g<y;)if(C=k5(i,p,g,v,T),g+=C.length,C.missing){this.aacOverFlow=C;break}else for(T++;g<y-1&&!pC(p,g);g++);}parseMPEGPES(i,r){const o=r.data,d=o.length;let p=0,g=0;const y=r.pts;if(y===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;g<d;)if(j5(o,g)){const v=B5(i,o,g,y,p);if(v)g+=v.length,p++;else break}else g++}parseAC3PES(i,r){{const o=r.data,d=r.pts;if(d===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const p=o.length;let g=0,y=0,v;for(;y<p&&(v=K5(i,o,y,d,g++))>0;)y+=v}}parseID3PES(i,r){if(r.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const o=Mi({},r,{type:this._videoTrack?Eo.emsg:Eo.audioId3,duration:Number.POSITIVE_INFINITY});i.samples.push(o)}}function WN(h,i){return((h[i+1]&31)<<8)+h[i+2]}function Zte(h,i){return(h[i+10]&31)<<8|h[i+11]}function ene(h,i,r,o,d,p){const g={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},y=(h[i+1]&15)<<8|h[i+2],v=i+3+y-4,T=(h[i+10]&15)<<8|h[i+11];for(i+=12+T;i<v;){const C=WN(h,i),I=(h[i+3]&15)<<8|h[i+4];switch(h[i]){case 207:if(!o){fN("ADTS AAC",p);break}case 15:g.audioPid===-1&&(g.audioPid=C);break;case 21:g.id3Pid===-1&&(g.id3Pid=C);break;case 219:if(!o){fN("H.264",p);break}case 27:g.videoPid===-1&&(g.videoPid=C);break;case 3:case 4:!r.mpeg&&!r.mp3?p.log("MPEG audio found, not supported in this browser"):g.audioPid===-1&&(g.audioPid=C,g.segmentAudioCodec="mp3");break;case 193:if(!o){fN("AC-3",p);break}case 129:r.ac3?g.audioPid===-1&&(g.audioPid=C,g.segmentAudioCodec="ac3"):p.log("AC-3 audio found, not supported in this browser");break;case 6:if(g.audioPid===-1&&I>0){let L=i+5,N=I;for(;N>2;){switch(h[L]){case 106:r.ac3!==!0?p.log("AC-3 audio found, not supported in this browser for now"):(g.audioPid=C,g.segmentAudioCodec="ac3");break}const K=h[L+1]+2;L+=K,N-=K}}break;case 194:case 135:return YN(d,new Error("Unsupported EC-3 in M2TS found"),void 0,p),g;case 36:g.videoPid===-1&&(g.videoPid=C,g.segmentVideoCodec="hevc",p.log("HEVC in M2TS found"));break}i+=I+5}return g}function YN(h,i,r,o){o.warn(`parsing error: ${i.message}`),h.emit(z.ERROR,z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.FRAG_PARSING_ERROR,fatal:!1,levelRetry:r,error:i,reason:i.message})}function fN(h,i){i.log(`${h} with AES-128-CBC encryption found in unencrypted stream`)}function v_(h,i){let r=0,o,d,p,g,y;const v=h.data;if(!h||h.size===0)return null;for(;v[0].length<19&&v.length>1;)v[0]=dc(v[0],v[1]),v.splice(1,1);if(o=v[0],(o[0]<<16)+(o[1]<<8)+o[2]===1){if(d=(o[4]<<8)+o[5],d&&d>h.size-6)return null;const C=o[7];C&192&&(g=(o[9]&14)*536870912+(o[10]&255)*4194304+(o[11]&254)*16384+(o[12]&255)*128+(o[13]&254)/2,C&64?(y=(o[14]&14)*536870912+(o[15]&255)*4194304+(o[16]&254)*16384+(o[17]&255)*128+(o[18]&254)/2,g-y>60*9e4&&(i.warn(`${Math.round((g-y)/9e4)}s delta between PTS and DTS, align them`),g=y)):y=g),p=o[8];let I=p+9;if(h.size<=I)return null;h.size-=I;const L=new Uint8Array(h.size);for(let N=0,x=v.length;N<x;N++){o=v[N];let K=o.byteLength;if(I)if(I>K){I-=K;continue}else o=o.subarray(I),K-=I,I=0;L.set(o,r),r+=K}return d&&(d-=p+3),{data:L,pts:g,dts:y,len:d}}return null}class tne{static getSilentFrame(i,r){switch(i){case"mp4a.40.2":if(r===1)return new Uint8Array([0,200,0,128,35,128]);if(r===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(r===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(r===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(r===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(r===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(r===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const af=Math.pow(2,32)-1;class xe{static init(){xe.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let i;for(i in xe.types)xe.types.hasOwnProperty(i)&&(xe.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);const r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),o=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);xe.HDLR_TYPES={video:r,audio:o};const d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),p=new Uint8Array([0,0,0,0,0,0,0,0]);xe.STTS=xe.STSC=xe.STCO=p,xe.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),xe.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),xe.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),xe.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const g=new Uint8Array([105,115,111,109]),y=new Uint8Array([97,118,99,49]),v=new Uint8Array([0,0,0,1]);xe.FTYP=xe.box(xe.types.ftyp,g,v,g,y),xe.DINF=xe.box(xe.types.dinf,xe.box(xe.types.dref,d))}static box(i,...r){let o=8,d=r.length;const p=d;for(;d--;)o+=r[d].byteLength;const g=new Uint8Array(o);for(g[0]=o>>24&255,g[1]=o>>16&255,g[2]=o>>8&255,g[3]=o&255,g.set(i,4),d=0,o=8;d<p;d++)g.set(r[d],o),o+=r[d].byteLength;return g}static hdlr(i){return xe.box(xe.types.hdlr,xe.HDLR_TYPES[i])}static mdat(i){return xe.box(xe.types.mdat,i)}static mdhd(i,r){r*=i;const o=Math.floor(r/(af+1)),d=Math.floor(r%(af+1));return xe.box(xe.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255,d>>24,d>>16&255,d>>8&255,d&255,85,196,0,0]))}static mdia(i){return xe.box(xe.types.mdia,xe.mdhd(i.timescale||0,i.duration||0),xe.hdlr(i.type),xe.minf(i))}static mfhd(i){return xe.box(xe.types.mfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255]))}static minf(i){return i.type==="audio"?xe.box(xe.types.minf,xe.box(xe.types.smhd,xe.SMHD),xe.DINF,xe.stbl(i)):xe.box(xe.types.minf,xe.box(xe.types.vmhd,xe.VMHD),xe.DINF,xe.stbl(i))}static moof(i,r,o){return xe.box(xe.types.moof,xe.mfhd(i),xe.traf(o,r))}static moov(i){let r=i.length;const o=[];for(;r--;)o[r]=xe.trak(i[r]);return xe.box.apply(null,[xe.types.moov,xe.mvhd(i[0].timescale||0,i[0].duration||0)].concat(o).concat(xe.mvex(i)))}static mvex(i){let r=i.length;const o=[];for(;r--;)o[r]=xe.trex(i[r]);return xe.box.apply(null,[xe.types.mvex,...o])}static mvhd(i,r){r*=i;const o=Math.floor(r/(af+1)),d=Math.floor(r%(af+1)),p=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255,d>>24,d>>16&255,d>>8&255,d&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return xe.box(xe.types.mvhd,p)}static sdtp(i){const r=i.samples||[],o=new Uint8Array(4+r.length);let d,p;for(d=0;d<r.length;d++)p=r[d].flags,o[d+4]=p.dependsOn<<4|p.isDependedOn<<2|p.hasRedundancy;return xe.box(xe.types.sdtp,o)}static stbl(i){return xe.box(xe.types.stbl,xe.stsd(i),xe.box(xe.types.stts,xe.STTS),xe.box(xe.types.stsc,xe.STSC),xe.box(xe.types.stsz,xe.STSZ),xe.box(xe.types.stco,xe.STCO))}static avc1(i){let r=[],o=[],d,p,g;for(d=0;d<i.sps.length;d++)p=i.sps[d],g=p.byteLength,r.push(g>>>8&255),r.push(g&255),r=r.concat(Array.prototype.slice.call(p));for(d=0;d<i.pps.length;d++)p=i.pps[d],g=p.byteLength,o.push(g>>>8&255),o.push(g&255),o=o.concat(Array.prototype.slice.call(p));const y=xe.box(xe.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|i.sps.length].concat(r).concat([i.pps.length]).concat(o))),v=i.width,T=i.height,C=i.pixelRatio[0],I=i.pixelRatio[1];return xe.box(xe.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,v>>8&255,v&255,T>>8&255,T&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),y,xe.box(xe.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),xe.box(xe.types.pasp,new Uint8Array([C>>24,C>>16&255,C>>8&255,C&255,I>>24,I>>16&255,I>>8&255,I&255])))}static esds(i){const r=i.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...r,6,1,2])}static audioStsd(i){const r=i.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount||0,0,16,0,0,0,0,r>>8&255,r&255,0,0])}static mp4a(i){return xe.box(xe.types.mp4a,xe.audioStsd(i),xe.box(xe.types.esds,xe.esds(i)))}static mp3(i){return xe.box(xe.types[".mp3"],xe.audioStsd(i))}static ac3(i){return xe.box(xe.types["ac-3"],xe.audioStsd(i),xe.box(xe.types.dac3,i.config))}static stsd(i){const{segmentCodec:r}=i;if(i.type==="audio"){if(r==="aac")return xe.box(xe.types.stsd,xe.STSD,xe.mp4a(i));if(r==="ac3"&&i.config)return xe.box(xe.types.stsd,xe.STSD,xe.ac3(i));if(r==="mp3"&&i.codec==="mp3")return xe.box(xe.types.stsd,xe.STSD,xe.mp3(i))}else if(i.pps&&i.sps){if(r==="avc")return xe.box(xe.types.stsd,xe.STSD,xe.avc1(i));if(r==="hevc"&&i.vps)return xe.box(xe.types.stsd,xe.STSD,xe.hvc1(i))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${i.type} segment codec (${r}/${i.codec})`)}static tkhd(i){const r=i.id,o=(i.duration||0)*(i.timescale||0),d=i.width||0,p=i.height||0,g=Math.floor(o/(af+1)),y=Math.floor(o%(af+1));return xe.box(xe.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255,y>>24,y>>16&255,y>>8&255,y&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,d>>8&255,d&255,0,0,p>>8&255,p&255,0,0]))}static traf(i,r){const o=xe.sdtp(i),d=i.id,p=Math.floor(r/(af+1)),g=Math.floor(r%(af+1));return xe.box(xe.types.traf,xe.box(xe.types.tfhd,new Uint8Array([0,0,0,0,d>>24,d>>16&255,d>>8&255,d&255])),xe.box(xe.types.tfdt,new Uint8Array([1,0,0,0,p>>24,p>>16&255,p>>8&255,p&255,g>>24,g>>16&255,g>>8&255,g&255])),xe.trun(i,o.length+16+20+8+16+8+8),o)}static trak(i){return i.duration=i.duration||4294967295,xe.box(xe.types.trak,xe.tkhd(i),xe.mdia(i))}static trex(i){const r=i.id;return xe.box(xe.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(i,r){const o=i.samples||[],d=o.length,p=12+16*d,g=new Uint8Array(p);let y,v,T,C,I,L;for(r+=8+p,g.set([i.type==="video"?1:0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,d&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0),y=0;y<d;y++)v=o[y],T=v.duration,C=v.size,I=v.flags,L=v.cts,g.set([T>>>24&255,T>>>16&255,T>>>8&255,T&255,C>>>24&255,C>>>16&255,C>>>8&255,C&255,I.isLeading<<2|I.dependsOn,I.isDependedOn<<6|I.hasRedundancy<<4|I.paddingValue<<1|I.isNonSync,I.degradPrio&61440,I.degradPrio&15,L>>>24&255,L>>>16&255,L>>>8&255,L&255],12+16*y);return xe.box(xe.types.trun,g)}static initSegment(i){xe.types||xe.init();const r=xe.moov(i);return dc(xe.FTYP,r)}static hvc1(i){const r=i.params,o=[i.vps,i.sps,i.pps],d=4,p=new Uint8Array([1,r.general_profile_space<<6|(r.general_tier_flag?32:0)|r.general_profile_idc,r.general_profile_compatibility_flags[0],r.general_profile_compatibility_flags[1],r.general_profile_compatibility_flags[2],r.general_profile_compatibility_flags[3],r.general_constraint_indicator_flags[0],r.general_constraint_indicator_flags[1],r.general_constraint_indicator_flags[2],r.general_constraint_indicator_flags[3],r.general_constraint_indicator_flags[4],r.general_constraint_indicator_flags[5],r.general_level_idc,240|r.min_spatial_segmentation_idc>>8,255&r.min_spatial_segmentation_idc,252|r.parallelismType,252|r.chroma_format_idc,248|r.bit_depth_luma_minus8,248|r.bit_depth_chroma_minus8,0,parseInt(r.frame_rate.fps),d-1|r.temporal_id_nested<<2|r.num_temporal_layers<<3|(r.frame_rate.fixed?64:0),o.length]);let g=p.length;for(let x=0;x<o.length;x+=1){g+=3;for(let K=0;K<o[x].length;K+=1)g+=2+o[x][K].length}const y=new Uint8Array(g);y.set(p,0),g=p.length;const v=o.length-1;for(let x=0;x<o.length;x+=1){y.set(new Uint8Array([32+x|(x===v?128:0),0,o[x].length]),g),g+=3;for(let K=0;K<o[x].length;K+=1)y.set(new Uint8Array([o[x][K].length>>8,o[x][K].length&255]),g),g+=2,y.set(o[x][K],g),g+=o[x][K].length}const T=xe.box(xe.types.hvcC,y),C=i.width,I=i.height,L=i.pixelRatio[0],N=i.pixelRatio[1];return xe.box(xe.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,C>>8&255,C&255,I>>8&255,I&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),T,xe.box(xe.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),xe.box(xe.types.pasp,new Uint8Array([L>>24,L>>16&255,L>>8&255,L&255,N>>24,N>>16&255,N>>8&255,N&255])))}}xe.types=void 0;xe.HDLR_TYPES=void 0;xe.STTS=void 0;xe.STSC=void 0;xe.STCO=void 0;xe.STSZ=void 0;xe.VMHD=void 0;xe.SMHD=void 0;xe.STSD=void 0;xe.FTYP=void 0;xe.DINF=void 0;const Y5=9e4;function xL(h,i,r=1,o=!1){const d=h*i*r;return o?Math.round(d):d}function nne(h,i,r=1,o=!1){return xL(h,i,1/r,o)}function Zy(h,i=!1){return xL(h,1e3,1/Y5,i)}function ine(h,i=1){return xL(h,Y5,1/i)}const sne=10*1e3,rne=1024,ane=1152,one=1536;let b_=null,pN=null;function A4(h,i,r,o){return{duration:i,size:r,cts:o,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:h?2:1,isNonSync:h?0:1}}}class zA{constructor(i,r,o,d){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=i,this.config=r,this.typeSupported=o,this.logger=d,this.ISGenerated=!1,b_===null){const g=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);b_=g?parseInt(g[1]):0}if(pN===null){const p=navigator.userAgent.match(/Safari\/(\d+)/i);pN=p?parseInt(p[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(i){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=i}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(i){let r=!1;const o=i[0].pts,d=i.reduce((p,g)=>{let y=g.pts,v=y-p;return v<-4294967296&&(r=!0,y=lc(y,o),v=y-p),v>0?p:y},o);return r&&this.logger.debug("PTS rollover detected"),d}remux(i,r,o,d,p,g,y,v){let T,C,I,L,N,x,K=p,H=p;const Q=i.pid>-1,ne=r.pid>-1,ee=r.samples.length,pe=i.samples.length>0,de=y&&ee>0||ee>1;if((!Q||pe)&&(!ne||de)||this.ISGenerated||y){if(this.ISGenerated){var Se,Te,_e,he;const qe=this.videoTrackConfig;(qe&&(r.width!==qe.width||r.height!==qe.height||((Se=r.pixelRatio)==null?void 0:Se[0])!==((Te=qe.pixelRatio)==null?void 0:Te[0])||((_e=r.pixelRatio)==null?void 0:_e[1])!==((he=qe.pixelRatio)==null?void 0:he[1]))||!qe&&de||this.nextAudioPts===null&&pe)&&this.resetInitSegment()}this.ISGenerated||(I=this.generateIS(i,r,p,g));const Ge=this.isVideoContiguous;let st=-1,It;if(de&&(st=cne(r.samples),!Ge&&this.config.forceKeyFrameOnDiscontinuity))if(x=!0,st>0){this.logger.warn(`[mp4-remuxer]: Dropped ${st} out of ${ee} video samples due to a missing keyframe`);const qe=this.getVideoStartPts(r.samples);r.samples=r.samples.slice(st),r.dropped+=st,H+=(r.samples[0].pts-qe)/r.inputTimeScale,It=H}else st===-1&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${ee} video samples`),x=!1);if(this.ISGenerated){if(pe&&de){const qe=this.getVideoStartPts(r.samples),Oe=(lc(i.samples[0].pts,qe)-qe)/r.inputTimeScale;K+=Math.max(0,Oe),H+=Math.max(0,-Oe)}if(pe){if(i.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),I=this.generateIS(i,r,p,g)),C=this.remuxAudio(i,K,this.isAudioContiguous,g,ne||de||v===Vt.AUDIO?H:void 0),de){const qe=C?C.endPTS-C.startPTS:0;r.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),I=this.generateIS(i,r,p,g)),T=this.remuxVideo(r,H,Ge,qe)}}else de&&(T=this.remuxVideo(r,H,Ge,0));T&&(T.firstKeyFrame=st,T.independent=st!==-1,T.firstKeyFramePTS=It)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(o.samples.length&&(N=q5(o,p,this._initPTS,this._initDTS)),d.samples.length&&(L=$5(d,p,this._initPTS))),{audio:C,video:T,initSegment:I,independent:x,text:L,id3:N}}generateIS(i,r,o,d){const p=i.samples,g=r.samples,y=this.typeSupported,v={},T=this._initPTS;let C=!T||d,I="audio/mp4",L,N,x;if(C&&(L=N=1/0),i.config&&p.length){switch(i.timescale=i.samplerate,i.segmentCodec){case"mp3":y.mpeg?(I="audio/mpeg",i.codec=""):y.mp3&&(i.codec="mp3");break;case"ac3":i.codec="ac-3";break}v.audio={id:"audio",container:I,codec:i.codec,initSegment:i.segmentCodec==="mp3"&&y.mpeg?new Uint8Array(0):xe.initSegment([i]),metadata:{channelCount:i.channelCount}},C&&(x=i.inputTimeScale,!T||x!==T.timescale?L=N=p[0].pts-Math.round(x*o):C=!1)}if(r.sps&&r.pps&&g.length){if(r.timescale=r.inputTimeScale,v.video={id:"main",container:"video/mp4",codec:r.codec,initSegment:xe.initSegment([r]),metadata:{width:r.width,height:r.height}},C)if(x=r.inputTimeScale,!T||x!==T.timescale){const K=this.getVideoStartPts(g),H=Math.round(x*o);N=Math.min(N,lc(g[0].dts,K)-H),L=Math.min(L,K-H)}else C=!1;this.videoTrackConfig={width:r.width,height:r.height,pixelRatio:r.pixelRatio}}if(Object.keys(v).length)return this.ISGenerated=!0,C?(this._initPTS={baseTime:L,timescale:x},this._initDTS={baseTime:N,timescale:x}):L=x=void 0,{tracks:v,initPTS:L,timescale:x}}remuxVideo(i,r,o,d){const p=i.inputTimeScale,g=i.samples,y=[],v=g.length,T=this._initPTS;let C=this.nextAvcDts,I=8,L=this.videoSampleDuration,N,x,K=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY,Q=!1;if(!o||C===null){const Re=r*p,se=g[0].pts-lc(g[0].dts,g[0].pts);b_&&C!==null&&Math.abs(Re-se-C)<15e3?o=!0:C=Re-se}const ne=T.baseTime*p/T.timescale;for(let Re=0;Re<v;Re++){const se=g[Re];se.pts=lc(se.pts-ne,C),se.dts=lc(se.dts-ne,C),se.dts<g[Re>0?Re-1:Re].dts&&(Q=!0)}Q&&g.sort(function(Re,se){const we=Re.dts-se.dts,He=Re.pts-se.pts;return we||He}),N=g[0].dts,x=g[g.length-1].dts;const ee=x-N,pe=ee?Math.round(ee/(v-1)):L||i.inputTimeScale/30;if(o){const Re=N-C,se=Re>pe,we=Re<-1;if((se||we)&&(se?this.logger.warn(`${(i.segmentCodec||"").toUpperCase()}: ${Zy(Re,!0)} ms (${Re}dts) hole between fragments detected at ${r.toFixed(3)}`):this.logger.warn(`${(i.segmentCodec||"").toUpperCase()}: ${Zy(-Re,!0)} ms (${Re}dts) overlapping between fragments detected at ${r.toFixed(3)}`),!we||C>=g[0].pts||b_)){N=C;const He=g[0].pts-Re;if(se)g[0].dts=N,g[0].pts=He;else{let ct=!0;for(let Be=0;Be<g.length&&!(g[Be].dts>He&&ct);Be++){const Et=g[Be].pts;if(g[Be].dts-=Re,g[Be].pts-=Re,Be<g.length-1){const St=g[Be+1].pts,it=g[Be].pts,Ze=St<=it,mt=St<=Et;ct=Ze==mt}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${Zy(He,!0)}/${Zy(N,!0)}, delta: ${Zy(Re,!0)} ms`)}}N=Math.max(0,N);let de=0,be=0,Se=N;for(let Re=0;Re<v;Re++){const se=g[Re],we=se.units,He=we.length;let ct=0;for(let Be=0;Be<He;Be++)ct+=we[Be].data.length;be+=ct,de+=He,se.length=ct,se.dts<Se?(se.dts=Se,Se+=pe/4|0||1):Se=se.dts,K=Math.min(se.pts,K),H=Math.max(se.pts,H)}x=g[v-1].dts;const Te=be+4*de+8;let _e;try{_e=new Uint8Array(Te)}catch(Re){this.observer.emit(z.ERROR,z.ERROR,{type:Gt.MUX_ERROR,details:Ue.REMUX_ALLOC_ERROR,fatal:!1,error:Re,bytes:Te,reason:`fail allocating video mdat ${Te}`});return}const he=new DataView(_e.buffer);he.setUint32(0,Te),_e.set(xe.types.mdat,4);let Ge=!1,st=Number.POSITIVE_INFINITY,It=Number.POSITIVE_INFINITY,qe=Number.NEGATIVE_INFINITY,ut=Number.NEGATIVE_INFINITY;for(let Re=0;Re<v;Re++){const se=g[Re],we=se.units;let He=0;for(let Et=0,St=we.length;Et<St;Et++){const it=we[Et],Ze=it.data,mt=it.data.byteLength;he.setUint32(I,mt),I+=4,_e.set(Ze,I),I+=mt,He+=4+mt}let ct;if(Re<v-1)L=g[Re+1].dts-se.dts,ct=g[Re+1].pts-se.pts;else{const Et=this.config,St=Re>0?se.dts-g[Re-1].dts:pe;if(ct=Re>0?se.pts-g[Re-1].pts:pe,Et.stretchShortVideoTrack&&this.nextAudioPts!==null){const it=Math.floor(Et.maxBufferHole*p),Ze=(d?K+d*p:this.nextAudioPts)-se.pts;Ze>it?(L=Ze-St,L<0?L=St:Ge=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${Ze/90} ms to the next segment; using duration ${L/90} ms for the last video frame.`)):L=St}else L=St}const Be=Math.round(se.pts-se.dts);st=Math.min(st,L),qe=Math.max(qe,L),It=Math.min(It,ct),ut=Math.max(ut,ct),y.push(A4(se.key,L,He,Be))}if(y.length){if(b_){if(b_<70){const Re=y[0].flags;Re.dependsOn=2,Re.isNonSync=0}}else if(pN&&ut-It<qe-st&&pe/qe<.025&&y[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let Re=N;for(let se=0,we=y.length;se<we;se++){const He=Re+y[se].duration,ct=Re+y[se].cts;if(se<we-1){const Be=He+y[se+1].cts;y[se].duration=Be-ct}else y[se].duration=se?y[se-1].duration:pe;y[se].cts=0,Re=He}}}L=Ge||!L?pe:L,this.nextAvcDts=C=x+L,this.videoSampleDuration=L,this.isVideoContiguous=!0;const Ke={data1:xe.moof(i.sequenceNumber++,N,Mi(i,{samples:y})),data2:_e,startPTS:K/p,endPTS:(H+L)/p,startDTS:N/p,endDTS:C/p,type:"video",hasAudio:!1,hasVideo:!0,nb:y.length,dropped:i.dropped};return i.samples=[],i.dropped=0,Ke}getSamplesPerFrame(i){switch(i.segmentCodec){case"mp3":return ane;case"ac3":return one;default:return rne}}remuxAudio(i,r,o,d,p){const g=i.inputTimeScale,y=i.samplerate?i.samplerate:g,v=g/y,T=this.getSamplesPerFrame(i),C=T*v,I=this._initPTS,L=i.segmentCodec==="mp3"&&this.typeSupported.mpeg,N=[],x=p!==void 0;let K=i.samples,H=L?0:8,Q=this.nextAudioPts||-1;const ne=r*g,ee=I.baseTime*g/I.timescale;if(this.isAudioContiguous=o=o||K.length&&Q>0&&(d&&Math.abs(ne-Q)<9e3||Math.abs(lc(K[0].pts-ee,ne)-Q)<20*C),K.forEach(function(Oe){Oe.pts=lc(Oe.pts-ee,ne)}),!o||Q<0){if(K=K.filter(Oe=>Oe.pts>=0),!K.length)return;p===0?Q=0:d&&!x?Q=Math.max(0,ne):Q=K[0].pts}if(i.segmentCodec==="aac"){const Oe=this.config.maxAudioFramesDrift;for(let Qe=0,Ke=Q;Qe<K.length;Qe++){const Re=K[Qe],se=Re.pts,we=se-Ke,He=Math.abs(1e3*we/g);if(we<=-Oe*C&&x)Qe===0&&(this.logger.warn(`Audio frame @ ${(se/g).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*we/g)} ms.`),this.nextAudioPts=Q=Ke=se);else if(we>=Oe*C&&He<sne&&x){let ct=Math.round(we/C);Ke=se-ct*C,Ke<0&&(ct--,Ke+=C),Qe===0&&(this.nextAudioPts=Q=Ke),this.logger.warn(`[mp4-remuxer]: Injecting ${ct} audio frame @ ${(Ke/g).toFixed(3)}s due to ${Math.round(1e3*we/g)} ms gap.`);for(let Be=0;Be<ct;Be++){const Et=Math.max(Ke,0);let St=tne.getSilentFrame(i.parsedCodec||i.manifestCodec||i.codec,i.channelCount);St||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),St=Re.unit.subarray()),K.splice(Qe,0,{unit:St,pts:Et}),Ke+=C,Qe++}}Re.pts=Ke,Ke+=C}}let pe=null,de=null,be,Se=0,Te=K.length;for(;Te--;)Se+=K[Te].unit.byteLength;for(let Oe=0,Qe=K.length;Oe<Qe;Oe++){const Ke=K[Oe],Re=Ke.unit;let se=Ke.pts;if(de!==null){const He=N[Oe-1];He.duration=Math.round((se-de)/v)}else if(o&&i.segmentCodec==="aac"&&(se=Q),pe=se,Se>0){Se+=H;try{be=new Uint8Array(Se)}catch(He){this.observer.emit(z.ERROR,z.ERROR,{type:Gt.MUX_ERROR,details:Ue.REMUX_ALLOC_ERROR,fatal:!1,error:He,bytes:Se,reason:`fail allocating audio mdat ${Se}`});return}L||(new DataView(be.buffer).setUint32(0,Se),be.set(xe.types.mdat,4))}else return;be.set(Re,H);const we=Re.byteLength;H+=we,N.push(A4(!0,T,we,0)),de=se}const _e=N.length;if(!_e)return;const he=N[N.length-1];this.nextAudioPts=Q=de+v*he.duration;const Ge=L?new Uint8Array(0):xe.moof(i.sequenceNumber++,pe/v,Mi({},i,{samples:N}));i.samples=[];const st=pe/g,It=Q/g,ut={data1:Ge,data2:be,startPTS:st,endPTS:It,startDTS:st,endDTS:It,type:"audio",hasAudio:!0,hasVideo:!1,nb:_e};return this.isAudioContiguous=!0,ut}}function lc(h,i){let r;if(i===null)return h;for(i<h?r=-8589934592:r=8589934592;Math.abs(h-i)>4294967296;)h+=r;return h}function cne(h){for(let i=0;i<h.length;i++)if(h[i].key)return i;return-1}function q5(h,i,r,o){const d=h.samples.length;if(!d)return;const p=h.inputTimeScale;for(let y=0;y<d;y++){const v=h.samples[y];v.pts=lc(v.pts-r.baseTime*p/r.timescale,i*p)/p,v.dts=lc(v.dts-o.baseTime*p/o.timescale,i*p)/p}const g=h.samples;return h.samples=[],{samples:g}}function $5(h,i,r){const o=h.samples.length;if(!o)return;const d=h.inputTimeScale;for(let g=0;g<o;g++){const y=h.samples[g];y.pts=lc(y.pts-r.baseTime*d/r.timescale,i*d)/d}h.samples.sort((g,y)=>g.pts-y.pts);const p=h.samples;return h.samples=[],{samples:p}}class lne{constructor(i,r,o,d){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=d}destroy(){}resetTimeStamp(i){this.initPTS=i,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(i,r,o,d){this.audioCodec=r,this.videoCodec=o,this.generateInitSegment(JZ(i,d)),this.emitInitSegment=!0}generateInitSegment(i){let{audioCodec:r,videoCodec:o}=this;if(!(i!=null&&i.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const d=this.initData=i5(i);d.audio&&(r=C4(d.audio,ki.AUDIO)),d.video&&(o=C4(d.video,ki.VIDEO));const p={};d.audio&&d.video?p.audiovideo={container:"video/mp4",codec:r+","+o,supplemental:d.video.supplemental,initSegment:i,id:"main"}:d.audio?p.audio={container:"audio/mp4",codec:r,initSegment:i,id:"audio"}:d.video?p.video={container:"video/mp4",codec:o,supplemental:d.video.supplemental,initSegment:i,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=p}remux(i,r,o,d,p,g){var y,v;let{initPTS:T,lastEndTime:C}=this;const I={audio:void 0,video:void 0,text:d,id3:o,initSegment:void 0};xt(C)||(C=this.lastEndTime=p||0);const L=r.samples;if(!(L!=null&&L.length))return I;const N={initPTS:void 0,timescale:1};let x=this.initData;if((y=x)!=null&&y.length||(this.generateInitSegment(L),x=this.initData),!((v=x)!=null&&v.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),I;this.emitInitSegment&&(N.tracks=this.initTracks,this.emitInitSegment=!1);const K=ZZ(L,x),H=QZ(x,L),Q=H===null?p:H;(g||!T)&&(dne(T,Q,p,K)||N.timescale!==T.timescale)&&(N.initPTS=Q-p,T&&T.timescale===1&&this.logger.warn(`Adjusting initPTS @${p} from ${T.baseTime/T.timescale} to ${N.initPTS}`),this.initPTS=T={baseTime:N.initPTS,timescale:1});const ne=i?Q-T.baseTime/T.timescale:C,ee=ne+K;tee(x,L,T.baseTime/T.timescale),K>0?this.lastEndTime=ee:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const pe=!!x.audio,de=!!x.video;let be="";pe&&(be+="audio"),de&&(be+="video");const Se={data1:L,startPTS:ne,startDTS:ne,endPTS:ee,endDTS:ee,type:be,hasAudio:pe,hasVideo:de,nb:1,dropped:0};return I.audio=Se.type==="audio"?Se:void 0,I.video=Se.type!=="audio"?Se:void 0,I.initSegment=N,I.id3=q5(o,p,T,T),d.samples.length&&(I.text=$5(d,p,T)),I}}function dne(h,i,r,o){if(h===null)return!0;const d=Math.max(o,1),p=i-h.baseTime/h.timescale;return Math.abs(p-r)>d}function C4(h,i){const r=h==null?void 0:h.codec;return r&&r.length>4?r:i===ki.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?oC(r,!1):(Zn.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(Zn.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let bu;try{bu=self.performance.now.bind(self.performance)}catch{bu=Date.now}const XA=[{demux:Jte,remux:lne},{demux:lf,remux:zA},{demux:qte,remux:zA},{demux:zte,remux:zA}];XA.splice(2,0,{demux:$te,remux:zA});class I4{constructor(i,r,o,d,p,g){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=i,this.typeSupported=r,this.config=o,this.id=p,this.logger=g}configure(i){this.transmuxConfig=i,this.decrypter&&this.decrypter.reset()}push(i,r,o,d){const p=o.transmuxing;p.executeStart=bu();let g=new Uint8Array(i);const{currentTransmuxState:y,transmuxConfig:v}=this;d&&(this.currentTransmuxState=d);const{contiguous:T,discontinuity:C,trackSwitch:I,accurateTimeOffset:L,timeOffset:N,initSegmentChange:x}=d||y,{audioCodec:K,videoCodec:H,defaultInitPts:Q,duration:ne,initSegmentData:ee}=v,pe=une(g,r);if(pe&&C_(pe.method)){const Te=this.getDecrypter(),_e=RL(pe.method);if(Te.isSync()){let he=Te.softwareDecrypt(g,pe.key.buffer,pe.iv.buffer,_e);if(o.part>-1){const st=Te.flush();he=st&&st.buffer}if(!he)return p.executeEnd=bu(),mN(o);g=new Uint8Array(he)}else return this.asyncResult=!0,this.decryptionPromise=Te.webCryptoDecrypt(g,pe.key.buffer,pe.iv.buffer,_e).then(he=>{const Ge=this.push(he,null,o);return this.decryptionPromise=null,Ge}),this.decryptionPromise}const de=this.needsProbing(C,I);if(de){const Te=this.configureTransmuxer(g);if(Te)return this.logger.warn(`[transmuxer] ${Te.message}`),this.observer.emit(z.ERROR,z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.FRAG_PARSING_ERROR,fatal:!1,error:Te,reason:Te.message}),p.executeEnd=bu(),mN(o)}(C||I||x||de)&&this.resetInitSegment(ee,K,H,ne,r),(C||x||de)&&this.resetInitialTimestamp(Q),T||this.resetContiguity();const be=this.transmux(g,pe,N,L,o);this.asyncResult=pT(be);const Se=this.currentTransmuxState;return Se.contiguous=!0,Se.discontinuity=!1,Se.trackSwitch=!1,p.executeEnd=bu(),be}flush(i){const r=i.transmuxing;r.executeStart=bu();const{decrypter:o,currentTransmuxState:d,decryptionPromise:p}=this;if(p)return this.asyncResult=!0,p.then(()=>this.flush(i));const g=[],{timeOffset:y}=d;if(o){const I=o.flush();I&&g.push(this.push(I.buffer,null,i))}const{demuxer:v,remuxer:T}=this;if(!v||!T){r.executeEnd=bu();const I=[mN(i)];return this.asyncResult?Promise.resolve(I):I}const C=v.flush(y);return pT(C)?(this.asyncResult=!0,C.then(I=>(this.flushRemux(g,I,i),g))):(this.flushRemux(g,C,i),this.asyncResult?Promise.resolve(g):g)}flushRemux(i,r,o){const{audioTrack:d,videoTrack:p,id3Track:g,textTrack:y}=r,{accurateTimeOffset:v,timeOffset:T}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${o.sn}${o.part>-1?" part: "+o.part:""} of ${this.id===Vt.MAIN?"level":"track"} ${o.level}`);const C=this.remuxer.remux(d,p,g,y,T,v,!0,this.id);i.push({remuxResult:C,chunkMeta:o}),o.transmuxing.executeEnd=bu()}resetInitialTimestamp(i){const{demuxer:r,remuxer:o}=this;!r||!o||(r.resetTimeStamp(i),o.resetTimeStamp(i))}resetContiguity(){const{demuxer:i,remuxer:r}=this;!i||!r||(i.resetContiguity(),r.resetNextTimestamp())}resetInitSegment(i,r,o,d,p){const{demuxer:g,remuxer:y}=this;!g||!y||(g.resetInitSegment(i,r,o,d),y.resetInitSegment(i,r,o,p))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(i,r,o,d,p){let g;return r&&r.method==="SAMPLE-AES"?g=this.transmuxSampleAes(i,r,o,d,p):g=this.transmuxUnencrypted(i,o,d,p),g}transmuxUnencrypted(i,r,o,d){const{audioTrack:p,videoTrack:g,id3Track:y,textTrack:v}=this.demuxer.demux(i,r,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(p,g,y,v,r,o,!1,this.id),chunkMeta:d}}transmuxSampleAes(i,r,o,d,p){return this.demuxer.demuxSampleAes(i,r,o).then(g=>({remuxResult:this.remuxer.remux(g.audioTrack,g.videoTrack,g.id3Track,g.textTrack,o,d,!1,this.id),chunkMeta:p}))}configureTransmuxer(i){const{config:r,observer:o,typeSupported:d}=this;let p;for(let I=0,L=XA.length;I<L;I++){var g;if((g=XA[I].demux)!=null&&g.probe(i,this.logger)){p=XA[I];break}}if(!p)return new Error("Failed to find demuxer by probing fragment data");const y=this.demuxer,v=this.remuxer,T=p.remux,C=p.demux;(!v||!(v instanceof T))&&(this.remuxer=new T(o,r,d,this.logger)),(!y||!(y instanceof C))&&(this.demuxer=new C(o,r,d,this.logger),this.probe=C.probe)}needsProbing(i,r){return!this.demuxer||!this.remuxer||i||r}getDecrypter(){let i=this.decrypter;return i||(i=this.decrypter=new vL(this.config)),i}}function une(h,i){let r=null;return h.byteLength>0&&(i==null?void 0:i.key)!=null&&i.iv!==null&&i.method!=null&&(r=i),r}const mN=h=>({remuxResult:{},chunkMeta:h});function pT(h){return"then"in h&&h.then instanceof Function}class hne{constructor(i,r,o,d,p){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=i,this.videoCodec=r,this.initSegmentData=o,this.duration=d,this.defaultInitPts=p||null}}class fne{constructor(i,r,o,d,p,g){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=i,this.contiguous=r,this.accurateTimeOffset=o,this.trackSwitch=d,this.timeOffset=p,this.initSegmentChange=g}}let w4=0;class z5{constructor(i,r,o,d){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=w4++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=v=>{const T=v.data,C=this.hls;if(!(!C||!(T!=null&&T.event)||T.instanceNo!==this.instanceNo))switch(T.event){case"init":{var I;const L=(I=this.workerContext)==null?void 0:I.objectURL;L&&self.URL.revokeObjectURL(L);break}case"transmuxComplete":{this.handleTransmuxComplete(T.data);break}case"flush":{this.onFlush(T.data);break}case"workerLog":{C.logger[T.data.logType]&&C.logger[T.data.logType](T.data.message);break}default:{T.data=T.data||{},T.data.frag=this.frag,T.data.part=this.part,T.data.id=this.id,C.trigger(T.event,T.data);break}}},this.onWorkerError=v=>{if(!this.hls)return;const T=new Error(`${v.message}  (${v.filename}:${v.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(z.ERROR,{type:Gt.OTHER_ERROR,details:Ue.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:T})};const p=i.config;this.hls=i,this.id=r,this.useWorker=!!p.enableWorker,this.onTransmuxComplete=o,this.onFlush=d;const g=(v,T)=>{T=T||{},T.frag=this.frag||void 0,v===z.ERROR&&(T=T,T.parent=this.id,T.part=this.part,this.error=T.error),this.hls.trigger(v,T)};this.observer=new IL,this.observer.on(z.FRAG_DECRYPTED,g),this.observer.on(z.ERROR,g);const y=K3(p.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const v=this.hls.logger;if(p.workerPath||gte()){try{p.workerPath?(v.log(`loading Web Worker ${p.workerPath} for "${r}"`),this.workerContext=_te(p.workerPath)):(v.log(`injecting Web Worker for "${r}"`),this.workerContext=Ete());const{worker:C}=this.workerContext;C.addEventListener("message",this.onWorkerMessage),C.addEventListener("error",this.onWorkerError),C.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:y,id:r,config:ds(p)})}catch(C){v.warn(`Error setting up "${r}" Web Worker, fallback to inline`,C),this.terminateWorker(),this.error=null,this.transmuxer=new I4(this.observer,y,p,"",r,i.logger)}return}}this.transmuxer=new I4(this.observer,y,p,"",r,i.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const i=this.instanceNo;this.instanceNo=w4++;const r=this.hls.config,o=K3(r.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:i,typeSupported:o,id:this.id,config:ds(r)})}}terminateWorker(){if(this.workerContext){const{worker:i}=this.workerContext;this.workerContext=null,i.removeEventListener("message",this.onWorkerMessage),i.removeEventListener("error",this.onWorkerError),Ste(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const r=this.transmuxer;r&&(r.destroy(),this.transmuxer=null)}const i=this.observer;i&&i.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(i,r,o,d,p,g,y,v,T,C){var I,L;T.transmuxing.start=self.performance.now();const{instanceNo:N,transmuxer:x}=this,K=g?g.start:p.start,H=p.decryptdata,Q=this.frag,ne=!(Q&&p.cc===Q.cc),ee=!(Q&&T.level===Q.level),pe=Q?T.sn-Q.sn:-1,de=this.part?T.part-this.part.index:-1,be=pe===0&&T.id>1&&T.id===(Q==null?void 0:Q.stats.chunkCount),Se=!ee&&(pe===1||pe===0&&(de===1||be&&de<=0)),Te=self.performance.now();(ee||pe||p.stats.parsing.start===0)&&(p.stats.parsing.start=Te),g&&(de||!Se)&&(g.stats.parsing.start=Te);const _e=!(Q&&((I=p.initSegment)==null?void 0:I.url)===((L=Q.initSegment)==null?void 0:L.url)),he=new fne(ne,Se,v,ee,K,_e);if(!Se||ne||_e){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${p.type} sn: ${T.sn}${T.part>-1?" part: "+T.part:""} ${this.id===Vt.MAIN?"level":"track"}: ${T.level} id: ${T.id}
        discontinuity: ${ne}
        trackSwitch: ${ee}
        contiguous: ${Se}
        accurateTimeOffset: ${v}
        timeOffset: ${K}
        initSegmentChange: ${_e}`);const Ge=new hne(o,d,r,y,C);this.configureTransmuxer(Ge)}if(this.frag=p,this.part=g,this.workerContext)this.workerContext.worker.postMessage({instanceNo:N,cmd:"demux",data:i,decryptdata:H,chunkMeta:T,state:he},i instanceof ArrayBuffer?[i]:[]);else if(x){const Ge=x.push(i,H,T,he);pT(Ge)?Ge.then(st=>{this.handleTransmuxComplete(st)}).catch(st=>{this.transmuxerError(st,T,"transmuxer-interface push error")}):this.handleTransmuxComplete(Ge)}}flush(i){i.transmuxing.start=self.performance.now();const{instanceNo:r,transmuxer:o}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:r,cmd:"flush",chunkMeta:i});else if(o){const d=o.flush(i);pT(d)?d.then(p=>{this.handleFlushResult(p,i)}).catch(p=>{this.transmuxerError(p,i,"transmuxer-interface flush error")}):this.handleFlushResult(d,i)}}transmuxerError(i,r,o){this.hls&&(this.error=i,this.hls.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.FRAG_PARSING_ERROR,chunkMeta:r,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:i,err:i,reason:o}))}handleFlushResult(i,r){i.forEach(o=>{this.handleTransmuxComplete(o)}),this.onFlush(r)}configureTransmuxer(i){const{instanceNo:r,transmuxer:o}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:r,cmd:"configure",config:i}):o&&o.configure(i)}handleTransmuxComplete(i){i.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(i)}}const O4=100;class pne extends CL{constructor(i,r,o){super(i,r,o,"audio-stream-controller",Vt.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:i}=this;i.on(z.LEVEL_LOADED,this.onLevelLoaded,this),i.on(z.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),i.on(z.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.on(z.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(z.BUFFER_RESET,this.onBufferReset,this),i.on(z.BUFFER_CREATED,this.onBufferCreated,this),i.on(z.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(z.BUFFER_FLUSHED,this.onBufferFlushed,this),i.on(z.INIT_PTS_FOUND,this.onInitPtsFound,this),i.on(z.FRAG_LOADING,this.onFragLoading,this),i.on(z.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:i}=this;i&&(super.unregisterListeners(),i.off(z.LEVEL_LOADED,this.onLevelLoaded,this),i.off(z.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),i.off(z.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.off(z.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(z.BUFFER_RESET,this.onBufferReset,this),i.off(z.BUFFER_CREATED,this.onBufferCreated,this),i.off(z.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(z.BUFFER_FLUSHED,this.onBufferFlushed,this),i.off(z.INIT_PTS_FOUND,this.onInitPtsFound,this),i.off(z.FRAG_LOADING,this.onFragLoading,this),i.off(z.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(i,{frag:r,id:o,initPTS:d,timescale:p}){if(o===Vt.MAIN){const g=r.cc,y=this.fragCurrent;if(this.initPTS[g]={baseTime:d,timescale:p},this.log(`InitPTS for cc: ${g} found from main: ${d}/${p}`),this.mainAnchor=r,this.state===ot.WAITING_INIT_PTS){const v=this.waitingData;(!v&&!this.loadingParts||v&&v.frag.cc!==g)&&(this.nextLoadPosition=this.findSyncFrag(r).start),this.tick()}else!this.hls.hasEnoughToStart&&y&&y.cc!==g?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(r).start,y.abortRequests(),this.resetLoadingState()):this.state===ot.IDLE&&this.tick()}}findSyncFrag(i){const r=this.getLevelDetails(),o=i.cc;return Dee(r,o,i)||r&&p5(r.fragments,o)||i}startLoad(i,r){if(!this.levels){this.startPosition=i,this.state=ot.STOPPED;return}const o=this.lastCurrentTime;this.stopLoad(),this.setInterval(O4),o>0&&i===-1?(this.log(`Override startPosition with lastCurrentTime @${o.toFixed(3)}`),i=o,this.state=ot.IDLE):this.state=ot.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=i+this.timelineOffset,this.startPosition=r?-1:i,this.tick()}doTick(){switch(this.state){case ot.IDLE:this.doTickIdle();break;case ot.WAITING_TRACK:{const{levels:r,trackId:o}=this,d=r==null?void 0:r[o],p=d==null?void 0:d.details;if(p&&!this.waitForLive(d)){if(this.waitForCdnTuneIn(p))break;this.state=ot.WAITING_INIT_PTS}break}case ot.FRAG_LOADING_WAITING_RETRY:{var i;const r=performance.now(),o=this.retryDate;if(!o||r>=o||(i=this.media)!=null&&i.seeking){const{levels:d,trackId:p}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((d==null?void 0:d[p])||null),this.state=ot.IDLE}break}case ot.WAITING_INIT_PTS:{const r=this.waitingData;if(r){const{frag:o,part:d,cache:p,complete:g}=r,y=this.mainAnchor;if(this.initPTS[o.cc]!==void 0){this.waitingData=null,this.state=ot.FRAG_LOADING;const v=p.flush().buffer,T={frag:o,part:d,payload:v,networkDetails:null};this._handleFragmentLoadProgress(T),g&&super._handleFragmentLoadComplete(T)}else y&&y.cc!==r.frag.cc&&(this.log(`Waiting fragment cc (${o.cc}) cancelled because video is at cc ${y.cc}`),this.nextLoadPosition=this.findSyncFrag(y).start,this.clearWaitingFragment())}else this.state=ot.IDLE}}this.onTickEnd()}clearWaitingFragment(){const i=this.waitingData;i&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(i.frag),this.waitingData=null,this.state!==ot.STOPPED&&(this.state=ot.IDLE))}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:i}=this;i!=null&&i.readyState&&(this.lastCurrentTime=i.currentTime)}doTickIdle(){var i;const{hls:r,levels:o,media:d,trackId:p}=this,g=r.config;if(!this.buffering||!d&&!this.primaryPrefetch&&(this.startFragRequested||!g.startFragPrefetch)||!(o!=null&&o[p]))return;const y=o[p],v=y.details;if(!v||this.waitForLive(y)||this.waitForCdnTuneIn(v)){this.state=ot.WAITING_TRACK,this.startFragRequested=!1;return}const T=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&T&&(this.bufferFlushed=!1,this.afterBufferFlushed(T,ki.AUDIO,Vt.AUDIO));const C=this.getFwdBufferInfo(T,Vt.AUDIO);if(C===null)return;if(!this.switchingTrack&&this._streamEnded(C,v)){r.trigger(z.BUFFER_EOS,{type:"audio"}),this.state=ot.ENDED;return}const I=C.len,L=r.maxBufferLength,N=v.fragments,x=N[0].start,K=this.getLoadPosition(),H=this.flushing?K:C.end;if(this.switchingTrack&&d){const ee=K;v.PTSKnown&&ee<x&&(C.end>x||C.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),d.currentTime=x+.05)}if(I>=L&&!this.switchingTrack&&H<N[N.length-1].start)return;let Q=this.getNextFragment(H,v);if(Q&&this.isLoopLoading(Q,H)&&(Q=this.getNextFragmentLoopLoading(Q,v,C,Vt.MAIN,L)),!Q){this.bufferFlushed=!0;return}let ne=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(!this.audioOnly&&this.startFragRequested&&ne&&Ar(Q)&&!Q.endList&&(!v.live||!this.loadingParts&&H<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(ne)===cr.OK&&(this.mainFragLoading=ne=null),ne&&Ar(ne))){if(Q.start>ne.end){const pe=this.fragmentTracker.getFragAtPos(H,Vt.MAIN);pe&&pe.end>ne.end&&(ne=pe,this.mainFragLoading={frag:pe,targetBufferTime:null})}if(Q.start>ne.end)return}this.loadFragment(Q,y,H)}onMediaDetaching(i,r){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(i,r)}onAudioTracksUpdated(i,{audioTracks:r}){this.resetTransmuxer(),this.levels=r.map(o=>new lT(o))}onAudioTrackSwitching(i,r){const o=!!r.url;this.trackId=r.id;const{fragCurrent:d}=this;d&&(d.abortRequests(),this.removeUnbufferedFrags(d.start)),this.resetLoadingState(),o?(this.switchingTrack=r,this.flushAudioIfNeeded(r),this.state!==ot.STOPPED&&(this.setInterval(O4),this.state=ot.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=r,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(i,r){this.mainDetails=r.details;const o=this.cachedTrackLoadedData;o&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(z.AUDIO_TRACK_LOADED,o))}onAudioTrackLoaded(i,r){var o;const{levels:d}=this,{details:p,id:g,groupId:y,track:v}=r;if(!d){this.warn(`Audio tracks reset while loading track ${g} "${v.name}" of "${y}"`);return}const T=this.mainDetails;if(!T||p.endCC>T.endCC||T.expired){this.cachedTrackLoadedData=r,this.state!==ot.STOPPED&&(this.state=ot.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${g} "${v.name}" of "${y}" loaded [${p.startSN},${p.endSN}]${p.lastPartSn?`[part-${p.lastPartSn}-${p.lastPartIndex}]`:""},duration:${p.totalduration}`);const C=d[g];let I=0;if(p.live||(o=C.details)!=null&&o.live){if(this.checkLiveUpdate(p),p.deltaUpdateFailed)return;if(C.details){var L;I=this.alignPlaylists(p,C.details,(L=this.levelLastLoaded)==null?void 0:L.details)}p.alignedSliding||(w5(p,T),p.alignedSliding||fC(p,T),I=p.fragmentStart)}C.details=p,this.levelLastLoaded=C,this.startFragRequested||this.setStartPosition(T,I),this.hls.trigger(z.AUDIO_TRACK_UPDATED,{details:p,id:g,groupId:r.groupId}),this.state===ot.WAITING_TRACK&&!this.waitForCdnTuneIn(p)&&(this.state=ot.IDLE),this.tick()}_handleFragmentLoadProgress(i){var r;const o=i.frag,{part:d,payload:p}=i,{config:g,trackId:y,levels:v}=this;if(!v){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${o.sn} of level ${o.level} will not be buffered`);return}const T=v[y];if(!T){this.warn("Audio track is undefined on fragment load progress");return}const C=T.details;if(!C){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(o.start);return}const I=g.defaultAudioCodec||T.audioCodec||"mp4a.40.2";let L=this.transmuxer;L||(L=this.transmuxer=new z5(this.hls,Vt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const N=this.initPTS[o.cc],x=(r=o.initSegment)==null?void 0:r.data;if(N!==void 0){const H=d?d.index:-1,Q=H!==-1,ne=new bL(o.level,o.sn,o.stats.chunkCount,p.byteLength,H,Q);L.push(p,x,I,"",o,d,C.totalduration,!1,ne,N)}else{this.log(`Unknown video PTS for cc ${o.cc}, waiting for video PTS before demuxing audio frag ${o.sn} of [${C.startSN} ,${C.endSN}],track ${y}`);const{cache:K}=this.waitingData=this.waitingData||{frag:o,part:d,cache:new O5,complete:!1};K.push(new Uint8Array(p)),this.state!==ot.STOPPED&&(this.state=ot.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(i){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(i)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(i,r){this.bufferFlushed=this.flushing=!1;const o=r.tracks.audio;o&&(this.mediaBuffer=o.buffer||null)}onFragLoading(i,r){!this.audioOnly&&r.frag.type===Vt.MAIN&&Ar(r.frag)&&(this.mainFragLoading=r,this.state===ot.IDLE&&this.tick())}onFragBuffered(i,r){const{frag:o,part:d}=r;if(o.type!==Vt.AUDIO){!this.audioOnly&&o.type===Vt.MAIN&&!o.elementaryStreams.video&&!o.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(o)){this.warn(`Fragment ${o.sn}${d?" p: "+d.index:""} of level ${o.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ar(o)){this.fragPrevious=o;const p=this.switchingTrack;p&&(this.bufferedTrack=p,this.switchingTrack=null,this.hls.trigger(z.AUDIO_TRACK_SWITCHED,Ii({},p)))}this.fragBufferedComplete(o,d),this.media&&this.tick()}onError(i,r){var o;if(r.fatal){this.state=ot.ERROR;return}switch(r.details){case Ue.FRAG_GAP:case Ue.FRAG_PARSING_ERROR:case Ue.FRAG_DECRYPT_ERROR:case Ue.FRAG_LOAD_ERROR:case Ue.FRAG_LOAD_TIMEOUT:case Ue.KEY_LOAD_ERROR:case Ue.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Vt.AUDIO,r);break;case Ue.AUDIO_TRACK_LOAD_ERROR:case Ue.AUDIO_TRACK_LOAD_TIMEOUT:case Ue.LEVEL_PARSING_ERROR:!r.levelRetry&&this.state===ot.WAITING_TRACK&&((o=r.context)==null?void 0:o.type)===Vn.AUDIO_TRACK&&(this.state=ot.IDLE);break;case Ue.BUFFER_ADD_CODEC_ERROR:case Ue.BUFFER_APPEND_ERROR:if(r.parent!=="audio")return;this.resetLoadingState();break;case Ue.BUFFER_FULL_ERROR:if(r.parent!=="audio")return;this.reduceLengthAndFlushBuffer(r)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Ue.INTERNAL_EXCEPTION:this.recoverWorkerError(r);break}}onBufferFlushing(i,{type:r}){r!==ki.VIDEO&&(this.flushing=!0)}onBufferFlushed(i,{type:r}){if(r!==ki.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ot.ENDED&&(this.state=ot.IDLE);const o=this.mediaBuffer||this.media;o&&(this.afterBufferFlushed(o,r,Vt.AUDIO),this.tick())}}_handleTransmuxComplete(i){var r;const o="audio",{hls:d}=this,{remuxResult:p,chunkMeta:g}=i,y=this.getCurrentContext(g);if(!y){this.resetWhenMissingContext(g);return}const{frag:v,part:T,level:C}=y,{details:I}=C,{audio:L,text:N,id3:x,initSegment:K}=p;if(this.fragContextChanged(v)||!I){this.fragmentTracker.removeFragment(v);return}if(this.state=ot.PARSING,this.switchingTrack&&L&&this.completeAudioSwitch(this.switchingTrack),K!=null&&K.tracks){const H=v.initSegment||v;this._bufferInitSegment(C,K.tracks,H,g),d.trigger(z.FRAG_PARSING_INIT_SEGMENT,{frag:H,id:o,tracks:K.tracks})}if(L){const{startPTS:H,endPTS:Q,startDTS:ne,endDTS:ee}=L;T&&(T.elementaryStreams[ki.AUDIO]={startPTS:H,endPTS:Q,startDTS:ne,endDTS:ee}),v.setElementaryStreamInfo(ki.AUDIO,H,Q,ne,ee),this.bufferFragmentData(L,v,T,g)}if(x!=null&&(r=x.samples)!=null&&r.length){const H=Mi({id:o,frag:v,details:I},x);d.trigger(z.FRAG_PARSING_METADATA,H)}if(N){const H=Mi({id:o,frag:v,details:I},N);d.trigger(z.FRAG_PARSING_USERDATA,H)}}_bufferInitSegment(i,r,o,d){if(this.state!==ot.PARSING||(r.video&&delete r.video,r.audiovideo&&delete r.audiovideo,!r.audio))return;const p=r.audio;p.id=Vt.AUDIO;const g=i.audioCodec;this.log(`Init audio buffer, container:${p.container}, codecs[level/parsed]=[${g}/${p.codec}]`),g&&g.split(",").length===1&&(p.levelCodec=g),this.hls.trigger(z.BUFFER_CODECS,r);const y=p.initSegment;if(y!=null&&y.byteLength){const v={type:"audio",frag:o,part:null,chunkMeta:d,parent:o.type,data:y};this.hls.trigger(z.BUFFER_APPENDING,v)}this.tickImmediate()}loadFragment(i,r,o){const d=this.fragmentTracker.getState(i);if(this.switchingTrack||d===cr.NOT_LOADED||d===cr.PARTIAL){var p;if(!Ar(i))this._loadInitSegment(i,r);else if((p=r.details)!=null&&p.live&&!this.initPTS[i.cc]){this.log(`Waiting for video PTS in continuity counter ${i.cc} of live stream before loading audio fragment ${i.sn} of level ${this.trackId}`),this.state=ot.WAITING_INIT_PTS;const g=this.mainDetails;g&&g.fragmentStart!==r.details.fragmentStart&&fC(r.details,g)}else super.loadFragment(i,r,o)}else this.clearTrackerIfNeeded(i)}flushAudioIfNeeded(i){if(this.media&&this.bufferedTrack){const{name:r,lang:o,assocLang:d,characteristics:p,audioCodec:g,channels:y}=this.bufferedTrack;Nm({name:r,lang:o,assocLang:d,characteristics:p,audioCodec:g,channels:y},i,wm)||(lC(i.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=i)}}completeAudioSwitch(i){const{hls:r}=this;this.flushAudioIfNeeded(i),this.bufferedTrack=i,this.switchingTrack=null,r.trigger(z.AUDIO_TRACK_SWITCHED,Ii({},i))}}class PL extends Ou{constructor(i,r){super(r,i.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=i}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(i,r,o){const d=r==null?void 0:r.renditionReports;if(d){let p=-1;for(let g=0;g<d.length;g++){const y=d[g];let v;try{v=new self.URL(y.URI,r.url).href}catch(T){this.warn(`Could not construct new URL for Rendition Report: ${T}`),v=y.URI||""}if(v===i){p=g;break}else v===i.substring(0,v.length)&&(p=g)}if(p!==-1){const g=d[p],y=parseInt(g["LAST-MSN"])||(r==null?void 0:r.lastPartSn);let v=parseInt(g["LAST-PART"])||(r==null?void 0:r.lastPartIndex);if(this.hls.config.lowLatencyMode){const C=Math.min(r.age-r.partTarget,r.targetduration);v>=0&&C>r.partTarget&&(v+=1)}const T=o&&Y3(o);return new q3(y,v>=0?v:void 0,T)}}}loadPlaylist(i){this.clearTimer()}loadingPlaylist(i,r){this.clearTimer()}shouldLoadPlaylist(i){return this.canLoad&&!!i&&!!i.url&&(!i.details||i.details.live)}getUrlWithDirectives(i,r){if(r)try{return r.addDirectives(i)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}return i}playlistLoaded(i,r,o){const{details:d,stats:p}=r,g=self.performance.now(),y=p.loading.first?Math.max(0,g-p.loading.first):0;d.advancedDateTime=Date.now()-y;const v=this.hls.config.timelineOffset;if(v!==d.appliedTimelineOffset){const C=Math.max(v||0,0);d.appliedTimelineOffset=C,d.fragments.forEach(I=>{I.start=I.playlistOffset+C})}if(d.live||o!=null&&o.live){const C="levelInfo"in r?r.levelInfo:r.track;if(d.reloaded(o),o&&d.fragments.length>0){ate(o,d);const ne=d.playlistParsingError;if(ne){this.warn(ne);const ee=this.hls;if(!ee.config.ignorePlaylistParsingErrors){var T;const{networkDetails:pe}=r;ee.trigger(z.ERROR,{type:Gt.NETWORK_ERROR,details:Ue.LEVEL_PARSING_ERROR,fatal:!1,url:d.url,error:ne,reason:ne.message,level:r.level||void 0,parent:(T=d.fragments[0])==null?void 0:T.type,networkDetails:pe,stats:p});return}d.playlistParsingError=null}}d.requestScheduled===-1&&(d.requestScheduled=p.loading.start);const I=this.hls.mainForwardBufferInfo,L=I?I.end-I.len:0,N=(d.edge-L)*1e3,x=b5(d,N);if(d.requestScheduled+x<g?d.requestScheduled=g:d.requestScheduled+=x,this.log(`live playlist ${i} ${d.advanced?"REFRESHED "+d.lastPartSn+"-"+d.lastPartIndex:d.updated?"UPDATED":"MISSED"}`),!this.canLoad||!d.live)return;let K,H,Q;if(d.canBlockReload&&d.endSN&&d.advanced){const ne=this.hls.config.lowLatencyMode,ee=d.lastPartSn,pe=d.endSN,de=d.lastPartIndex,be=de!==-1,Se=ee===pe;be?Se?(H=pe+1,Q=ne?0:de):(H=ee,Q=ne?de+1:d.maxPartIndex):H=pe+1;const Te=d.age,_e=Te+d.ageHeader;let he=Math.min(_e-d.partTarget,d.targetduration*1.5);if(he>0){if(_e>d.targetduration*3)this.log(`Playlist last advanced ${Te.toFixed(2)}s ago. Omitting segment and part directives.`),H=void 0,Q=void 0;else if(o!=null&&o.tuneInGoal&&_e-d.partTarget>o.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${o.tuneInGoal} to: ${he} with playlist age: ${d.age}`),he=0;else{const Ge=Math.floor(he/d.targetduration);if(H+=Ge,Q!==void 0){const st=Math.round(he%d.targetduration/d.partTarget);Q+=st}this.log(`CDN Tune-in age: ${d.ageHeader}s last advanced ${Te.toFixed(2)}s goal: ${he} skip sn ${Ge} to part ${Q}`)}d.tuneInGoal=he}if(K=this.getDeliveryDirectives(d,r.deliveryDirectives,H,Q),ne||!Se){d.requestScheduled=g,this.loadingPlaylist(C,K);return}}else(d.canBlockReload||d.canSkipUntil)&&(K=this.getDeliveryDirectives(d,r.deliveryDirectives,H,Q));K&&H!==void 0&&d.canBlockReload&&(d.requestScheduled=p.loading.first+Math.max(x-y*2,x/2)),this.scheduleLoading(C,K,d)}else this.clearTimer()}scheduleLoading(i,r,o){const d=o||i.details;if(!d){this.loadingPlaylist(i,r);return}const p=self.performance.now(),g=d.requestScheduled;if(p>=g){this.loadingPlaylist(i,r);return}const y=g-p;this.log(`reload live playlist ${i.name||i.bitrate+"bps"} in ${Math.round(y)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(i,r),y)}getDeliveryDirectives(i,r,o,d){let p=Y3(i);return r!=null&&r.skip&&i.deltaUpdateFailed&&(o=r.msn,d=r.part,p=$A.No),new q3(o,d,p)}checkRetry(i){const r=i.details,o=dC(i),d=i.errorAction,{action:p,retryCount:g=0,retryConfig:y}=d||{},v=!!d&&!!y&&(p===Zr.RetryRequest||!d.resolved&&p===Zr.SendAlternateToPenaltyBox);if(v){var T;if(g>=y.maxNumRetry)return!1;if(o&&(T=i.context)!=null&&T.deliveryDirectives)this.warn(`Retrying playlist loading ${g+1}/${y.maxNumRetry} after "${r}" without delivery-directives`),this.loadPlaylist();else{const C=TL(y,g);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),C),this.warn(`Retrying playlist loading ${g+1}/${y.maxNumRetry} after "${r}" in ${C}ms`)}i.levelRetry=!0,d.resolved=!0}return v}}function X5(h,i){if(h.length!==i.length)return!1;for(let r=0;r<h.length;r++)if(!mT(h[r].attrs,i[r].attrs))return!1;return!0}function mT(h,i,r){const o=h["STABLE-RENDITION-ID"];return o&&!r?o===i["STABLE-RENDITION-ID"]:!(r||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(d=>h[d]!==i[d])}function qN(h,i){return i.label.toLowerCase()===h.name.toLowerCase()&&(!i.language||i.language.toLowerCase()===(h.lang||"").toLowerCase())}class mne extends PL{constructor(i){super(i,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:i}=this;i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.MANIFEST_PARSED,this.onManifestParsed,this),i.on(z.LEVEL_LOADING,this.onLevelLoading,this),i.on(z.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(z.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(z.ERROR,this.onError,this)}unregisterListeners(){const{hls:i}=this;i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.MANIFEST_PARSED,this.onManifestParsed,this),i.off(z.LEVEL_LOADING,this.onLevelLoading,this),i.off(z.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(z.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(z.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(i,r){this.tracks=r.audioTracks||[]}onAudioTrackLoaded(i,r){const{id:o,groupId:d,details:p}=r,g=this.tracksInGroup[o];if(!g||g.groupId!==d){this.warn(`Audio track with id:${o} and group:${d} not found in active group ${g==null?void 0:g.groupId}`);return}const y=g.details;g.details=r.details,this.log(`Audio track ${o} "${g.name}" lang:${g.lang} group:${d} loaded [${p.startSN}-${p.endSN}]`),o===this.trackId&&this.playlistLoaded(o,r,y)}onLevelLoading(i,r){this.switchLevel(r.level)}onLevelSwitching(i,r){this.switchLevel(r.level)}switchLevel(i){const r=this.hls.levels[i];if(!r)return;const o=r.audioGroups||null,d=this.groupIds;let p=this.currentTrack;if(!o||(d==null?void 0:d.length)!==(o==null?void 0:o.length)||o!=null&&o.some(y=>(d==null?void 0:d.indexOf(y))===-1)){this.groupIds=o,this.trackId=-1,this.currentTrack=null;const y=this.tracks.filter(L=>!o||o.indexOf(L.groupId)!==-1);if(y.length)this.selectDefaultTrack&&!y.some(L=>L.default)&&(this.selectDefaultTrack=!1),y.forEach((L,N)=>{L.id=N});else if(!p&&!this.tracksInGroup.length)return;this.tracksInGroup=y;const v=this.hls.config.audioPreference;if(!p&&v){const L=gd(v,y,wm);if(L>-1)p=y[L];else{const N=gd(v,this.tracks);p=this.tracks[N]}}let T=this.findTrackId(p);T===-1&&p&&(T=this.findTrackId(null));const C={audioTracks:y};this.log(`Updating audio tracks, ${y.length} track(s) found in group(s): ${o==null?void 0:o.join(",")}`),this.hls.trigger(z.AUDIO_TRACKS_UPDATED,C);const I=this.trackId;if(T!==-1&&I===-1)this.setAudioTrack(T);else if(y.length&&I===-1){var g;const L=new Error(`No audio track selected for current audio group-ID(s): ${(g=this.groupIds)==null?void 0:g.join(",")} track count: ${y.length}`);this.warn(L.message),this.hls.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:L})}}}onError(i,r){r.fatal||!r.context||r.context.type===Vn.AUDIO_TRACK&&r.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(r.context.groupId)!==-1)&&this.checkRetry(r)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}setAudioOption(i){const r=this.hls;if(r.config.audioPreference=i,i){const o=this.allAudioTracks;if(this.selectDefaultTrack=!1,o.length){const d=this.currentTrack;if(d&&Nm(i,d,wm))return d;const p=gd(i,this.tracksInGroup,wm);if(p>-1){const g=this.tracksInGroup[p];return this.setAudioTrack(p),g}else if(d){let g=r.loadLevel;g===-1&&(g=r.firstAutoLevel);const y=Aee(i,r.levels,o,g,wm);if(y===-1)return null;r.nextLoadLevel=y}if(i.channels||i.audioCodec){const g=gd(i,o);if(g>-1)return o[g]}}}return null}setAudioTrack(i){const r=this.tracksInGroup;if(i<0||i>=r.length){this.warn(`Invalid audio track id: ${i}`);return}this.selectDefaultTrack=!1;const o=this.currentTrack,d=r[i],p=d.details&&!d.details.live;if(i===this.trackId&&d===o&&p||(this.log(`Switching to audio-track ${i} "${d.name}" lang:${d.lang} group:${d.groupId} channels:${d.channels}`),this.trackId=i,this.currentTrack=d,this.hls.trigger(z.AUDIO_TRACK_SWITCHING,Ii({},d)),p))return;const g=this.switchParams(d.url,o==null?void 0:o.details,d.details);this.loadPlaylist(g)}findTrackId(i){const r=this.tracksInGroup;for(let o=0;o<r.length;o++){const d=r[o];if(!(this.selectDefaultTrack&&!d.default)&&(!i||Nm(i,d,wm)))return o}if(i){const{name:o,lang:d,assocLang:p,characteristics:g,audioCodec:y,channels:v}=i;for(let T=0;T<r.length;T++){const C=r[T];if(Nm({name:o,lang:d,assocLang:p,characteristics:g,audioCodec:y,channels:v},C,wm))return T}for(let T=0;T<r.length;T++){const C=r[T];if(mT(i.attrs,C.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return T}for(let T=0;T<r.length;T++){const C=r[T];if(mT(i.attrs,C.attrs,["LANGUAGE"]))return T}}return-1}loadPlaylist(i){super.loadPlaylist();const r=this.currentTrack;this.shouldLoadPlaylist(r)&&lC(r.url,this.hls)&&this.scheduleLoading(r,i)}loadingPlaylist(i,r){super.loadingPlaylist(i,r);const o=i.id,d=i.groupId,p=this.getUrlWithDirectives(i.url,r),g=i.details,y=g==null?void 0:g.age;this.log(`Loading audio-track ${o} "${i.name}" lang:${i.lang} group:${d}${(r==null?void 0:r.msn)!==void 0?" at sn "+r.msn+" part "+r.part:""}${y&&g.live?" age "+y.toFixed(1)+(g.type&&" "+g.type||""):""} ${p}`),this.hls.trigger(z.AUDIO_TRACK_LOADING,{url:p,id:o,groupId:d,deliveryDirectives:r||null,track:i})}}class gne{constructor(i){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=i}destroy(){this.tracks=this.queues=null}append(i,r,o){if(this.queues===null||this.tracks===null)return;const d=this.queues[r];d.push(i),d.length===1&&!o&&this.executeNext(r)}appendBlocker(i){return new Promise(r=>{const o={label:"async-blocker",execute:r,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(o,i)})}prependBlocker(i){return new Promise(r=>{if(this.queues){const o={label:"async-blocker-prepend",execute:r,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[i].unshift(o)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(i=>{var r;const o=(r=i[0])==null?void 0:r.label;(o==="async-blocker"||o==="async-blocker-prepend")&&(i[0].execute(),i.splice(0,1))})}unblockAudio(i){if(this.queues===null)return;this.queues.audio[0]===i&&this.shiftAndExecuteNext("audio")}executeNext(i){if(this.queues===null||this.tracks===null)return;const r=this.queues[i];if(r.length){const d=r[0];try{d.execute()}catch(p){var o;if(d.onError(p),this.queues===null||this.tracks===null)return;const g=(o=this.tracks[i])==null?void 0:o.buffer;g!=null&&g.updating||this.shiftAndExecuteNext(i)}}}shiftAndExecuteNext(i){this.queues!==null&&(this.queues[i].shift(),this.executeNext(i))}current(i){var r;return((r=this.queues)==null?void 0:r[i][0])||null}toString(){const{queues:i,tracks:r}=this;return i===null||r===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(i){var r,o;return(r=this.queues)!=null&&r[i]||(o=this.tracks)!=null&&o[i]?`${i}: (${this.listSbInfo(i)}) ${this.listOps(i)}`:""}listSbInfo(i){var r;const o=(r=this.tracks)==null?void 0:r[i],d=o==null?void 0:o.buffer;return d?`SourceBuffer${d.updating?" updating":""}${o.ended?" ended":""}${o.ending?" ending":""}`:"none"}listOps(i){var r;return((r=this.queues)==null?void 0:r[i].map(o=>o.label).join(", "))||""}}const D4=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,J5="HlsJsTrackRemovedError";class Ene extends Error{constructor(i){super(i),this.name=J5}}class _ne extends Ou{constructor(i,r){super("buffer-controller",i.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=o=>{var d;this.hls&&((d=this.mediaSource)==null?void 0:d.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=o=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=o=>{const{media:d,mediaSource:p}=this;o&&this.log("Media source opened"),!(!d||!p)&&(p.removeEventListener("sourceopen",this._onMediaSourceOpen),d.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(z.MEDIA_ATTACHED,{media:d,mediaSource:p}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:o,_objectUrl:d}=this;o!==d&&this.error(`Media element src was set while attaching MediaSource (${d} > ${o})`)},this.hls=i,this.fragmentTracker=r,this.appendSource=GZ(uf(i.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:i}=this;i.on(z.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.MANIFEST_PARSED,this.onManifestParsed,this),i.on(z.BUFFER_RESET,this.onBufferReset,this),i.on(z.BUFFER_APPENDING,this.onBufferAppending,this),i.on(z.BUFFER_CODECS,this.onBufferCodecs,this),i.on(z.BUFFER_EOS,this.onBufferEos,this),i.on(z.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(z.LEVEL_UPDATED,this.onLevelUpdated,this),i.on(z.FRAG_PARSED,this.onFragParsed,this),i.on(z.FRAG_CHANGED,this.onFragChanged,this),i.on(z.ERROR,this.onError,this)}unregisterListeners(){const{hls:i}=this;i.off(z.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.MANIFEST_PARSED,this.onManifestParsed,this),i.off(z.BUFFER_RESET,this.onBufferReset,this),i.off(z.BUFFER_APPENDING,this.onBufferAppending,this),i.off(z.BUFFER_CODECS,this.onBufferCodecs,this),i.off(z.BUFFER_EOS,this.onBufferEos,this),i.off(z.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(z.LEVEL_UPDATED,this.onLevelUpdated,this),i.off(z.FRAG_PARSED,this.onFragParsed,this),i.off(z.FRAG_CHANGED,this.onFragChanged,this),i.off(z.ERROR,this.onError,this)}transferMedia(){const{media:i,mediaSource:r}=this;if(!i)return null;const o={};if(this.operationQueue){const p=this.isUpdating();p||this.operationQueue.removeBlockers();const g=this.isQueued();(p||g)&&this.warn(`Transfering MediaSource with${g?" operations in queue":""}${p?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const d=this.transferData;return!this.sourceBufferCount&&d&&d.mediaSource===r?Mi(o,d.tracks):this.sourceBuffers.forEach(p=>{const[g]=p;g&&(o[g]=Mi({},this.tracks[g]),this.removeBuffer(g)),p[0]=p[1]=null}),{media:i,mediaSource:r,tracks:o}}initTracks(){const i={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=i,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(i,r){var o;let d=2;(r.audio&&!r.video||!r.altAudio)&&(d=1),this.bufferCodecEventsTotal=d,this.log(`${d} bufferCodec event(s) expected.`),(o=this.transferData)!=null&&o.mediaSource&&this.sourceBufferCount&&d&&this.bufferCreated()}onMediaAttaching(i,r){const o=this.media=r.media,d=uf(this.appendSource);if(this.transferData=this.overrides=void 0,o&&d){const p=!!r.mediaSource;(p||r.overrides)&&(this.transferData=r,this.overrides=r.overrides);const g=this.mediaSource=r.mediaSource||new d;if(this.assignMediaSource(g),p)this._objectUrl=o.src,this.attachTransferred();else{const y=this._objectUrl=self.URL.createObjectURL(g);if(this.appendSource)try{o.removeAttribute("src");const v=self.ManagedMediaSource;o.disableRemotePlayback=o.disableRemotePlayback||v&&g instanceof v,N4(o),Sne(o,y),o.load()}catch{o.src=y}else o.src=y}o.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(i){var r,o;this.log(`${((r=this.transferData)==null?void 0:r.mediaSource)===i?"transferred":"created"} media source: ${(o=i.constructor)==null?void 0:o.name}`),i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.addEventListener("startstreaming",this._onStartStreaming),i.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const i=this.media,r=this.transferData;if(!r||!i)return;const o=this.tracks,d=r.tracks,p=d?Object.keys(d):null,g=p?p.length:0,y=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(d&&p&&g){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${ds(o,(v,T)=>v==="initSegment"?void 0:T)};
transfer tracks: ${ds(d,(v,T)=>v==="initSegment"?void 0:T)}}`),!JG(d,o)){r.mediaSource=null,r.tracks=void 0;const v=i.currentTime,T=this.details,C=Math.max(v,(T==null?void 0:T.fragments[0].start)||0);if(C-v>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${v} -> ${C}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(d)}"->"${Object.keys(o)}") start time: ${C} currentTime: ${v}`),this.onMediaDetaching(z.MEDIA_DETACHING,{}),this.onMediaAttaching(z.MEDIA_ATTACHING,r),i.currentTime=C;return}this.transferData=void 0,p.forEach(v=>{const T=v,C=d[T];if(C){const I=C.buffer;if(I){const L=this.fragmentTracker,N=C.id;if(L.hasFragments(N)||L.hasParts(N)){const H=Dn.getBuffered(I);L.detectEvictedFragments(T,H,N,null,!0)}const x=gN(T),K=[T,I];this.sourceBuffers[x]=K,I.updating&&this.operationQueue&&this.operationQueue.prependBlocker(T),this.trackSourceBuffer(T,C)}}}),y(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),y()}get mediaSourceOpenOrEnded(){var i;const r=(i=this.mediaSource)==null?void 0:i.readyState;return r==="open"||r==="ended"}onMediaDetaching(i,r){const o=!!r.transferMedia;this.transferData=this.overrides=void 0;const{media:d,mediaSource:p,_objectUrl:g}=this;if(p){if(this.log(`media source ${o?"transferring":"detaching"}`),o)this.sourceBuffers.forEach(([y])=>{y&&this.removeBuffer(y)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const y=p.readyState==="open";try{const v=p.sourceBuffers;for(let T=v.length;T--;)y&&v[T].abort(),p.removeSourceBuffer(v[T]);y&&p.endOfStream()}catch(v){this.warn(`onMediaDetaching: ${v.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}p.removeEventListener("sourceopen",this._onMediaSourceOpen),p.removeEventListener("sourceended",this._onMediaSourceEnded),p.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(p.removeEventListener("startstreaming",this._onStartStreaming),p.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}d&&(d.removeEventListener("emptied",this._onMediaEmptied),o||(g&&self.URL.revokeObjectURL(g),this.mediaSrc===g?(d.removeAttribute("src"),this.appendSource&&N4(d),d.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(z.MEDIA_DETACHED,r)}onBufferReset(){this.sourceBuffers.forEach(([i])=>{i&&this.resetBuffer(i)}),this.initTracks()}resetBuffer(i){var r;const o=(r=this.tracks[i])==null?void 0:r.buffer;if(this.removeBuffer(i),o)try{var d;(d=this.mediaSource)!=null&&d.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(o)}catch(p){this.warn(`onBufferReset ${i}`,p)}delete this.tracks[i]}removeBuffer(i){this.removeBufferListeners(i),this.sourceBuffers[gN(i)]=[null,null];const r=this.tracks[i];r&&(r.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new gne(this.tracks)}onBufferCodecs(i,r){const o=this.tracks,d=Object.keys(r);this.log(`BUFFER_CODECS: "${d}" (current SB count ${this.sourceBufferCount})`);const p="audiovideo"in r&&(o.audio||o.video)||o.audiovideo&&("audio"in r||"video"in r),g=!p&&this.sourceBufferCount&&this.media&&d.some(y=>!o[y]);if(p||g){this.warn(`Unsupported transition between "${Object.keys(o)}" and "${d}" SourceBuffers`);return}d.forEach(y=>{var v,T,C;const I=r[y],{id:L,codec:N,levelCodec:x,container:K,metadata:H,supplemental:Q}=I;let ne=o[y];const ee=(v=this.transferData)==null||(T=v.tracks)==null?void 0:T[y],pe=ee!=null&&ee.buffer?ee:ne,de=(pe==null?void 0:pe.pendingCodec)||(pe==null?void 0:pe.codec),be=pe==null?void 0:pe.levelCodec;ne||(ne=o[y]={buffer:void 0,listeners:[],codec:N,supplemental:Q,container:K,levelCodec:x,metadata:H,id:L});const Se=qA(de,be),Te=Se==null?void 0:Se.replace(D4,"$1");let _e=qA(N,x);const he=(C=_e)==null?void 0:C.replace(D4,"$1");_e&&Se&&Te!==he&&(y.slice(0,5)==="audio"&&(_e=oC(_e,this.appendSource)),this.log(`switching codec ${de} to ${_e}`),_e!==(ne.pendingCodec||ne.codec)&&(ne.pendingCodec=_e),ne.container=K,this.appendChangeType(y,K,_e))}),(this.tracksReady||this.sourceBufferCount)&&(r.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((i,r)=>{const o=this.tracks[r];return i[r]={id:o.id,container:o.container,codec:o.codec,levelCodec:o.levelCodec},i},{})}appendChangeType(i,r,o){const d=`${r};codecs=${o}`,p={label:`change-type=${d}`,execute:()=>{const g=this.tracks[i];if(g){const y=g.buffer;y!=null&&y.changeType&&(this.log(`changing ${i} sourceBuffer type to ${d}`),y.changeType(d),g.codec=o,g.container=r)}this.shiftAndExecuteNext(i)},onStart:()=>{},onComplete:()=>{},onError:g=>{this.warn(`Failed to change ${i} SourceBuffer type`,g)}};this.append(p,i,this.isPending(this.tracks[i]))}blockAudio(i){var r;const o=i.start,d=o+i.duration*.05;if(((r=this.fragmentTracker.getAppendedFrag(o,Vt.MAIN))==null?void 0:r.gap)===!0)return;const g={label:"block-audio",execute:()=>{var y;const v=this.tracks.video;(this.lastVideoAppendEnd>d||v!=null&&v.buffer&&Dn.isBuffered(v.buffer,d)||((y=this.fragmentTracker.getAppendedFrag(d,Vt.MAIN))==null?void 0:y.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:y=>{this.warn("Error executing block-audio operation",y)}};this.blockedAudioAppend={op:g,frag:i},this.append(g,"audio",!0)}unblockAudio(){const{blockedAudioAppend:i,operationQueue:r}=this;i&&r&&(this.blockedAudioAppend=null,r.unblockAudio(i.op))}onBufferAppending(i,r){const{tracks:o}=this,{data:d,type:p,parent:g,frag:y,part:v,chunkMeta:T}=r,C=T.buffering[p],I=y.sn,L=self.performance.now();C.start=L;const N=y.stats.buffering,x=v?v.stats.buffering:null;N.start===0&&(N.start=L),x&&x.start===0&&(x.start=L);const K=o.audio;let H=!1;p==="audio"&&(K==null?void 0:K.container)==="audio/mpeg"&&(H=!this.lastMpegAudioChunk||T.id===1||this.lastMpegAudioChunk.sn!==T.sn,this.lastMpegAudioChunk=T);const Q=this.tracks.video,ne=Q==null?void 0:Q.buffer;if(ne&&I!=="initSegment"){const de=v||y,be=this.blockedAudioAppend;if(p==="audio"&&g!=="main"&&!this.blockedAudioAppend){const Te=de.start+de.duration*.05,_e=ne.buffered,he=this.currentOp("video");!_e.length&&!he?this.blockAudio(de):!he&&!Dn.isBuffered(ne,Te)&&this.lastVideoAppendEnd<Te&&this.blockAudio(de)}else if(p==="video"){const Se=de.end;if(be){const Te=be.frag.start;(Se>Te||Se<this.lastVideoAppendEnd||Dn.isBuffered(ne,Te))&&this.unblockAudio()}this.lastVideoAppendEnd=Se}}const ee=(v||y).start,pe={label:`append-${p}`,execute:()=>{if(C.executeStart=self.performance.now(),H){const de=this.tracks[p];if(de){const be=de.buffer;if(be){const Se=ee-be.timestampOffset;Math.abs(Se)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${ee} (delta: ${Se}) sn: ${I})`),be.timestampOffset=ee)}}}this.appendExecutor(d,p)},onStart:()=>{},onComplete:()=>{const de=self.performance.now();C.executeEnd=C.end=de,N.first===0&&(N.first=de),x&&x.first===0&&(x.first=de);const be={};this.sourceBuffers.forEach(([Se,Te])=>{Se&&(be[Se]=Dn.getBuffered(Te))}),this.appendErrors[p]=0,p==="audio"||p==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(z.BUFFER_APPENDED,{type:p,frag:y,part:v,chunkMeta:T,parent:y.type,timeRanges:be})},onError:de=>{var be;const Se={type:Gt.MEDIA_ERROR,parent:y.type,details:Ue.BUFFER_APPEND_ERROR,sourceBufferName:p,frag:y,part:v,chunkMeta:T,error:de,err:de,fatal:!1},Te=(be=this.media)==null?void 0:be.error;if(de.code===DOMException.QUOTA_EXCEEDED_ERR)Se.details=Ue.BUFFER_FULL_ERROR;else if(de.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!Te)Se.errorAction=dT(!0);else if(de.name===J5&&this.sourceBufferCount===0)Se.errorAction=dT(!0);else{const _e=++this.appendErrors[p];this.warn(`Failed ${_e}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${p}" sourceBuffer (${Te||"no media error"})`),(_e>=this.hls.config.appendErrorMaxRetry||Te)&&(Se.fatal=!0)}this.hls.trigger(z.ERROR,Se)}};this.append(pe,p,this.isPending(this.tracks[p]))}getFlushOp(i,r,o){return this.log(`queuing "${i}" remove ${r}-${o}`),{label:"remove",execute:()=>{this.removeExecutor(i,r,o)},onStart:()=>{},onComplete:()=>{this.hls.trigger(z.BUFFER_FLUSHED,{type:i})},onError:d=>{this.warn(`Failed to remove ${r}-${o} from "${i}" SourceBuffer`,d)}}}onBufferFlushing(i,r){const{type:o,startOffset:d,endOffset:p}=r;o?this.append(this.getFlushOp(o,d,p),o):this.sourceBuffers.forEach(([g])=>{g&&this.append(this.getFlushOp(g,d,p),g)})}onFragParsed(i,r){const{frag:o,part:d}=r,p=[],g=d?d.elementaryStreams:o.elementaryStreams;g[ki.AUDIOVIDEO]?p.push("audiovideo"):(g[ki.AUDIO]&&p.push("audio"),g[ki.VIDEO]&&p.push("video"));const y=()=>{const v=self.performance.now();o.stats.buffering.end=v,d&&(d.stats.buffering.end=v);const T=d?d.stats:o.stats;this.hls.trigger(z.FRAG_BUFFERED,{frag:o,part:d,stats:T,id:o.type})};p.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${o.type} level: ${o.level} sn: ${o.sn}`),this.blockBuffers(y,p).catch(v=>{this.warn(`Fragment buffered callback ${v}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(i,r){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([i])=>{var r,o;return i&&(!((r=this.tracks[i])!=null&&r.ended)||((o=this.tracks[i])==null?void 0:o.ending))})}onBufferEos(i,r){var o;this.sourceBuffers.forEach(([g])=>{if(g){const y=this.tracks[g];(!r.type||r.type===g)&&(y.ending=!0,y.ended||(y.ended=!0,this.log(`${g} buffer reached EOS`)))}});const d=((o=this.overrides)==null?void 0:o.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([g])=>{var y;return g&&!((y=this.tracks[g])!=null&&y.ended)})&&(d?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:g}=this;if(!g||g.readyState!=="open"){g&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${g.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),g.endOfStream(),this.hls.trigger(z.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(z.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([i])=>{if(i!==null){const r=this.tracks[i];r&&(r.ending=!1)}})}onLevelUpdated(i,{details:r}){r.fragments.length&&(this.details=r,this.updateDuration())}updateDuration(){const i=this.getDurationAndRange();i&&this.blockUntilOpen(()=>this.updateMediaSource(i))}onError(i,r){if(r.details===Ue.BUFFER_APPEND_ERROR&&r.frag){var o;const d=(o=r.errorAction)==null?void 0:o.nextAutoLevel;xt(d)&&d!==r.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:i,details:r,media:o}=this;if(!o||r===null||!this.sourceBufferCount)return;const d=i.config,p=o.currentTime,g=r.levelTargetDuration,y=r.live&&d.liveBackBufferLength!==null?d.liveBackBufferLength:d.backBufferLength;if(xt(y)&&y>=0){const v=Math.max(y,g),T=Math.floor(p/g)*g-v;this.flushBackBuffer(p,g,T)}if(xt(d.frontBufferFlushThreshold)&&d.frontBufferFlushThreshold>0){const v=Math.max(d.maxBufferLength,d.frontBufferFlushThreshold),T=Math.max(v,g),C=Math.floor(p/g)*g+T;this.flushFrontBuffer(p,g,C)}}flushBackBuffer(i,r,o){this.sourceBuffers.forEach(([d,p])=>{if(p){const y=Dn.getBuffered(p);if(y.length>0&&o>y.start(0)){var g;this.hls.trigger(z.BACK_BUFFER_REACHED,{bufferEnd:o});const v=this.tracks[d];if((g=this.details)!=null&&g.live)this.hls.trigger(z.LIVE_BACK_BUFFER_REACHED,{bufferEnd:o});else if(v!=null&&v.ended){this.log(`Cannot flush ${d} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(z.BUFFER_FLUSHING,{startOffset:0,endOffset:o,type:d})}}})}flushFrontBuffer(i,r,o){this.sourceBuffers.forEach(([d,p])=>{if(p){const g=Dn.getBuffered(p),y=g.length;if(y<2)return;const v=g.start(y-1),T=g.end(y-1);if(o>v||i>=v&&i<=T)return;this.hls.trigger(z.BUFFER_FLUSHING,{startOffset:v,endOffset:1/0,type:d})}})}getDurationAndRange(){var i;const{details:r,mediaSource:o}=this;if(!r||!this.media||(o==null?void 0:o.readyState)!=="open")return null;const d=r.edge;if(r.live&&this.hls.config.liveDurationInfinity){if(r.fragments.length&&r.live&&o.setLiveSeekableRange){const T=Math.max(0,r.fragmentStart),C=Math.max(T,d);return{duration:1/0,start:T,end:C}}return{duration:1/0}}const p=(i=this.overrides)==null?void 0:i.duration;if(p)return xt(p)?{duration:p}:null;const g=this.media.duration,y=xt(o.duration)?o.duration:0;return d>y&&d>g||!xt(g)?{duration:d}:null}updateMediaSource({duration:i,start:r,end:o}){const d=this.mediaSource;!this.media||!d||d.readyState!=="open"||(d.duration!==i&&(xt(i)&&this.log(`Updating MediaSource duration to ${i.toFixed(3)}`),d.duration=i),r!==void 0&&o!==void 0&&(this.log(`MediaSource duration is set to ${d.duration}. Setting seekable range to ${r}-${o}.`),d.setLiveSeekableRange(r,o)))}get tracksReady(){const i=this.pendingTrackCount;return i>0&&(i>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:i,pendingTrackCount:r,tracks:o}=this;if(this.log(`checkPendingTracks (pending: ${r} codec events expected: ${i}) ${ds(o)}`),this.tracksReady){var d;const p=(d=this.transferData)==null?void 0:d.tracks;p&&Object.keys(p).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const i={};this.sourceBuffers.forEach(([r,o])=>{if(r){const d=this.tracks[r];i[r]={buffer:o,container:d.container,codec:d.codec,supplemental:d.supplemental,levelCodec:d.levelCodec,id:d.id,metadata:d.metadata}}}),this.hls.trigger(z.BUFFER_CREATED,{tracks:i}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([r])=>{this.executeNext(r)})}else{const i=new Error("could not create source buffer for media codec(s)");this.hls.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:i,reason:i.message})}}createSourceBuffers(){const{tracks:i,sourceBuffers:r,mediaSource:o}=this;if(!o)throw new Error("createSourceBuffers called when mediaSource was null");for(const p in i){const g=p,y=i[g];if(this.isPending(y)){const v=this.getTrackCodec(y,g),T=`${y.container};codecs=${v}`;y.codec=v,this.log(`creating sourceBuffer(${T})${this.currentOp(g)?" Queued":""} ${ds(y)}`);try{const C=o.addSourceBuffer(T),I=gN(g),L=[g,C];r[I]=L,y.buffer=C}catch(C){var d;this.error(`error while trying to add sourceBuffer: ${C.message}`),this.shiftAndExecuteNext(g),(d=this.operationQueue)==null||d.removeBlockers(),delete this.tracks[g],this.hls.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:C,sourceBufferName:g,mimeType:T,parent:y.id});return}this.trackSourceBuffer(g,y)}}this.bufferCreated()}getTrackCodec(i,r){const o=i.supplemental;let d=i.codec;o&&(r==="video"||r==="audiovideo")&&BN(o,"video")&&(d=uee(d,o));const p=qA(d,i.levelCodec);return p?r.slice(0,5)==="audio"?oC(p,this.appendSource):p:""}trackSourceBuffer(i,r){const o=r.buffer;if(!o)return;const d=this.getTrackCodec(r,i);this.tracks[i]={buffer:o,codec:d,container:r.container,levelCodec:r.levelCodec,supplemental:r.supplemental,metadata:r.metadata,id:r.id,listeners:[]},this.removeBufferListeners(i),this.addBufferListener(i,"updatestart",this.onSBUpdateStart),this.addBufferListener(i,"updateend",this.onSBUpdateEnd),this.addBufferListener(i,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(i,"bufferedchange",(p,g)=>{const y=g.removedRanges;y!=null&&y.length&&this.hls.trigger(z.BUFFER_FLUSHED,{type:p})})}get mediaSrc(){var i,r;const o=((i=this.media)==null||(r=i.querySelector)==null?void 0:r.call(i,"source"))||this.media;return o==null?void 0:o.src}onSBUpdateStart(i){const r=this.currentOp(i);r&&r.onStart()}onSBUpdateEnd(i){var r;if(((r=this.mediaSource)==null?void 0:r.readyState)==="closed"){this.resetBuffer(i);return}const o=this.currentOp(i);o&&(o.onComplete(),this.shiftAndExecuteNext(i))}onSBUpdateError(i,r){var o;const d=new Error(`${i} SourceBuffer error. MediaSource readyState: ${(o=this.mediaSource)==null?void 0:o.readyState}`);this.error(`${d}`,r),this.hls.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.BUFFER_APPENDING_ERROR,sourceBufferName:i,error:d,fatal:!1});const p=this.currentOp(i);p&&p.onError(d)}removeExecutor(i,r,o){const{media:d,mediaSource:p}=this,g=this.tracks[i],y=g==null?void 0:g.buffer;if(!d||!p||!y){this.warn(`Attempting to remove from the ${i} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(i);return}const v=xt(d.duration)?d.duration:1/0,T=xt(p.duration)?p.duration:1/0,C=Math.max(0,r),I=Math.min(o,v,T);I>C&&(!g.ending||g.ended)?(g.ended=!1,this.log(`Removing [${C},${I}] from the ${i} SourceBuffer`),y.remove(C,I)):this.shiftAndExecuteNext(i)}appendExecutor(i,r){const o=this.tracks[r],d=o==null?void 0:o.buffer;if(!d)throw new Ene(`Attempting to append to the ${r} SourceBuffer, but it does not exist`);o.ending=!1,o.ended=!1,d.appendBuffer(i)}blockUntilOpen(i){if(this.isUpdating()||this.isQueued())this.blockBuffers(i).catch(r=>{this.warn(`SourceBuffer blocked callback ${r}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{i()}catch(r){this.warn(`Callback run without blocking ${this.operationQueue} ${r}`)}}isUpdating(){return this.sourceBuffers.some(([i,r])=>i&&r.updating)}isQueued(){return this.sourceBuffers.some(([i])=>i&&!!this.currentOp(i))}isPending(i){return!!i&&!i.buffer}blockBuffers(i,r=this.sourceBufferTypes){if(!r.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(i);const{operationQueue:o}=this,d=r.map(g=>this.appendBlocker(g));return r.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(d).then(g=>{o===this.operationQueue&&(i(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(i){i.forEach(r=>{var o;const d=(o=this.tracks[r])==null?void 0:o.buffer;!d||d.updating||this.shiftAndExecuteNext(r)})}append(i,r,o){this.operationQueue&&this.operationQueue.append(i,r,o)}appendBlocker(i){if(this.operationQueue)return this.operationQueue.appendBlocker(i)}currentOp(i){return this.operationQueue?this.operationQueue.current(i):null}executeNext(i){i&&this.operationQueue&&this.operationQueue.executeNext(i)}shiftAndExecuteNext(i){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(i)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((i,r)=>i+(this.isPending(this.tracks[r])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((i,[r])=>i+(r?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([i])=>i).filter(i=>!!i)}addBufferListener(i,r,o){const d=this.tracks[i];if(!d)return;const p=d.buffer;if(!p)return;const g=o.bind(this,i);d.listeners.push({event:r,listener:g}),p.addEventListener(r,g)}removeBufferListeners(i){const r=this.tracks[i];if(!r)return;const o=r.buffer;o&&(r.listeners.forEach(d=>{o.removeEventListener(d.event,d.listener)}),r.listeners.length=0)}}function N4(h){const i=h.querySelectorAll("source");[].slice.call(i).forEach(r=>{h.removeChild(r)})}function Sne(h,i){const r=self.document.createElement("source");r.type="video/mp4",r.src=i,h.appendChild(r)}function gN(h){return h==="audio"?1:0}class kL{constructor(i){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=i,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(i){this.streamController=i}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:i}=this;i.on(z.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.on(z.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(z.MANIFEST_PARSED,this.onManifestParsed,this),i.on(z.LEVELS_UPDATED,this.onLevelsUpdated,this),i.on(z.BUFFER_CODECS,this.onBufferCodecs,this),i.on(z.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:i}=this;i.off(z.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.off(z.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(z.MANIFEST_PARSED,this.onManifestParsed,this),i.off(z.LEVELS_UPDATED,this.onLevelsUpdated,this),i.off(z.BUFFER_CODECS,this.onBufferCodecs,this),i.off(z.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(i,r){const o=this.hls.levels[r.droppedLevel];this.isLevelAllowed(o)&&this.restrictedLevels.push({bitrate:o.bitrate,height:o.height,width:o.width})}onMediaAttaching(i,r){this.media=r.media instanceof HTMLVideoElement?r.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(i,r){const o=this.hls;this.restrictedLevels=[],this.firstLevel=r.firstLevel,o.config.capLevelToPlayerSize&&r.video&&this.startCapping()}onLevelsUpdated(i,r){this.timer&&xt(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(i,r){this.hls.config.capLevelToPlayerSize&&r.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const i=this.hls.levels;if(i.length){const r=this.hls,o=this.getMaxLevel(i.length-1);o!==this.autoLevelCapping&&r.logger.log(`Setting autoLevelCapping to ${o}: ${i[o].height}p@${i[o].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),r.autoLevelCapping=o,r.autoLevelEnabled&&r.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=r.autoLevelCapping}}}getMaxLevel(i){const r=this.hls.levels;if(!r.length)return-1;const o=r.filter((d,p)=>this.isLevelAllowed(d)&&p<=i);return this.clientRect=null,kL.getMaxLevelByMediaSize(o,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const i=this.media,r={width:0,height:0};if(i){const o=i.getBoundingClientRect();r.width=o.width,r.height=o.height,!r.width&&!r.height&&(r.width=o.right-o.left||i.width||0,r.height=o.bottom-o.top||i.height||0)}return this.clientRect=r,r}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let i=1;if(!this.hls.config.ignoreDevicePixelRatio)try{i=self.devicePixelRatio}catch{}return Math.min(i,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(i){return!this.restrictedLevels.some(o=>i.bitrate===o.bitrate&&i.width===o.width&&i.height===o.height)}static getMaxLevelByMediaSize(i,r,o){if(!(i!=null&&i.length))return-1;const d=(y,v)=>v?y.width!==v.width||y.height!==v.height:!0;let p=i.length-1;const g=Math.max(r,o);for(let y=0;y<i.length;y+=1){const v=i[y];if((v.width>=g||v.height>=g)&&d(v,i[y+1])){p=y;break}}return p}}const yne={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ha=yne,Tne={HLS:"h"},vne=Tne,bne="CMCD-Object",Rne="CMCD-Request",Ane="CMCD-Session",Cne="CMCD-Status",tT={OBJECT:bne,REQUEST:Rne,SESSION:Ane,STATUS:Cne},Ine={[tT.OBJECT]:["br","d","ot","tb"],[tT.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[tT.SESSION]:["cid","pr","sf","sid","st","v"],[tT.STATUS]:["bs","rtp"]};class L_{constructor(i,r){Array.isArray(i)&&(i=i.map(o=>o instanceof L_?o:new L_(o))),this.value=i,this.params=r}}const wne="Dict";function One(h){return Array.isArray(h)?JSON.stringify(h):h instanceof Map?"Map{}":h instanceof Set?"Set{}":typeof h=="object"?JSON.stringify(h):String(h)}function Dne(h,i,r,o){return new Error(`failed to ${h} "${One(i)}" as ${r}`,{cause:o})}function yd(h,i,r){return Dne("serialize",h,i,r)}class Q5{constructor(i){this.description=i}}const L4="Bare Item",Nne="Boolean";function Lne(h){if(typeof h!="boolean")throw yd(h,Nne);return h?"?1":"?0"}const xne="Byte Sequence";function Pne(h){if(ArrayBuffer.isView(h)===!1)throw yd(h,xne);return`:${Ote(h)}:`}const kne="Integer";function Mne(h){return h<-999999999999999||999999999999999<h}function Z5(h){if(Mne(h))throw yd(h,kne);return h.toString()}function Une(h){return`@${Z5(h.getTime()/1e3)}`}const Fne="Decimal";function Bne(h){const i=M5(h,3);if(Math.floor(Math.abs(i)).toString().length>12)throw yd(h,Fne);const r=i.toString();return r.includes(".")?r:`${r}.0`}const Vne="String",jne=/[\x00-\x1f\x7f]+/;function Gne(h){if(jne.test(h))throw yd(h,Vne);return`"${h.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function Hne(h){return h.description||h.toString().slice(7,-1)}const Kne="Token";function x4(h){const i=Hne(h);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(i)===!1)throw yd(i,Kne);return i}function $N(h){switch(typeof h){case"number":if(!xt(h))throw yd(h,L4);return Number.isInteger(h)?Z5(h):Bne(h);case"string":return Gne(h);case"symbol":return x4(h);case"boolean":return Lne(h);case"object":if(h instanceof Date)return Une(h);if(h instanceof Uint8Array)return Pne(h);if(h instanceof Q5)return x4(h);default:throw yd(h,L4)}}const Wne="Key";function zN(h){if(/^[a-z*][a-z0-9\-_.*]*$/.test(h)===!1)throw yd(h,Wne);return h}function ML(h){return h==null?"":Object.entries(h).map(([i,r])=>r===!0?`;${zN(i)}`:`;${zN(i)}=${$N(r)}`).join("")}function e6(h){return h instanceof L_?`${$N(h.value)}${ML(h.params)}`:$N(h)}function Yne(h){return`(${h.value.map(e6).join(" ")})${ML(h.params)}`}function qne(h,i={whitespace:!0}){if(typeof h!="object")throw yd(h,wne);const r=h instanceof Map?h.entries():Object.entries(h),o=i!=null&&i.whitespace?" ":"";return Array.from(r).map(([d,p])=>{p instanceof L_||(p=new L_(p));let g=zN(d);return p.value===!0?g+=ML(p.params):(g+="=",Array.isArray(p.value)?g+=Yne(p):g+=e6(p)),g}).join(`,${o}`)}function $ne(h,i){return qne(h,i)}function zne(h){return h==="ot"||h==="sf"||h==="st"}function Xne(h){return typeof h=="number"?xt(h):h!=null&&h!==""&&h!==!1}const JA=h=>Math.round(h),Jne=(h,i)=>(i!=null&&i.baseUrl&&(h=Dte(h,i.baseUrl)),encodeURIComponent(h)),PA=h=>JA(h/100)*100,Qne={br:JA,d:JA,bl:PA,dl:PA,mtp:PA,nor:Jne,rtp:PA,tb:JA};function Zne(h,i){const r={};if(h==null||typeof h!="object")return r;const o=Object.keys(h).sort(),d=Mi({},Qne,i==null?void 0:i.formatters),p=i==null?void 0:i.filter;return o.forEach(g=>{if(p!=null&&p(g))return;let y=h[g];const v=d[g];v&&(y=v(y,i)),!(g==="v"&&y===1)&&(g=="pr"&&y===1||Xne(y)&&(zne(g)&&typeof y=="string"&&(y=new Q5(y)),r[g]=y))}),r}function t6(h,i={}){return h?$ne(Zne(h,i),Mi({whitespace:!1},i)):""}function eie(h,i={}){const r={};if(!h)return r;const o=Object.entries(h),d=Object.entries(Ine).concat(Object.entries((i==null?void 0:i.customHeaderMap)||{})),p=o.reduce((g,y)=>{var v,T;const[C,I]=y,L=((v=d.find(N=>N[1].includes(C)))===null||v===void 0?void 0:v[0])||tT.REQUEST;return(T=g[L])!==null&&T!==void 0||(g[L]={}),g[L][C]=I,g},{});return Object.entries(p).reduce((g,[y,v])=>(g[y]=t6(v,i),g),r)}function tie(h,i,r){return Mi(h,eie(i,r))}const nie="CMCD";function iie(h,i={}){if(!h)return"";const r=t6(h,i);return`${nie}=${encodeURIComponent(r)}`}const P4=/CMCD=[^&#]+/;function sie(h,i,r){const o=iie(i,r);if(!o)return h;if(P4.test(h))return h.replace(P4,o);const d=h.includes("?")?"&":"?";return`${h}${d}${o}`}class rie{constructor(i){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=d=>{try{this.apply(d,{ot:Ha.MANIFEST,su:!this.initialized})}catch(p){this.hls.logger.warn("Could not generate manifest CMCD data.",p)}},this.applyFragmentData=d=>{try{const{frag:p,part:g}=d,y=this.hls.levels[p.level],v=this.getObjectType(p),T={d:(g||p).duration*1e3,ot:v};(v===Ha.VIDEO||v===Ha.AUDIO||v==Ha.MUXED)&&(T.br=y.bitrate/1e3,T.tb=this.getTopBandwidth(v)/1e3,T.bl=this.getBufferLength(v));const C=g?this.getNextPart(g):this.getNextFrag(p);C!=null&&C.url&&C.url!==p.url&&(T.nor=C.url),this.apply(d,T)}catch(p){this.hls.logger.warn("Could not generate segment CMCD data.",p)}},this.hls=i;const r=this.config=i.config,{cmcd:o}=r;o!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=o.sessionId||i.sessionId,this.cid=o.contentId,this.useHeaders=o.useHeaders===!0,this.includeKeys=o.includeKeys,this.registerListeners())}registerListeners(){const i=this.hls;i.on(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(z.MEDIA_DETACHED,this.onMediaDetached,this),i.on(z.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const i=this.hls;i.off(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(z.MEDIA_DETACHED,this.onMediaDetached,this),i.off(z.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(i,r){this.media=r.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(i,r){var o,d;this.audioBuffer=(o=r.tracks.audio)==null?void 0:o.buffer,this.videoBuffer=(d=r.tracks.video)==null?void 0:d.buffer}createData(){var i;return{v:1,sf:vne.HLS,sid:this.sid,cid:this.cid,pr:(i=this.media)==null?void 0:i.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(i,r={}){Mi(r,this.createData());const o=r.ot===Ha.INIT||r.ot===Ha.VIDEO||r.ot===Ha.MUXED;this.starved&&o&&(r.bs=!0,r.su=!0,this.starved=!1),r.su==null&&(r.su=this.buffering);const{includeKeys:d}=this;d&&(r=Object.keys(r).reduce((g,y)=>(d.includes(y)&&(g[y]=r[y]),g),{}));const p={baseUrl:i.url};this.useHeaders?(i.headers||(i.headers={}),tie(i.headers,r,p)):i.url=sie(i.url,r,p)}getNextFrag(i){var r;const o=(r=this.hls.levels[i.level])==null?void 0:r.details;if(o){const d=i.sn-o.startSN;return o.fragments[d+1]}}getNextPart(i){var r,o;const{index:d,fragment:p}=i,g=(r=this.hls.levels[p.level])==null||(o=r.details)==null?void 0:o.partList;if(g){const{sn:y}=p;for(let v=g.length-1;v>=0;v--){const T=g[v];if(T.index===d&&T.fragment.sn===y)return g[v+1]}}}getObjectType(i){const{type:r}=i;if(r==="subtitle")return Ha.TIMED_TEXT;if(i.sn==="initSegment")return Ha.INIT;if(r==="audio")return Ha.AUDIO;if(r==="main")return this.hls.audioTracks.length?Ha.VIDEO:Ha.MUXED}getTopBandwidth(i){let r=0,o;const d=this.hls;if(i===Ha.AUDIO)o=d.audioTracks;else{const p=d.maxAutoLevel,g=p>-1?p+1:d.levels.length;o=d.levels.slice(0,g)}for(const p of o)p.bitrate>r&&(r=p.bitrate);return r>0?r:NaN}getBufferLength(i){const r=this.media,o=i===Ha.AUDIO?this.audioBuffer:this.videoBuffer;return!o||!r?NaN:Dn.bufferInfo(o,r.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:i}=this.config,r=this.applyPlaylistData,o=i||this.config.loader;return class{constructor(p){this.loader=void 0,this.loader=new o(p)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(p,g,y){r(p),this.loader.load(p,g,y)}}}createFragmentLoader(){const{fLoader:i}=this.config,r=this.applyFragmentData,o=i||this.config.loader;return class{constructor(p){this.loader=void 0,this.loader=new o(p)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(p,g,y){r(p),this.loader.load(p,g,y)}}}}const aie=3e5;class oie extends Ou{constructor(i){super("content-steering",i.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=i,this.registerListeners()}registerListeners(){const i=this.hls;i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(z.MANIFEST_PARSED,this.onManifestParsed,this),i.on(z.ERROR,this.onError,this)}unregisterListeners(){const i=this.hls;i&&(i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(z.MANIFEST_PARSED,this.onManifestParsed,this),i.off(z.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((i,r)=>(i.indexOf(r.pathwayId)===-1&&i.push(r.pathwayId),i),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(i){this.updatePathwayPriority(i)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const i=this.timeToLoad*1e3-(performance.now()-this.updated);if(i>0){this.scheduleRefresh(this.uri,i);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(i){const r=this.levels;r&&(this.levels=r.filter(o=>o!==i))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(i,r){const{contentSteering:o}=r;o!==null&&(this.pathwayId=o.pathwayId,this.uri=o.uri,this.started&&this.startLoad())}onManifestParsed(i,r){this.audioTracks=r.audioTracks,this.subtitleTracks=r.subtitleTracks}onError(i,r){const{errorAction:o}=r;if((o==null?void 0:o.action)===Zr.SendAlternateToPenaltyBox&&o.flags===rl.MoveAllAlternatesMatchingHost){const d=this.levels;let p=this._pathwayPriority,g=this.pathwayId;if(r.context){const{groupId:y,pathwayId:v,type:T}=r.context;y&&d?g=this.getPathwayForGroupId(y,T,g):v&&(g=v)}g in this.penalizedPathways||(this.penalizedPathways[g]=performance.now()),!p&&d&&(p=this.pathways()),p&&p.length>1&&(this.updatePathwayPriority(p),o.resolved=this.pathwayId!==g),o.resolved||this.warn(`Could not resolve ${r.details} ("${r.error.message}") with content-steering for Pathway: ${g} levels: ${d&&d.length} priorities: ${ds(p)} penalized: ${ds(this.penalizedPathways)}`)}}filterParsedLevels(i){this.levels=i;let r=this.getLevelsForPathway(this.pathwayId);if(r.length===0){const o=i[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${o}"`),r=this.getLevelsForPathway(o),this.pathwayId=o}return r.length!==i.length&&this.log(`Found ${r.length}/${i.length} levels in Pathway "${this.pathwayId}"`),r}getLevelsForPathway(i){return this.levels===null?[]:this.levels.filter(r=>i===r.pathwayId)}updatePathwayPriority(i){this._pathwayPriority=i;let r;const o=this.penalizedPathways,d=performance.now();Object.keys(o).forEach(p=>{d-o[p]>aie&&delete o[p]});for(let p=0;p<i.length;p++){const g=i[p];if(g in o)continue;if(g===this.pathwayId)return;const y=this.hls.nextLoadLevel,v=this.hls.levels[y];if(r=this.getLevelsForPathway(g),r.length>0){this.log(`Setting Pathway to "${g}"`),this.pathwayId=g,C5(r),this.hls.trigger(z.LEVELS_UPDATED,{levels:r});const T=this.hls.levels[y];v&&T&&this.levels&&(T.attrs["STABLE-VARIANT-ID"]!==v.attrs["STABLE-VARIANT-ID"]&&T.bitrate!==v.bitrate&&this.log(`Unstable Pathways change from bitrate ${v.bitrate} to ${T.bitrate}`),this.hls.nextLoadLevel=y);break}}}getPathwayForGroupId(i,r,o){const d=this.getLevelsForPathway(o).concat(this.levels||[]);for(let p=0;p<d.length;p++)if(r===Vn.AUDIO_TRACK&&d[p].hasAudioGroup(i)||r===Vn.SUBTITLE_TRACK&&d[p].hasSubtitleGroup(i))return d[p].pathwayId;return o}clonePathways(i){const r=this.levels;if(!r)return;const o={},d={};i.forEach(p=>{const{ID:g,"BASE-ID":y,"URI-REPLACEMENT":v}=p;if(r.some(C=>C.pathwayId===g))return;const T=this.getLevelsForPathway(y).map(C=>{const I=new Ss(C.attrs);I["PATHWAY-ID"]=g;const L=I.AUDIO&&`${I.AUDIO}_clone_${g}`,N=I.SUBTITLES&&`${I.SUBTITLES}_clone_${g}`;L&&(o[I.AUDIO]=L,I.AUDIO=L),N&&(d[I.SUBTITLES]=N,I.SUBTITLES=N);const x=n6(C.uri,I["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",v),K=new lT({attrs:I,audioCodec:C.audioCodec,bitrate:C.bitrate,height:C.height,name:C.name,url:x,videoCodec:C.videoCodec,width:C.width});if(C.audioGroups)for(let H=1;H<C.audioGroups.length;H++)K.addGroupId("audio",`${C.audioGroups[H]}_clone_${g}`);if(C.subtitleGroups)for(let H=1;H<C.subtitleGroups.length;H++)K.addGroupId("text",`${C.subtitleGroups[H]}_clone_${g}`);return K});r.push(...T),k4(this.audioTracks,o,v,g),k4(this.subtitleTracks,d,v,g)})}loadSteeringManifest(i){const r=this.hls.config,o=r.loader;this.loader&&this.loader.destroy(),this.loader=new o(r);let d;try{d=new self.URL(i)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${i}`);return}if(d.protocol!=="data:"){const C=(this.hls.bandwidthEstimate||r.abrEwmaDefaultEstimate)|0;d.searchParams.set("_HLS_pathway",this.pathwayId),d.searchParams.set("_HLS_throughput",""+C)}const p={responseType:"json",url:d.href},g=r.steeringManifestLoadPolicy.default,y=g.errorRetry||g.timeoutRetry||{},v={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:y.maxNumRetry||0,retryDelay:y.retryDelayMs||0,maxRetryDelay:y.maxRetryDelayMs||0},T={onSuccess:(C,I,L,N)=>{this.log(`Loaded steering manifest: "${d}"`);const x=C.data;if((x==null?void 0:x.VERSION)!==1){this.log(`Steering VERSION ${x.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=x.TTL;const{"RELOAD-URI":K,"PATHWAY-CLONES":H,"PATHWAY-PRIORITY":Q}=x;if(K)try{this.uri=new self.URL(K,d).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${K}`);return}this.scheduleRefresh(this.uri||L.url),H&&this.clonePathways(H);const ne={steeringManifest:x,url:d.toString()};this.hls.trigger(z.STEERING_MANIFEST_LOADED,ne),Q&&this.updatePathwayPriority(Q)},onError:(C,I,L,N)=>{if(this.log(`Error loading steering manifest: ${C.code} ${C.text} (${I.url})`),this.stopLoad(),C.code===410){this.enabled=!1,this.log(`Steering manifest ${I.url} no longer available`);return}let x=this.timeToLoad*1e3;if(C.code===429){const K=this.loader;if(typeof(K==null?void 0:K.getResponseHeader)=="function"){const H=K.getResponseHeader("Retry-After");H&&(x=parseFloat(H)*1e3)}this.log(`Steering manifest ${I.url} rate limited`);return}this.scheduleRefresh(this.uri||I.url,x)},onTimeout:(C,I,L)=>{this.log(`Timeout loading steering manifest (${I.url})`),this.scheduleRefresh(this.uri||I.url)}};this.log(`Requesting steering manifest: ${d}`),this.loader.load(p,v,T)}scheduleRefresh(i,r=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var o;const d=(o=this.hls)==null?void 0:o.media;if(d&&!d.ended){this.loadSteeringManifest(i);return}this.scheduleRefresh(i,this.timeToLoad*1e3)},r)}}function k4(h,i,r,o){h&&Object.keys(i).forEach(d=>{const p=h.filter(g=>g.groupId===d).map(g=>{const y=Mi({},g);return y.details=void 0,y.attrs=new Ss(y.attrs),y.url=y.attrs.URI=n6(g.url,g.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),y.groupId=y.attrs["GROUP-ID"]=i[d],y.attrs["PATHWAY-ID"]=o,y});h.push(...p)})}function n6(h,i,r,o){const{HOST:d,PARAMS:p,[r]:g}=o;let y;i&&(y=g==null?void 0:g[i],y&&(h=y));const v=new self.URL(h);return d&&!y&&(v.host=d),p&&Object.keys(p).sort().forEach(T=>{T&&v.searchParams.set(T,p[T])}),v.href}class I_ extends Ou{constructor(i){super("eme",i.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=I_.CDMCleanupPromise?[I_.CDMCleanupPromise]:[],this.onMediaEncrypted=r=>{const{initDataType:o,initData:d}=r,p=`"${r.type}" event: init data type: "${o}"`;if(this.debug(p),d!==null){if(!this.keyFormatPromise){let g=Object.keys(this.keySystemAccessPromises);g.length||(g=DA(this.config));const y=g.map(cN).filter(v=>!!v);this.keyFormatPromise=this.getKeyFormatPromise(y)}this.keyFormatPromise.then(g=>{const y=aN(g);let v,T;if(o==="sinf"){if(y!==wi.FAIRPLAY){this.warn(`Ignoring unexpected "${r.type}" event with init data type: "${o}" for selected key-system ${y}`);return}const x=or(new Uint8Array(d));try{const K=AL(JSON.parse(x).sinf),H=s5(K);if(!H)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");v=new Uint8Array(H.subarray(8,24)),T=wi.FAIRPLAY}catch(K){this.warn(`${p} Failed to parse sinf: ${K}`);return}}else{if(y!==wi.WIDEVINE&&y!==wi.PLAYREADY){this.warn(`Ignoring unexpected "${r.type}" event with init data type: "${o}" for selected key-system ${y}`);return}const x=oee(d),K=x.filter(Q=>!!Q.systemId&&oN(Q.systemId)===y);K.length>1&&this.warn(`${p} Using first of ${K.length} pssh found for selected key-system ${y}`);const H=K[0];if(!H){x.length===0||x.some(Q=>!Q.systemId)?this.warn(`${p} contains incomplete or invalid pssh data`):this.log(`ignoring ${p} for ${x.map(Q=>oN(Q.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(T=oN(H.systemId),H.version===0&&H.data)if(T===wi.WIDEVINE){const Q=H.data.length-22;v=new Uint8Array(H.data.subarray(Q,Q+16))}else T===wi.PLAYREADY&&(v=S5(H.data))}if(!T||!v)return;const C=fd.hexDump(v),{keyIdToKeySessionPromise:I,mediaKeySessions:L}=this;let N=I[C];for(let x=0;x<L.length;x++){const K=L[x],H=K.decryptdata;if(!H.keyId)continue;const Q=fd.hexDump(H.keyId);if(C===Q||H.uri.replace(/-/g,"").indexOf(C)!==-1){if(N=I[Q],H.pssh)break;delete I[Q],H.pssh=new Uint8Array(d),H.keyId=v,N=I[C]=N.then(()=>this.generateRequestWithPreferredKeySession(K,o,d,"encrypted-event-key-match")),N.catch(ne=>this.handleError(ne));break}}if(!N){if(T!==y){this.log(`Ignoring "${r.type}" event with ${T} init data for selected key-system ${y}`);return}N=I[C]=this.getKeySystemSelectionPromise([T]).then(({keySystem:x,mediaKeys:K})=>{var H;this.throwIfDestroyed();const Q=new uT("ISO-23001-7",C,(H=cN(x))!=null?H:"");return Q.pssh=new Uint8Array(d),Q.keyId=v,this.attemptSetMediaKeys(x,K).then(()=>{this.throwIfDestroyed();const ne=this.createMediaKeySessionContext({decryptdata:Q,keySystem:x,mediaKeys:K});return this.generateRequestWithPreferredKeySession(ne,o,d,"encrypted-event-no-match")})}),N.catch(x=>this.handleError(x))}})}},this.onWaitingForKey=r=>{this.log(`"${r.type}" event`)},this.hls=i,this.config=i.config,this.registerListeners()}destroy(){const i=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(i);const r=this.config;r.requestMediaKeySystemAccessFunc=null,r.licenseXhrSetup=r.licenseResponseCallback=void 0,r.drmSystems=r.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(z.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(z.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(z.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(z.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(z.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(z.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(z.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(z.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(i){const{drmSystems:r,widevineLicenseUrl:o}=this.config,d=r[i];if(d)return d.licenseUrl;if(i===wi.WIDEVINE&&o)return o}getLicenseServerUrlOrThrow(i){const r=this.getLicenseServerUrl(i);if(r===void 0)throw new Error(`no license server URL configured for key-system "${i}"`);return r}getServerCertificateUrl(i){const{drmSystems:r}=this.config,o=r[i];if(o)return o.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${i}"]`)}attemptKeySystemAccess(i){const r=this.hls.levels,o=(g,y,v)=>!!g&&v.indexOf(g)===y,d=r.map(g=>g.audioCodec).filter(o),p=r.map(g=>g.videoCodec).filter(o);return d.length+p.length===0&&p.push("avc1.42e01e"),new Promise((g,y)=>{const v=T=>{const C=T.shift();this.getMediaKeysPromise(C,d,p).then(I=>g({keySystem:C,mediaKeys:I})).catch(I=>{T.length?v(T):I instanceof cc?y(I):y(new cc({type:Gt.KEY_SYSTEM_ERROR,details:Ue.KEY_SYSTEM_NO_ACCESS,error:I,fatal:!0},I.message))})};v(i)})}requestMediaKeySystemAccess(i,r){const{requestMediaKeySystemAccessFunc:o}=this.config;if(typeof o!="function"){let d=`Configured requestMediaKeySystemAccess is not a function ${o}`;return _5===null&&self.location.protocol==="http:"&&(d=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(d))}return o(i,r)}getMediaKeysPromise(i,r,o){const d=Qee(i,r,o,this.config.drmSystemOptions),p=this.keySystemAccessPromises[i];let g=p==null?void 0:p.keySystemAccess;if(!g){this.log(`Requesting encrypted media "${i}" key-system access with config: ${ds(d)}`),g=this.requestMediaKeySystemAccess(i,d);const y=this.keySystemAccessPromises[i]={keySystemAccess:g};return g.catch(v=>{this.log(`Failed to obtain access to key-system "${i}": ${v}`)}),g.then(v=>{this.log(`Access for key-system "${v.keySystem}" obtained`);const T=this.fetchServerCertificate(i);return this.log(`Create media-keys for "${i}"`),y.mediaKeys=v.createMediaKeys().then(C=>(this.log(`Media-keys created for "${i}"`),T.then(I=>I?this.setMediaKeysServerCertificate(C,i,I):C))),y.mediaKeys.catch(C=>{this.error(`Failed to create media-keys for "${i}"}: ${C}`)}),y.mediaKeys})}return g.then(()=>p.mediaKeys)}createMediaKeySessionContext({decryptdata:i,keySystem:r,mediaKeys:o}){this.log(`Creating key-system session "${r}" keyId: ${fd.hexDump(i.keyId||[])}`);const d=o.createSession(),p={decryptdata:i,keySystem:r,mediaKeys:o,mediaKeysSession:d,keyStatus:"status-pending"};return this.mediaKeySessions.push(p),p}renewKeySession(i){const r=i.decryptdata;if(r.pssh){const o=this.createMediaKeySessionContext(i),d=this.getKeyIdString(r),p="cenc";this.keyIdToKeySessionPromise[d]=this.generateRequestWithPreferredKeySession(o,p,r.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(i)}getKeyIdString(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return fd.hexDump(i.keyId)}updateKeySession(i,r){var o;const d=i.mediaKeysSession;return this.log(`Updating key-session "${d.sessionId}" for keyID ${fd.hexDump(((o=i.decryptdata)==null?void 0:o.keyId)||[])}
      } (data length: ${r&&r.byteLength})`),d.update(r)}selectKeySystemFormat(i){const r=Object.keys(i.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${i.sn} ${i.type}: ${i.level}) key formats ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)),this.keyFormatPromise}getKeyFormatPromise(i){return new Promise((r,o)=>{const d=DA(this.config),p=i.map(aN).filter(g=>!!g&&d.indexOf(g)!==-1);return this.getKeySystemSelectionPromise(p).then(({keySystem:g})=>{const y=cN(g);y?r(y):o(new Error(`Unable to find format for key-system "${g}"`))}).catch(o)})}loadKey(i){const r=i.keyInfo.decryptdata,o=this.getKeyIdString(r),d=`(keyId: ${o} format: "${r.keyFormat}" method: ${r.method} uri: ${r.uri})`;this.log(`Starting session for key ${d}`);let p=this.keyIdToKeySessionPromise[o];return p||(p=this.getKeySystemForKeyPromise(r).then(({keySystem:y,mediaKeys:v})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${i.frag.sn} ${i.frag.type}: ${i.frag.level} using key ${d}`),this.attemptSetMediaKeys(y,v).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:y,mediaKeys:v,decryptdata:r}))))),(this.keyIdToKeySessionPromise[o]=p.then(y=>{const v="cenc",T=r.pssh?r.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(y,v,T,"playlist-key")})).catch(y=>this.handleError(y))),p}throwIfDestroyed(i="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(i){this.hls&&(this.error(i.message),i instanceof cc?this.hls.trigger(z.ERROR,i.data):this.hls.trigger(z.ERROR,{type:Gt.KEY_SYSTEM_ERROR,details:Ue.KEY_SYSTEM_NO_KEYS,error:i,fatal:!0}))}getKeySystemForKeyPromise(i){const r=this.getKeyIdString(i),o=this.keyIdToKeySessionPromise[r];if(!o){const d=aN(i.keyFormat),p=d?[d]:DA(this.config);return this.attemptKeySystemAccess(p)}return o}getKeySystemSelectionPromise(i){if(i.length||(i=DA(this.config)),i.length===0)throw new cc({type:Gt.KEY_SYSTEM_ERROR,details:Ue.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${ds({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(i)}attemptSetMediaKeys(i,r){const o=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${i}"`);const d=Promise.all(o).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(r)});return this.setMediaKeysQueue.push(d),d.then(()=>{this.log(`Media-keys set for "${i}"`),o.push(d),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(p=>o.indexOf(p)===-1)})}generateRequestWithPreferredKeySession(i,r,o,d){var p,g;const y=(p=this.config.drmSystems)==null||(g=p[i.keySystem])==null?void 0:g.generateRequest;if(y)try{const x=y.call(this.hls,r,o,i);if(!x)throw new Error("Invalid response from configured generateRequest filter");r=x.initDataType,o=x.initData?x.initData:null,i.decryptdata.pssh=o?new Uint8Array(o):null}catch(x){var v;if(this.warn(x.message),(v=this.hls)!=null&&v.config.debug)throw x}if(o===null)return this.log(`Skipping key-session request for "${d}" (no initData)`),Promise.resolve(i);const T=this.getKeyIdString(i.decryptdata);this.log(`Generating key-session request for "${d}": ${T} (init data type: ${r} length: ${o?o.byteLength:null})`);const C=new IL,I=i._onmessage=x=>{const K=i.mediaKeysSession;if(!K){C.emit("error",new Error("invalid state"));return}const{messageType:H,message:Q}=x;this.log(`"${H}" message event for session "${K.sessionId}" message size: ${Q.byteLength}`),H==="license-request"||H==="license-renewal"?this.renewLicense(i,Q).catch(ne=>{C.eventNames().length?C.emit("error",ne):this.handleError(ne)}):H==="license-release"?i.keySystem===wi.FAIRPLAY&&(this.updateKeySession(i,GN("acknowledged")),this.removeSession(i)):this.warn(`unhandled media key message type "${H}"`)},L=i._onkeystatuseschange=x=>{if(!i.mediaKeysSession){C.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(i);const H=i.keyStatus;C.emit("keyStatus",H),H==="expired"&&(this.warn(`${i.keySystem} expired for key ${T}`),this.renewKeySession(i))};i.mediaKeysSession.addEventListener("message",I),i.mediaKeysSession.addEventListener("keystatuseschange",L);const N=new Promise((x,K)=>{C.on("error",K),C.on("keyStatus",H=>{H.startsWith("usable")?x():H==="output-restricted"?K(new cc({type:Gt.KEY_SYSTEM_ERROR,details:Ue.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):H==="internal-error"?K(new cc({type:Gt.KEY_SYSTEM_ERROR,details:Ue.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${H}"`)):H==="expired"?K(new Error("key expired while generating request")):this.warn(`unhandled key status change "${H}"`)})});return i.mediaKeysSession.generateRequest(r,o).then(()=>{var x;this.log(`Request generated for key-session "${(x=i.mediaKeysSession)==null?void 0:x.sessionId}" keyId: ${T}`)}).catch(x=>{throw new cc({type:Gt.KEY_SYSTEM_ERROR,details:Ue.KEY_SYSTEM_NO_SESSION,error:x,fatal:!1},`Error generating key-session request: ${x}`)}).then(()=>N).catch(x=>{throw C.removeAllListeners(),this.removeSession(i),x}).then(()=>(C.removeAllListeners(),i))}onKeyStatusChange(i){i.mediaKeysSession.keyStatuses.forEach((r,o)=>{if(typeof o=="string"&&typeof r=="object"){const d=o;o=r,r=d}this.log(`key status change "${r}" for keyStatuses keyId: ${fd.hexDump("buffer"in o?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):new Uint8Array(o))} session keyId: ${fd.hexDump(new Uint8Array(i.decryptdata.keyId||[]))} uri: ${i.decryptdata.uri}`),i.keyStatus=r})}fetchServerCertificate(i){const r=this.config,o=r.loader,d=new o(r),p=this.getServerCertificateUrl(i);return p?(this.log(`Fetching server certificate for "${i}"`),new Promise((g,y)=>{const v={responseType:"arraybuffer",url:p},T=r.certLoadPolicy.default,C={loadPolicy:T,timeout:T.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},I={onSuccess:(L,N,x,K)=>{g(L.data)},onError:(L,N,x,K)=>{y(new cc({type:Gt.KEY_SYSTEM_ERROR,details:Ue.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:x,response:Ii({url:v.url,data:void 0},L)},`"${i}" certificate request failed (${p}). Status: ${L.code} (${L.text})`))},onTimeout:(L,N,x)=>{y(new cc({type:Gt.KEY_SYSTEM_ERROR,details:Ue.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:x,response:{url:v.url,data:void 0}},`"${i}" certificate request timed out (${p})`))},onAbort:(L,N,x)=>{y(new Error("aborted"))}};d.load(v,C,I)})):Promise.resolve()}setMediaKeysServerCertificate(i,r,o){return new Promise((d,p)=>{i.setServerCertificate(o).then(g=>{this.log(`setServerCertificate ${g?"success":"not supported by CDM"} (${o==null?void 0:o.byteLength}) on "${r}"`),d(i)}).catch(g=>{p(new cc({type:Gt.KEY_SYSTEM_ERROR,details:Ue.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:g,fatal:!0},g.message))})})}renewLicense(i,r){return this.requestLicense(i,new Uint8Array(r)).then(o=>this.updateKeySession(i,new Uint8Array(o)).catch(d=>{throw new cc({type:Gt.KEY_SYSTEM_ERROR,details:Ue.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:d,fatal:!0},d.message)}))}unpackPlayReadyKeyMessage(i,r){const o=String.fromCharCode.apply(null,new Uint16Array(r.buffer));if(!o.includes("PlayReadyKeyMessage"))return i.setRequestHeader("Content-Type","text/xml; charset=utf-8"),r;const d=new DOMParser().parseFromString(o,"application/xml"),p=d.querySelectorAll("HttpHeader");if(p.length>0){let C;for(let I=0,L=p.length;I<L;I++){var g,y;C=p[I];const N=(g=C.querySelector("name"))==null?void 0:g.textContent,x=(y=C.querySelector("value"))==null?void 0:y.textContent;N&&x&&i.setRequestHeader(N,x)}}const v=d.querySelector("Challenge"),T=v==null?void 0:v.textContent;if(!T)throw new Error("Cannot find <Challenge> in key message");return GN(atob(T))}setupLicenseXHR(i,r,o,d){const p=this.config.licenseXhrSetup;return p?Promise.resolve().then(()=>{if(!o.decryptdata)throw new Error("Key removed");return p.call(this.hls,i,r,o,d)}).catch(g=>{if(!o.decryptdata)throw g;return i.open("POST",r,!0),p.call(this.hls,i,r,o,d)}).then(g=>(i.readyState||i.open("POST",r,!0),{xhr:i,licenseChallenge:g||d})):(i.open("POST",r,!0),Promise.resolve({xhr:i,licenseChallenge:d}))}requestLicense(i,r){const o=this.config.keyLoadPolicy.default;return new Promise((d,p)=>{const g=this.getLicenseServerUrlOrThrow(i.keySystem);this.log(`Sending license request to URL: ${g}`);const y=new XMLHttpRequest;y.responseType="arraybuffer",y.onreadystatechange=()=>{if(!this.hls||!i.mediaKeysSession)return p(new Error("invalid state"));if(y.readyState===4)if(y.status===200){this._requestLicenseFailureCount=0;let v=y.response;this.log(`License received ${v instanceof ArrayBuffer?v.byteLength:v}`);const T=this.config.licenseResponseCallback;if(T)try{v=T.call(this.hls,y,g,i)}catch(C){this.error(C)}d(v)}else{const v=o.errorRetry,T=v?v.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>T||y.status>=400&&y.status<500)p(new cc({type:Gt.KEY_SYSTEM_ERROR,details:Ue.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:{url:g,data:void 0,code:y.status,text:y.statusText}},`License Request XHR failed (${g}). Status: ${y.status} (${y.statusText})`));else{const C=T-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${C} attempts left`),this.requestLicense(i,r).then(d,p)}}},i.licenseXhr&&i.licenseXhr.readyState!==XMLHttpRequest.DONE&&i.licenseXhr.abort(),i.licenseXhr=y,this.setupLicenseXHR(y,g,i,r).then(({xhr:v,licenseChallenge:T})=>{i.keySystem==wi.PLAYREADY&&(T=this.unpackPlayReadyKeyMessage(v,T)),v.send(T)})})}onMediaAttached(i,r){if(!this.config.emeEnabled)return;const o=r.media;this.media=o,o.removeEventListener("encrypted",this.onMediaEncrypted),o.removeEventListener("waitingforkey",this.onWaitingForKey),o.addEventListener("encrypted",this.onMediaEncrypted),o.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const i=this.media;i&&(i.removeEventListener("encrypted",this.onMediaEncrypted),i.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)}_clear(i){var r;const o=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},uT.clearKeyUriToKeyIdMap();const d=o.length;I_.CDMCleanupPromise=Promise.all(o.map(p=>this.removeSession(p)).concat(i==null||(r=i.setMediaKeys(null))==null?void 0:r.catch(p=>{var g;this.log(`Could not clear media keys: ${p}`),(g=this.hls)==null||g.trigger(z.ERROR,{type:Gt.OTHER_ERROR,details:Ue.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${p}`)})}))).then(()=>{d&&(this.log("finished closing key sessions and clearing media keys"),o.length=0)}).catch(p=>{var g;this.log(`Could not close sessions and clear media keys: ${p}`),(g=this.hls)==null||g.trigger(z.ERROR,{type:Gt.OTHER_ERROR,details:Ue.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${p}`)})})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(i,{sessionKeys:r}){if(!(!r||!this.config.emeEnabled)&&!this.keyFormatPromise){const o=r.reduce((d,p)=>(d.indexOf(p.keyFormat)===-1&&d.push(p.keyFormat),d),[]);this.log(`Selecting key-system from session-keys ${o.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(o)}}removeSession(i){const{mediaKeysSession:r,licenseXhr:o}=i;if(r){this.log(`Remove licenses and keys and close session ${r.sessionId}`),i._onmessage&&(r.removeEventListener("message",i._onmessage),i._onmessage=void 0),i._onkeystatuseschange&&(r.removeEventListener("keystatuseschange",i._onkeystatuseschange),i._onkeystatuseschange=void 0),o&&o.readyState!==XMLHttpRequest.DONE&&o.abort(),i.mediaKeysSession=i.decryptdata=i.licenseXhr=void 0;const d=this.mediaKeySessions.indexOf(i);d>-1&&this.mediaKeySessions.splice(d,1);const{drmSystemOptions:p}=this.config;return(ete(p)?new Promise((y,v)=>{self.setTimeout(()=>v(new Error("MediaKeySession.remove() timeout")),8e3),r.remove().then(y)}):Promise.resolve()).catch(y=>{var v;this.log(`Could not remove session: ${y}`),(v=this.hls)==null||v.trigger(z.ERROR,{type:Gt.OTHER_ERROR,details:Ue.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${y}`)})}).then(()=>r.close()).catch(y=>{var v;this.log(`Could not close session: ${y}`),(v=this.hls)==null||v.trigger(z.ERROR,{type:Gt.OTHER_ERROR,details:Ue.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${y}`)})})}}}I_.CDMCleanupPromise=void 0;class cc extends Error{constructor(i,r){super(r),this.data=void 0,i.error||(i.error=new Error(r)),this.data=i,i.err=i.error}}class cie{constructor(i){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=i,this.registerListeners()}setStreamController(i){this.streamController=i}registerListeners(){this.hls.on(z.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(z.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(z.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(z.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(i,r){const o=this.hls.config;if(o.capLevelOnFPSDrop){const d=r.media instanceof self.HTMLVideoElement?r.media:null;this.media=d,d&&typeof d.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),o.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(i,r,o){const d=performance.now();if(r){if(this.lastTime){const p=d-this.lastTime,g=o-this.lastDroppedFrames,y=r-this.lastDecodedFrames,v=1e3*g/p,T=this.hls;if(T.trigger(z.FPS_DROP,{currentDropped:g,currentDecoded:y,totalDroppedFrames:o}),v>0&&g>T.config.fpsDroppedMonitoringThreshold*y){let C=T.currentLevel;T.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+C),C>0&&(T.autoLevelCapping===-1||T.autoLevelCapping>=C)&&(C=C-1,T.trigger(z.FPS_DROP_LEVEL_CAPPING,{level:C,droppedLevel:T.currentLevel}),T.autoLevelCapping=C,this.streamController.nextLevelSwitch())}}this.lastTime=d,this.lastDroppedFrames=o,this.lastDecodedFrames=r}}checkFPSInterval(){const i=this.media;if(i)if(this.isVideoPlaybackQualityAvailable){const r=i.getVideoPlaybackQuality();this.checkFPS(i,r.totalVideoFrames,r.droppedVideoFrames)}else this.checkFPS(i,i.webkitDecodedFrameCount,i.webkitDroppedFrameCount)}}function i6(h,i){let r;try{r=new Event("addtrack")}catch{r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=h,i.dispatchEvent(r)}function s6(h,i){const r=h.mode;if(r==="disabled"&&(h.mode="hidden"),h.cues&&!h.cues.getCueById(i.id))try{if(h.addCue(i),!h.cues.getCueById(i.id))throw new Error(`addCue is failed for: ${i}`)}catch(o){Zn.debug(`[texttrack-utils]: ${o}`);try{const d=new self.TextTrackCue(i.startTime,i.endTime,i.text);d.id=i.id,h.addCue(d)}catch(d){Zn.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${d}`)}}r==="disabled"&&(h.mode=r)}function A_(h,i){const r=h.mode;if(r==="disabled"&&(h.mode="hidden"),h.cues)for(let o=h.cues.length;o--;)i&&h.cues[o].removeEventListener("enter",i),h.removeCue(h.cues[o]);r==="disabled"&&(h.mode=r)}function XN(h,i,r,o){const d=h.mode;if(d==="disabled"&&(h.mode="hidden"),h.cues&&h.cues.length>0){const p=die(h.cues,i,r);for(let g=0;g<p.length;g++)(!o||o(p[g]))&&h.removeCue(p[g])}d==="disabled"&&(h.mode=d)}function lie(h,i){if(i<=h[0].startTime)return 0;const r=h.length-1;if(i>h[r].endTime)return-1;let o=0,d=r,p;for(;o<=d;)if(p=Math.floor((d+o)/2),i<h[p].startTime)d=p-1;else if(i>h[p].startTime&&o<r)o=p+1;else return p;return h[o].startTime-i<i-h[d].startTime?o:d}function die(h,i,r){const o=[],d=lie(h,i);if(d>-1)for(let p=d,g=h.length;p<g;p++){const y=h[p];if(y.startTime>=i&&y.endTime<=r)o.push(y);else if(y.startTime>r)return o}return o}function QA(h){const i=[];for(let r=0;r<h.length;r++){const o=h[r];(o.kind==="subtitles"||o.kind==="captions")&&o.label&&i.push(h[r])}return i}class uie extends PL{constructor(i){super(i,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let r=null;const o=QA(this.media.textTracks);for(let p=0;p<o.length;p++)if(o[p].mode==="hidden")r=o[p];else if(o[p].mode==="showing"){r=o[p];break}const d=this.findTrackForTextTrack(r);this.subtitleTrack!==d&&this.setSubtitleTrack(d)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(i){this._subtitleDisplay=i,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:i}=this;i.on(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.MANIFEST_PARSED,this.onManifestParsed,this),i.on(z.LEVEL_LOADING,this.onLevelLoading,this),i.on(z.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(z.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(z.ERROR,this.onError,this)}unregisterListeners(){const{hls:i}=this;i.off(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.MANIFEST_PARSED,this.onManifestParsed,this),i.off(z.LEVEL_LOADING,this.onLevelLoading,this),i.off(z.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(z.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(z.ERROR,this.onError,this)}onMediaAttached(i,r){this.media=r.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(i){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,i)}onMediaDetaching(i,r){const o=this.media;if(!o)return;const d=!!r.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||o.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,d)return;QA(o.textTracks).forEach(g=>{A_(g)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(i,r){this.tracks=r.subtitleTracks}onSubtitleTrackLoaded(i,r){const{id:o,groupId:d,details:p}=r,g=this.tracksInGroup[o];if(!g||g.groupId!==d){this.warn(`Subtitle track with id:${o} and group:${d} not found in active group ${g==null?void 0:g.groupId}`);return}const y=g.details;g.details=r.details,this.log(`Subtitle track ${o} "${g.name}" lang:${g.lang} group:${d} loaded [${p.startSN}-${p.endSN}]`),o===this.trackId&&this.playlistLoaded(o,r,y)}onLevelLoading(i,r){this.switchLevel(r.level)}onLevelSwitching(i,r){this.switchLevel(r.level)}switchLevel(i){const r=this.hls.levels[i];if(!r)return;const o=r.subtitleGroups||null,d=this.groupIds;let p=this.currentTrack;if(!o||(d==null?void 0:d.length)!==(o==null?void 0:o.length)||o!=null&&o.some(g=>(d==null?void 0:d.indexOf(g))===-1)){this.groupIds=o,this.trackId=-1,this.currentTrack=null;const g=this.tracks.filter(C=>!o||o.indexOf(C.groupId)!==-1);if(g.length)this.selectDefaultTrack&&!g.some(C=>C.default)&&(this.selectDefaultTrack=!1),g.forEach((C,I)=>{C.id=I});else if(!p&&!this.tracksInGroup.length)return;this.tracksInGroup=g;const y=this.hls.config.subtitlePreference;if(!p&&y){this.selectDefaultTrack=!1;const C=gd(y,g);if(C>-1)p=g[C];else{const I=gd(y,this.tracks);p=this.tracks[I]}}let v=this.findTrackId(p);v===-1&&p&&(v=this.findTrackId(null));const T={subtitleTracks:g};this.log(`Updating subtitle tracks, ${g.length} track(s) found in "${o==null?void 0:o.join(",")}" group-id`),this.hls.trigger(z.SUBTITLE_TRACKS_UPDATED,T),v!==-1&&this.trackId===-1&&this.setSubtitleTrack(v)}}findTrackId(i){const r=this.tracksInGroup,o=this.selectDefaultTrack;for(let d=0;d<r.length;d++){const p=r[d];if(!(o&&!p.default||!o&&!i)&&(!i||Nm(p,i)))return d}if(i){for(let d=0;d<r.length;d++){const p=r[d];if(mT(i.attrs,p.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<r.length;d++){const p=r[d];if(mT(i.attrs,p.attrs,["LANGUAGE"]))return d}}return-1}findTrackForTextTrack(i){if(i){const r=this.tracksInGroup;for(let o=0;o<r.length;o++){const d=r[o];if(qN(d,i))return o}}return-1}onError(i,r){r.fatal||!r.context||r.context.type===Vn.SUBTITLE_TRACK&&r.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(r.context.groupId)!==-1)&&this.checkRetry(r)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(i){this.selectDefaultTrack=!1,this.setSubtitleTrack(i)}setSubtitleOption(i){if(this.hls.config.subtitlePreference=i,i){if(i.id===-1)return this.setSubtitleTrack(-1),null;const r=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,r.length){const o=this.currentTrack;if(o&&Nm(i,o))return o;const d=gd(i,this.tracksInGroup);if(d>-1){const p=this.tracksInGroup[d];return this.setSubtitleTrack(d),p}else{if(o)return null;{const p=gd(i,r);if(p>-1)return r[p]}}}}return null}loadPlaylist(i){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,i)}loadingPlaylist(i,r){super.loadingPlaylist(i,r);const o=i.id,d=i.groupId,p=this.getUrlWithDirectives(i.url,r),g=i.details,y=g==null?void 0:g.age;this.log(`Loading subtitle ${o} "${i.name}" lang:${i.lang} group:${d}${(r==null?void 0:r.msn)!==void 0?" at sn "+r.msn+" part "+r.part:""}${y&&g.live?" age "+y.toFixed(1)+(g.type&&" "+g.type||""):""} ${p}`),this.hls.trigger(z.SUBTITLE_TRACK_LOADING,{url:p,id:o,groupId:d,deliveryDirectives:r||null,track:i})}toggleTrackModes(){const{media:i}=this;if(!i)return;const r=QA(i.textTracks),o=this.currentTrack;let d;if(o&&(d=r.filter(p=>qN(o,p))[0],d||this.warn(`Unable to find subtitle TextTrack with name "${o.name}" and language "${o.lang}"`)),[].slice.call(r).forEach(p=>{p.mode!=="disabled"&&p!==d&&(p.mode="disabled")}),d){const p=this.subtitleDisplay?"showing":"hidden";d.mode!==p&&(d.mode=p)}}setSubtitleTrack(i){const r=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=i;return}if(i<-1||i>=r.length||!xt(i)){this.warn(`Invalid subtitle track id: ${i}`);return}this.selectDefaultTrack=!1;const o=this.currentTrack,d=r[i]||null;if(this.trackId=i,this.currentTrack=d,this.toggleTrackModes(),!d){this.hls.trigger(z.SUBTITLE_TRACK_SWITCH,{id:i});return}const p=!!d.details&&!d.details.live;if(i===this.trackId&&d===o&&p)return;this.log(`Switching to subtitle-track ${i}`+(d?` "${d.name}" lang:${d.lang} group:${d.groupId}`:""));const{id:g,groupId:y="",name:v,type:T,url:C}=d;this.hls.trigger(z.SUBTITLE_TRACK_SWITCH,{id:g,groupId:y,name:v,type:T,url:C});const I=this.switchParams(d.url,o==null?void 0:o.details,d.details);this.loadPlaylist(I)}}function sT(h){let i=5381,r=h.length;for(;r;)i=i*33^h.charCodeAt(--r);return(i>>>0).toString()}const w_=.025;let mC=function(h){return h[h.Point=0]="Point",h[h.Range=1]="Range",h}({});function hie(h,i,r){return`${h.identifier}-${r+1}-${sT(i)}`}class fie{constructor(i,r){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=r,this.dateRange=i,this.setDateRange(i)}setDateRange(i){this.dateRange=i,this.resumeOffset=i.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=i.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=i.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=i.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var i;this.appendInPlaceStarted=!1,(i=this.assetListLoader)==null||i.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(i){if(i>=this.assetList.length)return!0;const r=this.playoutLimit;return i<=0||isNaN(r)?!1:this.assetList[i].startOffset>r}findAssetIndex(i){return this.assetList.indexOf(i)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const i=this.dateRange.startTime;if(this.snapOptions.out){const r=this.dateRange.tagAnchor;if(r)return EN(i,r)}return i}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const i=this.dateRange.tagAnchor;if(i){const r=this.dateRange.startTime,o=EN(r,i);return r-o<.1}return!1}get resumptionOffset(){const i=this.resumeOffset,r=xt(i)?i:this.duration;return this.cumulativeDuration+r}get resumeTime(){const i=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const r=this.resumeAnchor;if(r)return EN(i,r)}return i}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<w_))}set appendInPlace(i){if(this.appendInPlaceStarted){this.resetOnResume=!i;return}this.appendInPlaceDisabled=!i}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(i){this._timelineStart=i}get duration(){const i=this.playoutLimit;let r;return this._duration!==null?r=this._duration:this.dateRange.duration?r=this.dateRange.duration:r=this.dateRange.plannedDuration||0,!isNaN(i)&&i<r&&(r=i),r}set duration(i){this._duration=i}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?mC.Range:mC.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return pie(this)}}function EN(h,i){return h-i.start<i.duration/2&&!(Math.abs(h-(i.start+i.duration))<w_)?i.start:i.start+i.duration}function r6(h,i,r){const o=new self.URL(h,r);return o.protocol!=="data:"&&o.searchParams.set("_HLS_primary_id",i),o}function pie(h){return`["${h.identifier}" ${h.cue.pre?"<pre>":h.cue.post?"<post>":""}${h.timelineStart.toFixed(2)}-${h.resumeTime.toFixed(2)}]`}function JN(h){const i=h.timelineStart,r=h.duration||0;return`["${h.identifier}" ${i.toFixed(2)}-${(i+r).toFixed(2)}]`}class mie{constructor(i,r,o,d){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{const T=this.interstitial.playoutLimit,C=this.currentTime;this.startOffset+C>=T&&this.hls.trigger(z.PLAYOUT_LIMIT_REACHED,{})};const p=this.hls=new i(r);this.interstitial=o,this.assetItem=d;let g=d.uri;try{g=r6(g,p.sessionId).href}catch{}p.loadSource(g);const y=()=>{this.hasDetails=!0};p.once(z.LEVEL_LOADED,y),p.once(z.AUDIO_TRACK_LOADED,y),p.once(z.SUBTITLE_TRACK_LOADED,y),p.on(z.MEDIA_ATTACHING,(v,{media:T})=>{this.removeMediaListeners(),this.mediaAttached=T,this.interstitial.playoutLimit&&T.addEventListener("timeupdate",this.checkPlayout)})}bufferedInPlaceToEnd(i){var r;if(!this.interstitial.appendInPlace)return!1;if((r=this.hls)!=null&&r.bufferedToEnd)return!0;if(!i||!this._bufferedEosTime)return!1;const o=this.timelineOffset,d=Dn.bufferInfo(i,o,0);return this.getAssetTime(d.end)>=this._bufferedEosTime-.02}get destroyed(){var i;return!((i=this.hls)!=null&&i.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var i;return((i=this.hls)==null?void 0:i.media)||null}get bufferedEnd(){const i=this.media||this.mediaAttached;if(!i)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const r=Dn.bufferInfo(i,i.currentTime,.001);return this.getAssetTime(r.end)}get currentTime(){const i=this.media||this.mediaAttached;return i?this.getAssetTime(i.currentTime):this._currentTime||0}get duration(){const i=this.assetItem.duration;return i||0}get remaining(){const i=this.duration;return i?Math.max(0,i-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var i;return((i=this.hls)==null?void 0:i.config.timelineOffset)||0}set timelineOffset(i){const r=this.timelineOffset;if(i!==r){const o=i-r;if(Math.abs(o)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=i}}}getAssetTime(i){const r=this.timelineOffset,o=this.duration;return Math.min(Math.max(0,i-r),o)}removeMediaListeners(){const i=this.mediaAttached;i&&(this._currentTime=i.currentTime,this.bufferSnapShot(),i.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var i;(i=this.hls)!=null&&i.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(i){this.hls.attachMedia(i)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}on(i,r,o){this.hls.on(i,r)}once(i,r,o){this.hls.once(i,r)}off(i,r,o){this.hls.off(i,r)}toString(){var i,r;return`HlsAssetPlayer: ${JN(this.assetItem)} ${(i=this.hls)==null?void 0:i.sessionId} ${(r=this.interstitial)!=null&&r.appendInPlace?"append-in-place":""}`}}const M4=.033;class gie extends Ou{constructor(i,r){super("interstitials-sched",r),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=i}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(i=>i.reset()),this.events=this.items=null}resetErrorsInRange(i,r){return this.events?this.events.reduce((o,d)=>i<=d.startOffset&&r>d.startOffset?(delete d.error,o+1):o,0):0}get duration(){const i=this.items;return i?i[i.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(i){return i&&this.eventMap[i]||null}hasEvent(i){return i in this.eventMap}findItemIndex(i,r){if(i.event)return this.findEventIndex(i.event.identifier);let o=-1;i.nextEvent?o=this.findEventIndex(i.nextEvent.identifier)-1:i.previousEvent&&(o=this.findEventIndex(i.previousEvent.identifier)+1);const d=this.items;if(d)for(d[o]||(r===void 0&&(r=i.start),o=this.findItemIndexAtTime(r));o>=0&&(p=d[o])!=null&&p.event;){var p;o--}return o}findItemIndexAtTime(i,r){const o=this.items;if(o)for(let d=0;d<o.length;d++){let p=o[d];if(r&&r!=="primary"&&(p=p[r]),i===p.start||i>p.start&&i<p.end)return d}return-1}findJumpRestrictedIndex(i,r){const o=this.items;if(o)for(let d=i;d<=r&&o[d];d++){const p=o[d].event;if(p!=null&&p.restrictions.jump&&!p.appendInPlace)return d}return-1}findEventIndex(i){const r=this.items;if(r)for(let d=r.length;d--;){var o;if(((o=r[d].event)==null?void 0:o.identifier)===i)return d}return-1}findAssetIndex(i,r){const o=i.assetList,d=o.length;if(d>1)for(let p=0;p<d;p++){const g=o[p];if(!g.error){const y=g.timelineStart;if(r===y||r>y&&r<y+(g.duration||0))return p}}return 0}get assetIdAtEnd(){var i,r;const o=(i=this.items)==null||(r=i[this.length-1])==null?void 0:r.event;if(o){const d=o.assetList,p=d[d.length-1];if(p)return p.identifier}return null}parseInterstitialDateRanges(i,r){const o=i.main.details,{dateRanges:d}=o,p=this.events,g=this.parseDateRanges(d,{url:o.url},r),y=Object.keys(d),v=p?p.filter(T=>!y.includes(T.identifier)):[];g.length&&g.sort((T,C)=>{const I=T.cue.pre,L=T.cue.post,N=C.cue.pre,x=C.cue.post;if(I&&!N)return-1;if(N&&!I||L&&!x)return 1;if(x&&!L)return-1;if(!I&&!N&&!L&&!x){const K=T.startTime,H=C.startTime;if(K!==H)return K-H}return T.dateRange.tagOrder-C.dateRange.tagOrder}),this.events=g,v.forEach(T=>{this.removeEvent(T)}),this.updateSchedule(i,v)}updateSchedule(i,r=[]){const o=this.events||[];if(o.length||r.length||this.length<2){const d=this.items,p=this.parseSchedule(o,i);(r.length||(d==null?void 0:d.length)!==p.length||p.some((y,v)=>Math.abs(y.playout.start-d[v].playout.start)>.005||Math.abs(y.playout.end-d[v].playout.end)>.005))&&(this.items=p,this.onScheduleUpdate(r,d))}}parseDateRanges(i,r,o){const d=[],p=Object.keys(i);for(let g=0;g<p.length;g++){const y=p[g],v=i[y];if(v.isInterstitial){let T=this.eventMap[y];T?T.setDateRange(v):(T=new fie(v,r),this.eventMap[y]=T,o===!1&&(T.appendInPlace=o)),d.push(T)}}return d}parseSchedule(i,r){const o=[],d=r.main.details,p=d.live?1/0:d.edge;let g=0;if(i=i.filter(v=>!v.error&&!(v.cue.once&&v.hasPlayed)),i.length){this.resolveOffsets(i,r);let v=0,T=0;if(i.forEach((C,I)=>{const L=C.cue.pre,N=C.cue.post,x=i[I-1]||null,K=C.appendInPlace,H=N?p:C.startOffset,Q=C.duration,ne=C.timelineOccupancy===mC.Range?Q:0,ee=C.resumptionOffset,pe=(x==null?void 0:x.startTime)===H,de=H+C.cumulativeDuration;let be=K?de+Q:H+ee;if(L||!N&&H<=0){const Te=T;T+=ne,C.timelineStart=de;const _e=g;g+=Q,o.push({event:C,start:de,end:be,playout:{start:_e,end:g},integrated:{start:Te,end:T}})}else if(H<=p){if(!pe){const he=H-v;if(he>M4){const Ge=v,st=T;T+=he;const It=g;g+=he;const qe={previousEvent:i[I-1]||null,nextEvent:C,start:Ge,end:Ge+he,playout:{start:It,end:g},integrated:{start:st,end:T}};o.push(qe)}else he>0&&x&&(x.cumulativeDuration+=he,o[o.length-1].end=H)}N&&(be=de),C.timelineStart=de;const Te=T;T+=ne;const _e=g;g+=Q,o.push({event:C,start:de,end:be,playout:{start:_e,end:g},integrated:{start:Te,end:T}})}else return;const Se=C.resumeTime;N||Se>p?v=p:v=Se}),v<p){var y;const C=v,I=T,L=p-v;T+=L;const N=g;g+=L,o.push({previousEvent:((y=o[o.length-1])==null?void 0:y.event)||null,nextEvent:null,start:v,end:C+L,playout:{start:N,end:g},integrated:{start:I,end:T}})}this.setDurations(p,g,T)}else o.push({previousEvent:null,nextEvent:null,start:0,end:p,playout:{start:0,end:p},integrated:{start:0,end:p}}),this.setDurations(p,p,p);return o}setDurations(i,r,o){this.durations={primary:i,playout:r,integrated:o}}resolveOffsets(i,r){const o=r.main.details,d=o.live?1/0:o.edge;let p=0,g=-1;i.forEach((y,v)=>{const T=y.cue.pre,C=y.cue.post,I=T?0:C?d:y.startTime;this.updateAssetDurations(y),g===I?y.cumulativeDuration=p:(p=0,g=I),!C&&y.snapOptions.in&&(y.resumeAnchor=xm(null,o.fragments,y.startOffset+y.resumptionOffset,0,0)||void 0),y.appendInPlace&&!y.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(y,r)||(y.appendInPlace=!1)),!y.appendInPlace&&v+1<i.length&&i[v+1].startTime-i[v].resumeTime<M4&&(i[v+1].appendInPlace=!1,i[v+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${y}`));const N=xt(y.resumeOffset)?y.resumeOffset:y.duration;p+=N})}primaryCanResumeInPlaceAt(i,r){const o=i.resumeTime,d=i.startTime+i.resumptionOffset;return Math.abs(o-d)>w_?(this.log(`"${i.identifier}" resumption ${o} not aligned with estimated timeline end ${d}`),!1):r?!Object.keys(r).some(g=>{const y=r[g].details,v=y.edge;if(o>=v)return this.log(`"${i.identifier}" resumption ${o} past ${g} playlist end ${v}`),!1;const T=xm(null,y.fragments,o);if(!T)return this.log(`"${i.identifier}" resumption ${o} does not align with any fragments in ${g} playlist (${y.fragStart}-${y.fragmentEnd})`),!0;const C=g==="audio"?.175:0;return Math.abs(T.start-o)<w_+C||Math.abs(T.end-o)<w_+C?!1:(this.log(`"${i.identifier}" resumption ${o} not aligned with ${g} fragment bounds (${T.start}-${T.end} sn: ${T.sn} cc: ${T.cc})`),!0)}):(this.log(`"${i.identifier}" resumption ${o} can not be aligned with media (none selected)`),!1)}updateAssetDurations(i){if(!i.assetListLoaded)return;const r=i.timelineStart;let o=0,d=!1,p=!1;i.assetList.forEach((g,y)=>{const v=r+o;g.startOffset=o,g.timelineStart=v,d||(d=g.duration===null),p||(p=!!g.error);const T=g.error?0:g.duration||0;o+=T}),d&&!p?i.duration=Math.max(o,i.duration):i.duration=o}removeEvent(i){i.reset(),delete this.eventMap[i.identifier]}}function of(h){return`[${h.event?'"'+h.event.identifier+'"':"primary"}: ${h.start.toFixed(2)}-${h.end.toFixed(2)}]`}class Eie{constructor(i){this.hls=void 0,this.hls=i}destroy(){this.hls=null}loadAssetList(i,r){const o=i.assetListUrl;let d;try{d=r6(o,this.hls.sessionId,i.baseUrl)}catch(L){const N=this.assignAssetListError(i,Ue.ASSET_LIST_LOAD_ERROR,L,o);this.hls.trigger(z.ERROR,N);return}r&&d.protocol!=="data:"&&d.searchParams.set("_HLS_start_offset",""+r);const p=this.hls.config,g=p.loader,y=new g(p),v={responseType:"json",url:d.href},T=p.interstitialAssetListLoadPolicy.default,C={loadPolicy:T,timeout:T.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},I={onSuccess:(L,N,x,K)=>{const H=L.data,Q=H==null?void 0:H.ASSETS;if(!Array.isArray(Q)){const ne=this.assignAssetListError(i,Ue.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),x.url,N,K);this.hls.trigger(z.ERROR,ne);return}i.assetListResponse=H,this.hls.trigger(z.ASSET_LIST_LOADED,{event:i,assetListResponse:H,networkDetails:K})},onError:(L,N,x,K)=>{const H=this.assignAssetListError(i,Ue.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${L.code} ${L.text} (${N.url})`),N.url,K,x);this.hls.trigger(z.ERROR,H)},onTimeout:(L,N,x)=>{const K=this.assignAssetListError(i,Ue.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${N.url})`),N.url,L,x);this.hls.trigger(z.ERROR,K)}};return y.load(v,C,I),this.hls.trigger(z.ASSET_LIST_LOADING,{event:i}),y}assignAssetListError(i,r,o,d,p,g){return i.error=o,{type:Gt.NETWORK_ERROR,details:r,fatal:!1,interstitial:i,url:d,error:o,networkDetails:g,stats:p}}}function Au(h,i,r){_d(h,i,r),h.addEventListener(i,r)}function _d(h,i,r){h.removeEventListener(i,r)}function U4(h){h==null||h.play().catch(()=>{})}class _ie extends Ou{constructor(i,r){super("interstitials",i.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const o=this.currentTime;if(o===void 0||this.playbackDisabled)return;const d=o-this.timelinePos;if(Math.abs(d)<1/7056e5)return;const g=d<=-.01;this.timelinePos=o,this.bufferedPos=o;const y=this.playingItem;if(!y){this.checkBuffer();return}if(g&&this.schedule.resetErrorsInRange(o,o-d)&&this.updateSchedule(),this.checkBuffer(),g&&o<y.start||o>=y.end){var v;const L=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(y)&&(v=this.media)!=null&&v.paused&&(this.shouldPlay=!1),!g){const N=this.findItemIndex(y);if(L>N){const x=this.schedule.findJumpRestrictedIndex(N+1,L);if(x>N){this.setSchedulePosition(x);return}}}this.setSchedulePosition(L);return}const T=this.playingAsset;if(!T){if(this.playingLastItem&&this.isInterstitial(y)){const L=y.event.assetList[0];L&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(o,L))}return}const C=T.timelineStart,I=T.duration||0;(g&&o<C||o>=C+I)&&this.setScheduleToAssetAtTime(o,T)},this.onTimeupdate=()=>{const o=this.currentTime;if(o===void 0||this.playbackDisabled)return;if(o>this.timelinePos)this.timelinePos=o,o>this.bufferedPos&&this.checkBuffer();else return;const d=this.playingItem;if(!d||this.playingLastItem)return;if(o>=d.end){this.timelinePos=d.end;const y=this.findItemIndex(d);this.setSchedulePosition(y+1)}const p=this.playingAsset;if(!p)return;const g=p.timelineStart+(p.duration||0);o>=g&&this.setScheduleToAssetAtTime(o,p)},this.onScheduleUpdate=(o,d)=>{const p=this.schedule,g=this.playingItem,y=p.events||[],v=p.items||[],T=p.durations,C=o.map(N=>N.identifier),I=!!(y.length||C.length);if(I&&this.log(`INTERSTITIALS_UPDATED (${y.length}): ${y}
Schedule: ${v.map(N=>of(N))}`),C.length&&this.log(`Removed events ${C}`),this.playerQueue.forEach(N=>{if(N.interstitial.appendInPlace){const x=N.assetItem.timelineStart,K=N.timelineOffset-x;if(K)try{N.timelineOffset=x}catch(H){Math.abs(K)>w_&&this.warn(`${H} ("${N.assetId}" ${N.timelineOffset}->${x})`)}}}),g){const N=this.updateItem(g,this.timelinePos);this.itemsMatch(g,N)&&(this.playingItem=N,this.waitingItem=this.endedItem=null)}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const L=this.bufferingItem;if(L){const N=this.updateItem(L,this.bufferedPos);this.itemsMatch(L,N)?this.bufferingItem=N:L.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(L.event,null))}if(o.forEach(N=>{N.assetList.forEach(x=>{this.clearAssetPlayer(x.identifier,null)})}),I||d){if(this.hls.trigger(z.INTERSTITIALS_UPDATED,{events:y.slice(0),schedule:v.slice(0),durations:T,removedIds:C}),this.isInterstitial(g)&&C.includes(g.event.identifier)){this.warn(`Interstitial "${g.event.identifier}" removed while playing`),this.primaryFallback(g.event);return}this.checkBuffer()}},this.hls=i,this.HlsPlayerClass=r,this.assetListLoader=new Eie(i),this.schedule=new gie(this.onScheduleUpdate,i.logger),this.registerListeners()}registerListeners(){const i=this.hls;i.on(z.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.LEVEL_UPDATED,this.onLevelUpdated,this),i.on(z.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.on(z.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),i.on(z.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.on(z.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),i.on(z.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),i.on(z.ASSET_LIST_LOADED,this.onAssetListLoaded,this),i.on(z.BUFFER_APPENDED,this.onBufferAppended,this),i.on(z.BUFFER_FLUSHED,this.onBufferFlushed,this),i.on(z.BUFFERED_TO_END,this.onBufferedToEnd,this),i.on(z.MEDIA_ENDED,this.onMediaEnded,this),i.on(z.ERROR,this.onError,this),i.on(z.DESTROYING,this.onDestroying,this)}unregisterListeners(){const i=this.hls;i&&(i.off(z.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.LEVEL_UPDATED,this.onLevelUpdated,this),i.off(z.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.off(z.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),i.off(z.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.off(z.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),i.off(z.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),i.off(z.ASSET_LIST_LOADED,this.onAssetListLoaded,this),i.off(z.BUFFER_CODECS,this.onBufferCodecs,this),i.off(z.BUFFER_APPENDED,this.onBufferAppended,this),i.off(z.BUFFER_FLUSHED,this.onBufferFlushed,this),i.off(z.BUFFERED_TO_END,this.onBufferedToEnd,this),i.off(z.MEDIA_ENDED,this.onMediaEnded,this),i.off(z.ERROR,this.onError,this),i.off(z.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var i;(i=this.getBufferingPlayer())==null||i.resumeBuffering()}pauseBuffering(){var i;(i=this.getBufferingPlayer())==null||i.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const i=this.primaryMedia||this.media;i&&this.removeMediaListeners(i)}removeMediaListeners(i){_d(i,"play",this.onPlay),_d(i,"pause",this.onPause),_d(i,"seeking",this.onSeeking),_d(i,"timeupdate",this.onTimeupdate)}onMediaAttaching(i,r){const o=this.media=r.media;Au(o,"seeking",this.onSeeking),Au(o,"timeupdate",this.onTimeupdate),Au(o,"play",this.onPlay),Au(o,"pause",this.onPause)}onMediaAttached(i,r){const o=this.effectivePlayingItem,d=this.detachedData;if(this.detachedData=null,o===null)this.checkStart();else if(!d){this.clearScheduleState();const p=this.findItemIndex(o);this.setSchedulePosition(p)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(i,r){const o=!!r.transferMedia,d=this.media;if(this.media=null,!o&&(d&&this.removeMediaListeners(d),this.detachedData)){const p=this.getBufferingPlayer();p&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,p.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const i=this,r=()=>i.bufferingItem||i.waitingItem,o=I=>I&&i.getAssetPlayer(I.identifier),d=(I,L,N,x,K)=>{if(I){let H=I[L].start;const Q=I.event;if(Q){if(L==="playout"||Q.timelineOccupancy!==mC.Point){const ne=o(N);(ne==null?void 0:ne.interstitial)===Q&&(H+=ne.assetItem.startOffset+ne[K])}}else{const ne=x==="bufferedPos"?g():i[x];H+=ne-I.start}return H}return 0},p=(I,L)=>{if(I!==0&&L!=="primary"&&i.schedule.length){var N;const x=i.schedule.findItemIndexAtTime(I),K=(N=i.schedule.items)==null?void 0:N[x];if(K){const H=K[L].start-K.start;return I+H}}return I},g=()=>{const I=i.bufferedPos;return I===Number.MAX_VALUE?y("primary"):Math.max(I,0)},y=I=>{var L;return(L=i.primaryDetails)!=null&&L.live?i.primaryDetails.edge:i.schedule.durations[I]},v=(I,L)=>{var N,x;const K=i.effectivePlayingItem;if(K!=null&&(N=K.event)!=null&&N.restrictions.skip)return;i.log(`seek to ${I} "${L}"`);const H=i.effectivePlayingItem,Q=i.schedule.findItemIndexAtTime(I,L),ne=(x=i.schedule.items)==null?void 0:x[Q],ee=i.getBufferingPlayer(),pe=ee==null?void 0:ee.interstitial,de=pe==null?void 0:pe.appendInPlace,be=H&&i.itemsMatch(H,ne);if(H&&(de||be)){const Te=o(i.playingAsset),_e=(Te==null?void 0:Te.media)||i.primaryMedia;if(_e){const he=L==="primary"?_e.currentTime:d(H,L,i.playingAsset,"timelinePos","currentTime"),Ge=I-he,st=(de?he:_e.currentTime)+Ge;if(st>=0&&(!Te||de||st<=Te.duration)){_e.currentTime=st;return}}}if(ne){let Te=I;if(L!=="primary"){const he=ne[L].start,Ge=I-he;Te=ne.start+Ge}const _e=!i.isInterstitial(ne);if((!i.isInterstitial(H)||H.event.appendInPlace)&&(_e||ne.event.appendInPlace)){const he=i.media||(de?ee==null?void 0:ee.media:null);he&&(he.currentTime=Te)}else if(H){const he=i.findItemIndex(H);if(Q>he){const st=i.schedule.findJumpRestrictedIndex(he+1,Q);if(st>he){i.setSchedulePosition(st);return}}let Ge=0;if(_e)i.timelinePos=Te,i.checkBuffer();else{var Se;const st=ne==null||(Se=ne.event)==null?void 0:Se.assetList;if(st){const It=I-(ne[L]||ne).start;for(let qe=st.length;qe--;){const ut=st[qe];if(ut.duration&&It>=ut.startOffset&&It<ut.startOffset+ut.duration){Ge=qe;break}}}}i.setSchedulePosition(Q,Ge)}}},T=()=>{const I=i.effectivePlayingItem;if(i.isInterstitial(I))return I;const L=r();return i.isInterstitial(L)?L:null},C={get currentTime(){const I=T(),L=i.effectivePlayingItem;return L&&L===I?d(L,"playout",i.effectivePlayingAsset,"timelinePos","currentTime")-L.playout.start:0},set currentTime(I){const L=T(),N=i.effectivePlayingItem;N&&N===L&&v(I+N.playout.start,"playout")},get duration(){const I=T();return I?I.playout.end-I.playout.start:0},get assetPlayers(){var I;const L=(I=T())==null?void 0:I.event.assetList;return L?L.map(N=>i.getAssetPlayer(N.identifier)):[]},get playingIndex(){var I;const L=(I=T())==null?void 0:I.event;return L&&i.effectivePlayingAsset?L.findAssetIndex(i.effectivePlayingAsset):-1},get scheduleItem(){return T()}};this.manager={get events(){var I,L;return((I=i.schedule)==null||(L=I.events)==null?void 0:L.slice(0))||[]},get schedule(){var I,L;return((I=i.schedule)==null||(L=I.items)==null?void 0:L.slice(0))||[]},get interstitialPlayer(){return T()?C:null},get playerQueue(){return i.playerQueue.slice(0)},get bufferingAsset(){return i.bufferingAsset},get bufferingItem(){return r()},get bufferingIndex(){const I=r();return i.findItemIndex(I)},get playingAsset(){return i.effectivePlayingAsset},get playingItem(){return i.effectivePlayingItem},get playingIndex(){const I=i.effectivePlayingItem;return i.findItemIndex(I)},primary:{get bufferedEnd(){return g()},get currentTime(){const I=i.timelinePos;return I>0?I:0},set currentTime(I){v(I,"primary")},get duration(){return y("primary")},get seekableStart(){var I;return((I=i.primaryDetails)==null?void 0:I.fragmentStart)||0}},integrated:{get bufferedEnd(){return d(r(),"integrated",i.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return d(i.effectivePlayingItem,"integrated",i.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(I){v(I,"integrated")},get duration(){return y("integrated")},get seekableStart(){var I;return p(((I=i.primaryDetails)==null?void 0:I.fragmentStart)||0,"integrated")}},skip:()=>{const I=i.effectivePlayingItem,L=I==null?void 0:I.event;if(L&&!L.restrictions.skip){const N=i.findItemIndex(I);if(L.appendInPlace){const x=I.playout.start+I.event.duration;v(x+.001,"playout")}else i.advanceAfterAssetEnded(L,N,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var i;const r=this.playingItem,o=(i=this.schedule)==null?void 0:i.items;return!this.playbackStarted||!r||!o?!1:this.findItemIndex(r)===o.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var i,r,o;if(this.mediaSelection===null)return;const d=this.waitingItem||this.playingItem;if(this.isInterstitial(d)&&!d.event.appendInPlace)return;let p=this.media;!p&&(i=this.bufferingItem)!=null&&(r=i.event)!=null&&r.appendInPlace&&(p=this.primaryMedia);const g=(o=p)==null?void 0:o.currentTime;if(!(g===void 0||!xt(g)))return g}get primaryMedia(){var i;return this.media||((i=this.detachedData)==null?void 0:i.media)||null}isInterstitial(i){return!!(i!=null&&i.event)}retreiveMediaSource(i,r){const o=this.getAssetPlayer(i);o&&this.transferMediaFromPlayer(o,r)}transferMediaFromPlayer(i,r){const o=i.interstitial.appendInPlace,d=i.media;if(o&&d===this.primaryMedia){if(this.bufferingAsset=null,(!r||this.isInterstitial(r)&&!r.event.appendInPlace)&&r&&d){this.detachedData={media:d};return}const p=i.transferMedia();this.log(`transfer MediaSource from ${i} ${ds(p)}`),this.detachedData=p}else r&&d&&(this.shouldPlay||(this.shouldPlay=!d.paused))}transferMediaTo(i,r){var o,d;if(i.media===r)return;let p=null;const g=this.hls,y=i!==g,v=y&&i.interstitial.appendInPlace,T=(o=this.detachedData)==null?void 0:o.mediaSource;let C;if(g.media)v&&(p=g.transferMedia(),this.detachedData=p),C="Primary";else if(T){const N=this.getBufferingPlayer();N?(p=N.transferMedia(),C=`${N}`):C="detached MediaSource"}else C="detached media";if(!p){if(T)p=this.detachedData,this.log(`using detachedData: MediaSource ${ds(p)}`);else if(!this.detachedData||g.media===r){const N=this.playerQueue;N.length>1&&N.forEach(x=>{if(y&&x.interstitial.appendInPlace!==v){const K=x.interstitial;this.clearInterstitial(x.interstitial,null),K.appendInPlace=!1,K.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${K}`)}}),this.hls.detachMedia(),this.detachedData={media:r}}}const I=p&&"mediaSource"in p&&((d=p.mediaSource)==null?void 0:d.readyState)!=="closed",L=I&&p?p:r;if(this.log(`${I?"transfering MediaSource":"attaching media"} to ${y?i:"Primary"} from ${C}`),L===p){const N=y&&i.assetId===this.schedule.assetIdAtEnd;L.overrides={duration:this.schedule.duration,endOfStream:!y||N,cueRemoval:!y}}i.attachMedia(L)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const i=this.schedule,r=i.events;if(!r||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const o=this.timelinePos,d=this.effectivePlayingItem;if(o===-1){const p=this.hls.startPosition;if(this.timelinePos=p,r.length&&r[0].cue.pre){const g=i.findEventIndex(r[0].identifier);this.setSchedulePosition(g)}else if(p>=0||!this.primaryLive){const g=this.timelinePos=p>0?p:0,y=i.findItemIndexAtTime(g);this.setSchedulePosition(y)}}else if(d&&!this.playingItem){const p=i.findItemIndex(d);this.setSchedulePosition(p)}}advanceAfterAssetEnded(i,r,o){const d=o+1;if(!i.isAssetPastPlayoutLimit(d)&&!i.assetList[d].error)this.setSchedulePosition(r,d);else{const p=this.schedule.items;if(p){const g=r+1,y=p.length;if(g>=y){this.setSchedulePosition(-1);return}const v=i.resumeTime;this.timelinePos<v&&(this.timelinePos=v,this.checkBuffer()),this.setSchedulePosition(g)}}}setScheduleToAssetAtTime(i,r){const o=this.schedule,d=r.parentIdentifier,p=o.getEvent(d);if(p){const g=o.findEventIndex(d),y=o.findAssetIndex(p,i);this.setSchedulePosition(g,y)}}setSchedulePosition(i,r){const o=this.schedule.items;if(!o||this.playbackDisabled)return;this.log(`setSchedulePosition ${i}, ${r}`);const d=i>=0?o[i]:null,p=this.playingItem,g=this.playingLastItem;if(this.isInterstitial(p)){var y;const T=p.event,C=this.playingAsset,I=C==null?void 0:C.identifier,L=I?this.getAssetPlayer(I):null;if(L&&I&&(!this.eventItemsMatch(p,d)||r!==void 0&&I!==((y=T.assetList)==null?void 0:y[r].identifier))){var v;const N=T.findAssetIndex(C);this.log(`INTERSTITIAL_ASSET_ENDED ${N+1}/${T.assetList.length} ${JN(C)}`),this.endedAsset=C,this.playingAsset=null,this.hls.trigger(z.INTERSTITIAL_ASSET_ENDED,{asset:C,assetListIndex:N,event:T,schedule:o.slice(0),scheduleIndex:i,player:L}),this.retreiveMediaSource(I,d),L.media&&!((v=this.detachedData)!=null&&v.mediaSource)&&L.detachMedia()}if(!this.eventItemsMatch(p,d)&&(this.endedItem=p,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${T} ${of(p)}`),T.hasPlayed=!0,this.hls.trigger(z.INTERSTITIAL_ENDED,{event:T,schedule:o.slice(0),scheduleIndex:i}),T.cue.once)){this.updateSchedule();const N=this.schedule.items;if(d&&N){const x=this.schedule.findItemIndex(d);this.advanceSchedule(x,N,r,p,g)}return}}this.advanceSchedule(i,o,r,p,g)}advanceSchedule(i,r,o,d,p){const g=i>=0?r[i]:null,y=this.primaryMedia,v=this.playerQueue;if(v.length&&v.forEach(T=>{const C=T.interstitial,I=this.schedule.findEventIndex(C.identifier);(I<i||I>i+1)&&this.clearInterstitial(C,g)}),this.isInterstitial(g)){this.timelinePos=Math.min(Math.max(this.timelinePos,g.start),g.end);const T=g.event;o===void 0&&(o=this.schedule.findAssetIndex(T,this.timelinePos));const C=this.waitingItem;this.assetsBuffered(g,y)||this.setBufferingItem(g);let I=this.preloadAssets(T,o);if(this.eventItemsMatch(g,C||d)||(this.waitingItem=g,this.log(`INTERSTITIAL_STARTED ${of(g)} ${T.appendInPlace?"append in place":""}`),this.hls.trigger(z.INTERSTITIAL_STARTED,{event:T,schedule:r.slice(0),scheduleIndex:i})),!T.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${T}`);return}if(T.assetListLoader&&(T.assetListLoader.destroy(),T.assetListLoader=void 0),!y){this.log(`Waiting for attachMedia to start Interstitial ${T}`);return}this.waitingItem=this.endedItem=null,this.playingItem=g;const L=T.assetList[o];if(!L){const N=r[i+1],x=this.media;N&&x&&!this.isInterstitial(N)&&x.currentTime<N.start&&(x.currentTime=this.timelinePos=N.start),this.advanceAfterAssetEnded(T,i,o||0);return}if(I||(I=this.getAssetPlayer(L.identifier)),I===null||I.destroyed){const N=T.assetList.length;this.warn(`asset ${o+1}/${N} player destroyed ${T}`),I=this.createAssetPlayer(T,L,o)}if(!this.eventItemsMatch(g,this.bufferingItem)&&T.appendInPlace&&this.isAssetBuffered(L))return;this.startAssetPlayer(I,o,r,i,y),this.shouldPlay&&U4(I.media)}else g!==null?(this.resumePrimary(g,i,d),this.shouldPlay&&U4(this.hls.media)):p&&this.isInterstitial(d)&&(this.endedItem=null,this.playingItem=d,d.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var i,r;return(i=this.mediaSelection)==null||(r=i.main)==null?void 0:r.details}get primaryLive(){var i;return!!((i=this.primaryDetails)!=null&&i.live)}resumePrimary(i,r,o){var d;if(this.playingItem=i,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(i),this.log(`resuming ${of(i)}`),!((d=this.detachedData)!=null&&d.mediaSource)){let g=this.timelinePos;(g<i.start||g>=i.end)&&(g=this.getPrimaryResumption(i,r),this.timelinePos=g),this.attachPrimary(g,i)}if(!o)return;const p=this.schedule.items;p&&(this.log(`resumed ${of(i)}`),this.hls.trigger(z.INTERSTITIALS_PRIMARY_RESUMED,{schedule:p.slice(0),scheduleIndex:r}),this.checkBuffer())}getPrimaryResumption(i,r){const o=i.start;if(this.primaryLive){const d=this.primaryDetails;if(r===0)return this.hls.startPosition;if(d&&(o<d.fragmentStart||o>d.edge))return this.hls.liveSyncPosition||-1}return o}isAssetBuffered(i){const r=this.getAssetPlayer(i.identifier);return r!=null&&r.hls?r.hls.bufferedToEnd:Dn.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=i.timelineStart+(i.duration||0)}attachPrimary(i,r,o){r?this.setBufferingItem(r):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const d=this.primaryMedia;if(!d)return;const p=this.hls;p.media?this.checkBuffer():(this.transferMediaTo(p,d),o&&this.startLoadingPrimaryAt(i,o)),o||(this.timelinePos=i,this.startLoadingPrimaryAt(i,o))}startLoadingPrimaryAt(i,r){var o;const d=this.hls;!d.loadingEnabled||!d.media||Math.abs((((o=d.mainForwardBufferInfo)==null?void 0:o.start)||d.media.currentTime)-i)>.5?d.startLoad(i,r):d.bufferingEnabled||d.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(z.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(z.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(i,r){if(r.level===-1)return;const o=this.hls.levels[r.level],d=Ii(Ii({},this.mediaSelection||this.altSelection),{},{main:o});this.mediaSelection=d,this.schedule.parseInterstitialDateRanges(d,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(i,r){const o=this.hls.audioTracks[r.id],d=this.mediaSelection;if(!d){this.altSelection=Ii(Ii({},this.altSelection),{},{audio:o});return}const p=Ii(Ii({},d),{},{audio:o});this.mediaSelection=p}onSubtitleTrackUpdated(i,r){const o=this.hls.subtitleTracks[r.id],d=this.mediaSelection;if(!d){this.altSelection=Ii(Ii({},this.altSelection),{},{subtitles:o});return}const p=Ii(Ii({},d),{},{subtitles:o});this.mediaSelection=p}onAudioTrackSwitching(i,r){const o=z3(r);this.playerQueue.forEach(d=>d.hls.setAudioOption(r)||d.hls.setAudioOption(o))}onSubtitleTrackSwitch(i,r){const o=z3(r);this.playerQueue.forEach(d=>d.hls.setSubtitleOption(r)||r.id!==-1&&d.hls.setSubtitleOption(o))}onBufferCodecs(i,r){const o=r.tracks;o&&(this.requiredTracks=o)}onBufferAppended(i,r){this.checkBuffer()}onBufferFlushed(i,r){const o=this.playingItem;if(o&&!this.itemsMatch(o,this.bufferingItem)&&!this.isInterstitial(o)){const d=this.timelinePos;this.bufferedPos=d,this.checkBuffer()}}onBufferedToEnd(i){const r=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&r){for(let d=0;d<r.length;d++){const p=r[d];if(p.cue.post){var o;const g=this.schedule.findEventIndex(p.identifier),y=(o=this.schedule.items)==null?void 0:o[g];this.isInterstitial(y)&&this.eventItemsMatch(y,this.bufferingItem)&&this.bufferedToItem(y,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(i){const r=this.playingItem;if(!this.playingLastItem&&r){const o=this.findItemIndex(r);this.setSchedulePosition(o+1)}else this.shouldPlay=!1}updateItem(i,r){const o=this.schedule.items;if(i&&o){const d=this.findItemIndex(i,r);return o[d]||null}return null}itemsMatch(i,r){return!!r&&(i===r||i.event&&r.event&&this.eventItemsMatch(i,r)||!i.event&&!r.event&&this.findItemIndex(i)===this.findItemIndex(r))}eventItemsMatch(i,r){var o;return!!r&&(i===r||i.event.identifier===((o=r.event)==null?void 0:o.identifier))}findItemIndex(i,r){return i?this.schedule.findItemIndex(i,r):-1}updateSchedule(){const i=this.mediaSelection;i&&this.schedule.updateSchedule(i,[])}checkBuffer(i){const r=this.schedule.items;if(!r)return;const o=Dn.bufferInfo(this.primaryMedia,this.timelinePos,0);i&&(this.bufferedPos=this.timelinePos),i||(i=o.len<1),this.updateBufferedPos(o.end,r,i)}updateBufferedPos(i,r,o){const d=this.schedule,p=this.bufferingItem;if(this.bufferedPos>i)return;if(r.length===1&&this.itemsMatch(r[0],p)){this.bufferedPos=i;return}const g=this.playingItem,y=this.findItemIndex(g);let v=d.findItemIndexAtTime(i);if(this.bufferedPos<i){var T,C;const I=this.findItemIndex(p),L=Math.min(I+1,r.length-1),N=r[L];if((v===-1&&p&&i>=p.end||(T=N.event)!=null&&T.appendInPlace&&i+.01>=N.start)&&(v=L),L-y>1&&(p==null||(C=p.event)==null?void 0:C.appendInPlace)===!1)return;if(this.bufferedPos=i,v>I&&v>y)this.bufferedToItem(N);else{const x=this.primaryDetails;this.primaryLive&&x&&i>x.edge-x.targetduration&&N.start<x.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(N)&&this.preloadAssets(N.event,0)}}else o&&g&&!this.itemsMatch(g,p)&&(v===y?this.bufferedToItem(g):v===y+1&&this.bufferedToItem(r[v]))}assetsBuffered(i,r){return i.event.assetList.length===0?!1:!i.event.assetList.some(d=>{const p=this.getAssetPlayer(d.identifier);return!(p!=null&&p.bufferedInPlaceToEnd(r))})}setBufferingItem(i){const r=this.bufferingItem,o=this.schedule;if(this.itemsMatch(i,r))this.bufferingItem!==i&&(this.bufferingItem=i);else{const{items:d,events:p}=o;if(!d||!p)return r;const g=this.isInterstitial(i),y=this.getBufferingPlayer();if(this.bufferingItem=i,this.bufferedPos=Math.max(i.start,Math.min(i.end,this.timelinePos)),!this.playbackDisabled){const v=y?y.remaining:r?r.end-this.timelinePos:0;this.log(`buffered to boundary ${of(i)}`+(r?` (${v.toFixed(2)} remaining)`:"")),g?i.event.assetList.forEach(T=>{const C=this.getAssetPlayer(T.identifier);C&&C.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(T=>T.pauseBuffering()))}this.hls.trigger(z.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:p.slice(0),schedule:d.slice(0),bufferingIndex:this.findItemIndex(i),playingIndex:this.findItemIndex(this.playingItem)})}return r}bufferedToItem(i,r=0){const o=this.setBufferingItem(i);if(!this.playbackDisabled){if(this.isInterstitial(i))this.bufferedToEvent(i,r);else if(o!==null){this.bufferingAsset=null;const d=this.detachedData;d?d.mediaSource?this.attachPrimary(i.start,i,!0):this.preloadPrimary(i):this.preloadPrimary(i)}}}preloadPrimary(i){const r=this.findItemIndex(i),o=this.getPrimaryResumption(i,r);this.startLoadingPrimaryAt(o)}bufferedToEvent(i,r){const o=i.event,d=o.assetList.length===0&&!o.assetListLoader,p=o.cue.once;if(d||!p){const g=this.preloadAssets(o,r);if(g!=null&&g.interstitial.appendInPlace){const y=o.assetList[r],v=this.primaryMedia;y&&v&&this.bufferAssetPlayer(g,v)}}}preloadAssets(i,r){const o=i.assetUrl,d=i.assetList.length,p=d===0&&!i.assetListLoader,g=i.cue.once;if(p){const v=i.timelineStart;if(i.appendInPlace){var y;const L=this.playingItem;!this.isInterstitial(L)&&(L==null||(y=L.nextEvent)==null?void 0:y.identifier)===i.identifier&&this.flushFrontBuffer(v+.25)}let T,C=0;if(!this.playingItem&&this.primaryLive&&(C=this.hls.startPosition,C===-1&&(C=this.hls.liveSyncPosition||0)),C&&!(i.cue.pre||i.cue.post)){const L=C-v;L>0&&(T=Math.round(L*1e3)/1e3)}if(this.log(`Load interstitial asset ${r+1}/${o?1:d} ${i}${T?` live-start: ${C} start-offset: ${T}`:""}`),o)return this.createAsset(i,0,0,v,i.duration,o);const I=this.assetListLoader.loadAssetList(i,T);I&&(i.assetListLoader=I)}else if(!g&&d){for(let v=r;v<d;v++){const T=i.assetList[v],C=this.getAssetPlayerQueueIndex(T.identifier);(C===-1||this.playerQueue[C].destroyed)&&!T.error&&this.createAssetPlayer(i,T,v)}return this.getAssetPlayer(i.assetList[r].identifier)}return null}flushFrontBuffer(i){const r=this.requiredTracks;if(!r)return;this.log(`Removing front buffer starting at ${i}`),Object.keys(r).forEach(d=>{this.hls.trigger(z.BUFFER_FLUSHING,{startOffset:i,endOffset:1/0,type:d})})}getAssetPlayerQueueIndex(i){const r=this.playerQueue;for(let o=0;o<r.length;o++)if(i===r[o].assetId)return o;return-1}getAssetPlayer(i){const r=this.getAssetPlayerQueueIndex(i);return this.playerQueue[r]||null}getBufferingPlayer(){const{playerQueue:i,primaryMedia:r}=this;if(r){for(let o=0;o<i.length;o++)if(i[o].media===r)return i[o]}return null}createAsset(i,r,o,d,p,g){const y={parentIdentifier:i.identifier,identifier:hie(i,g,r),duration:p,startOffset:o,timelineStart:d,uri:g};return this.createAssetPlayer(i,y,r)}createAssetPlayer(i,r,o){this.log(`create HLSAssetPlayer for ${JN(r)}`);const d=this.hls,p=d.userConfig;let g=p.videoPreference;const y=d.loadLevelObj||d.levels[d.currentLevel];(g||y)&&(g=Mi({},g),y.videoCodec&&(g.videoCodec=y.videoCodec),y.videoRange&&(g.allowedVideoRanges=[y.videoRange]));const v=d.audioTracks[d.audioTrack],T=d.subtitleTracks[d.subtitleTrack];let C=0;if(this.primaryLive||i.appendInPlace){const ee=this.timelinePos-r.timelineStart;if(ee>1){const pe=r.duration;pe&&ee<pe&&(C=ee)}}const I=r.identifier,L=Ii(Ii({},p),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:d.sessionId,assetPlayerId:I,abrEwmaDefaultEstimate:d.bandwidthEstimate,interstitialsController:void 0,startPosition:C,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:g,audioPreference:v||p.audioPreference,subtitlePreference:T||p.subtitlePreference});i.appendInPlace&&(i.appendInPlaceStarted=!0,r.timelineStart&&(L.timelineOffset=r.timelineStart));const N=L.cmcd;N!=null&&N.sessionId&&N.contentId&&(L.cmcd=Mi({},N,{contentId:sT(r.uri)})),this.getAssetPlayer(I)&&this.warn(`Duplicate date range identifier ${i} and asset ${I}`);const x=new mie(this.HlsPlayerClass,L,i,r);this.playerQueue.push(x),i.assetList[o]=r;const K=ee=>{if(ee.live){const be=new Error(`Interstitials MUST be VOD assets ${i}`),Se={fatal:!0,type:Gt.OTHER_ERROR,details:Ue.INTERSTITIAL_ASSET_ITEM_ERROR,error:be};this.handleAssetItemError(Se,i,this.schedule.findEventIndex(i.identifier),o,be.message);return}const pe=ee.edge-ee.fragmentStart,de=r.duration;(de===null||pe>de)&&(this.log(`Interstitial asset "${I}" duration change ${de} > ${pe}`),r.duration=pe,this.updateSchedule())};x.on(z.LEVEL_UPDATED,(ee,{details:pe})=>K(pe)),x.on(z.LEVEL_PTS_UPDATED,(ee,{details:pe})=>K(pe));const H=(ee,pe)=>{const de=this.getAssetPlayer(I);if(de&&pe.tracks){de.off(z.BUFFER_CODECS,H),de.tracks=pe.tracks;const be=this.primaryMedia;this.bufferingAsset===de.assetItem&&be&&!de.media&&this.bufferAssetPlayer(de,be)}};x.on(z.BUFFER_CODECS,H);const Q=()=>{var ee;const pe=this.getAssetPlayer(I);if(this.log(`buffered to end of asset ${pe}`),!pe)return;const de=this.schedule.findEventIndex(i.identifier),be=i.findAssetIndex(r),Se=be+1,Te=(ee=this.schedule.items)==null?void 0:ee[de];if(this.isInterstitial(Te))if(be!==-1&&!i.isAssetPastPlayoutLimit(Se)&&!i.assetList[Se].error)this.bufferedToItem(Te,Se);else{var _e;const he=(_e=this.schedule.items)==null?void 0:_e[de+1];he&&this.bufferedToItem(he)}};x.on(z.BUFFERED_TO_END,Q);const ne=ee=>()=>{if(!this.getAssetPlayer(I))return;this.shouldPlay=!0;const de=this.schedule.findEventIndex(i.identifier);this.advanceAfterAssetEnded(i,de,ee)};return x.once(z.MEDIA_ENDED,ne(o)),x.once(z.PLAYOUT_LIMIT_REACHED,ne(1/0)),x.on(z.ERROR,(ee,pe)=>{const de=this.getAssetPlayer(I);if(pe.details===Ue.BUFFER_STALLED_ERROR){if(de!=null&&de.media){const be=de.currentTime,Se=de.duration-be;be&&i.appendInPlace&&Se/de.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${I} ${i} at ${de.media.currentTime}`),Q()):(this.warn(`Stalled at ${be} of ${be+Se} in asset ${I} ${i}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(pe,i,this.schedule.findEventIndex(i.identifier),o,`Asset player error ${pe.error} ${i}`)}),x.on(z.DESTROYING,()=>{if(!this.getAssetPlayer(I))return;const pe=new Error(`Asset player destroyed unexpectedly ${I}`),de={fatal:!0,type:Gt.OTHER_ERROR,details:Ue.INTERSTITIAL_ASSET_ITEM_ERROR,error:pe};this.handleAssetItemError(de,i,this.schedule.findEventIndex(i.identifier),o,pe.message)}),this.hls.trigger(z.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:r,assetListIndex:o,event:i,player:x}),x}clearInterstitial(i,r){i.assetList.forEach(o=>{this.clearAssetPlayer(o.identifier,r)}),i.reset()}clearAssetPlayer(i,r){const o=this.getAssetPlayerQueueIndex(i);if(o!==-1){this.log(`clearAssetPlayer "${i}" toSegment: ${r&&of(r)}`);const d=this.playerQueue[o];this.transferMediaFromPlayer(d,r),this.playerQueue.splice(o,1),d.destroy()}}emptyPlayerQueue(){let i;for(;i=this.playerQueue.pop();)i.destroy();this.playerQueue=[]}startAssetPlayer(i,r,o,d,p){const{interstitial:g,assetItem:y,assetId:v}=i,T=g.assetList.length,C=this.playingAsset;this.endedAsset=null,this.playingAsset=y,(!C||C.identifier!==v)&&(C&&(this.clearAssetPlayer(C.identifier,o[d]),delete C.error),this.log(`INTERSTITIAL_ASSET_STARTED ${r+1}/${T} ${i}`),this.hls.trigger(z.INTERSTITIAL_ASSET_STARTED,{asset:y,assetListIndex:r,event:g,schedule:o.slice(0),scheduleIndex:d,player:i})),this.bufferAssetPlayer(i,p)}bufferAssetPlayer(i,r){var o,d;const{interstitial:p,assetItem:g,assetId:y}=i,v=this.schedule.findEventIndex(p.identifier),T=(o=this.schedule.items)==null?void 0:o[v];if(!T)return;this.setBufferingItem(T),this.bufferingAsset=g;const C=this.getBufferingPlayer();if(C===i)return;const I=p.appendInPlace;if(I&&(C==null?void 0:C.interstitial.appendInPlace)===!1)return;const L=(C==null?void 0:C.tracks)||((d=this.detachedData)==null?void 0:d.tracks)||this.requiredTracks;if(I&&g!==this.playingAsset){if(!i.tracks)return;if(L&&!JG(L,i.tracks)){const N=new Error(`Asset "${y}" SourceBuffer tracks ('${Object.keys(i.tracks)}') are not compatible with primary content tracks ('${Object.keys(L)}')`),x={fatal:!0,type:Gt.OTHER_ERROR,details:Ue.INTERSTITIAL_ASSET_ITEM_ERROR,error:N},K=p.findAssetIndex(g);this.handleAssetItemError(x,p,v,K,N.message);return}}this.transferMediaTo(i,r)}handleAssetItemError(i,r,o,d,p){if(i.details===Ue.BUFFER_STALLED_ERROR)return;const g=r.assetList[d]||null;let y=null;if(g){const I=this.getAssetPlayerQueueIndex(g.identifier);y=this.playerQueue[I]||null}const v=this.schedule.items,T=Mi({},i,{fatal:!1,errorAction:dT(!0),asset:g,assetListIndex:d,event:r,schedule:v,scheduleIndex:o,player:y});if(this.warn(`Asset item error: ${i.error}`),this.hls.trigger(z.INTERSTITIAL_ASSET_ERROR,T),!i.fatal)return;const C=new Error(p);g&&(this.playingAsset!==g&&this.clearAssetPlayer(g.identifier,null),g.error=C),r.assetList.some(I=>!I.error)?r.appendInPlace&&(r.error=C):r.error=C,this.primaryFallback(r)}primaryFallback(i){const r=i.timelineStart,o=this.effectivePlayingItem;if(this.updateSchedule(),o){this.log(`Fallback to primary from event "${i.identifier}" start: ${r} pos: ${this.timelinePos} playing: ${o?of(o):"<none>"} error: ${i.error}`),i.appendInPlace&&(this.attachPrimary(r,null),this.flushFrontBuffer(r));let d=this.timelinePos;d===-1&&(d=this.hls.startPosition);const p=this.updateItem(o,d);if(this.itemsMatch(o,p))this.clearInterstitial(i,null);else{const g=this.schedule.findItemIndexAtTime(d);this.setSchedulePosition(g)}}else this.checkStart()}onAssetListLoaded(i,r){var o;const d=r.event,p=d.identifier,g=r.assetListResponse.ASSETS;if(!this.schedule.hasEvent(p))return;const y=d.timelineStart,v=d.duration;let T=0;g.forEach((x,K)=>{const H=parseFloat(x.DURATION);this.createAsset(d,K,T,y+T,H,x.URI),T+=H}),d.duration=T,this.log(`Loaded asset-list with duration: ${T} (was: ${v}) ${d}`);const C=this.waitingItem,I=(C==null?void 0:C.event.identifier)===p;this.updateSchedule();const L=(o=this.bufferingItem)==null?void 0:o.event;if(I){var N;const x=this.schedule.findEventIndex(p),K=(N=this.schedule.items)==null?void 0:N[x];if(K){if(!this.playingItem&&this.timelinePos>K.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==x){d.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${d}`),this.primaryFallback(d);return}this.setBufferingItem(K)}this.setSchedulePosition(x)}else if((L==null?void 0:L.identifier)===p&&L.appendInPlace){const x=d.assetList[0],K=this.getAssetPlayer(x.identifier),H=this.primaryMedia;x&&K&&H&&this.bufferAssetPlayer(K,H)}}onError(i,r){switch(r.details){case Ue.ASSET_LIST_PARSING_ERROR:case Ue.ASSET_LIST_LOAD_ERROR:case Ue.ASSET_LIST_LOAD_TIMEOUT:{const o=r.interstitial;o&&this.primaryFallback(o);break}case Ue.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const F4=500;class Sie extends CL{constructor(i,r,o){super(i,r,o,"subtitle-stream-controller",Vt.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:i}=this;i.on(z.LEVEL_LOADED,this.onLevelLoaded,this),i.on(z.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(z.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.on(z.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(z.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.on(z.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:i}=this;i.off(z.LEVEL_LOADED,this.onLevelLoaded,this),i.off(z.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(z.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.off(z.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(z.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.off(z.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(i,r){this.stopLoad(),this.state=ot.IDLE,this.setInterval(F4),this.nextLoadPosition=this.lastCurrentTime=i+this.timelineOffset,this.startPosition=r?-1:i,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(i,r){this.tracksBuffered=[],super.onMediaDetaching(i,r)}onLevelLoaded(i,r){this.mainDetails=r.details}onSubtitleFragProcessed(i,r){const{frag:o,success:d}=r;if(Ar(o)&&(this.fragPrevious=o),this.state=ot.IDLE,!d)return;const p=this.tracksBuffered[this.currentTrackId];if(!p)return;let g;const y=o.start;for(let T=0;T<p.length;T++)if(y>=p[T].start&&y<=p[T].end){g=p[T];break}const v=o.start+o.duration;g?g.end=v:(g={start:y,end:v},p.push(g)),this.fragmentTracker.fragBuffered(o),this.fragBufferedComplete(o,null),this.media&&this.tick()}onBufferFlushing(i,r){const{startOffset:o,endOffset:d}=r;if(o===0&&d!==Number.POSITIVE_INFINITY){const p=d-1;if(p<=0)return;r.endOffsetSubtitles=Math.max(0,p),this.tracksBuffered.forEach(g=>{for(let y=0;y<g.length;){if(g[y].end<=p){g.shift();continue}else if(g[y].start<p)g[y].start=p;else break;y++}}),this.fragmentTracker.removeFragmentsInRange(o,p,Vt.SUBTITLE)}}onError(i,r){const o=r.frag;(o==null?void 0:o.type)===Vt.SUBTITLE&&(r.details===Ue.FRAG_GAP&&this.fragmentTracker.fragBuffered(o,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ot.STOPPED&&(this.state=ot.IDLE))}onSubtitleTracksUpdated(i,{subtitleTracks:r}){if(this.levels&&X5(this.levels,r)){this.levels=r.map(o=>new lT(o));return}this.tracksBuffered=[],this.levels=r.map(o=>{const d=new lT(o);return this.tracksBuffered[d.id]=[],d}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Vt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(i,r){var o;if(this.currentTrackId=r.id,!((o=this.levels)!=null&&o.length)||this.currentTrackId===-1){this.clearInterval();return}const d=this.levels[this.currentTrackId];d!=null&&d.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,d&&this.state!==ot.STOPPED&&this.setInterval(F4)}onSubtitleTrackLoaded(i,r){var o;const{currentTrackId:d,levels:p}=this,{details:g,id:y}=r;if(!p){this.warn(`Subtitle tracks were reset while loading level ${y}`);return}const v=p[y];if(y>=p.length||!v)return;this.log(`Subtitle track ${y} loaded [${g.startSN},${g.endSN}]${g.lastPartSn?`[part-${g.lastPartSn}-${g.lastPartIndex}]`:""},duration:${g.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let T=0;if(g.live||(o=v.details)!=null&&o.live){const I=this.mainDetails;if(g.deltaUpdateFailed||!I)return;const L=I.fragments[0];if(!v.details)g.hasProgramDateTime&&I.hasProgramDateTime?(fC(g,I),T=g.fragmentStart):L&&(T=L.start,KN(g,T));else{var C;T=this.alignPlaylists(g,v.details,(C=this.levelLastLoaded)==null?void 0:C.details),T===0&&L&&(T=L.start,KN(g,T))}}v.details=g,this.levelLastLoaded=v,y===d&&(this.hls.trigger(z.SUBTITLE_TRACK_UPDATED,{details:g,id:y,groupId:r.groupId}),this.tick(),g.live&&!this.fragCurrent&&this.media&&this.state===ot.IDLE&&(xm(null,g.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),v.details=void 0)))}_handleFragmentLoadComplete(i){const{frag:r,payload:o}=i,d=r.decryptdata,p=this.hls;if(!this.fragContextChanged(r)&&o&&o.byteLength>0&&d!=null&&d.key&&d.iv&&C_(d.method)){const g=performance.now();this.decrypter.decrypt(new Uint8Array(o),d.key.buffer,d.iv.buffer,RL(d.method)).catch(y=>{throw p.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.FRAG_DECRYPT_ERROR,fatal:!1,error:y,reason:y.message,frag:r}),y}).then(y=>{const v=performance.now();p.trigger(z.FRAG_DECRYPTED,{frag:r,payload:y,stats:{tstart:g,tdecrypt:v}})}).catch(y=>{this.warn(`${y.name}: ${y.message}`),this.state=ot.IDLE})}}doTick(){if(!this.media){this.state=ot.IDLE;return}if(this.state===ot.IDLE){const{currentTrackId:i,levels:r}=this,o=r==null?void 0:r[i];if(!o||!r.length||!o.details||this.waitForLive(o))return;const{config:d}=this,p=this.getLoadPosition(),g=Dn.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],p,d.maxBufferHole),{end:y,len:v}=g,T=o.details,C=this.hls.maxBufferLength+T.levelTargetDuration;if(v>C)return;const I=T.fragments,L=I.length,N=T.edge;let x=null;const K=this.fragPrevious;if(y<N){const ne=d.maxFragLookUpTolerance,ee=y>N-ne?0:ne;x=xm(K,I,Math.max(I[0].start,y),ee),!x&&K&&K.start<I[0].start&&(x=I[0])}else x=I[L-1];if(x=this.filterReplacedPrimary(x,o.details),!x)return;const H=x.sn-T.startSN,Q=I[H-1];if(Q&&Q.cc===x.cc&&this.fragmentTracker.getState(Q)===cr.NOT_LOADED&&(x=Q),this.fragmentTracker.getState(x)===cr.NOT_LOADED){const ne=this.mapToInitFragWhenRequired(x);ne&&this.loadFragment(ne,o,y)}}}loadFragment(i,r,o){Ar(i)?super.loadFragment(i,r,o):this._loadInitSegment(i,r)}get mediaBufferTimeRanges(){return new yie(this.tracksBuffered[this.currentTrackId]||[])}}class yie{constructor(i){this.buffered=void 0;const r=(o,d,p)=>{if(d=d>>>0,d>p-1)throw new DOMException(`Failed to execute '${o}' on 'TimeRanges': The index provided (${d}) is greater than the maximum bound (${p})`);return i[d][o]};this.buffered={get length(){return i.length},end(o){return r("end",o,i.length)},start(o){return r("start",o,i.length)}}}}const Tie={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},a6=h=>String.fromCharCode(Tie[h]||h),sl=15,Tu=100,vie={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},bie={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Rie={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Aie={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Cie=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Iie{constructor(){this.time=null,this.verboseLevel=0}log(i,r){if(this.verboseLevel>=i){const o=typeof r=="function"?r():r;Zn.log(`${this.time} [${i}] ${o}`)}}}const Cm=function(i){const r=[];for(let o=0;o<i.length;o++)r.push(i[o].toString(16));return r};class o6{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(i){const r=["foreground","underline","italics","background","flash"];for(let o=0;o<r.length;o++){const d=r[o];i.hasOwnProperty(d)&&(this[d]=i[d])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(i){return this.foreground===i.foreground&&this.underline===i.underline&&this.italics===i.italics&&this.background===i.background&&this.flash===i.flash}copy(i){this.foreground=i.foreground,this.underline=i.underline,this.italics=i.italics,this.background=i.background,this.flash=i.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class wie{constructor(){this.uchar=" ",this.penState=new o6}reset(){this.uchar=" ",this.penState.reset()}setChar(i,r){this.uchar=i,this.penState.copy(r)}setPenState(i){this.penState.copy(i)}equals(i){return this.uchar===i.uchar&&this.penState.equals(i.penState)}copy(i){this.uchar=i.uchar,this.penState.copy(i.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Oie{constructor(i){this.chars=[],this.pos=0,this.currPenState=new o6,this.cueStartTime=null,this.logger=void 0;for(let r=0;r<Tu;r++)this.chars.push(new wie);this.logger=i}equals(i){for(let r=0;r<Tu;r++)if(!this.chars[r].equals(i.chars[r]))return!1;return!0}copy(i){for(let r=0;r<Tu;r++)this.chars[r].copy(i.chars[r])}isEmpty(){let i=!0;for(let r=0;r<Tu;r++)if(!this.chars[r].isEmpty()){i=!1;break}return i}setCursor(i){this.pos!==i&&(this.pos=i),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Tu&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Tu)}moveCursor(i){const r=this.pos+i;if(i>1)for(let o=this.pos+1;o<r+1;o++)this.chars[o].setPenState(this.currPenState);this.setCursor(r)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(i){i>=144&&this.backSpace();const r=a6(i);if(this.pos>=Tu){this.logger.log(0,()=>"Cannot insert "+i.toString(16)+" ("+r+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1)}clearFromPos(i){let r;for(r=i;r<Tu;r++)this.chars[r].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const i=[];let r=!0;for(let o=0;o<Tu;o++){const d=this.chars[o].uchar;d!==" "&&(r=!1),i.push(d)}return r?"":i.join("")}setPenStyles(i){this.currPenState.setStyles(i),this.chars[this.pos].setPenState(this.currPenState)}}class _N{constructor(i){this.rows=[],this.currRow=sl-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let r=0;r<sl;r++)this.rows.push(new Oie(i));this.logger=i}reset(){for(let i=0;i<sl;i++)this.rows[i].clear();this.currRow=sl-1}equals(i){let r=!0;for(let o=0;o<sl;o++)if(!this.rows[o].equals(i.rows[o])){r=!1;break}return r}copy(i){for(let r=0;r<sl;r++)this.rows[r].copy(i.rows[r])}isEmpty(){let i=!0;for(let r=0;r<sl;r++)if(!this.rows[r].isEmpty()){i=!1;break}return i}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(i){this.rows[this.currRow].insertChar(i)}setPen(i){this.rows[this.currRow].setPenStyles(i)}moveCursor(i){this.rows[this.currRow].moveCursor(i)}setCursor(i){this.logger.log(2,"setCursor: "+i),this.rows[this.currRow].setCursor(i)}setPAC(i){this.logger.log(2,()=>"pacData = "+ds(i));let r=i.row-1;if(this.nrRollUpRows&&r<this.nrRollUpRows-1&&(r=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==r){for(let y=0;y<sl;y++)this.rows[y].clear();const p=this.currRow+1-this.nrRollUpRows,g=this.lastOutputScreen;if(g){const y=g.rows[p].cueStartTime,v=this.logger.time;if(y!==null&&v!==null&&y<v)for(let T=0;T<this.nrRollUpRows;T++)this.rows[r-this.nrRollUpRows+T+1].copy(g.rows[p+T])}}this.currRow=r;const o=this.rows[this.currRow];if(i.indent!==null){const p=i.indent,g=Math.max(p-1,0);o.setCursor(i.indent),i.color=o.chars[g].penState.foreground}const d={foreground:i.color,underline:i.underline,italics:i.italics,background:"black",flash:!1};this.setPen(d)}setBkgData(i){this.logger.log(2,()=>"bkgData = "+ds(i)),this.backSpace(),this.setPen(i),this.insertChar(32)}setRollUpRows(i){this.nrRollUpRows=i}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const i=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(i,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),this.logger.log(2,"Rolling up")}getDisplayText(i){i=i||!1;const r=[];let o="",d=-1;for(let p=0;p<sl;p++){const g=this.rows[p].getTextString();g&&(d=p+1,i?r.push("Row "+d+": '"+g+"'"):r.push(g.trim()))}return r.length>0&&(i?o="["+r.join(" | ")+"]":o=r.join(`
`)),o}getTextAndFormat(){return this.rows}}class B4{constructor(i,r,o){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=i,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new _N(o),this.nonDisplayedMemory=new _N(o),this.lastOutputScreen=new _N(o),this.currRollUpRow=this.displayedMemory.rows[sl-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=o}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[sl-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(i){this.outputFilter=i}setPAC(i){this.writeScreen.setPAC(i)}setBkgData(i){this.writeScreen.setBkgData(i)}setMode(i){i!==this.mode&&(this.mode=i,this.logger.log(2,()=>"MODE="+i),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=i)}insertChars(i){for(let o=0;o<i.length;o++)this.writeScreen.insertChar(i[o]);const r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>r+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(i){this.logger.log(2,"RU("+i+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(i)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const i=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=i,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(i){this.logger.log(2,"TO("+i+") - Tab Offset"),this.writeScreen.moveCursor(i)}ccMIDROW(i){const r={flash:!1};if(r.underline=i%2===1,r.italics=i>=46,r.italics)r.foreground="white";else{const o=Math.floor(i/2)-16,d=["white","green","blue","cyan","red","yellow","magenta"];r.foreground=d[o]}this.logger.log(2,"MIDROW: "+ds(r)),this.writeScreen.setPen(r)}outputDataUpdate(i=!1){const r=this.logger.time;r!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=r:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,r,this.lastOutputScreen),i&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:r),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(i){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,i,this.displayedMemory),this.cueStartTime=i))}}class V4{constructor(i,r,o){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Nie(),this.logger=void 0;const d=this.logger=new Iie;this.channels=[null,new B4(i,r,d),new B4(i+1,o,d)]}getHandler(i){return this.channels[i].getHandler()}setHandler(i,r){this.channels[i].setHandler(r)}addData(i,r){this.logger.time=i;for(let o=0;o<r.length;o+=2){const d=r[o]&127,p=r[o+1]&127;let g=!1,y=null;if(d===0&&p===0)continue;this.logger.log(3,()=>"["+Cm([r[o],r[o+1]])+"] -> ("+Cm([d,p])+")");const v=this.cmdHistory;if(d>=16&&d<=31){if(Die(d,p,v)){kA(null,null,v),this.logger.log(3,()=>"Repeated command ("+Cm([d,p])+") is dropped");continue}kA(d,p,this.cmdHistory),g=this.parseCmd(d,p),g||(g=this.parseMidrow(d,p)),g||(g=this.parsePAC(d,p)),g||(g=this.parseBackgroundAttributes(d,p))}else kA(null,null,v);if(!g&&(y=this.parseChars(d,p),y)){const C=this.currentChannel;C&&C>0?this.channels[C].insertChars(y):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!g&&!y&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Cm([d,p])+" orig: "+Cm([r[o],r[o+1]]))}}parseCmd(i,r){const o=(i===20||i===28||i===21||i===29)&&r>=32&&r<=47,d=(i===23||i===31)&&r>=33&&r<=35;if(!(o||d))return!1;const p=i===20||i===21||i===23?1:2,g=this.channels[p];return i===20||i===21||i===28||i===29?r===32?g.ccRCL():r===33?g.ccBS():r===34?g.ccAOF():r===35?g.ccAON():r===36?g.ccDER():r===37?g.ccRU(2):r===38?g.ccRU(3):r===39?g.ccRU(4):r===40?g.ccFON():r===41?g.ccRDC():r===42?g.ccTR():r===43?g.ccRTD():r===44?g.ccEDM():r===45?g.ccCR():r===46?g.ccENM():r===47&&g.ccEOC():g.ccTO(r-32),this.currentChannel=p,!0}parseMidrow(i,r){let o=0;if((i===17||i===25)&&r>=32&&r<=47){if(i===17?o=1:o=2,o!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const d=this.channels[o];return d?(d.ccMIDROW(r),this.logger.log(3,()=>"MIDROW ("+Cm([i,r])+")"),!0):!1}return!1}parsePAC(i,r){let o;const d=(i>=17&&i<=23||i>=25&&i<=31)&&r>=64&&r<=127,p=(i===16||i===24)&&r>=64&&r<=95;if(!(d||p))return!1;const g=i<=23?1:2;r>=64&&r<=95?o=g===1?vie[i]:Rie[i]:o=g===1?bie[i]:Aie[i];const y=this.channels[g];return y?(y.setPAC(this.interpretPAC(o,r)),this.currentChannel=g,!0):!1}interpretPAC(i,r){let o;const d={color:null,italics:!1,indent:null,underline:!1,row:i};return r>95?o=r-96:o=r-64,d.underline=(o&1)===1,o<=13?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(o/2)]:o<=15?(d.italics=!0,d.color="white"):d.indent=Math.floor((o-16)/2)*4,d}parseChars(i,r){let o,d=null,p=null;if(i>=25?(o=2,p=i-8):(o=1,p=i),p>=17&&p<=19){let g;p===17?g=r+80:p===18?g=r+112:g=r+144,this.logger.log(2,()=>"Special char '"+a6(g)+"' in channel "+o),d=[g]}else i>=32&&i<=127&&(d=r===0?[i]:[i,r]);return d&&this.logger.log(3,()=>"Char codes =  "+Cm(d).join(",")),d}parseBackgroundAttributes(i,r){const o=(i===16||i===24)&&r>=32&&r<=47,d=(i===23||i===31)&&r>=45&&r<=47;if(!(o||d))return!1;let p;const g={};i===16||i===24?(p=Math.floor((r-32)/2),g.background=Cie[p],r%2===1&&(g.background=g.background+"_semi")):r===45?g.background="transparent":(g.foreground="black",r===47&&(g.underline=!0));const y=i<=23?1:2;return this.channels[y].setBkgData(g),!0}reset(){for(let i=0;i<Object.keys(this.channels).length;i++){const r=this.channels[i];r&&r.reset()}kA(null,null,this.cmdHistory)}cueSplitAtTime(i){for(let r=0;r<this.channels.length;r++){const o=this.channels[r];o&&o.cueSplitAtTime(i)}}}function kA(h,i,r){r.a=h,r.b=i}function Die(h,i,r){return r.a===h&&r.b===i}function Nie(){return{a:null,b:null}}var UL=function(){if(hC!=null&&hC.VTTCue)return self.VTTCue;const h=["","lr","rl"],i=["start","middle","end","left","right"];function r(y,v){if(typeof v!="string"||!Array.isArray(y))return!1;const T=v.toLowerCase();return~y.indexOf(T)?T:!1}function o(y){return r(h,y)}function d(y){return r(i,y)}function p(y,...v){let T=1;for(;T<arguments.length;T++){const C=arguments[T];for(const I in C)y[I]=C[I]}return y}function g(y,v,T){const C=this,I={enumerable:!0};C.hasBeenReset=!1;let L="",N=!1,x=y,K=v,H=T,Q=null,ne="",ee=!0,pe="auto",de="start",be=50,Se="middle",Te=50,_e="middle";Object.defineProperty(C,"id",p({},I,{get:function(){return L},set:function(he){L=""+he}})),Object.defineProperty(C,"pauseOnExit",p({},I,{get:function(){return N},set:function(he){N=!!he}})),Object.defineProperty(C,"startTime",p({},I,{get:function(){return x},set:function(he){if(typeof he!="number")throw new TypeError("Start time must be set to a number.");x=he,this.hasBeenReset=!0}})),Object.defineProperty(C,"endTime",p({},I,{get:function(){return K},set:function(he){if(typeof he!="number")throw new TypeError("End time must be set to a number.");K=he,this.hasBeenReset=!0}})),Object.defineProperty(C,"text",p({},I,{get:function(){return H},set:function(he){H=""+he,this.hasBeenReset=!0}})),Object.defineProperty(C,"region",p({},I,{get:function(){return Q},set:function(he){Q=he,this.hasBeenReset=!0}})),Object.defineProperty(C,"vertical",p({},I,{get:function(){return ne},set:function(he){const Ge=o(he);if(Ge===!1)throw new SyntaxError("An invalid or illegal string was specified.");ne=Ge,this.hasBeenReset=!0}})),Object.defineProperty(C,"snapToLines",p({},I,{get:function(){return ee},set:function(he){ee=!!he,this.hasBeenReset=!0}})),Object.defineProperty(C,"line",p({},I,{get:function(){return pe},set:function(he){if(typeof he!="number"&&he!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");pe=he,this.hasBeenReset=!0}})),Object.defineProperty(C,"lineAlign",p({},I,{get:function(){return de},set:function(he){const Ge=d(he);if(!Ge)throw new SyntaxError("An invalid or illegal string was specified.");de=Ge,this.hasBeenReset=!0}})),Object.defineProperty(C,"position",p({},I,{get:function(){return be},set:function(he){if(he<0||he>100)throw new Error("Position must be between 0 and 100.");be=he,this.hasBeenReset=!0}})),Object.defineProperty(C,"positionAlign",p({},I,{get:function(){return Se},set:function(he){const Ge=d(he);if(!Ge)throw new SyntaxError("An invalid or illegal string was specified.");Se=Ge,this.hasBeenReset=!0}})),Object.defineProperty(C,"size",p({},I,{get:function(){return Te},set:function(he){if(he<0||he>100)throw new Error("Size must be between 0 and 100.");Te=he,this.hasBeenReset=!0}})),Object.defineProperty(C,"align",p({},I,{get:function(){return _e},set:function(he){const Ge=d(he);if(!Ge)throw new SyntaxError("An invalid or illegal string was specified.");_e=Ge,this.hasBeenReset=!0}})),C.displayState=void 0}return g.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},g}();class Lie{decode(i,r){if(!i)return"";if(typeof i!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(i))}}function c6(h){function i(o,d,p,g){return(o|0)*3600+(d|0)*60+(p|0)+parseFloat(g||0)}const r=h.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?i(r[2],r[3],0,r[4]):i(r[1],r[2],r[3],r[4]):null}class xie{constructor(){this.values=Object.create(null)}set(i,r){!this.get(i)&&r!==""&&(this.values[i]=r)}get(i,r,o){return o?this.has(i)?this.values[i]:r[o]:this.has(i)?this.values[i]:r}has(i){return i in this.values}alt(i,r,o){for(let d=0;d<o.length;++d)if(r===o[d]){this.set(i,r);break}}integer(i,r){/^-?\d+$/.test(r)&&this.set(i,parseInt(r,10))}percent(i,r){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(r)){const o=parseFloat(r);if(o>=0&&o<=100)return this.set(i,o),!0}return!1}}function l6(h,i,r,o){const d=o?h.split(o):[h];for(const p in d){if(typeof d[p]!="string")continue;const g=d[p].split(r);if(g.length!==2)continue;const y=g[0],v=g[1];i(y,v)}}const QN=new UL(0,0,""),MA=QN.align==="middle"?"middle":"center";function Pie(h,i,r){const o=h;function d(){const y=c6(h);if(y===null)throw new Error("Malformed timestamp: "+o);return h=h.replace(/^[^\sa-zA-Z-]+/,""),y}function p(y,v){const T=new xie;l6(y,function(L,N){let x;switch(L){case"region":for(let K=r.length-1;K>=0;K--)if(r[K].id===N){T.set(L,r[K].region);break}break;case"vertical":T.alt(L,N,["rl","lr"]);break;case"line":x=N.split(","),T.integer(L,x[0]),T.percent(L,x[0])&&T.set("snapToLines",!1),T.alt(L,x[0],["auto"]),x.length===2&&T.alt("lineAlign",x[1],["start",MA,"end"]);break;case"position":x=N.split(","),T.percent(L,x[0]),x.length===2&&T.alt("positionAlign",x[1],["start",MA,"end","line-left","line-right","auto"]);break;case"size":T.percent(L,N);break;case"align":T.alt(L,N,["start",MA,"end","left","right"]);break}},/:/,/\s/),v.region=T.get("region",null),v.vertical=T.get("vertical","");let C=T.get("line","auto");C==="auto"&&QN.line===-1&&(C=-1),v.line=C,v.lineAlign=T.get("lineAlign","start"),v.snapToLines=T.get("snapToLines",!0),v.size=T.get("size",100),v.align=T.get("align",MA);let I=T.get("position","auto");I==="auto"&&QN.position===50&&(I=v.align==="start"||v.align==="left"?0:v.align==="end"||v.align==="right"?100:50),v.position=I}function g(){h=h.replace(/^\s+/,"")}if(g(),i.startTime=d(),g(),h.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+o);h=h.slice(3),g(),i.endTime=d(),g(),p(h,i)}function d6(h){return h.replace(/<br(?: \/)?>/gi,`
`)}class kie{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Lie,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(i){const r=this;i&&(r.buffer+=r.decoder.decode(i,{stream:!0}));function o(){let p=r.buffer,g=0;for(p=d6(p);g<p.length&&p[g]!=="\r"&&p[g]!==`
`;)++g;const y=p.slice(0,g);return p[g]==="\r"&&++g,p[g]===`
`&&++g,r.buffer=p.slice(g),y}function d(p){l6(p,function(g,y){},/:/)}try{let p="";if(r.state==="INITIAL"){if(!/\r\n|\n/.test(r.buffer))return this;p=o();const y=p.match(/^()?WEBVTT([ \t].*)?$/);if(!(y!=null&&y[0]))throw new Error("Malformed WebVTT signature.");r.state="HEADER"}let g=!1;for(;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(g?g=!1:p=o(),r.state){case"HEADER":/:/.test(p)?d(p):p||(r.state="ID");continue;case"NOTE":p||(r.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(p)){r.state="NOTE";break}if(!p)continue;if(r.cue=new UL(0,0,""),r.state="CUE",p.indexOf("-->")===-1){r.cue.id=p;continue}case"CUE":if(!r.cue){r.state="BADCUE";continue}try{Pie(p,r.cue,r.regionList)}catch{r.cue=null,r.state="BADCUE";continue}r.state="CUETEXT";continue;case"CUETEXT":{const y=p.indexOf("-->")!==-1;if(!p||y&&(g=!0)){r.oncue&&r.cue&&r.oncue(r.cue),r.cue=null,r.state="ID";continue}if(r.cue===null)continue;r.cue.text&&(r.cue.text+=`
`),r.cue.text+=p}continue;case"BADCUE":p||(r.state="ID")}}}catch{r.state==="CUETEXT"&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state=r.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const i=this;try{if((i.cue||i.state==="HEADER")&&(i.buffer+=`

`,i.parse()),i.state==="INITIAL"||i.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(r){i.onparsingerror&&i.onparsingerror(r)}return i.onflush&&i.onflush(),this}}const Mie=/\r\n|\n\r|\n|\r/g,SN=function(i,r,o=0){return i.slice(o,o+r.length)===r},Uie=function(i){let r=parseInt(i.slice(-3));const o=parseInt(i.slice(-6,-4)),d=parseInt(i.slice(-9,-7)),p=i.length>9?parseInt(i.substring(0,i.indexOf(":"))):0;if(!xt(r)||!xt(o)||!xt(d)||!xt(p))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${i}`);return r+=1e3*o,r+=60*1e3*d,r+=60*60*1e3*p,r};function FL(h,i,r){return sT(h.toString())+sT(i.toString())+sT(r)}const Fie=function(i,r,o){let d=i[r],p=i[d.prevCC];if(!p||!p.new&&d.new){i.ccOffset=i.presentationOffset=d.start,d.new=!1;return}for(;(g=p)!=null&&g.new;){var g;i.ccOffset+=d.start-p.start,d.new=!1,d=p,p=i[d.prevCC]}i.presentationOffset=o};function Bie(h,i,r,o,d,p,g){const y=new kie,v=So(new Uint8Array(h)).trim().replace(Mie,`
`).split(`
`),T=[],C=i?ine(i.baseTime,i.timescale):0;let I="00:00.000",L=0,N=0,x,K=!0;y.oncue=function(H){const Q=r[o];let ne=r.ccOffset;const ee=(L-C)/9e4;if(Q!=null&&Q.new&&(N!==void 0?ne=r.ccOffset=Q.start:Fie(r,o,ee)),ee){if(!i){x=new Error("Missing initPTS for VTT MPEGTS");return}ne=ee-r.presentationOffset}const pe=H.endTime-H.startTime,de=lc((H.startTime+ne-N)*9e4,d*9e4)/9e4;H.startTime=Math.max(de,0),H.endTime=Math.max(de+pe,0);const be=H.text.trim();H.text=decodeURIComponent(encodeURIComponent(be)),H.id||(H.id=FL(H.startTime,H.endTime,be)),H.endTime>0&&T.push(H)},y.onparsingerror=function(H){x=H},y.onflush=function(){if(x){g(x);return}p(T)},v.forEach(H=>{if(K)if(SN(H,"X-TIMESTAMP-MAP=")){K=!1,H.slice(16).split(",").forEach(Q=>{SN(Q,"LOCAL:")?I=Q.slice(6):SN(Q,"MPEGTS:")&&(L=parseInt(Q.slice(7)))});try{N=Uie(I)/1e3}catch(Q){x=Q}return}else H===""&&(K=!1);y.parse(H+`
`)}),y.flush()}const yN="stpp.ttml.im1t",u6=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,h6=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Vie={left:"start",center:"center",right:"end",start:"start",end:"end"};function j4(h,i,r,o){const d=yn(new Uint8Array(h),["mdat"]);if(d.length===0){o(new Error("Could not parse IMSC1 mdat"));return}const p=d.map(y=>So(y)),g=nne(i.baseTime,1,i.timescale);try{p.forEach(y=>r(jie(y,g)))}catch(y){o(y)}}function jie(h,i){const d=new DOMParser().parseFromString(h,"text/xml").getElementsByTagName("tt")[0];if(!d)throw new Error("Invalid ttml");const p={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},g=Object.keys(p).reduce((I,L)=>(I[L]=d.getAttribute(`ttp:${L}`)||p[L],I),{}),y=d.getAttribute("xml:space")!=="preserve",v=G4(TN(d,"styling","style")),T=G4(TN(d,"layout","region")),C=TN(d,"body","[begin]");return[].map.call(C,I=>{const L=f6(I,y);if(!L||!I.hasAttribute("begin"))return null;const N=bN(I.getAttribute("begin"),g),x=bN(I.getAttribute("dur"),g);let K=bN(I.getAttribute("end"),g);if(N===null)throw H4(I);if(K===null){if(x===null)throw H4(I);K=N+x}const H=new UL(N-i,K-i,L);H.id=FL(H.startTime,H.endTime,H.text);const Q=T[I.getAttribute("region")],ne=v[I.getAttribute("style")],ee=Gie(Q,ne,v),{textAlign:pe}=ee;if(pe){const de=Vie[pe];de&&(H.lineAlign=de),H.align=pe}return Mi(H,ee),H}).filter(I=>I!==null)}function TN(h,i,r){const o=h.getElementsByTagName(i)[0];return o?[].slice.call(o.querySelectorAll(r)):[]}function G4(h){return h.reduce((i,r)=>{const o=r.getAttribute("xml:id");return o&&(i[o]=r),i},{})}function f6(h,i){return[].slice.call(h.childNodes).reduce((r,o,d)=>{var p;return o.nodeName==="br"&&d?r+`
`:(p=o.childNodes)!=null&&p.length?f6(o,i):i?r+o.textContent.trim().replace(/\s+/g," "):r+o.textContent},"")}function Gie(h,i,r){const o="http://www.w3.org/ns/ttml#styling";let d=null;const p=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],g=h!=null&&h.hasAttribute("style")?h.getAttribute("style"):null;return g&&r.hasOwnProperty(g)&&(d=r[g]),p.reduce((y,v)=>{const T=vN(i,o,v)||vN(h,o,v)||vN(d,o,v);return T&&(y[v]=T),y},{})}function vN(h,i,r){return h&&h.hasAttributeNS(i,r)?h.getAttributeNS(i,r):null}function H4(h){return new Error(`Could not parse ttml timestamp ${h}`)}function bN(h,i){if(!h)return null;let r=c6(h);return r===null&&(u6.test(h)?r=Hie(h,i):h6.test(h)&&(r=Kie(h,i))),r}function Hie(h,i){const r=u6.exec(h),o=(r[4]|0)+(r[5]|0)/i.subFrameRate;return(r[1]|0)*3600+(r[2]|0)*60+(r[3]|0)+o/i.frameRate}function Kie(h,i){const r=h6.exec(h),o=Number(r[1]);switch(r[2]){case"h":return o*3600;case"m":return o*60;case"ms":return o*1e3;case"f":return o/i.frameRate;case"t":return o/i.tickRate}return o}class UA{constructor(i,r){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=i,this.trackName=r}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(i,r,o){(this.startTime===null||this.startTime>i)&&(this.startTime=i),this.endTime=r,this.screen=o,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class Wie{constructor(i){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=W4(),this.captionsProperties=void 0,this.hls=i,this.config=i.config,this.Cues=i.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},i.on(z.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(z.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(z.FRAG_LOADING,this.onFragLoading,this),i.on(z.FRAG_LOADED,this.onFragLoaded,this),i.on(z.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),i.on(z.FRAG_DECRYPTED,this.onFragDecrypted,this),i.on(z.INIT_PTS_FOUND,this.onInitPtsFound,this),i.on(z.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),i.on(z.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:i}=this;i.off(z.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(z.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(z.FRAG_LOADING,this.onFragLoading,this),i.off(z.FRAG_LOADED,this.onFragLoaded,this),i.off(z.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),i.off(z.FRAG_DECRYPTED,this.onFragDecrypted,this),i.off(z.INIT_PTS_FOUND,this.onInitPtsFound,this),i.off(z.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),i.off(z.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const i=new UA(this,"textTrack1"),r=new UA(this,"textTrack2"),o=new UA(this,"textTrack3"),d=new UA(this,"textTrack4");this.cea608Parser1=new V4(1,i,r),this.cea608Parser2=new V4(3,o,d)}addCues(i,r,o,d,p){let g=!1;for(let y=p.length;y--;){const v=p[y],T=Yie(v[0],v[1],r,o);if(T>=0&&(v[0]=Math.min(v[0],r),v[1]=Math.max(v[1],o),g=!0,T/(o-r)>.5))return}if(g||p.push([r,o]),this.config.renderTextTracksNatively){const y=this.captionsTracks[i];this.Cues.newCue(y,r,o,d)}else{const y=this.Cues.newCue(null,r,o,d);this.hls.trigger(z.CUES_PARSED,{type:"captions",cues:y,track:i})}}onInitPtsFound(i,{frag:r,id:o,initPTS:d,timescale:p}){const{unparsedVttFrags:g}=this;o===Vt.MAIN&&(this.initPTS[r.cc]={baseTime:d,timescale:p}),g.length&&(this.unparsedVttFrags=[],g.forEach(y=>{this.onFragLoaded(z.FRAG_LOADED,y)}))}getExistingTrack(i,r){const{media:o}=this;if(o)for(let d=0;d<o.textTracks.length;d++){const p=o.textTracks[d];if(K4(p,{name:i,lang:r,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return p}return null}createCaptionsTrack(i){this.config.renderTextTracksNatively?this.createNativeTrack(i):this.createNonNativeTrack(i)}createNativeTrack(i){if(this.captionsTracks[i])return;const{captionsProperties:r,captionsTracks:o,media:d}=this,{label:p,languageCode:g}=r[i],y=this.getExistingTrack(p,g);if(y)o[i]=y,A_(o[i]),i6(o[i],d);else{const v=this.createTextTrack("captions",p,g);v&&(v[i]=!0,o[i]=v)}}createNonNativeTrack(i){if(this.nonNativeCaptionsTracks[i])return;const r=this.captionsProperties[i];if(!r)return;const o=r.label,d={_id:i,label:o,kind:"captions",default:r.media?!!r.media.default:!1,closedCaptions:r.media};this.nonNativeCaptionsTracks[i]=d,this.hls.trigger(z.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[d]})}createTextTrack(i,r,o){const d=this.media;if(d)return d.addTextTrack(i,r,o)}onMediaAttaching(i,r){this.media=r.media,r.mediaSource||this._cleanTracks()}onMediaDetaching(i,r){const o=!!r.transferMedia;if(this.media=null,o)return;const{captionsTracks:d}=this;Object.keys(d).forEach(p=>{A_(d[p]),delete d[p]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=W4(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:i}=this;if(!i)return;const r=i.textTracks;if(r)for(let o=0;o<r.length;o++)A_(r[o])}onSubtitleTracksUpdated(i,r){const o=r.subtitleTracks||[],d=o.some(p=>p.textCodec===yN);if(this.config.enableWebVTT||d&&this.config.enableIMSC1){if(X5(this.tracks,o)){this.tracks=o;return}if(this.textTracks=[],this.tracks=o,this.config.renderTextTracksNatively){const g=this.media,y=g?QA(g.textTracks):null;if(this.tracks.forEach((v,T)=>{let C;if(y){let I=null;for(let L=0;L<y.length;L++)if(y[L]&&K4(y[L],v)){I=y[L],y[L]=null;break}I&&(C=I)}if(C)A_(C);else{const I=p6(v);C=this.createTextTrack(I,v.name,v.lang),C&&(C.mode="disabled")}C&&this.textTracks.push(C)}),y!=null&&y.length){const v=y.filter(T=>T!==null).map(T=>T.label);v.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${v.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const g=this.tracks.map(y=>({label:y.name,kind:y.type.toLowerCase(),default:y.default,subtitleTrack:y}));this.hls.trigger(z.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:g})}}}onManifestLoaded(i,r){this.config.enableCEA708Captions&&r.captions&&r.captions.forEach(o=>{const d=/(?:CC|SERVICE)([1-4])/.exec(o.instreamId);if(!d)return;const p=`textTrack${d[1]}`,g=this.captionsProperties[p];g&&(g.label=o.name,o.lang&&(g.languageCode=o.lang),g.media=o)})}closedCaptionsForLevel(i){const r=this.hls.levels[i.level];return r==null?void 0:r.attrs["CLOSED-CAPTIONS"]}onFragLoading(i,r){if(this.enabled&&r.frag.type===Vt.MAIN){var o,d;const{cea608Parser1:p,cea608Parser2:g,lastSn:y}=this,{cc:v,sn:T}=r.frag,C=(o=(d=r.part)==null?void 0:d.index)!=null?o:-1;p&&g&&(T!==y+1||T===y&&C!==this.lastPartIndex+1||v!==this.lastCc)&&(p.reset(),g.reset()),this.lastCc=v,this.lastSn=T,this.lastPartIndex=C}}onFragLoaded(i,r){const{frag:o,payload:d}=r;if(o.type===Vt.SUBTITLE)if(d.byteLength){const p=o.decryptdata,g="stats"in r;if(p==null||!p.encrypted||g){const y=this.tracks[o.level],v=this.vttCCs;v[o.cc]||(v[o.cc]={start:o.start,prevCC:this.prevCC,new:!0},this.prevCC=o.cc),y&&y.textCodec===yN?this._parseIMSC1(o,d):this._parseVTTs(r)}}else this.hls.trigger(z.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Empty subtitle payload")})}_parseIMSC1(i,r){const o=this.hls;j4(r,this.initPTS[i.cc],d=>{this._appendCues(d,i.level),o.trigger(z.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},d=>{o.logger.log(`Failed to parse IMSC1: ${d}`),o.trigger(z.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:d})})}_parseVTTs(i){var r;const{frag:o,payload:d}=i,{initPTS:p,unparsedVttFrags:g}=this,y=p.length-1;if(!p[o.cc]&&y===-1){g.push(i);return}const v=this.hls,T=(r=o.initSegment)!=null&&r.data?dc(o.initSegment.data,new Uint8Array(d)).buffer:d;Bie(T,this.initPTS[o.cc],this.vttCCs,o.cc,o.start,C=>{this._appendCues(C,o.level),v.trigger(z.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:o})},C=>{const I=C.message==="Missing initPTS for VTT MPEGTS";I?g.push(i):this._fallbackToIMSC1(o,d),v.logger.log(`Failed to parse VTT cue: ${C}`),!(I&&y>o.cc)&&v.trigger(z.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:C})})}_fallbackToIMSC1(i,r){const o=this.tracks[i.level];o.textCodec||j4(r,this.initPTS[i.cc],()=>{o.textCodec=yN,this._parseIMSC1(i,r)},()=>{o.textCodec="wvtt"})}_appendCues(i,r){const o=this.hls;if(this.config.renderTextTracksNatively){const d=this.textTracks[r];if(!d||d.mode==="disabled")return;i.forEach(p=>s6(d,p))}else{const d=this.tracks[r];if(!d)return;const p=d.default?"default":"subtitles"+r;o.trigger(z.CUES_PARSED,{type:"subtitles",cues:i,track:p})}}onFragDecrypted(i,r){const{frag:o}=r;o.type===Vt.SUBTITLE&&this.onFragLoaded(z.FRAG_LOADED,r)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(i,r){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:o,samples:d}=r;if(!(o.type===Vt.MAIN&&this.closedCaptionsForLevel(o)==="NONE"))for(let p=0;p<d.length;p++){const g=d[p].bytes;if(g){this.cea608Parser1||this.initCea608Parsers();const y=this.extractCea608Data(g);this.cea608Parser1.addData(d[p].pts,y[0]),this.cea608Parser2.addData(d[p].pts,y[1])}}}onBufferFlushing(i,{startOffset:r,endOffset:o,endOffsetSubtitles:d,type:p}){const{media:g}=this;if(!(!g||g.currentTime<o)){if(!p||p==="video"){const{captionsTracks:y}=this;Object.keys(y).forEach(v=>XN(y[v],r,o))}if(this.config.renderTextTracksNatively&&r===0&&d!==void 0){const{textTracks:y}=this;Object.keys(y).forEach(v=>XN(y[v],r,d))}}}extractCea608Data(i){const r=[[],[]],o=i[0]&31;let d=2;for(let p=0;p<o;p++){const g=i[d++],y=127&i[d++],v=127&i[d++];if(y===0&&v===0)continue;if((4&g)!==0){const C=3&g;(C===0||C===1)&&(r[C].push(y),r[C].push(v))}}return r}}function p6(h){return h.characteristics&&/transcribes-spoken-dialog/gi.test(h.characteristics)&&/describes-music-and-sound/gi.test(h.characteristics)?"captions":"subtitles"}function K4(h,i){return!!h&&h.kind===p6(i)&&qN(i,h)}function Yie(h,i,r,o){return Math.min(i,o)-Math.max(h,r)}function W4(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const qie=/\s/,$ie={newCue(h,i,r,o){const d=[];let p,g,y,v,T;const C=self.VTTCue||self.TextTrackCue;for(let L=0;L<o.rows.length;L++)if(p=o.rows[L],y=!0,v=0,T="",!p.isEmpty()){var I;for(let K=0;K<p.chars.length;K++)qie.test(p.chars[K].uchar)&&y?v++:(T+=p.chars[K].uchar,y=!1);p.cueStartTime=i,i===r&&(r+=1e-4),v>=16?v--:v++;const N=d6(T.trim()),x=FL(i,r,N);h!=null&&(I=h.cues)!=null&&I.getCueById(x)||(g=new C(i,r,N),g.id=x,g.line=L+1,g.align="left",g.position=10+Math.min(80,Math.floor(v*8/32)*10),d.push(g))}return h&&d.length&&(d.sort((L,N)=>L.line==="auto"||N.line==="auto"?0:L.line>8&&N.line>8?N.line-L.line:L.line-N.line),d.forEach(L=>s6(h,L))),d}};function zie(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const Xie=/(\d+)-(\d+)\/(\d+)/;class Y4{constructor(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||ese,this.controller=new self.AbortController,this.stats=new _L}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var i;this.abortInternal(),(i=this.callbacks)!=null&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(i,r,o){const d=this.stats;if(d.loading.start)throw new Error("Loader can only be used once.");d.loading.start=self.performance.now();const p=Jie(i,this.controller.signal),g=i.responseType==="arraybuffer",y=g?"byteLength":"length",{maxTimeToFirstByteMs:v,maxLoadTimeMs:T}=r.loadPolicy;this.context=i,this.config=r,this.callbacks=o,this.request=this.fetchSetup(i,p),self.clearTimeout(this.requestTimeout),r.timeout=v&&xt(v)?v:T,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(d,i,this.response))},r.timeout),(pT(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(I=>{var L;this.response=this.loader=I;const N=Math.max(self.performance.now(),d.loading.start);if(self.clearTimeout(this.requestTimeout),r.timeout=T,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(d,i,this.response))},T-(N-d.loading.start)),!I.ok){const{status:K,statusText:H}=I;throw new tse(H||"fetch, bad network response",K,I)}d.loading.first=N,d.total=Zie(I.headers)||d.total;const x=(L=this.callbacks)==null?void 0:L.onProgress;return x&&xt(r.highWaterMark)?this.loadProgressively(I,d,i,r.highWaterMark,x):g?I.arrayBuffer():i.responseType==="json"?I.json():I.text()}).then(I=>{var L,N;const x=this.response;if(!x)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),d.loading.end=Math.max(self.performance.now(),d.loading.first);const K=I[y];K&&(d.loaded=d.total=K);const H={url:x.url,data:I,code:x.status},Q=(L=this.callbacks)==null?void 0:L.onProgress;Q&&!xt(r.highWaterMark)&&Q(d,i,I,x),(N=this.callbacks)==null||N.onSuccess(H,d,i,x)}).catch(I=>{var L;if(self.clearTimeout(this.requestTimeout),d.aborted)return;const N=I&&I.code||0,x=I?I.message:null;(L=this.callbacks)==null||L.onError({code:N,text:x},i,I?I.details:null,d)})}getCacheAge(){let i=null;if(this.response){const r=this.response.headers.get("age");i=r?parseFloat(r):null}return i}getResponseHeader(i){return this.response?this.response.headers.get(i):null}loadProgressively(i,r,o,d=0,p){const g=new O5,y=i.body.getReader(),v=()=>y.read().then(T=>{if(T.done)return g.dataLength&&p(r,o,g.flush().buffer,i),Promise.resolve(new ArrayBuffer(0));const C=T.value,I=C.length;return r.loaded+=I,I<d||g.dataLength?(g.push(C),g.dataLength>=d&&p(r,o,g.flush().buffer,i)):p(r,o,C.buffer,i),v()}).catch(()=>Promise.reject());return v()}}function Jie(h,i){const r={method:"GET",mode:"cors",credentials:"same-origin",signal:i,headers:new self.Headers(Mi({},h.headers))};return h.rangeEnd&&r.headers.set("Range","bytes="+h.rangeStart+"-"+String(h.rangeEnd-1)),r}function Qie(h){const i=Xie.exec(h);if(i)return parseInt(i[2])-parseInt(i[1])+1}function Zie(h){const i=h.get("Content-Range");if(i){const o=Qie(i);if(xt(o))return o}const r=h.get("Content-Length");if(r)return parseInt(r)}function ese(h,i){return new self.Request(h.url,i)}class tse extends Error{constructor(i,r,o){super(i),this.code=void 0,this.details=void 0,this.code=r,this.details=o}}const nse=/^age:\s*[\d.]+\s*$/im;class m6{constructor(i){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=i&&i.xhrSetup||null,this.stats=new _L,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const i=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),i&&(i.onreadystatechange=null,i.onprogress=null,i.readyState!==4&&(this.stats.aborted=!0,i.abort()))}abort(){var i;this.abortInternal(),(i=this.callbacks)!=null&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(i,r,o){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=i,this.config=r,this.callbacks=o,this.loadInternal()}loadInternal(){const{config:i,context:r}=this;if(!i||!r)return;const o=this.loader=new self.XMLHttpRequest,d=this.stats;d.loading.first=0,d.loaded=0,d.aborted=!1;const p=this.xhrSetup;p?Promise.resolve().then(()=>{if(!(this.loader!==o||this.stats.aborted))return p(o,r.url)}).catch(g=>{if(!(this.loader!==o||this.stats.aborted))return o.open("GET",r.url,!0),p(o,r.url)}).then(()=>{this.loader!==o||this.stats.aborted||this.openAndSendXhr(o,r,i)}).catch(g=>{var y;(y=this.callbacks)==null||y.onError({code:o.status,text:g.message},r,o,d)}):this.openAndSendXhr(o,r,i)}openAndSendXhr(i,r,o){i.readyState||i.open("GET",r.url,!0);const d=r.headers,{maxTimeToFirstByteMs:p,maxLoadTimeMs:g}=o.loadPolicy;if(d)for(const y in d)i.setRequestHeader(y,d[y]);r.rangeEnd&&i.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1)),i.onreadystatechange=this.readystatechange.bind(this),i.onprogress=this.loadprogress.bind(this),i.responseType=r.responseType,self.clearTimeout(this.requestTimeout),o.timeout=p&&xt(p)?p:g,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),i.send()}readystatechange(){const{context:i,loader:r,stats:o}=this;if(!i||!r)return;const d=r.readyState,p=this.config;if(!o.aborted&&d>=2&&(o.loading.first===0&&(o.loading.first=Math.max(self.performance.now(),o.loading.start),p.timeout!==p.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),p.timeout=p.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),p.loadPolicy.maxLoadTimeMs-(o.loading.first-o.loading.start)))),d===4)){self.clearTimeout(this.requestTimeout),r.onreadystatechange=null,r.onprogress=null;const T=r.status,C=r.responseType==="text"?r.responseText:null;if(T>=200&&T<300){const x=C??r.response;if(x!=null){var g,y;o.loading.end=Math.max(self.performance.now(),o.loading.first);const K=r.responseType==="arraybuffer"?x.byteLength:x.length;o.loaded=o.total=K,o.bwEstimate=o.total*8e3/(o.loading.end-o.loading.first);const H=(g=this.callbacks)==null?void 0:g.onProgress;H&&H(o,i,x,r);const Q={url:r.responseURL,data:x,code:T};(y=this.callbacks)==null||y.onSuccess(Q,o,i,r);return}}const I=p.loadPolicy.errorRetry,L=o.retry,N={url:i.url,data:void 0,code:T};if(uC(I,L,!1,N))this.retry(I);else{var v;Zn.error(`${T} while loading ${i.url}`),(v=this.callbacks)==null||v.onError({code:T,text:r.statusText},i,r,o)}}}loadtimeout(){if(!this.config)return;const i=this.config.loadPolicy.timeoutRetry,r=this.stats.retry;if(uC(i,r,!0))this.retry(i);else{var o;Zn.warn(`timeout while loading ${(o=this.context)==null?void 0:o.url}`);const d=this.callbacks;d&&(this.abortInternal(),d.onTimeout(this.stats,this.context,this.loader))}}retry(i){const{context:r,stats:o}=this;this.retryDelay=TL(i,o.retry),o.retry++,Zn.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${r==null?void 0:r.url}, retrying ${o.retry}/${i.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(i){const r=this.stats;r.loaded=i.loaded,i.lengthComputable&&(r.total=i.total)}getCacheAge(){let i=null;if(this.loader&&nse.test(this.loader.getAllResponseHeaders())){const r=this.loader.getResponseHeader("age");i=r?parseFloat(r):null}return i}getResponseHeader(i){return this.loader&&new RegExp(`^${i}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(i):null}}const ise={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},sse=Ii(Ii({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:m6,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Cee,bufferController:_ne,capLevelController:kL,errorController:Lee,fpsController:cie,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:_5,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:ise},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},rse()),{},{subtitleStreamController:Sie,subtitleTrackController:uie,timelineController:Wie,audioStreamController:pne,audioTrackController:mne,emeController:I_,cmcdController:rie,contentSteeringController:oie,interstitialsController:_ie});function rse(){return{cueHandler:$ie,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function ase(h,i,r){if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(i.liveMaxLatencyDurationCount!==void 0&&(i.liveSyncDurationCount===void 0||i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(i.liveMaxLatencyDuration!==void 0&&(i.liveSyncDuration===void 0||i.liveMaxLatencyDuration<=i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const o=ZN(h),d=["manifest","level","frag"],p=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return d.forEach(g=>{const y=`${g==="level"?"playlist":g}LoadPolicy`,v=i[y]===void 0,T=[];p.forEach(C=>{const I=`${g}Loading${C}`,L=i[I];if(L!==void 0&&v){T.push(I);const N=o[y].default;switch(i[y]={default:N},C){case"TimeOut":N.maxLoadTimeMs=L,N.maxTimeToFirstByteMs=L;break;case"MaxRetry":N.errorRetry.maxNumRetry=L,N.timeoutRetry.maxNumRetry=L;break;case"RetryDelay":N.errorRetry.retryDelayMs=L,N.timeoutRetry.retryDelayMs=L;break;case"MaxRetryTimeout":N.errorRetry.maxRetryDelayMs=L,N.timeoutRetry.maxRetryDelayMs=L;break}}}),T.length&&r.warn(`hls.js config: "${T.join('", "')}" setting(s) are deprecated, use "${y}": ${ds(i[y])}`)}),Ii(Ii({},o),i)}function ZN(h){return h&&typeof h=="object"?Array.isArray(h)?h.map(ZN):Object.keys(h).reduce((i,r)=>(i[r]=ZN(h[r]),i),{}):h}function ose(h,i){const r=h.loader;r!==Y4&&r!==m6?(i.log("[config]: Custom loader detected, cannot enable progressive streaming"),h.progressive=!1):zie()&&(h.loader=Y4,h.progressive=!0,h.enableSoftwareAES=!0,i.log("[config]: Progressive streaming enabled, using FetchLoader"))}const ZA=2,cse=.1,lse=.05,dse=100;class use extends m5{constructor(i,r){super("gap-controller",i.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var o;(o=this.media)!=null&&o.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var o;this.ended=((o=this.media)==null?void 0:o.currentTime)||1,this.hls.trigger(z.MEDIA_ENDED,{stalled:!1})}},this.hls=i,this.fragmentTracker=r,this.registerListeners()}registerListeners(){const{hls:i}=this;i&&(i.on(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(z.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:i}=this;i&&(i.off(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(z.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(i,r){this.setInterval(dse),this.mediaSource=r.mediaSource;const o=this.media=r.media;Au(o,"playing",this.onMediaPlaying),Au(o,"waiting",this.onMediaWaiting),Au(o,"ended",this.onMediaEnded)}onMediaDetaching(i,r){this.clearInterval();const{media:o}=this;o&&(_d(o,"playing",this.onMediaPlaying),_d(o,"waiting",this.onMediaWaiting),_d(o,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(i,r){this.buffered=r.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var i;if(!((i=this.media)!=null&&i.readyState)||!this.hasBuffered)return;const r=this.media.currentTime;this.poll(r,this.lastCurrentTime),this.lastCurrentTime=r}poll(i,r){var o,d;const p=(o=this.hls)==null?void 0:o.config;if(!p)return;const{media:g,stalled:y}=this;if(!g)return;const{seeking:v}=g,T=this.seeking&&!v,C=!this.seeking&&v,I=g.paused&&!v||g.ended||g.playbackRate===0;if(this.seeking=v,i!==r){r&&(this.ended=0),this.moved=!0,v||(this.nudgeRetry=0,p.nudgeOnVideoHole&&!I&&i>r&&this.nudgeOnVideoHole(i,r)),this.waiting===0&&this.stallResolved(i);return}if(C||T){T&&this.stallResolved(i);return}if(I){this.nudgeRetry=0,this.stallResolved(i),!this.ended&&g.ended&&this.hls&&(this.ended=i||1,this.hls.trigger(z.MEDIA_ENDED,{stalled:!1}));return}if(!Dn.getBuffered(g).length){this.nudgeRetry=0;return}const L=Dn.bufferInfo(g,i,0),N=L.nextStart||0,x=this.fragmentTracker;if(v&&x&&this.hls){const be=q4(this.hls.inFlightFragments,i),Se=L.len>ZA,Te=!N||be||N-i>ZA&&!x.getPartialFragment(i);if(Se||Te)return;this.moved=!1}const K=(d=this.hls)==null?void 0:d.latestLevelDetails;if(!this.moved&&this.stalled!==null&&x){if(!(L.len>0)&&!N)return;const Se=Math.max(N,L.start||0)-i,_e=!!(K!=null&&K.live)?K.targetduration*2:ZA,he=x.getPartialFragment(i);if(Se>0&&(Se<=_e||he)){g.paused||this._trySkipBufferHole(he);return}}const H=p.detectStallWithCurrentTimeMs,Q=self.performance.now(),ne=this.waiting;if(y===null){ne>0&&Q-ne<H?this.stalled=ne:this.stalled=Q;return}const ee=Q-y;if(!v&&(ee>=H||ne)&&this.hls){var pe;if(((pe=this.mediaSource)==null?void 0:pe.readyState)==="ended"&&!(K!=null&&K.live)&&Math.abs(i-((K==null?void 0:K.edge)||0))<1){if(this.ended)return;this.ended=i||1,this.hls.trigger(z.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(L),!this.media||!this.hls)return}const de=Dn.bufferInfo(g,i,p.maxBufferHole);this._tryFixBufferStall(de,ee)}stallResolved(i){const r=this.stalled;if(r&&this.hls&&(this.stalled=null,this.stallReported)){const o=self.performance.now()-r;this.log(`playback not stuck anymore @${i}, after ${Math.round(o)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(z.STALL_RESOLVED,{})}}nudgeOnVideoHole(i,r){var o;const d=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(o=this.buffered.audio)!=null&&o.length&&d&&d.length>1&&i>d.end(0)){const p=Dn.bufferedInfo(Dn.timeRangesToArray(this.buffered.audio),i,0);if(p.len>1&&r>=p.start){const g=Dn.timeRangesToArray(d),y=Dn.bufferedInfo(g,r,0).bufferedIndex;if(y>-1&&y<g.length-1){const v=Dn.bufferedInfo(g,i,0).bufferedIndex,T=g[y].end,C=g[y+1].start;if((v===-1||v>y)&&C-T<1&&i-T<2){const I=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${i} hole: ${T} -> ${C} buffered index: ${v}`);this.warn(I.message),this.media.currentTime+=1e-6;const L=this.fragmentTracker.getPartialFragment(i)||void 0,N=Dn.bufferInfo(this.media,i,0);this.hls.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:I,reason:I.message,frag:L,buffer:N.len,bufferInfo:N})}}}}}_tryFixBufferStall(i,r){var o,d;const{fragmentTracker:p,media:g}=this,y=(o=this.hls)==null?void 0:o.config;if(!g||!p||!y)return;const v=g.currentTime,T=(d=this.hls)==null?void 0:d.latestLevelDetails,C=p.getPartialFragment(v);if((C||T!=null&&T.live&&v<T.fragmentStart)&&(this._trySkipBufferHole(C)||!this.media))return;const I=i.buffered;(I&&I.length>1&&i.len>y.maxBufferHole||i.nextStart&&i.nextStart-v<y.maxBufferHole)&&(r>y.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(i))}_reportStall(i){const{hls:r,media:o,stallReported:d,stalled:p}=this;if(!d&&p!==null&&o&&r){this.stallReported=!0;const g=new Error(`Playback stalling at @${o.currentTime} due to low buffer (${ds(i)})`);this.warn(g.message),r.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.BUFFER_STALLED_ERROR,fatal:!1,error:g,buffer:i.len,bufferInfo:i,stalled:{start:p}})}}_trySkipBufferHole(i){var r;const{fragmentTracker:o,media:d}=this,p=(r=this.hls)==null?void 0:r.config;if(!d||!o||!p)return 0;const g=d.currentTime,y=Dn.bufferInfo(d,g,0),v=g<y.start?y.start:y.nextStart;if(v&&this.hls){const C=y.len<=p.maxBufferHole,I=y.len>0&&y.len<1&&d.readyState<3,L=v-g;if(L>0&&(C||I)){if(L>p.maxBufferHole){let x=!1;if(g===0){const K=o.getAppendedFrag(0,Vt.MAIN);K&&v<K.end&&(x=!0)}if(!x){const K=i||o.getAppendedFrag(g,Vt.MAIN);if(K){var T;if(!((T=this.hls.loadLevelObj)!=null&&T.details)||q4(this.hls.inFlightFragments,v))return 0;let Q=!1,ne=K.end;for(;ne<v;){const ee=o.getPartialFragment(ne);if(ee)ne+=ee.duration;else{Q=!0;break}}if(Q)return 0}}}const N=Math.max(v+lse,g+cse);if(this.warn(`skipping hole, adjusting currentTime from ${g} to ${N}`),this.moved=!0,d.currentTime=N,!(i!=null&&i.gap)){const x=new Error(`fragment loaded with buffer holes, seeking from ${g} to ${N}`);this.hls.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:x,reason:x.message,frag:i||void 0,buffer:y.len,bufferInfo:y})}return N}}return 0}_tryNudgeBuffer(i){const{hls:r,media:o,nudgeRetry:d}=this,p=r==null?void 0:r.config;if(!o||!p)return 0;const g=o.currentTime;if(this.nudgeRetry++,d<p.nudgeMaxRetry){const y=g+(d+1)*p.nudgeOffset,v=new Error(`Nudging 'currentTime' from ${g} to ${y}`);this.warn(v.message),o.currentTime=y,r.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.BUFFER_NUDGE_ON_STALL,error:v,fatal:!1,buffer:i.len,bufferInfo:i})}else{const y=new Error(`Playhead still not moving while enough data buffered @${g} after ${p.nudgeMaxRetry} nudges`);this.error(y.message),r.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.BUFFER_STALLED_ERROR,error:y,fatal:!0,buffer:i.len,bufferInfo:i})}}}function q4(h,i){const r=$4(h.main);if(r&&r.start<=i)return r;const o=$4(h.audio);return o&&o.start<=i?o:null}function $4(h){if(!h)return null;switch(h.state){case ot.IDLE:case ot.STOPPED:case ot.ENDED:case ot.ERROR:return null}return h.frag}const hse=.25;function eL(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function z4(h,i,r,o,d){let p=new h(i,r,"");try{p.value=o,d&&(p.type=d)}catch{p=new h(i,r,ds(d?Ii({type:d},o):o))}return p}const FA=(()=>{const h=eL();try{h&&new h(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function fse(h){return Uint8Array.from(h.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class pse{constructor(i){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(z.EVENT_CUE_ENTER,{})},this.hls=i,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:i}=this;i.on(z.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),i.on(z.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(z.LEVEL_UPDATED,this.onLevelUpdated,this),i.on(z.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:i}=this;i.off(z.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),i.off(z.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(z.LEVEL_UPDATED,this.onLevelUpdated,this),i.off(z.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(i,r){var o;this.media=r.media,((o=r.overrides)==null?void 0:o.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const i=this.hls.latestLevelDetails;i&&this.updateDateRangeCues(i)}onMediaDetaching(i,r){this.media=null,!r.transferMedia&&(this.id3Track&&(this.removeCues&&A_(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(i){const r=this.getID3Track(i.textTracks);return r.mode="hidden",r}getID3Track(i){if(this.media){for(let r=0;r<i.length;r++){const o=i[r];if(o.kind==="metadata"&&o.label==="id3")return i6(o,this.media),o}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(i,r){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:d}}}=this;if(!o&&!d)return;const{samples:p}=r;this.id3Track||(this.id3Track=this.createTrack(this.media));const g=eL();if(g)for(let y=0;y<p.length;y++){const v=p[y].type;if(v===Eo.emsg&&!o||!d)continue;const T=U5(p[y].data);if(T){const C=p[y].pts;let I=C+p[y].duration;I>FA&&(I=FA),I-C<=0&&(I=C+hse);for(let N=0;N<T.length;N++){const x=T[N];if(!F5(x)){this.updateId3CueEnds(C,v);const K=z4(g,C,I,x,v);K&&this.id3Track.addCue(K)}}}}}updateId3CueEnds(i,r){var o;const d=(o=this.id3Track)==null?void 0:o.cues;if(d)for(let p=d.length;p--;){const g=d[p];g.type===r&&g.startTime<i&&g.endTime===FA&&(g.endTime=i)}}onBufferFlushing(i,{startOffset:r,endOffset:o,type:d}){const{id3Track:p,hls:g}=this;if(!g)return;const{config:{enableEmsgMetadataCues:y,enableID3MetadataCues:v}}=g;if(p&&(y||v)){let T;d==="audio"?T=C=>C.type===Eo.audioId3&&v:d==="video"?T=C=>C.type===Eo.emsg&&y:T=C=>C.type===Eo.audioId3&&v||C.type===Eo.emsg&&y,XN(p,r,o,T)}}onLevelUpdated(i,{details:r}){this.updateDateRangeCues(r,!0)}onLevelPtsUpdated(i,r){Math.abs(r.drift)>.01&&this.updateDateRangeCues(r.details)}updateDateRangeCues(i,r){if(!this.media||!i.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:o}=this,{dateRanges:d}=i,p=Object.keys(d);let g=this.dateRangeCuesAppended;if(o&&r){var y;if((y=o.cues)!=null&&y.length){const C=Object.keys(g).filter(I=>!p.includes(I));for(let I=C.length;I--;){const L=C[I],N=g[L].cues;delete g[L],Object.keys(N).forEach(x=>{try{const K=N[x];K.removeEventListener("enter",this.onEventCueEnter),o.removeCue(K)}catch{}})}}else g=this.dateRangeCuesAppended={}}const v=i.fragments[i.fragments.length-1];if(p.length===0||!xt(v==null?void 0:v.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const T=eL();for(let C=0;C<p.length;C++){const I=p[C],L=d[I],N=L.startTime,x=g[I],K=(x==null?void 0:x.cues)||{};let H=(x==null?void 0:x.durationKnown)||!1,Q=FA;const{duration:ne,endDate:ee}=L;if(ee&&ne!==null)Q=N+ne,H=!0;else if(L.endOnNext&&!H){const de=p.reduce((be,Se)=>{if(Se!==L.id){const Te=d[Se];if(Te.class===L.class&&Te.startDate>L.startDate&&(!be||L.startDate<be.startDate))return Te}return be},null);de&&(Q=de.startTime,H=!0)}const pe=Object.keys(L.attr);for(let de=0;de<pe.length;de++){const be=pe[de];if(!Wee(be))continue;const Se=K[be];if(Se)H&&!x.durationKnown?Se.endTime=Q:Math.abs(Se.startTime-N)>.01&&(Se.startTime=N,Se.endTime=Q);else if(T){let Te=L.attr[be];Yee(be)&&(Te=fse(Te));const he=z4(T,N,Q,{key:be,data:Te},Eo.dateRange);he&&(he.id=I,this.id3Track.addCue(he),K[be]=he,this.hls.config.interstitialsController&&(be==="X-ASSET-LIST"||be==="X-ASSET-URL")&&he.addEventListener("enter",this.onEventCueEnter))}}g[I]={cues:K,dateRange:L,durationKnown:H}}}}class mse{constructor(i){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:r}=this,o=this.levelDetails;if(!r||!o)return;this.currentTime=r.currentTime;const d=this.computeLatency();if(d===null)return;this._latency=d;const{lowLatencyMode:p,maxLiveSyncPlaybackRate:g}=this.config;if(!p||g===1||!o.live)return;const y=this.targetLatency;if(y===null)return;const v=d-y,T=Math.min(this.maxLatency,y+o.targetduration);if(v<T&&v>.05&&this.forwardBufferLength>1){const I=Math.min(2,Math.max(1,g)),L=Math.round(2/(1+Math.exp(-.75*v-this.edgeStalled))*20)/20,N=Math.min(I,Math.max(1,L));this.changeMediaPlaybackRate(r,N)}else r.playbackRate!==1&&r.playbackRate!==0&&this.changeMediaPlaybackRate(r,1)},this.hls=i,this.config=i.config,this.registerListeners()}get levelDetails(){var i;return((i=this.hls)==null?void 0:i.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:i}=this;if(i.liveMaxLatencyDuration!==void 0)return i.liveMaxLatencyDuration;const r=this.levelDetails;return r?i.liveMaxLatencyDurationCount*r.targetduration:0}get targetLatency(){const i=this.levelDetails;if(i===null||this.hls===null)return null;const{holdBack:r,partHoldBack:o,targetduration:d}=i,{liveSyncDuration:p,liveSyncDurationCount:g,lowLatencyMode:y}=this.config,v=this.hls.userConfig;let T=y&&o||r;(this._targetLatencyUpdated||v.liveSyncDuration||v.liveSyncDurationCount||T===0)&&(T=p!==void 0?p:g*d);const C=d;return T+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,C)}set targetLatency(i){this.stallCount=0,this.config.liveSyncDuration=i,this._targetLatencyUpdated=!0}get liveSyncPosition(){const i=this.estimateLiveEdge(),r=this.targetLatency;if(i===null||r===null)return null;const o=this.levelDetails;if(o===null)return null;const d=o.edge,p=i-r-this.edgeStalled,g=d-o.totalduration,y=d-(this.config.lowLatencyMode&&o.partTarget||o.targetduration);return Math.min(Math.max(g,p),y)}get drift(){const i=this.levelDetails;return i===null?1:i.drift}get edgeStalled(){const i=this.levelDetails;if(i===null)return 0;const r=(this.config.lowLatencyMode&&i.partTarget||i.targetduration)*3;return Math.max(i.age-r,0)}get forwardBufferLength(){const{media:i}=this,r=this.levelDetails;if(!i||!r)return 0;const o=i.buffered.length;return(o?i.buffered.end(o-1):r.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:i}=this;i&&(i.on(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.LEVEL_UPDATED,this.onLevelUpdated,this),i.on(z.ERROR,this.onError,this))}unregisterListeners(){const{hls:i}=this;i&&(i.off(z.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(z.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.LEVEL_UPDATED,this.onLevelUpdated,this),i.off(z.ERROR,this.onError,this))}onMediaAttached(i,r){this.media=r.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(i,{details:r}){r.advanced&&this.onTimeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(i,r){var o;r.details===Ue.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(o=this.levelDetails)!=null&&o.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(i,r){var o,d;i.playbackRate!==r&&((o=this.hls)==null||o.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(d=this.targetLatency)==null?void 0:d.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${i.playbackRate} to ${r}`),i.playbackRate=r)}estimateLiveEdge(){const i=this.levelDetails;return i===null?null:i.edge+i.age}computeLatency(){const i=this.estimateLiveEdge();return i===null?null:i-this.currentTime}}class gse extends PL{constructor(i,r){super(i,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=r,this._registerListeners()}_registerListeners(){const{hls:i}=this;i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(z.LEVEL_LOADED,this.onLevelLoaded,this),i.on(z.LEVELS_UPDATED,this.onLevelsUpdated,this),i.on(z.FRAG_BUFFERED,this.onFragBuffered,this),i.on(z.ERROR,this.onError,this)}_unregisterListeners(){const{hls:i}=this;i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(z.LEVEL_LOADED,this.onLevelLoaded,this),i.off(z.LEVELS_UPDATED,this.onLevelsUpdated,this),i.off(z.FRAG_BUFFERED,this.onFragBuffered,this),i.off(z.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(r=>{r.loadError=0,r.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(i,r){this.resetLevels()}onManifestLoaded(i,r){const o=this.hls.config.preferManagedMediaSource,d=[],p={},g={};let y=!1,v=!1,T=!1;r.levels.forEach(C=>{var I;const L=C.attrs;let{audioCodec:N,videoCodec:x}=C;N&&(C.audioCodec=N=oC(N,o)||void 0),((I=x)==null?void 0:I.indexOf("avc1"))===0&&(x=C.videoCodec=hee(x));const{width:K,height:H,unknownCodecs:Q}=C;let ne=Q?Q.length:0;if(Q)for(let Ge=ne;Ge--;){const st=Q[Ge];this.isAudioSupported(st)?(C.audioCodec=N=N?`${N},${st}`:st,ne--,D_.audio[N.substring(0,4)]=2):this.isVideoSupported(st)&&(C.videoCodec=x=x?`${x},${st}`:st,ne--,D_.video[x.substring(0,4)]=2)}if(y||(y=!!(K&&H)),v||(v=!!x),T||(T=!!N),ne||N&&!this.isAudioSupported(N)||x&&!this.isVideoSupported(x)){this.log(`Some or all CODECS not supported "${L.CODECS}"`);return}const{CODECS:ee,"FRAME-RATE":pe,"HDCP-LEVEL":de,"PATHWAY-ID":be,RESOLUTION:Se,"VIDEO-RANGE":Te}=L,he=`${`${be||"."}-`}${C.bitrate}-${Se}-${pe}-${ee}-${Te}-${de}`;if(p[he])if(p[he].uri!==C.url&&!C.attrs["PATHWAY-ID"]){const Ge=g[he]+=1;C.attrs["PATHWAY-ID"]=new Array(Ge+1).join(".");const st=this.createLevel(C);p[he]=st,d.push(st)}else p[he].addGroupId("audio",L.AUDIO),p[he].addGroupId("text",L.SUBTITLES);else{const Ge=this.createLevel(C);p[he]=Ge,g[he]=1,d.push(Ge)}}),this.filterAndSortMediaOptions(d,r,y,v,T)}createLevel(i){const r=new lT(i),o=i.supplemental;if(o!=null&&o.videoCodec&&!this.isVideoSupported(o.videoCodec)){const d=new Error(`SUPPLEMENTAL-CODECS not supported "${o.videoCodec}"`);this.log(d.message),r.supportedResult=u5(d,[])}return r}isAudioSupported(i){return BN(i,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(i){return BN(i,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(i,r,o,d,p){let g=[],y=[],v=i;if((o||d)&&p&&(v=v.filter(({videoCodec:H,videoRange:Q,width:ne,height:ee})=>(!!H||!!(ne&&ee))&&Eee(Q))),v.length===0){Promise.resolve().then(()=>{if(this.hls){let H="no level with compatible codecs found in manifest",Q=H;r.levels.length&&(Q=`one or more CODECS in variant not supported: ${ds(r.levels.map(ee=>ee.attrs.CODECS).filter((ee,pe,de)=>de.indexOf(ee)===pe))}`,this.warn(Q),H+=` (${Q})`);const ne=new Error(H);this.hls.trigger(z.ERROR,{type:Gt.MEDIA_ERROR,details:Ue.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,error:ne,reason:Q})}});return}r.audioTracks&&(g=r.audioTracks.filter(H=>!H.audioCodec||this.isAudioSupported(H.audioCodec)),X4(g)),r.subtitles&&(y=r.subtitles,X4(y));const T=v.slice(0);v.sort((H,Q)=>{if(H.attrs["HDCP-LEVEL"]!==Q.attrs["HDCP-LEVEL"])return(H.attrs["HDCP-LEVEL"]||"")>(Q.attrs["HDCP-LEVEL"]||"")?1:-1;if(o&&H.height!==Q.height)return H.height-Q.height;if(H.frameRate!==Q.frameRate)return H.frameRate-Q.frameRate;if(H.videoRange!==Q.videoRange)return cC.indexOf(H.videoRange)-cC.indexOf(Q.videoRange);if(H.videoCodec!==Q.videoCodec){const ne=H3(H.videoCodec),ee=H3(Q.videoCodec);if(ne!==ee)return ee-ne}if(H.uri===Q.uri&&H.codecSet!==Q.codecSet){const ne=aC(H.codecSet),ee=aC(Q.codecSet);if(ne!==ee)return ee-ne}return H.averageBitrate!==Q.averageBitrate?H.averageBitrate-Q.averageBitrate:0});let C=T[0];if(this.steering&&(v=this.steering.filterParsedLevels(v),v.length!==T.length)){for(let H=0;H<T.length;H++)if(T[H].pathwayId===v[0].pathwayId){C=T[H];break}}this._levels=v;for(let H=0;H<v.length;H++)if(v[H]===C){var I;this._firstLevel=H;const Q=C.bitrate,ne=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${v.length} level(s) found, first bitrate: ${Q}`),((I=this.hls.userConfig)==null?void 0:I.abrEwmaDefaultEstimate)===void 0){const ee=Math.min(Q,this.hls.config.abrEwmaDefaultEstimateMax);ee>ne&&ne===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=ee)}break}const L=p&&!d,N=this.hls.config,x=!!(N.audioStreamController&&N.audioTrackController),K={levels:v,audioTracks:g,subtitleTracks:y,sessionData:r.sessionData,sessionKeys:r.sessionKeys,firstLevel:this._firstLevel,stats:r.stats,audio:p,video:d,altAudio:x&&!L&&g.some(H=>!!H.url)};this.hls.trigger(z.MANIFEST_PARSED,K)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(i){const r=this._levels;if(r.length===0)return;if(i<0||i>=r.length){const C=new Error("invalid level idx"),I=i<0;if(this.hls.trigger(z.ERROR,{type:Gt.OTHER_ERROR,details:Ue.LEVEL_SWITCH_ERROR,level:i,fatal:I,error:C,reason:C.message}),I)return;i=Math.min(i,r.length-1)}const o=this.currentLevelIndex,d=this.currentLevel,p=d?d.attrs["PATHWAY-ID"]:void 0,g=r[i],y=g.attrs["PATHWAY-ID"];if(this.currentLevelIndex=i,this.currentLevel=g,o===i&&d&&p===y)return;this.log(`Switching to level ${i} (${g.height?g.height+"p ":""}${g.videoRange?g.videoRange+" ":""}${g.codecSet?g.codecSet+" ":""}@${g.bitrate})${y?" with Pathway "+y:""} from level ${o}${p?" with Pathway "+p:""}`);const v={level:i,attrs:g.attrs,details:g.details,bitrate:g.bitrate,averageBitrate:g.averageBitrate,maxBitrate:g.maxBitrate,realBitrate:g.realBitrate,width:g.width,height:g.height,codecSet:g.codecSet,audioCodec:g.audioCodec,videoCodec:g.videoCodec,audioGroups:g.audioGroups,subtitleGroups:g.subtitleGroups,loaded:g.loaded,loadError:g.loadError,fragmentError:g.fragmentError,name:g.name,id:g.id,uri:g.uri,url:g.url,urlId:0,audioGroupIds:g.audioGroupIds,textGroupIds:g.textGroupIds};this.hls.trigger(z.LEVEL_SWITCHING,v);const T=g.details;if(!T||T.live){const C=this.switchParams(g.uri,d==null?void 0:d.details,T);this.loadPlaylist(C)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(i){this.manualLevelIndex=i,this._startLevel===void 0&&(this._startLevel=i),i!==-1&&(this.level=i)}get firstLevel(){return this._firstLevel}set firstLevel(i){this._firstLevel=i}get startLevel(){if(this._startLevel===void 0){const i=this.hls.config.startLevel;return i!==void 0?i:this.hls.firstAutoLevel}return this._startLevel}set startLevel(i){this._startLevel=i}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(i){if(this.steering){const r=this.steering.pathways(),o=i.filter(d=>r.indexOf(d)!==-1);if(i.length<1){this.warn(`pathwayPriority ${i} should contain at least one pathway from list: ${r}`);return}this.steering.pathwayPriority=o}}onError(i,r){r.fatal||!r.context||r.context.type===Vn.LEVEL&&r.context.level===this.level&&this.checkRetry(r)}onFragBuffered(i,{frag:r}){if(r!==void 0&&r.type===Vt.MAIN){const o=r.elementaryStreams;if(!Object.keys(o).some(p=>!!o[p]))return;const d=this._levels[r.level];d!=null&&d.loadError&&(this.log(`Resetting level error count of ${d.loadError} on frag buffered`),d.loadError=0)}}onLevelLoaded(i,r){var o;const{level:d,details:p}=r,g=r.levelInfo;if(!g){var y;this.warn(`Invalid level index ${d}`),(y=r.deliveryDirectives)!=null&&y.skip&&(p.deltaUpdateFailed=!0);return}if(g===this.currentLevel||r.withoutMultiVariant){g.fragmentError===0&&(g.loadError=0);let v=g.details;v===r.details&&v.advanced&&(v=void 0),this.playlistLoaded(d,r,v)}else(o=r.deliveryDirectives)!=null&&o.skip&&(p.deltaUpdateFailed=!0)}loadPlaylist(i){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,i)}loadingPlaylist(i,r){super.loadingPlaylist(i,r);const o=this.getUrlWithDirectives(i.uri,r),d=this.currentLevelIndex,p=i.attrs["PATHWAY-ID"],g=i.details,y=g==null?void 0:g.age;this.log(`Loading level index ${d}${(r==null?void 0:r.msn)!==void 0?" at sn "+r.msn+" part "+r.part:""}${p?" Pathway "+p:""}${y&&g.live?" age "+y.toFixed(1)+(g.type&&" "+g.type||""):""} ${o}`),this.hls.trigger(z.LEVEL_LOADING,{url:o,level:d,levelInfo:i,pathwayId:i.attrs["PATHWAY-ID"],id:0,deliveryDirectives:r||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(i){this.level=i,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=i)}removeLevel(i){var r;if(this._levels.length===1)return;const o=this._levels.filter((p,g)=>g!==i?!0:(this.steering&&this.steering.removeLevel(p),p===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,p.details&&p.details.fragments.forEach(y=>y.level=-1)),!1));C5(o),this._levels=o,this.currentLevelIndex>-1&&(r=this.currentLevel)!=null&&r.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const d=o.length-1;this._firstLevel=Math.min(this._firstLevel,d),this._startLevel&&(this._startLevel=Math.min(this._startLevel,d)),this.hls.trigger(z.LEVELS_UPDATED,{levels:o})}onLevelsUpdated(i,{levels:r}){this._levels=r}checkMaxAutoUpdated(){const{autoLevelCapping:i,maxAutoLevel:r,maxHdcpLevel:o}=this.hls;this._maxAutoLevel!==r&&(this._maxAutoLevel=r,this.hls.trigger(z.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:i,levels:this.levels,maxAutoLevel:r,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:o}))}}function X4(h){const i={};h.forEach(r=>{const o=r.groupId||"";r.id=i[o]=i[o]||0,i[o]++})}function g6(){return self.SourceBuffer||self.WebKitSourceBuffer}function E6(){if(!uf())return!1;const i=g6();return!i||i.prototype&&typeof i.prototype.appendBuffer=="function"&&typeof i.prototype.remove=="function"}function Ese(){if(!E6())return!1;const h=uf();return typeof(h==null?void 0:h.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(i=>h.isTypeSupported(cT(i,"video")))||["mp4a.40.2","fLaC"].some(i=>h.isTypeSupported(cT(i,"audio"))))}function _se(){var h;const i=g6();return typeof(i==null||(h=i.prototype)==null?void 0:h.changeType)=="function"}const Sse=100;class yse extends CL{constructor(i,r,o){super(i,r,o,"stream-controller",Vt.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const d=this.media,p=d?d.currentTime:null;if(p===null||!xt(p)||(this.log(`Media seeked to ${p.toFixed(3)}`),!this.getBufferedFrag(p)))return;const g=this.getFwdBufferInfoAtPos(d,p,Vt.MAIN,0);if(g===null||g.len===0){this.warn(`Main forward buffer length at ${p} on "seeked" event ${g?g.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:i}=this;i.on(z.MANIFEST_PARSED,this.onManifestParsed,this),i.on(z.LEVEL_LOADING,this.onLevelLoading,this),i.on(z.LEVEL_LOADED,this.onLevelLoaded,this),i.on(z.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),i.on(z.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.on(z.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(z.BUFFER_CREATED,this.onBufferCreated,this),i.on(z.BUFFER_FLUSHED,this.onBufferFlushed,this),i.on(z.LEVELS_UPDATED,this.onLevelsUpdated,this),i.on(z.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:i}=this;i.off(z.MANIFEST_PARSED,this.onManifestParsed,this),i.off(z.LEVEL_LOADED,this.onLevelLoaded,this),i.off(z.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),i.off(z.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.off(z.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(z.BUFFER_CREATED,this.onBufferCreated,this),i.off(z.BUFFER_FLUSHED,this.onBufferFlushed,this),i.off(z.LEVELS_UPDATED,this.onLevelsUpdated,this),i.off(z.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(i,r){if(this.levels){const{lastCurrentTime:o,hls:d}=this;if(this.stopLoad(),this.setInterval(Sse),this.level=-1,!this.startFragRequested){let p=d.startLevel;p===-1&&(d.config.testBandwidth&&this.levels.length>1?(p=0,this.bitrateTest=!0):p=d.firstAutoLevel),d.nextLoadLevel=p,this.level=d.loadLevel,this._hasEnoughToStart=!!r}o>0&&i===-1&&!r&&(this.log(`Override startPosition with lastCurrentTime @${o.toFixed(3)}`),i=o),this.state=ot.IDLE,this.nextLoadPosition=this.lastCurrentTime=i+this.timelineOffset,this.startPosition=r?-1:i,this.tick()}else this._forceStartLoad=!0,this.state=ot.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ot.WAITING_LEVEL:{const{levels:r,level:o}=this,d=r==null?void 0:r[o],p=d==null?void 0:d.details;if(p&&(!p.live||this.levelLastLoaded===d&&!this.waitForLive(d))){if(this.waitForCdnTuneIn(p))break;this.state=ot.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ot.IDLE;break}break}case ot.FRAG_LOADING_WAITING_RETRY:{var i;const r=self.performance.now(),o=this.retryDate;if(!o||r>=o||(i=this.media)!=null&&i.seeking){const{levels:d,level:p}=this,g=d==null?void 0:d[p];this.resetStartWhenNotLoaded(g||null),this.state=ot.IDLE}}break}this.state===ot.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var i;super.onTickEnd(),(i=this.media)!=null&&i.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:i,levelLastLoaded:r,levels:o,media:d}=this;if(r===null||!d&&!this.primaryPrefetch&&(this.startFragRequested||!i.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const p=this.buffering?i.nextLoadLevel:i.loadLevel;if(!(o!=null&&o[p]))return;const g=o[p],y=this.getMainFwdBufferInfo();if(y===null)return;const v=this.getLevelDetails();if(v&&this._streamEnded(y,v)){const K={};this.altAudio===2&&(K.type="video"),this.hls.trigger(z.BUFFER_EOS,K),this.state=ot.ENDED;return}if(!this.buffering)return;i.loadLevel!==p&&i.manualLevel===-1&&this.log(`Adapting to level ${p} from level ${this.level}`),this.level=i.nextLoadLevel=p;const T=g.details;if(!T||this.state===ot.WAITING_LEVEL||this.waitForLive(g)){this.level=p,this.state=ot.WAITING_LEVEL,this.startFragRequested=!1;return}const C=y.len,I=this.getMaxBufferLength(g.maxBitrate);if(C>=I)return;this.backtrackFragment&&this.backtrackFragment.start>y.end&&(this.backtrackFragment=null);const L=this.backtrackFragment?this.backtrackFragment.start:y.end;let N=this.getNextFragment(L,T);if(this.couldBacktrack&&!this.fragPrevious&&N&&Ar(N)&&this.fragmentTracker.getState(N)!==cr.OK){var x;const H=((x=this.backtrackFragment)!=null?x:N).sn-T.startSN,Q=T.fragments[H-1];Q&&N.cc===Q.cc&&(N=Q,this.fragmentTracker.removeFragment(Q))}else this.backtrackFragment&&y.len&&(this.backtrackFragment=null);if(N&&this.isLoopLoading(N,L)){if(!N.gap){const H=this.audioOnly&&!this.altAudio?ki.AUDIO:ki.VIDEO,Q=(H===ki.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;Q&&this.afterBufferFlushed(Q,H,Vt.MAIN)}N=this.getNextFragmentLoopLoading(N,T,y,Vt.MAIN,I)}N&&(N.initSegment&&!N.initSegment.data&&!this.bitrateTest&&(N=N.initSegment),this.loadFragment(N,g,L))}loadFragment(i,r,o){const d=this.fragmentTracker.getState(i);d===cr.NOT_LOADED||d===cr.PARTIAL?Ar(i)?this.bitrateTest?(this.log(`Fragment ${i.sn} of level ${i.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(i,r)):super.loadFragment(i,r,o):this._loadInitSegment(i,r):this.clearTrackerIfNeeded(i)}getBufferedFrag(i){return this.fragmentTracker.getBufferedFrag(i,Vt.MAIN)}followingBufferedFrag(i){return i?this.getBufferedFrag(i.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:i,media:r}=this;if(r!=null&&r.readyState){let o;const d=this.getAppendedFrag(r.currentTime);d&&d.start>1&&this.flushMainBuffer(0,d.start-1);const p=this.getLevelDetails();if(p!=null&&p.live){const y=this.getMainFwdBufferInfo();if(!y||y.len<p.targetduration*2)return}if(!r.paused&&i){const y=this.hls.nextLoadLevel,v=i[y],T=this.fragLastKbps;T&&this.fragCurrent?o=this.fragCurrent.duration*v.maxBitrate/(1e3*T)+1:o=0}else o=0;const g=this.getBufferedFrag(r.currentTime+o);if(g){const y=this.followingBufferedFrag(g);if(y){this.abortCurrentFrag();const v=y.maxStartPTS?y.maxStartPTS:y.start,T=y.duration,C=Math.max(g.end,v+Math.min(Math.max(T-this.config.maxFragLookUpTolerance,T*(this.couldBacktrack?.5:.125)),T*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(C,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const i=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,i&&(i.abortRequests(),this.fragmentTracker.removeFragment(i)),this.state){case ot.KEY_LOADING:case ot.FRAG_LOADING:case ot.FRAG_LOADING_WAITING_RETRY:case ot.PARSING:case ot.PARSED:this.state=ot.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(i,r){super.flushMainBuffer(i,r,this.altAudio===2?"video":null)}onMediaAttached(i,r){super.onMediaAttached(i,r);const o=r.media;Au(o,"playing",this.onMediaPlaying),Au(o,"seeked",this.onMediaSeeked)}onMediaDetaching(i,r){const{media:o}=this;o&&(_d(o,"playing",this.onMediaPlaying),_d(o,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(i,r),!r.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(z.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(i,r){let o=!1,d=!1;r.levels.forEach(p=>{const g=p.audioCodec;g&&(o=o||g.indexOf("mp4a.40.2")!==-1,d=d||g.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=o&&d&&!_se(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startFragRequested=!1}onLevelLoading(i,r){const{levels:o}=this;if(!o||this.state!==ot.IDLE)return;const d=r.levelInfo;(!d.details||d.details.live&&(this.levelLastLoaded!==d||d.details.expired)||this.waitForCdnTuneIn(d.details))&&(this.state=ot.WAITING_LEVEL)}onLevelLoaded(i,r){var o;const{levels:d,startFragRequested:p}=this,g=r.level,y=r.details,v=y.totalduration;if(!d){this.warn(`Levels were reset while loading level ${g}`);return}this.log(`Level ${g} loaded [${y.startSN},${y.endSN}]${y.lastPartSn?`[part-${y.lastPartSn}-${y.lastPartIndex}]`:""}, cc [${y.startCC}, ${y.endCC}] duration:${v}`);const T=r.levelInfo,C=this.fragCurrent;C&&(this.state===ot.FRAG_LOADING||this.state===ot.FRAG_LOADING_WAITING_RETRY)&&C.level!==r.level&&C.loader&&this.abortCurrentFrag();let I=0;if(y.live||(o=T.details)!=null&&o.live){var L;if(this.checkLiveUpdate(y),y.deltaUpdateFailed)return;I=this.alignPlaylists(y,T.details,(L=this.levelLastLoaded)==null?void 0:L.details)}if(T.details=y,this.levelLastLoaded=T,p||this.setStartPosition(y,I),this.hls.trigger(z.LEVEL_UPDATED,{details:y,level:g}),this.state===ot.WAITING_LEVEL){if(this.waitForCdnTuneIn(y))return;this.state=ot.IDLE}p&&y.live&&this.synchronizeToLiveEdge(y),this.tick()}synchronizeToLiveEdge(i){const{config:r,media:o}=this;if(!o)return;const d=this.hls.liveSyncPosition,p=this.getLoadPosition(),g=i.fragmentStart,y=i.edge,v=p>=g-r.maxFragLookUpTolerance&&p<=y;if(d!==null&&o.duration>d&&(p<d||!v)){const T=r.liveMaxLatencyDuration!==void 0?r.liveMaxLatencyDuration:r.liveMaxLatencyDurationCount*i.targetduration;(!v&&o.readyState<4||p<y-T)&&(this._hasEnoughToStart||(this.nextLoadPosition=d),o.readyState&&(this.warn(`Playback: ${p.toFixed(3)} is located too far from the end of live sliding playlist: ${y}, reset currentTime to : ${d.toFixed(3)}`),o.currentTime=d))}}_handleFragmentLoadProgress(i){var r;const o=i.frag,{part:d,payload:p}=i,{levels:g}=this;if(!g){this.warn(`Levels were reset while fragment load was in progress. Fragment ${o.sn} of level ${o.level} will not be buffered`);return}const y=g[o.level];if(!y){this.warn(`Level ${o.level} not found on progress`);return}const v=y.details;if(!v){this.warn(`Dropping fragment ${o.sn} of level ${o.level} after level details were reset`),this.fragmentTracker.removeFragment(o);return}const T=y.videoCodec,C=v.PTSKnown||!v.live,I=(r=o.initSegment)==null?void 0:r.data,L=this._getAudioCodec(y),N=this.transmuxer=this.transmuxer||new z5(this.hls,Vt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),x=d?d.index:-1,K=x!==-1,H=new bL(o.level,o.sn,o.stats.chunkCount,p.byteLength,x,K),Q=this.initPTS[o.cc];N.push(p,I,L,T,o,d,v.totalduration,C,H,Q)}onAudioTrackSwitching(i,r){const o=this.hls,d=this.altAudio===2;if(lC(r.url,o))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const g=this.fragCurrent;g&&(this.log("Switching to main audio track, cancel main fragment load"),g.abortRequests(),this.fragmentTracker.removeFragment(g)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(d){this.fragmentTracker.removeAllFragments(),o.once(z.BUFFER_FLUSHED,()=>{var g;(g=this.hls)==null||g.trigger(z.AUDIO_TRACK_SWITCHED,r)}),o.trigger(z.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}o.trigger(z.AUDIO_TRACK_SWITCHED,r)}}onAudioTrackSwitched(i,r){const o=lC(r.url,this.hls);if(o){const d=this.videoBuffer;d&&this.mediaBuffer!==d&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=o?2:0,this.tick()}onBufferCreated(i,r){const o=r.tracks;let d,p,g=!1;for(const y in o){const v=o[y];if(v.id==="main"){if(p=y,d=v,y==="video"){const T=o[y];T&&(this.videoBuffer=T.buffer)}}else g=!0}g&&d?(this.log(`Alternate track found, use ${p}.buffered to schedule main fragment loading`),this.mediaBuffer=d.buffer):this.mediaBuffer=this.media}onFragBuffered(i,r){const{frag:o,part:d}=r,p=o.type===Vt.MAIN;if(p){if(this.fragContextChanged(o)){this.warn(`Fragment ${o.sn}${d?" p: "+d.index:""} of level ${o.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ot.PARSED&&(this.state=ot.IDLE);return}const y=d?d.stats:o.stats;this.fragLastKbps=Math.round(8*y.total/(y.buffering.end-y.loading.first)),Ar(o)&&(this.fragPrevious=o),this.fragBufferedComplete(o,d)}const g=this.media;g&&(!this._hasEnoughToStart&&Dn.getBuffered(g).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),p&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(i,r){var o;if(r.fatal){this.state=ot.ERROR;return}switch(r.details){case Ue.FRAG_GAP:case Ue.FRAG_PARSING_ERROR:case Ue.FRAG_DECRYPT_ERROR:case Ue.FRAG_LOAD_ERROR:case Ue.FRAG_LOAD_TIMEOUT:case Ue.KEY_LOAD_ERROR:case Ue.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Vt.MAIN,r);break;case Ue.LEVEL_LOAD_ERROR:case Ue.LEVEL_LOAD_TIMEOUT:case Ue.LEVEL_PARSING_ERROR:!r.levelRetry&&this.state===ot.WAITING_LEVEL&&((o=r.context)==null?void 0:o.type)===Vn.LEVEL&&(this.state=ot.IDLE);break;case Ue.BUFFER_ADD_CODEC_ERROR:case Ue.BUFFER_APPEND_ERROR:if(r.parent!=="main")return;this.resetLoadingState();break;case Ue.BUFFER_FULL_ERROR:if(r.parent!=="main")return;this.reduceLengthAndFlushBuffer(r)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case Ue.INTERNAL_EXCEPTION:this.recoverWorkerError(r);break}}onFragLoadEmergencyAborted(){this.state=ot.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(i,{type:r}){if(r!==ki.AUDIO||!this.altAudio){const o=(r===ki.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;o&&(this.afterBufferFlushed(o,r,Vt.MAIN),this.tick())}}onLevelsUpdated(i,r){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=r.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:i}=this;if(!i)return;const r=i.currentTime;let o=this.startPosition;if(o>=0&&r<o){if(i.seeking){this.log(`could not seek to ${o}, already seeking at ${r}`);return}const d=this.timelineOffset;d&&o&&(o+=d);const p=this.getLevelDetails(),g=Dn.getBuffered(i),y=g.length?g.start(0):0,v=y-o,T=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);v>0&&(v<T||this.loadingParts&&v<2*((p==null?void 0:p.partTarget)||0))&&(this.log(`adjusting start position by ${v} to match buffer start`),o+=v,this.startPosition=o),r<o&&(this.log(`seek to target start position ${o} from current time ${r} buffer start ${y}`),i.currentTime=o)}}_getAudioCodec(i){let r=this.config.defaultAudioCodec||i.audioCodec;return this.audioCodecSwap&&r&&(this.log("Swapping audio codec"),r.indexOf("mp4a.40.5")!==-1?r="mp4a.40.2":r="mp4a.40.5"),r}_loadBitrateTestFrag(i,r){i.bitrateTest=!0,this._doFragLoad(i,r).then(o=>{const{hls:d}=this,p=o==null?void 0:o.frag;if(!p||this.fragContextChanged(p))return;r.fragmentError=0,this.state=ot.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const g=p.stats;g.parsing.start=g.parsing.end=g.buffering.start=g.buffering.end=self.performance.now(),d.trigger(z.FRAG_LOADED,o),p.bitrateTest=!1})}_handleTransmuxComplete(i){var r;const o=this.playlistType,{hls:d}=this,{remuxResult:p,chunkMeta:g}=i,y=this.getCurrentContext(g);if(!y){this.resetWhenMissingContext(g);return}const{frag:v,part:T,level:C}=y,{video:I,text:L,id3:N,initSegment:x}=p,{details:K}=C,H=this.altAudio?void 0:p.audio;if(this.fragContextChanged(v)){this.fragmentTracker.removeFragment(v);return}if(this.state=ot.PARSING,x){if(x!=null&&x.tracks){const ee=v.initSegment||v;this._bufferInitSegment(C,x.tracks,ee,g),d.trigger(z.FRAG_PARSING_INIT_SEGMENT,{frag:ee,id:o,tracks:x.tracks})}const Q=x.initPTS,ne=x.timescale;xt(Q)&&(this.initPTS[v.cc]={baseTime:Q,timescale:ne},d.trigger(z.INIT_PTS_FOUND,{frag:v,id:o,initPTS:Q,timescale:ne}))}if(I&&K){H&&I.type==="audiovideo"&&this.logMuxedErr(v);const Q=K.fragments[v.sn-1-K.startSN],ne=v.sn===K.startSN,ee=!Q||v.cc>Q.cc;if(p.independent!==!1){const{startPTS:pe,endPTS:de,startDTS:be,endDTS:Se}=I;if(T)T.elementaryStreams[I.type]={startPTS:pe,endPTS:de,startDTS:be,endDTS:Se};else if(I.firstKeyFrame&&I.independent&&g.id===1&&!ee&&(this.couldBacktrack=!0),I.dropped&&I.independent){const Te=this.getMainFwdBufferInfo(),_e=(Te?Te.end:this.getLoadPosition())+this.config.maxBufferHole,he=I.firstKeyFramePTS?I.firstKeyFramePTS:pe;if(!ne&&_e<he-this.config.maxBufferHole&&!ee){this.backtrack(v);return}else ee&&(v.gap=!0);v.setElementaryStreamInfo(I.type,v.start,de,v.start,Se,!0)}else ne&&pe-(K.appliedTimelineOffset||0)>ZA&&(v.gap=!0);v.setElementaryStreamInfo(I.type,pe,de,be,Se),this.backtrackFragment&&(this.backtrackFragment=v),this.bufferFragmentData(I,v,T,g,ne||ee)}else if(ne||ee)v.gap=!0;else{this.backtrack(v);return}}if(H){const{startPTS:Q,endPTS:ne,startDTS:ee,endDTS:pe}=H;T&&(T.elementaryStreams[ki.AUDIO]={startPTS:Q,endPTS:ne,startDTS:ee,endDTS:pe}),v.setElementaryStreamInfo(ki.AUDIO,Q,ne,ee,pe),this.bufferFragmentData(H,v,T,g)}if(K&&N!=null&&(r=N.samples)!=null&&r.length){const Q={id:o,frag:v,details:K,samples:N.samples};d.trigger(z.FRAG_PARSING_METADATA,Q)}if(K&&L){const Q={id:o,frag:v,details:K,samples:L.samples};d.trigger(z.FRAG_PARSING_USERDATA,Q)}}logMuxedErr(i){this.warn(`${Ar(i)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${i.url}`)}_bufferInitSegment(i,r,o,d){if(this.state!==ot.PARSING)return;this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&(delete r.audio,r.audiovideo&&this.logMuxedErr(o));const{audio:p,video:g,audiovideo:y}=r;if(p){let T=qA(p.codec,i.audioCodec);T==="mp4a"&&(T="mp4a.40.5");const C=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){T&&(T.indexOf("mp4a.40.5")!==-1?T="mp4a.40.2":T="mp4a.40.5");const I=p.metadata;I&&"channelCount"in I&&(I.channelCount||1)!==1&&C.indexOf("firefox")===-1&&(T="mp4a.40.5")}T&&T.indexOf("mp4a.40.5")!==-1&&C.indexOf("android")!==-1&&p.container!=="audio/mpeg"&&(T="mp4a.40.2",this.log(`Android: force audio codec to ${T}`)),i.audioCodec&&i.audioCodec!==T&&this.log(`Swapping manifest audio codec "${i.audioCodec}" for "${T}"`),p.levelCodec=T,p.id=Vt.MAIN,this.log(`Init audio buffer, container:${p.container}, codecs[selected/level/parsed]=[${T||""}/${i.audioCodec||""}/${p.codec}]`),delete r.audiovideo}if(g){g.levelCodec=i.videoCodec,g.id=Vt.MAIN;const T=g.codec;if((T==null?void 0:T.length)===4)switch(T){case"hvc1":case"hev1":g.codec="hvc1.1.6.L120.90";break;case"av01":g.codec="av01.0.04M.08";break;case"avc1":g.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${g.container}, codecs[level/parsed]=[${i.videoCodec||""}/${T}]${g.codec!==T?" parsed-corrected="+g.codec:""}${g.supplemental?" supplemental="+g.supplemental:""}`),delete r.audiovideo}y&&(this.log(`Init audiovideo buffer, container:${y.container}, codecs[level/parsed]=[${i.codecs}/${y.codec}]`),delete r.video,delete r.audio);const v=Object.keys(r);if(v.length){if(this.hls.trigger(z.BUFFER_CODECS,r),!this.hls)return;v.forEach(T=>{const I=r[T].initSegment;I!=null&&I.byteLength&&this.hls.trigger(z.BUFFER_APPENDING,{type:T,data:I,frag:o,part:null,chunkMeta:d,parent:o.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const i=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(i,Vt.MAIN)}get maxBufferLength(){const{levels:i,level:r}=this,o=i==null?void 0:i[r];return o?this.getMaxBufferLength(o.maxBitrate):this.config.maxBufferLength}backtrack(i){this.couldBacktrack=!0,this.backtrackFragment=i,this.resetTransmuxer(),this.flushBufferGap(i),this.fragmentTracker.removeFragment(i),this.fragPrevious=null,this.nextLoadPosition=i.start,this.state=ot.IDLE}checkFragmentChanged(){const i=this.media;let r=null;if(i&&i.readyState>1&&i.seeking===!1){const o=i.currentTime;if(Dn.isBuffered(i,o)?r=this.getAppendedFrag(o):Dn.isBuffered(i,o+.1)&&(r=this.getAppendedFrag(o+.1)),r){this.backtrackFragment=null;const d=this.fragPlaying,p=r.level;(!d||r.sn!==d.sn||d.level!==p)&&(this.fragPlaying=r,this.hls.trigger(z.FRAG_CHANGED,{frag:r}),(!d||d.level!==p)&&this.hls.trigger(z.LEVEL_SWITCHED,{level:p}))}}}get nextLevel(){const i=this.nextBufferedFrag;return i?i.level:-1}get currentFrag(){var i;if(this.fragPlaying)return this.fragPlaying;const r=((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime;return xt(r)?this.getAppendedFrag(r):null}get currentProgramDateTime(){var i;const r=((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime;if(xt(r)){const o=this.getLevelDetails(),d=this.currentFrag||(o?xm(null,o.fragments,r):null);if(d){const p=d.programDateTime;if(p!==null){const g=p+(r-d.start)*1e3;return new Date(g)}}}return null}get currentLevel(){const i=this.currentFrag;return i?i.level:-1}get nextBufferedFrag(){const i=this.currentFrag;return i?this.followingBufferedFrag(i):null}get forceStartLoad(){return this._forceStartLoad}}class Tse{constructor(i){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=i}abort(i){for(const o in this.keyUriToKeyInfo){const d=this.keyUriToKeyInfo[o].loader;if(d){var r;if(i&&i!==((r=d.context)==null?void 0:r.frag.type))return;d.abort()}}}detach(){for(const i in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[i];(r.mediaKeySessionContext||r.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[i]}}destroy(){this.detach();for(const i in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[i].loader;r&&r.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(i,r=Ue.KEY_LOAD_ERROR,o,d,p){return new vu({type:Gt.NETWORK_ERROR,details:r,fatal:!1,frag:i,response:p,error:o,networkDetails:d})}loadClear(i,r){if(this.emeController&&this.config.emeEnabled){const{sn:o,cc:d}=i;for(let p=0;p<r.length;p++){const g=r[p];if(d<=g.cc&&(o==="initSegment"||g.sn==="initSegment"||o<g.sn)){this.emeController.selectKeySystemFormat(g).then(y=>{g.setKeyFormat(y)});break}}}}load(i){return!i.decryptdata&&i.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(i).then(r=>this.loadInternal(i,r)):this.loadInternal(i)}loadInternal(i,r){var o,d;r&&i.setKeyFormat(r);const p=i.decryptdata;if(!p){const T=new Error(r?`Expected frag.decryptdata to be defined after setting format ${r}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(i,Ue.KEY_LOAD_ERROR,T))}const g=p.uri;if(!g)return Promise.reject(this.createKeyLoadError(i,Ue.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${g}"`)));let y=this.keyUriToKeyInfo[g];if((o=y)!=null&&o.decryptdata.key)return p.key=y.decryptdata.key,Promise.resolve({frag:i,keyInfo:y});if((d=y)!=null&&d.keyLoadPromise){var v;switch((v=y.mediaKeySessionContext)==null?void 0:v.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return y.keyLoadPromise.then(T=>(p.key=T.keyInfo.decryptdata.key,{frag:i,keyInfo:y}))}}switch(y=this.keyUriToKeyInfo[g]={decryptdata:p,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},p.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return p.keyFormat==="identity"?this.loadKeyHTTP(y,i):this.loadKeyEME(y,i);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(y,i);default:return Promise.reject(this.createKeyLoadError(i,Ue.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${p.method}"`)))}}loadKeyEME(i,r){const o={frag:r,keyInfo:i};if(this.emeController&&this.config.emeEnabled){const d=this.emeController.loadKey(o);if(d)return(i.keyLoadPromise=d.then(p=>(i.mediaKeySessionContext=p,o))).catch(p=>{throw i.keyLoadPromise=null,p})}return Promise.resolve(o)}loadKeyHTTP(i,r){const o=this.config,d=o.loader,p=new d(o);return r.keyLoader=i.loader=p,i.keyLoadPromise=new Promise((g,y)=>{const v={keyInfo:i,frag:r,responseType:"arraybuffer",url:i.decryptdata.uri},T=o.keyLoadPolicy.default,C={loadPolicy:T,timeout:T.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},I={onSuccess:(L,N,x,K)=>{const{frag:H,keyInfo:Q,url:ne}=x;if(!H.decryptdata||Q!==this.keyUriToKeyInfo[ne])return y(this.createKeyLoadError(H,Ue.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),K));Q.decryptdata.key=H.decryptdata.key=new Uint8Array(L.data),H.keyLoader=null,Q.loader=null,g({frag:H,keyInfo:Q})},onError:(L,N,x,K)=>{this.resetLoader(N),y(this.createKeyLoadError(r,Ue.KEY_LOAD_ERROR,new Error(`HTTP Error ${L.code} loading key ${L.text}`),x,Ii({url:v.url,data:void 0},L)))},onTimeout:(L,N,x)=>{this.resetLoader(N),y(this.createKeyLoadError(r,Ue.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),x))},onAbort:(L,N,x)=>{this.resetLoader(N),y(this.createKeyLoadError(r,Ue.INTERNAL_ABORTED,new Error("key loading aborted"),x))}};p.load(v,C,I)})}resetLoader(i){const{frag:r,keyInfo:o,url:d}=i,p=o.loader;r.keyLoader===p&&(r.keyLoader=null,o.loader=null),delete this.keyUriToKeyInfo[d],p&&p.destroy()}}function J4(h){const{type:i}=h;switch(i){case Vn.AUDIO_TRACK:return Vt.AUDIO;case Vn.SUBTITLE_TRACK:return Vt.SUBTITLE;default:return Vt.MAIN}}function RN(h,i){let r=h.url;return(r===void 0||r.indexOf("data:")===0)&&(r=i.url),r}class vse{constructor(i){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=i,this.registerListeners()}startLoad(i){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:i}=this;i.on(z.MANIFEST_LOADING,this.onManifestLoading,this),i.on(z.LEVEL_LOADING,this.onLevelLoading,this),i.on(z.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),i.on(z.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),i.on(z.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:i}=this;i.off(z.MANIFEST_LOADING,this.onManifestLoading,this),i.off(z.LEVEL_LOADING,this.onLevelLoading,this),i.off(z.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),i.off(z.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),i.off(z.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(i){const r=this.hls.config,o=r.pLoader,d=r.loader,p=o||d,g=new p(r);return this.loaders[i.type]=g,g}getInternalLoader(i){return this.loaders[i.type]}resetInternalLoader(i){this.loaders[i]&&delete this.loaders[i]}destroyInternalLoaders(){for(const i in this.loaders){const r=this.loaders[i];r&&r.destroy(),this.resetInternalLoader(i)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(i,r){const{url:o}=r;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Vn.MANIFEST,url:o,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(i,r){const{id:o,level:d,pathwayId:p,url:g,deliveryDirectives:y,levelInfo:v}=r;this.load({id:o,level:d,pathwayId:p,responseType:"text",type:Vn.LEVEL,url:g,deliveryDirectives:y,levelOrTrack:v})}onAudioTrackLoading(i,r){const{id:o,groupId:d,url:p,deliveryDirectives:g,track:y}=r;this.load({id:o,groupId:d,level:null,responseType:"text",type:Vn.AUDIO_TRACK,url:p,deliveryDirectives:g,levelOrTrack:y})}onSubtitleTrackLoading(i,r){const{id:o,groupId:d,url:p,deliveryDirectives:g,track:y}=r;this.load({id:o,groupId:d,level:null,responseType:"text",type:Vn.SUBTITLE_TRACK,url:p,deliveryDirectives:g,levelOrTrack:y})}onLevelsUpdated(i,r){const o=this.loaders[Vn.LEVEL];if(o){const d=o.context;d&&!r.levels.some(p=>p===d.levelOrTrack)&&(o.abort(),delete this.loaders[Vn.LEVEL])}}load(i){var r;const o=this.hls.config;let d=this.getInternalLoader(i);if(d){const T=this.hls.logger,C=d.context;if(C&&C.levelOrTrack===i.levelOrTrack&&(C.url===i.url||C.deliveryDirectives&&!i.deliveryDirectives)){C.url===i.url?T.log(`[playlist-loader]: ignore ${i.url} ongoing request`):T.log(`[playlist-loader]: ignore ${i.url} in favor of ${C.url}`);return}T.log(`[playlist-loader]: aborting previous loader for type: ${i.type}`),d.abort()}let p;if(i.type===Vn.MANIFEST?p=o.manifestLoadPolicy.default:p=Mi({},o.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),d=this.createInternalLoader(i),xt((r=i.deliveryDirectives)==null?void 0:r.part)){let T;if(i.type===Vn.LEVEL&&i.level!==null?T=this.hls.levels[i.level].details:i.type===Vn.AUDIO_TRACK&&i.id!==null?T=this.hls.audioTracks[i.id].details:i.type===Vn.SUBTITLE_TRACK&&i.id!==null&&(T=this.hls.subtitleTracks[i.id].details),T){const C=T.partTarget,I=T.targetduration;if(C&&I){const L=Math.max(C*3,I*.8)*1e3;p=Mi({},p,{maxTimeToFirstByteMs:Math.min(L,p.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(L,p.maxTimeToFirstByteMs)})}}}const g=p.errorRetry||p.timeoutRetry||{},y={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:g.maxNumRetry||0,retryDelay:g.retryDelayMs||0,maxRetryDelay:g.maxRetryDelayMs||0},v={onSuccess:(T,C,I,L)=>{const N=this.getInternalLoader(I);this.resetInternalLoader(I.type);const x=T.data;if(x.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(T,I,new Error("no EXTM3U delimiter"),L||null,C);return}C.parsing.start=performance.now(),Ed.isMediaPlaylist(x)||I.type!==Vn.MANIFEST?this.handleTrackOrLevelPlaylist(T,C,I,L||null,N):this.handleMasterPlaylist(T,C,I,L)},onError:(T,C,I,L)=>{this.handleNetworkError(C,I,!1,T,L)},onTimeout:(T,C,I)=>{this.handleNetworkError(C,I,!0,void 0,T)}};d.load(i,y,v)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:i,startPosition:r},forceStartLoad:o}=this.hls;(i||o)&&(this.hls.logger.log(`${i?"auto":"force"} startLoad with configured startPosition ${r}`),this.hls.startLoad(r))}handleMasterPlaylist(i,r,o,d){const p=this.hls,g=i.data,y=RN(i,o),v=Ed.parseMasterPlaylist(g,y);if(v.playlistParsingError){this.handleManifestParsingError(i,o,v.playlistParsingError,d,r);return}const{contentSteering:T,levels:C,sessionData:I,sessionKeys:L,startTimeOffset:N,variableList:x}=v;this.variableList=x;const{AUDIO:K=[],SUBTITLES:H,"CLOSED-CAPTIONS":Q}=Ed.parseMasterPlaylistMedia(g,y,v);K.length&&!K.some(ee=>!ee.url)&&C[0].audioCodec&&!C[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),K.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ss({}),bitrate:0,url:""})),p.trigger(z.MANIFEST_LOADED,{levels:C,audioTracks:K,subtitles:H,captions:Q,contentSteering:T,url:y,stats:r,networkDetails:d,sessionData:I,sessionKeys:L,startTimeOffset:N,variableList:x})}handleTrackOrLevelPlaylist(i,r,o,d,p){const g=this.hls,{id:y,level:v,type:T}=o,C=RN(i,o),I=xt(v)?v:xt(y)?y:0,L=J4(o),N=Ed.parseLevelPlaylist(i.data,C,I,L,0,this.variableList);if(T===Vn.MANIFEST){const x={attrs:new Ss({}),bitrate:0,details:N,name:"",url:C};N.requestScheduled=r.loading.start+b5(N,0),g.trigger(z.MANIFEST_LOADED,{levels:[x],audioTracks:[],url:C,stats:r,networkDetails:d,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}r.parsing.end=performance.now(),o.levelDetails=N,this.handlePlaylistLoaded(N,i,r,o,d,p)}handleManifestParsingError(i,r,o,d,p){this.hls.trigger(z.ERROR,{type:Gt.NETWORK_ERROR,details:Ue.MANIFEST_PARSING_ERROR,fatal:r.type===Vn.MANIFEST,url:i.url,err:o,error:o,reason:o.message,response:i,context:r,networkDetails:d,stats:p})}handleNetworkError(i,r,o=!1,d,p){let g=`A network ${o?"timeout":"error"+(d?" (status "+d.code+")":"")} occurred while loading ${i.type}`;i.type===Vn.LEVEL?g+=`: ${i.level} id: ${i.id}`:(i.type===Vn.AUDIO_TRACK||i.type===Vn.SUBTITLE_TRACK)&&(g+=` id: ${i.id} group-id: "${i.groupId}"`);const y=new Error(g);this.hls.logger.warn(`[playlist-loader]: ${g}`);let v=Ue.UNKNOWN,T=!1;const C=this.getInternalLoader(i);switch(i.type){case Vn.MANIFEST:v=o?Ue.MANIFEST_LOAD_TIMEOUT:Ue.MANIFEST_LOAD_ERROR,T=!0;break;case Vn.LEVEL:v=o?Ue.LEVEL_LOAD_TIMEOUT:Ue.LEVEL_LOAD_ERROR,T=!1;break;case Vn.AUDIO_TRACK:v=o?Ue.AUDIO_TRACK_LOAD_TIMEOUT:Ue.AUDIO_TRACK_LOAD_ERROR,T=!1;break;case Vn.SUBTITLE_TRACK:v=o?Ue.SUBTITLE_TRACK_LOAD_TIMEOUT:Ue.SUBTITLE_LOAD_ERROR,T=!1;break}C&&this.resetInternalLoader(i.type);const I={type:Gt.NETWORK_ERROR,details:v,fatal:T,url:i.url,loader:C,context:i,error:y,networkDetails:r,stats:p};if(d){const L=(r==null?void 0:r.url)||i.url;I.response=Ii({url:L,data:void 0},d)}this.hls.trigger(z.ERROR,I)}handlePlaylistLoaded(i,r,o,d,p,g){const y=this.hls,{type:v,level:T,id:C,groupId:I,deliveryDirectives:L}=d,N=RN(r,d),x=J4(d),K=typeof d.level=="number"&&x===Vt.MAIN?T:void 0;if(!i.fragments.length){const Q=i.playlistParsingError=new Error("No Segments found in Playlist");y.trigger(z.ERROR,{type:Gt.NETWORK_ERROR,details:Ue.LEVEL_EMPTY_ERROR,fatal:!1,url:N,error:Q,reason:Q.message,response:r,context:d,level:K,parent:x,networkDetails:p,stats:o});return}i.targetduration||(i.playlistParsingError=new Error("Missing Target Duration"));const H=i.playlistParsingError;if(H){if(this.hls.logger.warn(H),!y.config.ignorePlaylistParsingErrors){y.trigger(z.ERROR,{type:Gt.NETWORK_ERROR,details:Ue.LEVEL_PARSING_ERROR,fatal:!1,url:N,error:H,reason:H.message,response:r,context:d,level:K,parent:x,networkDetails:p,stats:o});return}i.playlistParsingError=null}switch(i.live&&g&&(g.getCacheAge&&(i.ageHeader=g.getCacheAge()||0),(!g.getCacheAge||isNaN(i.ageHeader))&&(i.ageHeader=0)),v){case Vn.MANIFEST:case Vn.LEVEL:y.trigger(z.LEVEL_LOADED,{details:i,levelInfo:d.levelOrTrack||y.levels[0],level:K||0,id:C||0,stats:o,networkDetails:p,deliveryDirectives:L,withoutMultiVariant:v===Vn.MANIFEST});break;case Vn.AUDIO_TRACK:y.trigger(z.AUDIO_TRACK_LOADED,{details:i,track:d.levelOrTrack,id:C||0,groupId:I||"",stats:o,networkDetails:p,deliveryDirectives:L});break;case Vn.SUBTITLE_TRACK:y.trigger(z.SUBTITLE_TRACK_LOADED,{details:i,track:d.levelOrTrack,id:C||0,groupId:I||"",stats:o,networkDetails:p,deliveryDirectives:L});break}}}class Ru{static get version(){return hT}static isMSESupported(){return E6()}static isSupported(){return Ese()}static getMediaSource(){return uf()}static get Events(){return z}static get MetadataSchema(){return Eo}static get ErrorTypes(){return Gt}static get ErrorDetails(){return Ue}static get DefaultConfig(){return Ru.defaultConfig?Ru.defaultConfig:sse}static set DefaultConfig(i){Ru.defaultConfig=i}constructor(i={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new IL,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const r=this.logger=jZ(i.debug||!1,"Hls instance",i.assetPlayerId),o=this.config=ase(Ru.DefaultConfig,i,r);this.userConfig=i,o.progressive&&ose(o,r);const{abrController:d,bufferController:p,capLevelController:g,errorController:y,fpsController:v}=o,T=new y(this),C=this.abrController=new d(this),I=new xee(this),L=o.interstitialsController,N=L?this.interstitialsController=new L(this,Ru):null,x=this.bufferController=new p(this,I),K=this.capLevelController=new g(this),H=new v(this),Q=new vse(this),ne=o.contentSteeringController,ee=ne?new ne(this):null,pe=this.levelController=new gse(this,ee),de=new pse(this),be=new Tse(this.config),Se=this.streamController=new yse(this,I,be),Te=this.gapController=new use(this,I);K.setStreamController(Se),H.setStreamController(Se);const _e=[Q,pe,Se];N&&_e.splice(1,0,N),ee&&_e.splice(1,0,ee),this.networkControllers=_e;const he=[C,x,Te,K,H,de,I];this.audioTrackController=this.createController(o.audioTrackController,_e);const Ge=o.audioStreamController;Ge&&_e.push(this.audioStreamController=new Ge(this,I,be)),this.subtitleTrackController=this.createController(o.subtitleTrackController,_e);const st=o.subtitleStreamController;st&&_e.push(this.subtititleStreamController=new st(this,I,be)),this.createController(o.timelineController,he),be.emeController=this.emeController=this.createController(o.emeController,he),this.cmcdController=this.createController(o.cmcdController,he),this.latencyController=this.createController(mse,he),this.coreComponents=he,_e.push(T);const It=T.onErrorOut;typeof It=="function"&&this.on(z.ERROR,It,T),this.on(z.MANIFEST_LOADED,Q.onManifestLoaded,Q)}createController(i,r){if(i){const o=new i(this);return r&&r.push(o),o}return null}on(i,r,o=this){this._emitter.on(i,r,o)}once(i,r,o=this){this._emitter.once(i,r,o)}removeAllListeners(i){this._emitter.removeAllListeners(i)}off(i,r,o=this,d){this._emitter.off(i,r,o,d)}listeners(i){return this._emitter.listeners(i)}emit(i,r,o){return this._emitter.emit(i,r,o)}trigger(i,r){if(this.config.debug)return this.emit(i,i,r);try{return this.emit(i,i,r)}catch(o){if(this.logger.error("An internal error happened while handling event "+i+'. Error message: "'+o.message+'". Here is a stacktrace:',o),!this.triggeringException){this.triggeringException=!0;const d=i===z.ERROR;this.trigger(z.ERROR,{type:Gt.OTHER_ERROR,details:Ue.INTERNAL_EXCEPTION,fatal:d,event:i,error:o}),this.triggeringException=!1}}return!1}listenerCount(i){return this._emitter.listenerCount(i)}destroy(){this.logger.log("destroy"),this.trigger(z.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(r=>r.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(r=>r.destroy()),this.coreComponents.length=0;const i=this.config;i.xhrSetup=i.fetchSetup=void 0,this.userConfig=null}attachMedia(i){if(!i||"media"in i&&!i.media){const p=new Error(`attachMedia failed: invalid argument (${i})`);this.trigger(z.ERROR,{type:Gt.OTHER_ERROR,details:Ue.ATTACH_MEDIA_ERROR,fatal:!0,error:p});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const r="media"in i,o=r?i.media:i,d=r?i:{media:o};this._media=o,this.trigger(z.MEDIA_ATTACHING,d)}detachMedia(){this.logger.log("detachMedia"),this.trigger(z.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const i=this.bufferController.transferMedia();return this.trigger(z.MEDIA_DETACHING,{transferMedia:i}),i}loadSource(i){this.stopLoad();const r=this.media,o=this._url,d=this._url=EL.buildAbsoluteURL(self.location.href,i,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${d}`),r&&o&&(o!==d||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(r)),this.trigger(z.MANIFEST_LOADING,{url:i})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(i=-1,r){this.logger.log(`startLoad(${i+(r?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let o=0;o<this.networkControllers.length&&(this.networkControllers[o].startLoad(i,r),!(!this.started||!this.networkControllers));o++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].stopLoad(),!(this.started||!this.networkControllers));i++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(i=>{i.resumeBuffering&&i.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(i=>{i.pauseBuffering&&i.pauseBuffering()}))}get inFlightFragments(){const i={[Vt.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(i[Vt.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(i[Vt.SUBTITLE]=this.subtititleStreamController.inFlightFrag),i}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const i=this._media,r=i==null?void 0:i.currentTime;this.detachMedia(),i&&(this.attachMedia(i),r&&this.startLoad(r))}removeLevel(i){this.levelController.removeLevel(i)}get sessionId(){let i=this._sessionId;return i||(i=this._sessionId=Nte()),i}get levels(){const i=this.levelController.levels;return i||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(i){this.logger.log(`set currentLevel:${i}`),this.levelController.manualLevel=i,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(i){this.logger.log(`set nextLevel:${i}`),this.levelController.manualLevel=i,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(i){this.logger.log(`set loadLevel:${i}`),this.levelController.manualLevel=i}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(i){this.levelController.nextLoadLevel=i}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(i){this.logger.log(`set firstLevel:${i}`),this.levelController.firstLevel=i}get startLevel(){const i=this.levelController.startLevel;return i===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:i}set startLevel(i){this.logger.log(`set startLevel:${i}`),i!==-1&&(i=Math.max(i,this.minAutoLevel)),this.levelController.startLevel=i}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(i){const r=!!i;r!==this.config.capLevelToPlayerSize&&(r?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=r)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:i}=this.abrController;return i?i.getEstimate():NaN}set bandwidthEstimate(i){this.abrController.resetEstimator(i)}get abrEwmaDefaultEstimate(){const{bwEstimator:i}=this.abrController;return i?i.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:i}=this.abrController;return i?i.getEstimateTTFB():NaN}set autoLevelCapping(i){this._autoLevelCapping!==i&&(this.logger.log(`set autoLevelCapping:${i}`),this._autoLevelCapping=i,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(i){gee(i)&&this._maxHdcpLevel!==i&&(this._maxHdcpLevel=i,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:i,config:{minAutoBitrate:r}}=this;if(!i)return 0;const o=i.length;for(let d=0;d<o;d++)if(i[d].maxBitrate>=r)return d;return 0}get maxAutoLevel(){const{levels:i,autoLevelCapping:r,maxHdcpLevel:o}=this;let d;if(r===-1&&i!=null&&i.length?d=i.length-1:d=r,o)for(let p=d;p--;){const g=i[p].attrs["HDCP-LEVEL"];if(g&&g<=o)return p}return d}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(i){this.abrController.nextAutoLevel=i}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(i){var r;return((r=this.audioTrackController)==null?void 0:r.setAudioOption(i))||null}setSubtitleOption(i){var r;return((r=this.subtitleTrackController)==null?void 0:r.setSubtitleOption(i))||null}get allAudioTracks(){const i=this.audioTrackController;return i?i.allAudioTracks:[]}get audioTracks(){const i=this.audioTrackController;return i?i.audioTracks:[]}get audioTrack(){const i=this.audioTrackController;return i?i.audioTrack:-1}set audioTrack(i){const r=this.audioTrackController;r&&(r.audioTrack=i)}get allSubtitleTracks(){const i=this.subtitleTrackController;return i?i.allSubtitleTracks:[]}get subtitleTracks(){const i=this.subtitleTrackController;return i?i.subtitleTracks:[]}get subtitleTrack(){const i=this.subtitleTrackController;return i?i.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(i){const r=this.subtitleTrackController;r&&(r.subtitleTrack=i)}get subtitleDisplay(){const i=this.subtitleTrackController;return i?i.subtitleDisplay:!1}set subtitleDisplay(i){const r=this.subtitleTrackController;r&&(r.subtitleDisplay=i)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(i){this.config.lowLatencyMode=i}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(i){this.latencyController.targetLatency=i}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(i){this.levelController.pathwayPriority=i}get bufferedToEnd(){var i;return!!((i=this.bufferController)!=null&&i.bufferedToEnd)}get interstitialsManager(){var i;return((i=this.interstitialsController)==null?void 0:i.interstitialsManager)||null}getMediaDecodingInfo(i,r=this.allAudioTracks){const o=f5(r);return h5(i,o,navigator.mediaCapabilities)}}Ru.defaultConfig=void 0;const bse=({url:h,shouldPlay:i})=>{const r=fe.useRef(null);return fe.useEffect(()=>{if(!h||!i)return;const o=r.current;let d;return Ru.isSupported()?(d=new Ru,d.loadSource(h),d.attachMedia(o),o.play()):o.canPlayType("application/vnd.apple.mpegurl")&&(o.src=h,o.play()),()=>{d&&d.destroy()}},[h,i]),i&&M.jsx("video",{ref:r,controls:!0,style:{width:"100%",height:"40px"}})};function Rse(){fe.useRef(null);const[h,i]=fe.useState(null),[r,o]=fe.useState([]),[d,p]=fe.useState([]),[g,y]=fe.useState(null),[v,T]=fe.useState(""),[C,I]=fe.useState([]),[L,N]=fe.useState(1),x=7,[K,H]=fe.useState(!1),[Q,ne]=fe.useState(null),[ee,pe]=fe.useState(!1),[de,be]=fe.useState(!0),[Se,Te]=fe.useState(!0),[_e,he]=fe.useState(!1);fe.useEffect(()=>{(async()=>{Te(!0);const se=localStorage.getItem("admin_id");try{const He=await(await fetch(`https://api.skaivoice.live/v1/agora-recording/agora-recording/admin/${se}`)).json();if(!He.recordings){Te(!1);return}const ct=He.recordings.filter(St=>St.filename.endsWith(".m3u8")).reverse(),Be=new Set,Et=[];for(const St of ct){const it=St.url.split("/"),Ze=it.length>4?it[4]:null;if(Ze&&!Be.has(Ze)){Be.add(Ze);try{const bt=await(await fetch(`https://api.skaivoice.live/v1/agora-recording/teams/${Ze}`)).json();Et.push({id:Ze,name:bt.name})}catch(mt){console.error(`Failed to fetch name for team ${Ze}`,mt),Et.push({id:Ze,name:"Unknown"})}}}console.log("Filtered .m3u8 teams with names:",Et),I(Et)}catch(we){console.error("Error fetching .m3u8 recordings:",we)}Te(!1)})()},[]),fe.useEffect(()=>{if(h){Te(!0);const Re=h.id;fetch(`https://api.skaivoice.live/v1/agora-recording/agora-recording/${Re}`).then(se=>se.json()).then(se=>{console.log("data.recordings",se.recordings);const we=(se.recordings||[]).filter(He=>He.filename.endsWith(".m3u8"));o(we),p([]),Te(!1)}).catch(se=>console.error("Error fetching recordings:",se))}},[h,de]);const Ge=Re=>{y(g===Re?null:Re)},st=async()=>{he(!0),console.log("test",Q==null?void 0:Q.url);let Re=[];ee?(console.log("multiple"),Re=d.map(se=>se.url)):Q&&(console.log("single"),Re=[Q==null?void 0:Q.url]),console.log("filesToDelete",Re);try{const we=await(await fetch("https://api.skaivoice.live/v1/agora-recording/delete-recording-by-url",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:Re})})).json();be(!1),he(!1),H(!1),we.success?(o(He=>He.filter(ct=>!Re.some(Be=>Be.filename===ct.filename))),p([]),H(!1),pe(!1)):console.error("Delete failed:",we.message)}catch(se){console.error("Error deleting files:",se)}},It=Re=>{p(se=>se.some(we=>we.filename===Re.filename)?se.filter(we=>we.filename!==Re.filename):[...se,Re])},qe=()=>{const Re=Oe;if(Re.every(we=>d.some(He=>He.filename===we.filename)))p(we=>we.filter(He=>!Re.some(ct=>ct.filename===He.filename)));else{const we=Re.filter(He=>!d.some(ct=>ct.filename===He.filename));p(He=>[...He,...we])}},ut=C.filter(Re=>Re.id.includes(v.toLowerCase())),Oe=h?r.slice((L-1)*x,L*x):ut.slice((L-1)*x,L*x),Qe=Math.ceil(h?r.length/x:ut.length/x),Ke=Re=>{i(Re),N(1)};return console.log("selectedFileToDelete",Q),M.jsxs(M.Fragment,{children:[M.jsx(gL,{}),M.jsxs("div",{className:"container mx-auto p-3 md:w-4/5 w-full",children:[M.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mb-4",children:[h&&M.jsx("button",{onClick:()=>{i(null),o([]),N(1)},className:"mt-4 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"Back to All Teams"}),M.jsx("h1",{className:"text-xl font-semibold py-2",children:h?`Team: ${h.name}`:"All Teams"}),M.jsxs("div",{className:"relative md:w-1/3 w-full",children:[M.jsx("input",{type:"text",placeholder:"Search teams...",className:"w-full p-2 pl-10 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200",value:v,onChange:Re=>{T(Re.target.value),N(1)}}),M.jsx(vT,{className:"absolute left-3 top-2.5 text-gray-400",size:20})]})]}),h&&d.length>0&&M.jsx("div",{className:"mb-4",children:M.jsxs("button",{onClick:()=>{pe(!0),H(!0)},className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition",children:[M.jsx(O_,{size:18})," Delete Selected (",d.length,")"]})}),Se?M.jsx("div",{className:"flex justify-center items-center h-48",children:M.jsxs("svg",{className:"animate-spin h-8 w-8 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[M.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),M.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]})}):M.jsx("div",{className:"overflow-x-auto shadow-lg rounded-lg",children:M.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[M.jsx("thead",{className:"bg-blue-600 text-white",children:M.jsxs("tr",{children:[h&&M.jsx("th",{className:"px-4 py-3",children:M.jsx("input",{type:"checkbox",checked:Oe.every(Re=>d.some(se=>se.filename===Re.filename)),onChange:qe})}),!h&&M.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold",children:"Team Name"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:h?"Date":"Actions"}),h&&M.jsxs(M.Fragment,{children:[M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Recording"}),M.jsx("th",{className:"px-6 py-3 text-center text-sm font-semibold",children:"Delete"})]})]})}),h&&Oe.length===0?M.jsx("tbody",{children:M.jsx("tr",{children:M.jsx("td",{className:"px-6 py-8 text-center text-gray-500 text-sm",colSpan:5,children:"Recording Not Available"})})}):M.jsx("tbody",{className:"divide-y divide-gray-300 bg-white",children:h?Oe.map((Re,se)=>M.jsxs("tr",{className:"hover:bg-gray-100 transition",children:[M.jsx("td",{className:"px-4 py-4 text-center",children:M.jsx("input",{type:"checkbox",checked:d.some(we=>we.filename===Re.filename),onChange:()=>It(Re)})}),M.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800 text-center",children:Re.lastModified?new Date(Re.lastModified).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0}):"Not Available"}),M.jsxs("td",{className:"px-6 py-4 text-center",children:[M.jsx("button",{className:"text-blue-500 hover:text-blue-700 transition",onClick:()=>Ge(se),children:g===se?"Pause":"Play"}),g===se&&M.jsx(bse,{url:Re.url,shouldPlay:!0})]}),M.jsx("td",{className:"px-6 py-4 text-center",children:M.jsx("button",{className:"text-red-500 hover:text-red-700 transition",onClick:()=>{ne(Re),pe(!1),H(!0)},children:M.jsx(O_,{size:18})})})]},se)):Oe.map(Re=>M.jsxs("tr",{className:"hover:bg-gray-100 transition cursor-pointer",onClick:()=>Ke(Re),children:[M.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-800",children:Re.name}),M.jsx("td",{className:"px-6 py-4 text-center",children:M.jsx("button",{className:"text-blue-500 hover:text-blue-700 transition",children:"View Recordings"})})]},Re.id))})]})}),Qe>1&&M.jsxs("div",{className:"flex justify-center mt-4 gap-2",children:[M.jsx("button",{className:"px-4 py-1 bg-gray-200 rounded disabled:opacity-50",onClick:()=>N(Re=>Math.max(Re-1,1)),disabled:L===1,children:"Previous"}),M.jsx("button",{className:"px-4 py-1 bg-gray-200 rounded disabled:opacity-50",onClick:()=>N(Re=>Math.min(Re+1,Qe)),disabled:L===Qe,children:"Next"})]})]}),K&&M.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-fadeIn",children:M.jsx("div",{className:"relative p-4 w-full max-w-md",children:M.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg",children:[M.jsx("button",{type:"button",className:"absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors",onClick:()=>{H(!1),pe(!1)},children:M.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),M.jsxs("div",{className:"p-6 text-center",children:[M.jsx("svg",{className:"mx-auto mb-4 text-red-600 w-14 h-14",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:M.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),M.jsx("h3",{className:"mb-4 text-xl font-semibold text-gray-800",children:"Confirm Deletion"}),M.jsx("p",{className:"mb-6 text-gray-600",children:ee?`You are about to delete ${d.length} recordings. This action cannot be undone.`:"This will permanently delete the selected recording. Are you sure?"}),M.jsxs("div",{className:"flex justify-center space-x-4",children:[M.jsx("button",{disabled:_e,onClick:st,className:"px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:_e?"Loading...":"Confirm Delete"}),M.jsx("button",{onClick:()=>{H(!1),pe(!1)},className:"px-6 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})]})]})})})]})}const BA=({children:h})=>localStorage.getItem("superadminToken")?h:M.jsx(oG,{to:"/"}),AN=({children:h})=>localStorage.getItem("token")?h:M.jsx(oG,{to:"/adminlogin"});function Ase(){return M.jsx(kX,{children:M.jsxs(hX,{children:[M.jsx(ud,{path:"/",element:M.jsx(tZ,{})}),M.jsx(ud,{path:"/adminlogin",element:M.jsx(mZ,{})}),M.jsx(ud,{path:"/superadmindashboard",element:M.jsx(BA,{children:M.jsx(P3,{})})}),M.jsx(ud,{path:"/adminhistory",element:M.jsx(BA,{children:M.jsx(fZ,{})})}),M.jsx(ud,{path:"/dashboard",element:M.jsx(BA,{children:M.jsx(P3,{})})}),M.jsx(ud,{path:"/callhistory",element:M.jsx(BA,{children:M.jsx(pZ,{})})}),M.jsx(ud,{path:"/admindashboard",element:M.jsx(AN,{children:M.jsx(DZ,{})})}),M.jsx(ud,{path:"/user",element:M.jsx(AN,{children:M.jsx(LZ,{})})}),M.jsx(ud,{path:"/calllog",element:M.jsx(AN,{children:M.jsx(Rse,{})})})]})})}function Cse(){return M.jsx(M.Fragment,{children:M.jsx(Ase,{})})}v9.createRoot(document.getElementById("root")).render(M.jsx(fe.StrictMode,{children:M.jsx(Cse,{})}));
